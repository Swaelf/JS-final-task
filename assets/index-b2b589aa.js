var Une=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Mit=Une((wc,Ec)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var Kh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jne(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var EV={exports:{}},Q_={},AV={exports:{}},Kr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lb=Symbol.for("react.element"),zne=Symbol.for("react.portal"),Vne=Symbol.for("react.fragment"),Hne=Symbol.for("react.strict_mode"),Gne=Symbol.for("react.profiler"),qne=Symbol.for("react.provider"),Wne=Symbol.for("react.context"),$ne=Symbol.for("react.forward_ref"),Xne=Symbol.for("react.suspense"),Yne=Symbol.for("react.memo"),Kne=Symbol.for("react.lazy"),cN=Symbol.iterator;function Qne(e){return e===null||typeof e!="object"?null:(e=cN&&e[cN]||e["@@iterator"],typeof e=="function"?e:null)}var PV={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},TV=Object.assign,IV={};function Lg(e,t,r){this.props=e,this.context=t,this.refs=IV,this.updater=r||PV}Lg.prototype.isReactComponent={};Lg.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Lg.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function MV(){}MV.prototype=Lg.prototype;function d5(e,t,r){this.props=e,this.context=t,this.refs=IV,this.updater=r||PV}var f5=d5.prototype=new MV;f5.constructor=d5;TV(f5,Lg.prototype);f5.isPureReactComponent=!0;var dN=Array.isArray,DV=Object.prototype.hasOwnProperty,h5={current:null},RV={key:!0,ref:!0,__self:!0,__source:!0};function kV(e,t,r){var n,a={},i=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)DV.call(t,n)&&!RV.hasOwnProperty(n)&&(a[n]=t[n]);var s=arguments.length-2;if(s===1)a.children=r;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];a.children=u}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:lb,type:e,key:i,ref:o,props:a,_owner:h5.current}}function Zne(e,t){return{$$typeof:lb,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function p5(e){return typeof e=="object"&&e!==null&&e.$$typeof===lb}function Jne(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var fN=/\/+/g;function RE(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Jne(""+e.key):t.toString(36)}function zx(e,t,r,n,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case lb:case zne:o=!0}}if(o)return o=e,a=a(o),e=n===""?"."+RE(o,0):n,dN(a)?(r="",e!=null&&(r=e.replace(fN,"$&/")+"/"),zx(a,t,r,"",function(l){return l})):a!=null&&(p5(a)&&(a=Zne(a,r+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(fN,"$&/")+"/")+e)),t.push(a)),1;if(o=0,n=n===""?".":n+":",dN(e))for(var s=0;s<e.length;s++){i=e[s];var u=n+RE(i,s);o+=zx(i,t,r,u,a)}else if(u=Qne(e),typeof u=="function")for(e=u.call(e),s=0;!(i=e.next()).done;)i=i.value,u=n+RE(i,s++),o+=zx(i,t,r,u,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function s2(e,t,r){if(e==null)return e;var n=[],a=0;return zx(e,n,"","",function(i){return t.call(r,i,a++)}),n}function eae(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ao={current:null},Vx={transition:null},tae={ReactCurrentDispatcher:ao,ReactCurrentBatchConfig:Vx,ReactCurrentOwner:h5};Kr.Children={map:s2,forEach:function(e,t,r){s2(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return s2(e,function(){t++}),t},toArray:function(e){return s2(e,function(t){return t})||[]},only:function(e){if(!p5(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Kr.Component=Lg;Kr.Fragment=Vne;Kr.Profiler=Gne;Kr.PureComponent=d5;Kr.StrictMode=Hne;Kr.Suspense=Xne;Kr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tae;Kr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=TV({},e.props),a=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=h5.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)DV.call(t,u)&&!RV.hasOwnProperty(u)&&(n[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)n.children=r;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];n.children=s}return{$$typeof:lb,type:e.type,key:a,ref:i,props:n,_owner:o}};Kr.createContext=function(e){return e={$$typeof:Wne,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:qne,_context:e},e.Consumer=e};Kr.createElement=kV;Kr.createFactory=function(e){var t=kV.bind(null,e);return t.type=e,t};Kr.createRef=function(){return{current:null}};Kr.forwardRef=function(e){return{$$typeof:$ne,render:e}};Kr.isValidElement=p5;Kr.lazy=function(e){return{$$typeof:Kne,_payload:{_status:-1,_result:e},_init:eae}};Kr.memo=function(e,t){return{$$typeof:Yne,type:e,compare:t===void 0?null:t}};Kr.startTransition=function(e){var t=Vx.transition;Vx.transition={};try{e()}finally{Vx.transition=t}};Kr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Kr.useCallback=function(e,t){return ao.current.useCallback(e,t)};Kr.useContext=function(e){return ao.current.useContext(e)};Kr.useDebugValue=function(){};Kr.useDeferredValue=function(e){return ao.current.useDeferredValue(e)};Kr.useEffect=function(e,t){return ao.current.useEffect(e,t)};Kr.useId=function(){return ao.current.useId()};Kr.useImperativeHandle=function(e,t,r){return ao.current.useImperativeHandle(e,t,r)};Kr.useInsertionEffect=function(e,t){return ao.current.useInsertionEffect(e,t)};Kr.useLayoutEffect=function(e,t){return ao.current.useLayoutEffect(e,t)};Kr.useMemo=function(e,t){return ao.current.useMemo(e,t)};Kr.useReducer=function(e,t,r){return ao.current.useReducer(e,t,r)};Kr.useRef=function(e){return ao.current.useRef(e)};Kr.useState=function(e){return ao.current.useState(e)};Kr.useSyncExternalStore=function(e,t,r){return ao.current.useSyncExternalStore(e,t,r)};Kr.useTransition=function(){return ao.current.useTransition()};Kr.version="18.2.0";AV.exports=Kr;var ze=AV.exports;const OV=jne(ze);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rae=ze,nae=Symbol.for("react.element"),aae=Symbol.for("react.fragment"),iae=Object.prototype.hasOwnProperty,oae=rae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,sae={key:!0,ref:!0,__self:!0,__source:!0};function LV(e,t,r){var n,a={},i=null,o=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)iae.call(t,n)&&!sae.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:nae,type:e,key:i,ref:o,props:a,_owner:oae.current}}Q_.Fragment=aae;Q_.jsx=LV;Q_.jsxs=LV;EV.exports=Q_;var M=EV.exports;function Xi(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var hN=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),kE=function(){return Math.random().toString(36).substring(7).split("").join(".")},TS={INIT:"@@redux/INIT"+kE(),REPLACE:"@@redux/REPLACE"+kE(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+kE()}};function uae(e){if(typeof e!="object"||e===null)return!1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function v5(e,t,r){var n;if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Xi(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(Xi(1));return r(v5)(e,t)}if(typeof e!="function")throw new Error(Xi(2));var a=e,i=t,o=[],s=o,u=!1;function l(){s===o&&(s=o.slice())}function c(){if(u)throw new Error(Xi(3));return i}function d(p){if(typeof p!="function")throw new Error(Xi(4));if(u)throw new Error(Xi(5));var g=!0;return l(),s.push(p),function(){if(g){if(u)throw new Error(Xi(6));g=!1,l();var y=s.indexOf(p);s.splice(y,1),o=null}}}function f(p){if(!uae(p))throw new Error(Xi(7));if(typeof p.type>"u")throw new Error(Xi(8));if(u)throw new Error(Xi(9));try{u=!0,i=a(i,p)}finally{u=!1}for(var g=o=s,m=0;m<g.length;m++){var y=g[m];y()}return p}function h(p){if(typeof p!="function")throw new Error(Xi(10));a=p,f({type:TS.REPLACE})}function v(){var p,g=d;return p={subscribe:function(y){if(typeof y!="object"||y===null)throw new Error(Xi(11));function b(){y.next&&y.next(c())}b();var S=g(b);return{unsubscribe:S}}},p[hN]=function(){return this},p}return f({type:TS.INIT}),n={dispatch:f,subscribe:d,getState:c,replaceReducer:h},n[hN]=v,n}function lae(e){Object.keys(e).forEach(function(t){var r=e[t],n=r(void 0,{type:TS.INIT});if(typeof n>"u")throw new Error(Xi(12));if(typeof r(void 0,{type:TS.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Xi(13))})}function cae(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var a=t[n];typeof e[a]=="function"&&(r[a]=e[a])}var i=Object.keys(r),o;try{lae(r)}catch(s){o=s}return function(u,l){if(u===void 0&&(u={}),o)throw o;for(var c=!1,d={},f=0;f<i.length;f++){var h=i[f],v=r[h],p=u[h],g=v(p,l);if(typeof g>"u")throw l&&l.type,new Error(Xi(14));d[h]=g,c=c||g!==p}return c=c||i.length!==Object.keys(u).length,c?d:u}}var NV={exports:{}},FV={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ag=ze;function dae(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var fae=typeof Object.is=="function"?Object.is:dae,hae=ag.useState,pae=ag.useEffect,vae=ag.useLayoutEffect,mae=ag.useDebugValue;function gae(e,t){var r=t(),n=hae({inst:{value:r,getSnapshot:t}}),a=n[0].inst,i=n[1];return vae(function(){a.value=r,a.getSnapshot=t,OE(a)&&i({inst:a})},[e,r,t]),pae(function(){return OE(a)&&i({inst:a}),e(function(){OE(a)&&i({inst:a})})},[e]),mae(r),r}function OE(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!fae(e,r)}catch{return!0}}function yae(e,t){return t()}var bae=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?yae:gae;FV.useSyncExternalStore=ag.useSyncExternalStore!==void 0?ag.useSyncExternalStore:bae;NV.exports=FV;var xae=NV.exports,BV={exports:{}},UV={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z_=ze,Sae=xae;function Cae(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var _ae=typeof Object.is=="function"?Object.is:Cae,wae=Sae.useSyncExternalStore,Eae=Z_.useRef,Aae=Z_.useEffect,Pae=Z_.useMemo,Tae=Z_.useDebugValue;UV.useSyncExternalStoreWithSelector=function(e,t,r,n,a){var i=Eae(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=Pae(function(){function u(h){if(!l){if(l=!0,c=h,h=n(h),a!==void 0&&o.hasValue){var v=o.value;if(a(v,h))return d=v}return d=h}if(v=d,_ae(c,h))return v;var p=n(h);return a!==void 0&&a(v,p)?v:(c=h,d=p)}var l=!1,c,d,f=r===void 0?null:r;return[function(){return u(t())},f===null?void 0:function(){return u(f())}]},[t,r,n,a]);var s=wae(e,i[0],i[1]);return Aae(function(){o.hasValue=!0,o.value=s},[s]),Tae(s),s};BV.exports=UV;var Iae=BV.exports,jV={exports:{}},os={},zV={exports:{}},VV={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(G,W){var q=G.length;G.push(W);e:for(;0<q;){var J=q-1>>>1,he=G[J];if(0<a(he,W))G[J]=W,G[q]=he,q=J;else break e}}function r(G){return G.length===0?null:G[0]}function n(G){if(G.length===0)return null;var W=G[0],q=G.pop();if(q!==W){G[0]=q;e:for(var J=0,he=G.length,$=he>>>1;J<$;){var X=2*(J+1)-1,U=G[X],z=X+1,ee=G[z];if(0>a(U,q))z<he&&0>a(ee,U)?(G[J]=ee,G[z]=q,J=z):(G[J]=U,G[X]=q,J=X);else if(z<he&&0>a(ee,q))G[J]=ee,G[z]=q,J=z;else break e}}return W}function a(G,W){var q=G.sortIndex-W.sortIndex;return q!==0?q:G.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var u=[],l=[],c=1,d=null,f=3,h=!1,v=!1,p=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(G){for(var W=r(l);W!==null;){if(W.callback===null)n(l);else if(W.startTime<=G)n(l),W.sortIndex=W.expirationTime,t(u,W);else break;W=r(l)}}function S(G){if(p=!1,b(G),!v)if(r(u)!==null)v=!0,j(x);else{var W=r(l);W!==null&&Q(S,W.startTime-G)}}function x(G,W){v=!1,p&&(p=!1,m(A),A=-1),h=!0;var q=f;try{for(b(W),d=r(u);d!==null&&(!(d.expirationTime>W)||G&&!k());){var J=d.callback;if(typeof J=="function"){d.callback=null,f=d.priorityLevel;var he=J(d.expirationTime<=W);W=e.unstable_now(),typeof he=="function"?d.callback=he:d===r(u)&&n(u),b(W)}else n(u);d=r(u)}if(d!==null)var $=!0;else{var X=r(l);X!==null&&Q(S,X.startTime-W),$=!1}return $}finally{d=null,f=q,h=!1}}var C=!1,w=null,A=-1,I=5,D=-1;function k(){return!(e.unstable_now()-D<I)}function R(){if(w!==null){var G=e.unstable_now();D=G;var W=!0;try{W=w(!0,G)}finally{W?L():(C=!1,w=null)}}else C=!1}var L;if(typeof y=="function")L=function(){y(R)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,B=H.port2;H.port1.onmessage=R,L=function(){B.postMessage(null)}}else L=function(){g(R,0)};function j(G){w=G,C||(C=!0,L())}function Q(G,W){A=g(function(){G(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(G){G.callback=null},e.unstable_continueExecution=function(){v||h||(v=!0,j(x))},e.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<G?Math.floor(1e3/G):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return r(u)},e.unstable_next=function(G){switch(f){case 1:case 2:case 3:var W=3;break;default:W=f}var q=f;f=W;try{return G()}finally{f=q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(G,W){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var q=f;f=G;try{return W()}finally{f=q}},e.unstable_scheduleCallback=function(G,W,q){var J=e.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?J+q:J):q=J,G){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=q+he,G={id:c++,callback:W,priorityLevel:G,startTime:q,expirationTime:he,sortIndex:-1},q>J?(G.sortIndex=q,t(l,G),r(u)===null&&G===r(l)&&(p?(m(A),A=-1):p=!0,Q(S,q-J))):(G.sortIndex=he,t(u,G),v||h||(v=!0,j(x))),G},e.unstable_shouldYield=k,e.unstable_wrapCallback=function(G){var W=f;return function(){var q=f;f=W;try{return G.apply(this,arguments)}finally{f=q}}}})(VV);zV.exports=VV;var Mae=zV.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HV=ze,Qo=Mae;function Tt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var GV=new Set,s1={};function nv(e,t){ig(e,t),ig(e+"Capture",t)}function ig(e,t){for(s1[e]=t,e=0;e<t.length;e++)GV.add(t[e])}var Lc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),n4=Object.prototype.hasOwnProperty,Dae=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pN={},vN={};function Rae(e){return n4.call(vN,e)?!0:n4.call(pN,e)?!1:Dae.test(e)?vN[e]=!0:(pN[e]=!0,!1)}function kae(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Oae(e,t,r,n){if(t===null||typeof t>"u"||kae(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function io(e,t,r,n,a,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var vi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){vi[e]=new io(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];vi[t]=new io(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){vi[e]=new io(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){vi[e]=new io(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){vi[e]=new io(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){vi[e]=new io(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){vi[e]=new io(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){vi[e]=new io(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){vi[e]=new io(e,5,!1,e.toLowerCase(),null,!1,!1)});var m5=/[\-:]([a-z])/g;function g5(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(m5,g5);vi[t]=new io(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(m5,g5);vi[t]=new io(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(m5,g5);vi[t]=new io(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){vi[e]=new io(e,1,!1,e.toLowerCase(),null,!1,!1)});vi.xlinkHref=new io("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){vi[e]=new io(e,1,!1,e.toLowerCase(),null,!0,!0)});function y5(e,t,r,n){var a=vi.hasOwnProperty(t)?vi[t]:null;(a!==null?a.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Oae(t,r,a,n)&&(r=null),n||a===null?Rae(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=r===null?a.type===3?!1:"":r:(t=a.attributeName,n=a.attributeNamespace,r===null?e.removeAttribute(t):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var od=HV.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u2=Symbol.for("react.element"),lm=Symbol.for("react.portal"),cm=Symbol.for("react.fragment"),b5=Symbol.for("react.strict_mode"),a4=Symbol.for("react.profiler"),qV=Symbol.for("react.provider"),WV=Symbol.for("react.context"),x5=Symbol.for("react.forward_ref"),i4=Symbol.for("react.suspense"),o4=Symbol.for("react.suspense_list"),S5=Symbol.for("react.memo"),Zd=Symbol.for("react.lazy"),$V=Symbol.for("react.offscreen"),mN=Symbol.iterator;function g0(e){return e===null||typeof e!="object"?null:(e=mN&&e[mN]||e["@@iterator"],typeof e=="function"?e:null)}var da=Object.assign,LE;function sy(e){if(LE===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);LE=t&&t[1]||""}return`
`+LE+e}var NE=!1;function FE(e,t){if(!e||NE)return"";NE=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var n=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){n=l}e.call(t.prototype)}else{try{throw Error()}catch(l){n=l}e()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var a=l.stack.split(`
`),i=n.stack.split(`
`),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(o!==1||s!==1)do if(o--,s--,0>s||a[o]!==i[s]){var u=`
`+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=o&&0<=s);break}}}finally{NE=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?sy(e):""}function Lae(e){switch(e.tag){case 5:return sy(e.type);case 16:return sy("Lazy");case 13:return sy("Suspense");case 19:return sy("SuspenseList");case 0:case 2:case 15:return e=FE(e.type,!1),e;case 11:return e=FE(e.type.render,!1),e;case 1:return e=FE(e.type,!0),e;default:return""}}function s4(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case cm:return"Fragment";case lm:return"Portal";case a4:return"Profiler";case b5:return"StrictMode";case i4:return"Suspense";case o4:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case WV:return(e.displayName||"Context")+".Consumer";case qV:return(e._context.displayName||"Context")+".Provider";case x5:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case S5:return t=e.displayName||null,t!==null?t:s4(e.type)||"Memo";case Zd:t=e._payload,e=e._init;try{return s4(e(t))}catch{}}return null}function Nae(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return s4(t);case 8:return t===b5?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function qf(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function XV(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Fae(e){var t=XV(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){n=""+o,i.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function l2(e){e._valueTracker||(e._valueTracker=Fae(e))}function YV(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=XV(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function IS(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function u4(e,t){var r=t.checked;return da({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function gN(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=qf(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function KV(e,t){t=t.checked,t!=null&&y5(e,"checked",t,!1)}function l4(e,t){KV(e,t);var r=qf(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?c4(e,t.type,r):t.hasOwnProperty("defaultValue")&&c4(e,t.type,qf(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function yN(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function c4(e,t,r){(t!=="number"||IS(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var uy=Array.isArray;function Om(e,t,r,n){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&n&&(e[r].defaultSelected=!0)}else{for(r=""+qf(r),t=null,a=0;a<e.length;a++){if(e[a].value===r){e[a].selected=!0,n&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function d4(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Tt(91));return da({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function bN(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Tt(92));if(uy(r)){if(1<r.length)throw Error(Tt(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:qf(r)}}function QV(e,t){var r=qf(t.value),n=qf(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function xN(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function ZV(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function f4(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?ZV(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var c2,JV=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(c2=c2||document.createElement("div"),c2.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=c2.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function u1(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Iy={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Bae=["Webkit","ms","Moz","O"];Object.keys(Iy).forEach(function(e){Bae.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Iy[t]=Iy[e]})});function eH(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Iy.hasOwnProperty(e)&&Iy[e]?(""+t).trim():t+"px"}function tH(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,a=eH(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,a):e[r]=a}}var Uae=da({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function h4(e,t){if(t){if(Uae[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Tt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Tt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Tt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Tt(62))}}function p4(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var v4=null;function C5(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var m4=null,Lm=null,Nm=null;function SN(e){if(e=fb(e)){if(typeof m4!="function")throw Error(Tt(280));var t=e.stateNode;t&&(t=nw(t),m4(e.stateNode,e.type,t))}}function rH(e){Lm?Nm?Nm.push(e):Nm=[e]:Lm=e}function nH(){if(Lm){var e=Lm,t=Nm;if(Nm=Lm=null,SN(e),t)for(e=0;e<t.length;e++)SN(t[e])}}function aH(e,t){return e(t)}function iH(){}var BE=!1;function oH(e,t,r){if(BE)return e(t,r);BE=!0;try{return aH(e,t,r)}finally{BE=!1,(Lm!==null||Nm!==null)&&(iH(),nH())}}function l1(e,t){var r=e.stateNode;if(r===null)return null;var n=nw(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Tt(231,t,typeof r));return r}var g4=!1;if(Lc)try{var y0={};Object.defineProperty(y0,"passive",{get:function(){g4=!0}}),window.addEventListener("test",y0,y0),window.removeEventListener("test",y0,y0)}catch{g4=!1}function jae(e,t,r,n,a,i,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(r,l)}catch(c){this.onError(c)}}var My=!1,MS=null,DS=!1,y4=null,zae={onError:function(e){My=!0,MS=e}};function Vae(e,t,r,n,a,i,o,s,u){My=!1,MS=null,jae.apply(zae,arguments)}function Hae(e,t,r,n,a,i,o,s,u){if(Vae.apply(this,arguments),My){if(My){var l=MS;My=!1,MS=null}else throw Error(Tt(198));DS||(DS=!0,y4=l)}}function av(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function sH(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function CN(e){if(av(e)!==e)throw Error(Tt(188))}function Gae(e){var t=e.alternate;if(!t){if(t=av(e),t===null)throw Error(Tt(188));return t!==e?null:e}for(var r=e,n=t;;){var a=r.return;if(a===null)break;var i=a.alternate;if(i===null){if(n=a.return,n!==null){r=n;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===r)return CN(a),e;if(i===n)return CN(a),t;i=i.sibling}throw Error(Tt(188))}if(r.return!==n.return)r=a,n=i;else{for(var o=!1,s=a.child;s;){if(s===r){o=!0,r=a,n=i;break}if(s===n){o=!0,n=a,r=i;break}s=s.sibling}if(!o){for(s=i.child;s;){if(s===r){o=!0,r=i,n=a;break}if(s===n){o=!0,n=i,r=a;break}s=s.sibling}if(!o)throw Error(Tt(189))}}if(r.alternate!==n)throw Error(Tt(190))}if(r.tag!==3)throw Error(Tt(188));return r.stateNode.current===r?e:t}function uH(e){return e=Gae(e),e!==null?lH(e):null}function lH(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=lH(e);if(t!==null)return t;e=e.sibling}return null}var cH=Qo.unstable_scheduleCallback,_N=Qo.unstable_cancelCallback,qae=Qo.unstable_shouldYield,Wae=Qo.unstable_requestPaint,_a=Qo.unstable_now,$ae=Qo.unstable_getCurrentPriorityLevel,_5=Qo.unstable_ImmediatePriority,dH=Qo.unstable_UserBlockingPriority,RS=Qo.unstable_NormalPriority,Xae=Qo.unstable_LowPriority,fH=Qo.unstable_IdlePriority,J_=null,Sl=null;function Yae(e){if(Sl&&typeof Sl.onCommitFiberRoot=="function")try{Sl.onCommitFiberRoot(J_,e,void 0,(e.current.flags&128)===128)}catch{}}var Cu=Math.clz32?Math.clz32:Zae,Kae=Math.log,Qae=Math.LN2;function Zae(e){return e>>>=0,e===0?32:31-(Kae(e)/Qae|0)|0}var d2=64,f2=4194304;function ly(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function kS(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,a=e.suspendedLanes,i=e.pingedLanes,o=r&268435455;if(o!==0){var s=o&~a;s!==0?n=ly(s):(i&=o,i!==0&&(n=ly(i)))}else o=r&~a,o!==0?n=ly(o):i!==0&&(n=ly(i));if(n===0)return 0;if(t!==0&&t!==n&&!(t&a)&&(a=n&-n,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Cu(t),a=1<<r,n|=e[r],t&=~a;return n}function Jae(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eie(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-Cu(i),s=1<<o,u=a[o];u===-1?(!(s&r)||s&n)&&(a[o]=Jae(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}function b4(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function hH(){var e=d2;return d2<<=1,!(d2&4194240)&&(d2=64),e}function UE(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function cb(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Cu(t),e[t]=r}function tie(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var a=31-Cu(r),i=1<<a;t[a]=0,n[a]=-1,e[a]=-1,r&=~i}}function w5(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Cu(r),a=1<<n;a&t|e[n]&t&&(e[n]|=t),r&=~a}}var _n=0;function pH(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var vH,E5,mH,gH,yH,x4=!1,h2=[],Tf=null,If=null,Mf=null,c1=new Map,d1=new Map,rf=[],rie="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wN(e,t){switch(e){case"focusin":case"focusout":Tf=null;break;case"dragenter":case"dragleave":If=null;break;case"mouseover":case"mouseout":Mf=null;break;case"pointerover":case"pointerout":c1.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":d1.delete(t.pointerId)}}function b0(e,t,r,n,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[a]},t!==null&&(t=fb(t),t!==null&&E5(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function nie(e,t,r,n,a){switch(t){case"focusin":return Tf=b0(Tf,e,t,r,n,a),!0;case"dragenter":return If=b0(If,e,t,r,n,a),!0;case"mouseover":return Mf=b0(Mf,e,t,r,n,a),!0;case"pointerover":var i=a.pointerId;return c1.set(i,b0(c1.get(i)||null,e,t,r,n,a)),!0;case"gotpointercapture":return i=a.pointerId,d1.set(i,b0(d1.get(i)||null,e,t,r,n,a)),!0}return!1}function bH(e){var t=rp(e.target);if(t!==null){var r=av(t);if(r!==null){if(t=r.tag,t===13){if(t=sH(r),t!==null){e.blockedOn=t,yH(e.priority,function(){mH(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Hx(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=S4(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);v4=n,r.target.dispatchEvent(n),v4=null}else return t=fb(r),t!==null&&E5(t),e.blockedOn=r,!1;t.shift()}return!0}function EN(e,t,r){Hx(e)&&r.delete(t)}function aie(){x4=!1,Tf!==null&&Hx(Tf)&&(Tf=null),If!==null&&Hx(If)&&(If=null),Mf!==null&&Hx(Mf)&&(Mf=null),c1.forEach(EN),d1.forEach(EN)}function x0(e,t){e.blockedOn===t&&(e.blockedOn=null,x4||(x4=!0,Qo.unstable_scheduleCallback(Qo.unstable_NormalPriority,aie)))}function f1(e){function t(a){return x0(a,e)}if(0<h2.length){x0(h2[0],e);for(var r=1;r<h2.length;r++){var n=h2[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Tf!==null&&x0(Tf,e),If!==null&&x0(If,e),Mf!==null&&x0(Mf,e),c1.forEach(t),d1.forEach(t),r=0;r<rf.length;r++)n=rf[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<rf.length&&(r=rf[0],r.blockedOn===null);)bH(r),r.blockedOn===null&&rf.shift()}var Fm=od.ReactCurrentBatchConfig,OS=!0;function iie(e,t,r,n){var a=_n,i=Fm.transition;Fm.transition=null;try{_n=1,A5(e,t,r,n)}finally{_n=a,Fm.transition=i}}function oie(e,t,r,n){var a=_n,i=Fm.transition;Fm.transition=null;try{_n=4,A5(e,t,r,n)}finally{_n=a,Fm.transition=i}}function A5(e,t,r,n){if(OS){var a=S4(e,t,r,n);if(a===null)YE(e,t,n,LS,r),wN(e,n);else if(nie(a,e,t,r,n))n.stopPropagation();else if(wN(e,n),t&4&&-1<rie.indexOf(e)){for(;a!==null;){var i=fb(a);if(i!==null&&vH(i),i=S4(e,t,r,n),i===null&&YE(e,t,n,LS,r),i===a)break;a=i}a!==null&&n.stopPropagation()}else YE(e,t,n,null,r)}}var LS=null;function S4(e,t,r,n){if(LS=null,e=C5(n),e=rp(e),e!==null)if(t=av(e),t===null)e=null;else if(r=t.tag,r===13){if(e=sH(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return LS=e,null}function xH(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($ae()){case _5:return 1;case dH:return 4;case RS:case Xae:return 16;case fH:return 536870912;default:return 16}default:return 16}}var yf=null,P5=null,Gx=null;function SH(){if(Gx)return Gx;var e,t=P5,r=t.length,n,a="value"in yf?yf.value:yf.textContent,i=a.length;for(e=0;e<r&&t[e]===a[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===a[i-n];n++);return Gx=a.slice(e,1<n?1-n:void 0)}function qx(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function p2(){return!0}function AN(){return!1}function ss(e){function t(r,n,a,i,o){this._reactName=r,this._targetInst=a,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?p2:AN,this.isPropagationStopped=AN,this}return da(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=p2)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=p2)},persist:function(){},isPersistent:p2}),t}var Ng={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},T5=ss(Ng),db=da({},Ng,{view:0,detail:0}),sie=ss(db),jE,zE,S0,ew=da({},db,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:I5,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==S0&&(S0&&e.type==="mousemove"?(jE=e.screenX-S0.screenX,zE=e.screenY-S0.screenY):zE=jE=0,S0=e),jE)},movementY:function(e){return"movementY"in e?e.movementY:zE}}),PN=ss(ew),uie=da({},ew,{dataTransfer:0}),lie=ss(uie),cie=da({},db,{relatedTarget:0}),VE=ss(cie),die=da({},Ng,{animationName:0,elapsedTime:0,pseudoElement:0}),fie=ss(die),hie=da({},Ng,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),pie=ss(hie),vie=da({},Ng,{data:0}),TN=ss(vie),mie={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gie={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yie={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bie(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=yie[e])?!!t[e]:!1}function I5(){return bie}var xie=da({},db,{key:function(e){if(e.key){var t=mie[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=qx(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?gie[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:I5,charCode:function(e){return e.type==="keypress"?qx(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?qx(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Sie=ss(xie),Cie=da({},ew,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),IN=ss(Cie),_ie=da({},db,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:I5}),wie=ss(_ie),Eie=da({},Ng,{propertyName:0,elapsedTime:0,pseudoElement:0}),Aie=ss(Eie),Pie=da({},ew,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Tie=ss(Pie),Iie=[9,13,27,32],M5=Lc&&"CompositionEvent"in window,Dy=null;Lc&&"documentMode"in document&&(Dy=document.documentMode);var Mie=Lc&&"TextEvent"in window&&!Dy,CH=Lc&&(!M5||Dy&&8<Dy&&11>=Dy),MN=String.fromCharCode(32),DN=!1;function _H(e,t){switch(e){case"keyup":return Iie.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wH(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var dm=!1;function Die(e,t){switch(e){case"compositionend":return wH(t);case"keypress":return t.which!==32?null:(DN=!0,MN);case"textInput":return e=t.data,e===MN&&DN?null:e;default:return null}}function Rie(e,t){if(dm)return e==="compositionend"||!M5&&_H(e,t)?(e=SH(),Gx=P5=yf=null,dm=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return CH&&t.locale!=="ko"?null:t.data;default:return null}}var kie={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function RN(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!kie[e.type]:t==="textarea"}function EH(e,t,r,n){rH(n),t=NS(t,"onChange"),0<t.length&&(r=new T5("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Ry=null,h1=null;function Oie(e){NH(e,0)}function tw(e){var t=pm(e);if(YV(t))return e}function Lie(e,t){if(e==="change")return t}var AH=!1;if(Lc){var HE;if(Lc){var GE="oninput"in document;if(!GE){var kN=document.createElement("div");kN.setAttribute("oninput","return;"),GE=typeof kN.oninput=="function"}HE=GE}else HE=!1;AH=HE&&(!document.documentMode||9<document.documentMode)}function ON(){Ry&&(Ry.detachEvent("onpropertychange",PH),h1=Ry=null)}function PH(e){if(e.propertyName==="value"&&tw(h1)){var t=[];EH(t,h1,e,C5(e)),oH(Oie,t)}}function Nie(e,t,r){e==="focusin"?(ON(),Ry=t,h1=r,Ry.attachEvent("onpropertychange",PH)):e==="focusout"&&ON()}function Fie(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return tw(h1)}function Bie(e,t){if(e==="click")return tw(t)}function Uie(e,t){if(e==="input"||e==="change")return tw(t)}function jie(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Lu=typeof Object.is=="function"?Object.is:jie;function p1(e,t){if(Lu(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var a=r[n];if(!n4.call(t,a)||!Lu(e[a],t[a]))return!1}return!0}function LN(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function NN(e,t){var r=LN(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=LN(r)}}function TH(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?TH(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function IH(){for(var e=window,t=IS();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=IS(e.document)}return t}function D5(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function zie(e){var t=IH(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&TH(r.ownerDocument.documentElement,r)){if(n!==null&&D5(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=r.textContent.length,i=Math.min(n.start,a);n=n.end===void 0?i:Math.min(n.end,a),!e.extend&&i>n&&(a=n,n=i,i=a),a=NN(r,i);var o=NN(r,n);a&&o&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Vie=Lc&&"documentMode"in document&&11>=document.documentMode,fm=null,C4=null,ky=null,_4=!1;function FN(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;_4||fm==null||fm!==IS(n)||(n=fm,"selectionStart"in n&&D5(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ky&&p1(ky,n)||(ky=n,n=NS(C4,"onSelect"),0<n.length&&(t=new T5("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=fm)))}function v2(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var hm={animationend:v2("Animation","AnimationEnd"),animationiteration:v2("Animation","AnimationIteration"),animationstart:v2("Animation","AnimationStart"),transitionend:v2("Transition","TransitionEnd")},qE={},MH={};Lc&&(MH=document.createElement("div").style,"AnimationEvent"in window||(delete hm.animationend.animation,delete hm.animationiteration.animation,delete hm.animationstart.animation),"TransitionEvent"in window||delete hm.transitionend.transition);function rw(e){if(qE[e])return qE[e];if(!hm[e])return e;var t=hm[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in MH)return qE[e]=t[r];return e}var DH=rw("animationend"),RH=rw("animationiteration"),kH=rw("animationstart"),OH=rw("transitionend"),LH=new Map,BN="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function lh(e,t){LH.set(e,t),nv(t,[e])}for(var WE=0;WE<BN.length;WE++){var $E=BN[WE],Hie=$E.toLowerCase(),Gie=$E[0].toUpperCase()+$E.slice(1);lh(Hie,"on"+Gie)}lh(DH,"onAnimationEnd");lh(RH,"onAnimationIteration");lh(kH,"onAnimationStart");lh("dblclick","onDoubleClick");lh("focusin","onFocus");lh("focusout","onBlur");lh(OH,"onTransitionEnd");ig("onMouseEnter",["mouseout","mouseover"]);ig("onMouseLeave",["mouseout","mouseover"]);ig("onPointerEnter",["pointerout","pointerover"]);ig("onPointerLeave",["pointerout","pointerover"]);nv("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));nv("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));nv("onBeforeInput",["compositionend","keypress","textInput","paste"]);nv("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));nv("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));nv("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cy="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qie=new Set("cancel close invalid load scroll toggle".split(" ").concat(cy));function UN(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Hae(n,t,void 0,e),e.currentTarget=null}function NH(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],a=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var o=n.length-1;0<=o;o--){var s=n[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;UN(a,s,l),i=u}else for(o=0;o<n.length;o++){if(s=n[o],u=s.instance,l=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;UN(a,s,l),i=u}}}if(DS)throw e=y4,DS=!1,y4=null,e}function Vn(e,t){var r=t[T4];r===void 0&&(r=t[T4]=new Set);var n=e+"__bubble";r.has(n)||(FH(t,e,2,!1),r.add(n))}function XE(e,t,r){var n=0;t&&(n|=4),FH(r,e,n,t)}var m2="_reactListening"+Math.random().toString(36).slice(2);function v1(e){if(!e[m2]){e[m2]=!0,GV.forEach(function(r){r!=="selectionchange"&&(qie.has(r)||XE(r,!1,e),XE(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[m2]||(t[m2]=!0,XE("selectionchange",!1,t))}}function FH(e,t,r,n){switch(xH(t)){case 1:var a=iie;break;case 4:a=oie;break;default:a=A5}r=a.bind(null,t,r,e),a=void 0,!g4||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),n?a!==void 0?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):a!==void 0?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function YE(e,t,r,n,a){var i=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var s=n.stateNode.containerInfo;if(s===a||s.nodeType===8&&s.parentNode===a)break;if(o===4)for(o=n.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===a||u.nodeType===8&&u.parentNode===a))return;o=o.return}for(;s!==null;){if(o=rp(s),o===null)return;if(u=o.tag,u===5||u===6){n=i=o;continue e}s=s.parentNode}}n=n.return}oH(function(){var l=i,c=C5(r),d=[];e:{var f=LH.get(e);if(f!==void 0){var h=T5,v=e;switch(e){case"keypress":if(qx(r)===0)break e;case"keydown":case"keyup":h=Sie;break;case"focusin":v="focus",h=VE;break;case"focusout":v="blur",h=VE;break;case"beforeblur":case"afterblur":h=VE;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=PN;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=lie;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=wie;break;case DH:case RH:case kH:h=fie;break;case OH:h=Aie;break;case"scroll":h=sie;break;case"wheel":h=Tie;break;case"copy":case"cut":case"paste":h=pie;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=IN}var p=(t&4)!==0,g=!p&&e==="scroll",m=p?f!==null?f+"Capture":null:f;p=[];for(var y=l,b;y!==null;){b=y;var S=b.stateNode;if(b.tag===5&&S!==null&&(b=S,m!==null&&(S=l1(y,m),S!=null&&p.push(m1(y,S,b)))),g)break;y=y.return}0<p.length&&(f=new h(f,v,null,r,c),d.push({event:f,listeners:p}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",h=e==="mouseout"||e==="pointerout",f&&r!==v4&&(v=r.relatedTarget||r.fromElement)&&(rp(v)||v[Nc]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(v=r.relatedTarget||r.toElement,h=l,v=v?rp(v):null,v!==null&&(g=av(v),v!==g||v.tag!==5&&v.tag!==6)&&(v=null)):(h=null,v=l),h!==v)){if(p=PN,S="onMouseLeave",m="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(p=IN,S="onPointerLeave",m="onPointerEnter",y="pointer"),g=h==null?f:pm(h),b=v==null?f:pm(v),f=new p(S,y+"leave",h,r,c),f.target=g,f.relatedTarget=b,S=null,rp(c)===l&&(p=new p(m,y+"enter",v,r,c),p.target=b,p.relatedTarget=g,S=p),g=S,h&&v)t:{for(p=h,m=v,y=0,b=p;b;b=Fv(b))y++;for(b=0,S=m;S;S=Fv(S))b++;for(;0<y-b;)p=Fv(p),y--;for(;0<b-y;)m=Fv(m),b--;for(;y--;){if(p===m||m!==null&&p===m.alternate)break t;p=Fv(p),m=Fv(m)}p=null}else p=null;h!==null&&jN(d,f,h,p,!1),v!==null&&g!==null&&jN(d,g,v,p,!0)}}e:{if(f=l?pm(l):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var x=Lie;else if(RN(f))if(AH)x=Uie;else{x=Fie;var C=Nie}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(x=Bie);if(x&&(x=x(e,l))){EH(d,x,r,c);break e}C&&C(e,f,l),e==="focusout"&&(C=f._wrapperState)&&C.controlled&&f.type==="number"&&c4(f,"number",f.value)}switch(C=l?pm(l):window,e){case"focusin":(RN(C)||C.contentEditable==="true")&&(fm=C,C4=l,ky=null);break;case"focusout":ky=C4=fm=null;break;case"mousedown":_4=!0;break;case"contextmenu":case"mouseup":case"dragend":_4=!1,FN(d,r,c);break;case"selectionchange":if(Vie)break;case"keydown":case"keyup":FN(d,r,c)}var w;if(M5)e:{switch(e){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else dm?_H(e,r)&&(A="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(A="onCompositionStart");A&&(CH&&r.locale!=="ko"&&(dm||A!=="onCompositionStart"?A==="onCompositionEnd"&&dm&&(w=SH()):(yf=c,P5="value"in yf?yf.value:yf.textContent,dm=!0)),C=NS(l,A),0<C.length&&(A=new TN(A,e,null,r,c),d.push({event:A,listeners:C}),w?A.data=w:(w=wH(r),w!==null&&(A.data=w)))),(w=Mie?Die(e,r):Rie(e,r))&&(l=NS(l,"onBeforeInput"),0<l.length&&(c=new TN("onBeforeInput","beforeinput",null,r,c),d.push({event:c,listeners:l}),c.data=w))}NH(d,t)})}function m1(e,t,r){return{instance:e,listener:t,currentTarget:r}}function NS(e,t){for(var r=t+"Capture",n=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=l1(e,r),i!=null&&n.unshift(m1(e,i,a)),i=l1(e,t),i!=null&&n.push(m1(e,i,a))),e=e.return}return n}function Fv(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function jN(e,t,r,n,a){for(var i=t._reactName,o=[];r!==null&&r!==n;){var s=r,u=s.alternate,l=s.stateNode;if(u!==null&&u===n)break;s.tag===5&&l!==null&&(s=l,a?(u=l1(r,i),u!=null&&o.unshift(m1(r,u,s))):a||(u=l1(r,i),u!=null&&o.push(m1(r,u,s)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var Wie=/\r\n?/g,$ie=/\u0000|\uFFFD/g;function zN(e){return(typeof e=="string"?e:""+e).replace(Wie,`
`).replace($ie,"")}function g2(e,t,r){if(t=zN(t),zN(e)!==t&&r)throw Error(Tt(425))}function FS(){}var w4=null,E4=null;function A4(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var P4=typeof setTimeout=="function"?setTimeout:void 0,Xie=typeof clearTimeout=="function"?clearTimeout:void 0,VN=typeof Promise=="function"?Promise:void 0,Yie=typeof queueMicrotask=="function"?queueMicrotask:typeof VN<"u"?function(e){return VN.resolve(null).then(e).catch(Kie)}:P4;function Kie(e){setTimeout(function(){throw e})}function KE(e,t){var r=t,n=0;do{var a=r.nextSibling;if(e.removeChild(r),a&&a.nodeType===8)if(r=a.data,r==="/$"){if(n===0){e.removeChild(a),f1(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=a}while(r);f1(t)}function Df(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function HN(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Fg=Math.random().toString(36).slice(2),pl="__reactFiber$"+Fg,g1="__reactProps$"+Fg,Nc="__reactContainer$"+Fg,T4="__reactEvents$"+Fg,Qie="__reactListeners$"+Fg,Zie="__reactHandles$"+Fg;function rp(e){var t=e[pl];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Nc]||r[pl]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=HN(e);e!==null;){if(r=e[pl])return r;e=HN(e)}return t}e=r,r=e.parentNode}return null}function fb(e){return e=e[pl]||e[Nc],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function pm(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Tt(33))}function nw(e){return e[g1]||null}var I4=[],vm=-1;function ch(e){return{current:e}}function $n(e){0>vm||(e.current=I4[vm],I4[vm]=null,vm--)}function Bn(e,t){vm++,I4[vm]=e.current,e.current=t}var Wf={},Ni=ch(Wf),So=ch(!1),Ap=Wf;function og(e,t){var r=e.type.contextTypes;if(!r)return Wf;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in r)a[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Co(e){return e=e.childContextTypes,e!=null}function BS(){$n(So),$n(Ni)}function GN(e,t,r){if(Ni.current!==Wf)throw Error(Tt(168));Bn(Ni,t),Bn(So,r)}function BH(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var a in n)if(!(a in t))throw Error(Tt(108,Nae(e)||"Unknown",a));return da({},r,n)}function US(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Wf,Ap=Ni.current,Bn(Ni,e),Bn(So,So.current),!0}function qN(e,t,r){var n=e.stateNode;if(!n)throw Error(Tt(169));r?(e=BH(e,t,Ap),n.__reactInternalMemoizedMergedChildContext=e,$n(So),$n(Ni),Bn(Ni,e)):$n(So),Bn(So,r)}var cc=null,aw=!1,QE=!1;function UH(e){cc===null?cc=[e]:cc.push(e)}function Jie(e){aw=!0,UH(e)}function dh(){if(!QE&&cc!==null){QE=!0;var e=0,t=_n;try{var r=cc;for(_n=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}cc=null,aw=!1}catch(a){throw cc!==null&&(cc=cc.slice(e+1)),cH(_5,dh),a}finally{_n=t,QE=!1}}return null}var mm=[],gm=0,jS=null,zS=0,Ds=[],Rs=0,Pp=null,mc=1,gc="";function Hh(e,t){mm[gm++]=zS,mm[gm++]=jS,jS=e,zS=t}function jH(e,t,r){Ds[Rs++]=mc,Ds[Rs++]=gc,Ds[Rs++]=Pp,Pp=e;var n=mc;e=gc;var a=32-Cu(n)-1;n&=~(1<<a),r+=1;var i=32-Cu(t)+a;if(30<i){var o=a-a%5;i=(n&(1<<o)-1).toString(32),n>>=o,a-=o,mc=1<<32-Cu(t)+a|r<<a|n,gc=i+e}else mc=1<<i|r<<a|n,gc=e}function R5(e){e.return!==null&&(Hh(e,1),jH(e,1,0))}function k5(e){for(;e===jS;)jS=mm[--gm],mm[gm]=null,zS=mm[--gm],mm[gm]=null;for(;e===Pp;)Pp=Ds[--Rs],Ds[Rs]=null,gc=Ds[--Rs],Ds[Rs]=null,mc=Ds[--Rs],Ds[Rs]=null}var Xo=null,Go=null,ra=!1,pu=null;function zH(e,t){var r=Os(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function WN(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Xo=e,Go=Df(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Xo=e,Go=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Pp!==null?{id:mc,overflow:gc}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Os(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Xo=e,Go=null,!0):!1;default:return!1}}function M4(e){return(e.mode&1)!==0&&(e.flags&128)===0}function D4(e){if(ra){var t=Go;if(t){var r=t;if(!WN(e,t)){if(M4(e))throw Error(Tt(418));t=Df(r.nextSibling);var n=Xo;t&&WN(e,t)?zH(n,r):(e.flags=e.flags&-4097|2,ra=!1,Xo=e)}}else{if(M4(e))throw Error(Tt(418));e.flags=e.flags&-4097|2,ra=!1,Xo=e}}}function $N(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Xo=e}function y2(e){if(e!==Xo)return!1;if(!ra)return $N(e),ra=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!A4(e.type,e.memoizedProps)),t&&(t=Go)){if(M4(e))throw VH(),Error(Tt(418));for(;t;)zH(e,t),t=Df(t.nextSibling)}if($N(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Tt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Go=Df(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Go=null}}else Go=Xo?Df(e.stateNode.nextSibling):null;return!0}function VH(){for(var e=Go;e;)e=Df(e.nextSibling)}function sg(){Go=Xo=null,ra=!1}function O5(e){pu===null?pu=[e]:pu.push(e)}var eoe=od.ReactCurrentBatchConfig;function lu(e,t){if(e&&e.defaultProps){t=da({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var VS=ch(null),HS=null,ym=null,L5=null;function N5(){L5=ym=HS=null}function F5(e){var t=VS.current;$n(VS),e._currentValue=t}function R4(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Bm(e,t){HS=e,L5=ym=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(xo=!0),e.firstContext=null)}function zs(e){var t=e._currentValue;if(L5!==e)if(e={context:e,memoizedValue:t,next:null},ym===null){if(HS===null)throw Error(Tt(308));ym=e,HS.dependencies={lanes:0,firstContext:e}}else ym=ym.next=e;return t}var np=null;function B5(e){np===null?np=[e]:np.push(e)}function HH(e,t,r,n){var a=t.interleaved;return a===null?(r.next=r,B5(t)):(r.next=a.next,a.next=r),t.interleaved=r,Fc(e,n)}function Fc(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Jd=!1;function U5(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function GH(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ac(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Rf(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,sn&2){var a=n.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),n.pending=t,Fc(e,r)}return a=n.interleaved,a===null?(t.next=t,B5(n)):(t.next=a.next,a.next=t),n.interleaved=t,Fc(e,r)}function Wx(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,w5(e,r)}}function XN(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var a=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?a=i=o:i=i.next=o,r=r.next}while(r!==null);i===null?a=i=t:i=i.next=t}else a=i=t;r={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function GS(e,t,r,n){var a=e.updateQueue;Jd=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(s!==null){a.shared.pending=null;var u=s,l=u.next;u.next=null,o===null?i=l:o.next=l,o=u;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==o&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(i!==null){var d=a.baseState;o=0,c=l=u=null,s=i;do{var f=s.lane,h=s.eventTime;if((n&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var v=e,p=s;switch(f=t,h=r,p.tag){case 1:if(v=p.payload,typeof v=="function"){d=v.call(h,d,f);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=p.payload,f=typeof v=="function"?v.call(h,d,f):v,f==null)break e;d=da({},d,f);break e;case 2:Jd=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,f=a.effects,f===null?a.effects=[s]:f.push(s))}else h={eventTime:h,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=h,u=d):c=c.next=h,o|=f;if(s=s.next,s===null){if(s=a.shared.pending,s===null)break;f=s,s=f.next,f.next=null,a.lastBaseUpdate=f,a.shared.pending=null}}while(1);if(c===null&&(u=d),a.baseState=u,a.firstBaseUpdate=l,a.lastBaseUpdate=c,t=a.shared.interleaved,t!==null){a=t;do o|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);Ip|=o,e.lanes=o,e.memoizedState=d}}function YN(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(a!==null){if(n.callback=null,n=r,typeof a!="function")throw Error(Tt(191,a));a.call(n)}}}var qH=new HV.Component().refs;function k4(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:da({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var iw={isMounted:function(e){return(e=e._reactInternals)?av(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=Zi(),a=Of(e),i=Ac(n,a);i.payload=t,r!=null&&(i.callback=r),t=Rf(e,i,a),t!==null&&(_u(t,e,a,n),Wx(t,e,a))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=Zi(),a=Of(e),i=Ac(n,a);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=Rf(e,i,a),t!==null&&(_u(t,e,a,n),Wx(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Zi(),n=Of(e),a=Ac(r,n);a.tag=2,t!=null&&(a.callback=t),t=Rf(e,a,n),t!==null&&(_u(t,e,n,r),Wx(t,e,n))}};function KN(e,t,r,n,a,i,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,o):t.prototype&&t.prototype.isPureReactComponent?!p1(r,n)||!p1(a,i):!0}function WH(e,t,r){var n=!1,a=Wf,i=t.contextType;return typeof i=="object"&&i!==null?i=zs(i):(a=Co(t)?Ap:Ni.current,n=t.contextTypes,i=(n=n!=null)?og(e,a):Wf),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=iw,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function QN(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&iw.enqueueReplaceState(t,t.state,null)}function O4(e,t,r,n){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs=qH,U5(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=zs(i):(i=Co(t)?Ap:Ni.current,a.context=og(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(k4(e,t,i,r),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&iw.enqueueReplaceState(a,a.state,null),GS(e,r,a,n),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function C0(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Tt(309));var n=r.stateNode}if(!n)throw Error(Tt(147,e));var a=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(o){var s=a.refs;s===qH&&(s=a.refs={}),o===null?delete s[i]:s[i]=o},t._stringRef=i,t)}if(typeof e!="string")throw Error(Tt(284));if(!r._owner)throw Error(Tt(290,e))}return e}function b2(e,t){throw e=Object.prototype.toString.call(t),Error(Tt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ZN(e){var t=e._init;return t(e._payload)}function $H(e){function t(m,y){if(e){var b=m.deletions;b===null?(m.deletions=[y],m.flags|=16):b.push(y)}}function r(m,y){if(!e)return null;for(;y!==null;)t(m,y),y=y.sibling;return null}function n(m,y){for(m=new Map;y!==null;)y.key!==null?m.set(y.key,y):m.set(y.index,y),y=y.sibling;return m}function a(m,y){return m=Lf(m,y),m.index=0,m.sibling=null,m}function i(m,y,b){return m.index=b,e?(b=m.alternate,b!==null?(b=b.index,b<y?(m.flags|=2,y):b):(m.flags|=2,y)):(m.flags|=1048576,y)}function o(m){return e&&m.alternate===null&&(m.flags|=2),m}function s(m,y,b,S){return y===null||y.tag!==6?(y=aA(b,m.mode,S),y.return=m,y):(y=a(y,b),y.return=m,y)}function u(m,y,b,S){var x=b.type;return x===cm?c(m,y,b.props.children,S,b.key):y!==null&&(y.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===Zd&&ZN(x)===y.type)?(S=a(y,b.props),S.ref=C0(m,y,b),S.return=m,S):(S=Zx(b.type,b.key,b.props,null,m.mode,S),S.ref=C0(m,y,b),S.return=m,S)}function l(m,y,b,S){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=iA(b,m.mode,S),y.return=m,y):(y=a(y,b.children||[]),y.return=m,y)}function c(m,y,b,S,x){return y===null||y.tag!==7?(y=pp(b,m.mode,S,x),y.return=m,y):(y=a(y,b),y.return=m,y)}function d(m,y,b){if(typeof y=="string"&&y!==""||typeof y=="number")return y=aA(""+y,m.mode,b),y.return=m,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case u2:return b=Zx(y.type,y.key,y.props,null,m.mode,b),b.ref=C0(m,null,y),b.return=m,b;case lm:return y=iA(y,m.mode,b),y.return=m,y;case Zd:var S=y._init;return d(m,S(y._payload),b)}if(uy(y)||g0(y))return y=pp(y,m.mode,b,null),y.return=m,y;b2(m,y)}return null}function f(m,y,b,S){var x=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return x!==null?null:s(m,y,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case u2:return b.key===x?u(m,y,b,S):null;case lm:return b.key===x?l(m,y,b,S):null;case Zd:return x=b._init,f(m,y,x(b._payload),S)}if(uy(b)||g0(b))return x!==null?null:c(m,y,b,S,null);b2(m,b)}return null}function h(m,y,b,S,x){if(typeof S=="string"&&S!==""||typeof S=="number")return m=m.get(b)||null,s(y,m,""+S,x);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case u2:return m=m.get(S.key===null?b:S.key)||null,u(y,m,S,x);case lm:return m=m.get(S.key===null?b:S.key)||null,l(y,m,S,x);case Zd:var C=S._init;return h(m,y,b,C(S._payload),x)}if(uy(S)||g0(S))return m=m.get(b)||null,c(y,m,S,x,null);b2(y,S)}return null}function v(m,y,b,S){for(var x=null,C=null,w=y,A=y=0,I=null;w!==null&&A<b.length;A++){w.index>A?(I=w,w=null):I=w.sibling;var D=f(m,w,b[A],S);if(D===null){w===null&&(w=I);break}e&&w&&D.alternate===null&&t(m,w),y=i(D,y,A),C===null?x=D:C.sibling=D,C=D,w=I}if(A===b.length)return r(m,w),ra&&Hh(m,A),x;if(w===null){for(;A<b.length;A++)w=d(m,b[A],S),w!==null&&(y=i(w,y,A),C===null?x=w:C.sibling=w,C=w);return ra&&Hh(m,A),x}for(w=n(m,w);A<b.length;A++)I=h(w,m,A,b[A],S),I!==null&&(e&&I.alternate!==null&&w.delete(I.key===null?A:I.key),y=i(I,y,A),C===null?x=I:C.sibling=I,C=I);return e&&w.forEach(function(k){return t(m,k)}),ra&&Hh(m,A),x}function p(m,y,b,S){var x=g0(b);if(typeof x!="function")throw Error(Tt(150));if(b=x.call(b),b==null)throw Error(Tt(151));for(var C=x=null,w=y,A=y=0,I=null,D=b.next();w!==null&&!D.done;A++,D=b.next()){w.index>A?(I=w,w=null):I=w.sibling;var k=f(m,w,D.value,S);if(k===null){w===null&&(w=I);break}e&&w&&k.alternate===null&&t(m,w),y=i(k,y,A),C===null?x=k:C.sibling=k,C=k,w=I}if(D.done)return r(m,w),ra&&Hh(m,A),x;if(w===null){for(;!D.done;A++,D=b.next())D=d(m,D.value,S),D!==null&&(y=i(D,y,A),C===null?x=D:C.sibling=D,C=D);return ra&&Hh(m,A),x}for(w=n(m,w);!D.done;A++,D=b.next())D=h(w,m,A,D.value,S),D!==null&&(e&&D.alternate!==null&&w.delete(D.key===null?A:D.key),y=i(D,y,A),C===null?x=D:C.sibling=D,C=D);return e&&w.forEach(function(R){return t(m,R)}),ra&&Hh(m,A),x}function g(m,y,b,S){if(typeof b=="object"&&b!==null&&b.type===cm&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case u2:e:{for(var x=b.key,C=y;C!==null;){if(C.key===x){if(x=b.type,x===cm){if(C.tag===7){r(m,C.sibling),y=a(C,b.props.children),y.return=m,m=y;break e}}else if(C.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===Zd&&ZN(x)===C.type){r(m,C.sibling),y=a(C,b.props),y.ref=C0(m,C,b),y.return=m,m=y;break e}r(m,C);break}else t(m,C);C=C.sibling}b.type===cm?(y=pp(b.props.children,m.mode,S,b.key),y.return=m,m=y):(S=Zx(b.type,b.key,b.props,null,m.mode,S),S.ref=C0(m,y,b),S.return=m,m=S)}return o(m);case lm:e:{for(C=b.key;y!==null;){if(y.key===C)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){r(m,y.sibling),y=a(y,b.children||[]),y.return=m,m=y;break e}else{r(m,y);break}else t(m,y);y=y.sibling}y=iA(b,m.mode,S),y.return=m,m=y}return o(m);case Zd:return C=b._init,g(m,y,C(b._payload),S)}if(uy(b))return v(m,y,b,S);if(g0(b))return p(m,y,b,S);b2(m,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,y!==null&&y.tag===6?(r(m,y.sibling),y=a(y,b),y.return=m,m=y):(r(m,y),y=aA(b,m.mode,S),y.return=m,m=y),o(m)):r(m,y)}return g}var ug=$H(!0),XH=$H(!1),hb={},Cl=ch(hb),y1=ch(hb),b1=ch(hb);function ap(e){if(e===hb)throw Error(Tt(174));return e}function j5(e,t){switch(Bn(b1,t),Bn(y1,e),Bn(Cl,hb),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:f4(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=f4(t,e)}$n(Cl),Bn(Cl,t)}function lg(){$n(Cl),$n(y1),$n(b1)}function YH(e){ap(b1.current);var t=ap(Cl.current),r=f4(t,e.type);t!==r&&(Bn(y1,e),Bn(Cl,r))}function z5(e){y1.current===e&&($n(Cl),$n(y1))}var oa=ch(0);function qS(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ZE=[];function V5(){for(var e=0;e<ZE.length;e++)ZE[e]._workInProgressVersionPrimary=null;ZE.length=0}var $x=od.ReactCurrentDispatcher,JE=od.ReactCurrentBatchConfig,Tp=0,la=null,za=null,ni=null,WS=!1,Oy=!1,x1=0,toe=0;function _i(){throw Error(Tt(321))}function H5(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Lu(e[r],t[r]))return!1;return!0}function G5(e,t,r,n,a,i){if(Tp=i,la=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,$x.current=e===null||e.memoizedState===null?ioe:ooe,e=r(n,a),Oy){i=0;do{if(Oy=!1,x1=0,25<=i)throw Error(Tt(301));i+=1,ni=za=null,t.updateQueue=null,$x.current=soe,e=r(n,a)}while(Oy)}if($x.current=$S,t=za!==null&&za.next!==null,Tp=0,ni=za=la=null,WS=!1,t)throw Error(Tt(300));return e}function q5(){var e=x1!==0;return x1=0,e}function ol(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ni===null?la.memoizedState=ni=e:ni=ni.next=e,ni}function Vs(){if(za===null){var e=la.alternate;e=e!==null?e.memoizedState:null}else e=za.next;var t=ni===null?la.memoizedState:ni.next;if(t!==null)ni=t,za=e;else{if(e===null)throw Error(Tt(310));za=e,e={memoizedState:za.memoizedState,baseState:za.baseState,baseQueue:za.baseQueue,queue:za.queue,next:null},ni===null?la.memoizedState=ni=e:ni=ni.next=e}return ni}function S1(e,t){return typeof t=="function"?t(e):t}function eA(e){var t=Vs(),r=t.queue;if(r===null)throw Error(Tt(311));r.lastRenderedReducer=e;var n=za,a=n.baseQueue,i=r.pending;if(i!==null){if(a!==null){var o=a.next;a.next=i.next,i.next=o}n.baseQueue=a=i,r.pending=null}if(a!==null){i=a.next,n=n.baseState;var s=o=null,u=null,l=i;do{var c=l.lane;if((Tp&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:e(n,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=d,o=n):u=u.next=d,la.lanes|=c,Ip|=c}l=l.next}while(l!==null&&l!==i);u===null?o=n:u.next=s,Lu(n,t.memoizedState)||(xo=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=u,r.lastRenderedState=n}if(e=r.interleaved,e!==null){a=e;do i=a.lane,la.lanes|=i,Ip|=i,a=a.next;while(a!==e)}else a===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function tA(e){var t=Vs(),r=t.queue;if(r===null)throw Error(Tt(311));r.lastRenderedReducer=e;var n=r.dispatch,a=r.pending,i=t.memoizedState;if(a!==null){r.pending=null;var o=a=a.next;do i=e(i,o.action),o=o.next;while(o!==a);Lu(i,t.memoizedState)||(xo=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function KH(){}function QH(e,t){var r=la,n=Vs(),a=t(),i=!Lu(n.memoizedState,a);if(i&&(n.memoizedState=a,xo=!0),n=n.queue,W5(eG.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||ni!==null&&ni.memoizedState.tag&1){if(r.flags|=2048,C1(9,JH.bind(null,r,n,a,t),void 0,null),ii===null)throw Error(Tt(349));Tp&30||ZH(r,t,a)}return a}function ZH(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=la.updateQueue,t===null?(t={lastEffect:null,stores:null},la.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function JH(e,t,r,n){t.value=r,t.getSnapshot=n,tG(t)&&rG(e)}function eG(e,t,r){return r(function(){tG(t)&&rG(e)})}function tG(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Lu(e,r)}catch{return!0}}function rG(e){var t=Fc(e,1);t!==null&&_u(t,e,1,-1)}function JN(e){var t=ol();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:S1,lastRenderedState:e},t.queue=e,e=e.dispatch=aoe.bind(null,la,e),[t.memoizedState,e]}function C1(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=la.updateQueue,t===null?(t={lastEffect:null,stores:null},la.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function nG(){return Vs().memoizedState}function Xx(e,t,r,n){var a=ol();la.flags|=e,a.memoizedState=C1(1|t,r,void 0,n===void 0?null:n)}function ow(e,t,r,n){var a=Vs();n=n===void 0?null:n;var i=void 0;if(za!==null){var o=za.memoizedState;if(i=o.destroy,n!==null&&H5(n,o.deps)){a.memoizedState=C1(t,r,i,n);return}}la.flags|=e,a.memoizedState=C1(1|t,r,i,n)}function eF(e,t){return Xx(8390656,8,e,t)}function W5(e,t){return ow(2048,8,e,t)}function aG(e,t){return ow(4,2,e,t)}function iG(e,t){return ow(4,4,e,t)}function oG(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function sG(e,t,r){return r=r!=null?r.concat([e]):null,ow(4,4,oG.bind(null,t,e),r)}function $5(){}function uG(e,t){var r=Vs();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&H5(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function lG(e,t){var r=Vs();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&H5(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function cG(e,t,r){return Tp&21?(Lu(r,t)||(r=hH(),la.lanes|=r,Ip|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,xo=!0),e.memoizedState=r)}function roe(e,t){var r=_n;_n=r!==0&&4>r?r:4,e(!0);var n=JE.transition;JE.transition={};try{e(!1),t()}finally{_n=r,JE.transition=n}}function dG(){return Vs().memoizedState}function noe(e,t,r){var n=Of(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},fG(e))hG(t,r);else if(r=HH(e,t,r,n),r!==null){var a=Zi();_u(r,e,n,a),pG(r,t,n)}}function aoe(e,t,r){var n=Of(e),a={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(fG(e))hG(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var o=t.lastRenderedState,s=i(o,r);if(a.hasEagerState=!0,a.eagerState=s,Lu(s,o)){var u=t.interleaved;u===null?(a.next=a,B5(t)):(a.next=u.next,u.next=a),t.interleaved=a;return}}catch{}finally{}r=HH(e,t,a,n),r!==null&&(a=Zi(),_u(r,e,n,a),pG(r,t,n))}}function fG(e){var t=e.alternate;return e===la||t!==null&&t===la}function hG(e,t){Oy=WS=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function pG(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,w5(e,r)}}var $S={readContext:zs,useCallback:_i,useContext:_i,useEffect:_i,useImperativeHandle:_i,useInsertionEffect:_i,useLayoutEffect:_i,useMemo:_i,useReducer:_i,useRef:_i,useState:_i,useDebugValue:_i,useDeferredValue:_i,useTransition:_i,useMutableSource:_i,useSyncExternalStore:_i,useId:_i,unstable_isNewReconciler:!1},ioe={readContext:zs,useCallback:function(e,t){return ol().memoizedState=[e,t===void 0?null:t],e},useContext:zs,useEffect:eF,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Xx(4194308,4,oG.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Xx(4194308,4,e,t)},useInsertionEffect:function(e,t){return Xx(4,2,e,t)},useMemo:function(e,t){var r=ol();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=ol();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=noe.bind(null,la,e),[n.memoizedState,e]},useRef:function(e){var t=ol();return e={current:e},t.memoizedState=e},useState:JN,useDebugValue:$5,useDeferredValue:function(e){return ol().memoizedState=e},useTransition:function(){var e=JN(!1),t=e[0];return e=roe.bind(null,e[1]),ol().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=la,a=ol();if(ra){if(r===void 0)throw Error(Tt(407));r=r()}else{if(r=t(),ii===null)throw Error(Tt(349));Tp&30||ZH(n,t,r)}a.memoizedState=r;var i={value:r,getSnapshot:t};return a.queue=i,eF(eG.bind(null,n,i,e),[e]),n.flags|=2048,C1(9,JH.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=ol(),t=ii.identifierPrefix;if(ra){var r=gc,n=mc;r=(n&~(1<<32-Cu(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=x1++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=toe++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ooe={readContext:zs,useCallback:uG,useContext:zs,useEffect:W5,useImperativeHandle:sG,useInsertionEffect:aG,useLayoutEffect:iG,useMemo:lG,useReducer:eA,useRef:nG,useState:function(){return eA(S1)},useDebugValue:$5,useDeferredValue:function(e){var t=Vs();return cG(t,za.memoizedState,e)},useTransition:function(){var e=eA(S1)[0],t=Vs().memoizedState;return[e,t]},useMutableSource:KH,useSyncExternalStore:QH,useId:dG,unstable_isNewReconciler:!1},soe={readContext:zs,useCallback:uG,useContext:zs,useEffect:W5,useImperativeHandle:sG,useInsertionEffect:aG,useLayoutEffect:iG,useMemo:lG,useReducer:tA,useRef:nG,useState:function(){return tA(S1)},useDebugValue:$5,useDeferredValue:function(e){var t=Vs();return za===null?t.memoizedState=e:cG(t,za.memoizedState,e)},useTransition:function(){var e=tA(S1)[0],t=Vs().memoizedState;return[e,t]},useMutableSource:KH,useSyncExternalStore:QH,useId:dG,unstable_isNewReconciler:!1};function cg(e,t){try{var r="",n=t;do r+=Lae(n),n=n.return;while(n);var a=r}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function rA(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function L4(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var uoe=typeof WeakMap=="function"?WeakMap:Map;function vG(e,t,r){r=Ac(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){YS||(YS=!0,q4=n),L4(e,t)},r}function mG(e,t,r){r=Ac(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var a=t.value;r.payload=function(){return n(a)},r.callback=function(){L4(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){L4(e,t),typeof n!="function"&&(kf===null?kf=new Set([this]):kf.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function tF(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new uoe;var a=new Set;n.set(t,a)}else a=n.get(t),a===void 0&&(a=new Set,n.set(t,a));a.has(r)||(a.add(r),e=Coe.bind(null,e,t,r),t.then(e,e))}function rF(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function nF(e,t,r,n,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Ac(-1,1),t.tag=2,Rf(r,t,1))),r.lanes|=1),e)}var loe=od.ReactCurrentOwner,xo=!1;function Yi(e,t,r,n){t.child=e===null?XH(t,null,r,n):ug(t,e.child,r,n)}function aF(e,t,r,n,a){r=r.render;var i=t.ref;return Bm(t,a),n=G5(e,t,r,n,i,a),r=q5(),e!==null&&!xo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Bc(e,t,a)):(ra&&r&&R5(t),t.flags|=1,Yi(e,t,n,a),t.child)}function iF(e,t,r,n,a){if(e===null){var i=r.type;return typeof i=="function"&&!tR(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,gG(e,t,i,n,a)):(e=Zx(r.type,null,n,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var o=i.memoizedProps;if(r=r.compare,r=r!==null?r:p1,r(o,n)&&e.ref===t.ref)return Bc(e,t,a)}return t.flags|=1,e=Lf(i,n),e.ref=t.ref,e.return=t,t.child=e}function gG(e,t,r,n,a){if(e!==null){var i=e.memoizedProps;if(p1(i,n)&&e.ref===t.ref)if(xo=!1,t.pendingProps=n=i,(e.lanes&a)!==0)e.flags&131072&&(xo=!0);else return t.lanes=e.lanes,Bc(e,t,a)}return N4(e,t,r,n,a)}function yG(e,t,r){var n=t.pendingProps,a=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Bn(xm,Uo),Uo|=r;else{if(!(r&1073741824))return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Bn(xm,Uo),Uo|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,Bn(xm,Uo),Uo|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,Bn(xm,Uo),Uo|=n;return Yi(e,t,a,r),t.child}function bG(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function N4(e,t,r,n,a){var i=Co(r)?Ap:Ni.current;return i=og(t,i),Bm(t,a),r=G5(e,t,r,n,i,a),n=q5(),e!==null&&!xo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Bc(e,t,a)):(ra&&n&&R5(t),t.flags|=1,Yi(e,t,r,a),t.child)}function oF(e,t,r,n,a){if(Co(r)){var i=!0;US(t)}else i=!1;if(Bm(t,a),t.stateNode===null)Yx(e,t),WH(t,r,n),O4(t,r,n,a),n=!0;else if(e===null){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=r.contextType;typeof l=="object"&&l!==null?l=zs(l):(l=Co(r)?Ap:Ni.current,l=og(t,l));var c=r.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==n||u!==l)&&QN(t,o,n,l),Jd=!1;var f=t.memoizedState;o.state=f,GS(t,n,o,a),u=t.memoizedState,s!==n||f!==u||So.current||Jd?(typeof c=="function"&&(k4(t,r,c,n),u=t.memoizedState),(s=Jd||KN(t,r,s,n,f,u,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=u),o.props=n,o.state=u,o.context=l,n=s):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,GH(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:lu(t.type,s),o.props=l,d=t.pendingProps,f=o.context,u=r.contextType,typeof u=="object"&&u!==null?u=zs(u):(u=Co(r)?Ap:Ni.current,u=og(t,u));var h=r.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==d||f!==u)&&QN(t,o,n,u),Jd=!1,f=t.memoizedState,o.state=f,GS(t,n,o,a);var v=t.memoizedState;s!==d||f!==v||So.current||Jd?(typeof h=="function"&&(k4(t,r,h,n),v=t.memoizedState),(l=Jd||KN(t,r,l,n,f,v,u)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,v,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,v,u)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=v),o.props=n,o.state=v,o.context=u,n=l):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),n=!1)}return F4(e,t,r,n,i,a)}function F4(e,t,r,n,a,i){bG(e,t);var o=(t.flags&128)!==0;if(!n&&!o)return a&&qN(t,r,!1),Bc(e,t,i);n=t.stateNode,loe.current=t;var s=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=ug(t,e.child,null,i),t.child=ug(t,null,s,i)):Yi(e,t,s,i),t.memoizedState=n.state,a&&qN(t,r,!0),t.child}function xG(e){var t=e.stateNode;t.pendingContext?GN(e,t.pendingContext,t.pendingContext!==t.context):t.context&&GN(e,t.context,!1),j5(e,t.containerInfo)}function sF(e,t,r,n,a){return sg(),O5(a),t.flags|=256,Yi(e,t,r,n),t.child}var B4={dehydrated:null,treeContext:null,retryLane:0};function U4(e){return{baseLanes:e,cachePool:null,transitions:null}}function SG(e,t,r){var n=t.pendingProps,a=oa.current,i=!1,o=(t.flags&128)!==0,s;if((s=o)||(s=e!==null&&e.memoizedState===null?!1:(a&2)!==0),s?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Bn(oa,a&1),e===null)return D4(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=n.children,e=n.fallback,i?(n=t.mode,i=t.child,o={mode:"hidden",children:o},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=lw(o,n,0,null),e=pp(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=U4(r),t.memoizedState=B4,e):X5(t,o));if(a=e.memoizedState,a!==null&&(s=a.dehydrated,s!==null))return coe(e,t,o,n,s,a,r);if(i){i=n.fallback,o=t.mode,a=e.child,s=a.sibling;var u={mode:"hidden",children:n.children};return!(o&1)&&t.child!==a?(n=t.child,n.childLanes=0,n.pendingProps=u,t.deletions=null):(n=Lf(a,u),n.subtreeFlags=a.subtreeFlags&14680064),s!==null?i=Lf(s,i):(i=pp(i,o,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,o=e.child.memoizedState,o=o===null?U4(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=e.childLanes&~r,t.memoizedState=B4,n}return i=e.child,e=i.sibling,n=Lf(i,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function X5(e,t){return t=lw({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function x2(e,t,r,n){return n!==null&&O5(n),ug(t,e.child,null,r),e=X5(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function coe(e,t,r,n,a,i,o){if(r)return t.flags&256?(t.flags&=-257,n=rA(Error(Tt(422))),x2(e,t,o,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,a=t.mode,n=lw({mode:"visible",children:n.children},a,0,null),i=pp(i,a,o,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,t.mode&1&&ug(t,e.child,null,o),t.child.memoizedState=U4(o),t.memoizedState=B4,i);if(!(t.mode&1))return x2(e,t,o,null);if(a.data==="$!"){if(n=a.nextSibling&&a.nextSibling.dataset,n)var s=n.dgst;return n=s,i=Error(Tt(419)),n=rA(i,n,void 0),x2(e,t,o,n)}if(s=(o&e.childLanes)!==0,xo||s){if(n=ii,n!==null){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(n.suspendedLanes|o)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Fc(e,a),_u(n,e,a,-1))}return eR(),n=rA(Error(Tt(421))),x2(e,t,o,n)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=_oe.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,Go=Df(a.nextSibling),Xo=t,ra=!0,pu=null,e!==null&&(Ds[Rs++]=mc,Ds[Rs++]=gc,Ds[Rs++]=Pp,mc=e.id,gc=e.overflow,Pp=t),t=X5(t,n.children),t.flags|=4096,t)}function uF(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),R4(e.return,t,r)}function nA(e,t,r,n,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=a)}function CG(e,t,r){var n=t.pendingProps,a=n.revealOrder,i=n.tail;if(Yi(e,t,n.children,r),n=oa.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&uF(e,r,t);else if(e.tag===19)uF(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Bn(oa,n),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;r!==null;)e=r.alternate,e!==null&&qS(e)===null&&(a=r),r=r.sibling;r=a,r===null?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),nA(t,!1,a,r,i);break;case"backwards":for(r=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&qS(e)===null){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}nA(t,!0,r,null,i);break;case"together":nA(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Yx(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Bc(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Ip|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Tt(153));if(t.child!==null){for(e=t.child,r=Lf(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Lf(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function doe(e,t,r){switch(t.tag){case 3:xG(t),sg();break;case 5:YH(t);break;case 1:Co(t.type)&&US(t);break;case 4:j5(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,a=t.memoizedProps.value;Bn(VS,n._currentValue),n._currentValue=a;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Bn(oa,oa.current&1),t.flags|=128,null):r&t.child.childLanes?SG(e,t,r):(Bn(oa,oa.current&1),e=Bc(e,t,r),e!==null?e.sibling:null);Bn(oa,oa.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return CG(e,t,r);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Bn(oa,oa.current),n)break;return null;case 22:case 23:return t.lanes=0,yG(e,t,r)}return Bc(e,t,r)}var _G,j4,wG,EG;_G=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};j4=function(){};wG=function(e,t,r,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,ap(Cl.current);var i=null;switch(r){case"input":a=u4(e,a),n=u4(e,n),i=[];break;case"select":a=da({},a,{value:void 0}),n=da({},n,{value:void 0}),i=[];break;case"textarea":a=d4(e,a),n=d4(e,n),i=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=FS)}h4(r,n);var o;r=null;for(l in a)if(!n.hasOwnProperty(l)&&a.hasOwnProperty(l)&&a[l]!=null)if(l==="style"){var s=a[l];for(o in s)s.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(s1.hasOwnProperty(l)?i||(i=[]):(i=i||[]).push(l,null));for(l in n){var u=n[l];if(s=a!=null?a[l]:void 0,n.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(o in s)!s.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in u)u.hasOwnProperty(o)&&s[o]!==u[o]&&(r||(r={}),r[o]=u[o])}else r||(i||(i=[]),i.push(l,r)),r=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(i=i||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(s1.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&Vn("scroll",e),i||s===u||(i=[])):(i=i||[]).push(l,u))}r&&(i=i||[]).push("style",r);var l=i;(t.updateQueue=l)&&(t.flags|=4)}};EG=function(e,t,r,n){r!==n&&(t.flags|=4)};function _0(e,t){if(!ra)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function wi(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags&14680064,n|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function foe(e,t,r){var n=t.pendingProps;switch(k5(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wi(t),null;case 1:return Co(t.type)&&BS(),wi(t),null;case 3:return n=t.stateNode,lg(),$n(So),$n(Ni),V5(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(y2(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,pu!==null&&(X4(pu),pu=null))),j4(e,t),wi(t),null;case 5:z5(t);var a=ap(b1.current);if(r=t.type,e!==null&&t.stateNode!=null)wG(e,t,r,n,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Tt(166));return wi(t),null}if(e=ap(Cl.current),y2(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[pl]=t,n[g1]=i,e=(t.mode&1)!==0,r){case"dialog":Vn("cancel",n),Vn("close",n);break;case"iframe":case"object":case"embed":Vn("load",n);break;case"video":case"audio":for(a=0;a<cy.length;a++)Vn(cy[a],n);break;case"source":Vn("error",n);break;case"img":case"image":case"link":Vn("error",n),Vn("load",n);break;case"details":Vn("toggle",n);break;case"input":gN(n,i),Vn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Vn("invalid",n);break;case"textarea":bN(n,i),Vn("invalid",n)}h4(r,i),a=null;for(var o in i)if(i.hasOwnProperty(o)){var s=i[o];o==="children"?typeof s=="string"?n.textContent!==s&&(i.suppressHydrationWarning!==!0&&g2(n.textContent,s,e),a=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(i.suppressHydrationWarning!==!0&&g2(n.textContent,s,e),a=["children",""+s]):s1.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&Vn("scroll",n)}switch(r){case"input":l2(n),yN(n,i,!0);break;case"textarea":l2(n),xN(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=FS)}n=a,t.updateQueue=n,n!==null&&(t.flags|=4)}else{o=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=ZV(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(r,{is:n.is}):(e=o.createElement(r),r==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,r),e[pl]=t,e[g1]=n,_G(e,t,!1,!1),t.stateNode=e;e:{switch(o=p4(r,n),r){case"dialog":Vn("cancel",e),Vn("close",e),a=n;break;case"iframe":case"object":case"embed":Vn("load",e),a=n;break;case"video":case"audio":for(a=0;a<cy.length;a++)Vn(cy[a],e);a=n;break;case"source":Vn("error",e),a=n;break;case"img":case"image":case"link":Vn("error",e),Vn("load",e),a=n;break;case"details":Vn("toggle",e),a=n;break;case"input":gN(e,n),a=u4(e,n),Vn("invalid",e);break;case"option":a=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=da({},n,{value:void 0}),Vn("invalid",e);break;case"textarea":bN(e,n),a=d4(e,n),Vn("invalid",e);break;default:a=n}h4(r,a),s=a;for(i in s)if(s.hasOwnProperty(i)){var u=s[i];i==="style"?tH(e,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&JV(e,u)):i==="children"?typeof u=="string"?(r!=="textarea"||u!=="")&&u1(e,u):typeof u=="number"&&u1(e,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(s1.hasOwnProperty(i)?u!=null&&i==="onScroll"&&Vn("scroll",e):u!=null&&y5(e,i,u,o))}switch(r){case"input":l2(e),yN(e,n,!1);break;case"textarea":l2(e),xN(e);break;case"option":n.value!=null&&e.setAttribute("value",""+qf(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?Om(e,!!n.multiple,i,!1):n.defaultValue!=null&&Om(e,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=FS)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return wi(t),null;case 6:if(e&&t.stateNode!=null)EG(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Tt(166));if(r=ap(b1.current),ap(Cl.current),y2(t)){if(n=t.stateNode,r=t.memoizedProps,n[pl]=t,(i=n.nodeValue!==r)&&(e=Xo,e!==null))switch(e.tag){case 3:g2(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&g2(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[pl]=t,t.stateNode=n}return wi(t),null;case 13:if($n(oa),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ra&&Go!==null&&t.mode&1&&!(t.flags&128))VH(),sg(),t.flags|=98560,i=!1;else if(i=y2(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(Tt(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Tt(317));i[pl]=t}else sg(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;wi(t),i=!1}else pu!==null&&(X4(pu),pu=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||oa.current&1?Ha===0&&(Ha=3):eR())),t.updateQueue!==null&&(t.flags|=4),wi(t),null);case 4:return lg(),j4(e,t),e===null&&v1(t.stateNode.containerInfo),wi(t),null;case 10:return F5(t.type._context),wi(t),null;case 17:return Co(t.type)&&BS(),wi(t),null;case 19:if($n(oa),i=t.memoizedState,i===null)return wi(t),null;if(n=(t.flags&128)!==0,o=i.rendering,o===null)if(n)_0(i,!1);else{if(Ha!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=qS(e),o!==null){for(t.flags|=128,_0(i,!1),n=o.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Bn(oa,oa.current&1|2),t.child}e=e.sibling}i.tail!==null&&_a()>dg&&(t.flags|=128,n=!0,_0(i,!1),t.lanes=4194304)}else{if(!n)if(e=qS(o),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),_0(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!ra)return wi(t),null}else 2*_a()-i.renderingStartTime>dg&&r!==1073741824&&(t.flags|=128,n=!0,_0(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(r=i.last,r!==null?r.sibling=o:t.child=o,i.last=o)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=_a(),t.sibling=null,r=oa.current,Bn(oa,n?r&1|2:r&1),t):(wi(t),null);case 22:case 23:return J5(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Uo&1073741824&&(wi(t),t.subtreeFlags&6&&(t.flags|=8192)):wi(t),null;case 24:return null;case 25:return null}throw Error(Tt(156,t.tag))}function hoe(e,t){switch(k5(t),t.tag){case 1:return Co(t.type)&&BS(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return lg(),$n(So),$n(Ni),V5(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return z5(t),null;case 13:if($n(oa),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Tt(340));sg()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return $n(oa),null;case 4:return lg(),null;case 10:return F5(t.type._context),null;case 22:case 23:return J5(),null;case 24:return null;default:return null}}var S2=!1,Mi=!1,poe=typeof WeakSet=="function"?WeakSet:Set,Ht=null;function bm(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){ga(e,t,n)}else r.current=null}function z4(e,t,r){try{r()}catch(n){ga(e,t,n)}}var lF=!1;function voe(e,t){if(w4=OS,e=IH(),D5(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var a=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var o=0,s=-1,u=-1,l=0,c=0,d=e,f=null;t:for(;;){for(var h;d!==r||a!==0&&d.nodeType!==3||(s=o+a),d!==i||n!==0&&d.nodeType!==3||(u=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===e)break t;if(f===r&&++l===a&&(s=o),f===i&&++c===n&&(u=o),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}r=s===-1||u===-1?null:{start:s,end:u}}else r=null}r=r||{start:0,end:0}}else r=null;for(E4={focusedElem:e,selectionRange:r},OS=!1,Ht=t;Ht!==null;)if(t=Ht,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ht=e;else for(;Ht!==null;){t=Ht;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var p=v.memoizedProps,g=v.memoizedState,m=t.stateNode,y=m.getSnapshotBeforeUpdate(t.elementType===t.type?p:lu(t.type,p),g);m.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Tt(163))}}catch(S){ga(t,t.return,S)}if(e=t.sibling,e!==null){e.return=t.return,Ht=e;break}Ht=t.return}return v=lF,lF=!1,v}function Ly(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&z4(t,r,i)}a=a.next}while(a!==n)}}function sw(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function V4(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function AG(e){var t=e.alternate;t!==null&&(e.alternate=null,AG(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[pl],delete t[g1],delete t[T4],delete t[Qie],delete t[Zie])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function PG(e){return e.tag===5||e.tag===3||e.tag===4}function cF(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||PG(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function H4(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=FS));else if(n!==4&&(e=e.child,e!==null))for(H4(e,t,r),e=e.sibling;e!==null;)H4(e,t,r),e=e.sibling}function G4(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(G4(e,t,r),e=e.sibling;e!==null;)G4(e,t,r),e=e.sibling}var di=null,fu=!1;function Md(e,t,r){for(r=r.child;r!==null;)TG(e,t,r),r=r.sibling}function TG(e,t,r){if(Sl&&typeof Sl.onCommitFiberUnmount=="function")try{Sl.onCommitFiberUnmount(J_,r)}catch{}switch(r.tag){case 5:Mi||bm(r,t);case 6:var n=di,a=fu;di=null,Md(e,t,r),di=n,fu=a,di!==null&&(fu?(e=di,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):di.removeChild(r.stateNode));break;case 18:di!==null&&(fu?(e=di,r=r.stateNode,e.nodeType===8?KE(e.parentNode,r):e.nodeType===1&&KE(e,r),f1(e)):KE(di,r.stateNode));break;case 4:n=di,a=fu,di=r.stateNode.containerInfo,fu=!0,Md(e,t,r),di=n,fu=a;break;case 0:case 11:case 14:case 15:if(!Mi&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){a=n=n.next;do{var i=a,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&z4(r,t,o),a=a.next}while(a!==n)}Md(e,t,r);break;case 1:if(!Mi&&(bm(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){ga(r,t,s)}Md(e,t,r);break;case 21:Md(e,t,r);break;case 22:r.mode&1?(Mi=(n=Mi)||r.memoizedState!==null,Md(e,t,r),Mi=n):Md(e,t,r);break;default:Md(e,t,r)}}function dF(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new poe),t.forEach(function(n){var a=woe.bind(null,e,n);r.has(n)||(r.add(n),n.then(a,a))})}}function au(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var a=r[n];try{var i=e,o=t,s=o;e:for(;s!==null;){switch(s.tag){case 5:di=s.stateNode,fu=!1;break e;case 3:di=s.stateNode.containerInfo,fu=!0;break e;case 4:di=s.stateNode.containerInfo,fu=!0;break e}s=s.return}if(di===null)throw Error(Tt(160));TG(i,o,a),di=null,fu=!1;var u=a.alternate;u!==null&&(u.return=null),a.return=null}catch(l){ga(a,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)IG(t,e),t=t.sibling}function IG(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(au(t,e),Ku(e),n&4){try{Ly(3,e,e.return),sw(3,e)}catch(p){ga(e,e.return,p)}try{Ly(5,e,e.return)}catch(p){ga(e,e.return,p)}}break;case 1:au(t,e),Ku(e),n&512&&r!==null&&bm(r,r.return);break;case 5:if(au(t,e),Ku(e),n&512&&r!==null&&bm(r,r.return),e.flags&32){var a=e.stateNode;try{u1(a,"")}catch(p){ga(e,e.return,p)}}if(n&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,o=r!==null?r.memoizedProps:i,s=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{s==="input"&&i.type==="radio"&&i.name!=null&&KV(a,i),p4(s,o);var l=p4(s,i);for(o=0;o<u.length;o+=2){var c=u[o],d=u[o+1];c==="style"?tH(a,d):c==="dangerouslySetInnerHTML"?JV(a,d):c==="children"?u1(a,d):y5(a,c,d,l)}switch(s){case"input":l4(a,i);break;case"textarea":QV(a,i);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var h=i.value;h!=null?Om(a,!!i.multiple,h,!1):f!==!!i.multiple&&(i.defaultValue!=null?Om(a,!!i.multiple,i.defaultValue,!0):Om(a,!!i.multiple,i.multiple?[]:"",!1))}a[g1]=i}catch(p){ga(e,e.return,p)}}break;case 6:if(au(t,e),Ku(e),n&4){if(e.stateNode===null)throw Error(Tt(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(p){ga(e,e.return,p)}}break;case 3:if(au(t,e),Ku(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{f1(t.containerInfo)}catch(p){ga(e,e.return,p)}break;case 4:au(t,e),Ku(e);break;case 13:au(t,e),Ku(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(Q5=_a())),n&4&&dF(e);break;case 22:if(c=r!==null&&r.memoizedState!==null,e.mode&1?(Mi=(l=Mi)||c,au(t,e),Mi=l):au(t,e),Ku(e),n&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!c&&e.mode&1)for(Ht=e,c=e.child;c!==null;){for(d=Ht=c;Ht!==null;){switch(f=Ht,h=f.child,f.tag){case 0:case 11:case 14:case 15:Ly(4,f,f.return);break;case 1:bm(f,f.return);var v=f.stateNode;if(typeof v.componentWillUnmount=="function"){n=f,r=f.return;try{t=n,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(p){ga(n,r,p)}}break;case 5:bm(f,f.return);break;case 22:if(f.memoizedState!==null){hF(d);continue}}h!==null?(h.return=f,Ht=h):hF(d)}c=c.sibling}e:for(c=null,d=e;;){if(d.tag===5){if(c===null){c=d;try{a=d.stateNode,l?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(s=d.stateNode,u=d.memoizedProps.style,o=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=eH("display",o))}catch(p){ga(e,e.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(p){ga(e,e.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:au(t,e),Ku(e),n&4&&dF(e);break;case 21:break;default:au(t,e),Ku(e)}}function Ku(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(PG(r)){var n=r;break e}r=r.return}throw Error(Tt(160))}switch(n.tag){case 5:var a=n.stateNode;n.flags&32&&(u1(a,""),n.flags&=-33);var i=cF(e);G4(e,i,a);break;case 3:case 4:var o=n.stateNode.containerInfo,s=cF(e);H4(e,s,o);break;default:throw Error(Tt(161))}}catch(u){ga(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function moe(e,t,r){Ht=e,MG(e)}function MG(e,t,r){for(var n=(e.mode&1)!==0;Ht!==null;){var a=Ht,i=a.child;if(a.tag===22&&n){var o=a.memoizedState!==null||S2;if(!o){var s=a.alternate,u=s!==null&&s.memoizedState!==null||Mi;s=S2;var l=Mi;if(S2=o,(Mi=u)&&!l)for(Ht=a;Ht!==null;)o=Ht,u=o.child,o.tag===22&&o.memoizedState!==null?pF(a):u!==null?(u.return=o,Ht=u):pF(a);for(;i!==null;)Ht=i,MG(i),i=i.sibling;Ht=a,S2=s,Mi=l}fF(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,Ht=i):fF(e)}}function fF(e){for(;Ht!==null;){var t=Ht;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Mi||sw(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Mi)if(r===null)n.componentDidMount();else{var a=t.elementType===t.type?r.memoizedProps:lu(t.type,r.memoizedProps);n.componentDidUpdate(a,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&YN(t,i,n);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}YN(t,o,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&r.focus();break;case"img":u.src&&(r.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&f1(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Tt(163))}Mi||t.flags&512&&V4(t)}catch(f){ga(t,t.return,f)}}if(t===e){Ht=null;break}if(r=t.sibling,r!==null){r.return=t.return,Ht=r;break}Ht=t.return}}function hF(e){for(;Ht!==null;){var t=Ht;if(t===e){Ht=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Ht=r;break}Ht=t.return}}function pF(e){for(;Ht!==null;){var t=Ht;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{sw(4,t)}catch(u){ga(t,r,u)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var a=t.return;try{n.componentDidMount()}catch(u){ga(t,a,u)}}var i=t.return;try{V4(t)}catch(u){ga(t,i,u)}break;case 5:var o=t.return;try{V4(t)}catch(u){ga(t,o,u)}}}catch(u){ga(t,t.return,u)}if(t===e){Ht=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Ht=s;break}Ht=t.return}}var goe=Math.ceil,XS=od.ReactCurrentDispatcher,Y5=od.ReactCurrentOwner,Bs=od.ReactCurrentBatchConfig,sn=0,ii=null,Oa=null,pi=0,Uo=0,xm=ch(0),Ha=0,_1=null,Ip=0,uw=0,K5=0,Ny=null,yo=null,Q5=0,dg=1/0,ic=null,YS=!1,q4=null,kf=null,C2=!1,bf=null,KS=0,Fy=0,W4=null,Kx=-1,Qx=0;function Zi(){return sn&6?_a():Kx!==-1?Kx:Kx=_a()}function Of(e){return e.mode&1?sn&2&&pi!==0?pi&-pi:eoe.transition!==null?(Qx===0&&(Qx=hH()),Qx):(e=_n,e!==0||(e=window.event,e=e===void 0?16:xH(e.type)),e):1}function _u(e,t,r,n){if(50<Fy)throw Fy=0,W4=null,Error(Tt(185));cb(e,r,n),(!(sn&2)||e!==ii)&&(e===ii&&(!(sn&2)&&(uw|=r),Ha===4&&nf(e,pi)),_o(e,n),r===1&&sn===0&&!(t.mode&1)&&(dg=_a()+500,aw&&dh()))}function _o(e,t){var r=e.callbackNode;eie(e,t);var n=kS(e,e===ii?pi:0);if(n===0)r!==null&&_N(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&_N(r),t===1)e.tag===0?Jie(vF.bind(null,e)):UH(vF.bind(null,e)),Yie(function(){!(sn&6)&&dh()}),r=null;else{switch(pH(n)){case 1:r=_5;break;case 4:r=dH;break;case 16:r=RS;break;case 536870912:r=fH;break;default:r=RS}r=BG(r,DG.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function DG(e,t){if(Kx=-1,Qx=0,sn&6)throw Error(Tt(327));var r=e.callbackNode;if(Um()&&e.callbackNode!==r)return null;var n=kS(e,e===ii?pi:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=QS(e,n);else{t=n;var a=sn;sn|=2;var i=kG();(ii!==e||pi!==t)&&(ic=null,dg=_a()+500,hp(e,t));do try{xoe();break}catch(s){RG(e,s)}while(1);N5(),XS.current=i,sn=a,Oa!==null?t=0:(ii=null,pi=0,t=Ha)}if(t!==0){if(t===2&&(a=b4(e),a!==0&&(n=a,t=$4(e,a))),t===1)throw r=_1,hp(e,0),nf(e,n),_o(e,_a()),r;if(t===6)nf(e,n);else{if(a=e.current.alternate,!(n&30)&&!yoe(a)&&(t=QS(e,n),t===2&&(i=b4(e),i!==0&&(n=i,t=$4(e,i))),t===1))throw r=_1,hp(e,0),nf(e,n),_o(e,_a()),r;switch(e.finishedWork=a,e.finishedLanes=n,t){case 0:case 1:throw Error(Tt(345));case 2:Gh(e,yo,ic);break;case 3:if(nf(e,n),(n&130023424)===n&&(t=Q5+500-_a(),10<t)){if(kS(e,0)!==0)break;if(a=e.suspendedLanes,(a&n)!==n){Zi(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=P4(Gh.bind(null,e,yo,ic),t);break}Gh(e,yo,ic);break;case 4:if(nf(e,n),(n&4194240)===n)break;for(t=e.eventTimes,a=-1;0<n;){var o=31-Cu(n);i=1<<o,o=t[o],o>a&&(a=o),n&=~i}if(n=a,n=_a()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*goe(n/1960))-n,10<n){e.timeoutHandle=P4(Gh.bind(null,e,yo,ic),n);break}Gh(e,yo,ic);break;case 5:Gh(e,yo,ic);break;default:throw Error(Tt(329))}}}return _o(e,_a()),e.callbackNode===r?DG.bind(null,e):null}function $4(e,t){var r=Ny;return e.current.memoizedState.isDehydrated&&(hp(e,t).flags|=256),e=QS(e,t),e!==2&&(t=yo,yo=r,t!==null&&X4(t)),e}function X4(e){yo===null?yo=e:yo.push.apply(yo,e)}function yoe(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var a=r[n],i=a.getSnapshot;a=a.value;try{if(!Lu(i(),a))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function nf(e,t){for(t&=~K5,t&=~uw,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Cu(t),n=1<<r;e[r]=-1,t&=~n}}function vF(e){if(sn&6)throw Error(Tt(327));Um();var t=kS(e,0);if(!(t&1))return _o(e,_a()),null;var r=QS(e,t);if(e.tag!==0&&r===2){var n=b4(e);n!==0&&(t=n,r=$4(e,n))}if(r===1)throw r=_1,hp(e,0),nf(e,t),_o(e,_a()),r;if(r===6)throw Error(Tt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Gh(e,yo,ic),_o(e,_a()),null}function Z5(e,t){var r=sn;sn|=1;try{return e(t)}finally{sn=r,sn===0&&(dg=_a()+500,aw&&dh())}}function Mp(e){bf!==null&&bf.tag===0&&!(sn&6)&&Um();var t=sn;sn|=1;var r=Bs.transition,n=_n;try{if(Bs.transition=null,_n=1,e)return e()}finally{_n=n,Bs.transition=r,sn=t,!(sn&6)&&dh()}}function J5(){Uo=xm.current,$n(xm)}function hp(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Xie(r)),Oa!==null)for(r=Oa.return;r!==null;){var n=r;switch(k5(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&BS();break;case 3:lg(),$n(So),$n(Ni),V5();break;case 5:z5(n);break;case 4:lg();break;case 13:$n(oa);break;case 19:$n(oa);break;case 10:F5(n.type._context);break;case 22:case 23:J5()}r=r.return}if(ii=e,Oa=e=Lf(e.current,null),pi=Uo=t,Ha=0,_1=null,K5=uw=Ip=0,yo=Ny=null,np!==null){for(t=0;t<np.length;t++)if(r=np[t],n=r.interleaved,n!==null){r.interleaved=null;var a=n.next,i=r.pending;if(i!==null){var o=i.next;i.next=a,n.next=o}r.pending=n}np=null}return e}function RG(e,t){do{var r=Oa;try{if(N5(),$x.current=$S,WS){for(var n=la.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}WS=!1}if(Tp=0,ni=za=la=null,Oy=!1,x1=0,Y5.current=null,r===null||r.return===null){Ha=1,_1=t,Oa=null;break}e:{var i=e,o=r.return,s=r,u=t;if(t=pi,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=rF(o);if(h!==null){h.flags&=-257,nF(h,o,s,i,t),h.mode&1&&tF(i,l,t),t=h,u=l;var v=t.updateQueue;if(v===null){var p=new Set;p.add(u),t.updateQueue=p}else v.add(u);break e}else{if(!(t&1)){tF(i,l,t),eR();break e}u=Error(Tt(426))}}else if(ra&&s.mode&1){var g=rF(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),nF(g,o,s,i,t),O5(cg(u,s));break e}}i=u=cg(u,s),Ha!==4&&(Ha=2),Ny===null?Ny=[i]:Ny.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var m=vG(i,u,t);XN(i,m);break e;case 1:s=u;var y=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(kf===null||!kf.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t;var S=mG(i,s,t);XN(i,S);break e}}i=i.return}while(i!==null)}LG(r)}catch(x){t=x,Oa===r&&r!==null&&(Oa=r=r.return);continue}break}while(1)}function kG(){var e=XS.current;return XS.current=$S,e===null?$S:e}function eR(){(Ha===0||Ha===3||Ha===2)&&(Ha=4),ii===null||!(Ip&268435455)&&!(uw&268435455)||nf(ii,pi)}function QS(e,t){var r=sn;sn|=2;var n=kG();(ii!==e||pi!==t)&&(ic=null,hp(e,t));do try{boe();break}catch(a){RG(e,a)}while(1);if(N5(),sn=r,XS.current=n,Oa!==null)throw Error(Tt(261));return ii=null,pi=0,Ha}function boe(){for(;Oa!==null;)OG(Oa)}function xoe(){for(;Oa!==null&&!qae();)OG(Oa)}function OG(e){var t=FG(e.alternate,e,Uo);e.memoizedProps=e.pendingProps,t===null?LG(e):Oa=t,Y5.current=null}function LG(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=hoe(r,t),r!==null){r.flags&=32767,Oa=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ha=6,Oa=null;return}}else if(r=foe(r,t,Uo),r!==null){Oa=r;return}if(t=t.sibling,t!==null){Oa=t;return}Oa=t=e}while(t!==null);Ha===0&&(Ha=5)}function Gh(e,t,r){var n=_n,a=Bs.transition;try{Bs.transition=null,_n=1,Soe(e,t,r,n)}finally{Bs.transition=a,_n=n}return null}function Soe(e,t,r,n){do Um();while(bf!==null);if(sn&6)throw Error(Tt(327));r=e.finishedWork;var a=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Tt(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(tie(e,i),e===ii&&(Oa=ii=null,pi=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||C2||(C2=!0,BG(RS,function(){return Um(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=Bs.transition,Bs.transition=null;var o=_n;_n=1;var s=sn;sn|=4,Y5.current=null,voe(e,r),IG(r,e),zie(E4),OS=!!w4,E4=w4=null,e.current=r,moe(r),Wae(),sn=s,_n=o,Bs.transition=i}else e.current=r;if(C2&&(C2=!1,bf=e,KS=a),i=e.pendingLanes,i===0&&(kf=null),Yae(r.stateNode),_o(e,_a()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)a=t[r],n(a.value,{componentStack:a.stack,digest:a.digest});if(YS)throw YS=!1,e=q4,q4=null,e;return KS&1&&e.tag!==0&&Um(),i=e.pendingLanes,i&1?e===W4?Fy++:(Fy=0,W4=e):Fy=0,dh(),null}function Um(){if(bf!==null){var e=pH(KS),t=Bs.transition,r=_n;try{if(Bs.transition=null,_n=16>e?16:e,bf===null)var n=!1;else{if(e=bf,bf=null,KS=0,sn&6)throw Error(Tt(331));var a=sn;for(sn|=4,Ht=e.current;Ht!==null;){var i=Ht,o=i.child;if(Ht.flags&16){var s=i.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(Ht=l;Ht!==null;){var c=Ht;switch(c.tag){case 0:case 11:case 15:Ly(8,c,i)}var d=c.child;if(d!==null)d.return=c,Ht=d;else for(;Ht!==null;){c=Ht;var f=c.sibling,h=c.return;if(AG(c),c===l){Ht=null;break}if(f!==null){f.return=h,Ht=f;break}Ht=h}}}var v=i.alternate;if(v!==null){var p=v.child;if(p!==null){v.child=null;do{var g=p.sibling;p.sibling=null,p=g}while(p!==null)}}Ht=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Ht=o;else e:for(;Ht!==null;){if(i=Ht,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ly(9,i,i.return)}var m=i.sibling;if(m!==null){m.return=i.return,Ht=m;break e}Ht=i.return}}var y=e.current;for(Ht=y;Ht!==null;){o=Ht;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,Ht=b;else e:for(o=y;Ht!==null;){if(s=Ht,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:sw(9,s)}}catch(x){ga(s,s.return,x)}if(s===o){Ht=null;break e}var S=s.sibling;if(S!==null){S.return=s.return,Ht=S;break e}Ht=s.return}}if(sn=a,dh(),Sl&&typeof Sl.onPostCommitFiberRoot=="function")try{Sl.onPostCommitFiberRoot(J_,e)}catch{}n=!0}return n}finally{_n=r,Bs.transition=t}}return!1}function mF(e,t,r){t=cg(r,t),t=vG(e,t,1),e=Rf(e,t,1),t=Zi(),e!==null&&(cb(e,1,t),_o(e,t))}function ga(e,t,r){if(e.tag===3)mF(e,e,r);else for(;t!==null;){if(t.tag===3){mF(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(kf===null||!kf.has(n))){e=cg(r,e),e=mG(t,e,1),t=Rf(t,e,1),e=Zi(),t!==null&&(cb(t,1,e),_o(t,e));break}}t=t.return}}function Coe(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=Zi(),e.pingedLanes|=e.suspendedLanes&r,ii===e&&(pi&r)===r&&(Ha===4||Ha===3&&(pi&130023424)===pi&&500>_a()-Q5?hp(e,0):K5|=r),_o(e,t)}function NG(e,t){t===0&&(e.mode&1?(t=f2,f2<<=1,!(f2&130023424)&&(f2=4194304)):t=1);var r=Zi();e=Fc(e,t),e!==null&&(cb(e,t,r),_o(e,r))}function _oe(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),NG(e,r)}function woe(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,a=e.memoizedState;a!==null&&(r=a.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Tt(314))}n!==null&&n.delete(t),NG(e,r)}var FG;FG=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||So.current)xo=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return xo=!1,doe(e,t,r);xo=!!(e.flags&131072)}else xo=!1,ra&&t.flags&1048576&&jH(t,zS,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Yx(e,t),e=t.pendingProps;var a=og(t,Ni.current);Bm(t,r),a=G5(null,t,n,e,a,r);var i=q5();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Co(n)?(i=!0,US(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,U5(t),a.updater=iw,t.stateNode=a,a._reactInternals=t,O4(t,n,e,r),t=F4(null,t,n,!0,i,r)):(t.tag=0,ra&&i&&R5(t),Yi(null,t,a,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Yx(e,t),e=t.pendingProps,a=n._init,n=a(n._payload),t.type=n,a=t.tag=Aoe(n),e=lu(n,e),a){case 0:t=N4(null,t,n,e,r);break e;case 1:t=oF(null,t,n,e,r);break e;case 11:t=aF(null,t,n,e,r);break e;case 14:t=iF(null,t,n,lu(n.type,e),r);break e}throw Error(Tt(306,n,""))}return t;case 0:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:lu(n,a),N4(e,t,n,a,r);case 1:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:lu(n,a),oF(e,t,n,a,r);case 3:e:{if(xG(t),e===null)throw Error(Tt(387));n=t.pendingProps,i=t.memoizedState,a=i.element,GH(e,t),GS(t,n,null,r);var o=t.memoizedState;if(n=o.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=cg(Error(Tt(423)),t),t=sF(e,t,n,r,a);break e}else if(n!==a){a=cg(Error(Tt(424)),t),t=sF(e,t,n,r,a);break e}else for(Go=Df(t.stateNode.containerInfo.firstChild),Xo=t,ra=!0,pu=null,r=XH(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(sg(),n===a){t=Bc(e,t,r);break e}Yi(e,t,n,r)}t=t.child}return t;case 5:return YH(t),e===null&&D4(t),n=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,o=a.children,A4(n,a)?o=null:i!==null&&A4(n,i)&&(t.flags|=32),bG(e,t),Yi(e,t,o,r),t.child;case 6:return e===null&&D4(t),null;case 13:return SG(e,t,r);case 4:return j5(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=ug(t,null,n,r):Yi(e,t,n,r),t.child;case 11:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:lu(n,a),aF(e,t,n,a,r);case 7:return Yi(e,t,t.pendingProps,r),t.child;case 8:return Yi(e,t,t.pendingProps.children,r),t.child;case 12:return Yi(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,a=t.pendingProps,i=t.memoizedProps,o=a.value,Bn(VS,n._currentValue),n._currentValue=o,i!==null)if(Lu(i.value,o)){if(i.children===a.children&&!So.current){t=Bc(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){o=i.child;for(var u=s.firstContext;u!==null;){if(u.context===n){if(i.tag===1){u=Ac(-1,r&-r),u.tag=2;var l=i.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}i.lanes|=r,u=i.alternate,u!==null&&(u.lanes|=r),R4(i.return,r,t),s.lanes|=r;break}u=u.next}}else if(i.tag===10)o=i.type===t.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Tt(341));o.lanes|=r,s=o.alternate,s!==null&&(s.lanes|=r),R4(o,r,t),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===t){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Yi(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,n=t.pendingProps.children,Bm(t,r),a=zs(a),n=n(a),t.flags|=1,Yi(e,t,n,r),t.child;case 14:return n=t.type,a=lu(n,t.pendingProps),a=lu(n.type,a),iF(e,t,n,a,r);case 15:return gG(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:lu(n,a),Yx(e,t),t.tag=1,Co(n)?(e=!0,US(t)):e=!1,Bm(t,r),WH(t,n,a),O4(t,n,a,r),F4(null,t,n,!0,e,r);case 19:return CG(e,t,r);case 22:return yG(e,t,r)}throw Error(Tt(156,t.tag))};function BG(e,t){return cH(e,t)}function Eoe(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Os(e,t,r,n){return new Eoe(e,t,r,n)}function tR(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Aoe(e){if(typeof e=="function")return tR(e)?1:0;if(e!=null){if(e=e.$$typeof,e===x5)return 11;if(e===S5)return 14}return 2}function Lf(e,t){var r=e.alternate;return r===null?(r=Os(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Zx(e,t,r,n,a,i){var o=2;if(n=e,typeof e=="function")tR(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case cm:return pp(r.children,a,i,t);case b5:o=8,a|=8;break;case a4:return e=Os(12,r,t,a|2),e.elementType=a4,e.lanes=i,e;case i4:return e=Os(13,r,t,a),e.elementType=i4,e.lanes=i,e;case o4:return e=Os(19,r,t,a),e.elementType=o4,e.lanes=i,e;case $V:return lw(r,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case qV:o=10;break e;case WV:o=9;break e;case x5:o=11;break e;case S5:o=14;break e;case Zd:o=16,n=null;break e}throw Error(Tt(130,e==null?e:typeof e,""))}return t=Os(o,r,t,a),t.elementType=e,t.type=n,t.lanes=i,t}function pp(e,t,r,n){return e=Os(7,e,n,t),e.lanes=r,e}function lw(e,t,r,n){return e=Os(22,e,n,t),e.elementType=$V,e.lanes=r,e.stateNode={isHidden:!1},e}function aA(e,t,r){return e=Os(6,e,null,t),e.lanes=r,e}function iA(e,t,r){return t=Os(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Poe(e,t,r,n,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=UE(0),this.expirationTimes=UE(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=UE(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function rR(e,t,r,n,a,i,o,s,u){return e=new Poe(e,t,r,s,u),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Os(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},U5(i),e}function Toe(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:lm,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function UG(e){if(!e)return Wf;e=e._reactInternals;e:{if(av(e)!==e||e.tag!==1)throw Error(Tt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Co(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Tt(171))}if(e.tag===1){var r=e.type;if(Co(r))return BH(e,r,t)}return t}function jG(e,t,r,n,a,i,o,s,u){return e=rR(r,n,!0,e,a,i,o,s,u),e.context=UG(null),r=e.current,n=Zi(),a=Of(r),i=Ac(n,a),i.callback=t??null,Rf(r,i,a),e.current.lanes=a,cb(e,a,n),_o(e,n),e}function cw(e,t,r,n){var a=t.current,i=Zi(),o=Of(a);return r=UG(r),t.context===null?t.context=r:t.pendingContext=r,t=Ac(i,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Rf(a,t,o),e!==null&&(_u(e,a,o,i),Wx(e,a,o)),o}function ZS(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function gF(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function nR(e,t){gF(e,t),(e=e.alternate)&&gF(e,t)}function Ioe(){return null}var zG=typeof reportError=="function"?reportError:function(e){console.error(e)};function aR(e){this._internalRoot=e}dw.prototype.render=aR.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Tt(409));cw(e,t,null,null)};dw.prototype.unmount=aR.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Mp(function(){cw(null,e,null,null)}),t[Nc]=null}};function dw(e){this._internalRoot=e}dw.prototype.unstable_scheduleHydration=function(e){if(e){var t=gH();e={blockedOn:null,target:e,priority:t};for(var r=0;r<rf.length&&t!==0&&t<rf[r].priority;r++);rf.splice(r,0,e),r===0&&bH(e)}};function iR(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function fw(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function yF(){}function Moe(e,t,r,n,a){if(a){if(typeof n=="function"){var i=n;n=function(){var l=ZS(o);i.call(l)}}var o=jG(t,n,e,0,null,!1,!1,"",yF);return e._reactRootContainer=o,e[Nc]=o.current,v1(e.nodeType===8?e.parentNode:e),Mp(),o}for(;a=e.lastChild;)e.removeChild(a);if(typeof n=="function"){var s=n;n=function(){var l=ZS(u);s.call(l)}}var u=rR(e,0,!1,null,null,!1,!1,"",yF);return e._reactRootContainer=u,e[Nc]=u.current,v1(e.nodeType===8?e.parentNode:e),Mp(function(){cw(t,u,r,n)}),u}function hw(e,t,r,n,a){var i=r._reactRootContainer;if(i){var o=i;if(typeof a=="function"){var s=a;a=function(){var u=ZS(o);s.call(u)}}cw(t,o,e,a)}else o=Moe(r,t,e,a,n);return ZS(o)}vH=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=ly(t.pendingLanes);r!==0&&(w5(t,r|1),_o(t,_a()),!(sn&6)&&(dg=_a()+500,dh()))}break;case 13:Mp(function(){var n=Fc(e,1);if(n!==null){var a=Zi();_u(n,e,1,a)}}),nR(e,1)}};E5=function(e){if(e.tag===13){var t=Fc(e,134217728);if(t!==null){var r=Zi();_u(t,e,134217728,r)}nR(e,134217728)}};mH=function(e){if(e.tag===13){var t=Of(e),r=Fc(e,t);if(r!==null){var n=Zi();_u(r,e,t,n)}nR(e,t)}};gH=function(){return _n};yH=function(e,t){var r=_n;try{return _n=e,t()}finally{_n=r}};m4=function(e,t,r){switch(t){case"input":if(l4(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var a=nw(n);if(!a)throw Error(Tt(90));YV(n),l4(n,a)}}}break;case"textarea":QV(e,r);break;case"select":t=r.value,t!=null&&Om(e,!!r.multiple,t,!1)}};aH=Z5;iH=Mp;var Doe={usingClientEntryPoint:!1,Events:[fb,pm,nw,rH,nH,Z5]},w0={findFiberByHostInstance:rp,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Roe={bundleType:w0.bundleType,version:w0.version,rendererPackageName:w0.rendererPackageName,rendererConfig:w0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:od.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=uH(e),e===null?null:e.stateNode},findFiberByHostInstance:w0.findFiberByHostInstance||Ioe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_2.isDisabled&&_2.supportsFiber)try{J_=_2.inject(Roe),Sl=_2}catch{}}os.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Doe;os.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!iR(t))throw Error(Tt(200));return Toe(e,t,null,r)};os.createRoot=function(e,t){if(!iR(e))throw Error(Tt(299));var r=!1,n="",a=zG;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=rR(e,1,!1,null,null,r,!1,n,a),e[Nc]=t.current,v1(e.nodeType===8?e.parentNode:e),new aR(t)};os.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Tt(188)):(e=Object.keys(e).join(","),Error(Tt(268,e)));return e=uH(t),e=e===null?null:e.stateNode,e};os.flushSync=function(e){return Mp(e)};os.hydrate=function(e,t,r){if(!fw(t))throw Error(Tt(200));return hw(null,e,t,!0,r)};os.hydrateRoot=function(e,t,r){if(!iR(e))throw Error(Tt(405));var n=r!=null&&r.hydratedSources||null,a=!1,i="",o=zG;if(r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=jG(t,null,e,1,r??null,a,!1,i,o),e[Nc]=t.current,v1(e),n)for(e=0;e<n.length;e++)r=n[e],a=r._getVersion,a=a(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,a]:t.mutableSourceEagerHydrationData.push(r,a);return new dw(t)};os.render=function(e,t,r){if(!fw(t))throw Error(Tt(200));return hw(null,e,t,!1,r)};os.unmountComponentAtNode=function(e){if(!fw(e))throw Error(Tt(40));return e._reactRootContainer?(Mp(function(){hw(null,null,e,!1,function(){e._reactRootContainer=null,e[Nc]=null})}),!0):!1};os.unstable_batchedUpdates=Z5;os.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!fw(r))throw Error(Tt(200));if(e==null||e._reactInternals===void 0)throw Error(Tt(38));return hw(e,t,r,!1,n)};os.version="18.2.0-next-9e3b772b8-20220608";function VG(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(VG)}catch(e){console.error(e)}}VG(),jV.exports=os;var oR=jV.exports;function koe(e){e()}let HG=koe;const Ooe=e=>HG=e,Loe=()=>HG,$f=ze.createContext(null);function GG(){return ze.useContext($f)}const Noe=()=>{throw new Error("uSES not initialized!")};let qG=Noe;const Foe=e=>{qG=e},Boe=(e,t)=>e===t;function Uoe(e=$f){const t=e===$f?GG:()=>ze.useContext(e);return function(n,a=Boe){const{store:i,subscription:o,getServerState:s}=t(),u=qG(o.addNestedSub,i.getState,s||i.getState,n,a);return ze.useDebugValue(u),u}}const Eo=Uoe();var WG={exports:{}},wn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var si=typeof Symbol=="function"&&Symbol.for,sR=si?Symbol.for("react.element"):60103,uR=si?Symbol.for("react.portal"):60106,pw=si?Symbol.for("react.fragment"):60107,vw=si?Symbol.for("react.strict_mode"):60108,mw=si?Symbol.for("react.profiler"):60114,gw=si?Symbol.for("react.provider"):60109,yw=si?Symbol.for("react.context"):60110,lR=si?Symbol.for("react.async_mode"):60111,bw=si?Symbol.for("react.concurrent_mode"):60111,xw=si?Symbol.for("react.forward_ref"):60112,Sw=si?Symbol.for("react.suspense"):60113,joe=si?Symbol.for("react.suspense_list"):60120,Cw=si?Symbol.for("react.memo"):60115,_w=si?Symbol.for("react.lazy"):60116,zoe=si?Symbol.for("react.block"):60121,Voe=si?Symbol.for("react.fundamental"):60117,Hoe=si?Symbol.for("react.responder"):60118,Goe=si?Symbol.for("react.scope"):60119;function us(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case sR:switch(e=e.type,e){case lR:case bw:case pw:case mw:case vw:case Sw:return e;default:switch(e=e&&e.$$typeof,e){case yw:case xw:case _w:case Cw:case gw:return e;default:return t}}case uR:return t}}}function $G(e){return us(e)===bw}wn.AsyncMode=lR;wn.ConcurrentMode=bw;wn.ContextConsumer=yw;wn.ContextProvider=gw;wn.Element=sR;wn.ForwardRef=xw;wn.Fragment=pw;wn.Lazy=_w;wn.Memo=Cw;wn.Portal=uR;wn.Profiler=mw;wn.StrictMode=vw;wn.Suspense=Sw;wn.isAsyncMode=function(e){return $G(e)||us(e)===lR};wn.isConcurrentMode=$G;wn.isContextConsumer=function(e){return us(e)===yw};wn.isContextProvider=function(e){return us(e)===gw};wn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===sR};wn.isForwardRef=function(e){return us(e)===xw};wn.isFragment=function(e){return us(e)===pw};wn.isLazy=function(e){return us(e)===_w};wn.isMemo=function(e){return us(e)===Cw};wn.isPortal=function(e){return us(e)===uR};wn.isProfiler=function(e){return us(e)===mw};wn.isStrictMode=function(e){return us(e)===vw};wn.isSuspense=function(e){return us(e)===Sw};wn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===pw||e===bw||e===mw||e===vw||e===Sw||e===joe||typeof e=="object"&&e!==null&&(e.$$typeof===_w||e.$$typeof===Cw||e.$$typeof===gw||e.$$typeof===yw||e.$$typeof===xw||e.$$typeof===Voe||e.$$typeof===Hoe||e.$$typeof===Goe||e.$$typeof===zoe)};wn.typeOf=us;WG.exports=wn;var qoe=WG.exports,XG=qoe,Woe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},$oe={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},YG={};YG[XG.ForwardRef]=Woe;YG[XG.Memo]=$oe;var Mn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cR=Symbol.for("react.element"),dR=Symbol.for("react.portal"),ww=Symbol.for("react.fragment"),Ew=Symbol.for("react.strict_mode"),Aw=Symbol.for("react.profiler"),Pw=Symbol.for("react.provider"),Tw=Symbol.for("react.context"),Xoe=Symbol.for("react.server_context"),Iw=Symbol.for("react.forward_ref"),Mw=Symbol.for("react.suspense"),Dw=Symbol.for("react.suspense_list"),Rw=Symbol.for("react.memo"),kw=Symbol.for("react.lazy"),Yoe=Symbol.for("react.offscreen"),KG;KG=Symbol.for("react.module.reference");function Ys(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case cR:switch(e=e.type,e){case ww:case Aw:case Ew:case Mw:case Dw:return e;default:switch(e=e&&e.$$typeof,e){case Xoe:case Tw:case Iw:case kw:case Rw:case Pw:return e;default:return t}}case dR:return t}}}Mn.ContextConsumer=Tw;Mn.ContextProvider=Pw;Mn.Element=cR;Mn.ForwardRef=Iw;Mn.Fragment=ww;Mn.Lazy=kw;Mn.Memo=Rw;Mn.Portal=dR;Mn.Profiler=Aw;Mn.StrictMode=Ew;Mn.Suspense=Mw;Mn.SuspenseList=Dw;Mn.isAsyncMode=function(){return!1};Mn.isConcurrentMode=function(){return!1};Mn.isContextConsumer=function(e){return Ys(e)===Tw};Mn.isContextProvider=function(e){return Ys(e)===Pw};Mn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===cR};Mn.isForwardRef=function(e){return Ys(e)===Iw};Mn.isFragment=function(e){return Ys(e)===ww};Mn.isLazy=function(e){return Ys(e)===kw};Mn.isMemo=function(e){return Ys(e)===Rw};Mn.isPortal=function(e){return Ys(e)===dR};Mn.isProfiler=function(e){return Ys(e)===Aw};Mn.isStrictMode=function(e){return Ys(e)===Ew};Mn.isSuspense=function(e){return Ys(e)===Mw};Mn.isSuspenseList=function(e){return Ys(e)===Dw};Mn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===ww||e===Aw||e===Ew||e===Mw||e===Dw||e===Yoe||typeof e=="object"&&e!==null&&(e.$$typeof===kw||e.$$typeof===Rw||e.$$typeof===Pw||e.$$typeof===Tw||e.$$typeof===Iw||e.$$typeof===KG||e.getModuleId!==void 0)};Mn.typeOf=Ys;function Koe(){const e=Loe();let t=null,r=null;return{clear(){t=null,r=null},notify(){e(()=>{let n=t;for(;n;)n.callback(),n=n.next})},get(){let n=[],a=t;for(;a;)n.push(a),a=a.next;return n},subscribe(n){let a=!0,i=r={callback:n,next:null,prev:r};return i.prev?i.prev.next=i:t=i,function(){!a||t===null||(a=!1,i.next?i.next.prev=i.prev:r=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}const bF={notify(){},get:()=>[]};function Qoe(e,t){let r,n=bF;function a(d){return u(),n.subscribe(d)}function i(){n.notify()}function o(){c.onStateChange&&c.onStateChange()}function s(){return!!r}function u(){r||(r=t?t.addNestedSub(o):e.subscribe(o),n=Koe())}function l(){r&&(r(),r=void 0,n.clear(),n=bF)}const c={addNestedSub:a,notifyNestedSubs:i,handleChangeWrapper:o,isSubscribed:s,trySubscribe:u,tryUnsubscribe:l,getListeners:()=>n};return c}const Zoe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Joe=Zoe?ze.useLayoutEffect:ze.useEffect;function ese({store:e,context:t,children:r,serverState:n}){const a=ze.useMemo(()=>{const s=Qoe(e);return{store:e,subscription:s,getServerState:n?()=>n:void 0}},[e,n]),i=ze.useMemo(()=>e.getState(),[e]);Joe(()=>{const{subscription:s}=a;return s.onStateChange=s.notifyNestedSubs,s.trySubscribe(),i!==e.getState()&&s.notifyNestedSubs(),()=>{s.tryUnsubscribe(),s.onStateChange=void 0}},[a,i]);const o=t||$f;return OV.createElement(o.Provider,{value:a},r)}function QG(e=$f){const t=e===$f?GG:()=>ze.useContext(e);return function(){const{store:n}=t();return n}}const tse=QG();function rse(e=$f){const t=e===$f?tse:QG(e);return function(){return t().dispatch}}const Bg=rse();Foe(Iae.useSyncExternalStoreWithSelector);Ooe(oR.unstable_batchedUpdates);var Y4={},xF=oR;Y4.createRoot=xF.createRoot,Y4.hydrateRoot=xF.hydrateRoot;const nse=(e=[],t)=>{switch(t.type){case"SET_PROTEIN_LIST":return t.payload;case"ADD_PROTEIN":return[...e,t.payload];default:return e}},ase=(e="",t)=>{switch(t.type){case"UPDATE_SEARCH":return t.payload;default:return e}},ise={login:"",uid:""},ose=(e=ise,t)=>{switch(t.type){case"AUTH_LOGIN":return t.payload;default:return e}},sse=(e="/",t)=>{switch(t.type){case"SET_CURRENT_PATH":return t.payload;default:return e}},use="",lse=(e=use,t)=>{switch(t.type){case"UPDATE_LINK":return t.payload;default:return e}},cse={sequence:{value:""}},dse=(e=cse,t)=>{switch(t.type){case"SET_CURRENT_PROTEIN":return t.payload;default:return e}},fse=!1,hse=(e=fse,t)=>{switch(t.type){case"SET_LOAD_STATE":return t.payload;default:return e}},pse=cae({proteinList:nse,searchStr:ase,auth:ose,protein:dse,link:lse,currentPath:sse,loading:hse});var fR="persist:",ZG="persist/FLUSH",hR="persist/REHYDRATE",JG="persist/PAUSE",eq="persist/PERSIST",tq="persist/PURGE",rq="persist/REGISTER",vse=-1;function Jx(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Jx=function(r){return typeof r}:Jx=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Jx(e)}function SF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mse(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SF(r,!0).forEach(function(n){gse(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SF(r).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gse(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yse(e,t,r,n){n.debug;var a=mse({},r);return e&&Jx(e)==="object"&&Object.keys(e).forEach(function(i){i!=="_persist"&&t[i]===r[i]&&(a[i]=e[i])}),a}function bse(e){var t=e.blacklist||null,r=e.whitelist||null,n=e.transforms||[],a=e.throttle||0,i="".concat(e.keyPrefix!==void 0?e.keyPrefix:fR).concat(e.key),o=e.storage,s;e.serialize===!1?s=function(x){return x}:typeof e.serialize=="function"?s=e.serialize:s=xse;var u=e.writeFailHandler||null,l={},c={},d=[],f=null,h=null,v=function(x){Object.keys(x).forEach(function(C){m(C)&&l[C]!==x[C]&&d.indexOf(C)===-1&&d.push(C)}),Object.keys(l).forEach(function(C){x[C]===void 0&&m(C)&&d.indexOf(C)===-1&&l[C]!==void 0&&d.push(C)}),f===null&&(f=setInterval(p,a)),l=x};function p(){if(d.length===0){f&&clearInterval(f),f=null;return}var S=d.shift(),x=n.reduce(function(C,w){return w.in(C,S,l)},l[S]);if(x!==void 0)try{c[S]=s(x)}catch(C){console.error("redux-persist/createPersistoid: error serializing state",C)}else delete c[S];d.length===0&&g()}function g(){Object.keys(c).forEach(function(S){l[S]===void 0&&delete c[S]}),h=o.setItem(i,s(c)).catch(y)}function m(S){return!(r&&r.indexOf(S)===-1&&S!=="_persist"||t&&t.indexOf(S)!==-1)}function y(S){u&&u(S)}var b=function(){for(;d.length!==0;)p();return h||Promise.resolve()};return{update:v,flush:b}}function xse(e){return JSON.stringify(e)}function Sse(e){var t=e.transforms||[],r="".concat(e.keyPrefix!==void 0?e.keyPrefix:fR).concat(e.key),n=e.storage;e.debug;var a;return e.deserialize===!1?a=function(o){return o}:typeof e.deserialize=="function"?a=e.deserialize:a=Cse,n.getItem(r).then(function(i){if(i)try{var o={},s=a(i);return Object.keys(s).forEach(function(u){o[u]=t.reduceRight(function(l,c){return c.out(l,u,s)},a(s[u]))}),o}catch(u){throw u}else return})}function Cse(e){return JSON.parse(e)}function _se(e){var t=e.storage,r="".concat(e.keyPrefix!==void 0?e.keyPrefix:fR).concat(e.key);return t.removeItem(r,wse)}function wse(e){}function CF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CF(r,!0).forEach(function(n){Ese(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CF(r).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ese(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ase(e,t){if(e==null)return{};var r=Pse(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Pse(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,i;for(i=0;i<n.length;i++)a=n[i],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}var Tse=5e3;function Ise(e,t){var r=e.version!==void 0?e.version:vse;e.debug;var n=e.stateReconciler===void 0?yse:e.stateReconciler,a=e.getStoredState||Sse,i=e.timeout!==void 0?e.timeout:Tse,o=null,s=!1,u=!0,l=function(d){return d._persist.rehydrated&&o&&!u&&o.update(d),d};return function(c,d){var f=c||{},h=f._persist,v=Ase(f,["_persist"]),p=v;if(d.type===eq){var g=!1,m=function(A,I){g||(d.rehydrate(e.key,A,I),g=!0)};if(i&&setTimeout(function(){!g&&m(void 0,new Error('redux-persist: persist timed out for persist key "'.concat(e.key,'"')))},i),u=!1,o||(o=bse(e)),h)return Hl({},t(p,d),{_persist:h});if(typeof d.rehydrate!="function"||typeof d.register!="function")throw new Error("redux-persist: either rehydrate or register is not a function on the PERSIST action. This can happen if the action is being replayed. This is an unexplored use case, please open an issue and we will figure out a resolution.");return d.register(e.key),a(e).then(function(w){var A=e.migrate||function(I,D){return Promise.resolve(I)};A(w,r).then(function(I){m(I)},function(I){m(void 0,I)})},function(w){m(void 0,w)}),Hl({},t(p,d),{_persist:{version:r,rehydrated:!1}})}else{if(d.type===tq)return s=!0,d.result(_se(e)),Hl({},t(p,d),{_persist:h});if(d.type===ZG)return d.result(o&&o.flush()),Hl({},t(p,d),{_persist:h});if(d.type===JG)u=!0;else if(d.type===hR){if(s)return Hl({},p,{_persist:Hl({},h,{rehydrated:!0})});if(d.key===e.key){var y=t(p,d),b=d.payload,S=n!==!1&&b!==void 0?n(b,c,y,e):y,x=Hl({},S,{_persist:Hl({},h,{rehydrated:!0})});return l(x)}}}if(!h)return t(c,d);var C=t(p,d);return C===p?c:l(Hl({},C,{_persist:h}))}}function _F(e){return Rse(e)||Dse(e)||Mse()}function Mse(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function Dse(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function Rse(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function wF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function K4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wF(r,!0).forEach(function(n){kse(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wF(r).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kse(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var nq={registry:[],bootstrapped:!1},Ose=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:nq,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case rq:return K4({},t,{registry:[].concat(_F(t.registry),[r.key])});case hR:var n=t.registry.indexOf(r.key),a=_F(t.registry);return a.splice(n,1),K4({},t,{registry:a,bootstrapped:a.length===0});default:return t}};function Lse(e,t,r){var n=r||!1,a=v5(Ose,nq,t&&t.enhancer?t.enhancer:void 0),i=function(l){a.dispatch({type:rq,key:l})},o=function(l,c,d){var f={type:hR,payload:c,err:d,key:l};e.dispatch(f),a.dispatch(f),n&&s.getState().bootstrapped&&(n(),n=!1)},s=K4({},a,{purge:function(){var l=[];return e.dispatch({type:tq,result:function(d){l.push(d)}}),Promise.all(l)},flush:function(){var l=[];return e.dispatch({type:ZG,result:function(d){l.push(d)}}),Promise.all(l)},pause:function(){e.dispatch({type:JG})},persist:function(){e.dispatch({type:eq,register:i,rehydrate:o})}});return t&&t.manualPersist||s.persist(),s}var pR={},vR={};vR.__esModule=!0;vR.default=Bse;function eS(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?eS=function(r){return typeof r}:eS=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},eS(e)}function oA(){}var Nse={getItem:oA,setItem:oA,removeItem:oA};function Fse(e){if((typeof self>"u"?"undefined":eS(self))!=="object"||!(e in self))return!1;try{var t=self[e],r="redux-persist ".concat(e," test");t.setItem(r,"test"),t.getItem(r),t.removeItem(r)}catch{return!1}return!0}function Bse(e){var t="".concat(e,"Storage");return Fse(t)?self[t]:Nse}pR.__esModule=!0;pR.default=zse;var Use=jse(vR);function jse(e){return e&&e.__esModule?e:{default:e}}function zse(e){var t=(0,Use.default)(e);return{getItem:function(n){return new Promise(function(a,i){a(t.getItem(n))})},setItem:function(n,a){return new Promise(function(i,o){i(t.setItem(n,a))})},removeItem:function(n){return new Promise(function(a,i){a(t.removeItem(n))})}}}var aq=void 0,Vse=Hse(pR);function Hse(e){return e&&e.__esModule?e:{default:e}}var Gse=(0,Vse.default)("local");aq=Gse;const qse={key:"root",storage:aq};/**
 * @remix-run/router v1.6.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hn(){return hn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hn.apply(this,arguments)}var Ta;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Ta||(Ta={}));const EF="popstate";function Wse(e){e===void 0&&(e={});function t(n,a){let{pathname:i,search:o,hash:s}=n.location;return w1("",{pathname:i,search:o,hash:s},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function r(n,a){return typeof a=="string"?a:Dp(a)}return Xse(t,r,null,e)}function Br(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function fg(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function $se(){return Math.random().toString(36).substr(2,8)}function AF(e,t){return{usr:e.state,key:e.key,idx:t}}function w1(e,t,r,n){return r===void 0&&(r=null),hn({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?sd(t):t,{state:r,key:t&&t.key||n||$se()})}function Dp(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function sd(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Xse(e,t,r,n){n===void 0&&(n={});let{window:a=document.defaultView,v5Compat:i=!1}=n,o=a.history,s=Ta.Pop,u=null,l=c();l==null&&(l=0,o.replaceState(hn({},o.state,{idx:l}),""));function c(){return(o.state||{idx:null}).idx}function d(){s=Ta.Pop;let g=c(),m=g==null?null:g-l;l=g,u&&u({action:s,location:p.location,delta:m})}function f(g,m){s=Ta.Push;let y=w1(p.location,g,m);r&&r(y,g),l=c()+1;let b=AF(y,l),S=p.createHref(y);try{o.pushState(b,"",S)}catch{a.location.assign(S)}i&&u&&u({action:s,location:p.location,delta:1})}function h(g,m){s=Ta.Replace;let y=w1(p.location,g,m);r&&r(y,g),l=c();let b=AF(y,l),S=p.createHref(y);o.replaceState(b,"",S),i&&u&&u({action:s,location:p.location,delta:0})}function v(g){let m=a.location.origin!=="null"?a.location.origin:a.location.href,y=typeof g=="string"?g:Dp(g);return Br(m,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,m)}let p={get action(){return s},get location(){return e(a,o)},listen(g){if(u)throw new Error("A history only accepts one active listener");return a.addEventListener(EF,d),u=g,()=>{a.removeEventListener(EF,d),u=null}},createHref(g){return t(a,g)},createURL:v,encodeLocation(g){let m=v(g);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:f,replace:h,go(g){return o.go(g)}};return p}var ja;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(ja||(ja={}));const Yse=new Set(["lazy","caseSensitive","path","id","index","children"]);function Kse(e){return e.index===!0}function Q4(e,t,r,n){return r===void 0&&(r=[]),n===void 0&&(n={}),e.map((a,i)=>{let o=[...r,i],s=typeof a.id=="string"?a.id:o.join("-");if(Br(a.index!==!0||!a.children,"Cannot specify children on an index route"),Br(!n[s],'Found a route id collision on id "'+s+`".  Route id's must be globally unique within Data Router usages`),Kse(a)){let u=hn({},a,t(a),{id:s});return n[s]=u,u}else{let u=hn({},a,t(a),{id:s,children:void 0});return n[s]=u,a.children&&(u.children=Q4(a.children,t,o,n)),u}})}function Sm(e,t,r){r===void 0&&(r="/");let n=typeof t=="string"?sd(t):t,a=Ug(n.pathname||"/",r);if(a==null)return null;let i=iq(e);Qse(i);let o=null;for(let s=0;o==null&&s<i.length;++s)o=oue(i[s],lue(a));return o}function iq(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let a=(i,o,s)=>{let u={relativePath:s===void 0?i.path||"":s,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};u.relativePath.startsWith("/")&&(Br(u.relativePath.startsWith(n),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(n.length));let l=Pc([n,u.relativePath]),c=r.concat(u);i.children&&i.children.length>0&&(Br(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),iq(i.children,t,c,l)),!(i.path==null&&!i.index)&&t.push({path:l,score:aue(l,i.index),routesMeta:c})};return e.forEach((i,o)=>{var s;if(i.path===""||!((s=i.path)!=null&&s.includes("?")))a(i,o);else for(let u of oq(i.path))a(i,o,u)}),t}function oq(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,a=r.endsWith("?"),i=r.replace(/\?$/,"");if(n.length===0)return a?[i,""]:[i];let o=oq(n.join("/")),s=[];return s.push(...o.map(u=>u===""?i:[i,u].join("/"))),a&&s.push(...o),s.map(u=>e.startsWith("/")&&u===""?"/":u)}function Qse(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:iue(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const Zse=/^:\w+$/,Jse=3,eue=2,tue=1,rue=10,nue=-2,PF=e=>e==="*";function aue(e,t){let r=e.split("/"),n=r.length;return r.some(PF)&&(n+=nue),t&&(n+=eue),r.filter(a=>!PF(a)).reduce((a,i)=>a+(Zse.test(i)?Jse:i===""?tue:rue),n)}function iue(e,t){return e.length===t.length&&e.slice(0,-1).every((n,a)=>n===t[a])?e[e.length-1]-t[t.length-1]:0}function oue(e,t){let{routesMeta:r}=e,n={},a="/",i=[];for(let o=0;o<r.length;++o){let s=r[o],u=o===r.length-1,l=a==="/"?t:t.slice(a.length)||"/",c=sue({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},l);if(!c)return null;Object.assign(n,c.params);let d=s.route;i.push({params:n,pathname:Pc([a,c.pathname]),pathnameBase:hue(Pc([a,c.pathnameBase])),route:d}),c.pathnameBase!=="/"&&(a=Pc([a,c.pathnameBase]))}return i}function sue(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=uue(e.path,e.caseSensitive,e.end),a=t.match(r);if(!a)return null;let i=a[0],o=i.replace(/(.)\/+$/,"$1"),s=a.slice(1);return{params:n.reduce((l,c,d)=>{if(c==="*"){let f=s[d]||"";o=i.slice(0,i.length-f.length).replace(/(.)\/+$/,"$1")}return l[c]=cue(s[d]||"",c),l},{}),pathname:i,pathnameBase:o,pattern:e}}function uue(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),fg(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(o,s)=>(n.push(s),"/([^\\/]+)"));return e.endsWith("*")?(n.push("*"),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),n]}function lue(e){try{return decodeURI(e)}catch(t){return fg(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function cue(e,t){try{return decodeURIComponent(e)}catch(r){return fg(!1,'The value for the URL param "'+t+'" will not be decoded because'+(' the string "'+e+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+r+").")),e}}function Ug(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function due(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:a=""}=typeof e=="string"?sd(e):e;return{pathname:r?r.startsWith("/")?r:fue(r,t):t,search:pue(n),hash:vue(a)}}function fue(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?r.length>1&&r.pop():a!=="."&&r.push(a)}),r.length>1?r.join("/"):"/"}function sA(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ow(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function mR(e,t,r,n){n===void 0&&(n=!1);let a;typeof e=="string"?a=sd(e):(a=hn({},e),Br(!a.pathname||!a.pathname.includes("?"),sA("?","pathname","search",a)),Br(!a.pathname||!a.pathname.includes("#"),sA("#","pathname","hash",a)),Br(!a.search||!a.search.includes("#"),sA("#","search","hash",a)));let i=e===""||a.pathname==="",o=i?"/":a.pathname,s;if(n||o==null)s=r;else{let d=t.length-1;if(o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;a.pathname=f.join("/")}s=d>=0?t[d]:"/"}let u=due(a,s),l=o&&o!=="/"&&o.endsWith("/"),c=(i||o===".")&&r.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const Pc=e=>e.join("/").replace(/\/\/+/g,"/"),hue=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),pue=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,vue=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;class gR{constructor(t,r,n,a){a===void 0&&(a=!1),this.status=t,this.statusText=r||"",this.internal=a,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}}function sq(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const uq=["post","put","patch","delete"],mue=new Set(uq),gue=["get",...uq],yue=new Set(gue),bue=new Set([301,302,303,307,308]),xue=new Set([307,308]),uA={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},Sue={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},TF={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},lq=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cq=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Cue=!cq,_ue=e=>({hasErrorBoundary:!!e.hasErrorBoundary});function wue(e){Br(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let t;if(e.mapRouteProperties)t=e.mapRouteProperties;else if(e.detectErrorBoundary){let Ee=e.detectErrorBoundary;t=Te=>({hasErrorBoundary:Ee(Te)})}else t=_ue;let r={},n=Q4(e.routes,t,void 0,r),a,i=e.basename||"/",o=hn({v7_normalizeFormMethod:!1,v7_prependBasename:!1},e.future),s=null,u=new Set,l=null,c=null,d=null,f=e.hydrationData!=null,h=Sm(n,e.history.location,i),v=null;if(h==null){let Ee=cu(404,{pathname:e.history.location.pathname}),{matches:Te,route:ye}=LF(n);h=Te,v={[ye.id]:Ee}}let p=!h.some(Ee=>Ee.route.lazy)&&(!h.some(Ee=>Ee.route.loader)||e.hydrationData!=null),g,m={historyAction:e.history.action,location:e.history.location,matches:h,initialized:p,navigation:uA,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||v,fetchers:new Map,blockers:new Map},y=Ta.Pop,b=!1,S,x=!1,C=!1,w=[],A=[],I=new Map,D=0,k=-1,R=new Map,L=new Set,H=new Map,B=new Map,j=new Map,Q=!1;function G(){return s=e.history.listen(Ee=>{let{action:Te,location:ye,delta:Se}=Ee;if(Q){Q=!1;return}fg(j.size===0||Se!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Le=$e({currentLocation:m.location,nextLocation:ye,historyAction:Te});if(Le&&Se!=null){Q=!0,e.history.go(Se*-1),Ge(Le,{state:"blocked",location:ye,proceed(){Ge(Le,{state:"proceeding",proceed:void 0,reset:void 0,location:ye}),e.history.go(Se)},reset(){Me(Le),J({blockers:new Map(g.state.blockers)})}});return}return U(Te,ye)}),m.initialized||U(Ta.Pop,m.location),g}function W(){s&&s(),u.clear(),S&&S.abort(),m.fetchers.forEach((Ee,Te)=>ae(Te)),m.blockers.forEach((Ee,Te)=>Me(Te))}function q(Ee){return u.add(Ee),()=>u.delete(Ee)}function J(Ee){m=hn({},m,Ee),u.forEach(Te=>Te(m))}function he(Ee,Te){var ye,Se;let Le=m.actionData!=null&&m.navigation.formMethod!=null&&oc(m.navigation.formMethod)&&m.navigation.state==="loading"&&((ye=Ee.state)==null?void 0:ye._isRedirect)!==!0,Ve;Te.actionData?Object.keys(Te.actionData).length>0?Ve=Te.actionData:Ve=null:Le?Ve=m.actionData:Ve=null;let nt=Te.loaderData?OF(m.loaderData,Te.loaderData,Te.matches||[],Te.errors):m.loaderData;for(let[He]of j)Me(He);let Xe=b===!0||m.navigation.formMethod!=null&&oc(m.navigation.formMethod)&&((Se=Ee.state)==null?void 0:Se._isRedirect)!==!0;a&&(n=a,a=void 0),J(hn({},Te,{actionData:Ve,loaderData:nt,historyAction:y,location:Ee,initialized:!0,navigation:uA,revalidation:"idle",restoreScrollPosition:rt(Ee,Te.matches||m.matches),preventScrollReset:Xe,blockers:new Map(m.blockers)})),x||y===Ta.Pop||(y===Ta.Push?e.history.push(Ee,Ee.state):y===Ta.Replace&&e.history.replace(Ee,Ee.state)),y=Ta.Pop,b=!1,x=!1,C=!1,w=[],A=[]}async function $(Ee,Te){if(typeof Ee=="number"){e.history.go(Ee);return}let ye=Z4(m.location,m.matches,i,o.v7_prependBasename,Ee,Te==null?void 0:Te.fromRouteId,Te==null?void 0:Te.relative),{path:Se,submission:Le,error:Ve}=IF(o.v7_normalizeFormMethod,!1,ye,Te),nt=m.location,Xe=w1(m.location,Se,Te&&Te.state);Xe=hn({},Xe,e.history.encodeLocation(Xe));let He=Te&&Te.replace!=null?Te.replace:void 0,se=Ta.Push;He===!0?se=Ta.Replace:He===!1||Le!=null&&oc(Le.formMethod)&&Le.formAction===m.location.pathname+m.location.search&&(se=Ta.Replace);let pe=Te&&"preventScrollReset"in Te?Te.preventScrollReset===!0:void 0,Ae=$e({currentLocation:nt,nextLocation:Xe,historyAction:se});if(Ae){Ge(Ae,{state:"blocked",location:Xe,proceed(){Ge(Ae,{state:"proceeding",proceed:void 0,reset:void 0,location:Xe}),$(Ee,Te)},reset(){Me(Ae),J({blockers:new Map(m.blockers)})}});return}return await U(se,Xe,{submission:Le,pendingError:Ve,preventScrollReset:pe,replace:Te&&Te.replace})}function X(){if(Ie(),J({revalidation:"loading"}),m.navigation.state!=="submitting"){if(m.navigation.state==="idle"){U(m.historyAction,m.location,{startUninterruptedRevalidation:!0});return}U(y||m.historyAction,m.navigation.location,{overrideNavigation:m.navigation})}}async function U(Ee,Te,ye){S&&S.abort(),S=null,y=Ee,x=(ye&&ye.startUninterruptedRevalidation)===!0,Ue(m.location,m.matches),b=(ye&&ye.preventScrollReset)===!0;let Se=a||n,Le=ye&&ye.overrideNavigation,Ve=Sm(Se,Te,i);if(!Ve){let Ye=cu(404,{pathname:Te.pathname}),{matches:ct,route:St}=LF(Se);Ze(),he(Te,{matches:ct,loaderData:{},errors:{[St.id]:Ye}});return}if(m.initialized&&Iue(m.location,Te)&&!(ye&&ye.submission&&oc(ye.submission.formMethod))){he(Te,{matches:Ve});return}S=new AbortController;let nt=A0(e.history,Te,S.signal,ye&&ye.submission),Xe,He;if(ye&&ye.pendingError)He={[Cm(Ve).route.id]:ye.pendingError};else if(ye&&ye.submission&&oc(ye.submission.formMethod)){let Ye=await z(nt,Te,ye.submission,Ve,{replace:ye.replace});if(Ye.shortCircuited)return;Xe=Ye.pendingActionData,He=Ye.pendingActionError,Le=hn({state:"loading",location:Te},ye.submission),nt=new Request(nt.url,{signal:nt.signal})}let{shortCircuited:se,loaderData:pe,errors:Ae}=await ee(nt,Te,Ve,Le,ye&&ye.submission,ye&&ye.fetcherSubmission,ye&&ye.replace,Xe,He);se||(S=null,he(Te,hn({matches:Ve},Xe?{actionData:Xe}:{},{loaderData:pe,errors:Ae})))}async function z(Ee,Te,ye,Se,Le){Ie();let Ve=hn({state:"submitting",location:Te},ye);J({navigation:Ve});let nt,Xe=J4(Se,Te);if(!Xe.route.action&&!Xe.route.lazy)nt={type:ja.error,error:cu(405,{method:Ee.method,pathname:Te.pathname,routeId:Xe.route.id})};else if(nt=await E0("action",Ee,Xe,Se,r,t,i),Ee.signal.aborted)return{shortCircuited:!0};if(jm(nt)){let He;return Le&&Le.replace!=null?He=Le.replace:He=nt.location===m.location.pathname+m.location.search,await be(m,nt,{submission:ye,replace:He}),{shortCircuited:!0}}if(By(nt)){let He=Cm(Se,Xe.route.id);return(Le&&Le.replace)!==!0&&(y=Ta.Push),{pendingActionData:{},pendingActionError:{[He.route.id]:nt.error}}}if(ip(nt))throw cu(400,{type:"defer-action"});return{pendingActionData:{[Xe.route.id]:nt.data}}}async function ee(Ee,Te,ye,Se,Le,Ve,nt,Xe,He){let se=Se;se||(se=hn({state:"loading",location:Te,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},Le));let pe=Le||Ve?Le||Ve:se.formMethod&&se.formAction&&se.formData&&se.formEncType?{formMethod:se.formMethod,formAction:se.formAction,formData:se.formData,formEncType:se.formEncType}:void 0,Ae=a||n,[Ye,ct]=MF(e.history,m,ye,pe,Te,C,w,A,H,Ae,i,Xe,He);if(Ze(tn=>!(ye&&ye.some(Xn=>Xn.route.id===tn))||Ye&&Ye.some(Xn=>Xn.route.id===tn)),Ye.length===0&&ct.length===0){let tn=V();return he(Te,hn({matches:ye,loaderData:{},errors:He||null},Xe?{actionData:Xe}:{},tn?{fetchers:new Map(m.fetchers)}:{})),{shortCircuited:!0}}if(!x){ct.forEach(Xn=>{let so=m.fetchers.get(Xn.key),tu={state:"loading",data:so&&so.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0};m.fetchers.set(Xn.key,tu)});let tn=Xe||m.actionData;J(hn({navigation:se},tn?Object.keys(tn).length===0?{actionData:null}:{actionData:tn}:{},ct.length>0?{fetchers:new Map(m.fetchers)}:{}))}k=++D,ct.forEach(tn=>{tn.controller&&I.set(tn.key,tn.controller)});let St=()=>ct.forEach(tn=>ie(tn.key));S&&S.signal.addEventListener("abort",St);let{results:Bt,loaderResults:rr,fetcherResults:hr}=await xe(m.matches,ye,Ye,ct,Ee);if(Ee.signal.aborted)return{shortCircuited:!0};S&&S.signal.removeEventListener("abort",St),ct.forEach(tn=>I.delete(tn.key));let Lt=NF(Bt);if(Lt)return await be(m,Lt,{replace:nt}),{shortCircuited:!0};let{loaderData:En,errors:ha}=kF(m,ye,Ye,rr,He,ct,hr,B);B.forEach((tn,Xn)=>{tn.subscribe(so=>{(so||tn.done)&&B.delete(Xn)})});let pa=V(),ui=ve(k),Vi=pa||ui||ct.length>0;return hn({loaderData:En,errors:ha},Vi?{fetchers:new Map(m.fetchers)}:{})}function Y(Ee){return m.fetchers.get(Ee)||Sue}function Z(Ee,Te,ye,Se){if(Cue)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");I.has(Ee)&&ie(Ee);let Le=a||n,Ve=Z4(m.location,m.matches,i,o.v7_prependBasename,ye,Te,Se==null?void 0:Se.relative),nt=Sm(Le,Ve,i);if(!nt){_e(Ee,Te,cu(404,{pathname:Ve}));return}let{path:Xe,submission:He}=IF(o.v7_normalizeFormMethod,!0,Ve,Se),se=J4(nt,Xe);if(b=(Se&&Se.preventScrollReset)===!0,He&&oc(He.formMethod)){te(Ee,Te,Xe,se,nt,He);return}H.set(Ee,{routeId:Te,path:Xe}),ce(Ee,Te,Xe,se,nt,He)}async function te(Ee,Te,ye,Se,Le,Ve){if(Ie(),H.delete(Ee),!Se.route.action&&!Se.route.lazy){let An=cu(405,{method:Ve.formMethod,pathname:ye,routeId:Te});_e(Ee,Te,An);return}let nt=m.fetchers.get(Ee),Xe=hn({state:"submitting"},Ve,{data:nt&&nt.data," _hasFetcherDoneAnything ":!0});m.fetchers.set(Ee,Xe),J({fetchers:new Map(m.fetchers)});let He=new AbortController,se=A0(e.history,ye,He.signal,Ve);I.set(Ee,He);let pe=await E0("action",se,Se,Le,r,t,i);if(se.signal.aborted){I.get(Ee)===He&&I.delete(Ee);return}if(jm(pe)){I.delete(Ee),L.add(Ee);let An=hn({state:"loading"},Ve,{data:void 0," _hasFetcherDoneAnything ":!0});return m.fetchers.set(Ee,An),J({fetchers:new Map(m.fetchers)}),be(m,pe,{submission:Ve,isFetchActionRedirect:!0})}if(By(pe)){_e(Ee,Te,pe.error);return}if(ip(pe))throw cu(400,{type:"defer-action"});let Ae=m.navigation.location||m.location,Ye=A0(e.history,Ae,He.signal),ct=a||n,St=m.navigation.state!=="idle"?Sm(ct,m.navigation.location,i):m.matches;Br(St,"Didn't find any matches after fetcher action");let Bt=++D;R.set(Ee,Bt);let rr=hn({state:"loading",data:pe.data},Ve,{" _hasFetcherDoneAnything ":!0});m.fetchers.set(Ee,rr);let[hr,Lt]=MF(e.history,m,St,Ve,Ae,C,w,A,H,ct,i,{[Se.route.id]:pe.data},void 0);Lt.filter(An=>An.key!==Ee).forEach(An=>{let fs=An.key,bh=m.fetchers.get(fs),zl={state:"loading",data:bh&&bh.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0};m.fetchers.set(fs,zl),An.controller&&I.set(fs,An.controller)}),J({fetchers:new Map(m.fetchers)});let En=()=>Lt.forEach(An=>ie(An.key));He.signal.addEventListener("abort",En);let{results:ha,loaderResults:pa,fetcherResults:ui}=await xe(m.matches,St,hr,Lt,Ye);if(He.signal.aborted)return;He.signal.removeEventListener("abort",En),R.delete(Ee),I.delete(Ee),Lt.forEach(An=>I.delete(An.key));let Vi=NF(ha);if(Vi)return be(m,Vi);let{loaderData:tn,errors:Xn}=kF(m,m.matches,hr,pa,void 0,Lt,ui,B),so={state:"idle",data:pe.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0};m.fetchers.set(Ee,so);let tu=ve(Bt);m.navigation.state==="loading"&&Bt>k?(Br(y,"Expected pending action"),S&&S.abort(),he(m.navigation.location,{matches:St,loaderData:tn,errors:Xn,fetchers:new Map(m.fetchers)})):(J(hn({errors:Xn,loaderData:OF(m.loaderData,tn,St,Xn)},tu?{fetchers:new Map(m.fetchers)}:{})),C=!1)}async function ce(Ee,Te,ye,Se,Le,Ve){let nt=m.fetchers.get(Ee),Xe=hn({state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},Ve,{data:nt&&nt.data," _hasFetcherDoneAnything ":!0});m.fetchers.set(Ee,Xe),J({fetchers:new Map(m.fetchers)});let He=new AbortController,se=A0(e.history,ye,He.signal);I.set(Ee,He);let pe=await E0("loader",se,Se,Le,r,t,i);if(ip(pe)&&(pe=await pq(pe,se.signal,!0)||pe),I.get(Ee)===He&&I.delete(Ee),se.signal.aborted)return;if(jm(pe)){L.add(Ee),await be(m,pe);return}if(By(pe)){let Ye=Cm(m.matches,Te);m.fetchers.delete(Ee),J({fetchers:new Map(m.fetchers),errors:{[Ye.route.id]:pe.error}});return}Br(!ip(pe),"Unhandled fetcher deferred data");let Ae={state:"idle",data:pe.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0};m.fetchers.set(Ee,Ae),J({fetchers:new Map(m.fetchers)})}async function be(Ee,Te,ye){var Se;let{submission:Le,replace:Ve,isFetchActionRedirect:nt}=ye===void 0?{}:ye;Te.revalidate&&(C=!0);let Xe=w1(Ee.location,Te.location,hn({_isRedirect:!0},nt?{_isFetchActionRedirect:!0}:{}));if(Br(Xe,"Expected a location on the redirect navigation"),lq.test(Te.location)&&cq&&typeof((Se=window)==null?void 0:Se.location)<"u"){let ct=e.history.createURL(Te.location),St=Ug(ct.pathname,i)==null;if(window.location.origin!==ct.origin||St){Ve?window.location.replace(Te.location):window.location.assign(Te.location);return}}S=null;let He=Ve===!0?Ta.Replace:Ta.Push,{formMethod:se,formAction:pe,formEncType:Ae,formData:Ye}=Ee.navigation;!Le&&se&&pe&&Ye&&Ae&&(Le={formMethod:se,formAction:pe,formEncType:Ae,formData:Ye}),xue.has(Te.status)&&Le&&oc(Le.formMethod)?await U(He,Xe,{submission:hn({},Le,{formAction:Te.location}),preventScrollReset:b}):nt?await U(He,Xe,{overrideNavigation:{state:"loading",location:Xe,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},fetcherSubmission:Le,preventScrollReset:b}):await U(He,Xe,{overrideNavigation:{state:"loading",location:Xe,formMethod:Le?Le.formMethod:void 0,formAction:Le?Le.formAction:void 0,formEncType:Le?Le.formEncType:void 0,formData:Le?Le.formData:void 0},preventScrollReset:b})}async function xe(Ee,Te,ye,Se,Le){let Ve=await Promise.all([...ye.map(He=>E0("loader",Le,He,Te,r,t,i)),...Se.map(He=>He.matches&&He.match&&He.controller?E0("loader",A0(e.history,He.path,He.controller.signal),He.match,He.matches,r,t,i):{type:ja.error,error:cu(404,{pathname:He.path})})]),nt=Ve.slice(0,ye.length),Xe=Ve.slice(ye.length);return await Promise.all([FF(Ee,ye,nt,nt.map(()=>Le.signal),!1,m.loaderData),FF(Ee,Se.map(He=>He.match),Xe,Se.map(He=>He.controller?He.controller.signal:null),!0)]),{results:Ve,loaderResults:nt,fetcherResults:Xe}}function Ie(){C=!0,w.push(...Ze()),H.forEach((Ee,Te)=>{I.has(Te)&&(A.push(Te),ie(Te))})}function _e(Ee,Te,ye){let Se=Cm(m.matches,Te);ae(Ee),J({errors:{[Se.route.id]:ye},fetchers:new Map(m.fetchers)})}function ae(Ee){I.has(Ee)&&ie(Ee),H.delete(Ee),R.delete(Ee),L.delete(Ee),m.fetchers.delete(Ee)}function ie(Ee){let Te=I.get(Ee);Br(Te,"Expected fetch controller: "+Ee),Te.abort(),I.delete(Ee)}function O(Ee){for(let Te of Ee){let Se={state:"idle",data:Y(Te).data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0};m.fetchers.set(Te,Se)}}function V(){let Ee=[],Te=!1;for(let ye of L){let Se=m.fetchers.get(ye);Br(Se,"Expected fetcher: "+ye),Se.state==="loading"&&(L.delete(ye),Ee.push(ye),Te=!0)}return O(Ee),Te}function ve(Ee){let Te=[];for(let[ye,Se]of R)if(Se<Ee){let Le=m.fetchers.get(ye);Br(Le,"Expected fetcher: "+ye),Le.state==="loading"&&(ie(ye),R.delete(ye),Te.push(ye))}return O(Te),Te.length>0}function Pe(Ee,Te){let ye=m.blockers.get(Ee)||TF;return j.get(Ee)!==Te&&j.set(Ee,Te),ye}function Me(Ee){m.blockers.delete(Ee),j.delete(Ee)}function Ge(Ee,Te){let ye=m.blockers.get(Ee)||TF;Br(ye.state==="unblocked"&&Te.state==="blocked"||ye.state==="blocked"&&Te.state==="blocked"||ye.state==="blocked"&&Te.state==="proceeding"||ye.state==="blocked"&&Te.state==="unblocked"||ye.state==="proceeding"&&Te.state==="unblocked","Invalid blocker state transition: "+ye.state+" -> "+Te.state),m.blockers.set(Ee,Te),J({blockers:new Map(m.blockers)})}function $e(Ee){let{currentLocation:Te,nextLocation:ye,historyAction:Se}=Ee;if(j.size===0)return;j.size>1&&fg(!1,"A router only supports one blocker at a time");let Le=Array.from(j.entries()),[Ve,nt]=Le[Le.length-1],Xe=m.blockers.get(Ve);if(!(Xe&&Xe.state==="proceeding")&&nt({currentLocation:Te,nextLocation:ye,historyAction:Se}))return Ve}function Ze(Ee){let Te=[];return B.forEach((ye,Se)=>{(!Ee||Ee(Se))&&(ye.cancel(),Te.push(Se),B.delete(Se))}),Te}function ht(Ee,Te,ye){if(l=Ee,d=Te,c=ye||(Se=>Se.key),!f&&m.navigation===uA){f=!0;let Se=rt(m.location,m.matches);Se!=null&&J({restoreScrollPosition:Se})}return()=>{l=null,d=null,c=null}}function Ue(Ee,Te){if(l&&c&&d){let ye=Te.map(Le=>BF(Le,m.loaderData)),Se=c(Ee,ye)||Ee.key;l[Se]=d()}}function rt(Ee,Te){if(l&&c&&d){let ye=Te.map(Ve=>BF(Ve,m.loaderData)),Se=c(Ee,ye)||Ee.key,Le=l[Se];if(typeof Le=="number")return Le}return null}function ut(Ee){r={},a=Q4(Ee,t,void 0,r)}return g={get basename(){return i},get state(){return m},get routes(){return n},initialize:G,subscribe:q,enableScrollRestoration:ht,navigate:$,fetch:Z,revalidate:X,createHref:Ee=>e.history.createHref(Ee),encodeLocation:Ee=>e.history.encodeLocation(Ee),getFetcher:Y,deleteFetcher:ae,dispose:W,getBlocker:Pe,deleteBlocker:Me,_internalFetchControllers:I,_internalActiveDeferreds:B,_internalSetRoutes:ut},g}function Eue(e){return e!=null&&"formData"in e}function Z4(e,t,r,n,a,i,o){let s,u;if(i!=null&&o!=="path"){s=[];for(let c of t)if(s.push(c),c.route.id===i){u=c;break}}else s=t,u=t[t.length-1];let l=mR(a||".",Ow(s).map(c=>c.pathnameBase),Ug(e.pathname,r)||e.pathname,o==="path");return a==null&&(l.search=e.search,l.hash=e.hash),(a==null||a===""||a===".")&&u&&u.route.index&&!yR(l.search)&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),n&&r!=="/"&&(l.pathname=l.pathname==="/"?r:Pc([r,l.pathname])),Dp(l)}function IF(e,t,r,n){if(!n||!Eue(n))return{path:r};if(n.formMethod&&!Rue(n.formMethod))return{path:r,error:cu(405,{method:n.formMethod})};let a;if(n.formData){let s=n.formMethod||"get";if(a={formMethod:e?s.toUpperCase():s.toLowerCase(),formAction:hq(r),formEncType:n&&n.formEncType||"application/x-www-form-urlencoded",formData:n.formData},oc(a.formMethod))return{path:r,submission:a}}let i=sd(r),o=fq(n.formData);return t&&i.search&&yR(i.search)&&o.append("index",""),i.search="?"+o,{path:Dp(i),submission:a}}function Aue(e,t){let r=e;if(t){let n=e.findIndex(a=>a.route.id===t);n>=0&&(r=e.slice(0,n))}return r}function MF(e,t,r,n,a,i,o,s,u,l,c,d,f){let h=f?Object.values(f)[0]:d?Object.values(d)[0]:void 0,v=e.createURL(t.location),p=e.createURL(a),g=f?Object.keys(f)[0]:void 0,y=Aue(r,g).filter((S,x)=>{if(S.route.lazy)return!0;if(S.route.loader==null)return!1;if(Pue(t.loaderData,t.matches[x],S)||o.some(A=>A===S.route.id))return!0;let C=t.matches[x],w=S;return DF(S,hn({currentUrl:v,currentParams:C.params,nextUrl:p,nextParams:w.params},n,{actionResult:h,defaultShouldRevalidate:i||v.pathname+v.search===p.pathname+p.search||v.search!==p.search||dq(C,w)}))}),b=[];return u.forEach((S,x)=>{if(!r.some(I=>I.route.id===S.routeId))return;let C=Sm(l,S.path,c);if(!C){b.push({key:x,routeId:S.routeId,path:S.path,matches:null,match:null,controller:null});return}let w=J4(C,S.path);if(s.includes(x)){b.push({key:x,routeId:S.routeId,path:S.path,matches:C,match:w,controller:new AbortController});return}DF(w,hn({currentUrl:v,currentParams:t.matches[t.matches.length-1].params,nextUrl:p,nextParams:r[r.length-1].params},n,{actionResult:h,defaultShouldRevalidate:i}))&&b.push({key:x,routeId:S.routeId,path:S.path,matches:C,match:w,controller:new AbortController})}),[y,b]}function Pue(e,t,r){let n=!t||r.route.id!==t.route.id,a=e[r.route.id]===void 0;return n||a}function dq(e,t){let r=e.route.path;return e.pathname!==t.pathname||r!=null&&r.endsWith("*")&&e.params["*"]!==t.params["*"]}function DF(e,t){if(e.route.shouldRevalidate){let r=e.route.shouldRevalidate(t);if(typeof r=="boolean")return r}return t.defaultShouldRevalidate}async function RF(e,t,r){if(!e.lazy)return;let n=await e.lazy();if(!e.lazy)return;let a=r[e.id];Br(a,"No route found in manifest");let i={};for(let o in n){let u=a[o]!==void 0&&o!=="hasErrorBoundary";fg(!u,'Route "'+a.id+'" has a static property "'+o+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+o+'" will be ignored.')),!u&&!Yse.has(o)&&(i[o]=n[o])}Object.assign(a,i),Object.assign(a,hn({},t(a),{lazy:void 0}))}async function E0(e,t,r,n,a,i,o,s,u,l){s===void 0&&(s=!1),u===void 0&&(u=!1);let c,d,f,h=g=>{let m,y=new Promise((b,S)=>m=S);return f=()=>m(),t.signal.addEventListener("abort",f),Promise.race([g({request:t,params:r.params,context:l}),y])};try{let g=r.route[e];if(r.route.lazy)if(g)d=(await Promise.all([h(g),RF(r.route,i,a)]))[0];else if(await RF(r.route,i,a),g=r.route[e],g)d=await h(g);else if(e==="action"){let m=new URL(t.url),y=m.pathname+m.search;throw cu(405,{method:t.method,pathname:y,routeId:r.route.id})}else return{type:ja.data,data:void 0};else if(g)d=await h(g);else{let m=new URL(t.url),y=m.pathname+m.search;throw cu(404,{pathname:y})}Br(d!==void 0,"You defined "+(e==="action"?"an action":"a loader")+" for route "+('"'+r.route.id+"\" but didn't return anything from your `"+e+"` ")+"function. Please return a value or `null`.")}catch(g){c=ja.error,d=g}finally{f&&t.signal.removeEventListener("abort",f)}if(Due(d)){let g=d.status;if(bue.has(g)){let b=d.headers.get("Location");if(Br(b,"Redirects returned/thrown from loaders/actions must have a Location header"),!lq.test(b))b=Z4(new URL(t.url),n.slice(0,n.indexOf(r)+1),o,!0,b);else if(!s){let S=new URL(t.url),x=b.startsWith("//")?new URL(S.protocol+b):new URL(b),C=Ug(x.pathname,o)!=null;x.origin===S.origin&&C&&(b=x.pathname+x.search+x.hash)}if(s)throw d.headers.set("Location",b),d;return{type:ja.redirect,status:g,location:b,revalidate:d.headers.get("X-Remix-Revalidate")!==null}}if(u)throw{type:c||ja.data,response:d};let m,y=d.headers.get("Content-Type");return y&&/\bapplication\/json\b/.test(y)?m=await d.json():m=await d.text(),c===ja.error?{type:c,error:new gR(g,d.statusText,m),headers:d.headers}:{type:ja.data,data:m,statusCode:d.status,headers:d.headers}}if(c===ja.error)return{type:c,error:d};if(Mue(d)){var v,p;return{type:ja.deferred,deferredData:d,statusCode:(v=d.init)==null?void 0:v.status,headers:((p=d.init)==null?void 0:p.headers)&&new Headers(d.init.headers)}}return{type:ja.data,data:d}}function A0(e,t,r,n){let a=e.createURL(hq(t)).toString(),i={signal:r};if(n&&oc(n.formMethod)){let{formMethod:o,formEncType:s,formData:u}=n;i.method=o.toUpperCase(),i.body=s==="application/x-www-form-urlencoded"?fq(u):u}return new Request(a,i)}function fq(e){let t=new URLSearchParams;for(let[r,n]of e.entries())t.append(r,n instanceof File?n.name:n);return t}function Tue(e,t,r,n,a){let i={},o=null,s,u=!1,l={};return r.forEach((c,d)=>{let f=t[d].route.id;if(Br(!jm(c),"Cannot handle redirect results in processLoaderData"),By(c)){let h=Cm(e,f),v=c.error;n&&(v=Object.values(n)[0],n=void 0),o=o||{},o[h.route.id]==null&&(o[h.route.id]=v),i[f]=void 0,u||(u=!0,s=sq(c.error)?c.error.status:500),c.headers&&(l[f]=c.headers)}else ip(c)?(a.set(f,c.deferredData),i[f]=c.deferredData.data):i[f]=c.data,c.statusCode!=null&&c.statusCode!==200&&!u&&(s=c.statusCode),c.headers&&(l[f]=c.headers)}),n&&(o=n,i[Object.keys(n)[0]]=void 0),{loaderData:i,errors:o,statusCode:s||200,loaderHeaders:l}}function kF(e,t,r,n,a,i,o,s){let{loaderData:u,errors:l}=Tue(t,r,n,a,s);for(let c=0;c<i.length;c++){let{key:d,match:f,controller:h}=i[c];Br(o!==void 0&&o[c]!==void 0,"Did not find corresponding fetcher result");let v=o[c];if(!(h&&h.signal.aborted))if(By(v)){let p=Cm(e.matches,f==null?void 0:f.route.id);l&&l[p.route.id]||(l=hn({},l,{[p.route.id]:v.error})),e.fetchers.delete(d)}else if(jm(v))Br(!1,"Unhandled fetcher revalidation redirect");else if(ip(v))Br(!1,"Unhandled fetcher deferred data");else{let p={state:"idle",data:v.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0};e.fetchers.set(d,p)}}return{loaderData:u,errors:l}}function OF(e,t,r,n){let a=hn({},t);for(let i of r){let o=i.route.id;if(t.hasOwnProperty(o)?t[o]!==void 0&&(a[o]=t[o]):e[o]!==void 0&&i.route.loader&&(a[o]=e[o]),n&&n.hasOwnProperty(o))break}return a}function Cm(e,t){return(t?e.slice(0,e.findIndex(n=>n.route.id===t)+1):[...e]).reverse().find(n=>n.route.hasErrorBoundary===!0)||e[0]}function LF(e){let t=e.find(r=>r.index||!r.path||r.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t}}function cu(e,t){let{pathname:r,routeId:n,method:a,type:i}=t===void 0?{}:t,o="Unknown Server Error",s="Unknown @remix-run/router error";return e===400?(o="Bad Request",a&&r&&n?s="You made a "+a+' request to "'+r+'" but '+('did not provide a `loader` for route "'+n+'", ')+"so there is no way to handle the request.":i==="defer-action"&&(s="defer() is not supported in actions")):e===403?(o="Forbidden",s='Route "'+n+'" does not match URL "'+r+'"'):e===404?(o="Not Found",s='No route matches URL "'+r+'"'):e===405&&(o="Method Not Allowed",a&&r&&n?s="You made a "+a.toUpperCase()+' request to "'+r+'" but '+('did not provide an `action` for route "'+n+'", ')+"so there is no way to handle the request.":a&&(s='Invalid request method "'+a.toUpperCase()+'"')),new gR(e||500,o,new Error(s),!0)}function NF(e){for(let t=e.length-1;t>=0;t--){let r=e[t];if(jm(r))return r}}function hq(e){let t=typeof e=="string"?sd(e):e;return Dp(hn({},t,{hash:""}))}function Iue(e,t){return e.pathname!==t.pathname||e.search!==t.search?!1:e.hash===""?t.hash!=="":e.hash===t.hash?!0:t.hash!==""}function ip(e){return e.type===ja.deferred}function By(e){return e.type===ja.error}function jm(e){return(e&&e.type)===ja.redirect}function Mue(e){let t=e;return t&&typeof t=="object"&&typeof t.data=="object"&&typeof t.subscribe=="function"&&typeof t.cancel=="function"&&typeof t.resolveData=="function"}function Due(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function Rue(e){return yue.has(e.toLowerCase())}function oc(e){return mue.has(e.toLowerCase())}async function FF(e,t,r,n,a,i){for(let o=0;o<r.length;o++){let s=r[o],u=t[o];if(!u)continue;let l=e.find(d=>d.route.id===u.route.id),c=l!=null&&!dq(l,u)&&(i&&i[u.route.id])!==void 0;if(ip(s)&&(a||c)){let d=n[o];Br(d,"Expected an AbortSignal for revalidating fetcher deferred result"),await pq(s,d,a).then(f=>{f&&(r[o]=f||r[o])})}}}async function pq(e,t,r){if(r===void 0&&(r=!1),!await e.deferredData.resolveData(t)){if(r)try{return{type:ja.data,data:e.deferredData.unwrappedData}}catch(a){return{type:ja.error,error:a}}return{type:ja.data,data:e.deferredData.data}}}function yR(e){return new URLSearchParams(e).getAll("index").some(t=>t==="")}function BF(e,t){let{route:r,pathname:n,params:a}=e;return{id:r.id,pathname:n,params:a,data:t[r.id],handle:r.handle}}function J4(e,t){let r=typeof t=="string"?sd(t).search:t.search;if(e[e.length-1].route.index&&yR(r||""))return e[e.length-1];let n=Ow(e);return n[n.length-1]}/**
 * React Router v6.11.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function JS(){return JS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JS.apply(this,arguments)}const Lw=ze.createContext(null),bR=ze.createContext(null),iv=ze.createContext(null),Nw=ze.createContext(null),fh=ze.createContext({outlet:null,matches:[],isDataRoute:!1}),vq=ze.createContext(null);function kue(e,t){let{relative:r}=t===void 0?{}:t;pb()||Br(!1);let{basename:n,navigator:a}=ze.useContext(iv),{hash:i,pathname:o,search:s}=SR(e,{relative:r}),u=o;return n!=="/"&&(u=o==="/"?n:Pc([n,o])),a.createHref({pathname:u,search:s,hash:i})}function pb(){return ze.useContext(Nw)!=null}function Ks(){return pb()||Br(!1),ze.useContext(Nw).location}function mq(e){ze.useContext(iv).static||ze.useLayoutEffect(e)}function xR(){let{isDataRoute:e}=ze.useContext(fh);return e?$ue():Oue()}function Oue(){pb()||Br(!1);let e=ze.useContext(Lw),{basename:t,navigator:r}=ze.useContext(iv),{matches:n}=ze.useContext(fh),{pathname:a}=Ks(),i=JSON.stringify(Ow(n).map(u=>u.pathnameBase)),o=ze.useRef(!1);return mq(()=>{o.current=!0}),ze.useCallback(function(u,l){if(l===void 0&&(l={}),!o.current)return;if(typeof u=="number"){r.go(u);return}let c=mR(u,JSON.parse(i),a,l.relative==="path");e==null&&t!=="/"&&(c.pathname=c.pathname==="/"?t:Pc([t,c.pathname])),(l.replace?r.replace:r.push)(c,l.state,l)},[t,r,i,a,e])}const Lue=ze.createContext(null);function Nue(e){let t=ze.useContext(fh).outlet;return t&&ze.createElement(Lue.Provider,{value:e},t)}function SR(e,t){let{relative:r}=t===void 0?{}:t,{matches:n}=ze.useContext(fh),{pathname:a}=Ks(),i=JSON.stringify(Ow(n).map(o=>o.pathnameBase));return ze.useMemo(()=>mR(e,JSON.parse(i),a,r==="path"),[e,i,a,r])}function Fue(e,t,r){pb()||Br(!1);let{navigator:n}=ze.useContext(iv),{matches:a}=ze.useContext(fh),i=a[a.length-1],o=i?i.params:{};i&&i.pathname;let s=i?i.pathnameBase:"/";i&&i.route;let u=Ks(),l;if(t){var c;let p=typeof t=="string"?sd(t):t;s==="/"||(c=p.pathname)!=null&&c.startsWith(s)||Br(!1),l=p}else l=u;let d=l.pathname||"/",f=s==="/"?d:d.slice(s.length)||"/",h=Sm(e,{pathname:f}),v=Vue(h&&h.map(p=>Object.assign({},p,{params:Object.assign({},o,p.params),pathname:Pc([s,n.encodeLocation?n.encodeLocation(p.pathname).pathname:p.pathname]),pathnameBase:p.pathnameBase==="/"?s:Pc([s,n.encodeLocation?n.encodeLocation(p.pathnameBase).pathname:p.pathnameBase])})),a,r);return t&&v?ze.createElement(Nw.Provider,{value:{location:JS({pathname:"/",search:"",hash:"",state:null,key:"default"},l),navigationType:Ta.Pop}},v):v}function Bue(){let e=Wue(),t=sq(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return ze.createElement(ze.Fragment,null,ze.createElement("h2",null,"Unexpected Application Error!"),ze.createElement("h3",{style:{fontStyle:"italic"}},t),r?ze.createElement("pre",{style:a},r):null,i)}const Uue=ze.createElement(Bue,null);class jue extends ze.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error||r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error?ze.createElement(fh.Provider,{value:this.props.routeContext},ze.createElement(vq.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function zue(e){let{routeContext:t,match:r,children:n}=e,a=ze.useContext(Lw);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),ze.createElement(fh.Provider,{value:t},n)}function Vue(e,t,r){var n;if(t===void 0&&(t=[]),r===void 0&&(r=null),e==null){var a;if((a=r)!=null&&a.errors)e=r.matches;else return null}let i=e,o=(n=r)==null?void 0:n.errors;if(o!=null){let s=i.findIndex(u=>u.route.id&&(o==null?void 0:o[u.route.id]));s>=0||Br(!1),i=i.slice(0,Math.min(i.length,s+1))}return i.reduceRight((s,u,l)=>{let c=u.route.id?o==null?void 0:o[u.route.id]:null,d=null;r&&(d=u.route.errorElement||Uue);let f=t.concat(i.slice(0,l+1)),h=()=>{let v;return c?v=d:u.route.Component?v=ze.createElement(u.route.Component,null):u.route.element?v=u.route.element:v=s,ze.createElement(zue,{match:u,routeContext:{outlet:s,matches:f,isDataRoute:r!=null},children:v})};return r&&(u.route.ErrorBoundary||u.route.errorElement||l===0)?ze.createElement(jue,{location:r.location,revalidation:r.revalidation,component:d,error:c,children:h(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):h()},null)}var eI;(function(e){e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate"})(eI||(eI={}));var E1;(function(e){e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId"})(E1||(E1={}));function Hue(e){let t=ze.useContext(Lw);return t||Br(!1),t}function Gue(e){let t=ze.useContext(bR);return t||Br(!1),t}function que(e){let t=ze.useContext(fh);return t||Br(!1),t}function gq(e){let t=que(),r=t.matches[t.matches.length-1];return r.route.id||Br(!1),r.route.id}function Wue(){var e;let t=ze.useContext(vq),r=Gue(E1.UseRouteError),n=gq(E1.UseRouteError);return t||((e=r.errors)==null?void 0:e[n])}function $ue(){let{router:e}=Hue(eI.UseNavigateStable),t=gq(E1.UseNavigateStable),r=ze.useRef(!1);return mq(()=>{r.current=!0}),ze.useCallback(function(a,i){i===void 0&&(i={}),r.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,JS({fromRouteId:t},i)))},[e,t])}function Xue(e){let{fallbackElement:t,router:r}=e,[n,a]=ze.useState(r.state);ze.useLayoutEffect(()=>r.subscribe(a),[r,a]);let i=ze.useMemo(()=>({createHref:r.createHref,encodeLocation:r.encodeLocation,go:u=>r.navigate(u),push:(u,l,c)=>r.navigate(u,{state:l,preventScrollReset:c==null?void 0:c.preventScrollReset}),replace:(u,l,c)=>r.navigate(u,{replace:!0,state:l,preventScrollReset:c==null?void 0:c.preventScrollReset})}),[r]),o=r.basename||"/",s=ze.useMemo(()=>({router:r,navigator:i,static:!1,basename:o}),[r,i,o]);return ze.createElement(ze.Fragment,null,ze.createElement(Lw.Provider,{value:s},ze.createElement(bR.Provider,{value:n},ze.createElement(Kue,{basename:r.basename,location:r.state.location,navigationType:r.state.historyAction,navigator:i},r.state.initialized?ze.createElement(Yue,{routes:r.routes,state:n}):t))),null)}function Yue(e){let{routes:t,state:r}=e;return Fue(t,void 0,r)}function A1(e){return Nue(e.context)}function mo(e){Br(!1)}function Kue(e){let{basename:t="/",children:r=null,location:n,navigationType:a=Ta.Pop,navigator:i,static:o=!1}=e;pb()&&Br(!1);let s=t.replace(/^\/*/,"/"),u=ze.useMemo(()=>({basename:s,navigator:i,static:o}),[s,i,o]);typeof n=="string"&&(n=sd(n));let{pathname:l="/",search:c="",hash:d="",state:f=null,key:h="default"}=n,v=ze.useMemo(()=>{let p=Ug(l,s);return p==null?null:{location:{pathname:p,search:c,hash:d,state:f,key:h},navigationType:a}},[s,l,c,d,f,h,a]);return v==null?null:ze.createElement(iv.Provider,{value:u},ze.createElement(Nw.Provider,{children:r,value:v}))}var UF;(function(e){e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error"})(UF||(UF={}));new Promise(()=>{});function tI(e,t){t===void 0&&(t=[]);let r=[];return ze.Children.forEach(e,(n,a)=>{if(!ze.isValidElement(n))return;let i=[...t,a];if(n.type===ze.Fragment){r.push.apply(r,tI(n.props.children,i));return}n.type!==mo&&Br(!1),!n.props.index||!n.props.children||Br(!1);let o={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=tI(n.props.children,i)),r.push(o)}),r}function Que(e){let t={hasErrorBoundary:e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&Object.assign(t,{element:ze.createElement(e.Component),Component:void 0}),e.ErrorBoundary&&Object.assign(t,{errorElement:ze.createElement(e.ErrorBoundary),ErrorBoundary:void 0}),t}/**
 * React Router DOM v6.11.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hg(){return hg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hg.apply(this,arguments)}function yq(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,i;for(i=0;i<n.length;i++)a=n[i],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function Zue(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Jue(e,t){return e.button===0&&(!t||t==="_self")&&!Zue(e)}const ele=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"],tle=["aria-current","caseSensitive","className","end","style","to","children"];function rle(e,t){return wue({basename:t==null?void 0:t.basename,future:hg({},t==null?void 0:t.future,{v7_prependBasename:!0}),history:Wse({window:t==null?void 0:t.window}),hydrationData:(t==null?void 0:t.hydrationData)||nle(),routes:e,mapRouteProperties:Que}).initialize()}function nle(){var e;let t=(e=window)==null?void 0:e.__staticRouterHydrationData;return t&&t.errors&&(t=hg({},t,{errors:ale(t.errors)})),t}function ale(e){if(!e)return null;let t=Object.entries(e),r={};for(let[n,a]of t)if(a&&a.__type==="RouteErrorResponse")r[n]=new gR(a.status,a.statusText,a.data,a.internal===!0);else if(a&&a.__type==="Error"){let i=new Error(a.message);i.stack="",r[n]=i}else r[n]=a;return r}const ile=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ole=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,sle=ze.forwardRef(function(t,r){let{onClick:n,relative:a,reloadDocument:i,replace:o,state:s,target:u,to:l,preventScrollReset:c}=t,d=yq(t,ele),{basename:f}=ze.useContext(iv),h,v=!1;if(typeof l=="string"&&ole.test(l)&&(h=l,ile))try{let y=new URL(window.location.href),b=l.startsWith("//")?new URL(y.protocol+l):new URL(l),S=Ug(b.pathname,f);b.origin===y.origin&&S!=null?l=S+b.search+b.hash:v=!0}catch{}let p=kue(l,{relative:a}),g=ule(l,{replace:o,state:s,target:u,preventScrollReset:c,relative:a});function m(y){n&&n(y),y.defaultPrevented||g(y)}return ze.createElement("a",hg({},d,{href:h||p,onClick:v||i?n:m,ref:r,target:u}))}),Fw=ze.forwardRef(function(t,r){let{"aria-current":n="page",caseSensitive:a=!1,className:i="",end:o=!1,style:s,to:u,children:l}=t,c=yq(t,tle),d=SR(u,{relative:c.relative}),f=Ks(),h=ze.useContext(bR),{navigator:v}=ze.useContext(iv),p=v.encodeLocation?v.encodeLocation(d).pathname:d.pathname,g=f.pathname,m=h&&h.navigation&&h.navigation.location?h.navigation.location.pathname:null;a||(g=g.toLowerCase(),m=m?m.toLowerCase():null,p=p.toLowerCase());let y=g===p||!o&&g.startsWith(p)&&g.charAt(p.length)==="/",b=m!=null&&(m===p||!o&&m.startsWith(p)&&m.charAt(p.length)==="/"),S=y?n:void 0,x;typeof i=="function"?x=i({isActive:y,isPending:b}):x=[i,y?"active":null,b?"pending":null].filter(Boolean).join(" ");let C=typeof s=="function"?s({isActive:y,isPending:b}):s;return ze.createElement(sle,hg({},c,{"aria-current":S,className:x,ref:r,style:C,to:u}),typeof l=="function"?l({isActive:y,isPending:b}):l)});var jF;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmitImpl="useSubmitImpl",e.UseFetcher="useFetcher"})(jF||(jF={}));var zF;(function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(zF||(zF={}));function ule(e,t){let{target:r,replace:n,state:a,preventScrollReset:i,relative:o}=t===void 0?{}:t,s=xR(),u=Ks(),l=SR(e,{relative:o});return ze.useCallback(c=>{if(Jue(c,r)){c.preventDefault();let d=n!==void 0?n:Dp(u)===Dp(l);s(e,{replace:d,state:a,preventScrollReset:i,relative:o})}},[u,s,l,n,a,r,e,i,o])}const Qi=e=>e.disabled?M.jsx("span",{className:e.className,ref:e.buttonRef,children:e.text}):M.jsx(Fw,{to:e.to?e.to:"/",className:e.className,ref:e.buttonRef,onClick:e.onClick,children:e.text});Qi.defaultProps={buttonRef:null,to:"",text:"",className:"",onClick:()=>{},disabled:!1};const ks=e=>M.jsxs("div",{className:"input__text",children:[e.text,M.jsx("input",{className:e.className,onChange:e.onChange,placeholder:e.placeholder,type:e.type,ref:e.inputRef})]});ks.defaultProps={onChange:()=>{},className:"",text:"",type:"",placeholder:"placeholder",inputRef:null};const wu=e=>M.jsx("label",{className:e.className,ref:e.labelRef,onClick:e.onClick,children:e.text});wu.defaultProps={labelRef:null,text:"",className:"",onClick:()=>{}};const bq=e=>M.jsx("input",{className:e.className,onChange:e.onChange,placeholder:e.placeholder,value:e.value,type:"search",ref:e.inputRef});bq.defaultProps={inputRef:null,className:"",onChange:()=>{},placeholder:"placeholder",value:""};const lle="ADD_PROTEIN",cle=e=>({type:lle,payload:e}),dle="AUTH_LOGIN",xq=e=>({type:dle,payload:e}),fle="SET_CURRENT_PROTEIN",hle=e=>({type:fle,payload:e}),ple="SET_LOAD_STATE",pg=e=>({type:ple,payload:e}),vle="SET_PROTEIN_LIST",Sq=e=>({type:vle,payload:e}),mle="UPDATE_LINK",Cq=e=>({type:mle,payload:e}),gle="UPDATE_SEARCH",P0=e=>({type:gle,payload:e}),yle="SET_CURRENT_PATH",Nf=e=>({type:yle,payload:e});async function _q(e=""){let t={results:[],newlink:""};return e&&await fetch(e,{method:"GET"}).then(r=>{var a,i;const n=r.headers;return console.log("length =",n.get("length")),t.newlink=(i=n.get("link"))==null?void 0:i.substring(1,(a=n.get("link"))==null?void 0:a.indexOf(">")),r.json()}).then(r=>{t.results=r.results.map(n=>({entry:n.primaryAccession?n.primaryAccession:"",entryNames:n.uniProtkbId?n.uniProtkbId:"",genesPrimary:n.genes&&n.genes[0].geneName&&n.genes[0].geneName.value?n.genes[0].geneName.value:"",genesSecondary:n.genes&&n.genes[0].synonyms?n.genes[0].synonyms.map(a=>" "+a.value):[],organismName:n.organism?n.organism.scientificName:"",sublocation:n.comments&&n.comments[0]&&n.comments[0].subcellularLocations?n.comments[0].subcellularLocations.map(a=>a.location.value):"",length:n.sequence?n.sequence.length:0}))}).catch(r=>{window.alert(`Error while getting data from Server:
`+r.message)}),t}const VF=()=>{const e=ze.useRef(null),t=Ks(),r=Bg(),n=Eo(s=>s.currentPath),a=Eo(s=>s.searchStr);ze.useEffect(()=>{t.search.replace("?query=","")!==a&&(r(P0(t.search.replace("?query=",""))),r(Nf(t.search)))},[t]);const i=ze.useCallback(()=>{let s="",u="";e&&e.current?(u=encodeURIComponent(e.current.value),s="/search?query="+u,r(Nf(s)),r(P0(u))):(s="/Home",r(Nf(s)),r(P0("")))},[t]),o=ze.useCallback(()=>{r(pg(!0));let s="";e&&e.current?(s=e.current.value,r(P0(s))):r(P0(""));const u=`https://rest.uniprot.org/uniprotkb/search?&query=${s}&fields=accession,id,gene_names,organism_name,length,cc_subcellular_location`;_q(u).then(l=>{r(Sq(l.results)),l.newlink&&r(Cq(l.newlink))}).catch(l=>window.alert("error while fetch: "+l.message)).finally(()=>{r(pg(!1))})},[t]);return M.jsxs("div",{className:"searchbar",children:[M.jsx(bq,{className:"search__string",onChange:i,placeholder:"Search",inputRef:e,value:a}),M.jsx(Qi,{className:"button button__search",to:n,onClick:o,text:"Search"}),M.jsx(Qi,{className:"button button__filter",to:t.pathname.replace("/filter","")+"/filter"+t.search,text:""})]})},ble=()=>{const e=Bg(),t=Eo(n=>n.auth),r=ze.useCallback(()=>{e(xq({login:"",uid:""}))},[t]);return M.jsxs("div",{className:"topbar",children:[M.jsx(Fw,{to:"/",onClick:r,className:"topbar__link",children:"Logout"}),t.login]})},xle=()=>{const e=Eo(a=>a.proteinList),t=Eo(a=>a.searchStr),[r,n]=ze.useState("");return ze.useEffect(()=>{n(t)},[]),M.jsxs("div",{className:"table",children:[e.length+" Search Results for "+r,M.jsx(Cle,{}),M.jsx(wle,{})]})},Sle=()=>M.jsxs("div",{className:"tablePlaceHolder",children:[M.jsx("div",{children:"No data to display"}),M.jsx("div",{children:"Please start search to display results"})]}),Kd=e=>{const t=Ks();return M.jsxs("div",{className:e.className,children:[M.jsx(wu,{className:"table__headLabel",text:e.text}),M.jsx(Qi,{className:e.disabled?"button__sort button__sort--disabled":"button__sort",onClick:e.onClick,disabled:e.disabled,to:t.pathname})]})};Kd.defaultProps={buttonRef:null,to:"",text:"",className:"",onClick:()=>{},disabled:!1};const Cle=()=>M.jsxs("div",{className:"listRow",children:[M.jsx(Kd,{disabled:!0,className:"headLabel headLabel--1",text:"#"}),M.jsx(Kd,{className:"headLabel headLabel--2",text:"Entry"}),M.jsx(Kd,{className:"headLabel headLabel--3",text:"Entry Names"}),M.jsx(Kd,{className:"headLabel headLabel--4",text:"Genes"}),M.jsx(Kd,{className:"headLabel headLabel--5",text:"Organism"}),M.jsx(Kd,{className:"headLabel headLabel--6",disabled:!0,text:"Subcellular Location"}),M.jsx(Kd,{className:"headLabel headLabel--7",text:"Length"})]});async function _le(e=""){let t={};return e&&await fetch(e,{method:"GET"}).then(r=>r.json()).then(r=>{t=r}).catch(r=>{window.alert(`Error while getting data from Server:
`+r.message)}),t}const wq=e=>{const t=Bg(),r=xR(),n=ze.useCallback(()=>{t(pg(!0));const a=`https://rest.uniprot.org/uniprotkb/${e.entry}`,i=`/protein/${e.entry}`;console.log("intest"),_le(a).then(o=>{console.log("test",o),t(hle(o))}).catch(o=>{window.alert(o.message)}).finally(()=>{t(pg(!1))}),r(i),t(Nf(i)),console.log("go to ",e.entry)},[e.entry]);return M.jsxs("div",{className:"tableRow",children:[M.jsx(Qd,{className:"itemLabel itemLabel--1",text:e.index}),M.jsx(Qd,{className:"itemLabel itemLabel--2",onClick:n,text:e.entry}),M.jsx(Qd,{className:"itemLabel itemLabel--3",text:e.entryNames}),M.jsx(Qd,{className:"itemLabel itemLabel--4",text:e.genes}),M.jsx(Qd,{className:"itemLabel itemLabel--5",text:e.organism}),M.jsx(Qd,{className:"itemLabel itemLabel--6",text:e.sublocation}),M.jsx(Qd,{className:"itemLabel itemLabel--7",text:e.length})]})};wq.defaultProps={index:0,entry:"entry",entryNames:"entry names",genes:"geneName",organism:"organism",sublocation:"sublocation",length:0};const Qd=e=>M.jsx("div",{className:e.className,children:M.jsx(wu,{className:"table__itemLabel",onClick:e.onClick,text:e.text})});Qd.defaultProps={buttonRef:null,to:"",text:"",className:"",onClick:()=>{},disabled:!1};const wle=()=>{const e=Eo(u=>u.proteinList),t=Eo(u=>u.link),r=Bg(),n=ze.useRef(null),[a,i]=ze.useState(!1),[o,s]=ze.useState(0);return ze.useEffect(()=>{const u=n.current,l=()=>{u&&(console.log(u.scrollTop,"---",u.clientHeight),Math.floor(u.scrollHeight-u.scrollTop)+1===u.clientHeight&&t&&(i(!0),s(u.scrollTop),_q(t).then(c=>{var d;(d=c.results)==null||d.map(f=>r(cle(f))),c.newlink&&r(Cq(c.newlink))}).catch(c=>window.alert("error while fetch: "+c.message)).finally(()=>{i(!1)})))};return u&&(u==null||u.addEventListener("scroll",l),u.scrollTop=o),()=>{u==null||u.removeEventListener("scroll",l)}},[t,a]),a?M.jsx(yW,{}):M.jsx("div",{className:"tableRows",ref:n,children:e.map((u,l)=>{var c,d;return M.jsx(wq,{index:l,entry:u.entry,entryNames:u.entryNames,genes:u.genesPrimary+(u.genesSecondary?", "+u.genesSecondary:""),organism:(d=u.organismName)==null?void 0:d.substring(0,((c=u.organismName)==null?void 0:c.indexOf("("))>0?u.organismName.indexOf("("):u.organismName.length),sublocation:u.sublocation,length:u.length},u.primaryAccession?u.primaryAccession:l)})})},Ele=()=>{const e=Ks();return M.jsxs("div",{className:"loginContainer",children:[M.jsx("h1",{children:"Q1-Search"}),M.jsx("ul",{children:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt u"}),M.jsx(Qi,{className:"button button__login--initial",text:"Login",to:e.pathname+"Login"})]})},HF=()=>{const e=Ks(),t=ze.useRef(null),r=ze.useRef(null),n=ze.useRef(null),a=ze.useRef(null),i=ze.useRef(null),o=ze.useRef(null),s=ze.useCallback(()=>{},[e]);return M.jsxs("div",{className:"filrterModal__container",children:[M.jsx(wu,{className:"filter_label",text:"Filters"}),M.jsx(ks,{className:"filter_input",placeholder:"Enter Gene Name",inputRef:t,text:"Gene Name"}),M.jsx(ks,{className:"filter_input",placeholder:"Select an option",inputRef:r,text:"Organism"}),M.jsxs("div",{children:[M.jsx(wu,{className:"sequence_label",text:"Sequence length"}),M.jsxs("div",{className:"sequence",children:[M.jsx(ks,{className:"filter_input input_sequence",placeholder:"From",inputRef:n,text:""}),M.jsx(wu,{className:"sequence_label",text:""}),M.jsx(ks,{className:"filter_input input_sequence",placeholder:"To",inputRef:a,text:""})]})]}),M.jsx(ks,{className:"filter_input",placeholder:"Select an option",inputRef:i,text:"Annotation score"}),M.jsx(ks,{className:"filter_input",placeholder:"Select",inputRef:o,text:"Protein with"}),M.jsxs("div",{className:"filter_button_container",children:[M.jsx(Qi,{className:"button button__filter--cancel",text:"cancel",to:e.pathname.replace("/filter","")+e.search}),M.jsx(Qi,{className:"button button__filter--apply",onClick:s,text:"Apply Filters",to:e.pathname.replace("/filter","")+e.search})]})]})};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eq=function(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let a=e.charCodeAt(n);a<128?t[r++]=a:a<2048?(t[r++]=a>>6|192,t[r++]=a&63|128):(a&64512)===55296&&n+1<e.length&&(e.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(e.charCodeAt(++n)&1023),t[r++]=a>>18|240,t[r++]=a>>12&63|128,t[r++]=a>>6&63|128,t[r++]=a&63|128):(t[r++]=a>>12|224,t[r++]=a>>6&63|128,t[r++]=a&63|128)}return t},Ale=function(e){const t=[];let r=0,n=0;for(;r<e.length;){const a=e[r++];if(a<128)t[n++]=String.fromCharCode(a);else if(a>191&&a<224){const i=e[r++];t[n++]=String.fromCharCode((a&31)<<6|i&63)}else if(a>239&&a<365){const i=e[r++],o=e[r++],s=e[r++],u=((a&7)<<18|(i&63)<<12|(o&63)<<6|s&63)-65536;t[n++]=String.fromCharCode(55296+(u>>10)),t[n++]=String.fromCharCode(56320+(u&1023))}else{const i=e[r++],o=e[r++];t[n++]=String.fromCharCode((a&15)<<12|(i&63)<<6|o&63)}}return t.join("")},Aq={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<e.length;a+=3){const i=e[a],o=a+1<e.length,s=o?e[a+1]:0,u=a+2<e.length,l=u?e[a+2]:0,c=i>>2,d=(i&3)<<4|s>>4;let f=(s&15)<<2|l>>6,h=l&63;u||(h=64,o||(f=64)),n.push(r[c],r[d],r[f],r[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Eq(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Ale(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<e.length;){const i=r[e.charAt(a++)],s=a<e.length?r[e.charAt(a)]:0;++a;const l=a<e.length?r[e.charAt(a)]:64;++a;const d=a<e.length?r[e.charAt(a)]:64;if(++a,i==null||s==null||l==null||d==null)throw new Ple;const f=i<<2|s>>4;if(n.push(f),l!==64){const h=s<<4&240|l>>2;if(n.push(h),d!==64){const v=l<<6&192|d;n.push(v)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Ple extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Tle=function(e){const t=Eq(e);return Aq.encodeByteArray(t,!0)},Pq=function(e){return Tle(e).replace(/\./g,"")},Tq=function(e){try{return Aq.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ile(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mle=()=>Ile().__FIREBASE_DEFAULTS__,Dle=()=>{if(typeof process>"u"||typeof process.env>"u")return;const e={}.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Rle=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&Tq(e[1]);return t&&JSON.parse(t)},CR=()=>{try{return Mle()||Dle()||Rle()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},kle=e=>{var t,r;return(r=(t=CR())===null||t===void 0?void 0:t.emulatorHosts)===null||r===void 0?void 0:r[e]},Iq=()=>{var e;return(e=CR())===null||e===void 0?void 0:e.config},Mq=e=>{var t;return(t=CR())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ole{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,r)=>{this.resolve=t,this.reject=r})}wrapCallback(t){return(r,n)=>{r?this.reject(r):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(r):t(r,n))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fi(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Lle(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Fi())}function Nle(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function Fle(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ble(){const e=Fi();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Ule(){try{return typeof indexedDB=="object"}catch{return!1}}function jle(){return new Promise((e,t)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},a.onupgradeneeded=()=>{r=!1},a.onerror=()=>{var i;t(((i=a.error)===null||i===void 0?void 0:i.message)||"")}}catch(r){t(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zle="FirebaseError";class hh extends Error{constructor(t,r,n){super(r),this.code=t,this.customData=n,this.name=zle,Object.setPrototypeOf(this,hh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,vb.prototype.create)}}class vb{constructor(t,r,n){this.service=t,this.serviceName=r,this.errors=n}create(t,...r){const n=r[0]||{},a=`${this.service}/${t}`,i=this.errors[t],o=i?Vle(i,n):"Error",s=`${this.serviceName}: ${o} (${a}).`;return new hh(a,s,n)}}function Vle(e,t){return e.replace(Hle,(r,n)=>{const a=t[n];return a!=null?String(a):`<${n}?>`})}const Hle=/\{\$([^}]+)}/g;function Gle(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function eC(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const a of r){if(!n.includes(a))return!1;const i=e[a],o=t[a];if(GF(i)&&GF(o)){if(!eC(i,o))return!1}else if(i!==o)return!1}for(const a of n)if(!r.includes(a))return!1;return!0}function GF(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mb(e){const t=[];for(const[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(a=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(a))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function dy(e){const t={};return e.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[a,i]=n.split("=");t[decodeURIComponent(a)]=decodeURIComponent(i)}}),t}function fy(e){const t=e.indexOf("?");if(!t)return"";const r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function qle(e,t){const r=new Wle(e,t);return r.subscribe.bind(r)}class Wle{constructor(t,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{t(this)}).catch(n=>{this.error(n)})}next(t){this.forEachObserver(r=>{r.next(t)})}error(t){this.forEachObserver(r=>{r.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,r,n){let a;if(t===void 0&&r===void 0&&n===void 0)throw new Error("Missing Observer.");$le(t,["next","error","complete"])?a=t:a={next:t,error:r,complete:n},a.next===void 0&&(a.next=lA),a.error===void 0&&(a.error=lA),a.complete===void 0&&(a.complete=lA);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),i}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,t)}sendOne(t,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{r(this.observers[t])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function $le(e,t){if(typeof e!="object"||e===null)return!1;for(const r of t)if(r in e&&typeof e[r]=="function")return!0;return!1}function lA(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ov(e){return e&&e._delegate?e._delegate:e}class vg{constructor(t,r,n){this.name=t,this.instanceFactory=r,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qh="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xle{constructor(t,r){this.name=t,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const r=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(r)){const n=new Ole;if(this.instancesDeferred.set(r,n),this.isInitialized(r)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:r});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(t){var r;const n=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),a=(r=t==null?void 0:t.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(a)return null;throw i}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Kle(t))try{this.getOrInitializeService({instanceIdentifier:qh})}catch{}for(const[r,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);try{const i=this.getOrInitializeService({instanceIdentifier:a});n.resolve(i)}catch{}}}}clearInstance(t=qh){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=qh){return this.instances.has(t)}getOptions(t=qh){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:r={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:r});for(const[i,o]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(i);n===s&&o.resolve(a)}return a}onInit(t,r){var n;const a=this.normalizeInstanceIdentifier(r),i=(n=this.onInitCallbacks.get(a))!==null&&n!==void 0?n:new Set;i.add(t),this.onInitCallbacks.set(a,i);const o=this.instances.get(a);return o&&t(o,a),()=>{i.delete(t)}}invokeOnInitCallbacks(t,r){const n=this.onInitCallbacks.get(r);if(n)for(const a of n)try{a(t,r)}catch{}}getOrInitializeService({instanceIdentifier:t,options:r={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Yle(t),options:r}),this.instances.set(t,n),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=qh){return this.component?this.component.multipleInstances?t:qh:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Yle(e){return e===qh?void 0:e}function Kle(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qle{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const r=this.getProvider(t.name);if(r.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);r.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const r=new Xle(t,this);return this.providers.set(t,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rn;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(Rn||(Rn={}));const Zle={debug:Rn.DEBUG,verbose:Rn.VERBOSE,info:Rn.INFO,warn:Rn.WARN,error:Rn.ERROR,silent:Rn.SILENT},Jle=Rn.INFO,ece={[Rn.DEBUG]:"log",[Rn.VERBOSE]:"log",[Rn.INFO]:"info",[Rn.WARN]:"warn",[Rn.ERROR]:"error"},tce=(e,t,...r)=>{if(t<e.logLevel)return;const n=new Date().toISOString(),a=ece[t];if(a)console[a](`[${n}]  ${e.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Dq{constructor(t){this.name=t,this._logLevel=Jle,this._logHandler=tce,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Rn))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Zle[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Rn.DEBUG,...t),this._logHandler(this,Rn.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Rn.VERBOSE,...t),this._logHandler(this,Rn.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Rn.INFO,...t),this._logHandler(this,Rn.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Rn.WARN,...t),this._logHandler(this,Rn.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Rn.ERROR,...t),this._logHandler(this,Rn.ERROR,...t)}}const rce=(e,t)=>t.some(r=>e instanceof r);let qF,WF;function nce(){return qF||(qF=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ace(){return WF||(WF=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Rq=new WeakMap,rI=new WeakMap,kq=new WeakMap,cA=new WeakMap,_R=new WeakMap;function ice(e){const t=new Promise((r,n)=>{const a=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{r(Ff(e.result)),a()},o=()=>{n(e.error),a()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(r=>{r instanceof IDBCursor&&Rq.set(r,e)}).catch(()=>{}),_R.set(t,e),t}function oce(e){if(rI.has(e))return;const t=new Promise((r,n)=>{const a=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{r(),a()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});rI.set(e,t)}let nI={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return rI.get(e);if(t==="objectStoreNames")return e.objectStoreNames||kq.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Ff(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function sce(e){nI=e(nI)}function uce(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const n=e.call(dA(this),t,...r);return kq.set(n,t.sort?t.sort():[t]),Ff(n)}:ace().includes(e)?function(...t){return e.apply(dA(this),t),Ff(Rq.get(this))}:function(...t){return Ff(e.apply(dA(this),t))}}function lce(e){return typeof e=="function"?uce(e):(e instanceof IDBTransaction&&oce(e),rce(e,nce())?new Proxy(e,nI):e)}function Ff(e){if(e instanceof IDBRequest)return ice(e);if(cA.has(e))return cA.get(e);const t=lce(e);return t!==e&&(cA.set(e,t),_R.set(t,e)),t}const dA=e=>_R.get(e);function cce(e,t,{blocked:r,upgrade:n,blocking:a,terminated:i}={}){const o=indexedDB.open(e,t),s=Ff(o);return n&&o.addEventListener("upgradeneeded",u=>{n(Ff(o.result),u.oldVersion,u.newVersion,Ff(o.transaction),u)}),r&&o.addEventListener("blocked",u=>r(u.oldVersion,u.newVersion,u)),s.then(u=>{i&&u.addEventListener("close",()=>i()),a&&u.addEventListener("versionchange",l=>a(l.oldVersion,l.newVersion,l))}).catch(()=>{}),s}const dce=["get","getKey","getAll","getAllKeys","count"],fce=["put","add","delete","clear"],fA=new Map;function $F(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(fA.get(t))return fA.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,a=fce.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(a||dce.includes(r)))return;const i=async function(o,...s){const u=this.transaction(o,a?"readwrite":"readonly");let l=u.store;return n&&(l=l.index(s.shift())),(await Promise.all([l[r](...s),a&&u.done]))[0]};return fA.set(t,i),i}sce(e=>({...e,get:(t,r,n)=>$F(t,r)||e.get(t,r,n),has:(t,r)=>!!$F(t,r)||e.has(t,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hce{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(pce(r)){const n=r.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(r=>r).join(" ")}}function pce(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const aI="@firebase/app",XF="0.9.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rp=new Dq("@firebase/app"),vce="@firebase/app-compat",mce="@firebase/analytics-compat",gce="@firebase/analytics",yce="@firebase/app-check-compat",bce="@firebase/app-check",xce="@firebase/auth",Sce="@firebase/auth-compat",Cce="@firebase/database",_ce="@firebase/database-compat",wce="@firebase/functions",Ece="@firebase/functions-compat",Ace="@firebase/installations",Pce="@firebase/installations-compat",Tce="@firebase/messaging",Ice="@firebase/messaging-compat",Mce="@firebase/performance",Dce="@firebase/performance-compat",Rce="@firebase/remote-config",kce="@firebase/remote-config-compat",Oce="@firebase/storage",Lce="@firebase/storage-compat",Nce="@firebase/firestore",Fce="@firebase/firestore-compat",Bce="firebase",Uce="9.22.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iI="[DEFAULT]",jce={[aI]:"fire-core",[vce]:"fire-core-compat",[gce]:"fire-analytics",[mce]:"fire-analytics-compat",[bce]:"fire-app-check",[yce]:"fire-app-check-compat",[xce]:"fire-auth",[Sce]:"fire-auth-compat",[Cce]:"fire-rtdb",[_ce]:"fire-rtdb-compat",[wce]:"fire-fn",[Ece]:"fire-fn-compat",[Ace]:"fire-iid",[Pce]:"fire-iid-compat",[Tce]:"fire-fcm",[Ice]:"fire-fcm-compat",[Mce]:"fire-perf",[Dce]:"fire-perf-compat",[Rce]:"fire-rc",[kce]:"fire-rc-compat",[Oce]:"fire-gcs",[Lce]:"fire-gcs-compat",[Nce]:"fire-fst",[Fce]:"fire-fst-compat","fire-js":"fire-js",[Bce]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tC=new Map,oI=new Map;function zce(e,t){try{e.container.addComponent(t)}catch(r){Rp.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function P1(e){const t=e.name;if(oI.has(t))return Rp.debug(`There were multiple attempts to register component ${t}.`),!1;oI.set(t,e);for(const r of tC.values())zce(r,e);return!0}function Oq(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vce={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Bf=new vb("app","Firebase",Vce);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hce{constructor(t,r,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new vg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Bf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gb=Uce;function Lq(e,t={}){let r=e;typeof t!="object"&&(t={name:t});const n=Object.assign({name:iI,automaticDataCollectionEnabled:!1},t),a=n.name;if(typeof a!="string"||!a)throw Bf.create("bad-app-name",{appName:String(a)});if(r||(r=Iq()),!r)throw Bf.create("no-options");const i=tC.get(a);if(i){if(eC(r,i.options)&&eC(n,i.config))return i;throw Bf.create("duplicate-app",{appName:a})}const o=new Qle(a);for(const u of oI.values())o.addComponent(u);const s=new Hce(r,n,o);return tC.set(a,s),s}function Gce(e=iI){const t=tC.get(e);if(!t&&e===iI&&Iq())return Lq();if(!t)throw Bf.create("no-app",{appName:e});return t}function zm(e,t,r){var n;let a=(n=jce[e])!==null&&n!==void 0?n:e;r&&(a+=`-${r}`);const i=a.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const s=[`Unable to register library "${a}" with version "${t}":`];i&&s.push(`library name "${a}" contains illegal characters (whitespace or "/")`),i&&o&&s.push("and"),o&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Rp.warn(s.join(" "));return}P1(new vg(`${a}-version`,()=>({library:a,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qce="firebase-heartbeat-database",Wce=1,T1="firebase-heartbeat-store";let hA=null;function Nq(){return hA||(hA=cce(qce,Wce,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(T1)}}}).catch(e=>{throw Bf.create("idb-open",{originalErrorMessage:e.message})})),hA}async function $ce(e){try{return await(await Nq()).transaction(T1).objectStore(T1).get(Fq(e))}catch(t){if(t instanceof hh)Rp.warn(t.message);else{const r=Bf.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Rp.warn(r.message)}}}async function YF(e,t){try{const n=(await Nq()).transaction(T1,"readwrite");await n.objectStore(T1).put(t,Fq(e)),await n.done}catch(r){if(r instanceof hh)Rp.warn(r.message);else{const n=Bf.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Rp.warn(n.message)}}}function Fq(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xce=1024,Yce=30*24*60*60*1e3;class Kce{constructor(t){this.container=t,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new Zce(r),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=KF();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(a=>a.date===n)))return this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const i=new Date(a.date).valueOf();return Date.now()-i<=Yce}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const t=KF(),{heartbeatsToSend:r,unsentEntries:n}=Qce(this._heartbeatsCache.heartbeats),a=Pq(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}}function KF(){return new Date().toISOString().substring(0,10)}function Qce(e,t=Xce){const r=[];let n=e.slice();for(const a of e){const i=r.find(o=>o.agent===a.agent);if(i){if(i.dates.push(a.date),QF(r)>t){i.dates.pop();break}}else if(r.push({agent:a.agent,dates:[a.date]}),QF(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class Zce{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ule()?jle().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await $ce(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(t){var r;if(await this._canUseIndexedDBPromise){const a=await this.read();return YF(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:a.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var r;if(await this._canUseIndexedDBPromise){const a=await this.read();return YF(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...t.heartbeats]})}else return}}function QF(e){return Pq(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jce(e){P1(new vg("platform-logger",t=>new hce(t),"PRIVATE")),P1(new vg("heartbeat",t=>new Kce(t),"PRIVATE")),zm(aI,XF,e),zm(aI,XF,"esm2017"),zm("fire-js","")}Jce("");function wR(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r}function Bq(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ede=Bq,Uq=new vb("auth","Firebase",Bq());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rC=new Dq("@firebase/auth");function tde(e,...t){rC.logLevel<=Rn.WARN&&rC.warn(`Auth (${gb}): ${e}`,...t)}function tS(e,...t){rC.logLevel<=Rn.ERROR&&rC.error(`Auth (${gb}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nu(e,...t){throw ER(e,...t)}function _l(e,...t){return ER(e,...t)}function rde(e,t,r){const n=Object.assign(Object.assign({},ede()),{[t]:r});return new vb("auth","Firebase",n).create(t,{appName:e.name})}function ER(e,...t){if(typeof e!="string"){const r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return Uq.create(e,...t)}function yr(e,t,...r){if(!e)throw ER(t,...r)}function yc(e){const t="INTERNAL ASSERTION FAILED: "+e;throw tS(t),new Error(t)}function Uc(e,t){e||yc(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sI(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.href)||""}function nde(){return ZF()==="http:"||ZF()==="https:"}function ZF(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ade(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(nde()||Nle()||"connection"in navigator)?navigator.onLine:!0}function ide(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yb{constructor(t,r){this.shortDelay=t,this.longDelay=r,Uc(r>t,"Short delay should be less than long delay!"),this.isMobile=Lle()||Fle()}get(){return ade()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AR(e,t){Uc(e.emulator,"Emulator should always be set here");const{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jq{static initialize(t,r,n){this.fetchImpl=t,r&&(this.headersImpl=r),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;yc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;yc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;yc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ode={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sde=new yb(3e4,6e4);function jg(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function zg(e,t,r,n,a={}){return zq(e,a,async()=>{let i={},o={};n&&(t==="GET"?o=n:i={body:JSON.stringify(n)});const s=mb(Object.assign({key:e.config.apiKey},o)).slice(1),u=await e._getAdditionalHeaders();return u["Content-Type"]="application/json",e.languageCode&&(u["X-Firebase-Locale"]=e.languageCode),jq.fetch()(Vq(e,e.config.apiHost,r,s),Object.assign({method:t,headers:u,referrerPolicy:"no-referrer"},i))})}async function zq(e,t,r){e._canInitEmulator=!1;const n=Object.assign(Object.assign({},ode),t);try{const a=new ude(e),i=await Promise.race([r(),a.promise]);a.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw w2(e,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const s=i.ok?o.errorMessage:o.error.message,[u,l]=s.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw w2(e,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw w2(e,"email-already-in-use",o);if(u==="USER_DISABLED")throw w2(e,"user-disabled",o);const c=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw rde(e,c,l);Nu(e,c)}}catch(a){if(a instanceof hh)throw a;Nu(e,"network-request-failed",{message:String(a)})}}async function bb(e,t,r,n,a={}){const i=await zg(e,t,r,n,a);return"mfaPendingCredential"in i&&Nu(e,"multi-factor-auth-required",{_serverResponse:i}),i}function Vq(e,t,r,n){const a=`${t}${r}?${n}`;return e.config.emulator?AR(e.config,a):`${e.config.apiScheme}://${a}`}class ude{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((r,n)=>{this.timer=setTimeout(()=>n(_l(this.auth,"network-request-failed")),sde.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function w2(e,t,r){const n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);const a=_l(e,t,n);return a.customData._tokenResponse=r,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lde(e,t){return zg(e,"POST","/v1/accounts:delete",t)}async function cde(e,t){return zg(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uy(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function dde(e,t=!1){const r=ov(e),n=await r.getIdToken(t),a=PR(n);yr(a&&a.exp&&a.auth_time&&a.iat,r.auth,"internal-error");const i=typeof a.firebase=="object"?a.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:a,token:n,authTime:Uy(pA(a.auth_time)),issuedAtTime:Uy(pA(a.iat)),expirationTime:Uy(pA(a.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function pA(e){return Number(e)*1e3}function PR(e){const[t,r,n]=e.split(".");if(t===void 0||r===void 0||n===void 0)return tS("JWT malformed, contained fewer than 3 sections"),null;try{const a=Tq(r);return a?JSON.parse(a):(tS("Failed to decode base64 JWT payload"),null)}catch(a){return tS("Caught error parsing JWT payload as JSON",a==null?void 0:a.toString()),null}}function fde(e){const t=PR(e);return yr(t,"internal-error"),yr(typeof t.exp<"u","internal-error"),yr(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I1(e,t,r=!1){if(r)return t;try{return await t}catch(n){throw n instanceof hh&&hde(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}function hde({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pde{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var r;if(t){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const a=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(t=!1){if(!this.isRunning)return;const r=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hq{constructor(t,r){this.createdAt=t,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=Uy(this.lastLoginAt),this.creationTime=Uy(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nC(e){var t;const r=e.auth,n=await e.getIdToken(),a=await I1(e,cde(r,{idToken:n}));yr(a==null?void 0:a.users.length,r,"internal-error");const i=a.users[0];e._notifyReloadListener(i);const o=!((t=i.providerUserInfo)===null||t===void 0)&&t.length?gde(i.providerUserInfo):[],s=mde(e.providerData,o),u=e.isAnonymous,l=!(e.email&&i.passwordHash)&&!(s!=null&&s.length),c=u?l:!1,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Hq(i.createdAt,i.lastLoginAt),isAnonymous:c};Object.assign(e,d)}async function vde(e){const t=ov(e);await nC(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function mde(e,t){return[...e.filter(n=>!t.some(a=>a.providerId===n.providerId)),...t]}function gde(e){return e.map(t=>{var{providerId:r}=t,n=wR(t,["providerId"]);return{providerId:r,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yde(e,t){const r=await zq(e,{},async()=>{const n=mb({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:a,apiKey:i}=e.config,o=Vq(e,a,"/v1/token",`key=${i}`),s=await e._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",jq.fetch()(o,{method:"POST",headers:s,body:n})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M1{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){yr(t.idToken,"internal-error"),yr(typeof t.idToken<"u","internal-error"),yr(typeof t.refreshToken<"u","internal-error");const r="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):fde(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,r)}async getToken(t,r=!1){return yr(!this.accessToken||this.refreshToken,t,"user-token-expired"),!r&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(t,r){const{accessToken:n,refreshToken:a,expiresIn:i}=await yde(t,r);this.updateTokensAndExpiration(n,a,Number(i))}updateTokensAndExpiration(t,r,n){this.refreshToken=r||null,this.accessToken=t||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(t,r){const{refreshToken:n,accessToken:a,expirationTime:i}=r,o=new M1;return n&&(yr(typeof n=="string","internal-error",{appName:t}),o.refreshToken=n),a&&(yr(typeof a=="string","internal-error",{appName:t}),o.accessToken=a),i&&(yr(typeof i=="number","internal-error",{appName:t}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new M1,this.toJSON())}_performRefresh(){return yc("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dd(e,t){yr(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class vp{constructor(t){var{uid:r,auth:n,stsTokenManager:a}=t,i=wR(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new pde(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=n,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Hq(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(t){const r=await I1(this,this.stsTokenManager.getToken(this.auth,t));return yr(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(t){return dde(this,t)}reload(){return vde(this)}_assign(t){this!==t&&(yr(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(r=>Object.assign({},r)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const r=new vp(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(t){yr(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,r=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),r&&await nC(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await I1(this,lde(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,r){var n,a,i,o,s,u,l,c;const d=(n=r.displayName)!==null&&n!==void 0?n:void 0,f=(a=r.email)!==null&&a!==void 0?a:void 0,h=(i=r.phoneNumber)!==null&&i!==void 0?i:void 0,v=(o=r.photoURL)!==null&&o!==void 0?o:void 0,p=(s=r.tenantId)!==null&&s!==void 0?s:void 0,g=(u=r._redirectEventId)!==null&&u!==void 0?u:void 0,m=(l=r.createdAt)!==null&&l!==void 0?l:void 0,y=(c=r.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:b,emailVerified:S,isAnonymous:x,providerData:C,stsTokenManager:w}=r;yr(b&&w,t,"internal-error");const A=M1.fromJSON(this.name,w);yr(typeof b=="string",t,"internal-error"),Dd(d,t.name),Dd(f,t.name),yr(typeof S=="boolean",t,"internal-error"),yr(typeof x=="boolean",t,"internal-error"),Dd(h,t.name),Dd(v,t.name),Dd(p,t.name),Dd(g,t.name),Dd(m,t.name),Dd(y,t.name);const I=new vp({uid:b,auth:t,email:f,emailVerified:S,displayName:d,isAnonymous:x,photoURL:v,phoneNumber:h,tenantId:p,stsTokenManager:A,createdAt:m,lastLoginAt:y});return C&&Array.isArray(C)&&(I.providerData=C.map(D=>Object.assign({},D))),g&&(I._redirectEventId=g),I}static async _fromIdTokenResponse(t,r,n=!1){const a=new M1;a.updateFromServerResponse(r);const i=new vp({uid:r.localId,auth:t,stsTokenManager:a,isAnonymous:n});return await nC(i),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JF=new Map;function bc(e){Uc(e instanceof Function,"Expected a class definition");let t=JF.get(e);return t?(Uc(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,JF.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gq{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,r){this.storage[t]=r}async _get(t){const r=this.storage[t];return r===void 0?null:r}async _remove(t){delete this.storage[t]}_addListener(t,r){}_removeListener(t,r){}}Gq.type="NONE";const e6=Gq;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rS(e,t,r){return`firebase:${e}:${t}:${r}`}class Vm{constructor(t,r,n){this.persistence=t,this.auth=r,this.userKey=n;const{config:a,name:i}=this.auth;this.fullUserKey=rS(this.userKey,a.apiKey,i),this.fullPersistenceKey=rS("persistence",a.apiKey,i),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?vp._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,r,n="authUser"){if(!r.length)return new Vm(bc(e6),t,n);const a=(await Promise.all(r.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let i=a[0]||bc(e6);const o=rS(n,t.config.apiKey,t.name);let s=null;for(const l of r)try{const c=await l._get(o);if(c){const d=vp._fromJSON(t,c);l!==i&&(s=d),i=l;break}}catch{}const u=a.filter(l=>l._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new Vm(i,t,n):(i=u[0],s&&await i._set(o,s.toJSON()),await Promise.all(r.map(async l=>{if(l!==i)try{await l._remove(o)}catch{}})),new Vm(i,t,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t6(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if($q(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(qq(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Yq(t))return"Blackberry";if(Kq(t))return"Webos";if(TR(t))return"Safari";if((t.includes("chrome/")||Wq(t))&&!t.includes("edge/"))return"Chrome";if(Xq(t))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(r);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function qq(e=Fi()){return/firefox\//i.test(e)}function TR(e=Fi()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Wq(e=Fi()){return/crios\//i.test(e)}function $q(e=Fi()){return/iemobile/i.test(e)}function Xq(e=Fi()){return/android/i.test(e)}function Yq(e=Fi()){return/blackberry/i.test(e)}function Kq(e=Fi()){return/webos/i.test(e)}function Bw(e=Fi()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function bde(e=Fi()){var t;return Bw(e)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function xde(){return Ble()&&document.documentMode===10}function Qq(e=Fi()){return Bw(e)||Xq(e)||Kq(e)||Yq(e)||/windows phone/i.test(e)||$q(e)}function Sde(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zq(e,t=[]){let r;switch(e){case"Browser":r=t6(Fi());break;case"Worker":r=`${t6(Fi())}-${e}`;break;default:r=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${gb}/${n}`}async function Jq(e,t){return zg(e,"GET","/v2/recaptchaConfig",jg(e,t))}function r6(e){return e!==void 0&&e.enterprise!==void 0}class eW{constructor(t){if(this.siteKey="",this.emailPasswordEnabled=!1,t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.emailPasswordEnabled=t.recaptchaEnforcementState.some(r=>r.provider==="EMAIL_PASSWORD_PROVIDER"&&r.enforcementState!=="OFF")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cde(){var e,t;return(t=(e=document.getElementsByTagName("head"))===null||e===void 0?void 0:e[0])!==null&&t!==void 0?t:document}function tW(e){return new Promise((t,r)=>{const n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=a=>{const i=_l("internal-error");i.customData=a,r(i)},n.type="text/javascript",n.charset="UTF-8",Cde().appendChild(n)})}function _de(e){return`__${e}${Math.floor(Math.random()*1e6)}`}const wde="https://www.google.com/recaptcha/enterprise.js?render=",Ede="recaptcha-enterprise",Ade="NO_RECAPTCHA";class rW{constructor(t){this.type=Ede,this.auth=Vg(t)}async verify(t="verify",r=!1){async function n(i){if(!r){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,s)=>{Jq(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const l=new eW(u);return i.tenantId==null?i._agentRecaptchaConfig=l:i._tenantRecaptchaConfigs[i.tenantId]=l,o(l.siteKey)}}).catch(u=>{s(u)})})}function a(i,o,s){const u=window.grecaptcha;r6(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:t}).then(l=>{o(l)}).catch(()=>{o(Ade)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{n(this.auth).then(s=>{if(!r&&r6(window.grecaptcha))a(s,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}tW(wde+s).then(()=>{a(s,i,o)}).catch(u=>{o(u)})}}).catch(s=>{o(s)})})}}async function aC(e,t,r,n=!1){const a=new rW(e);let i;try{i=await a.verify(r)}catch{i=await a.verify(r,!0)}const o=Object.assign({},t);return n?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pde{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,r){const n=i=>new Promise((o,s)=>{try{const u=t(i);o(u)}catch(u){s(u)}});n.onAbort=r,this.queue.push(n);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const r=[];try{for(const n of this.queue)await n(t),n.onAbort&&r.push(n.onAbort)}catch(n){r.reverse();for(const a of r)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tde{constructor(t,r,n,a){this.app=t,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=n,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new n6(this),this.idTokenSubscription=new n6(this),this.beforeStateQueue=new Pde(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Uq,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=a.sdkClientVersion}_initializeWithPersistence(t,r){return r&&(this._popupRedirectResolver=bc(r)),this._initializationPromise=this.queue(async()=>{var n,a;if(!this._deleted&&(this.persistenceManager=await Vm.create(this,t),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUser(t){var r;const n=await this.assertedPersistence.getCurrentUser();let a=n,i=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,s=a==null?void 0:a._redirectEventId,u=await this.tryRedirectSignIn(t);(!o||o===s)&&(u!=null&&u.user)&&(a=u.user,i=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(a)}catch(o){a=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return yr(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(t){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(t){try{await nC(t)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=ide()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const r=t?ov(t):null;return r&&yr(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(t,r=!1){if(!this._deleted)return t&&yr(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(t){return this.queue(async()=>{await this.assertedPersistence.setPersistence(bc(t))})}async initializeRecaptchaConfig(){const t=await Jq(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new eW(t);this.tenantId==null?this._agentRecaptchaConfig=r:this._tenantRecaptchaConfigs[this.tenantId]=r,r.emailPasswordEnabled&&new rW(this).verify()}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new vb("auth","Firebase",t())}onAuthStateChanged(t,r,n){return this.registerStateListener(this.authStateSubscription,t,r,n)}beforeAuthStateChanged(t,r){return this.beforeStateQueue.pushCallback(t,r)}onIdTokenChanged(t,r,n){return this.registerStateListener(this.idTokenSubscription,t,r,n)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,r){const n=await this.getOrInitRedirectPersistenceManager(r);return t===null?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const r=t&&bc(t)||this._popupRedirectResolver;yr(r,this,"argument-error"),this.redirectPersistenceManager=await Vm.create(this,[bc(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var r,n;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===t?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(r=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,r,n,a){if(this._deleted)return()=>{};const i=typeof r=="function"?r:r.next.bind(r),o=this._isInitialized?Promise.resolve():this._initializationPromise;return yr(o,this,"internal-error"),o.then(()=>i(this.currentUser)),typeof r=="function"?t.addObserver(r,n,a):t.addObserver(r)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return yr(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Zq(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const r={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const n=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());n&&(r["X-Firebase-Client"]=n);const a=await this._getAppCheckToken();return a&&(r["X-Firebase-AppCheck"]=a),r}async _getAppCheckToken(){var t;const r=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return r!=null&&r.error&&tde(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function Vg(e){return ov(e)}let n6=class{constructor(t){this.auth=t,this.observer=null,this.addObserver=qle(r=>this.observer=r)}get next(){return yr(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ide(e,t){const r=Oq(e,"auth");if(r.isInitialized()){const a=r.getImmediate(),i=r.getOptions();if(eC(i,t??{}))return a;Nu(a,"already-initialized")}return r.initialize({options:t})}function Mde(e,t){const r=(t==null?void 0:t.persistence)||[],n=(Array.isArray(r)?r:[r]).map(bc);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,t==null?void 0:t.popupRedirectResolver)}function Dde(e,t,r){const n=Vg(e);yr(n._canInitEmulator,n,"emulator-config-failed"),yr(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const a=!!(r!=null&&r.disableWarnings),i=nW(t),{host:o,port:s}=Rde(t),u=s===null?"":`:${s}`;n.config.emulator={url:`${i}//${o}${u}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:s,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:a})}),a||kde()}function nW(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Rde(e){const t=nW(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};const n=r[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(n);if(a){const i=a[1];return{host:i,port:a6(n.substr(i.length+1))}}else{const[i,o]=n.split(":");return{host:i,port:a6(o)}}}function a6(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function kde(){function e(){const t=document.createElement("p"),r=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(t,r){this.providerId=t,this.signInMethod=r}toJSON(){return yc("not implemented")}_getIdTokenResponse(t){return yc("not implemented")}_linkToIdToken(t,r){return yc("not implemented")}_getReauthenticationResolver(t){return yc("not implemented")}}async function Ode(e,t){return zg(e,"POST","/v1/accounts:update",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vA(e,t){return bb(e,"POST","/v1/accounts:signInWithPassword",jg(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lde(e,t){return bb(e,"POST","/v1/accounts:signInWithEmailLink",jg(e,t))}async function Nde(e,t){return bb(e,"POST","/v1/accounts:signInWithEmailLink",jg(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1 extends IR{constructor(t,r,n,a=null){super("password",n),this._email=t,this._password=r,this._tenantId=a}static _fromEmailAndPassword(t,r){return new D1(t,r,"password")}static _fromEmailAndCode(t,r,n=null){return new D1(t,r,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(t){var r;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.emailPasswordEnabled){const a=await aC(t,n,"signInWithPassword");return vA(t,a)}else return vA(t,n).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const i=await aC(t,n,"signInWithPassword");return vA(t,i)}else return Promise.reject(a)});case"emailLink":return Lde(t,{email:this._email,oobCode:this._password});default:Nu(t,"internal-error")}}async _linkToIdToken(t,r){switch(this.signInMethod){case"password":return Ode(t,{idToken:r,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return Nde(t,{idToken:r,email:this._email,oobCode:this._password});default:Nu(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hm(e,t){return bb(e,"POST","/v1/accounts:signInWithIdp",jg(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fde="http://localhost";class kp extends IR{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const r=new kp(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(r.idToken=t.idToken),t.accessToken&&(r.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(r.nonce=t.nonce),t.pendingToken&&(r.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(r.accessToken=t.oauthToken,r.secret=t.oauthTokenSecret):Nu("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t,{providerId:n,signInMethod:a}=r,i=wR(r,["providerId","signInMethod"]);if(!n||!a)return null;const o=new kp(n,a);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(t){const r=this.buildRequest();return Hm(t,r)}_linkToIdToken(t,r){const n=this.buildRequest();return n.idToken=r,Hm(t,n)}_getReauthenticationResolver(t){const r=this.buildRequest();return r.autoCreate=!1,Hm(t,r)}buildRequest(){const t={requestUri:Fde,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),t.postBody=mb(r)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bde(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Ude(e){const t=dy(fy(e)).link,r=t?dy(fy(t)).deep_link_id:null,n=dy(fy(e)).deep_link_id;return(n?dy(fy(n)).link:null)||n||r||t||e}class MR{constructor(t){var r,n,a,i,o,s;const u=dy(fy(t)),l=(r=u.apiKey)!==null&&r!==void 0?r:null,c=(n=u.oobCode)!==null&&n!==void 0?n:null,d=Bde((a=u.mode)!==null&&a!==void 0?a:null);yr(l&&c&&d,"argument-error"),this.apiKey=l,this.operation=d,this.code=c,this.continueUrl=(i=u.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=u.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(s=u.tenantId)!==null&&s!==void 0?s:null}static parseLink(t){const r=Ude(t);try{return new MR(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hg{constructor(){this.providerId=Hg.PROVIDER_ID}static credential(t,r){return D1._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){const n=MR.parseLink(r);return yr(n,"argument-error"),D1._fromEmailAndCode(t,n.code,n.tenantId)}}Hg.PROVIDER_ID="password";Hg.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Hg.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aW{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb extends aW{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af extends xb{constructor(){super("facebook.com")}static credential(t){return kp._fromParams({providerId:af.PROVIDER_ID,signInMethod:af.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return af.credentialFromTaggedObject(t)}static credentialFromError(t){return af.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return af.credential(t.oauthAccessToken)}catch{return null}}}af.FACEBOOK_SIGN_IN_METHOD="facebook.com";af.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of extends xb{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return kp._fromParams({providerId:of.PROVIDER_ID,signInMethod:of.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return of.credentialFromTaggedObject(t)}static credentialFromError(t){return of.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:r,oauthAccessToken:n}=t;if(!r&&!n)return null;try{return of.credential(r,n)}catch{return null}}}of.GOOGLE_SIGN_IN_METHOD="google.com";of.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sf extends xb{constructor(){super("github.com")}static credential(t){return kp._fromParams({providerId:sf.PROVIDER_ID,signInMethod:sf.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return sf.credentialFromTaggedObject(t)}static credentialFromError(t){return sf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return sf.credential(t.oauthAccessToken)}catch{return null}}}sf.GITHUB_SIGN_IN_METHOD="github.com";sf.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf extends xb{constructor(){super("twitter.com")}static credential(t,r){return kp._fromParams({providerId:uf.PROVIDER_ID,signInMethod:uf.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:r})}static credentialFromResult(t){return uf.credentialFromTaggedObject(t)}static credentialFromError(t){return uf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:r,oauthTokenSecret:n}=t;if(!r||!n)return null;try{return uf.credential(r,n)}catch{return null}}}uf.TWITTER_SIGN_IN_METHOD="twitter.com";uf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mA(e,t){return bb(e,"POST","/v1/accounts:signUp",jg(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Op{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,r,n,a=!1){const i=await vp._fromIdTokenResponse(t,n,a),o=i6(n);return new Op({user:i,providerId:o,_tokenResponse:n,operationType:r})}static async _forOperation(t,r,n){await t._updateTokensIfNecessary(n,!0);const a=i6(n);return new Op({user:t,providerId:a,_tokenResponse:n,operationType:r})}}function i6(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iC extends hh{constructor(t,r,n,a){var i;super(r.code,r.message),this.operationType=n,this.user=a,Object.setPrototypeOf(this,iC.prototype),this.customData={appName:t.name,tenantId:(i=t.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:r.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,r,n,a){return new iC(t,r,n,a)}}function iW(e,t,r,n){return(t==="reauthenticate"?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?iC._fromErrorAndOperation(e,i,t,n):i})}async function jde(e,t,r=!1){const n=await I1(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return Op._forOperation(e,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zde(e,t,r=!1){const{auth:n}=e,a="reauthenticate";try{const i=await I1(e,iW(n,a,t,e),r);yr(i.idToken,n,"internal-error");const o=PR(i.idToken);yr(o,n,"internal-error");const{sub:s}=o;return yr(e.uid===s,n,"user-mismatch"),Op._forOperation(e,a,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Nu(n,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oW(e,t,r=!1){const n="signIn",a=await iW(e,n,t),i=await Op._fromIdTokenResponse(e,n,a);return r||await e._updateCurrentUser(i.user),i}async function Vde(e,t){return oW(Vg(e),t)}async function Hde(e,t,r){var n;const a=Vg(e),i={returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"};let o;if(!((n=a._getRecaptchaConfig())===null||n===void 0)&&n.emailPasswordEnabled){const l=await aC(a,i,"signUpPassword");o=mA(a,l)}else o=mA(a,i).catch(async l=>{if(l.code==="auth/missing-recaptcha-token"){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const c=await aC(a,i,"signUpPassword");return mA(a,c)}else return Promise.reject(l)});const s=await o.catch(l=>Promise.reject(l)),u=await Op._fromIdTokenResponse(a,"signIn",s);return await a._updateCurrentUser(u.user),u}function Gde(e,t,r){return Vde(ov(e),Hg.credential(t,r))}function qde(e,t,r,n){return ov(e).onIdTokenChanged(t,r,n)}function Wde(e,t,r){return ov(e).beforeAuthStateChanged(t,r)}const oC="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sW{constructor(t,r){this.storageRetriever=t,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(oC,"1"),this.storage.removeItem(oC),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,r){return this.storage.setItem(t,JSON.stringify(r)),Promise.resolve()}_get(t){const r=this.storage.getItem(t);return Promise.resolve(r?JSON.parse(r):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $de(){const e=Fi();return TR(e)||Bw(e)}const Xde=1e3,Yde=10;class uW extends sW{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=$de()&&Sde(),this.fallbackToPolling=Qq(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const r of Object.keys(this.listeners)){const n=this.storage.getItem(r),a=this.localCache[r];n!==a&&t(r,a,n)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((o,s,u)=>{this.notifyListeners(o,u)});return}const n=t.key;if(r?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(n);if(t.newValue!==o)t.newValue!==null?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!r)return}const a=()=>{const o=this.storage.getItem(n);!r&&this.localCache[n]===o||this.notifyListeners(n,o)},i=this.storage.getItem(n);xde()&&i!==t.newValue&&t.newValue!==t.oldValue?setTimeout(a,Yde):a()}notifyListeners(t,r){this.localCache[t]=r;const n=this.listeners[t];if(n)for(const a of Array.from(n))a(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:n}),!0)})},Xde)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,r){await super._set(t,r),this.localCache[t]=JSON.stringify(r)}async _get(t){const r=await super._get(t);return this.localCache[t]=JSON.stringify(r),r}async _remove(t){await super._remove(t),delete this.localCache[t]}}uW.type="LOCAL";const Kde=uW;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lW extends sW{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}lW.type="SESSION";const cW=lW;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qde(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const r=this.receivers.find(a=>a.isListeningto(t));if(r)return r;const n=new Uw(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const r=t,{eventId:n,eventType:a,data:i}=r.data,o=this.handlersMap[a];if(!(o!=null&&o.size))return;r.ports[0].postMessage({status:"ack",eventId:n,eventType:a});const s=Array.from(o).map(async l=>l(r.origin,i)),u=await Qde(s);r.ports[0].postMessage({status:"done",eventId:n,eventType:a,response:u})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Uw.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DR(e="",t=10){let r="";for(let n=0;n<t;n++)r+=Math.floor(Math.random()*10);return e+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zde{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,r,n=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let i,o;return new Promise((s,u)=>{const l=DR("",20);a.port1.start();const c=setTimeout(()=>{u(new Error("unsupported_event"))},n);o={messageChannel:a,onMessage(d){const f=d;if(f.data.eventId===l)switch(f.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),s(f.data.response);break;default:clearTimeout(c),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(o),a.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:l,data:r},[a.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wl(){return window}function Jde(e){wl().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dW(){return typeof wl().WorkerGlobalScope<"u"&&typeof wl().importScripts=="function"}async function efe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function tfe(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)===null||e===void 0?void 0:e.controller)||null}function rfe(){return dW()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fW="firebaseLocalStorageDb",nfe=1,sC="firebaseLocalStorage",hW="fbase_key";class Sb{constructor(t){this.request=t}toPromise(){return new Promise((t,r)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function jw(e,t){return e.transaction([sC],t?"readwrite":"readonly").objectStore(sC)}function afe(){const e=indexedDB.deleteDatabase(fW);return new Sb(e).toPromise()}function uI(){const e=indexedDB.open(fW,nfe);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{const n=e.result;try{n.createObjectStore(sC,{keyPath:hW})}catch(a){r(a)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(sC)?t(n):(n.close(),await afe(),t(await uI()))})})}async function o6(e,t,r){const n=jw(e,!0).put({[hW]:t,value:r});return new Sb(n).toPromise()}async function ife(e,t){const r=jw(e,!1).get(t),n=await new Sb(r).toPromise();return n===void 0?null:n.value}function s6(e,t){const r=jw(e,!0).delete(t);return new Sb(r).toPromise()}const ofe=800,sfe=3;class pW{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await uI(),this.db)}async _withRetries(t){let r=0;for(;;)try{const n=await this._openDb();return await t(n)}catch(n){if(r++>sfe)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return dW()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Uw._getInstance(rfe()),this.receiver._subscribe("keyChanged",async(t,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(t,r)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await efe(),!this.activeServiceWorker)return;this.sender=new Zde(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((t=n[0])===null||t===void 0)&&t.fulfilled&&!((r=n[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||tfe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await uI();return await o6(t,oC,"1"),await s6(t,oC),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,r){return this._withPendingWrite(async()=>(await this._withRetries(n=>o6(n,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)))}async _get(t){const r=await this._withRetries(n=>ife(n,t));return this.localCache[t]=r,r}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(r=>s6(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(a=>{const i=jw(a,!1).getAll();return new Sb(i).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const r=[],n=new Set;for(const{fbase_key:a,value:i}of t)n.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(i)&&(this.notifyListeners(a,i),r.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!n.has(a)&&(this.notifyListeners(a,null),r.push(a));return r}notifyListeners(t,r){this.localCache[t]=r;const n=this.listeners[t];if(n)for(const a of Array.from(n))a(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ofe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}pW.type="LOCAL";const ufe=pW;new yb(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lfe(e,t){return t?bc(t):(yr(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR extends IR{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Hm(t,this._buildIdpRequest())}_linkToIdToken(t,r){return Hm(t,this._buildIdpRequest(r))}_getReauthenticationResolver(t){return Hm(t,this._buildIdpRequest())}_buildIdpRequest(t){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(r.idToken=t),r}}function cfe(e){return oW(e.auth,new RR(e),e.bypassAuthState)}function dfe(e){const{auth:t,user:r}=e;return yr(r,t,"internal-error"),zde(r,new RR(e),e.bypassAuthState)}async function ffe(e){const{auth:t,user:r}=e;return yr(r,t,"internal-error"),jde(r,new RR(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vW{constructor(t,r,n,a,i=!1){this.auth=t,this.resolver=n,this.user=a,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(t,r)=>{this.pendingPromise={resolve:t,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(t){const{urlResponse:r,sessionId:n,postBody:a,tenantId:i,error:o,type:s}=t;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:r,sessionId:n,tenantId:i||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(u))}catch(l){this.reject(l)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return cfe;case"linkViaPopup":case"linkViaRedirect":return ffe;case"reauthViaPopup":case"reauthViaRedirect":return dfe;default:Nu(this.auth,"internal-error")}}resolve(t){Uc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Uc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hfe=new yb(2e3,1e4);class _m extends vW{constructor(t,r,n,a,i){super(t,r,a,i),this.provider=n,this.authWindow=null,this.pollId=null,_m.currentPopupAction&&_m.currentPopupAction.cancel(),_m.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return yr(t,this.auth,"internal-error"),t}async onExecution(){Uc(this.filter.length===1,"Popup operations only handle one event");const t=DR();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(_l(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(_l(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,_m.currentPopupAction=null}pollUserCancellation(){const t=()=>{var r,n;if(!((n=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_l(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,hfe.get())};t()}}_m.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pfe="pendingRedirect",nS=new Map;class vfe extends vW{constructor(t,r,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,n),this.eventId=null}async execute(){let t=nS.get(this.auth._key());if(!t){try{const n=await mfe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(n)}catch(r){t=()=>Promise.reject(r)}nS.set(this.auth._key(),t)}return this.bypassAuthState||nS.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const r=await this.auth._redirectUserForId(t.eventId);if(r)return this.user=r,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function mfe(e,t){const r=bfe(t),n=yfe(e);if(!await n._isAvailable())return!1;const a=await n._get(r)==="true";return await n._remove(r),a}function gfe(e,t){nS.set(e._key(),t)}function yfe(e){return bc(e._redirectPersistence)}function bfe(e){return rS(pfe,e.config.apiKey,e.name)}async function xfe(e,t,r=!1){const n=Vg(e),a=lfe(n,t),o=await new vfe(n,a,r).execute();return o&&!r&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,t)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sfe=10*60*1e3;class Cfe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let r=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(t,n)&&(r=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!_fe(t)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=t,r=!0)),r}sendToConsumer(t,r){var n;if(t.error&&!mW(t)){const a=((n=t.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";r.onError(_l(this.auth,a))}else r.onAuthEvent(t)}isEventForConsumer(t,r){const n=r.eventId===null||!!t.eventId&&t.eventId===r.eventId;return r.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Sfe&&this.cachedEventUids.clear(),this.cachedEventUids.has(u6(t))}saveEventToCache(t){this.cachedEventUids.add(u6(t)),this.lastProcessedEventTime=Date.now()}}function u6(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function mW({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function _fe(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return mW(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wfe(e,t={}){return zg(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Efe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Afe=/^https?/;async function Pfe(e){if(e.config.emulator)return;const{authorizedDomains:t}=await wfe(e);for(const r of t)try{if(Tfe(r))return}catch{}Nu(e,"unauthorized-domain")}function Tfe(e){const t=sI(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const o=new URL(e);return o.hostname===""&&n===""?r==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):r==="chrome-extension:"&&o.hostname===n}if(!Afe.test(r))return!1;if(Efe.test(e))return n===e;const a=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ife=new yb(3e4,6e4);function l6(){const e=wl().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let r=0;r<e.CP.length;r++)e.CP[r]=null}}function Mfe(e){return new Promise((t,r)=>{var n,a,i;function o(){l6(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{l6(),r(_l(e,"network-request-failed"))},timeout:Ife.get()})}if(!((a=(n=wl().gapi)===null||n===void 0?void 0:n.iframes)===null||a===void 0)&&a.Iframe)t(gapi.iframes.getContext());else if(!((i=wl().gapi)===null||i===void 0)&&i.load)o();else{const s=_de("iframefcb");return wl()[s]=()=>{gapi.load?o():r(_l(e,"network-request-failed"))},tW(`https://apis.google.com/js/api.js?onload=${s}`).catch(u=>r(u))}}).catch(t=>{throw aS=null,t})}let aS=null;function Dfe(e){return aS=aS||Mfe(e),aS}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rfe=new yb(5e3,15e3),kfe="__/auth/iframe",Ofe="emulator/auth/iframe",Lfe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Nfe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ffe(e){const t=e.config;yr(t.authDomain,e,"auth-domain-config-required");const r=t.emulator?AR(t,Ofe):`https://${e.config.authDomain}/${kfe}`,n={apiKey:t.apiKey,appName:e.name,v:gb},a=Nfe.get(e.config.apiHost);a&&(n.eid=a);const i=e._getFrameworks();return i.length&&(n.fw=i.join(",")),`${r}?${mb(n).slice(1)}`}async function Bfe(e){const t=await Dfe(e),r=wl().gapi;return yr(r,e,"internal-error"),t.open({where:document.body,url:Ffe(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Lfe,dontclear:!0},n=>new Promise(async(a,i)=>{await n.restyle({setHideOnLeave:!1});const o=_l(e,"network-request-failed"),s=wl().setTimeout(()=>{i(o)},Rfe.get());function u(){wl().clearTimeout(s),a(n)}n.ping(u).then(u,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ufe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},jfe=500,zfe=600,Vfe="_blank",Hfe="http://localhost";class c6{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Gfe(e,t,r,n=jfe,a=zfe){const i=Math.max((window.screen.availHeight-a)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let s="";const u=Object.assign(Object.assign({},Ufe),{width:n.toString(),height:a.toString(),top:i,left:o}),l=Fi().toLowerCase();r&&(s=Wq(l)?Vfe:r),qq(l)&&(t=t||Hfe,u.scrollbars="yes");const c=Object.entries(u).reduce((f,[h,v])=>`${f}${h}=${v},`,"");if(bde(l)&&s!=="_self")return qfe(t||"",s),new c6(null);const d=window.open(t||"",s,c);yr(d,e,"popup-blocked");try{d.focus()}catch{}return new c6(d)}function qfe(e,t){const r=document.createElement("a");r.href=e,r.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wfe="__/auth/handler",$fe="emulator/auth/handler",Xfe=encodeURIComponent("fac");async function d6(e,t,r,n,a,i){yr(e.config.authDomain,e,"auth-domain-config-required"),yr(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:gb,eventId:a};if(t instanceof aW){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Gle(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[c,d]of Object.entries(i||{}))o[c]=d}if(t instanceof xb){const c=t.getScopes().filter(d=>d!=="");c.length>0&&(o.scopes=c.join(","))}e.tenantId&&(o.tid=e.tenantId);const s=o;for(const c of Object.keys(s))s[c]===void 0&&delete s[c];const u=await e._getAppCheckToken(),l=u?`#${Xfe}=${encodeURIComponent(u)}`:"";return`${Yfe(e)}?${mb(s).slice(1)}${l}`}function Yfe({config:e}){return e.emulator?AR(e,$fe):`https://${e.authDomain}/${Wfe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gA="webStorageSupport";class Kfe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=cW,this._completeRedirectFn=xfe,this._overrideRedirectResult=gfe}async _openPopup(t,r,n,a){var i;Uc((i=this.eventManagers[t._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await d6(t,r,n,sI(),a);return Gfe(t,o,DR())}async _openRedirect(t,r,n,a){await this._originValidation(t);const i=await d6(t,r,n,sI(),a);return Jde(i),new Promise(()=>{})}_initialize(t){const r=t._key();if(this.eventManagers[r]){const{manager:a,promise:i}=this.eventManagers[r];return a?Promise.resolve(a):(Uc(i,"If manager is not set, promise should be"),i)}const n=this.initAndGetManager(t);return this.eventManagers[r]={promise:n},n.catch(()=>{delete this.eventManagers[r]}),n}async initAndGetManager(t){const r=await Bfe(t),n=new Cfe(t);return r.register("authEvent",a=>(yr(a==null?void 0:a.authEvent,t,"invalid-auth-event"),{status:n.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=r,n}_isIframeWebStorageSupported(t,r){this.iframes[t._key()].send(gA,{type:gA},a=>{var i;const o=(i=a==null?void 0:a[0])===null||i===void 0?void 0:i[gA];o!==void 0&&r(!!o),Nu(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const r=t._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=Pfe(t)),this.originValidationPromises[r]}get _shouldInitProactively(){return Qq()||TR()||Bw()}}const Qfe=Kfe;var f6="@firebase/auth",h6="0.23.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zfe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const r=this.auth.onIdTokenChanged(n=>{t((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,r),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const r=this.internalListeners.get(t);r&&(this.internalListeners.delete(t),r(),this.updateProactiveRefresh())}assertAuthConfigured(){yr(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jfe(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function ehe(e){P1(new vg("auth",(t,{options:r})=>{const n=t.getProvider("app").getImmediate(),a=t.getProvider("heartbeat"),i=t.getProvider("app-check-internal"),{apiKey:o,authDomain:s}=n.options;yr(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const u={apiKey:o,authDomain:s,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Zq(e)},l=new Tde(n,a,i,u);return Mde(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,r,n)=>{t.getProvider("auth-internal").initialize()})),P1(new vg("auth-internal",t=>{const r=Vg(t.getProvider("auth").getImmediate());return(n=>new Zfe(n))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),zm(f6,h6,Jfe(e)),zm(f6,h6,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const the=5*60,rhe=Mq("authIdTokenMaxAge")||the;let p6=null;const nhe=e=>async t=>{const r=t&&await t.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>rhe)return;const a=r==null?void 0:r.token;p6!==a&&(p6=a,await fetch(e,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function gW(e=Gce()){const t=Oq(e,"auth");if(t.isInitialized())return t.getImmediate();const r=Ide(e,{popupRedirectResolver:Qfe,persistence:[ufe,Kde,cW]}),n=Mq("authTokenSyncURL");if(n){const i=nhe(n);Wde(r,i,()=>i(r.currentUser)),qde(r,o=>i(o))}const a=kle("auth");return a&&Dde(r,`http://${a}`),r}ehe("Browser");const ahe=()=>{const e=Ks(),t=Bg(),r=ze.useRef(null),n=ze.useRef(null),a=ze.useCallback(()=>{const i=gW();t(pg(!0)),Gde(i,r.current.value,n.current.value).then(o=>{const s={login:o.user.email,uid:o.user.uid};t(xq(s)),t(Sq([])),t(Nf("/Home")),t(pg(!1)),console.log("User logged in:",o.user)}).catch(o=>{console.error("Login error:",o.code,o.message)})},[e]);return M.jsxs("div",{className:"loginWindow",children:[M.jsx(wu,{className:"login_label",text:"Login"}),M.jsx(ks,{className:"login_input",placeholder:"email",inputRef:r,text:"Email/login"}),M.jsx(ks,{className:"login_input",placeholder:"password",inputRef:n,type:"password",text:"Pasword"}),M.jsxs("div",{className:"button_container",children:[M.jsx(Qi,{className:"button button__login--apply",onClick:a,text:"Login",to:"/Home"}),"Don’t have an account?",M.jsx(Fw,{to:e.pathname.replace("/Login","/SignUp"),children:"Sign up"})]})]})},ihe=()=>{const e=Ks(),t=ze.useRef(null),r=ze.useRef(null),n=ze.useRef(null),a=ze.useCallback(()=>{var o,s,u;const i=gW();((o=r.current)==null?void 0:o.value)===((s=n.current)==null?void 0:s.value)&&((u=r.current)!=null&&u.value)?Hde(i,t.current.value,r.current.value).catch(function(l){const c=l.code,d=l.message;c=="auth/weak-password"?alert("The password is too weak."):window.alert(d),console.log(l)}):window.alert("passwords are not same!")},[e]);return M.jsxs("div",{className:"loginWindow",children:[M.jsx(wu,{className:"login_label",text:"Sign Up"}),M.jsx(ks,{className:"login_input",placeholder:"email",inputRef:t,text:"Email/login"}),M.jsx(ks,{className:"login_input",placeholder:"password",inputRef:r,type:"password",text:"Pasword"}),M.jsx(ks,{className:"login_input",placeholder:"confurm password",inputRef:n,type:"password",text:"Repeat Pasword"}),M.jsxs("div",{className:"button_container",children:[M.jsx(Qi,{className:"button button__login--apply",onClick:a,text:"Sign Up",to:e.pathname.replace("/SignUp","")}),"Already have an account?",M.jsx(Fw,{to:e.pathname.replace("/SignUp","/Login"),children:"Login"})]})]})},yW=()=>M.jsx("div",{className:"loader",children:"Loading..."}),ohe=()=>M.jsxs("div",{className:"errorPage",children:[M.jsx(wu,{className:"error__text error__text--header",text:"404"}),M.jsx(wu,{className:"error__text error__text--core",text:"page not found"}),M.jsx(Qi,{className:"button button__search",text:"Back to Search",to:"/Home"})]}),she=()=>{const e=Ks(),t=xR(),r=Eo(n=>n.auth.uid);return ze.useEffect(()=>{r?e.pathname==="/"&&t("/Home"):t("/")},[r]),r?M.jsxs("div",{className:"homePage",children:[M.jsx(ble,{}),M.jsx(A1,{})]}):M.jsx("div",{className:"initialPage",children:M.jsx(A1,{})})},uhe=()=>{var a,i,o,s,u;const e=Eo(l=>l.protein),t=new Date(Date.parse((a=e.entryAudit)==null?void 0:a.lastAnnotationUpdateDate)),r=ze.useRef(null),n=ze.useCallback(()=>{var l;(l=r==null?void 0:r.current)==null||l.select(),document.execCommand("copy")},[]);return M.jsxs("div",{className:"details",children:[M.jsxs("div",{className:"details__container",children:[M.jsxs("div",{className:"details__items",children:[M.jsx("span",{children:"Length"}),M.jsx("span",{children:(i=e.sequence)==null?void 0:i.length}),M.jsx("span",{children:"Mass (Da)"}),M.jsx("span",{children:(o=e.sequence)==null?void 0:o.molWeight})]}),M.jsxs("div",{className:"details__items",children:[M.jsx("span",{children:"Last updated"}),M.jsx("span",{children:t.toDateString().substring(4)}),M.jsx("span",{children:"Checksum"}),M.jsx("span",{children:(s=e.sequence)==null?void 0:s.crc64})]})]}),M.jsxs("div",{className:"button_copy_container",children:[M.jsx(Qi,{className:"copy",onClick:n,to:location.pathname}),"Copy"]}),M.jsx("textarea",{ref:r,className:"details__text",defaultValue:(u=e.sequence)==null?void 0:u.value,readOnly:!0})]})};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const v6=typeof window<"u"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,lhe=(e,t,r=null,n=null)=>{for(;t!==r;){const a=t.nextSibling;e.insertBefore(t,n),t=a}},kR=(e,t,r=null)=>{for(;t!==r;){const n=t.nextSibling;e.removeChild(t),t=n}};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Tc=`{{lit-${String(Math.random()).slice(2)}}}`,bW=`<!--${Tc}-->`,m6=new RegExp(`${Tc}|${bW}`),hy="$lit$";class xW{constructor(t,r){this.parts=[],this.element=r;const n=[],a=[],i=document.createTreeWalker(r.content,133,null,!1);let o=0,s=-1,u=0;const{strings:l,values:{length:c}}=t;for(;u<c;){const d=i.nextNode();if(d===null){i.currentNode=a.pop();continue}if(s++,d.nodeType===1){if(d.hasAttributes()){const f=d.attributes,{length:h}=f;let v=0;for(let p=0;p<h;p++)g6(f[p].name,hy)&&v++;for(;v-- >0;){const p=l[u],g=lI.exec(p)[2],m=g.toLowerCase()+hy,y=d.getAttribute(m);d.removeAttribute(m);const b=y.split(m6);this.parts.push({type:"attribute",index:s,name:g,strings:b}),u+=b.length-1}}d.tagName==="TEMPLATE"&&(a.push(d),i.currentNode=d.content)}else if(d.nodeType===3){const f=d.data;if(f.indexOf(Tc)>=0){const h=d.parentNode,v=f.split(m6),p=v.length-1;for(let g=0;g<p;g++){let m,y=v[g];if(y==="")m=lf();else{const b=lI.exec(y);b!==null&&g6(b[2],hy)&&(y=y.slice(0,b.index)+b[1]+b[2].slice(0,-hy.length)+b[3]),m=document.createTextNode(y)}h.insertBefore(m,d),this.parts.push({type:"node",index:++s})}v[p]===""?(h.insertBefore(lf(),d),n.push(d)):d.data=v[p],u+=p}}else if(d.nodeType===8)if(d.data===Tc){const f=d.parentNode;(d.previousSibling===null||s===o)&&(s++,f.insertBefore(lf(),d)),o=s,this.parts.push({type:"node",index:s}),d.nextSibling===null?d.data="":(n.push(d),s--),u++}else{let f=-1;for(;(f=d.data.indexOf(Tc,f+1))!==-1;)this.parts.push({type:"node",index:-1}),u++}}for(const d of n)d.parentNode.removeChild(d)}}const g6=(e,t)=>{const r=e.length-t.length;return r>=0&&e.slice(r)===t},SW=e=>e.index!==-1,lf=()=>document.createComment(""),lI=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const OR=133;function CW(e,t){const{element:{content:r},parts:n}=e,a=document.createTreeWalker(r,OR,null,!1);let i=jy(n),o=n[i],s=-1,u=0;const l=[];let c=null;for(;a.nextNode();){s++;const d=a.currentNode;for(d.previousSibling===c&&(c=null),t.has(d)&&(l.push(d),c===null&&(c=d)),c!==null&&u++;o!==void 0&&o.index===s;)o.index=c!==null?-1:o.index-u,i=jy(n,i),o=n[i]}l.forEach(d=>d.parentNode.removeChild(d))}const che=e=>{let t=e.nodeType===11?0:1;const r=document.createTreeWalker(e,OR,null,!1);for(;r.nextNode();)t++;return t},jy=(e,t=-1)=>{for(let r=t+1;r<e.length;r++){const n=e[r];if(SW(n))return r}return-1};function dhe(e,t,r=null){const{element:{content:n},parts:a}=e;if(r==null){n.appendChild(t);return}const i=document.createTreeWalker(n,OR,null,!1);let o=jy(a),s=0,u=-1;for(;i.nextNode();)for(u++,i.currentNode===r&&(s=che(t),r.parentNode.insertBefore(t,r));o!==-1&&a[o].index===u;){if(s>0){for(;o!==-1;)a[o].index+=s,o=jy(a,o);return}o=jy(a,o)}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const _W=new WeakMap,fhe=e=>(...t)=>{const r=e(...t);return _W.set(r,!0),r},R1=e=>typeof e=="function"&&_W.has(e);/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Eu={},y6={};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class cI{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(const n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(const n of this.__parts)n!==void 0&&n.commit()}_clone(){const t=v6?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,a=document.createTreeWalker(t,133,null,!1);let i=0,o=0,s,u=a.nextNode();for(;i<n.length;){if(s=n[i],!SW(s)){this.__parts.push(void 0),i++;continue}for(;o<s.index;)o++,u.nodeName==="TEMPLATE"&&(r.push(u),a.currentNode=u.content),(u=a.nextNode())===null&&(a.currentNode=r.pop(),u=a.nextNode());if(s.type==="node"){const l=this.processor.handleTextExpression(this.options);l.insertAfterNode(u.previousSibling),this.__parts.push(l)}else this.__parts.push(...this.processor.handleAttributeExpressions(u,s.name,s.strings,this.options));i++}return v6&&(document.adoptNode(t),customElements.upgrade(t)),t}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const b6=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),hhe=` ${Tc} `;class LR{constructor(t,r,n,a){this.strings=t,this.values=r,this.type=n,this.processor=a}getHTML(){const t=this.strings.length-1;let r="",n=!1;for(let a=0;a<t;a++){const i=this.strings[a],o=i.lastIndexOf("<!--");n=(o>-1||n)&&i.indexOf("-->",o+1)===-1;const s=lI.exec(i);s===null?r+=i+(n?hhe:bW):r+=i.substr(0,s.index)+s[1]+s[2]+hy+s[3]+Tc}return r+=this.strings[t],r}getTemplateElement(){const t=document.createElement("template");let r=this.getHTML();return b6!==void 0&&(r=b6.createHTML(r)),t.innerHTML=r,t}}class phe extends LR{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const t=super.getTemplateElement(),r=t.content,n=r.firstChild;return r.removeChild(n),lhe(r,n.firstChild),t}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const zw=e=>e===null||!(typeof e=="object"||typeof e=="function"),dI=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]);class wW{constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let a=0;a<n.length-1;a++)this.parts[a]=this._createPart()}_createPart(){return new EW(this)}_getValue(){const t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){const i=n[0].value;if(typeof i=="symbol")return String(i);if(typeof i=="string"||!dI(i))return i}let a="";for(let i=0;i<r;i++){a+=t[i];const o=n[i];if(o!==void 0){const s=o.value;if(zw(s)||!dI(s))a+=typeof s=="string"?s:String(s);else for(const u of s)a+=typeof u=="string"?u:String(u)}}return a+=t[r],a}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class EW{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==Eu&&(!zw(t)||t!==this.value)&&(this.value=t,R1(t)||(this.committer.dirty=!0))}commit(){for(;R1(this.value);){const t=this.value;this.value=Eu,t(this)}this.value!==Eu&&this.committer.commit()}}class Cb{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(lf()),this.endNode=t.appendChild(lf())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=lf()),t.__insert(this.endNode=lf())}insertAfterPart(t){t.__insert(this.startNode=lf()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;R1(this.__pendingValue);){const r=this.__pendingValue;this.__pendingValue=Eu,r(this)}const t=this.__pendingValue;t!==Eu&&(zw(t)?t!==this.value&&this.__commitText(t):t instanceof LR?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):dI(t)?this.__commitIterable(t):t===y6?(this.value=y6,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const r=this.startNode.nextSibling;t=t??"";const n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){const r=this.options.templateFactory(t);if(this.value instanceof cI&&this.value.template===r)this.value.update(t.values);else{const n=new cI(r,t.processor,this.options),a=n._clone();n.update(t.values),this.__commitNode(a),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const r=this.value;let n=0,a;for(const i of t)a=r[n],a===void 0&&(a=new Cb(this.options),r.push(a),n===0?a.appendIntoPart(this):a.insertAfterPart(r[n-1])),a.setValue(i),a.commit(),n++;n<r.length&&(r.length=n,this.clear(a&&a.endNode))}clear(t=this.startNode){kR(this.startNode.parentNode,t.nextSibling,this.endNode)}}class vhe{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;R1(this.__pendingValue);){const r=this.__pendingValue;this.__pendingValue=Eu,r(this)}if(this.__pendingValue===Eu)return;const t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=Eu}}class mhe extends wW{constructor(t,r,n){super(t,r,n),this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new ghe(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class ghe extends EW{}let AW=!1;(()=>{try{const e={get capture(){return AW=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch{}})();class yhe{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=a=>this.handleEvent(a)}setValue(t){this.__pendingValue=t}commit(){for(;R1(this.__pendingValue);){const i=this.__pendingValue;this.__pendingValue=Eu,i(this)}if(this.__pendingValue===Eu)return;const t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),a=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),a&&(this.__options=bhe(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=Eu}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}const bhe=e=>e&&(AW?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function xhe(e){let t=k1.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},k1.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;const n=e.strings.join(Tc);return r=t.keyString.get(n),r===void 0&&(r=new xW(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}const k1=new Map;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const wm=new WeakMap,She=(e,t,r)=>{let n=wm.get(t);n===void 0&&(kR(t,t.firstChild),wm.set(t,n=new Cb(Object.assign({templateFactory:xhe},r))),n.appendInto(t)),n.setValue(e),n.commit()};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Che{handleAttributeExpressions(t,r,n,a){const i=r[0];return i==="."?new mhe(t,r.slice(1),n).parts:i==="@"?[new yhe(t,r.slice(1),a.eventContext)]:i==="?"?[new vhe(t,r.slice(1),n)]:new wW(t,r,n).parts}handleTextExpression(t){return new Cb(t)}}const PW=new Che;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */typeof window<"u"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const Vr=(e,...t)=>new LR(e,t,"html",PW),fI=(e,...t)=>new phe(e,t,"svg",PW);/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const TW=(e,t)=>`${e}--${t}`;let uC=!0;typeof window.ShadyCSS>"u"?uC=!1:typeof window.ShadyCSS.prepareTemplateDom>"u"&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),uC=!1);const _he=e=>t=>{const r=TW(t.type,e);let n=k1.get(r);n===void 0&&(n={stringsArray:new WeakMap,keyString:new Map},k1.set(r,n));let a=n.stringsArray.get(t.strings);if(a!==void 0)return a;const i=t.strings.join(Tc);if(a=n.keyString.get(i),a===void 0){const o=t.getTemplateElement();uC&&window.ShadyCSS.prepareTemplateDom(o,e),a=new xW(t,o),n.keyString.set(i,a)}return n.stringsArray.set(t.strings,a),a},whe=["html","svg"],Ehe=e=>{whe.forEach(t=>{const r=k1.get(TW(t,e));r!==void 0&&r.keyString.forEach(n=>{const{element:{content:a}}=n,i=new Set;Array.from(a.querySelectorAll("style")).forEach(o=>{i.add(o)}),CW(n,i)})})},IW=new Set,Ahe=(e,t,r)=>{IW.add(e);const n=r?r.element:document.createElement("template"),a=t.querySelectorAll("style"),{length:i}=a;if(i===0){window.ShadyCSS.prepareTemplateStyles(n,e);return}const o=document.createElement("style");for(let l=0;l<i;l++){const c=a[l];c.parentNode.removeChild(c),o.textContent+=c.textContent}Ehe(e);const s=n.content;r?dhe(r,o,s.firstChild):s.insertBefore(o,s.firstChild),window.ShadyCSS.prepareTemplateStyles(n,e);const u=s.querySelector("style");if(window.ShadyCSS.nativeShadow&&u!==null)t.insertBefore(u.cloneNode(!0),t.firstChild);else if(r){s.insertBefore(o,s.firstChild);const l=new Set;l.add(o),CW(r,l)}},Phe=(e,t,r)=>{if(!r||typeof r!="object"||!r.scopeName)throw new Error("The `scopeName` option is required.");const n=r.scopeName,a=wm.has(t),i=uC&&t.nodeType===11&&!!t.host,o=i&&!IW.has(n),s=o?document.createDocumentFragment():t;if(She(e,s,Object.assign({templateFactory:_he(n)},r)),o){const u=wm.get(s);wm.delete(s);const l=u.value instanceof cI?u.value.template:void 0;Ahe(n,s,l),kR(t,t.firstChild),t.appendChild(s),wm.set(t,u)}!a&&i&&window.ShadyCSS.styleElement(t.host)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var MW;window.JSCompiler_renameProperty=(e,t)=>e;const hI={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return e!==null;case Number:return e===null?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},DW=(e,t)=>t!==e&&(t===t||e===e),yA={attribute:!0,type:String,converter:hI,reflect:!1,hasChanged:DW},bA=1,xA=1<<2,SA=1<<3,CA=1<<4,pI="finalized";class RW extends HTMLElement{constructor(){super(),this.initialize()}static get observedAttributes(){this.finalize();const t=[];return this._classProperties.forEach((r,n)=>{const a=this._attributeNameForProperty(n,r);a!==void 0&&(this._attributeToPropertyMap.set(a,n),t.push(a))}),t}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const t=Object.getPrototypeOf(this)._classProperties;t!==void 0&&t.forEach((r,n)=>this._classProperties.set(n,r))}}static createProperty(t,r=yA){if(this._ensureClassProperties(),this._classProperties.set(t,r),r.noAccessor||this.prototype.hasOwnProperty(t))return;const n=typeof t=="symbol"?Symbol():`__${t}`,a=this.getPropertyDescriptor(t,n,r);a!==void 0&&Object.defineProperty(this.prototype,t,a)}static getPropertyDescriptor(t,r,n){return{get(){return this[r]},set(a){const i=this[t];this[r]=a,this.requestUpdateInternal(t,i,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this._classProperties&&this._classProperties.get(t)||yA}static finalize(){const t=Object.getPrototypeOf(this);if(t.hasOwnProperty(pI)||t.finalize(),this[pI]=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const r=this.properties,n=[...Object.getOwnPropertyNames(r),...typeof Object.getOwnPropertySymbols=="function"?Object.getOwnPropertySymbols(r):[]];for(const a of n)this.createProperty(a,r[a])}}static _attributeNameForProperty(t,r){const n=r.attribute;return n===!1?void 0:typeof n=="string"?n:typeof t=="string"?t.toLowerCase():void 0}static _valueHasChanged(t,r,n=DW){return n(t,r)}static _propertyValueFromAttribute(t,r){const n=r.type,a=r.converter||hI,i=typeof a=="function"?a:a.fromAttribute;return i?i(t,n):t}static _propertyValueToAttribute(t,r){if(r.reflect===void 0)return;const n=r.type,a=r.converter;return(a&&a.toAttribute||hI.toAttribute)(t,n)}initialize(){this._updateState=0,this._updatePromise=new Promise(t=>this._enableUpdatingResolver=t),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach((t,r)=>{if(this.hasOwnProperty(r)){const n=this[r];delete this[r],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(r,n)}})}_applyInstanceProperties(){this._instanceProperties.forEach((t,r)=>this[r]=t),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){this._enableUpdatingResolver!==void 0&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(t,r,n){r!==n&&this._attributeToProperty(t,n)}_propertyToAttribute(t,r,n=yA){const a=this.constructor,i=a._attributeNameForProperty(t,n);if(i!==void 0){const o=a._propertyValueToAttribute(r,n);if(o===void 0)return;this._updateState=this._updateState|SA,o==null?this.removeAttribute(i):this.setAttribute(i,o),this._updateState=this._updateState&~SA}}_attributeToProperty(t,r){if(this._updateState&SA)return;const n=this.constructor,a=n._attributeToPropertyMap.get(t);if(a!==void 0){const i=n.getPropertyOptions(a);this._updateState=this._updateState|CA,this[a]=n._propertyValueFromAttribute(r,i),this._updateState=this._updateState&~CA}}requestUpdateInternal(t,r,n){let a=!0;if(t!==void 0){const i=this.constructor;n=n||i.getPropertyOptions(t),i._valueHasChanged(this[t],r,n.hasChanged)?(this._changedProperties.has(t)||this._changedProperties.set(t,r),n.reflect===!0&&!(this._updateState&CA)&&(this._reflectingProperties===void 0&&(this._reflectingProperties=new Map),this._reflectingProperties.set(t,n))):a=!1}!this._hasRequestedUpdate&&a&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(t,r){return this.requestUpdateInternal(t,r),this.updateComplete}async _enqueueUpdate(){this._updateState=this._updateState|xA;try{await this._updatePromise}catch{}const t=this.performUpdate();return t!=null&&await t,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return this._updateState&xA}get hasUpdated(){return this._updateState&bA}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let t=!1;const r=this._changedProperties;try{t=this.shouldUpdate(r),t?this.update(r):this._markUpdated()}catch(n){throw t=!1,this._markUpdated(),n}t&&(this._updateState&bA||(this._updateState=this._updateState|bA,this.firstUpdated(r)),this.updated(r))}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~xA}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._updatePromise}shouldUpdate(t){return!0}update(t){this._reflectingProperties!==void 0&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((r,n)=>this._propertyToAttribute(n,this[n],r)),this._reflectingProperties=void 0),this._markUpdated()}updated(t){}firstUpdated(t){}}MW=pI;RW[MW]=!0;/**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/const vI=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,NR=Symbol();class FR{constructor(t,r){if(r!==NR)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){return this._styleSheet===void 0&&(vI?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const The=e=>new FR(String(e),NR),Ihe=e=>{if(e instanceof FR)return e.cssText;if(typeof e=="number")return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but
            take care to ensure page security.`)},Qs=(e,...t)=>{const r=t.reduce((n,a,i)=>n+Ihe(a)+e[i+1],e[0]);return new FR(r,NR)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");const x6={};class ph extends RW{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const t=this.getStyles();if(Array.isArray(t)){const r=(i,o)=>i.reduceRight((s,u)=>Array.isArray(u)?r(u,s):(s.add(u),s),o),n=r(t,new Set),a=[];n.forEach(i=>a.unshift(i)),this._styles=a}else this._styles=t===void 0?[]:[t];this._styles=this._styles.map(r=>{if(r instanceof CSSStyleSheet&&!vI){const n=Array.prototype.slice.call(r.cssRules).reduce((a,i)=>a+i.cssText,"");return The(n)}return r})}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow(this.constructor.shadowRootOptions)}adoptStyles(){const t=this.constructor._styles;t.length!==0&&(window.ShadyCSS!==void 0&&!window.ShadyCSS.nativeShadow?window.ShadyCSS.ScopingShim.prepareAdoptedCssText(t.map(r=>r.cssText),this.localName):vI?this.renderRoot.adoptedStyleSheets=t.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet):this._needsShimAdoptedStyleSheets=!0)}connectedCallback(){super.connectedCallback(),this.hasUpdated&&window.ShadyCSS!==void 0&&window.ShadyCSS.styleElement(this)}update(t){const r=this.render();super.update(t),r!==x6&&this.constructor.render(r,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(n=>{const a=document.createElement("style");a.textContent=n.cssText,this.renderRoot.appendChild(a)}))}render(){return x6}}ph.finalized=!0;ph.render=Phe;ph.shadowRootOptions={mode:"open"};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const S6=new WeakMap,mI=fhe(e=>t=>{if(!(t instanceof Cb))throw new Error("unsafeHTML can only be used in text bindings");const r=S6.get(t);if(r!==void 0&&zw(e)&&e===r.value&&t.value===r.fragment)return;const n=document.createElement("template");n.innerHTML=e;const a=document.importNode(n.content,!0);t.setValue(a),S6.set(t,{value:e,fragment:a})});var Mhe=function(e){return new Promise(function(t){return setTimeout(function(){return t()},e)})},gI="node";typeof importScripts<"u"?gI="worker":typeof window<"u"&&(gI="browser");var Dhe=gI,kW=function(){return Mhe(0)};Dhe==="browser"&&"requestAnimationFrame"in window&&(kW=function(){return new Promise(function(e){return window.requestAnimationFrame(function(){return e()})})});var Rhe=kW,khe=Rhe;function OW(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ohe(e){return e.length===1&&(e=Lhe(e)),{left:function(t,r,n,a){for(n==null&&(n=0),a==null&&(a=t.length);n<a;){var i=n+a>>>1;e(t[i],r)<0?n=i+1:a=i}return n},right:function(t,r,n,a){for(n==null&&(n=0),a==null&&(a=t.length);n<a;){var i=n+a>>>1;e(t[i],r)>0?a=i:n=i+1}return n}}}function Lhe(e){return function(t,r){return OW(e(t),r)}}var Nhe=Ohe(OW),Fhe=Nhe.right;function Bhe(e,t,r){e=+e,t=+t,r=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+r;for(var n=-1,a=Math.max(0,Math.ceil((t-e)/r))|0,i=new Array(a);++n<a;)i[n]=e+n*r;return i}var yI=Math.sqrt(50),bI=Math.sqrt(10),xI=Math.sqrt(2);function Uhe(e,t,r){var n,a=-1,i,o,s;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(i=e,e=t,t=i),(s=iS(e,t,r))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(i=Math.ceil(t-e+1));++a<i;)o[a]=(e+a)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(i=Math.ceil(e-t+1));++a<i;)o[a]=(e-a)/s;return n&&o.reverse(),o}function iS(e,t,r){var n=(t-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),i=n/Math.pow(10,a);return a>=0?(i>=yI?10:i>=bI?5:i>=xI?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(i>=yI?10:i>=bI?5:i>=xI?2:1)}function jhe(e,t,r){var n=Math.abs(t-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),i=n/a;return i>=yI?a*=10:i>=bI?a*=5:i>=xI&&(a*=2),t<e?-a:a}function C6(e,t){var r=e.length,n=-1,a,i;if(t==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(i=a;++n<r;)(a=e[n])!=null&&a>i&&(i=a)}else for(;++n<r;)if((a=t(e[n],n,e))!=null&&a>=a)for(i=a;++n<r;)(a=t(e[n],n,e))!=null&&a>i&&(i=a);return i}var _A=Array.prototype.slice;function zhe(e){return e}var wA=1,oS=2,SI=3,py=4,_6=1e-6;function Vhe(e){return"translate("+(e+.5)+",0)"}function Hhe(e){return"translate(0,"+(e+.5)+")"}function Ghe(e){return function(t){return+e(t)}}function qhe(e){var t=Math.max(0,e.bandwidth()-1)/2;return e.round()&&(t=Math.round(t)),function(r){return+e(r)+t}}function Whe(){return!this.__axis}function BR(e,t){var r=[],n=null,a=null,i=6,o=6,s=3,u=e===wA||e===py?-1:1,l=e===py||e===oS?"x":"y",c=e===wA||e===SI?Vhe:Hhe;function d(f){var h=n??(t.ticks?t.ticks.apply(t,r):t.domain()),v=a??(t.tickFormat?t.tickFormat.apply(t,r):zhe),p=Math.max(i,0)+s,g=t.range(),m=+g[0]+.5,y=+g[g.length-1]+.5,b=(t.bandwidth?qhe:Ghe)(t.copy()),S=f.selection?f.selection():f,x=S.selectAll(".domain").data([null]),C=S.selectAll(".tick").data(h,t).order(),w=C.exit(),A=C.enter().append("g").attr("class","tick"),I=C.select("line"),D=C.select("text");x=x.merge(x.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),C=C.merge(A),I=I.merge(A.append("line").attr("stroke","currentColor").attr(l+"2",u*i)),D=D.merge(A.append("text").attr("fill","currentColor").attr(l,u*p).attr("dy",e===wA?"0em":e===SI?"0.71em":"0.32em")),f!==S&&(x=x.transition(f),C=C.transition(f),I=I.transition(f),D=D.transition(f),w=w.transition(f).attr("opacity",_6).attr("transform",function(k){return isFinite(k=b(k))?c(k):this.getAttribute("transform")}),A.attr("opacity",_6).attr("transform",function(k){var R=this.parentNode.__axis;return c(R&&isFinite(R=R(k))?R:b(k))})),w.remove(),x.attr("d",e===py||e==oS?o?"M"+u*o+","+m+"H0.5V"+y+"H"+u*o:"M0.5,"+m+"V"+y:o?"M"+m+","+u*o+"V0.5H"+y+"V"+u*o:"M"+m+",0.5H"+y),C.attr("opacity",1).attr("transform",function(k){return c(b(k))}),I.attr(l+"2",u*i),D.attr(l,u*p).text(v),S.filter(Whe).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===oS?"start":e===py?"end":"middle"),S.each(function(){this.__axis=b})}return d.scale=function(f){return arguments.length?(t=f,d):t},d.ticks=function(){return r=_A.call(arguments),d},d.tickArguments=function(f){return arguments.length?(r=f==null?[]:_A.call(f),d):r.slice()},d.tickValues=function(f){return arguments.length?(n=f==null?null:_A.call(f),d):n&&n.slice()},d.tickFormat=function(f){return arguments.length?(a=f,d):a},d.tickSize=function(f){return arguments.length?(i=o=+f,d):i},d.tickSizeInner=function(f){return arguments.length?(i=+f,d):i},d.tickSizeOuter=function(f){return arguments.length?(o=+f,d):o},d.tickPadding=function(f){return arguments.length?(s=+f,d):s},d}function $he(e){return BR(oS,e)}function LW(e){return BR(SI,e)}function Xhe(e){return BR(py,e)}var Yhe={value:function(){}};function Vw(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new sS(r)}function sS(e){this._=e}function Khe(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",a=r.indexOf(".");if(a>=0&&(n=r.slice(a+1),r=r.slice(0,a)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}sS.prototype=Vw.prototype={constructor:sS,on:function(e,t){var r=this._,n=Khe(e+"",r),a,i=-1,o=n.length;if(arguments.length<2){for(;++i<o;)if((a=(e=n[i]).type)&&(a=Qhe(r[a],e.name)))return a;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<o;)if(a=(e=n[i]).type)r[a]=w6(r[a],e.name,t);else if(t==null)for(a in r)r[a]=w6(r[a],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new sS(e)},call:function(e,t){if((a=arguments.length-2)>0)for(var r=new Array(a),n=0,a,i;n<a;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],n=0,a=i.length;n<a;++n)i[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],a=0,i=n.length;a<i;++a)n[a].value.apply(t,r)}};function Qhe(e,t){for(var r=0,n=e.length,a;r<n;++r)if((a=e[r]).name===t)return a.value}function w6(e,t,r){for(var n=0,a=e.length;n<a;++n)if(e[n].name===t){e[n]=Yhe,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var CI="http://www.w3.org/1999/xhtml";const E6={svg:"http://www.w3.org/2000/svg",xhtml:CI,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Hw(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),E6.hasOwnProperty(t)?{space:E6[t],local:e}:e}function Zhe(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===CI&&t.documentElement.namespaceURI===CI?t.createElement(e):t.createElementNS(r,e)}}function Jhe(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function NW(e){var t=Hw(e);return(t.local?Jhe:Zhe)(t)}function epe(){}function UR(e){return e==null?epe:function(){return this.querySelector(e)}}function tpe(e){typeof e!="function"&&(e=UR(e));for(var t=this._groups,r=t.length,n=new Array(r),a=0;a<r;++a)for(var i=t[a],o=i.length,s=n[a]=new Array(o),u,l,c=0;c<o;++c)(u=i[c])&&(l=e.call(u,u.__data__,c,i))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new Zo(n,this._parents)}function rpe(){return[]}function FW(e){return e==null?rpe:function(){return this.querySelectorAll(e)}}function npe(e){typeof e!="function"&&(e=FW(e));for(var t=this._groups,r=t.length,n=[],a=[],i=0;i<r;++i)for(var o=t[i],s=o.length,u,l=0;l<s;++l)(u=o[l])&&(n.push(e.call(u,u.__data__,l,o)),a.push(u));return new Zo(n,a)}function BW(e){return function(){return this.matches(e)}}function ape(e){typeof e!="function"&&(e=BW(e));for(var t=this._groups,r=t.length,n=new Array(r),a=0;a<r;++a)for(var i=t[a],o=i.length,s=n[a]=[],u,l=0;l<o;++l)(u=i[l])&&e.call(u,u.__data__,l,i)&&s.push(u);return new Zo(n,this._parents)}function UW(e){return new Array(e.length)}function ipe(){return new Zo(this._enter||this._groups.map(UW),this._parents)}function lC(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}lC.prototype={constructor:lC,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function ope(e){return function(){return e}}var A6="$";function spe(e,t,r,n,a,i){for(var o=0,s,u=t.length,l=i.length;o<l;++o)(s=t[o])?(s.__data__=i[o],n[o]=s):r[o]=new lC(e,i[o]);for(;o<u;++o)(s=t[o])&&(a[o]=s)}function upe(e,t,r,n,a,i,o){var s,u,l={},c=t.length,d=i.length,f=new Array(c),h;for(s=0;s<c;++s)(u=t[s])&&(f[s]=h=A6+o.call(u,u.__data__,s,t),h in l?a[s]=u:l[h]=u);for(s=0;s<d;++s)h=A6+o.call(e,i[s],s,i),(u=l[h])?(n[s]=u,u.__data__=i[s],l[h]=null):r[s]=new lC(e,i[s]);for(s=0;s<c;++s)(u=t[s])&&l[f[s]]===u&&(a[s]=u)}function lpe(e,t){if(!e)return h=new Array(this.size()),l=-1,this.each(function(C){h[++l]=C}),h;var r=t?upe:spe,n=this._parents,a=this._groups;typeof e!="function"&&(e=ope(e));for(var i=a.length,o=new Array(i),s=new Array(i),u=new Array(i),l=0;l<i;++l){var c=n[l],d=a[l],f=d.length,h=e.call(c,c&&c.__data__,l,n),v=h.length,p=s[l]=new Array(v),g=o[l]=new Array(v),m=u[l]=new Array(f);r(c,d,p,g,m,h,t);for(var y=0,b=0,S,x;y<v;++y)if(S=p[y]){for(y>=b&&(b=y+1);!(x=g[b])&&++b<v;);S._next=x||null}}return o=new Zo(o,n),o._enter=s,o._exit=u,o}function cpe(){return new Zo(this._exit||this._groups.map(UW),this._parents)}function dpe(e,t,r){var n=this.enter(),a=this,i=this.exit();return n=typeof e=="function"?e(n):n.append(e+""),t!=null&&(a=t(a)),r==null?i.remove():r(i),n&&a?n.merge(a).order():a}function fpe(e){for(var t=this._groups,r=e._groups,n=t.length,a=r.length,i=Math.min(n,a),o=new Array(n),s=0;s<i;++s)for(var u=t[s],l=r[s],c=u.length,d=o[s]=new Array(c),f,h=0;h<c;++h)(f=u[h]||l[h])&&(d[h]=f);for(;s<n;++s)o[s]=t[s];return new Zo(o,this._parents)}function hpe(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],a=n.length-1,i=n[a],o;--a>=0;)(o=n[a])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function ppe(e){e||(e=vpe);function t(d,f){return d&&f?e(d.__data__,f.__data__):!d-!f}for(var r=this._groups,n=r.length,a=new Array(n),i=0;i<n;++i){for(var o=r[i],s=o.length,u=a[i]=new Array(s),l,c=0;c<s;++c)(l=o[c])&&(u[c]=l);u.sort(t)}return new Zo(a,this._parents).order()}function vpe(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function mpe(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function gpe(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e}function ype(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],a=0,i=n.length;a<i;++a){var o=n[a];if(o)return o}return null}function bpe(){var e=0;return this.each(function(){++e}),e}function xpe(){return!this.node()}function Spe(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var a=t[r],i=0,o=a.length,s;i<o;++i)(s=a[i])&&e.call(s,s.__data__,i,a);return this}function Cpe(e){return function(){this.removeAttribute(e)}}function _pe(e){return function(){this.removeAttributeNS(e.space,e.local)}}function wpe(e,t){return function(){this.setAttribute(e,t)}}function Epe(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Ape(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function Ppe(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function Tpe(e,t){var r=Hw(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?_pe:Cpe:typeof t=="function"?r.local?Ppe:Ape:r.local?Epe:wpe)(r,t))}function jW(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Ipe(e){return function(){this.style.removeProperty(e)}}function Mpe(e,t,r){return function(){this.style.setProperty(e,t,r)}}function Dpe(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function Rpe(e,t,r){return arguments.length>1?this.each((t==null?Ipe:typeof t=="function"?Dpe:Mpe)(e,t,r??"")):mg(this.node(),e)}function mg(e,t){return e.style.getPropertyValue(t)||jW(e).getComputedStyle(e,null).getPropertyValue(t)}function kpe(e){return function(){delete this[e]}}function Ope(e,t){return function(){this[e]=t}}function Lpe(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function Npe(e,t){return arguments.length>1?this.each((t==null?kpe:typeof t=="function"?Lpe:Ope)(e,t)):this.node()[e]}function zW(e){return e.trim().split(/^|\s+/)}function jR(e){return e.classList||new VW(e)}function VW(e){this._node=e,this._names=zW(e.getAttribute("class")||"")}VW.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function HW(e,t){for(var r=jR(e),n=-1,a=t.length;++n<a;)r.add(t[n])}function GW(e,t){for(var r=jR(e),n=-1,a=t.length;++n<a;)r.remove(t[n])}function Fpe(e){return function(){HW(this,e)}}function Bpe(e){return function(){GW(this,e)}}function Upe(e,t){return function(){(t.apply(this,arguments)?HW:GW)(this,e)}}function jpe(e,t){var r=zW(e+"");if(arguments.length<2){for(var n=jR(this.node()),a=-1,i=r.length;++a<i;)if(!n.contains(r[a]))return!1;return!0}return this.each((typeof t=="function"?Upe:t?Fpe:Bpe)(r,t))}function zpe(){this.textContent=""}function Vpe(e){return function(){this.textContent=e}}function Hpe(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Gpe(e){return arguments.length?this.each(e==null?zpe:(typeof e=="function"?Hpe:Vpe)(e)):this.node().textContent}function qpe(){this.innerHTML=""}function Wpe(e){return function(){this.innerHTML=e}}function $pe(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Xpe(e){return arguments.length?this.each(e==null?qpe:(typeof e=="function"?$pe:Wpe)(e)):this.node().innerHTML}function Ype(){this.nextSibling&&this.parentNode.appendChild(this)}function Kpe(){return this.each(Ype)}function Qpe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Zpe(){return this.each(Qpe)}function Jpe(e){var t=typeof e=="function"?e:NW(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function eve(){return null}function tve(e,t){var r=typeof e=="function"?e:NW(e),n=t==null?eve:typeof t=="function"?t:UR(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function rve(){var e=this.parentNode;e&&e.removeChild(this)}function nve(){return this.each(rve)}function ave(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ive(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ove(e){return this.select(e?ive:ave)}function sve(e){return arguments.length?this.property("__data__",e):this.node().__data__}var qW={},$t=null;if(typeof document<"u"){var uve=document.documentElement;"onmouseenter"in uve||(qW={mouseenter:"mouseover",mouseleave:"mouseout"})}function lve(e,t,r){return e=WW(e,t,r),function(n){var a=n.relatedTarget;(!a||a!==this&&!(a.compareDocumentPosition(this)&8))&&e.call(this,n)}}function WW(e,t,r){return function(n){var a=$t;$t=n;try{e.call(this,this.__data__,t,r)}finally{$t=a}}}function cve(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function dve(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,a=t.length,i;r<a;++r)i=t[r],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.capture):t[++n]=i;++n?t.length=n:delete this.__on}}}function fve(e,t,r){var n=qW.hasOwnProperty(e.type)?lve:WW;return function(a,i,o){var s=this.__on,u,l=n(t,i,o);if(s){for(var c=0,d=s.length;c<d;++c)if((u=s[c]).type===e.type&&u.name===e.name){this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=l,u.capture=r),u.value=t;return}}this.addEventListener(e.type,l,r),u={type:e.type,name:e.name,value:t,listener:l,capture:r},s?s.push(u):this.__on=[u]}}function hve(e,t,r){var n=cve(e+""),a,i=n.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(a=0,c=s[u];a<i;++a)if((o=n[a]).type===c.type&&o.name===c.name)return c.value}return}for(s=t?fve:dve,r==null&&(r=!1),a=0;a<i;++a)this.each(s(n[a],t,r));return this}function $W(e,t,r,n){var a=$t;e.sourceEvent=$t,$t=e;try{return t.apply(r,n)}finally{$t=a}}function XW(e,t,r){var n=jW(e),a=n.CustomEvent;typeof a=="function"?a=new a(t,r):(a=n.document.createEvent("Event"),r?(a.initEvent(t,r.bubbles,r.cancelable),a.detail=r.detail):a.initEvent(t,!1,!1)),e.dispatchEvent(a)}function pve(e,t){return function(){return XW(this,e,t)}}function vve(e,t){return function(){return XW(this,e,t.apply(this,arguments))}}function mve(e,t){return this.each((typeof t=="function"?vve:pve)(e,t))}var YW=[null];function Zo(e,t){this._groups=e,this._parents=t}function _b(){return new Zo([[document.documentElement]],YW)}Zo.prototype=_b.prototype={constructor:Zo,select:tpe,selectAll:npe,filter:ape,data:lpe,enter:ipe,exit:cpe,join:dpe,merge:fpe,order:hpe,sort:ppe,call:mpe,nodes:gpe,node:ype,size:bpe,empty:xpe,each:Spe,attr:Tpe,style:Rpe,property:Npe,classed:jpe,text:Gpe,html:Xpe,raise:Kpe,lower:Zpe,append:Jpe,insert:tve,remove:nve,clone:ove,datum:sve,on:hve,dispatch:mve};function Ga(e){return typeof e=="string"?new Zo([[document.querySelector(e)]],[document.documentElement]):new Zo([[e]],YW)}function KW(){for(var e=$t,t;t=e.sourceEvent;)e=t;return e}function QW(e,t){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}function vy(e){var t=KW();return t.changedTouches&&(t=t.changedTouches[0]),QW(e,t)}function _I(e,t,r){arguments.length<3&&(r=t,t=KW().changedTouches);for(var n=0,a=t?t.length:0,i;n<a;++n)if((i=t[n]).identifier===r)return QW(e,i);return null}function wI(){$t.preventDefault(),$t.stopImmediatePropagation()}function ZW(e){var t=e.document.documentElement,r=Ga(e).on("dragstart.drag",wI,!0);"onselectstart"in t?r.on("selectstart.drag",wI,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function JW(e,t){var r=e.document.documentElement,n=Ga(e).on("dragstart.drag",null);t&&(n.on("click.drag",wI,!0),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}function zR(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function e$(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function wb(){}var O1=.7,cC=1/O1,Gm="\\s*([+-]?\\d+)\\s*",L1="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",El="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gve=/^#([0-9a-f]{3,8})$/,yve=new RegExp("^rgb\\("+[Gm,Gm,Gm]+"\\)$"),bve=new RegExp("^rgb\\("+[El,El,El]+"\\)$"),xve=new RegExp("^rgba\\("+[Gm,Gm,Gm,L1]+"\\)$"),Sve=new RegExp("^rgba\\("+[El,El,El,L1]+"\\)$"),Cve=new RegExp("^hsl\\("+[L1,El,El]+"\\)$"),_ve=new RegExp("^hsla\\("+[L1,El,El,L1]+"\\)$"),P6={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};zR(wb,Lp,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:T6,formatHex:T6,formatHsl:wve,formatRgb:I6,toString:I6});function T6(){return this.rgb().formatHex()}function wve(){return t$(this).formatHsl()}function I6(){return this.rgb().formatRgb()}function Lp(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=gve.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?M6(t):r===3?new qo(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?E2(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?E2(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=yve.exec(e))?new qo(t[1],t[2],t[3],1):(t=bve.exec(e))?new qo(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=xve.exec(e))?E2(t[1],t[2],t[3],t[4]):(t=Sve.exec(e))?E2(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Cve.exec(e))?k6(t[1],t[2]/100,t[3]/100,1):(t=_ve.exec(e))?k6(t[1],t[2]/100,t[3]/100,t[4]):P6.hasOwnProperty(e)?M6(P6[e]):e==="transparent"?new qo(NaN,NaN,NaN,0):null}function M6(e){return new qo(e>>16&255,e>>8&255,e&255,1)}function E2(e,t,r,n){return n<=0&&(e=t=r=NaN),new qo(e,t,r,n)}function Eve(e){return e instanceof wb||(e=Lp(e)),e?(e=e.rgb(),new qo(e.r,e.g,e.b,e.opacity)):new qo}function EI(e,t,r,n){return arguments.length===1?Eve(e):new qo(e,t,r,n??1)}function qo(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}zR(qo,EI,e$(wb,{brighter:function(e){return e=e==null?cC:Math.pow(cC,e),new qo(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?O1:Math.pow(O1,e),new qo(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:D6,formatHex:D6,formatRgb:R6,toString:R6}));function D6(){return"#"+EA(this.r)+EA(this.g)+EA(this.b)}function R6(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function EA(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function k6(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new vl(e,t,r,n)}function t$(e){if(e instanceof vl)return new vl(e.h,e.s,e.l,e.opacity);if(e instanceof wb||(e=Lp(e)),!e)return new vl;if(e instanceof vl)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,a=Math.min(t,r,n),i=Math.max(t,r,n),o=NaN,s=i-a,u=(i+a)/2;return s?(t===i?o=(r-n)/s+(r<n)*6:r===i?o=(n-t)/s+2:o=(t-r)/s+4,s/=u<.5?i+a:2-i-a,o*=60):s=u>0&&u<1?0:o,new vl(o,s,u,e.opacity)}function Ave(e,t,r,n){return arguments.length===1?t$(e):new vl(e,t,r,n??1)}function vl(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}zR(vl,Ave,e$(wb,{brighter:function(e){return e=e==null?cC:Math.pow(cC,e),new vl(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?O1:Math.pow(O1,e),new vl(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,a=2*r-n;return new qo(AA(e>=240?e-240:e+120,a,n),AA(e,a,n),AA(e<120?e+240:e-120,a,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function AA(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function VR(e){return function(){return e}}function Pve(e,t){return function(r){return e+r*t}}function Tve(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function Ive(e){return(e=+e)==1?r$:function(t,r){return r-t?Tve(t,r,e):VR(isNaN(t)?r:t)}}function r$(e,t){var r=t-e;return r?Pve(e,r):VR(isNaN(e)?t:e)}const dC=function e(t){var r=Ive(t);function n(a,i){var o=r((a=EI(a)).r,(i=EI(i)).r),s=r(a.g,i.g),u=r(a.b,i.b),l=r$(a.opacity,i.opacity);return function(c){return a.r=o(c),a.g=s(c),a.b=u(c),a.opacity=l(c),a+""}}return n.gamma=e,n}(1);function Mve(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),a;return function(i){for(a=0;a<r;++a)n[a]=e[a]*(1-i)+t[a]*i;return n}}function Dve(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Rve(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,a=new Array(n),i=new Array(r),o;for(o=0;o<n;++o)a[o]=Gw(e[o],t[o]);for(;o<r;++o)i[o]=t[o];return function(s){for(o=0;o<n;++o)i[o]=a[o](s);return i}}function kve(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function vu(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function Ove(e,t){var r={},n={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?r[a]=Gw(e[a],t[a]):n[a]=t[a];return function(i){for(a in r)n[a]=r[a](i);return n}}var AI=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,PA=new RegExp(AI.source,"g");function Lve(e){return function(){return e}}function Nve(e){return function(t){return e(t)+""}}function n$(e,t){var r=AI.lastIndex=PA.lastIndex=0,n,a,i,o=-1,s=[],u=[];for(e=e+"",t=t+"";(n=AI.exec(e))&&(a=PA.exec(t));)(i=a.index)>r&&(i=t.slice(r,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(a=a[0])?s[o]?s[o]+=a:s[++o]=a:(s[++o]=null,u.push({i:o,x:vu(n,a)})),r=PA.lastIndex;return r<t.length&&(i=t.slice(r),s[o]?s[o]+=i:s[++o]=i),s.length<2?u[0]?Nve(u[0].x):Lve(t):(t=u.length,function(l){for(var c=0,d;c<t;++c)s[(d=u[c]).i]=d.x(l);return s.join("")})}function Gw(e,t){var r=typeof t,n;return t==null||r==="boolean"?VR(t):(r==="number"?vu:r==="string"?(n=Lp(t))?(t=n,dC):n$:t instanceof Lp?dC:t instanceof Date?kve:Dve(t)?Mve:Array.isArray(t)?Rve:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Ove:vu)(e,t)}function Fve(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var O6=180/Math.PI,PI={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function a$(e,t,r,n,a,i){var o,s,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*r+t*n)&&(r-=e*u,n-=t*u),(s=Math.sqrt(r*r+n*n))&&(r/=s,n/=s,u/=s),e*n<t*r&&(e=-e,t=-t,u=-u,o=-o),{translateX:a,translateY:i,rotate:Math.atan2(t,e)*O6,skewX:Math.atan(u)*O6,scaleX:o,scaleY:s}}var T0,TA,L6,A2;function Bve(e){return e==="none"?PI:(T0||(T0=document.createElement("DIV"),TA=document.documentElement,L6=document.defaultView),T0.style.transform=e,e=L6.getComputedStyle(TA.appendChild(T0),null).getPropertyValue("transform"),TA.removeChild(T0),e=e.slice(7,-1).split(","),a$(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function Uve(e){return e==null||(A2||(A2=document.createElementNS("http://www.w3.org/2000/svg","g")),A2.setAttribute("transform",e),!(e=A2.transform.baseVal.consolidate()))?PI:(e=e.matrix,a$(e.a,e.b,e.c,e.d,e.e,e.f))}function i$(e,t,r,n){function a(l){return l.length?l.pop()+" ":""}function i(l,c,d,f,h,v){if(l!==d||c!==f){var p=h.push("translate(",null,t,null,r);v.push({i:p-4,x:vu(l,d)},{i:p-2,x:vu(c,f)})}else(d||f)&&h.push("translate("+d+t+f+r)}function o(l,c,d,f){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),f.push({i:d.push(a(d)+"rotate(",null,n)-2,x:vu(l,c)})):c&&d.push(a(d)+"rotate("+c+n)}function s(l,c,d,f){l!==c?f.push({i:d.push(a(d)+"skewX(",null,n)-2,x:vu(l,c)}):c&&d.push(a(d)+"skewX("+c+n)}function u(l,c,d,f,h,v){if(l!==d||c!==f){var p=h.push(a(h)+"scale(",null,",",null,")");v.push({i:p-4,x:vu(l,d)},{i:p-2,x:vu(c,f)})}else(d!==1||f!==1)&&h.push(a(h)+"scale("+d+","+f+")")}return function(l,c){var d=[],f=[];return l=e(l),c=e(c),i(l.translateX,l.translateY,c.translateX,c.translateY,d,f),o(l.rotate,c.rotate,d,f),s(l.skewX,c.skewX,d,f),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,d,f),l=c=null,function(h){for(var v=-1,p=f.length,g;++v<p;)d[(g=f[v]).i]=g.x(h);return d.join("")}}}var jve=i$(Bve,"px, ","px)","deg)"),zve=i$(Uve,", ",")",")"),I0=Math.SQRT2,IA=2,N6=4,Vve=1e-12;function F6(e){return((e=Math.exp(e))+1/e)/2}function Hve(e){return((e=Math.exp(e))-1/e)/2}function Gve(e){return((e=Math.exp(2*e))-1)/(e+1)}function qve(e,t){var r=e[0],n=e[1],a=e[2],i=t[0],o=t[1],s=t[2],u=i-r,l=o-n,c=u*u+l*l,d,f;if(c<Vve)f=Math.log(s/a)/I0,d=function(y){return[r+y*u,n+y*l,a*Math.exp(I0*y*f)]};else{var h=Math.sqrt(c),v=(s*s-a*a+N6*c)/(2*a*IA*h),p=(s*s-a*a-N6*c)/(2*s*IA*h),g=Math.log(Math.sqrt(v*v+1)-v),m=Math.log(Math.sqrt(p*p+1)-p);f=(m-g)/I0,d=function(y){var b=y*f,S=F6(g),x=a/(IA*h)*(S*Gve(I0*b+g)-Hve(g));return[r+x*u,n+x*l,a*S/F6(I0*b+g)]}}return d.duration=f*1e3,d}var gg=0,my=0,M0=0,o$=1e3,fC,gy,hC=0,Np=0,qw=0,N1=typeof performance=="object"&&performance.now?performance:Date,s$=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ww(){return Np||(s$(Wve),Np=N1.now()+qw)}function Wve(){Np=0}function pC(){this._call=this._time=this._next=null}pC.prototype=u$.prototype={constructor:pC,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?Ww():+r)+(t==null?0:+t),!this._next&&gy!==this&&(gy?gy._next=this:fC=this,gy=this),this._call=e,this._time=r,TI()},stop:function(){this._call&&(this._call=null,this._time=1/0,TI())}};function u$(e,t,r){var n=new pC;return n.restart(e,t,r),n}function $ve(){Ww(),++gg;for(var e=fC,t;e;)(t=Np-e._time)>=0&&e._call.call(null,t),e=e._next;--gg}function B6(){Np=(hC=N1.now())+qw,gg=my=0;try{$ve()}finally{gg=0,Yve(),Np=0}}function Xve(){var e=N1.now(),t=e-hC;t>o$&&(qw-=t,hC=e)}function Yve(){for(var e,t=fC,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:fC=r);gy=e,TI(n)}function TI(e){if(!gg){my&&(my=clearTimeout(my));var t=e-Np;t>24?(e<1/0&&(my=setTimeout(B6,e-N1.now()-qw)),M0&&(M0=clearInterval(M0))):(M0||(hC=N1.now(),M0=setInterval(Xve,o$)),gg=1,s$(B6))}}function U6(e,t,r){var n=new pC;return t=t==null?0:+t,n.restart(function(a){n.stop(),e(a+t)},t,r),n}var Kve=Vw("start","end","cancel","interrupt"),Qve=[],l$=0,j6=1,II=2,uS=3,z6=4,MI=5,lS=6;function $w(e,t,r,n,a,i){var o=e.__transition;if(!o)e.__transition={};else if(r in o)return;Zve(e,r,{name:t,index:n,group:a,on:Kve,tween:Qve,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:l$})}function HR(e,t){var r=Gu(e,t);if(r.state>l$)throw new Error("too late; already scheduled");return r}function ud(e,t){var r=Gu(e,t);if(r.state>uS)throw new Error("too late; already running");return r}function Gu(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function Zve(e,t,r){var n=e.__transition,a;n[t]=r,r.timer=u$(i,0,r.time);function i(l){r.state=j6,r.timer.restart(o,r.delay,r.time),r.delay<=l&&o(l-r.delay)}function o(l){var c,d,f,h;if(r.state!==j6)return u();for(c in n)if(h=n[c],h.name===r.name){if(h.state===uS)return U6(o);h.state===z6?(h.state=lS,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete n[c]):+c<t&&(h.state=lS,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete n[c])}if(U6(function(){r.state===uS&&(r.state=z6,r.timer.restart(s,r.delay,r.time),s(l))}),r.state=II,r.on.call("start",e,e.__data__,r.index,r.group),r.state===II){for(r.state=uS,a=new Array(f=r.tween.length),c=0,d=-1;c<f;++c)(h=r.tween[c].value.call(e,e.__data__,r.index,r.group))&&(a[++d]=h);a.length=d+1}}function s(l){for(var c=l<r.duration?r.ease.call(null,l/r.duration):(r.timer.restart(u),r.state=MI,1),d=-1,f=a.length;++d<f;)a[d].call(e,c);r.state===MI&&(r.on.call("end",e,e.__data__,r.index,r.group),u())}function u(){r.state=lS,r.timer.stop(),delete n[t];for(var l in n)return;delete e.__transition}}function qm(e,t){var r=e.__transition,n,a,i=!0,o;if(r){t=t==null?null:t+"";for(o in r){if((n=r[o]).name!==t){i=!1;continue}a=n.state>II&&n.state<MI,n.state=lS,n.timer.stop(),n.on.call(a?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[o]}i&&delete e.__transition}}function Jve(e){return this.each(function(){qm(this,e)})}function eme(e,t){var r,n;return function(){var a=ud(this,e),i=a.tween;if(i!==r){n=r=i;for(var o=0,s=n.length;o<s;++o)if(n[o].name===t){n=n.slice(),n.splice(o,1);break}}a.tween=n}}function tme(e,t,r){var n,a;if(typeof r!="function")throw new Error;return function(){var i=ud(this,e),o=i.tween;if(o!==n){a=(n=o).slice();for(var s={name:t,value:r},u=0,l=a.length;u<l;++u)if(a[u].name===t){a[u]=s;break}u===l&&a.push(s)}i.tween=a}}function rme(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=Gu(this.node(),r).tween,a=0,i=n.length,o;a<i;++a)if((o=n[a]).name===e)return o.value;return null}return this.each((t==null?eme:tme)(r,e,t))}function GR(e,t,r){var n=e._id;return e.each(function(){var a=ud(this,n);(a.value||(a.value={}))[t]=r.apply(this,arguments)}),function(a){return Gu(a,n).value[t]}}function c$(e,t){var r;return(typeof t=="number"?vu:t instanceof Lp?dC:(r=Lp(t))?(t=r,dC):n$)(e,t)}function nme(e){return function(){this.removeAttribute(e)}}function ame(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ime(e,t,r){var n,a=r+"",i;return function(){var o=this.getAttribute(e);return o===a?null:o===n?i:i=t(n=o,r)}}function ome(e,t,r){var n,a=r+"",i;return function(){var o=this.getAttributeNS(e.space,e.local);return o===a?null:o===n?i:i=t(n=o,r)}}function sme(e,t,r){var n,a,i;return function(){var o,s=r(this),u;return s==null?void this.removeAttribute(e):(o=this.getAttribute(e),u=s+"",o===u?null:o===n&&u===a?i:(a=u,i=t(n=o,s)))}}function ume(e,t,r){var n,a,i;return function(){var o,s=r(this),u;return s==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),u=s+"",o===u?null:o===n&&u===a?i:(a=u,i=t(n=o,s)))}}function lme(e,t){var r=Hw(e),n=r==="transform"?zve:c$;return this.attrTween(e,typeof t=="function"?(r.local?ume:sme)(r,n,GR(this,"attr."+e,t)):t==null?(r.local?ame:nme)(r):(r.local?ome:ime)(r,n,t))}function cme(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function dme(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function fme(e,t){var r,n;function a(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&dme(e,i)),r}return a._value=t,a}function hme(e,t){var r,n;function a(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&cme(e,i)),r}return a._value=t,a}function pme(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=Hw(e);return this.tween(r,(n.local?fme:hme)(n,t))}function vme(e,t){return function(){HR(this,e).delay=+t.apply(this,arguments)}}function mme(e,t){return t=+t,function(){HR(this,e).delay=t}}function gme(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?vme:mme)(t,e)):Gu(this.node(),t).delay}function yme(e,t){return function(){ud(this,e).duration=+t.apply(this,arguments)}}function bme(e,t){return t=+t,function(){ud(this,e).duration=t}}function xme(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?yme:bme)(t,e)):Gu(this.node(),t).duration}function Sme(e,t){if(typeof t!="function")throw new Error;return function(){ud(this,e).ease=t}}function Cme(e){var t=this._id;return arguments.length?this.each(Sme(t,e)):Gu(this.node(),t).ease}function _me(e){typeof e!="function"&&(e=BW(e));for(var t=this._groups,r=t.length,n=new Array(r),a=0;a<r;++a)for(var i=t[a],o=i.length,s=n[a]=[],u,l=0;l<o;++l)(u=i[l])&&e.call(u,u.__data__,l,i)&&s.push(u);return new jc(n,this._parents,this._name,this._id)}function wme(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,a=r.length,i=Math.min(n,a),o=new Array(n),s=0;s<i;++s)for(var u=t[s],l=r[s],c=u.length,d=o[s]=new Array(c),f,h=0;h<c;++h)(f=u[h]||l[h])&&(d[h]=f);for(;s<n;++s)o[s]=t[s];return new jc(o,this._parents,this._name,this._id)}function Eme(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function Ame(e,t,r){var n,a,i=Eme(t)?HR:ud;return function(){var o=i(this,e),s=o.on;s!==n&&(a=(n=s).copy()).on(t,r),o.on=a}}function Pme(e,t){var r=this._id;return arguments.length<2?Gu(this.node(),r).on.on(e):this.each(Ame(r,e,t))}function Tme(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function Ime(){return this.on("end.remove",Tme(this._id))}function Mme(e){var t=this._name,r=this._id;typeof e!="function"&&(e=UR(e));for(var n=this._groups,a=n.length,i=new Array(a),o=0;o<a;++o)for(var s=n[o],u=s.length,l=i[o]=new Array(u),c,d,f=0;f<u;++f)(c=s[f])&&(d=e.call(c,c.__data__,f,s))&&("__data__"in c&&(d.__data__=c.__data__),l[f]=d,$w(l[f],t,r,f,l,Gu(c,r)));return new jc(i,this._parents,t,r)}function Dme(e){var t=this._name,r=this._id;typeof e!="function"&&(e=FW(e));for(var n=this._groups,a=n.length,i=[],o=[],s=0;s<a;++s)for(var u=n[s],l=u.length,c,d=0;d<l;++d)if(c=u[d]){for(var f=e.call(c,c.__data__,d,u),h,v=Gu(c,r),p=0,g=f.length;p<g;++p)(h=f[p])&&$w(h,t,r,p,f,v);i.push(f),o.push(c)}return new jc(i,o,t,r)}var Rme=_b.prototype.constructor;function kme(){return new Rme(this._groups,this._parents)}function Ome(e,t){var r,n,a;return function(){var i=mg(this,e),o=(this.style.removeProperty(e),mg(this,e));return i===o?null:i===r&&o===n?a:a=t(r=i,n=o)}}function d$(e){return function(){this.style.removeProperty(e)}}function Lme(e,t,r){var n,a=r+"",i;return function(){var o=mg(this,e);return o===a?null:o===n?i:i=t(n=o,r)}}function Nme(e,t,r){var n,a,i;return function(){var o=mg(this,e),s=r(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(e),mg(this,e))),o===u?null:o===n&&u===a?i:(a=u,i=t(n=o,s))}}function Fme(e,t){var r,n,a,i="style."+t,o="end."+i,s;return function(){var u=ud(this,e),l=u.on,c=u.value[i]==null?s||(s=d$(t)):void 0;(l!==r||a!==c)&&(n=(r=l).copy()).on(o,a=c),u.on=n}}function Bme(e,t,r){var n=(e+="")=="transform"?jve:c$;return t==null?this.styleTween(e,Ome(e,n)).on("end.style."+e,d$(e)):typeof t=="function"?this.styleTween(e,Nme(e,n,GR(this,"style."+e,t))).each(Fme(this._id,e)):this.styleTween(e,Lme(e,n,t),r).on("end.style."+e,null)}function Ume(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function jme(e,t,r){var n,a;function i(){var o=t.apply(this,arguments);return o!==a&&(n=(a=o)&&Ume(e,o,r)),n}return i._value=t,i}function zme(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,jme(e,t,r??""))}function Vme(e){return function(){this.textContent=e}}function Hme(e){return function(){var t=e(this);this.textContent=t??""}}function Gme(e){return this.tween("text",typeof e=="function"?Hme(GR(this,"text",e)):Vme(e==null?"":e+""))}function qme(e){return function(t){this.textContent=e.call(this,t)}}function Wme(e){var t,r;function n(){var a=e.apply(this,arguments);return a!==r&&(t=(r=a)&&qme(a)),t}return n._value=e,n}function $me(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Wme(e))}function Xme(){for(var e=this._name,t=this._id,r=f$(),n=this._groups,a=n.length,i=0;i<a;++i)for(var o=n[i],s=o.length,u,l=0;l<s;++l)if(u=o[l]){var c=Gu(u,t);$w(u,e,r,l,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new jc(n,this._parents,e,r)}function Yme(){var e,t,r=this,n=r._id,a=r.size();return new Promise(function(i,o){var s={value:o},u={value:function(){--a===0&&i()}};r.each(function(){var l=ud(this,n),c=l.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),l.on=t})})}var Kme=0;function jc(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function f$(){return++Kme}var Bv=_b.prototype;jc.prototype={constructor:jc,select:Mme,selectAll:Dme,filter:_me,merge:wme,selection:kme,transition:Xme,call:Bv.call,nodes:Bv.nodes,node:Bv.node,size:Bv.size,empty:Bv.empty,each:Bv.each,on:Pme,attr:lme,attrTween:pme,style:Bme,styleTween:zme,text:Gme,textTween:$me,remove:Ime,tween:rme,delay:gme,duration:xme,ease:Cme,end:Yme};function Qme(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var DI={time:null,delay:0,duration:250,ease:Qme};function Zme(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))return DI.time=Ww(),DI;return r}function Jme(e){var t,r;e instanceof jc?(t=e._id,e=e._name):(t=f$(),(r=DI).time=Ww(),e=e==null?null:e+"");for(var n=this._groups,a=n.length,i=0;i<a;++i)for(var o=n[i],s=o.length,u,l=0;l<s;++l)(u=o[l])&&$w(u,e,t,l,o,r||Zme(u,t));return new jc(n,this._parents,e,t)}_b.prototype.interrupt=Jve;_b.prototype.transition=Jme;function MA(e){return function(){return e}}function ege(e,t,r){this.target=e,this.type=t,this.selection=r}function V6(){$t.stopImmediatePropagation()}function DA(){$t.preventDefault(),$t.stopImmediatePropagation()}var H6={name:"drag"},RA={name:"space"},Uv={name:"handle"},jv={name:"center"};function G6(e){return[+e[0],+e[1]]}function q6(e){return[G6(e[0]),G6(e[1])]}function tge(e){return function(t){return _I(t,$t.touches,e)}}var cS={name:"x",handles:["w","e"].map(vC),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},kA={name:"y",handles:["n","s"].map(vC),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},Gl={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},W6={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},$6={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},rge={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},nge={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function vC(e){return{type:e}}function age(){return!$t.ctrlKey&&!$t.button}function ige(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function oge(){return navigator.maxTouchPoints||"ontouchstart"in this}function OA(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function sge(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function uge(){return lge(cS)}function lge(e){var t=ige,r=age,n=oge,a=!0,i=Vw("start","brush","end"),o=6,s;function u(g){var m=g.property("__brush",p).selectAll(".overlay").data([vC("overlay")]);m.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Gl.overlay).merge(m).each(function(){var b=OA(this).extent;Ga(this).attr("x",b[0][0]).attr("y",b[0][1]).attr("width",b[1][0]-b[0][0]).attr("height",b[1][1]-b[0][1])}),g.selectAll(".selection").data([vC("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Gl.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var y=g.selectAll(".handle").data(e.handles,function(b){return b.type});y.exit().remove(),y.enter().append("rect").attr("class",function(b){return"handle handle--"+b.type}).attr("cursor",function(b){return Gl[b.type]}),g.each(l).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(n).on("touchstart.brush",f).on("touchmove.brush",h).on("touchend.brush touchcancel.brush",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.move=function(g,m){g.selection?g.on("start.brush",function(){c(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){c(this,arguments).end()}).tween("brush",function(){var y=this,b=y.__brush,S=c(y,arguments),x=b.selection,C=e.input(typeof m=="function"?m.apply(this,arguments):m,b.extent),w=Gw(x,C);function A(I){b.selection=I===1&&C===null?null:w(I),l.call(y),S.brush()}return x!==null&&C!==null?A:A(1)}):g.each(function(){var y=this,b=arguments,S=y.__brush,x=e.input(typeof m=="function"?m.apply(y,b):m,S.extent),C=c(y,b).beforestart();qm(y),S.selection=x===null?null:x,l.call(y),C.start().brush().end()})},u.clear=function(g){u.move(g,null)};function l(){var g=Ga(this),m=OA(this).selection;m?(g.selectAll(".selection").style("display",null).attr("x",m[0][0]).attr("y",m[0][1]).attr("width",m[1][0]-m[0][0]).attr("height",m[1][1]-m[0][1]),g.selectAll(".handle").style("display",null).attr("x",function(y){return y.type[y.type.length-1]==="e"?m[1][0]-o/2:m[0][0]-o/2}).attr("y",function(y){return y.type[0]==="s"?m[1][1]-o/2:m[0][1]-o/2}).attr("width",function(y){return y.type==="n"||y.type==="s"?m[1][0]-m[0][0]+o:o}).attr("height",function(y){return y.type==="e"||y.type==="w"?m[1][1]-m[0][1]+o:o})):g.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(g,m,y){var b=g.__brush.emitter;return b&&(!y||!b.clean)?b:new d(g,m,y)}function d(g,m,y){this.that=g,this.args=m,this.state=g.__brush,this.active=0,this.clean=y}d.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return--this.active===0&&(delete this.state.emitter,this.emit("end")),this},emit:function(g){$W(new ege(u,g,e.output(this.state.selection)),i.apply,i,[g,this.that,this.args])}};function f(){if(s&&!$t.touches||!r.apply(this,arguments))return;var g=this,m=$t.target.__data__.type,y=(a&&$t.metaKey?m="overlay":m)==="selection"?H6:a&&$t.altKey?jv:Uv,b=e===kA?null:rge[m],S=e===cS?null:nge[m],x=OA(g),C=x.extent,w=x.selection,A=C[0][0],I,D,k=C[0][1],R,L,H=C[1][0],B,j,Q=C[1][1],G,W,q=0,J=0,he,$=b&&S&&a&&$t.shiftKey,X,U,z=$t.touches?tge($t.changedTouches[0].identifier):vy,ee=z(g),Y=ee,Z=c(g,arguments,!0).beforestart();m==="overlay"?(w&&(he=!0),x.selection=w=[[I=e===kA?A:ee[0],R=e===cS?k:ee[1]],[B=e===kA?H:I,G=e===cS?Q:R]]):(I=w[0][0],R=w[0][1],B=w[1][0],G=w[1][1]),D=I,L=R,j=B,W=G;var te=Ga(g).attr("pointer-events","none"),ce=te.selectAll(".overlay").attr("cursor",Gl[m]);if($t.touches)Z.moved=xe,Z.ended=_e;else{var be=Ga($t.view).on("mousemove.brush",xe,!0).on("mouseup.brush",_e,!0);a&&be.on("keydown.brush",ae,!0).on("keyup.brush",ie,!0),ZW($t.view)}V6(),qm(g),l.call(g),Z.start();function xe(){var O=z(g);$&&!X&&!U&&(Math.abs(O[0]-Y[0])>Math.abs(O[1]-Y[1])?U=!0:X=!0),Y=O,he=!0,DA(),Ie()}function Ie(){var O;switch(q=Y[0]-ee[0],J=Y[1]-ee[1],y){case RA:case H6:{b&&(q=Math.max(A-I,Math.min(H-B,q)),D=I+q,j=B+q),S&&(J=Math.max(k-R,Math.min(Q-G,J)),L=R+J,W=G+J);break}case Uv:{b<0?(q=Math.max(A-I,Math.min(H-I,q)),D=I+q,j=B):b>0&&(q=Math.max(A-B,Math.min(H-B,q)),D=I,j=B+q),S<0?(J=Math.max(k-R,Math.min(Q-R,J)),L=R+J,W=G):S>0&&(J=Math.max(k-G,Math.min(Q-G,J)),L=R,W=G+J);break}case jv:{b&&(D=Math.max(A,Math.min(H,I-q*b)),j=Math.max(A,Math.min(H,B+q*b))),S&&(L=Math.max(k,Math.min(Q,R-J*S)),W=Math.max(k,Math.min(Q,G+J*S)));break}}j<D&&(b*=-1,O=I,I=B,B=O,O=D,D=j,j=O,m in W6&&ce.attr("cursor",Gl[m=W6[m]])),W<L&&(S*=-1,O=R,R=G,G=O,O=L,L=W,W=O,m in $6&&ce.attr("cursor",Gl[m=$6[m]])),x.selection&&(w=x.selection),X&&(D=w[0][0],j=w[1][0]),U&&(L=w[0][1],W=w[1][1]),(w[0][0]!==D||w[0][1]!==L||w[1][0]!==j||w[1][1]!==W)&&(x.selection=[[D,L],[j,W]],l.call(g),Z.brush())}function _e(){if(V6(),$t.touches){if($t.touches.length)return;s&&clearTimeout(s),s=setTimeout(function(){s=null},500)}else JW($t.view,he),be.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);te.attr("pointer-events","all"),ce.attr("cursor",Gl.overlay),x.selection&&(w=x.selection),sge(w)&&(x.selection=null,l.call(g)),Z.end()}function ae(){switch($t.keyCode){case 16:{$=b&&S;break}case 18:{y===Uv&&(b&&(B=j-q*b,I=D+q*b),S&&(G=W-J*S,R=L+J*S),y=jv,Ie());break}case 32:{(y===Uv||y===jv)&&(b<0?B=j-q:b>0&&(I=D-q),S<0?G=W-J:S>0&&(R=L-J),y=RA,ce.attr("cursor",Gl.selection),Ie());break}default:return}DA()}function ie(){switch($t.keyCode){case 16:{$&&(X=U=$=!1,Ie());break}case 18:{y===jv&&(b<0?B=j:b>0&&(I=D),S<0?G=W:S>0&&(R=L),y=Uv,Ie());break}case 32:{y===RA&&($t.altKey?(b&&(B=j-q*b,I=D+q*b),S&&(G=W-J*S,R=L+J*S),y=jv):(b<0?B=j:b>0&&(I=D),S<0?G=W:S>0&&(R=L),y=Uv),ce.attr("cursor",Gl[m]),Ie());break}default:return}DA()}}function h(){c(this,arguments).moved()}function v(){c(this,arguments).ended()}function p(){var g=this.__brush||{selection:null};return g.extent=q6(t.apply(this,arguments)),g.dim=e,g}return u.extent=function(g){return arguments.length?(t=typeof g=="function"?g:MA(q6(g)),u):t},u.filter=function(g){return arguments.length?(r=typeof g=="function"?g:MA(!!g),u):r},u.touchable=function(g){return arguments.length?(n=typeof g=="function"?g:MA(!!g),u):n},u.handleSize=function(g){return arguments.length?(o=+g,u):o},u.keyModifiers=function(g){return arguments.length?(a=!!g,u):a},u.on=function(){var g=i.on.apply(i,arguments);return g===i?u:g},u}var RI=Math.PI,kI=2*RI,Wh=1e-6,cge=kI-Wh;function OI(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function h$(){return new OI}OI.prototype=h$.prototype={constructor:OI,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,r,n){this._+="Q"+ +e+","+ +t+","+(this._x1=+r)+","+(this._y1=+n)},bezierCurveTo:function(e,t,r,n,a,i){this._+="C"+ +e+","+ +t+","+ +r+","+ +n+","+(this._x1=+a)+","+(this._y1=+i)},arcTo:function(e,t,r,n,a){e=+e,t=+t,r=+r,n=+n,a=+a;var i=this._x1,o=this._y1,s=r-e,u=n-t,l=i-e,c=o-t,d=l*l+c*c;if(a<0)throw new Error("negative radius: "+a);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(d>Wh)if(!(Math.abs(c*s-u*l)>Wh)||!a)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var f=r-i,h=n-o,v=s*s+u*u,p=f*f+h*h,g=Math.sqrt(v),m=Math.sqrt(d),y=a*Math.tan((RI-Math.acos((v+d-p)/(2*g*m)))/2),b=y/m,S=y/g;Math.abs(b-1)>Wh&&(this._+="L"+(e+b*l)+","+(t+b*c)),this._+="A"+a+","+a+",0,0,"+ +(c*f>l*h)+","+(this._x1=e+S*s)+","+(this._y1=t+S*u)}},arc:function(e,t,r,n,a,i){e=+e,t=+t,r=+r,i=!!i;var o=r*Math.cos(n),s=r*Math.sin(n),u=e+o,l=t+s,c=1^i,d=i?n-a:a-n;if(r<0)throw new Error("negative radius: "+r);this._x1===null?this._+="M"+u+","+l:(Math.abs(this._x1-u)>Wh||Math.abs(this._y1-l)>Wh)&&(this._+="L"+u+","+l),r&&(d<0&&(d=d%kI+kI),d>cge?this._+="A"+r+","+r+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+r+","+r+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):d>Wh&&(this._+="A"+r+","+r+",0,"+ +(d>=RI)+","+c+","+(this._x1=e+r*Math.cos(a))+","+(this._y1=t+r*Math.sin(a))))},rect:function(e,t,r,n){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +r+"v"+ +n+"h"+-r+"Z"},toString:function(){return this._}};var _s="$";function mC(){}mC.prototype=gC.prototype={constructor:mC,has:function(e){return _s+e in this},get:function(e){return this[_s+e]},set:function(e,t){return this[_s+e]=t,this},remove:function(e){var t=_s+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===_s&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===_s&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===_s&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===_s&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===_s&&++e;return e},empty:function(){for(var e in this)if(e[0]===_s)return!1;return!0},each:function(e){for(var t in this)t[0]===_s&&e(this[t],t.slice(1),this)}};function gC(e,t){var r=new mC;if(e instanceof mC)e.each(function(s,u){r.set(u,s)});else if(Array.isArray(e)){var n=-1,a=e.length,i;if(t==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(t(i=e[n],n,e),i)}else if(e)for(var o in e)r.set(o,e[o]);return r}function X6(){}var Sh=gC.prototype;X6.prototype={constructor:X6,has:Sh.has,add:function(e){return e+="",this[_s+e]=e,this},remove:Sh.remove,clear:Sh.clear,values:Sh.keys,size:Sh.size,empty:Sh.empty,each:Sh.each};function dge(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function yC(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function yg(e){return e=yC(Math.abs(e)),e?e[1]:NaN}function fge(e,t){return function(r,n){for(var a=r.length,i=[],o=0,s=e[0],u=0;a>0&&s>0&&(u+s+1>n&&(s=Math.max(1,n-u)),i.push(r.substring(a-=s,a+s)),!((u+=s+1)>n));)s=e[o=(o+1)%e.length];return i.reverse().join(t)}}function hge(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var pge=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function bC(e){if(!(t=pge.exec(e)))throw new Error("invalid format: "+e);var t;return new qR({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}bC.prototype=qR.prototype;function qR(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}qR.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function vge(e){e:for(var t=e.length,r=1,n=-1,a;r<t;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var p$;function mge(e,t){var r=yC(e,t);if(!r)return e+"";var n=r[0],a=r[1],i=a-(p$=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,o=n.length;return i===o?n:i>o?n+new Array(i-o+1).join("0"):i>0?n.slice(0,i)+"."+n.slice(i):"0."+new Array(1-i).join("0")+yC(e,Math.max(0,t+i-1))[0]}function Y6(e,t){var r=yC(e,t);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}const K6={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:dge,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Y6(e*100,t)},r:Y6,s:mge,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Q6(e){return e}var Z6=Array.prototype.map,J6=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function gge(e){var t=e.grouping===void 0||e.thousands===void 0?Q6:fge(Z6.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",i=e.numerals===void 0?Q6:hge(Z6.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(d){d=bC(d);var f=d.fill,h=d.align,v=d.sign,p=d.symbol,g=d.zero,m=d.width,y=d.comma,b=d.precision,S=d.trim,x=d.type;x==="n"?(y=!0,x="g"):K6[x]||(b===void 0&&(b=12),S=!0,x="g"),(g||f==="0"&&h==="=")&&(g=!0,f="0",h="=");var C=p==="$"?r:p==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",w=p==="$"?n:/[%p]/.test(x)?o:"",A=K6[x],I=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function D(k){var R=C,L=w,H,B,j;if(x==="c")L=A(k)+L,k="";else{k=+k;var Q=k<0||1/k<0;if(k=isNaN(k)?u:A(Math.abs(k),b),S&&(k=vge(k)),Q&&+k==0&&v!=="+"&&(Q=!1),R=(Q?v==="("?v:s:v==="-"||v==="("?"":v)+R,L=(x==="s"?J6[8+p$/3]:"")+L+(Q&&v==="("?")":""),I){for(H=-1,B=k.length;++H<B;)if(j=k.charCodeAt(H),48>j||j>57){L=(j===46?a+k.slice(H+1):k.slice(H))+L,k=k.slice(0,H);break}}}y&&!g&&(k=t(k,1/0));var G=R.length+k.length+L.length,W=G<m?new Array(m-G+1).join(f):"";switch(y&&g&&(k=t(W+k,W.length?m-L.length:1/0),W=""),h){case"<":k=R+k+L+W;break;case"=":k=R+W+k+L;break;case"^":k=W.slice(0,G=W.length>>1)+R+k+L+W.slice(G);break;default:k=W+R+k+L;break}return i(k)}return D.toString=function(){return d+""},D}function c(d,f){var h=l((d=bC(d),d.type="f",d)),v=Math.max(-8,Math.min(8,Math.floor(yg(f)/3)))*3,p=Math.pow(10,-v),g=J6[8+v/3];return function(m){return h(p*m)+g}}return{format:l,formatPrefix:c}}var P2,xC,v$;yge({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function yge(e){return P2=gge(e),xC=P2.format,v$=P2.formatPrefix,P2}function bge(e){return Math.max(0,-yg(Math.abs(e)))}function xge(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(yg(t)/3)))*3-yg(Math.abs(e)))}function Sge(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,yg(t)-yg(e))+1}function Gg(){return Math.random()}(function e(t){function r(n,a){return n=n==null?0:+n,a=a==null?1:+a,arguments.length===1?(a=n,n=0):a-=n,function(){return t()*a+n}}return r.source=e,r})(Gg);const Cge=function e(t){function r(n,a){var i,o;return n=n==null?0:+n,a=a==null?1:+a,function(){var s;if(i!=null)s=i,i=null;else do i=t()*2-1,s=t()*2-1,o=i*i+s*s;while(!o||o>1);return n+a*s*Math.sqrt(-2*Math.log(o)/o)}}return r.source=e,r}(Gg);(function e(t){function r(){var n=Cge.source(t).apply(this,arguments);return function(){return Math.exp(n())}}return r.source=e,r})(Gg);const _ge=function e(t){function r(n){return function(){for(var a=0,i=0;i<n;++i)a+=t();return a}}return r.source=e,r}(Gg);(function e(t){function r(n){var a=_ge.source(t)(n);return function(){return a()/n}}return r.source=e,r})(Gg);(function e(t){function r(n){return function(){return-Math.log(1-t())/n}}return r.source=e,r})(Gg);function Xw(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}var m$=Array.prototype,wge=m$.map,LI=m$.slice,eB={name:"implicit"};function g$(){var e=gC(),t=[],r=[],n=eB;function a(i){var o=i+"",s=e.get(o);if(!s){if(n!==eB)return n;e.set(o,s=t.push(i))}return r[(s-1)%r.length]}return a.domain=function(i){if(!arguments.length)return t.slice();t=[],e=gC();for(var o=-1,s=i.length,u,l;++o<s;)e.has(l=(u=i[o])+"")||e.set(l,t.push(u));return a},a.range=function(i){return arguments.length?(r=LI.call(i),a):r.slice()},a.unknown=function(i){return arguments.length?(n=i,a):n},a.copy=function(){return g$(t,r).unknown(n)},Xw.apply(a,arguments),a}function y$(){var e=g$().unknown(void 0),t=e.domain,r=e.range,n=[0,1],a,i,o=!1,s=0,u=0,l=.5;delete e.unknown;function c(){var d=t().length,f=n[1]<n[0],h=n[f-0],v=n[1-f];a=(v-h)/Math.max(1,d-s+u*2),o&&(a=Math.floor(a)),h+=(v-h-a*(d-s))*l,i=a*(1-s),o&&(h=Math.round(h),i=Math.round(i));var p=Bhe(d).map(function(g){return h+a*g});return r(f?p.reverse():p)}return e.domain=function(d){return arguments.length?(t(d),c()):t()},e.range=function(d){return arguments.length?(n=[+d[0],+d[1]],c()):n.slice()},e.rangeRound=function(d){return n=[+d[0],+d[1]],o=!0,c()},e.bandwidth=function(){return i},e.step=function(){return a},e.round=function(d){return arguments.length?(o=!!d,c()):o},e.padding=function(d){return arguments.length?(s=Math.min(1,u=+d),c()):s},e.paddingInner=function(d){return arguments.length?(s=Math.min(1,d),c()):s},e.paddingOuter=function(d){return arguments.length?(u=+d,c()):u},e.align=function(d){return arguments.length?(l=Math.max(0,Math.min(1,d)),c()):l},e.copy=function(){return y$(t(),n).round(o).paddingInner(s).paddingOuter(u).align(l)},Xw.apply(c(),arguments)}function b$(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return b$(t())},e}function Ege(){return b$(y$.apply(null,arguments).paddingInner(1))}function Age(e){return function(){return e}}function Pge(e){return+e}var tB=[0,1];function yl(e){return e}function NI(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:Age(isNaN(t)?NaN:.5)}function rB(e){var t=e[0],r=e[e.length-1],n;return t>r&&(n=t,t=r,r=n),function(a){return Math.max(t,Math.min(r,a))}}function Tge(e,t,r){var n=e[0],a=e[1],i=t[0],o=t[1];return a<n?(n=NI(a,n),i=r(o,i)):(n=NI(n,a),i=r(i,o)),function(s){return i(n(s))}}function Ige(e,t,r){var n=Math.min(e.length,t.length)-1,a=new Array(n),i=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<n;)a[o]=NI(e[o],e[o+1]),i[o]=r(t[o],t[o+1]);return function(s){var u=Fhe(e,s,1,n)-1;return i[u](a[u](s))}}function x$(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function S$(){var e=tB,t=tB,r=Gw,n,a,i,o=yl,s,u,l;function c(){return s=Math.min(e.length,t.length)>2?Ige:Tge,u=l=null,d}function d(f){return isNaN(f=+f)?i:(u||(u=s(e.map(n),t,r)))(n(o(f)))}return d.invert=function(f){return o(a((l||(l=s(t,e.map(n),vu)))(f)))},d.domain=function(f){return arguments.length?(e=wge.call(f,Pge),o===yl||(o=rB(e)),c()):e.slice()},d.range=function(f){return arguments.length?(t=LI.call(f),c()):t.slice()},d.rangeRound=function(f){return t=LI.call(f),r=Fve,c()},d.clamp=function(f){return arguments.length?(o=f?rB(e):yl,d):o!==yl},d.interpolate=function(f){return arguments.length?(r=f,c()):r},d.unknown=function(f){return arguments.length?(i=f,d):i},function(f,h){return n=f,a=h,c()}}function Mge(e,t){return S$()(e,t)}function Dge(e,t,r,n){var a=jhe(e,t,r),i;switch(n=bC(n??",f"),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(i=xge(a,o))&&(n.precision=i),v$(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(i=Sge(a,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=i-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(i=bge(a))&&(n.precision=i-(n.type==="%")*2);break}}return xC(n)}function C$(e){var t=e.domain;return e.ticks=function(r){var n=t();return Uhe(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var a=t();return Dge(a[0],a[a.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),a=0,i=n.length-1,o=n[a],s=n[i],u;return s<o&&(u=o,o=s,s=u,u=a,a=i,i=u),u=iS(o,s,r),u>0?(o=Math.floor(o/u)*u,s=Math.ceil(s/u)*u,u=iS(o,s,r)):u<0&&(o=Math.ceil(o*u)/u,s=Math.floor(s*u)/u,u=iS(o,s,r)),u>0?(n[a]=Math.floor(o/u)*u,n[i]=Math.ceil(s/u)*u,t(n)):u<0&&(n[a]=Math.ceil(o*u)/u,n[i]=Math.floor(s*u)/u,t(n)),e},e}function Eb(){var e=Mge(yl,yl);return e.copy=function(){return x$(e,Eb())},Xw.apply(e,arguments),C$(e)}function nB(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Rge(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function kge(e){return e<0?-e*e:e*e}function Oge(e){var t=e(yl,yl),r=1;function n(){return r===1?e(yl,yl):r===.5?e(Rge,kge):e(nB(r),nB(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,n()):r},C$(t)}function _$(){var e=Oge(S$());return e.copy=function(){return x$(e,_$()).exponent(e.exponent())},Xw.apply(e,arguments),e}function T2(e){return function(){return e}}function w$(e){this._context=e}w$.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Lge(e){return new w$(e)}function Nge(e){return e[0]}function Fge(e){return e[1]}function Bge(){var e=Nge,t=Fge,r=T2(!0),n=null,a=Lge,i=null;function o(s){var u,l=s.length,c,d=!1,f;for(n==null&&(i=a(f=h$())),u=0;u<=l;++u)!(u<l&&r(c=s[u],u,s))===d&&((d=!d)?i.lineStart():i.lineEnd()),d&&i.point(+e(c,u,s),+t(c,u,s));if(f)return i=null,f+""||null}return o.x=function(s){return arguments.length?(e=typeof s=="function"?s:T2(+s),o):e},o.y=function(s){return arguments.length?(t=typeof s=="function"?s:T2(+s),o):t},o.defined=function(s){return arguments.length?(r=typeof s=="function"?s:T2(!!s),o):r},o.curve=function(s){return arguments.length?(a=s,n!=null&&(i=a(n)),o):a},o.context=function(s){return arguments.length?(s==null?n=i=null:i=a(n=s),o):n},o}function SC(){this._=null}function Yw(e){e.U=e.C=e.L=e.R=e.P=e.N=null}SC.prototype={constructor:SC,insert:function(e,t){var r,n,a;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;r=e}else this._?(e=aB(this._),t.P=null,t.N=e,e.P=e.L=t,r=e):(t.P=t.N=null,this._=t,r=null);for(t.L=t.R=null,t.U=r,t.C=!0,e=t;r&&r.C;)n=r.U,r===n.L?(a=n.R,a&&a.C?(r.C=a.C=!1,n.C=!0,e=n):(e===r.R&&(D0(this,r),e=r,r=e.U),r.C=!1,n.C=!0,R0(this,n))):(a=n.L,a&&a.C?(r.C=a.C=!1,n.C=!0,e=n):(e===r.L&&(R0(this,r),e=r,r=e.U),r.C=!1,n.C=!0,D0(this,n))),r=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t=e.U,r,n=e.L,a=e.R,i,o;if(n?a?i=aB(a):i=n:i=a,t?t.L===e?t.L=i:t.R=i:this._=i,n&&a?(o=i.C,i.C=e.C,i.L=n,n.U=i,i!==a?(t=i.U,i.U=e.U,e=i.R,t.L=e,i.R=a,a.U=i):(i.U=t,t=i,e=i.R)):(o=e.C,e=i),e&&(e.U=t),!o){if(e&&e.C){e.C=!1;return}do{if(e===this._)break;if(e===t.L){if(r=t.R,r.C&&(r.C=!1,t.C=!0,D0(this,t),r=t.R),r.L&&r.L.C||r.R&&r.R.C){(!r.R||!r.R.C)&&(r.L.C=!1,r.C=!0,R0(this,r),r=t.R),r.C=t.C,t.C=r.R.C=!1,D0(this,t),e=this._;break}}else if(r=t.L,r.C&&(r.C=!1,t.C=!0,R0(this,t),r=t.L),r.L&&r.L.C||r.R&&r.R.C){(!r.L||!r.L.C)&&(r.R.C=!1,r.C=!0,D0(this,r),r=t.L),r.C=t.C,t.C=r.L.C=!1,R0(this,t),e=this._;break}r.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};function D0(e,t){var r=t,n=t.R,a=r.U;a?a.L===r?a.L=n:a.R=n:e._=n,n.U=a,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function R0(e,t){var r=t,n=t.L,a=r.U;a?a.L===r?a.L=n:a.R=n:e._=n,n.U=a,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function aB(e){for(;e.L;)e=e.L;return e}function yy(e,t,r,n){var a=[null,null],i=Ai.push(a)-1;return a.left=e,a.right=t,r&&CC(a,e,t,r),n&&CC(a,t,e,n),Vo[e.index].halfedges.push(i),Vo[t.index].halfedges.push(i),a}function k0(e,t,r){var n=[t,r];return n.left=e,n}function CC(e,t,r,n){!e[0]&&!e[1]?(e[0]=n,e.left=t,e.right=r):e.left===r?e[1]=n:e[0]=n}function Uge(e,t,r,n,a){var i=e[0],o=e[1],s=i[0],u=i[1],l=o[0],c=o[1],d=0,f=1,h=l-s,v=c-u,p;if(p=t-s,!(!h&&p>0)){if(p/=h,h<0){if(p<d)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>d&&(d=p)}if(p=n-s,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>d&&(d=p)}else if(h>0){if(p<d)return;p<f&&(f=p)}if(p=r-u,!(!v&&p>0)){if(p/=v,v<0){if(p<d)return;p<f&&(f=p)}else if(v>0){if(p>f)return;p>d&&(d=p)}if(p=a-u,!(!v&&p<0)){if(p/=v,v<0){if(p>f)return;p>d&&(d=p)}else if(v>0){if(p<d)return;p<f&&(f=p)}return!(d>0)&&!(f<1)||(d>0&&(e[0]=[s+d*h,u+d*v]),f<1&&(e[1]=[s+f*h,u+f*v])),!0}}}}}function jge(e,t,r,n,a){var i=e[1];if(i)return!0;var o=e[0],s=e.left,u=e.right,l=s[0],c=s[1],d=u[0],f=u[1],h=(l+d)/2,v=(c+f)/2,p,g;if(f===c){if(h<t||h>=n)return;if(l>d){if(!o)o=[h,r];else if(o[1]>=a)return;i=[h,a]}else{if(!o)o=[h,a];else if(o[1]<r)return;i=[h,r]}}else if(p=(l-d)/(f-c),g=v-p*h,p<-1||p>1)if(l>d){if(!o)o=[(r-g)/p,r];else if(o[1]>=a)return;i=[(a-g)/p,a]}else{if(!o)o=[(a-g)/p,a];else if(o[1]<r)return;i=[(r-g)/p,r]}else if(c<f){if(!o)o=[t,p*t+g];else if(o[0]>=n)return;i=[n,p*n+g]}else{if(!o)o=[n,p*n+g];else if(o[0]<t)return;i=[t,p*t+g]}return e[0]=o,e[1]=i,!0}function zge(e,t,r,n){for(var a=Ai.length,i;a--;)(!jge(i=Ai[a],e,t,r,n)||!Uge(i,e,t,r,n)||!(Math.abs(i[0][0]-i[1][0])>ea||Math.abs(i[0][1]-i[1][1])>ea))&&delete Ai[a]}function Vge(e){return Vo[e.index]={site:e,halfedges:[]}}function Hge(e,t){var r=e.site,n=t.left,a=t.right;return r===a&&(a=n,n=r),a?Math.atan2(a[1]-n[1],a[0]-n[0]):(r===n?(n=t[1],a=t[0]):(n=t[0],a=t[1]),Math.atan2(n[0]-a[0],a[1]-n[1]))}function E$(e,t){return t[+(t.left!==e.site)]}function Gge(e,t){return t[+(t.left===e.site)]}function qge(){for(var e=0,t=Vo.length,r,n,a,i;e<t;++e)if((r=Vo[e])&&(i=(n=r.halfedges).length)){var o=new Array(i),s=new Array(i);for(a=0;a<i;++a)o[a]=a,s[a]=Hge(r,Ai[n[a]]);for(o.sort(function(u,l){return s[l]-s[u]}),a=0;a<i;++a)s[a]=n[o[a]];for(a=0;a<i;++a)n[a]=s[a]}}function Wge(e,t,r,n){var a=Vo.length,i,o,s,u,l,c,d,f,h,v,p,g,m=!0;for(i=0;i<a;++i)if(o=Vo[i]){for(s=o.site,l=o.halfedges,u=l.length;u--;)Ai[l[u]]||l.splice(u,1);for(u=0,c=l.length;u<c;)v=Gge(o,Ai[l[u]]),p=v[0],g=v[1],d=E$(o,Ai[l[++u%c]]),f=d[0],h=d[1],(Math.abs(p-f)>ea||Math.abs(g-h)>ea)&&(l.splice(u,0,Ai.push(k0(s,v,Math.abs(p-e)<ea&&n-g>ea?[e,Math.abs(f-e)<ea?h:n]:Math.abs(g-n)<ea&&r-p>ea?[Math.abs(h-n)<ea?f:r,n]:Math.abs(p-r)<ea&&g-t>ea?[r,Math.abs(f-r)<ea?h:t]:Math.abs(g-t)<ea&&p-e>ea?[Math.abs(h-t)<ea?f:e,t]:null))-1),++c);c&&(m=!1)}if(m){var y,b,S,x=1/0;for(i=0,m=null;i<a;++i)(o=Vo[i])&&(s=o.site,y=s[0]-e,b=s[1]-t,S=y*y+b*b,S<x&&(x=S,m=o));if(m){var C=[e,t],w=[e,n],A=[r,n],I=[r,t];m.halfedges.push(Ai.push(k0(s=m.site,C,w))-1,Ai.push(k0(s,w,A))-1,Ai.push(k0(s,A,I))-1,Ai.push(k0(s,I,C))-1)}}for(i=0;i<a;++i)(o=Vo[i])&&(o.halfedges.length||delete Vo[i])}var A$=[],WR;function $ge(){Yw(this),this.x=this.y=this.arc=this.site=this.cy=null}function Em(e){var t=e.P,r=e.N;if(!(!t||!r)){var n=t.site,a=e.site,i=r.site;if(n!==i){var o=a[0],s=a[1],u=n[0]-o,l=n[1]-s,c=i[0]-o,d=i[1]-s,f=2*(u*d-l*c);if(!(f>=-Zge)){var h=u*u+l*l,v=c*c+d*d,p=(d*h-l*v)/f,g=(u*v-c*h)/f,m=A$.pop()||new $ge;m.arc=e,m.site=a,m.x=p+o,m.y=(m.cy=g+s)+Math.sqrt(p*p+g*g),e.circle=m;for(var y=null,b=F1._;b;)if(m.y<b.y||m.y===b.y&&m.x<=b.x)if(b.L)b=b.L;else{y=b.P;break}else if(b.R)b=b.R;else{y=b;break}F1.insert(y,m),y||(WR=m)}}}}function Wm(e){var t=e.circle;t&&(t.P||(WR=t.N),F1.remove(t),A$.push(t),Yw(t),e.circle=null)}var P$=[];function Xge(){Yw(this),this.edge=this.site=this.circle=null}function iB(e){var t=P$.pop()||new Xge;return t.site=e,t}function LA(e){Wm(e),$m.remove(e),P$.push(e),Yw(e)}function Yge(e){var t=e.circle,r=t.x,n=t.cy,a=[r,n],i=e.P,o=e.N,s=[e];LA(e);for(var u=i;u.circle&&Math.abs(r-u.circle.x)<ea&&Math.abs(n-u.circle.cy)<ea;)i=u.P,s.unshift(u),LA(u),u=i;s.unshift(u),Wm(u);for(var l=o;l.circle&&Math.abs(r-l.circle.x)<ea&&Math.abs(n-l.circle.cy)<ea;)o=l.N,s.push(l),LA(l),l=o;s.push(l),Wm(l);var c=s.length,d;for(d=1;d<c;++d)l=s[d],u=s[d-1],CC(l.edge,u.site,l.site,a);u=s[0],l=s[c-1],l.edge=yy(u.site,l.site,null,a),Em(u),Em(l)}function Kge(e){for(var t=e[0],r=e[1],n,a,i,o,s=$m._;s;)if(i=T$(s,r)-t,i>ea)s=s.L;else if(o=t-Qge(s,r),o>ea){if(!s.R){n=s;break}s=s.R}else{i>-ea?(n=s.P,a=s):o>-ea?(n=s,a=s.N):n=a=s;break}Vge(e);var u=iB(e);if($m.insert(n,u),!(!n&&!a)){if(n===a){Wm(n),a=iB(n.site),$m.insert(u,a),u.edge=a.edge=yy(n.site,u.site),Em(n),Em(a);return}if(!a){u.edge=yy(n.site,u.site);return}Wm(n),Wm(a);var l=n.site,c=l[0],d=l[1],f=e[0]-c,h=e[1]-d,v=a.site,p=v[0]-c,g=v[1]-d,m=2*(f*g-h*p),y=f*f+h*h,b=p*p+g*g,S=[(g*y-h*b)/m+c,(f*b-p*y)/m+d];CC(a.edge,l,v,S),u.edge=yy(l,e,null,S),a.edge=yy(e,v,null,S),Em(n),Em(a)}}function T$(e,t){var r=e.site,n=r[0],a=r[1],i=a-t;if(!i)return n;var o=e.P;if(!o)return-1/0;r=o.site;var s=r[0],u=r[1],l=u-t;if(!l)return s;var c=s-n,d=1/i-1/l,f=c/l;return d?(-f+Math.sqrt(f*f-2*d*(c*c/(-2*l)-u+l/2+a-i/2)))/d+n:(n+s)/2}function Qge(e,t){var r=e.N;if(r)return T$(r,t);var n=e.site;return n[1]===t?n[0]:1/0}var ea=1e-6,Zge=1e-12,$m,Vo,F1,Ai;function Jge(e,t,r){return(e[0]-r[0])*(t[1]-e[1])-(e[0]-t[0])*(r[1]-e[1])}function e0e(e,t){return t[1]-e[1]||t[0]-e[0]}function oB(e,t){var r=e.sort(e0e).pop(),n,a,i;for(Ai=[],Vo=new Array(e.length),$m=new SC,F1=new SC;;)if(i=WR,r&&(!i||r[1]<i.y||r[1]===i.y&&r[0]<i.x))(r[0]!==n||r[1]!==a)&&(Kge(r),n=r[0],a=r[1]),r=e.pop();else if(i)Yge(i.arc);else break;if(qge(),t){var o=+t[0][0],s=+t[0][1],u=+t[1][0],l=+t[1][1];zge(o,s,u,l),Wge(o,s,u,l)}this.edges=Ai,this.cells=Vo,$m=F1=Ai=Vo=null}oB.prototype={constructor:oB,polygons:function(){var e=this.edges;return this.cells.map(function(t){var r=t.halfedges.map(function(n){return E$(t,e[n])});return r.data=t.site.data,r})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(r,n){if(s=(i=r.halfedges).length)for(var a=r.site,i,o=-1,s,u,l=t[i[s-1]],c=l.left===a?l.right:l.left;++o<s;)u=c,l=t[i[o]],c=l.left===a?l.right:l.left,u&&c&&n<u.index&&n<c.index&&Jge(a,u,c)<0&&e.push([a.data,u.data,c.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,r){for(var n=this,a,i=n._found||0,o=n.cells.length,s;!(s=n.cells[i]);)if(++i>=o)return null;var u=e-s.site[0],l=t-s.site[1],c=u*u+l*l;do s=n.cells[a=i],i=null,s.halfedges.forEach(function(d){var f=n.edges[d],h=f.left;if(!((h===s.site||!h)&&!(h=f.right))){var v=e-h[0],p=t-h[1],g=v*v+p*p;g<c&&(c=g,i=h.index)}});while(i!==null);return n._found=a,r==null||c<=r*r?s.site:null}};function I2(e){return function(){return e}}function t0e(e,t,r){this.target=e,this.type=t,this.transform=r}function xc(e,t,r){this.k=e,this.x=t,this.y=r}xc.prototype={constructor:xc,scale:function(e){return e===1?this:new xc(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new xc(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var $R=new xc(1,0,0);xc.prototype;function NA(){$t.stopImmediatePropagation()}function O0(){$t.preventDefault(),$t.stopImmediatePropagation()}function r0e(){return!$t.ctrlKey&&!$t.button}function n0e(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function sB(){return this.__zoom||$R}function a0e(){return-$t.deltaY*($t.deltaMode===1?.05:$t.deltaMode?1:.002)}function i0e(){return navigator.maxTouchPoints||"ontouchstart"in this}function o0e(e,t,r){var n=e.invertX(t[0][0])-r[0][0],a=e.invertX(t[1][0])-r[1][0],i=e.invertY(t[0][1])-r[0][1],o=e.invertY(t[1][1])-r[1][1];return e.translate(a>n?(n+a)/2:Math.min(0,n)||Math.max(0,a),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function s0e(){var e=r0e,t=n0e,r=o0e,n=a0e,a=i0e,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],s=250,u=qve,l=Vw("start","zoom","end"),c,d,f=500,h=150,v=0;function p(R){R.property("__zoom",sB).on("wheel.zoom",C).on("mousedown.zoom",w).on("dblclick.zoom",A).filter(a).on("touchstart.zoom",I).on("touchmove.zoom",D).on("touchend.zoom touchcancel.zoom",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}p.transform=function(R,L,H){var B=R.selection?R.selection():R;B.property("__zoom",sB),R!==B?b(R,L,H):B.interrupt().each(function(){S(this,arguments).start().zoom(null,typeof L=="function"?L.apply(this,arguments):L).end()})},p.scaleBy=function(R,L,H){p.scaleTo(R,function(){var B=this.__zoom.k,j=typeof L=="function"?L.apply(this,arguments):L;return B*j},H)},p.scaleTo=function(R,L,H){p.transform(R,function(){var B=t.apply(this,arguments),j=this.__zoom,Q=H==null?y(B):typeof H=="function"?H.apply(this,arguments):H,G=j.invert(Q),W=typeof L=="function"?L.apply(this,arguments):L;return r(m(g(j,W),Q,G),B,o)},H)},p.translateBy=function(R,L,H){p.transform(R,function(){return r(this.__zoom.translate(typeof L=="function"?L.apply(this,arguments):L,typeof H=="function"?H.apply(this,arguments):H),t.apply(this,arguments),o)})},p.translateTo=function(R,L,H,B){p.transform(R,function(){var j=t.apply(this,arguments),Q=this.__zoom,G=B==null?y(j):typeof B=="function"?B.apply(this,arguments):B;return r($R.translate(G[0],G[1]).scale(Q.k).translate(typeof L=="function"?-L.apply(this,arguments):-L,typeof H=="function"?-H.apply(this,arguments):-H),j,o)},B)};function g(R,L){return L=Math.max(i[0],Math.min(i[1],L)),L===R.k?R:new xc(L,R.x,R.y)}function m(R,L,H){var B=L[0]-H[0]*R.k,j=L[1]-H[1]*R.k;return B===R.x&&j===R.y?R:new xc(R.k,B,j)}function y(R){return[(+R[0][0]+ +R[1][0])/2,(+R[0][1]+ +R[1][1])/2]}function b(R,L,H){R.on("start.zoom",function(){S(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).end()}).tween("zoom",function(){var B=this,j=arguments,Q=S(B,j),G=t.apply(B,j),W=H==null?y(G):typeof H=="function"?H.apply(B,j):H,q=Math.max(G[1][0]-G[0][0],G[1][1]-G[0][1]),J=B.__zoom,he=typeof L=="function"?L.apply(B,j):L,$=u(J.invert(W).concat(q/J.k),he.invert(W).concat(q/he.k));return function(X){if(X===1)X=he;else{var U=$(X),z=q/U[2];X=new xc(z,W[0]-U[0]*z,W[1]-U[1]*z)}Q.zoom(null,X)}})}function S(R,L,H){return!H&&R.__zooming||new x(R,L)}function x(R,L){this.that=R,this.args=L,this.active=0,this.extent=t.apply(R,L),this.taps=0}x.prototype={start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(R,L){return this.mouse&&R!=="mouse"&&(this.mouse[1]=L.invert(this.mouse[0])),this.touch0&&R!=="touch"&&(this.touch0[1]=L.invert(this.touch0[0])),this.touch1&&R!=="touch"&&(this.touch1[1]=L.invert(this.touch1[0])),this.that.__zoom=L,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(R){$W(new t0e(p,R,this.that.__zoom),l.apply,l,[R,this.that,this.args])}};function C(){if(!e.apply(this,arguments))return;var R=S(this,arguments),L=this.__zoom,H=Math.max(i[0],Math.min(i[1],L.k*Math.pow(2,n.apply(this,arguments)))),B=vy(this);if(R.wheel)(R.mouse[0][0]!==B[0]||R.mouse[0][1]!==B[1])&&(R.mouse[1]=L.invert(R.mouse[0]=B)),clearTimeout(R.wheel);else{if(L.k===H)return;R.mouse=[B,L.invert(B)],qm(this),R.start()}O0(),R.wheel=setTimeout(j,h),R.zoom("mouse",r(m(g(L,H),R.mouse[0],R.mouse[1]),R.extent,o));function j(){R.wheel=null,R.end()}}function w(){if(d||!e.apply(this,arguments))return;var R=S(this,arguments,!0),L=Ga($t.view).on("mousemove.zoom",Q,!0).on("mouseup.zoom",G,!0),H=vy(this),B=$t.clientX,j=$t.clientY;ZW($t.view),NA(),R.mouse=[H,this.__zoom.invert(H)],qm(this),R.start();function Q(){if(O0(),!R.moved){var W=$t.clientX-B,q=$t.clientY-j;R.moved=W*W+q*q>v}R.zoom("mouse",r(m(R.that.__zoom,R.mouse[0]=vy(R.that),R.mouse[1]),R.extent,o))}function G(){L.on("mousemove.zoom mouseup.zoom",null),JW($t.view,R.moved),O0(),R.end()}}function A(){if(e.apply(this,arguments)){var R=this.__zoom,L=vy(this),H=R.invert(L),B=R.k*($t.shiftKey?.5:2),j=r(m(g(R,B),L,H),t.apply(this,arguments),o);O0(),s>0?Ga(this).transition().duration(s).call(b,j,L):Ga(this).call(p.transform,j)}}function I(){if(e.apply(this,arguments)){var R=$t.touches,L=R.length,H=S(this,arguments,$t.changedTouches.length===L),B,j,Q,G;for(NA(),j=0;j<L;++j)Q=R[j],G=_I(this,R,Q.identifier),G=[G,this.__zoom.invert(G),Q.identifier],H.touch0?!H.touch1&&H.touch0[2]!==G[2]&&(H.touch1=G,H.taps=0):(H.touch0=G,B=!0,H.taps=1+!!c);c&&(c=clearTimeout(c)),B&&(H.taps<2&&(c=setTimeout(function(){c=null},f)),qm(this),H.start())}}function D(){if(this.__zooming){var R=S(this,arguments),L=$t.changedTouches,H=L.length,B,j,Q,G;for(O0(),c&&(c=clearTimeout(c)),R.taps=0,B=0;B<H;++B)j=L[B],Q=_I(this,L,j.identifier),R.touch0&&R.touch0[2]===j.identifier?R.touch0[0]=Q:R.touch1&&R.touch1[2]===j.identifier&&(R.touch1[0]=Q);if(j=R.that.__zoom,R.touch1){var W=R.touch0[0],q=R.touch0[1],J=R.touch1[0],he=R.touch1[1],$=($=J[0]-W[0])*$+($=J[1]-W[1])*$,X=(X=he[0]-q[0])*X+(X=he[1]-q[1])*X;j=g(j,Math.sqrt($/X)),Q=[(W[0]+J[0])/2,(W[1]+J[1])/2],G=[(q[0]+he[0])/2,(q[1]+he[1])/2]}else if(R.touch0)Q=R.touch0[0],G=R.touch0[1];else return;R.zoom("touch",r(m(j,Q,G),R.extent,o))}}function k(){if(this.__zooming){var R=S(this,arguments),L=$t.changedTouches,H=L.length,B,j;for(NA(),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),B=0;B<H;++B)j=L[B],R.touch0&&R.touch0[2]===j.identifier?delete R.touch0:R.touch1&&R.touch1[2]===j.identifier&&delete R.touch1;if(R.touch1&&!R.touch0&&(R.touch0=R.touch1,delete R.touch1),R.touch0)R.touch0[1]=this.__zoom.invert(R.touch0[0]);else if(R.end(),R.taps===2){var Q=Ga(this).on("dblclick.zoom");Q&&Q.apply(this,arguments)}}}return p.wheelDelta=function(R){return arguments.length?(n=typeof R=="function"?R:I2(+R),p):n},p.filter=function(R){return arguments.length?(e=typeof R=="function"?R:I2(!!R),p):e},p.touchable=function(R){return arguments.length?(a=typeof R=="function"?R:I2(!!R),p):a},p.extent=function(R){return arguments.length?(t=typeof R=="function"?R:I2([[+R[0][0],+R[0][1]],[+R[1][0],+R[1][1]]]),p):t},p.scaleExtent=function(R){return arguments.length?(i[0]=+R[0],i[1]=+R[1],p):[i[0],i[1]]},p.translateExtent=function(R){return arguments.length?(o[0][0]=+R[0][0],o[1][0]=+R[1][0],o[0][1]=+R[0][1],o[1][1]=+R[1][1],p):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},p.constrain=function(R){return arguments.length?(r=R,p):r},p.duration=function(R){return arguments.length?(s=+R,p):s},p.interpolate=function(R){return arguments.length?(u=R,p):u},p.on=function(){var R=l.on.apply(l,arguments);return R===l?p:R},p.clickDistance=function(R){return arguments.length?(v=(R=+R)*R,p):Math.sqrt(v)},p}class u0e{constructor({min:t=-1/0,max:r=1/0}={}){this.segments=[],this.max=r,this.min=t,this.regionString=null}encode(t=!1){return this.segments.map(({start:r,end:n,color:a})=>{if(t)return`${r}:${n}${a?`:${a}`:""}`;const i=r===this.min?"":r,o=n===this.max?"":n;return`${i}:${o}${a?`:${a}`:""}`}).join(",")}decode(t){if(typeof t<"u"&&(this.regionString=t),!this.regionString){this.segments=[];return}this.segments=this.regionString.split(",").map(r=>{const[n,a,i,o]=r.split(":");if(typeof o<"u")throw new Error(`there should be at most 2 ':' per region. Region: ${r}`);let s=n?Number(n):this.min,u=a?Number(a):this.max;const l=i!==""?i:void 0;if(s>u&&([s,u]=[u,s]),s<this.min&&(s=this.min),u>this.max&&(u=this.max),Number.isNaN(s))throw new Error(`The parsed value of ${n} is NaN. Region: ${r}`);if(Number.isNaN(u))throw new Error(`The parsed value of ${a} is NaN. Region: ${r}`);if(l&&!l.match(/^#[0-9a-f]{6,8}$/i))throw new Error(`The parsed value of ${i} is not a color in hex format. Region: ${r}`);return{start:s,end:u,color:l}})}}const uB="#FFEB3B66",FA=(e,t)=>e?t?`${e},${t}`:e:t;let l0e=class{constructor({element:t,min:r,max:n}){this.element=t,this.element._highlightcolor=uB,this.region=new u0e({min:r,max:n}),this.fixedHighlight=null}set max(t){this.region.max=t}setAttributesInElement(){this.region.decode(this.element.getAttribute("highlight")),this.region.segments.length===0&&(this.element._highlightstart=Number(this.element.getAttribute("highlightstart")),this.element._highlightend=Number(this.element.getAttribute("highlightend")),this.element._highlightcolor=this.element.getAttribute("highlightcolor")||uB,this.element._highlightstart!==null&&this.element._highlightend!==null&&typeof this.element._highlightstart=="number"&&typeof this.element._highlightend=="number"&&(this.element._highlight=`${this.element._highlightstart}:${this.element._highlightend}`,this.region.decode(FA(this.fixedHighlight,this.element._highlight))))}setFloatAttribute(t,r){const n=parseFloat(r);this.element[`_${t}`]=Number.isNaN(n)?r:n}changedCallBack(t,r){switch(t){case"highlightstart":case"highlightend":this.setFloatAttribute(t,r),this.element._highlight=Number.isNaN(this.element._highlightstart)||Number.isNaN(this.element._highlightend)||this.element._highlightstart===void 0||this.element._highlightend===void 0||this.element._highlightstart===null||this.element._highlightend===null?"":`${Math.max(this.region.min,this.element._highlightstart)}:${Math.min(this.region.max,this.element._highlightend)}`;break;default:this.element._highlight=r}this.region.decode(FA(this.fixedHighlight,this.element._highlight)),this.element.refresh()}setFixedHighlight(t){this.fixedHighlight=t,this.region.decode(FA(t,this.element._highlight)),this.element.refresh()}appendHighlightTo(t){this.highlighted=t.append("g").attr("class","highlighted")}updateHighlight(){const t=this.highlighted.selectAll("rect").data(this.region.segments);t.enter().append("rect").style("pointer-events","none").merge(t).attr("fill",r=>r.color?r.color:this.element._highlightcolor).attr("height",this.element._height).attr("x",r=>this.element.getXFromSeqPosition(r.start)).attr("width",r=>this.element.getSingleBaseWidth()*(r.end-r.start+1)),t.exit().remove()}},c0e=class{constructor(t,r=400){this.element=t,this.timeStampWheelOutside=0,this.resetScrollableTimeout=null,this.scrollDelay=r}setElementScrollable(t){this.element.setAttribute("scrollable",t)}startResetScrollableTimer(){this.resetScrollableTimeout&&clearTimeout(this.resetScrollableTimeout),this.resetScrollableTimeout=setTimeout(()=>{this.setElementScrollable(!0),this.resetScrollableTimeout=null},this.scrollDelay)}blockScroll(t){this.timeStampWheelOutside=t,this.setElementScrollable(!1),this.startResetScrollableTimer()}wheel({target:t,timeStamp:r}){this.element.contains(t)?r<this.timeStampWheelOutside+this.scrollDelay?this.blockScroll(r):this.setElementScrollable(!0):this.blockScroll(r)}};const I$=["left","right","top","bottom"],lB=I$.map(e=>`margin${e}`),d0e=(e,t={initialValue:{top:0,bottom:0,left:0,right:0}})=>{class r extends e{constructor(){super(),this.margin=t.initialValue}static get observedAttributes(){return[...super.observedAttributes,...lB]}attributeChangedCallback(a,i,o){i!==o&&lB.includes(a)&&(this[a]=o),super.attributeChangedCallback(a,i,o)}}for(const n of I$)Object.defineProperty(r.prototype,`margin${n}`,{get(){return this.margin[n]||0},set(a){this.margin[n]=+a}});return r},f0e=l0e,M$=c0e,D$=d0e;class h0e extends HTMLElement{constructor(){super(),this._x=null,this._padding=0,this.height=40,this.dontDispatch=!1}_refreshWidth(){this.style.display="block",this.style.width="100%",this.width=this.offsetWidth-this.margin.left-this.margin.right,this.width>0&&(this._padding=10)}connectedCallback(){this._refreshWidth(),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this._length=parseFloat(this.getAttribute("length")),this._displaystart=parseFloat(this.getAttribute("displaystart"))||1,this._displayend=parseFloat(this.getAttribute("displayend"))||this._length,this._highlightStart=parseFloat(this.getAttribute("highlightStart")),this._highlightEnd=parseFloat(this.getAttribute("highlightEnd")),this._rulerstart=parseFloat(this.getAttribute("rulerStart"))||1,this._onResize=this._onResize.bind(this),this._createNavRuler()}disconnectedCallback(){this.manager&&this.manager.unregister(this),this._ro&&this._ro.unobserve(this),window.removeEventListener("resize",this._onResize)}static get observedAttributes(){return["length","displaystart","displayend","highlightStart","highlightEnd","width","rulerstart"]}attributeChangedCallback(t,r,n){r!==n&&(this[`_${t}`]=parseFloat(n),this._updateNavRuler())}get width(){return this._width}set width(t){this._width=t}_createNavRuler(){this._x=Eb().range([this._padding,this.width-this._padding]),this._x.domain([this._rulerstart,this._rulerstart+this._length-1]),Ga(this).selectAll("div").remove(),this._container=Ga(this).append("div").attr("class","container"),this._svg=this._container.append("svg").attr("id","").attr("width",this.width).attr("height",this.height),this._xAxis=LW(this._x),this._displaystartLabel=this._svg.append("text").attr("class","start-label").attr("x",0).attr("y",this.height-this._padding),this._displayendLabel=this._svg.append("text").attr("class","end-label").attr("x",this.width).attr("y",this.height-this._padding).attr("text-anchor","end"),this._axis=this._svg.append("g").attr("class","x axis").call(this._xAxis),this._viewport=uge().extent([[this._padding,0],[this.width-this._padding,this.height*.51]]).on("brush",()=>{$t.selection&&(this._displaystart=xC("d")(this._x.invert($t.selection[0])),this._displayend=xC("d")(this._x.invert($t.selection[1])),this.dontDispatch||this.dispatchEvent(new CustomEvent("change",{detail:{displayend:this._displayend,displaystart:this._displaystart,extra:{transform:$t.transform}},bubbles:!0,cancelable:!0})),this._updateLabels(),this._updatePolygon())}),this._brushG=this._svg.append("g").attr("class","brush").call(this._viewport),this._brushG.call(this._viewport.move,[this._x(this._displaystart),this._x(this._displayend)]),this.polygon=this._svg.append("polygon").attr("class","zoom-polygon").attr("fill","#777").attr("fill-opacity","0.3"),this._updateNavRuler(),"ResizeObserver"in window&&(this._ro=new ResizeObserver(this._onResize),this._ro.observe(this)),window.addEventListener("resize",this._onResize)}_onResize(){this._refreshWidth(),this._x=this._x.range([this._padding,this.width-this._padding]),this._svg.attr("width",this.width),this._viewport.extent([[this._padding,0],[this.width-this._padding,this.height*.51]]),this._brushG.call(this._viewport),this._updateNavRuler()}_updateNavRuler(){this._x&&(this._container.style("padding-left",`${this.margin.left}px`).style("padding-right",`${this.margin.right}px`).style("padding-top",`${this.margin.top}px`).style("padding-bottom",`${this.margin.bottom}px`),this._x.domain([this._rulerstart,this._rulerstart+this._length-1]),this._axis.call(this._xAxis),this._updatePolygon(),this._updateLabels(),this._brushG&&(this.dontDispatch=!0,this._brushG.call(this._viewport.move,[this._x(this._displaystart),this._x(this._displayend)]),this.dontDispatch=!1))}_updateLabels(){this._displaystartLabel&&this._displaystartLabel.text(this._displaystart),this._displayendLabel&&this._displayendLabel.attr("x",this.width).text(this._displayend)}_updatePolygon(){this.polygon&&this.polygon.attr("points",`${this._x(this._displaystart)},${this.height/2}
        ${this._x(this._displayend)},${this.height/2}
        ${this.width},${this.height}
        0,${this.height}`)}}const p0e=D$(h0e),cB=16,dB=10,fB=10,hB=5,M2=(e,t=0)=>{const r=(e||"").match(/(\d+\.?\d*)px/);return r?+r[1]:t};class v0e extends ph{static get properties(){return{title:{type:String,reflect:!0},x:{type:Number,reflect:!0},y:{type:Number,reflect:!0},visible:{type:Boolean,reflect:!0},container:{type:String,reflect:!0}}}constructor(){super(),this.title="",this.x=0,this.y=0,this.visible=!1,this.container="html",this._changeHandler=()=>this.requestUpdate(),this._observer=new MutationObserver(this._changeHandler)}connectedCallback(){super.connectedCallback(),this._observer.observe(this,{subtree:!0,characterData:!0,childList:!0}),window.addEventListener("resize",this._changeHandler)}disconnectedCallback(){super.disconnectedCallback(),this._observer.disconnect(),window.removeEventListener("resize",this._changeHandler)}static get styles(){return Qs`
      :host {
        --z-index: 50000;
        --title-color: black;
        --text-color: white;
        --body-color: #616161;
        --triangle-width: ${cB}px;
        --triangle-height: ${dB}px;
        --triangle-margin: ${fB}px;
        --vertical-distance: ${hB}px;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin: 0;
      }

      h1 {
        background-color: var(--title-color);
        line-height: 2em;
        padding: 0 1ch;
      }

      .tooltip {
        font-family: Roboto, Arial, sans-serif;
        font-size: 0.9rem;
        top: 0;
        left: 0;
        display: block;
        position: absolute;
        min-width: 220px;
        max-width: 50vw;

        /* user overridable through custom properties */
        z-index: var(--z-index);
        color: var(--text-color);

        /* will change those */
        opacity: 0;
        pointer-events: none;
        transform: translate(0, 0);
      }

      .tooltip.visible {
        opacity: 0.9;
        pointer-events: auto;
      }

      .tooltip::before {
        content: "";
        position: absolute;
        pointer-events: none;
        border-style: solid;
        border-color: transparent;
        border-width: 0 calc(var(--triangle-width) / 2);
      }

      .tooltip.arrow-left::before {
        left: var(--triangle-margin);
      }

      .tooltip.arrow-right::before {
        right: var(--triangle-margin);
      }

      .tooltip.arrow-up::before {
        top: calc(-1 * var(--triangle-height));
        border-bottom-color: var(--title-color);
        border-bottom-width: var(--triangle-height);
      }

      .tooltip.arrow-down::before {
        bottom: calc(-1 * var(--triangle-height));
        border-top-color: var(--body-color);
        border-top-width: var(--triangle-height);
      }

      :host a,
      :host a:link,
      :host a:active,
      :host a:hover,
      ::slotted(a),
      ::slotted(a:link),
      ::slotted(a:active),
      ::slotted(a:hover) {
        color: #fff;
      }

      .tooltip-body {
        padding: 1em;
        background: var(--body-color);
        font-weight: normal;
        overflow-y: auto;
        max-height: 40vh;
      }

      ::slotted(h4) {
        font-size: 1.2rem !important;
        margin: 0 0 0.5rem 0 !important;
        font-weight: 600 !important;
        color: #fff !important;
      }

      ::slotted(h5) {
        font-size: 1rem !important;
        margin: 0 !important;
        font-weight: 500 !important;
        color: #fff !important;
      }

      ::slotted(h6) {
        font-size: 1rem !important;
        margin: 0 !important;
        font-weight: 300 !important;
        color: #fff !important;
      }

      ::slotted(p) {
        margin: 0.25rem 0 1rem 0 !important;
      }

      ::slotted(ul) {
        list-style: none !important;
        margin: 0.25rem 0 1rem 0 !important;
        padding: 0 !important;
      }
    `}_getPosition(){if(!this.shadowRoot.firstElementChild)return{};const r=document.querySelector(this.container||"html").getBoundingClientRect(),n=this.shadowRoot.firstElementChild.getBoundingClientRect(),a=getComputedStyle(this),i=M2(a.getPropertyValue("--triangle-width"),cB),o=M2(a.getPropertyValue("--triangle-height"),dB),s=M2(a.getPropertyValue("--triangle-margin"),fB),u=M2(a.getPropertyValue("--vertical-distance"),hB);let l=this.x-i/2-s,c="left";l+n.width<=r.right||(c="right",l=this.x-n.width+i/2+s);let f=this.y+o+u,h="up";return f+n.height<=r.height||(h="down",f=this.y-n.height-o-u),{x:l,y:f,horizontal:c,vertical:h}}firstUpdated(){this.requestUpdate()}render(){let t=this.title&&this.visible;const r=t?this._getPosition():{};t=r.x&&t;const n=t&&`transform: translate(${r.x}px, ${r.y}px);`;return Vr`
      <section
        class="tooltip arrow-${r.horizontal||"left"} arrow-${r.vertical||"up"} ${t?"visible":""}"
        style="${n}"
      >
        <h1>${this.title}</h1>
        <div class="tooltip-body"><slot></slot></div>
      </section>
    `}}function m0e(e,t,r,n){for(var a=e.length,i=r+(n?1:-1);n?i--:++i<a;)if(t(e[i],i,e))return i;return-1}function g0e(e){return e!==e}function y0e(e,t,r){for(var n=r-1,a=e.length;++n<a;)if(e[n]===t)return n;return-1}function R$(e,t,r){return t===t?y0e(e,t,r):m0e(e,g0e,r)}var b0e=typeof global=="object"&&global&&global.Object===Object&&global;const k$=b0e;var x0e=typeof self=="object"&&self&&self.Object===Object&&self,S0e=k$||x0e||Function("return this")();const ld=S0e;var C0e=ld.Symbol;const Pl=C0e;var O$=Object.prototype,_0e=O$.hasOwnProperty,w0e=O$.toString,L0=Pl?Pl.toStringTag:void 0;function E0e(e){var t=_0e.call(e,L0),r=e[L0];try{e[L0]=void 0;var n=!0}catch{}var a=w0e.call(e);return n&&(t?e[L0]=r:delete e[L0]),a}var A0e=Object.prototype,P0e=A0e.toString;function T0e(e){return P0e.call(e)}var I0e="[object Null]",M0e="[object Undefined]",pB=Pl?Pl.toStringTag:void 0;function sv(e){return e==null?e===void 0?M0e:I0e:pB&&pB in Object(e)?E0e(e):T0e(e)}function B1(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var D0e="[object AsyncFunction]",R0e="[object Function]",k0e="[object GeneratorFunction]",O0e="[object Proxy]";function L$(e){if(!B1(e))return!1;var t=sv(e);return t==R0e||t==k0e||t==D0e||t==O0e}var L0e=9007199254740991;function XR(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=L0e}function Ab(e){return e!=null&&XR(e.length)&&!L$(e)}var N0e=Array.isArray;const Jo=N0e;function Xf(e){return e!=null&&typeof e=="object"}var F0e="[object String]";function B0e(e){return typeof e=="string"||!Jo(e)&&Xf(e)&&sv(e)==F0e}var U0e=/\s/;function j0e(e){for(var t=e.length;t--&&U0e.test(e.charAt(t)););return t}var z0e=/^\s+/;function V0e(e){return e&&e.slice(0,j0e(e)+1).replace(z0e,"")}var H0e="[object Symbol]";function Kw(e){return typeof e=="symbol"||Xf(e)&&sv(e)==H0e}var vB=0/0,G0e=/^[-+]0x[0-9a-f]+$/i,q0e=/^0b[01]+$/i,W0e=/^0o[0-7]+$/i,$0e=parseInt;function X0e(e){if(typeof e=="number")return e;if(Kw(e))return vB;if(B1(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=B1(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=V0e(e);var r=q0e.test(e);return r||W0e.test(e)?$0e(e.slice(2),r?2:8):G0e.test(e)?vB:+e}var mB=1/0,Y0e=17976931348623157e292;function K0e(e){if(!e)return e===0?e:0;if(e=X0e(e),e===mB||e===-mB){var t=e<0?-1:1;return t*Y0e}return e===e?e:0}function Q0e(e){var t=K0e(e),r=t%1;return t===t?r?t-r:t:0}function Pb(e,t){for(var r=-1,n=e==null?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}function Z0e(e,t){return Pb(t,function(r){return e[r]})}function J0e(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var eye="[object Arguments]";function gB(e){return Xf(e)&&sv(e)==eye}var N$=Object.prototype,tye=N$.hasOwnProperty,rye=N$.propertyIsEnumerable,nye=gB(function(){return arguments}())?gB:function(e){return Xf(e)&&tye.call(e,"callee")&&!rye.call(e,"callee")};const YR=nye;function aye(){return!1}var F$=typeof wc=="object"&&wc&&!wc.nodeType&&wc,yB=F$&&typeof Ec=="object"&&Ec&&!Ec.nodeType&&Ec,iye=yB&&yB.exports===F$,bB=iye?ld.Buffer:void 0,oye=bB?bB.isBuffer:void 0,sye=oye||aye;const FI=sye;var uye=9007199254740991,lye=/^(?:0|[1-9]\d*)$/;function B$(e,t){var r=typeof e;return t=t??uye,!!t&&(r=="number"||r!="symbol"&&lye.test(e))&&e>-1&&e%1==0&&e<t}var cye="[object Arguments]",dye="[object Array]",fye="[object Boolean]",hye="[object Date]",pye="[object Error]",vye="[object Function]",mye="[object Map]",gye="[object Number]",yye="[object Object]",bye="[object RegExp]",xye="[object Set]",Sye="[object String]",Cye="[object WeakMap]",_ye="[object ArrayBuffer]",wye="[object DataView]",Eye="[object Float32Array]",Aye="[object Float64Array]",Pye="[object Int8Array]",Tye="[object Int16Array]",Iye="[object Int32Array]",Mye="[object Uint8Array]",Dye="[object Uint8ClampedArray]",Rye="[object Uint16Array]",kye="[object Uint32Array]",Hn={};Hn[Eye]=Hn[Aye]=Hn[Pye]=Hn[Tye]=Hn[Iye]=Hn[Mye]=Hn[Dye]=Hn[Rye]=Hn[kye]=!0;Hn[cye]=Hn[dye]=Hn[_ye]=Hn[fye]=Hn[wye]=Hn[hye]=Hn[pye]=Hn[vye]=Hn[mye]=Hn[gye]=Hn[yye]=Hn[bye]=Hn[xye]=Hn[Sye]=Hn[Cye]=!1;function Oye(e){return Xf(e)&&XR(e.length)&&!!Hn[sv(e)]}function U$(e){return function(t){return e(t)}}var j$=typeof wc=="object"&&wc&&!wc.nodeType&&wc,zy=j$&&typeof Ec=="object"&&Ec&&!Ec.nodeType&&Ec,Lye=zy&&zy.exports===j$,BA=Lye&&k$.process,Nye=function(){try{var e=zy&&zy.require&&zy.require("util").types;return e||BA&&BA.binding&&BA.binding("util")}catch{}}();const xB=Nye;var SB=xB&&xB.isTypedArray,Fye=SB?U$(SB):Oye;const z$=Fye;var Bye=Object.prototype,Uye=Bye.hasOwnProperty;function jye(e,t){var r=Jo(e),n=!r&&YR(e),a=!r&&!n&&FI(e),i=!r&&!n&&!a&&z$(e),o=r||n||a||i,s=o?J0e(e.length,String):[],u=s.length;for(var l in e)(t||Uye.call(e,l))&&!(o&&(l=="length"||a&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||B$(l,u)))&&s.push(l);return s}var zye=Object.prototype;function Vye(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||zye;return e===r}function Hye(e,t){return function(r){return e(t(r))}}var Gye=Hye(Object.keys,Object);const qye=Gye;var Wye=Object.prototype,$ye=Wye.hasOwnProperty;function Xye(e){if(!Vye(e))return qye(e);var t=[];for(var r in Object(e))$ye.call(e,r)&&r!="constructor"&&t.push(r);return t}function Qw(e){return Ab(e)?jye(e):Xye(e)}function Yye(e){return e==null?[]:Z0e(e,Qw(e))}var Kye=Math.max;function Qye(e,t,r,n){e=Ab(e)?e:Yye(e),r=r&&!n?Q0e(r):0;var a=e.length;return r<0&&(r=Kye(a+r,0)),B0e(e)?r<=a&&e.indexOf(t,r)>-1:!!a&&R$(e,t,r)>-1}var Zye=ld["__core-js_shared__"];const UA=Zye;var CB=function(){var e=/[^.]+$/.exec(UA&&UA.keys&&UA.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Jye(e){return!!CB&&CB in e}var e1e=Function.prototype,t1e=e1e.toString;function uv(e){if(e!=null){try{return t1e.call(e)}catch{}try{return e+""}catch{}}return""}var r1e=/[\\^$.*+?()[\]{}|]/g,n1e=/^\[object .+?Constructor\]$/,a1e=Function.prototype,i1e=Object.prototype,o1e=a1e.toString,s1e=i1e.hasOwnProperty,u1e=RegExp("^"+o1e.call(s1e).replace(r1e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function l1e(e){if(!B1(e)||Jye(e))return!1;var t=L$(e)?u1e:n1e;return t.test(uv(e))}function c1e(e,t){return e==null?void 0:e[t]}function lv(e,t){var r=c1e(e,t);return l1e(r)?r:void 0}var d1e=function(){try{var e=lv(Object,"defineProperty");return e({},"",{}),e}catch{}}();const _C=d1e;function f1e(e,t,r){t=="__proto__"&&_C?_C(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function h1e(e,t,r,n){for(var a=-1,i=e==null?0:e.length;++a<i;){var o=e[a];t(n,o,r(o),e)}return n}function p1e(e){return function(t,r,n){for(var a=-1,i=Object(t),o=n(t),s=o.length;s--;){var u=o[e?s:++a];if(r(i[u],u,i)===!1)break}return t}}var v1e=p1e();const m1e=v1e;function g1e(e,t){return e&&m1e(e,t,Qw)}function y1e(e,t){return function(r,n){if(r==null)return r;if(!Ab(r))return e(r,n);for(var a=r.length,i=t?a:-1,o=Object(r);(t?i--:++i<a)&&n(o[i],i,o)!==!1;);return r}}var b1e=y1e(g1e);const V$=b1e;function x1e(e,t,r,n){return V$(e,function(a,i,o){t(n,a,r(a),o)}),n}function S1e(){this.__data__=[],this.size=0}function H$(e,t){return e===t||e!==e&&t!==t}function Zw(e,t){for(var r=e.length;r--;)if(H$(e[r][0],t))return r;return-1}var C1e=Array.prototype,_1e=C1e.splice;function w1e(e){var t=this.__data__,r=Zw(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():_1e.call(t,r,1),--this.size,!0}function E1e(e){var t=this.__data__,r=Zw(t,e);return r<0?void 0:t[r][1]}function A1e(e){return Zw(this.__data__,e)>-1}function P1e(e,t){var r=this.__data__,n=Zw(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function cd(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}cd.prototype.clear=S1e;cd.prototype.delete=w1e;cd.prototype.get=E1e;cd.prototype.has=A1e;cd.prototype.set=P1e;function T1e(){this.__data__=new cd,this.size=0}function I1e(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function M1e(e){return this.__data__.get(e)}function D1e(e){return this.__data__.has(e)}var R1e=lv(ld,"Map");const U1=R1e;var k1e=lv(Object,"create");const j1=k1e;function O1e(){this.__data__=j1?j1(null):{},this.size=0}function L1e(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var N1e="__lodash_hash_undefined__",F1e=Object.prototype,B1e=F1e.hasOwnProperty;function U1e(e){var t=this.__data__;if(j1){var r=t[e];return r===N1e?void 0:r}return B1e.call(t,e)?t[e]:void 0}var j1e=Object.prototype,z1e=j1e.hasOwnProperty;function V1e(e){var t=this.__data__;return j1?t[e]!==void 0:z1e.call(t,e)}var H1e="__lodash_hash_undefined__";function G1e(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=j1&&t===void 0?H1e:t,this}function Fp(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Fp.prototype.clear=O1e;Fp.prototype.delete=L1e;Fp.prototype.get=U1e;Fp.prototype.has=V1e;Fp.prototype.set=G1e;function q1e(){this.size=0,this.__data__={hash:new Fp,map:new(U1||cd),string:new Fp}}function W1e(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Jw(e,t){var r=e.__data__;return W1e(t)?r[typeof t=="string"?"string":"hash"]:r.map}function $1e(e){var t=Jw(this,e).delete(e);return this.size-=t?1:0,t}function X1e(e){return Jw(this,e).get(e)}function Y1e(e){return Jw(this,e).has(e)}function K1e(e,t){var r=Jw(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function dd(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}dd.prototype.clear=q1e;dd.prototype.delete=$1e;dd.prototype.get=X1e;dd.prototype.has=Y1e;dd.prototype.set=K1e;var Q1e=200;function Z1e(e,t){var r=this.__data__;if(r instanceof cd){var n=r.__data__;if(!U1||n.length<Q1e-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new dd(n)}return r.set(e,t),this.size=r.size,this}function Ic(e){var t=this.__data__=new cd(e);this.size=t.size}Ic.prototype.clear=T1e;Ic.prototype.delete=I1e;Ic.prototype.get=M1e;Ic.prototype.has=D1e;Ic.prototype.set=Z1e;var J1e="__lodash_hash_undefined__";function ebe(e){return this.__data__.set(e,J1e),this}function tbe(e){return this.__data__.has(e)}function bg(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new dd;++t<r;)this.add(e[t])}bg.prototype.add=bg.prototype.push=ebe;bg.prototype.has=tbe;function rbe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function wC(e,t){return e.has(t)}var nbe=1,abe=2;function G$(e,t,r,n,a,i){var o=r&nbe,s=e.length,u=t.length;if(s!=u&&!(o&&u>s))return!1;var l=i.get(e),c=i.get(t);if(l&&c)return l==t&&c==e;var d=-1,f=!0,h=r&abe?new bg:void 0;for(i.set(e,t),i.set(t,e);++d<s;){var v=e[d],p=t[d];if(n)var g=o?n(p,v,d,t,e,i):n(v,p,d,e,t,i);if(g!==void 0){if(g)continue;f=!1;break}if(h){if(!rbe(t,function(m,y){if(!wC(h,y)&&(v===m||a(v,m,r,n,i)))return h.push(y)})){f=!1;break}}else if(!(v===p||a(v,p,r,n,i))){f=!1;break}}return i.delete(e),i.delete(t),f}var ibe=ld.Uint8Array;const _B=ibe;function obe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,a){r[++t]=[a,n]}),r}function KR(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var sbe=1,ube=2,lbe="[object Boolean]",cbe="[object Date]",dbe="[object Error]",fbe="[object Map]",hbe="[object Number]",pbe="[object RegExp]",vbe="[object Set]",mbe="[object String]",gbe="[object Symbol]",ybe="[object ArrayBuffer]",bbe="[object DataView]",wB=Pl?Pl.prototype:void 0,jA=wB?wB.valueOf:void 0;function xbe(e,t,r,n,a,i,o){switch(r){case bbe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ybe:return!(e.byteLength!=t.byteLength||!i(new _B(e),new _B(t)));case lbe:case cbe:case hbe:return H$(+e,+t);case dbe:return e.name==t.name&&e.message==t.message;case pbe:case mbe:return e==t+"";case fbe:var s=obe;case vbe:var u=n&sbe;if(s||(s=KR),e.size!=t.size&&!u)return!1;var l=o.get(e);if(l)return l==t;n|=ube,o.set(e,t);var c=G$(s(e),s(t),n,a,i,o);return o.delete(e),c;case gbe:if(jA)return jA.call(e)==jA.call(t)}return!1}function q$(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}function Sbe(e,t,r){var n=t(e);return Jo(e)?n:q$(n,r(e))}function Cbe(e,t){for(var r=-1,n=e==null?0:e.length,a=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[a++]=o)}return i}function _be(){return[]}var wbe=Object.prototype,Ebe=wbe.propertyIsEnumerable,EB=Object.getOwnPropertySymbols,Abe=EB?function(e){return e==null?[]:(e=Object(e),Cbe(EB(e),function(t){return Ebe.call(e,t)}))}:_be;const Pbe=Abe;function AB(e){return Sbe(e,Qw,Pbe)}var Tbe=1,Ibe=Object.prototype,Mbe=Ibe.hasOwnProperty;function Dbe(e,t,r,n,a,i){var o=r&Tbe,s=AB(e),u=s.length,l=AB(t),c=l.length;if(u!=c&&!o)return!1;for(var d=u;d--;){var f=s[d];if(!(o?f in t:Mbe.call(t,f)))return!1}var h=i.get(e),v=i.get(t);if(h&&v)return h==t&&v==e;var p=!0;i.set(e,t),i.set(t,e);for(var g=o;++d<u;){f=s[d];var m=e[f],y=t[f];if(n)var b=o?n(y,m,f,t,e,i):n(m,y,f,e,t,i);if(!(b===void 0?m===y||a(m,y,r,n,i):b)){p=!1;break}g||(g=f=="constructor")}if(p&&!g){var S=e.constructor,x=t.constructor;S!=x&&"constructor"in e&&"constructor"in t&&!(typeof S=="function"&&S instanceof S&&typeof x=="function"&&x instanceof x)&&(p=!1)}return i.delete(e),i.delete(t),p}var Rbe=lv(ld,"DataView");const BI=Rbe;var kbe=lv(ld,"Promise");const UI=kbe;var Obe=lv(ld,"Set");const Xm=Obe;var Lbe=lv(ld,"WeakMap");const jI=Lbe;var PB="[object Map]",Nbe="[object Object]",TB="[object Promise]",IB="[object Set]",MB="[object WeakMap]",DB="[object DataView]",Fbe=uv(BI),Bbe=uv(U1),Ube=uv(UI),jbe=uv(Xm),zbe=uv(jI),$h=sv;(BI&&$h(new BI(new ArrayBuffer(1)))!=DB||U1&&$h(new U1)!=PB||UI&&$h(UI.resolve())!=TB||Xm&&$h(new Xm)!=IB||jI&&$h(new jI)!=MB)&&($h=function(e){var t=sv(e),r=t==Nbe?e.constructor:void 0,n=r?uv(r):"";if(n)switch(n){case Fbe:return DB;case Bbe:return PB;case Ube:return TB;case jbe:return IB;case zbe:return MB}return t});const RB=$h;var Vbe=1,kB="[object Arguments]",OB="[object Array]",D2="[object Object]",Hbe=Object.prototype,LB=Hbe.hasOwnProperty;function Gbe(e,t,r,n,a,i){var o=Jo(e),s=Jo(t),u=o?OB:RB(e),l=s?OB:RB(t);u=u==kB?D2:u,l=l==kB?D2:l;var c=u==D2,d=l==D2,f=u==l;if(f&&FI(e)){if(!FI(t))return!1;o=!0,c=!1}if(f&&!c)return i||(i=new Ic),o||z$(e)?G$(e,t,r,n,a,i):xbe(e,t,u,r,n,a,i);if(!(r&Vbe)){var h=c&&LB.call(e,"__wrapped__"),v=d&&LB.call(t,"__wrapped__");if(h||v){var p=h?e.value():e,g=v?t.value():t;return i||(i=new Ic),a(p,g,r,n,i)}}return f?(i||(i=new Ic),Dbe(e,t,r,n,a,i)):!1}function QR(e,t,r,n,a){return e===t?!0:e==null||t==null||!Xf(e)&&!Xf(t)?e!==e&&t!==t:Gbe(e,t,r,n,QR,a)}var qbe=1,Wbe=2;function $be(e,t,r,n){var a=r.length,i=a,o=!n;if(e==null)return!i;for(e=Object(e);a--;){var s=r[a];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++a<i;){s=r[a];var u=s[0],l=e[u],c=s[1];if(o&&s[2]){if(l===void 0&&!(u in e))return!1}else{var d=new Ic;if(n)var f=n(l,c,u,e,t,d);if(!(f===void 0?QR(c,l,qbe|Wbe,n,d):f))return!1}}return!0}function W$(e){return e===e&&!B1(e)}function Xbe(e){for(var t=Qw(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,W$(a)]}return t}function $$(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function Ybe(e){var t=Xbe(e);return t.length==1&&t[0][2]?$$(t[0][0],t[0][1]):function(r){return r===e||$be(r,e,t)}}var Kbe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Qbe=/^\w*$/;function ZR(e,t){if(Jo(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Kw(e)?!0:Qbe.test(e)||!Kbe.test(e)||t!=null&&e in Object(t)}var Zbe="Expected a function";function JR(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Zbe);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],i=r.cache;if(i.has(a))return i.get(a);var o=e.apply(this,n);return r.cache=i.set(a,o)||i,o};return r.cache=new(JR.Cache||dd),r}JR.Cache=dd;var Jbe=500;function e2e(e){var t=JR(e,function(n){return r.size===Jbe&&r.clear(),n}),r=t.cache;return t}var t2e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r2e=/\\(\\)?/g,n2e=e2e(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(t2e,function(r,n,a,i){t.push(a?i.replace(r2e,"$1"):n||r)}),t});const a2e=n2e;var i2e=1/0,NB=Pl?Pl.prototype:void 0,FB=NB?NB.toString:void 0;function X$(e){if(typeof e=="string")return e;if(Jo(e))return Pb(e,X$)+"";if(Kw(e))return FB?FB.call(e):"";var t=e+"";return t=="0"&&1/e==-i2e?"-0":t}function o2e(e){return e==null?"":X$(e)}function Y$(e,t){return Jo(e)?e:ZR(e,t)?[e]:a2e(o2e(e))}var s2e=1/0;function e3(e){if(typeof e=="string"||Kw(e))return e;var t=e+"";return t=="0"&&1/e==-s2e?"-0":t}function K$(e,t){t=Y$(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[e3(t[r++])];return r&&r==n?e:void 0}function u2e(e,t,r){var n=e==null?void 0:K$(e,t);return n===void 0?r:n}function l2e(e,t){return e!=null&&t in Object(e)}function c2e(e,t,r){t=Y$(t,e);for(var n=-1,a=t.length,i=!1;++n<a;){var o=e3(t[n]);if(!(i=e!=null&&r(e,o)))break;e=e[o]}return i||++n!=a?i:(a=e==null?0:e.length,!!a&&XR(a)&&B$(o,a)&&(Jo(e)||YR(e)))}function d2e(e,t){return e!=null&&c2e(e,t,l2e)}var f2e=1,h2e=2;function p2e(e,t){return ZR(e)&&W$(t)?$$(e3(e),t):function(r){var n=u2e(r,e);return n===void 0&&n===t?d2e(r,e):QR(t,n,f2e|h2e)}}function ek(e){return e}function v2e(e){return function(t){return t==null?void 0:t[e]}}function m2e(e){return function(t){return K$(t,e)}}function g2e(e){return ZR(e)?v2e(e3(e)):m2e(e)}function Q$(e){return typeof e=="function"?e:e==null?ek:typeof e=="object"?Jo(e)?p2e(e[0],e[1]):Ybe(e):g2e(e)}function y2e(e,t){return function(r,n){var a=Jo(r)?h1e:x1e,i=t?t():{};return a(r,e,Q$(n),i)}}var b2e=Object.prototype,x2e=b2e.hasOwnProperty,S2e=y2e(function(e,t,r){x2e.call(e,r)?e[r].push(t):f1e(e,r,[t])});const xg=S2e;var BB=Pl?Pl.isConcatSpreadable:void 0;function C2e(e){return Jo(e)||YR(e)||!!(BB&&e&&e[BB])}function tk(e,t,r,n,a){var i=-1,o=e.length;for(r||(r=C2e),a||(a=[]);++i<o;){var s=e[i];t>0&&r(s)?t>1?tk(s,t-1,r,n,a):q$(a,s):n||(a[a.length]=s)}return a}function _2e(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var UB=Math.max;function w2e(e,t,r){return t=UB(t===void 0?e.length-1:t,0),function(){for(var n=arguments,a=-1,i=UB(n.length-t,0),o=Array(i);++a<i;)o[a]=n[t+a];a=-1;for(var s=Array(t+1);++a<t;)s[a]=n[a];return s[t]=r(o),_2e(e,this,s)}}function E2e(e){return function(){return e}}var A2e=_C?function(e,t){return _C(e,"toString",{configurable:!0,enumerable:!1,value:E2e(t),writable:!0})}:ek;const P2e=A2e;var T2e=800,I2e=16,M2e=Date.now;function D2e(e){var t=0,r=0;return function(){var n=M2e(),a=I2e-(n-r);if(r=n,a>0){if(++t>=T2e)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var R2e=D2e(P2e);const k2e=R2e;function Z$(e,t){return k2e(w2e(e,t,ek),e+"")}function J$(e,t){var r=e==null?0:e.length;return!!r&&R$(e,t,0)>-1}function eX(e,t,r){for(var n=-1,a=e==null?0:e.length;++n<a;)if(r(t,e[n]))return!0;return!1}function O2e(){}var L2e=1/0,N2e=Xm&&1/KR(new Xm([,-0]))[1]==L2e?function(e){return new Xm(e)}:O2e;const F2e=N2e;var B2e=200;function U2e(e,t,r){var n=-1,a=J$,i=e.length,o=!0,s=[],u=s;if(r)o=!1,a=eX;else if(i>=B2e){var l=t?null:F2e(e);if(l)return KR(l);o=!1,a=wC,u=new bg}else u=t?[]:s;e:for(;++n<i;){var c=e[n],d=t?t(c):c;if(c=r||c!==0?c:0,o&&d===d){for(var f=u.length;f--;)if(u[f]===d)continue e;t&&u.push(d),s.push(c)}else a(u,d,r)||(u!==s&&u.push(d),s.push(c))}return s}function tX(e){return Xf(e)&&Ab(e)}var j2e=Z$(function(e){return U2e(tk(e,1,tX,!0))});const rX=j2e;var z2e=Math.min;function V2e(e,t,r){for(var n=r?eX:J$,a=e[0].length,i=e.length,o=i,s=Array(i),u=1/0,l=[];o--;){var c=e[o];o&&t&&(c=Pb(c,U$(t))),u=z2e(c.length,u),s[o]=!r&&(t||a>=120&&c.length>=120)?new bg(o&&c):void 0}c=e[0];var d=-1,f=s[0];e:for(;++d<a&&l.length<u;){var h=c[d],v=t?t(h):h;if(h=r||h!==0?h:0,!(f?wC(f,v):n(l,v,r))){for(o=i;--o;){var p=s[o];if(!(p?wC(p,v):n(e[o],v,r)))continue e}f&&f.push(v),l.push(h)}}return l}function H2e(e){return tX(e)?e:[]}var G2e=Z$(function(e){var t=Pb(e,H2e);return t.length&&t[0]===e[0]?V2e(t):[]});const nX=G2e;var aX=function(){if(typeof Map<"u")return Map;function e(t,r){var n=-1;return t.some(function(a,i){return a[0]===r?(n=i,!0):!1}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(r){var n=e(this.__entries__,r),a=this.__entries__[n];return a&&a[1]},t.prototype.set=function(r,n){var a=e(this.__entries__,r);~a?this.__entries__[a][1]=n:this.__entries__.push([r,n])},t.prototype.delete=function(r){var n=this.__entries__,a=e(n,r);~a&&n.splice(a,1)},t.prototype.has=function(r){return!!~e(this.__entries__,r)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(r,n){n===void 0&&(n=null);for(var a=0,i=this.__entries__;a<i.length;a++){var o=i[a];r.call(n,o[1],o[0])}},t}()}(),zI=typeof window<"u"&&typeof document<"u"&&window.document===document,EC=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),q2e=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(EC):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),W2e=2;function $2e(e,t){var r=!1,n=!1,a=0;function i(){r&&(r=!1,e()),n&&s()}function o(){q2e(i)}function s(){var u=Date.now();if(r){if(u-a<W2e)return;n=!0}else r=!0,n=!1,setTimeout(o,t);a=u}return s}var X2e=20,Y2e=["top","right","bottom","left","width","height","size","weight"],K2e=typeof MutationObserver<"u",Q2e=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=$2e(this.refresh.bind(this),X2e)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var r=this.observers_,n=r.indexOf(t);~n&&r.splice(n,1),!r.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(r){return r.gatherActive(),r.hasActive()});return t.forEach(function(r){return r.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!zI||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),K2e?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!zI||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var r=t.propertyName,n=r===void 0?"":r,a=Y2e.some(function(i){return!!~n.indexOf(i)});a&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),iX=function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},Sg=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||EC},oX=t3(0,0,0,0);function AC(e){return parseFloat(e)||0}function jB(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.reduce(function(n,a){var i=e["border-"+a+"-width"];return n+AC(i)},0)}function Z2e(e){for(var t=["top","right","bottom","left"],r={},n=0,a=t;n<a.length;n++){var i=a[n],o=e["padding-"+i];r[i]=AC(o)}return r}function J2e(e){var t=e.getBBox();return t3(0,0,t.width,t.height)}function exe(e){var t=e.clientWidth,r=e.clientHeight;if(!t&&!r)return oX;var n=Sg(e).getComputedStyle(e),a=Z2e(n),i=a.left+a.right,o=a.top+a.bottom,s=AC(n.width),u=AC(n.height);if(n.boxSizing==="border-box"&&(Math.round(s+i)!==t&&(s-=jB(n,"left","right")+i),Math.round(u+o)!==r&&(u-=jB(n,"top","bottom")+o)),!rxe(e)){var l=Math.round(s+i)-t,c=Math.round(u+o)-r;Math.abs(l)!==1&&(s-=l),Math.abs(c)!==1&&(u-=c)}return t3(a.left,a.top,s,u)}var txe=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof Sg(e).SVGGraphicsElement}:function(e){return e instanceof Sg(e).SVGElement&&typeof e.getBBox=="function"}}();function rxe(e){return e===Sg(e).document.documentElement}function nxe(e){return zI?txe(e)?J2e(e):exe(e):oX}function axe(e){var t=e.x,r=e.y,n=e.width,a=e.height,i=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(i.prototype);return iX(o,{x:t,y:r,width:n,height:a,top:r,right:t+n,bottom:a+r,left:t}),o}function t3(e,t,r,n){return{x:e,y:t,width:r,height:n}}var ixe=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=t3(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=nxe(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),oxe=function(){function e(t,r){var n=axe(r);iX(this,{target:t,contentRect:n})}return e}(),sxe=function(){function e(t,r,n){if(this.activeObservations_=[],this.observations_=new aX,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=r,this.callbackCtx_=n}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof Sg(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(t)||(r.set(t,new ixe(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof Sg(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(t)&&(r.delete(t),r.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(r){r.isActive()&&t.activeObservations_.push(r)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,r=this.activeObservations_.map(function(n){return new oxe(n.target,n.broadcastRect())});this.callback_.call(t,r,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),sX=typeof WeakMap<"u"?new WeakMap:new aX,uX=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=Q2e.getInstance(),n=new sxe(t,r,this);sX.set(this,n)}return e}();["observe","unobserve","disconnect"].forEach(function(e){uX.prototype[e]=function(){var t;return(t=sX.get(this))[e].apply(t,arguments)}});var uxe=function(){return typeof EC.ResizeObserver<"u"?EC.ResizeObserver:uX}();class PC extends HTMLElement{constructor(){super(),PC._polyfillElementClosest(),this._updateScaleDomain=this._updateScaleDomain.bind(this),this._initZoom=this._initZoom.bind(this),this.zoomed=this.zoomed.bind(this),this._applyZoomTranslation=this.applyZoomTranslation.bind(this),this._resetEventHandler=this._resetEventHandler.bind(this);let t=!1;this.applyZoomTranslation=()=>{t||(t=!0,requestAnimationFrame(()=>{t=!1,this._applyZoomTranslation()}))},this._onResize=this._onResize.bind(this),this._listenForResize=this._listenForResize.bind(this),this.trackHighlighter=new f0e({element:this,min:1}),this.scrollFilter=new M$(this),this.wheelListener=r=>this.scrollFilter.wheel(r)}connectedCallback(){this.style.display="block",this.style.width="100%",this.width=this.offsetWidth,this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this._length=this.getAttribute("length")?parseFloat(this.getAttribute("length")):0,this._displaystart=this.getAttribute("displaystart")?parseFloat(this.getAttribute("displaystart")):1,this._displayend=this.getAttribute("displayend")?parseFloat(this.getAttribute("displayend")):this.length,this._height=this.getAttribute("height")?Number(this.getAttribute("height")):44,this._highlightEvent=this.getAttribute("highlight-event")?this.getAttribute("highlight-event"):"onclick",this.trackHighlighter.setAttributesInElement(this),this._updateScaleDomain(),this._originXScale=this.xScale.copy(),this._initZoom(),this._listenForResize(),this.addEventListener("error",t=>{console.error(t)}),this._highlightEvent!=="none"&&this.addEventListener("click",this._resetEventHandler),this.hasAttribute("filter-scroll")&&document.addEventListener("wheel",this.wheelListener,{capture:!0})}disconnectedCallback(){this.manager&&this.manager.unregister(this),this._ro?this._ro.unobserve(this):window.removeEventListener("resize",this._onResize),this._highlightEvent!=="none"&&this.removeEventListener("click",this._resetEventHandler),document.removeEventListener("wheel",this.wheelListener)}get width(){return this._width}set width(t){this._width=t}set height(t){this._height=t}get height(){return this._height}set length(t){this._length=t,this.trackHighlighter.max=t}get length(){return this._length}get xScale(){return this._xScale}set xScale(t){this._xScale=t}get zoom(){return this._zoom}set svg(t){this._svg=t,t.call(this._zoom),this.applyZoomTranslation()}get svg(){return this._svg}set fixedHighlight(t){this.trackHighlighter.setFixedHighlight(t)}getWidthWithMargins(){return this.width?this.width-this.margin.left-this.margin.right:0}_updateScaleDomain(){this.xScale=Eb().domain([1,this._length+1]).range([0,this.getWidthWithMargins()])}_initZoom(){this._zoom=s0e().scaleExtent([1,1/0]).translateExtent([[0,0],[this.getWidthWithMargins(),0]]).extent([[0,0],[this.getWidthWithMargins(),0]]).filter(()=>{if(!($t instanceof WheelEvent))return!0;if(this.hasAttribute("scroll-filter")){const t=this.getAttribute("scrollable");if(t)return t==="true"}return!this.hasAttribute("use-ctrl-to-zoom")||$t.ctrlKey}).on("zoom",this.zoomed)}static get observedAttributes(){return["displaystart","displayend","length","highlight"]}setFloatAttribute(t,r){const n=parseFloat(r);this[`_${t}`]=Number.isNaN(n)?r:n}attributeChangedCallback(t,r,n){if(n==="null"&&(n=null),r!==n){if(t.startsWith("highlight")){this.trackHighlighter.changedCallBack(t,n);return}this.setFloatAttribute(t,n),t==="length"&&(this._updateScaleDomain(),this._originXScale=this.xScale.copy()),this.applyZoomTranslation()}}zoomed(){if(this.xScale=$t.transform.rescaleX(this._originXScale),this.dontDispatch)return;const[t,r]=this.xScale.domain();this.dispatchEvent(new CustomEvent("change",{detail:{displaystart:Math.max(1,t),displayend:Math.min(this.length,Math.max(r-1,t+1))},bubbles:!0,cancelable:!0}))}applyZoomTranslation(){if(!this.svg||!this._originXScale)return;const t=Math.max(1,this.length/(1+this._displayend-this._displaystart)),r=-this._originXScale(this._displaystart);this.dontDispatch=!0,this.svg.call(this.zoom.transform,$R.scale(t).translate(r,0)),this.dontDispatch=!1,this.refresh()}_onResize(){this.width=this.offsetWidth,this._updateScaleDomain(),this._originXScale=this.xScale.copy(),this.svg&&this.svg.attr("width",this.width),this._zoom.scaleExtent([1,1/0]).translateExtent([[0,0],[this.getWidthWithMargins(),0]]),this.applyZoomTranslation()}_listenForResize(){this._ro=new uxe(this._onResize),this._ro.observe(this)}_resetEventHandler(t){t.target.closest(".feature")||this.dispatchEvent(this.createEvent("reset",null,!0))}getXFromSeqPosition(t){return this.margin.left+this.xScale(t)}getSingleBaseWidth(){return this.xScale(2)-this.xScale(1)}static _getClickCoords(){return $t?[$t.pageX,$t.pageY]:null}static _polyfillElementClosest(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=t=>{let r=this;do{if(r.matches(t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null})}createEvent(t,r=null,n=!1,a=!1,i,o,s){r&&(r=r.feature?r.feature:r);const u={eventtype:t,coords:PC._getClickCoords(),feature:r,target:s};return n&&(r&&r.fragments?u.highlight=r.fragments.map(l=>`${l.start}:${l.end}`).join(","):$t&&$t.shiftKey&&this._highlight?u.highlight=`${this._highlight},${i}:${o}`:u.highlight=i&&o?`${i}:${o}`:null),a&&(u.selectedid=r&&r.protvistaFeatureId),new CustomEvent("change",{detail:u,bubbles:!0,cancelable:!0})}bindEvents(t,r){t.on("mouseover",(n,a,i)=>{r.dispatchEvent(r.createEvent("mouseover",n,r._highlightEvent==="onmouseover",!1,n.start,n.end,i[a]))}).on("mouseout",()=>{r.dispatchEvent(r.createEvent("mouseout",null,r._highlightEvent==="onmouseover"))}).on("click",(n,a,i)=>{r.dispatchEvent(r.createEvent("click",n,r._highlightEvent==="onclick",!0,n.start,n.end,i[a]))})}}const TC=D$(PC,{initialValue:{top:10,right:10,bottom:10,left:10}}),xn=10;class lxe{getFeatureShape(t,r,n,a){return a=a||"rectangle",this._ftLength=n,this._ftHeight=r,this._ftWidth=t*n,typeof this["_"+a]!="function"&&(a="rectangle"),this["_"+a]()}static isContinuous(t){return t=t.toLowerCase(),t!=="bridge"}_rectangle(){return"M0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L0,"+this._ftHeight+"Z"}_roundRectangle(){return"M6,0h"+(this._ftWidth-2*6)+",0a6,6 0 0 1 6,6v"+(this._ftHeight-2*6)+"a6,6 0 0 1 -6,6h"+(2*6-this._ftWidth)+"a6,6 0 0 1 -6,-6v"+(2*6-this._ftHeight)+"a6,6 0 0 1 6,-6Z"}_line(){return`M0,${this._ftHeight/2} L${this._ftWidth},${this._ftHeight/2}`}_bridge(){return this._ftLength!==1?"M0,"+this._ftHeight+"L0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L"+this._ftWidth+",2L0,2Z":"M0,"+this._ftHeight+"L0,"+this._ftHeight/2+"L"+this._ftWidth/2+","+this._ftHeight/2+"L"+this._ftWidth/2+",0L"+this._ftWidth/2+","+this._ftHeight/2+"L"+this._ftWidth+","+this._ftHeight/2+"L"+this._ftWidth+","+this._ftHeight+"Z"}_getMiddleLine(t){return"M0,"+t+"L"+this._ftWidth+","+t+"Z"}_diamond(){const t=xn/2,r=this._ftWidth/2,n="M"+r+",0L"+(r+t)+","+t+"L"+r+","+xn+"L"+(r-t)+","+t;return this._ftLength!==1?n+this._getMiddleLine(t,this._ftWidth):n+"Z"}_chevron(){const t=this._ftWidth/2,r=xn/2,n="M"+t+","+r+"L"+(r+t)+",0L"+(r+t)+","+r+"L"+t+","+xn+"L"+(-r+t)+","+r+"L"+(-r+t)+",0";return this._ftLength!==1?n+"L"+t+","+r+this._getMiddleLine(r,this._ftWidth)+"Z":n+"Z"}_catFace(){const t=xn/2,r=xn/10,n=this._ftWidth/2,a="M"+(-t+n)+",0L"+(-t+n)+","+6*r+"L"+(-2*r+n)+","+xn+"L"+(2*r+n)+","+xn+"L"+(t+n)+","+6*r+"L"+(t+n)+",0L"+(2*r+n)+","+4*r+"L"+(-2*r+n)+","+4*r;return this._ftLength!==1?a+"M"+n+",0"+this._getMiddleLine(t,this._ftWidth)+"Z":a+"Z"}_triangle(){const t=xn/2,r=this._ftWidth/2,n="M"+r+",0L"+(t+r)+","+xn+"L"+(-t+r)+","+xn;return this._ftLength!==1?n+"L"+r+",0"+this._getMiddleLine(t,this._ftWidth)+"Z":n+"Z"}_wave(){const t=xn/4,r=xn/2,n=this._ftWidth/2,a="M"+(-xn/2+n)+","+r+"A"+t+","+r+" 0 1,1 "+n+","+r+"A"+t+","+r+" 0 1,0 "+(xn/2+n)+","+r;return this._ftLength!==1?a+this._getMiddleLine(r,this._ftWidth)+"Z":a+"Z"}_getPolygon(t){const r=xn/2;let n="M ";const a=this._ftWidth/2;for(let i=0;i<t;i++)n+=r*Math.cos(2*Math.PI*i/t)+a+","+(r*Math.sin(2*Math.PI*i/t)+r)+" ";return this._ftLength!==1?n+" "+(r*Math.cos(0)+a)+","+(r*Math.sin(0)+r)+" "+this._getMiddleLine(r,this._ftWidth)+"Z":n+"Z"}_hexagon(){return this._getPolygon(6)}_pentagon(){return this._getPolygon(5)}_circle(){const t=this._ftWidth/2,r=Math.sqrt(xn/Math.PI),n="M"+t+",0A"+r+","+r+" 0 1,1 "+t+","+xn+"A"+r+","+r+" 0 1,1 "+t+",0";return this._ftLength!==1?n+this._getMiddleLine(xn/2,this._ftWidth)+"Z":n+"Z"}_arrow(){const t=xn/10,r=this._ftWidth/2,n="M"+r+",0L"+(-t+r)+",0L"+(-5*t+r)+","+4*t+"L"+(-t+r)+","+this._ftHeight+"L"+r+","+this._ftHeight+"L"+(4*t+r)+","+4*t;return this._ftLength!==1?n+"L"+r+",0"+this._getMiddleLine(xn/2,this._ftWidth)+"Z":n+"Z"}_doubleBar(){const t=this._ftWidth/2,r=xn/2,n="M"+t+",0L"+(-r+t)+","+xn+"L"+t+","+xn+"L"+(r+t)+",0";return this._ftLength!==1?n+"L"+t+",0"+this._getMiddleLine(xn/2,this._ftWidth)+"Z":n+"Z"}_getBrokenEnd(){const t=this._ftHeight/4;return"L"+(this._ftWidth-t)+","+t+"L"+this._ftWidth+","+2*t+"L"+(this._ftWidth-t)+","+3*t+"L"+this._ftWidth+","+this._ftHeight}_getBrokenStart(){const t=this._ftHeight/4;return"L"+t+","+3*t+"L0,"+2*t+"L"+t+","+t}_discontinuosStart(){return"M0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L0,"+this._ftHeight+this._getBrokenStart()+"Z"}_discontinuos(){return"M0,0L"+this._ftWidth+",0"+this._getBrokenEnd()+"L0,"+this._ftHeight+this._getBrokenStart()+"Z"}_discontinuosEnd(){return"M0,0L"+this._ftWidth+",0"+this._getBrokenEnd()+"L0,"+this._ftHeight+"Z"}_helix(){const t=xn/2,r=xn/4;let n=t/2;const a=Math.round(this._ftWidth/t);let i="";for(let o=0;o<a;o++){const s="M"+(-(t/2)+n)+","+this._ftHeight+" C"+(n+r)+","+3*r+" "+(t/2+n)+","+r+" "+n+", 0 C"+(n-r)+","+r+" "+n+","+3*r+" "+(t/2+n)+","+this._ftHeight;i+=s,n+=t}return i}_strand(){let t=0;this._ftWidth>xn/2&&(t=this._ftWidth-xn/2);const r=this._ftHeight/4,n="M0,"+r+"L"+t+","+r+"L"+t+","+3*r+"L0,"+3*r+"L0,"+r,a="M"+t+",0L"+this._ftWidth+","+2*r+"L"+t+","+this._ftHeight+"Z";return n+a}}class rk{constructor({layoutHeight:t,padding:r=1,minHeight:n=17}){this._padding=r,this._minHeight=n,this._layoutHeight=t}init(t){this._features=t}getFeatureYPos(){const t=this.getFeatureHeight();return this._layoutHeight/2-t/2}getFeatureHeight(){return Math.min(this._layoutHeight,this._minHeight)-this._padding}}const cxe=(e,t)=>!(Number(t.start)>Number(e.end)||Number(t.end)<Number(e.start)),dxe=(e,t)=>t.some(r=>cxe(e,r));class fxe extends rk{constructor(t){super(t),this.featuresMap=new Map,this._rowHeight=0,this._rows=[],this._minHeight=15}init(t){t.forEach(r=>{const n=this._rows.findIndex(a=>!dxe(r,a));n>=0?(this._rows[n].push(r),this.featuresMap.set(r,n)):(this._rows.push([r]),this.featuresMap.set(r,this._rows.length-1))}),this._rowHeight=Math.min(this._layoutHeight/this._rows.length,this._minHeight)}getOffset(){return this._rows.length*this._rowHeight<this._layoutHeight?this._layoutHeight/2-this._rows.length*this._rowHeight/2:0}getFeatureYPos(t){const r=this.featuresMap.get(t);return this.getOffset()+this._rowHeight*r+2*this._padding}getFeatureHeight(){return this._rowHeight-2*this._padding}}const Ym={CHAIN:{name:"chain",label:"Chain",tooltip:"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing",shape:"rectangle",color:"#CC9933"},TRANSIT:{name:"transit peptide",label:"Transit peptide",tooltip:"This describes the extent of a transit peptide",shape:"rectangle",color:"#009966"},INIT_MET:{name:"initiator methionine",label:"Initiator methionine",tooltip:"This indicates that the initiator methionine is cleaved from the mature protein",shape:"arrow",color:"#996633"},PROPEP:{name:"propeptide",label:"Propeptide",tooltip:"Part of a protein that is cleaved during maturation or activation",shape:"rectangle",color:"#99CCCC"},PEPTIDE:{name:"peptide",label:"Peptide",tooltip:"The position and length of an active peptide in the mature protein",shape:"rectangle",color:"#006699"},SIGNAL:{name:"signal peptide",label:"Signal peptide",tooltip:"N-terminal signal peptide",shape:"rectangle",color:"#CC0033"},HELIX:{name:"helix",label:"Helix",tooltip:"The positions of experimentally determined helical regions",shape:"rectangle",color:"#FF0066"},STRAND:{name:"strand",label:"Beta strand",tooltip:"The positions of experimentally determined beta strands",shape:"rectangle",color:"#FFCC00"},TURN:{name:"turn",label:"Turn",tooltip:"The positions of experimentally determined hydrogen-bonded turns",shape:"rectangle",color:"#0571AF"},DISULFID:{name:"disulfide bond",label:"Disulfide bond",tooltip:"The positions of cysteine residues participating in disulphide bonds",shape:"bridge",color:"#23B14D"},CROSSLNK:{name:"cross-link",label:"Cross-link",tooltip:"Covalent linkages of various types formed between two proteins or between two parts of the same protein",shape:"bridge",color:"#FF6600"},REGION:{name:"region of interest",label:"Region of interest",tooltip:"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation",shape:"rectangle",color:"#B33E00"},COILED:{name:"coiled-coil region",label:"Coiled-coil region",tooltip:"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil",shape:"rectangle",color:"#006699"},MOTIF:{name:"short sequence motif",label:"Short sequence motif",tooltip:"Short conserved sequence motif of biological significance",shape:"rectangle",color:"#402060"},REPEAT:{name:"repeat",label:"Repeat",tooltip:"Repeated sequence motifs or repeated domains within the protein",shape:"rectangle",color:"#9900FF"},CA_BIND:{name:"calcium-binding region",label:"Calcium-binding region",tooltip:"Calcium-binding regions, such as the EF-hand motif",shape:"rectangle",color:"#FF3399"},DNA_BIND:{name:"DNA-binding region",label:"DNA binding",tooltip:"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain",shape:"rectangle",color:"#009933"},DOMAIN:{name:"other domain of interest",label:"Other domain of interest",tooltip:"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold",shape:"rectangle",color:"#9999FF"},ZN_FING:{name:"zinc finger region",label:"Zinc finger",tooltip:"Small, functional, independently folded domain that coordinates one or more zinc ions",shape:"rectangle",color:"#990066"},NP_BIND:{name:"nucleotide-binding region",label:"Nucleotide-binding region",tooltip:"(aka flavin-binding). Region in the protein which binds nucleotide phosphates",shape:"rectangle",color:"#FF9900"},METAL:{name:"metal ion-binding site",label:"Metal ion-binding site",tooltip:"Binding site for a metal ion",shape:"diamond",color:"#009900"},SITE:{name:"other site of interest",label:"Other site of interest",tooltip:"Any interesting single amino acid site on the sequence",shape:"chevron",color:"#660033"},BINDING:{name:"other binding site",label:"Other binding site",tooltip:"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)",shape:"rectangle",color:"#catFace"},ACT_SITE:{name:"active site",label:"Active site",tooltip:"Amino acid(s) directly involved in the activity of an enzyme",shape:"circle",color:"#FF6666"},MOD_RES:{name:"Post-translationally modified residue",label:"Modified residue",tooltip:"Modified residues such as phosphorylation, acetylation, acylation, methylation",shape:"triangle",color:"#000066"},LIPID:{name:"lipid moiety-binding region",label:"Lipidation",tooltip:"Covalently attached lipid group(s)",shape:"wave",color:"#99CC33"},CARBOHYD:{name:"glycosylation site",label:"Glycosylation",tooltip:"Covalently attached glycan group(s)",shape:"hexagon",color:"#CC3366"},COMPBIAS:{name:"compositionally biased region",label:"Compositionally biased region",tooltip:"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions",shape:"rectangle",color:"#FF3366"},CONFLICT:{name:"sequence conflict",label:"Sequence conflict",tooltip:"Sequence discrepancies of unknown origin",shape:"rectangle",color:"#6633CC"},NON_CONS:{name:"non-consecutive residues",label:"Non-adjacent residues",tooltip:"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them",shape:"doubleBar",color:"#FF0033"},NON_TER:{name:"non-terminal residue",label:"Non-terminal residue",tooltip:"The sequence is incomplete. The residue is not the terminal residue of the complete protein",shape:"doubleBar",color:"#339933"},UNSURE:{name:"unsure residue",label:"Sequence uncertainty",tooltip:"Regions of a sequence for which the authors are unsure about the sequence assignment",shape:"rectangle",color:"#33FF00"},NON_STD:{name:"non-standard amino acid",label:"Non-standard residue",tooltip:"Non-standard amino acids (selenocysteine and pyrrolysine)",shape:"pentagon",color:"#330066"},MUTAGEN:{name:"mutagenesis site",label:"Mutagenesis",tooltip:"Site which has been experimentally altered by mutagenesis",shape:"rectangle",color:"#FF9900"},TOPO_DOM:{name:"topological domain",label:"Topological domain",tooltip:"Location of non-membrane regions of membrane-spanning proteins",shape:"rectangle",color:"#CC0000"},TRANSMEM:{name:"transmembrane region",label:"Transmembrane",tooltip:"Extent of a membrane-spanning region",shape:"rectangle",color:"#CC00CC"},INTRAMEM:{name:"intramembrane region",label:"Intramembrane",tooltip:"Extent of a region located in a membrane without crossing it",shape:"rectangle",color:"#0000CC"},VAR_SEQ:{name:"splice variant",label:"Splice variant",tooltip:"",shape:"rectangle",color:"#CC11CC"},VARIANT:{name:"sequence variant",label:"Natural variant",tooltip:"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events",shape:"circle",color:"black"},UNIQUE:{name:"unique",label:"Unique peptide",tooltip:"",shape:"rectangle",color:"#fc3133"},NON_UNIQUE:{name:"non-unique",label:"Non-unique peptide",tooltip:"",shape:"rectangle",color:"#8585fc"},ANTIGEN:{name:"antigen",label:"Antibody binding sequences",tooltip:"",shape:"rectangle",color:"#996699"},PDBE_COVER:{name:"pdbe coverage",label:"PDBe 3D structure coverage",tooltip:"",shape:"rectangle",color:"#669966"}},zB=e=>{if(Ym[e.toUpperCase()])return Ym[e.toUpperCase()].shape;const t=Object.values(Ym).find(r=>r.name.toUpperCase()===e.toUpperCase());return t?t.shape:"rectangle"},VB=e=>{if(Ym[e.toUpperCase()])return Ym[e.toUpperCase()].color;const t=Object.values(Ym).find(r=>r.name.toUpperCase()===e.toUpperCase());return t||console.log(e),t?t.color:"black"};class Bp extends TC{getLayout(){return String(this.getAttribute("layout")).toLowerCase()==="non-overlapping"?new fxe({layoutHeight:this._height}):new rk({layoutHeight:this._height})}connectedCallback(){super.connectedCallback(),this._color=this.getAttribute("color"),this._shape=this.getAttribute("shape"),this._featureShape=new lxe,this._layoutObj=this.getLayout(),this._data&&this._createTrack(),this.addEventListener("load",t=>{Qye(this.children,t.target)&&(this.data=t.detail.payload)})}static normalizeLocations(t){return t.map(r=>{const{locations:n,start:a,end:i}=r;return n?r:Object.assign(r,{locations:[{fragments:[{start:a,end:i}]}]})})}processData(t){this._originalData=Bp.normalizeLocations(t)}set data(t){this.processData(t),this._applyFilters(),this._layoutObj=this.getLayout(),this._createTrack()}set filters(t){this._filters=t,this._applyFilters(),this._createTrack()}static get observedAttributes(){return TC.observedAttributes.concat(["highlight","color","shape","filters"])}_getFeatureColor(t){return t.color?t.color:t.feature&&t.feature.color?t.feature.color:this._color?this._color:t.type?VB(t.type):t.feature&&t.feature.type?VB(t.feature.type):"black"}_getFeatureFillColor(t){return t.fill?t.fill:t.feature&&t.feature.fill?t.feature.fill:this._getFeatureColor(t)}_getShape(t){return t.shape?t.shape:t.feature&&t.feature.shape?t.feature.shape:this._shape?this._shape:t.type?zB(t.type):t.feature&&t.feature.type?zB(t.feature.type):"rectangle"}_createTrack(){this._layoutObj.init(this._data),Ga(this).selectAll("div").remove(),this.svg=Ga(this).append("div").style("line-height",0).append("svg").attr("width",this.width).attr("height",this._height),this.trackHighlighter.appendHighlightTo(this.svg),this.seq_g=this.svg.append("g").attr("class","sequence-features"),this._createFeatures()}_createFeatures(){this.featuresG=this.seq_g.selectAll("g.feature-group").data(this._data),this.locations=this.featuresG.enter().append("g").attr("class","feature-group").attr("id",n=>`g_${n.accession}`).selectAll("g.location-group").data(n=>n.locations.map(a=>Object.assign({},a,{feature:n}))).enter().append("g").attr("class","location-group");const t=this.locations.selectAll("g.fragment-group").data(n=>n.fragments.map(a=>Object.assign({},a,{feature:n.feature}))).enter().append("g").attr("class","fragment-group");t.append("path").attr("class",n=>`${this._getShape(n)} feature`).attr("d",n=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(n),n.end?n.end-n.start+1:1,this._getShape(n))).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill",n=>this._getFeatureFillColor(n)).attr("stroke",n=>this._getFeatureColor(n)).style("fill-opacity",({feature:n})=>n.opacity?n.opacity:.9).style("stroke-opacity",({feature:n})=>n.opacity?n.opacity:.9);const r=t.selectAll("g.residue-group").data(n=>{var a;return n.feature.ptms?[(a=n.feature.ptms)==null?void 0:a.map(i=>Object.assign({},i,{feature:n.feature,position:i.position}))]:[]}).enter().append("g").attr("class","residue-group");t.append("rect").attr("class","outer-rectangle feature").attr("width",n=>this.getSingleBaseWidth()*(n.end?n.end-n.start+1:1)).attr("height",n=>this._layoutObj.getFeatureHeight(n)).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill","transparent").attr("stroke","transparent").call(this.bindEvents,this),r.selectAll("g.residue").data(n=>n).enter().append("path").attr("class",n=>`${this._getShape(n)} residue`).attr("d",n=>{let a=1;return this.length>500&&(a=this.getSingleBaseWidth()<4?4:1),this._featureShape.getFeatureShape(this.getSingleBaseWidth()/2,this._layoutObj.getFeatureHeight(),a,this._getShape(n))}).attr("transform",n=>`translate(${this.getXFromSeqPosition(Number(n.feature.start)+Number(n.position)-1)+this.getSingleBaseWidth()/4},
          ${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill","#06038D").style("fill-opacity",({feature:n})=>n.opacity?n.opacity:.9).style("stroke-opacity",({feature:n})=>n.opacity?n.opacity:.9).call(this.bindEvents,this)}_applyFilters(){if(!this._filters||this._filters.length<=0){this._data=this._originalData;return}const t=xg(this._filters,"category"),r=Object.values(t).map(a=>{const i=a.map(o=>o.filterFn(this._originalData));return rX(...i)}),n=nX(...r);this._data=n}refresh(){if(this.xScale&&this.seq_g){const t=this.seq_g.selectAll("g.fragment-group").data(this._data.reduce((n,a)=>n.concat(a.locations.reduce((i,o)=>i.concat(o.fragments.map(s=>Object.assign({},s,{feature:a}))),[])),[])),r=this.seq_g.selectAll("g.residue-group").data(this._data.reduce((n,a)=>{var i;return n.concat([(i=a.ptms)==null?void 0:i.reduce(o=>o.concat(s=>Object.assign({},s,{feature:a,position:s.position})),[])])},[]));t.selectAll("path.feature").attr("d",n=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(n),n.end?n.end-n.start+1:1,this._getShape(n))).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`),r.selectAll("path.residue").attr("d",n=>{let a=1;return this.length>500&&(a=this.getSingleBaseWidth()<4?4:1),this._featureShape.getFeatureShape(this.getSingleBaseWidth()/2,this._layoutObj.getFeatureHeight(n),a,this._getShape(n))}).attr("transform",n=>`translate(${this.getXFromSeqPosition(Number(n.feature.start)+Number(n.position)-1)+this.getSingleBaseWidth()/4},${this._layoutObj.getFeatureYPos(n.feature)})`),t.selectAll("rect.outer-rectangle").attr("width",n=>this.getSingleBaseWidth()*(n.end?n.end-n.start+1:1)).attr("height",n=>this._layoutObj.getFeatureHeight(n)).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`),this._updateHighlight()}}_updateHighlight(){this.trackHighlighter.updateHighlight()}}const HB=16,hxe=14,R2=10;class Vy extends rk{init(t,r){let n=0;if(this.height={},this.yPos={},this.maxYPos=0,!t)return;this.innerPadding=(HB-R2)/2;const a={};for(let i=0;i<t.length;i++){const o=t[i];this.height[o.accession]=this.expanded?hxe:HB,this.yPos[o.accession]=this._padding,n=this.height[o.accession]+2*this._padding,this.maxYPos=Math.max(this.maxYPos,n),o.accession in a||(a[o.accession]={}),o.residues&&(n=this._initResidues(o.residues,o.accession,o.locations,this.expanded?n:this.yPos[o.accession],i,a,this.expanded))}if(r)for(let i=0;i<r.length;i++){const o=r[i];o.accession in this.height||(this.height[o.accession]=R2,this.yPos[o.accession]=(this.expanded?this.maxYPos:this.innerPadding)+this._padding,n+=2*this._padding+(this.expanded?this.height[o.accession]:0),this.maxYPos=Math.max(this.maxYPos,n)),o.accession in a||(a[o.accession]={}),o.residues&&(n=this._initResidues(o.residues,o.accession,o.locations,o.expanded?n:this.yPos[o.accession],i,a,o.expanded))}this.maxYPos+=this._padding}_initResidues(t,r,n,a,i,o={},s=!0){for(let u=0;u<t.length;u++){const l=t[u];Vy._filterOutResidueFragmentsOutOfLocation(l,n),l.accession in o[r]||(o[r][l.accession]={});for(let c=0;c<l.locations.length;c++){const d=l.locations[c].description;d in o[r][l.accession]||(o[r][l.accession][d]={height:s?R2:this.height[r]-2*this.innerPadding,yPos:s?this.maxYPos+this._padding:a+this.innerPadding},a=s?this.maxYPos+2*this._padding+R2:a),this.height[`${l.accession}_${i}_${u}_${c}`]=o[r][l.accession][d].height,this.yPos[`${l.accession}_${i}_${u}_${c}`]=o[r][l.accession][d].yPos,this.maxYPos=Math.max(this.maxYPos,a)}}return s?a:this.maxYPos+2*this._padding}static _filterOutResidueFragmentsOutOfLocation(t,r){t.locations.forEach(n=>n.fragments=n.fragments.filter(a=>r.some(i=>i.fragments.some(o=>a.start>=o.start&&a.end<=o.end)))),t.locations=t.locations.filter(n=>n.fragments.length)}static _getAccFromFeature(t){let r="";return typeof t=="string"?r=t:t.accession&&(r=t.accession),r}getFeatureYPos(t){const r=Vy._getAccFromFeature(t);return r in this.yPos?this.yPos[r]:0}getFeatureHeight(t){const r=Vy._getAccFromFeature(t);return r in this.height?this.height[r]:0}}const GB=(e,t)=>{let r={value:1,...e};const n=[];for(const a of t)r?r.end<a.start?(n.push(r),r=null,n.push(a)):r.start<a.start&&r.end>=a.end?(n.push({start:r.start,end:a.start-1,value:r.value}),n.push({start:a.start,end:a.end,value:a.value+r.value}),r=a.end===r.end?null:{start:a.end+1,end:r.end,value:r.value}):a.start<r.start&&a.end>r.end?(n.push({start:a.start,end:r.start-1,value:a.value}),n.push({start:r.start,end:r.end,value:a.value+r.value}),n.push({start:r.end+1,end:a.end,value:a.value}),r=null):a.end>=r.start&&a.end<=r.end?(a.start<r.start&&n.push({start:a.start,end:r.start-1,value:a.value}),n.push({start:r.start,end:a.end,value:a.value+r.value}),r=a.end<r.end?{start:a.end+1,end:r.end,value:r.value}:null):r.end>=a.start&&r.end<a.end?(n.push({start:r.start,end:a.start-1,value:r.value}),n.push({start:a.start,end:r.end,value:a.value+r.value}),n.push({start:r.end+1,end:a.end,value:a.value}),r=null):n.push(a):n.push(a);return r&&n.push(r),n},pxe=(e,t=100,r=!0)=>{let n=[];return r&&(n=GB({start:1,end:t,value:0},n)),e.forEach(a=>a.locations.forEach(i=>i.fragments.forEach(o=>{n=GB(o,n)}))),n},N0={top:2,right:10,bottom:2,left:10},qB=.8,WB=.3,vxe=e=>(e+WB)/(1+WB);class Hy extends Bp{_createTrack(){this._layoutObj.expanded=this._expanded,super._createTrack(),this.children_g=null}connectedCallback(){super.connectedCallback(),this._expanded=this.hasAttribute("expanded"),this._haveCreatedFeatures=!1}attributeChangedCallback(t,r,n){if(t==="expanded"&&r!==n&&this._contributors)for(const a of this._contributors)a.expanded=!r;super.attributeChangedCallback(t,r,n)}set contributors(t){this._contributors=Hy.normalizeLocations(t),this._coverage=pxe(this._contributors,this._length),this._data&&this._createTrack()}getLayout(){return new Vy({layoutHeight:this._height,expanded:this._expanded,padding:2})}static get observedAttributes(){return Bp.observedAttributes.concat(["expanded","color"])}set color(t){this._color!==t&&(this._color=t,this.refresh())}static _createResidueGroup(t){return t.selectAll("g.residues-group").data(r=>r.residues?r.residues.map((n,a)=>({...n,feature:r,i:a})):[]).enter().append("g").attr("class","residues-group").selectAll("g.residues-locations").data(r=>r.locations.map((n,a)=>({...n,accession:r.accession,feature:r.feature,location:n,i:r.i,j:a}))).enter().append("g").attr("class","residues-locations")}_createResiduePaths(t){return t.selectAll("g.residue").data(r=>r.fragments.map(n=>({...n,accession:r.accession,feature:{...r.feature,currentResidue:{...n,description:r.location.description}},location:r.location,k:r.feature.k,i:r.i,j:r.j}))).enter().append("path").attr("class","feature rectangle residue").attr("d",r=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(`${r.accession}_${r.k}_${r.i}_${r.j}`),r.end?r.end-r.start+1:1,"rectangle")).attr("transform",r=>`translate(${this.getXFromSeqPosition(r.start)},${N0.top+this._layoutObj.getFeatureYPos(`${r.accession}_${r.k}_${r.i}_${r.j}`)})`).attr("fill",r=>this._getFeatureColor(r)).attr("stroke","transparent").call(this.bindEvents,this)}_refreshResiduePaths(t,r){const n=new Set(t.data().map(a=>`${a.feature.accession}-${a.location.description}`)).size;t.attr("d",a=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(`${a.accession}_${a.k}_${a.i}_${a.j}`),a.end?a.end-a.start+1:1,"rectangle")).attr("transform",a=>`translate(${this.getXFromSeqPosition(a.start)},${N0.top+this._layoutObj.getFeatureYPos(`${a.accession}_${a.k}_${a.i}_${a.j}`)})`).style("pointer-events",a=>r||a.feature&&a.feature.expanded?"auto":"none").style("stroke",()=>r?null:"none").style("opacity",()=>r?null:qB/n).attr("fill",a=>r||a.feature&&a.feature.expanded?this._getFeatureColor(a):"white")}_createFeatures(){if(this._layoutObj.init(this._data,this._contributors),this._data.forEach((t,r)=>t.k=r),this.featuresG=this.seq_g.selectAll("g.feature-group").data(this._data).enter().append("g").attr("class","feature-group").attr("id",t=>`g_${t.accession}`),this.locations=this.featuresG.selectAll("g.location-group").data(t=>t.locations.map(r=>({...r,feature:t}))).enter().append("g").attr("class","location-group"),this.coverLines=this.locations.selectAll("line.cover").data(t=>[t.fragments.reduce((r,n)=>({start:Math.min(r.start,n.start),end:Math.max(r.end,n.end),feature:t.feature}),{start:1/0,end:-1/0})]).enter().append("line").attr("class","cover"),this.features=this.locations.selectAll("path.feature").data(t=>t.fragments.map(r=>({...r,feature:t.feature,fragments:t.fragments}))).enter().append("path").attr("class",t=>`${this._getShape(t)} feature`).on("click.expanded",()=>{this._expanded?this.removeAttribute("expanded"):this.setAttribute("expanded","expanded")}).call(this.bindEvents,this),this.residues_g=Hy._createResidueGroup(this.featuresG),this.residues_loc=this._createResiduePaths(this.residues_g),this._contributors){this._contributors.forEach((r,n)=>r.k=n),this.children_g||(this.children_g=this.svg.append("g").attr("class","children-features")),this.childrenGroup=this.children_g.append("g").attr("class","children-group"),this.childGroup=this.childrenGroup.selectAll("g.child-group").data(this._contributors).enter().append("g").attr("class","child-group");const t=this.childGroup.selectAll("g.child-location-group").data(r=>(r.expanded=this._expanded,r.locations.map(n=>({...n,feature:r})))).enter().append("g").attr("class",(r,n)=>`child-location-group clg-${n}`);this.coverLinesChildren=t.selectAll("line.cover").data(r=>[r.fragments.reduce((n,a)=>({start:Math.min(n.start,a.start),end:Math.max(n.end,a.end),feature:r.feature}),{start:1/0,end:-1/0})]).enter().append("line").attr("class","cover"),this.featureChildren=t.selectAll("path.child-fragment").data(r=>r.fragments.map(n=>({...n,feature:r.feature,fragments:r.fragments}))).enter().append("path").attr("class",r=>`${this._getShape(r)} child-fragment feature`).call(this.bindEvents,this).on("click.expanded",r=>{r.feature.expanded=!r.feature.expanded,this.refresh()}),this.child_residues_g=Hy._createResidueGroup(this.childGroup),this.child_residues_loc=this._createResiduePaths(this.child_residues_g),this._coverage&&this._coverage.length&&this._createCoverage()}this.svg.attr("height",this._layoutObj.maxYPos),this._haveCreatedFeatures=!0}_createCoverage(){this._accession=this._data&&this._data[0]&&this._data[0].accession||"_",this.coverage_mask=this.svg.append("defs").append("mask").attr("id",`mask-${this._accession}`),this.coverageMaskFragment=this.coverage_mask.selectAll("rect").data(this._coverage).enter().append("rect").attr("y",0).attr("height",this._height)}_refreshCoverage(){this.featuresG.attr("mask",this._expanded?null:`url(#mask-${this._accession})`),this.coverageMaskFragment.attr("x",t=>this.getXFromSeqPosition(t.start)).attr("width",t=>this.getSingleBaseWidth()*(t.end-t.start+1)).attr("fill","white").attr("opacity",t=>vxe(t.value/this._contributors.length))}_refreshFeatures(t,r=!0){const n=new Set(t.data().map(a=>a.feature.accession)).size;t.attr("d",a=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(a.feature),a.end?a.end-a.start+1:1,r?this._getShape(a.shape?a:a.feature):"rectangle")).attr("fill",a=>r?this._getFeatureColor(a.feature):"white").attr("opacity",r?1:qB/n).style("stroke",a=>r?this._getFeatureColor(a.feature):"none").attr("transform",a=>`translate(${this.getXFromSeqPosition(a.start)},${N0.top+this._layoutObj.getFeatureYPos(a.feature)})`).style("pointer-events",r?"auto":"none")}_refreshCoverLine(t,r=!0){t.attr("x1",n=>this.getXFromSeqPosition(n.start)).attr("x2",n=>this.getXFromSeqPosition(n.end+1)).attr("y1",n=>N0.top+this._layoutObj.getFeatureYPos(n.feature)+this._layoutObj.getFeatureHeight(n.feature)/2).attr("y2",n=>N0.top+this._layoutObj.getFeatureYPos(n.feature)+this._layoutObj.getFeatureHeight(n.feature)/2).attr("stroke",n=>this._getFeatureColor(n.feature)).attr("visibility",r?"visible":"hidden")}refresh(){this._haveCreatedFeatures&&(this._layoutObj.expanded=this._expanded,this._layoutObj.init(this._data,this._contributors),this.height=this._layoutObj.maxYPos,this._refreshCoverLine(this.coverLines),this._refreshFeatures(this.features),this._refreshResiduePaths(this.residues_loc,this._expanded),this._contributors&&(this.childrenGroup.attr("visibility",this._expanded?"visible":"hidden"),this._refreshCoverLine(this.coverLinesChildren,this._expanded),this._refreshFeatures(this.featureChildren,this._expanded),this.child_residues_g.attr("visibility",()=>this._expanded?"visible":"hidden"),this._refreshResiduePaths(this.child_residues_loc),this._coverage&&this._coverage.length&&this._refreshCoverage()),this._updateHighlight(),this.svg.attr("height",this._layoutObj.maxYPos))}}const mxe=3;class gxe extends TC{connectedCallback(){super.connectedCallback(),this.sequence=this.getAttribute("sequence");const t=this.getAttribute("numberofticks");this.numberOfTicks=Number.isInteger(parseInt(t,10))?t:mxe,this.sequence&&this._createSequence(),this.addEventListener("load",r=>{this.data=r.detail.payload})}static get observedAttributes(){return TC.observedAttributes.concat("highlightstart","highlightend")}get data(){return this.sequence}set data(t){typeof t=="string"?this.sequence=t:"sequence"in t&&(this.sequence=t.sequence),this.sequence&&!super.svg?this._createSequence():this.refresh()}_getCharSize(){if(!this.seq_g)return;const t=.8,r=1.6,n=this.seq_g.select("text.base").node();if(n)this.chWidth=n.getBBox().width*t,this.chHeight=n.getBBox().height*r;else{const a=this.seq_g.append("text").attr("class","base").text("T");this.chWidth=a.node().getBBox().width*t,this.chHeight=a.node().getBBox().height*r,a.remove()}}_createSequence(){Ga(this).selectAll("div").remove(),super.svg=Ga(this).append("div").attr("class","").append("svg").attr("id","").attr("width",this.width).attr("height",this._height),this.seq_bg=super.svg.append("g").attr("class","background"),this.axis=super.svg.append("g").attr("class","x axis"),this.seq_g=super.svg.append("g").attr("class","sequence").attr("transform",`translate(0,${.75*this._height})`),this.trackHighlighter.appendHighlightTo(this.svg),this.refresh()}refresh(){if(this._getCharSize(),this.axis){const t=this.getSingleBaseWidth(),r=t-this.chWidth,n=t/2,a=Math.round(Math.max(0,this._displaystart-2)),i=Math.round(Math.min(this.sequence.length,this._displayend+1)),o=r<0?[]:this.sequence.slice(a,i).split("").map((s,u)=>({start:1+a+u,end:1+a+u,aa:s}));this.height>this.chHeight&&(this.xAxis=LW(this.xScale).tickFormat(s=>Number.isInteger(s)?s:"").ticks(this.numberOfTicks,"s"),this.axis.call(this.xAxis)),this.axis.attr("transform",`translate(${this.margin.left+n},0)`),this.axis.select(".domain").remove(),this.axis.selectAll(".tick line").remove(),this.bases=this.seq_g.selectAll("text.base").data(o,s=>s.start),this.bases.enter().append("text").attr("class","base").attr("text-anchor","middle").attr("x",s=>this.getXFromSeqPosition(s.start)+n).text(s=>s.aa).style("pointer-events","none").style("font-family","monospace"),this.bases.exit().remove(),this.bases.attr("x",s=>this.getXFromSeqPosition(s.start)+n),this.background=this.seq_bg.selectAll("rect.base_bg").data(o,s=>s.start),this.background.enter().append("rect").attr("class","base_bg feature").attr("height",this._height).merge(this.background).attr("width",t).attr("fill",s=>Math.round(s.start)%2?"#ccc":"#eee").attr("x",s=>this.getXFromSeqPosition(s.start)).call(this.bindEvents,this),this.background.exit().remove(),this.seq_g.style("opacity",Math.min(1,r)),this.background.style("opacity",Math.min(1,r)),this._updateHighlight()}}_updateHighlight(){this.trackHighlighter.updateHighlight()}}function yxe(e){const{variants:t,sequence:r}=e;if(!r||!t)return null;const a=r.split("").map((i,o)=>({type:"VARIANT",normal:i,pos:o+1,variants:[]}));return t.forEach(i=>{a[i.start-1]&&a[i.start-1].variants.push(i)}),a}class bxe{constructor(){this._frequency=_$().exponent(.001).domain([0,1]).range([5,10]),this.drawVariationPlot=this.drawVariationPlot.bind(this)}drawVariationPlot(t,r){const a=r.getSingleBaseWidth()/2;t.each((i,o,s)=>{const u=Ga(s[o]),l=i.filter(f=>f.variants.length!==0),c=u.selectAll("g").data(l,f=>f.pos);c.exit().remove();const d=c.enter().append("g").merge(c).selectAll("circle").data(f=>f.variants);d.exit().remove(),d.enter().append("circle").merge(d).attr("class","feature").attr("title",f=>f.start).attr("r",f=>f.size?f.size:5).attr("cx",f=>r.getXFromSeqPosition(f.start)+a).attr("cy",f=>r._yScale(f.variant.charAt(0))).attr("name",f=>{const h=f.alternativeSequence==="*"?"STOP":f.alternativeSequence;return f.internalId=`var_${f.wildType}${f.start}${h}`,f.internalId}).attr("fill",f=>f.color?f.color:r._colorConfig(f)).call(r.bindEvents,r)})}}const xxe=["G","A","V","L","I","S","T","C","M","D","N","E","Q","R","K","H","F","Y","W","P","d","*"],$B=(e,t)=>{if(!e||e.length<=0)return null;const r=e[0];return r.forEach((n,a)=>{const i=e.map(o=>o[a].variants);n.variants=t(...i)}),r};class nk extends Bp{connectedCallback(){super.connectedCallback();const t=document.createElement("style");t.innerHTML=nk.css,this.appendChild(t),this._height=Number(this.getAttribute("height"))?Number(this.getAttribute("height")):430,this._width=this._width?this._width:0,this._yScale=Eb(),this._yScale=Ege().domain(xxe).range([0,this._height-this.margin.top-this.margin.bottom])}processData(t){this._originalData=yxe(t)}static get css(){return`
    <style>
    protvista-variation {
      display: flex;
      width: 100%;
    }
    
    protvista-variation svg {
      background-color: #fff;
    }
    
    protvista-variation circle {
      opacity: 0.6;
    }
    protvista-variation circle:hover {
      opacity: 0.9;
    }
    protvista-variation .tick line,
    protvista-variation .axis path {
      opacity: 0.1;
    }
    
    .protvista-highlight {
      fill: #ffe999;
    }
    
    protvista-variation .variation-y-right line,
    protvista-variation .axis path {
      fill: none;
      stroke: none;
    }
    
    </style>
    `}_createFeatures(){this._variationPlot=new bxe;const t=super.svg.select("g.sequence-features"),r=t.attr("transform",`translate(0, ${this.margin.top})`).append("g");this._series=r.datum(this._data),this._axisLeft=t.append("g"),this._axisRight=t.append("g"),this.updateScale()}set filters(t){super.filters=t,this.updateData(this._data),this.refresh()}_applyFilters(){if(!this._filters||this._filters.length<=0){this._data=this._originalData;return}const t=xg(this._filters,"category"),r=Object.values(t).map(n=>{const a=n.map(i=>i.filterFn(this._originalData));return $B(a,rX)});this._data=$B(r,nX)}set colorConfig(t){this._colorConfig=t}get colorConfig(){return this._colorConfig}refresh(){this._series&&(this.updateScale(),this._series.call(this._variationPlot.drawVariationPlot,this),this._updateHighlight())}updateScale(){this._yAxisLScale=Xhe().scale(this._yScale).tickSize(-this.getWidthWithMargins()),this._yAxisRScale=$he().scale(this._yScale),this._axisLeft.attr("class","variation-y-left axis").attr("transform",`translate(${this.margin.left},0)`).call(this._yAxisLScale),this._axisRight.attr("transform",`translate(${this.getWidthWithMargins()-this.margin.right+2}, 0)`).attr("class","variation-y-right axis").call(this._yAxisRScale)}updateData(t){this._series&&this._series.datum(t)}}class Sxe extends Bp{constructor(){super(),this._line=Bge().x((t,r)=>this.getXFromSeqPosition(r+1)-this.getSingleBaseWidth()/2).y(t=>this._yScale(t))}init(){this._totalsArray={total:null,diseaseTotal:null}}connectedCallback(){super.connectedCallback(),this._data=void 0,this._height=Number(this.getAttribute("height"))||40,this._yScale=Eb(),this.init()}set data(t){if(this.init(),!(!t.sequence||t.variants.length<=0)){this._totalsArray.total=new Uint8ClampedArray(t.sequence.length),this._totalsArray.diseaseTotal=new Uint8ClampedArray(t.sequence.length);for(const{start:r,association:n}of t.variants){const a=+r;if(a<1||a>t.sequence.length||(this._totalsArray.total[a]++,!n))continue;n.find(o=>o.disease===!0)&&this._totalsArray.diseaseTotal[a]++}this._createTrack()}}_createTrack(){Ga(this).selectAll("svg").remove(),this.svg=Ga(this).append("svg").attr("width",this.width).attr("height",this._height),this.trackHighlighter.appendHighlightTo(this.svg),this._initYScale(),this.refresh()}_initYScale(){this._yScale.domain([0,Math.max(C6(this._totalsArray.total),C6(this._totalsArray.diseaseTotal))]).range([this._height,0])}refresh(){this.svg&&(this.svg.selectAll("path").remove(),this.svg.append("path").attr("d",this._line(this._totalsArray.diseaseTotal)).attr("fill","none").attr("stroke","red").attr("transform","translate(0,0)"),this.svg.append("path").attr("d",this._line(this._totalsArray.total)).attr("fill","none").attr("stroke","darkgrey").attr("transform","translate(0,0)"),this._updateHighlight())}}class Cxe extends ph{static get properties(){return{filters:{type:Array},selectedFilters:{type:Set},for:{type:String}}}constructor(){super(),this.filters=[],this.selectedFilters=new Set}connectedCallback(){super.connectedCallback(),this.addEventListener("filterChange",this._onFilterChange),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this))}disconnectedCallback(){super.disconnectedCallback(),this.manager&&this.manager.unregister(this),this.removeEventListener("filterChange",this._onFilterChange)}static get styles(){return Qs`
      :host {
        font-size: 0.8rem;
      }

      :host[disabled] {
        opacity: 0.5;
      }

      .protvista_checkbox {
        position: relative;
        cursor: pointer;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        margin-top: 10px;
        line-height: 24px;
        outline: none;
      }

      .protvista_checkbox_input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }

      .checkmark {
        opacity: 0.4;
        height: 25px;
        width: 25px;
        background-color: #eee;
        border-radius: 4px;
        box-sizing: border-box;
        border: 1px solid #bdc3c7;
      }

      .protvista_checkbox_input:checked ~ .checkmark {
        opacity: 1;
      }

      .protvista_checkbox_label {
        margin-left: 0.2rem;
        line-height: 1rem;
      }
    `}render(){const t=xg(this.filters,r=>r.type.text);return Vr`
      ${Object.keys(t).map(r=>Vr`
            <h4>${r}</h4>
            <div>
              ${t[r].map(n=>Vr`
                    ${this.getCheckBox(n)}
                  `)}
            </div>
          `)}
    `}getCheckBox(t){const{name:r,options:n}=t,{labels:a}=n;n.colors.length==null&&(n.colors=[n.colors]);const i=n.colors.length>1;return Vr`
      <label
        class="protvista_checkbox ${i?"compound":""}"
        tabindex="0"
      >
        <input
          type="checkbox"
          class="protvista_checkbox_input"
          ?checked="true"
          .value="${r}"
          @change="${()=>this.toggleFilter(r)}"
        />
        <span
          class="checkmark"
          style=${`background: ${i?`
            linear-gradient(${n.colors[0]},
            ${n.colors[1]})
          `:n.colors[0]};`}
        ></span>
        <span class="protvista_checkbox_label">
          ${a.join("/")}
        </span>
      </label>
    `}toggleFilter(t){this.selectedFilters.has(t)?this.selectedFilters.delete(t):this.selectedFilters.add(t),this.dispatchEvent(new CustomEvent("change",{bubbles:!0,composed:!0,detail:{type:"filters",handler:"property",for:this.for,value:this.filters.filter(r=>this.selectedFilters.has(r.name)).map(r=>({category:r.type.name,filterFn:r.filterData}))}}))}}const k2="length",O2="displaystart",L2="displayend",N2="highlight";class IC extends HTMLElement{constructor(){super(),this.protvistaElements=new Set,this.attributeValues=new Map,this.propertyValues=new Map,this.mouseOver=!1}static get observedAttributes(){return["attributes",k2,O2,L2,N2]}set length(t){this.attributeValues.set(k2,t)}get length(){return this.attributeValues.get(k2)}set displaystart(t){this.attributeValues.set(O2,t)}get displaystart(){return this.attributeValues.get(O2)}set displayend(t){this.attributeValues.set(L2,t)}get displayend(){return this.attributeValues.get(L2)}set highlight(t){this.attributeValues.set(N2,t)}get highlight(){return this.attributeValues.get(N2)}attributeChangedCallback(t,r,n){if(r!==n){if(t==="attributes"){if(this._attributes=n.split(" "),this._attributes.indexOf("type")!==-1)throw new Error("'type' can't be used as a protvista attribute");if(this._attributes.indexOf("value")!==-1)throw new Error("'value' can't be used as a protvista attribute");this.attributeValues=new Map(this._attributes.filter(a=>!IC.observedAttributes.includes(a)).map(a=>[a,null]))}else t===k2&&(this.length=n),t===O2&&(this.displaystart=n),t===L2&&(this.displayend=n),t===N2&&(this.highlight=n);this.applyAttributes()}}register(t){this.protvistaElements.add(t),this.applyAttributes()}unregister(t){this.protvistaElements.delete(t)}_polyfillElementClosest(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=t=>{let r=this;do{if(r.matches(t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null})}applyAttributes(){this.protvistaElements.forEach(t=>{this.attributeValues.forEach((r,n)=>{r===!1||r===null||r===void 0?t.removeAttribute(n):t.setAttribute(n,typeof r=="boolean"?"":r)})})}applyProperties(t){if(t){const r=this.querySelector(`#${t}`);this.propertyValues.forEach((n,a)=>{r[a]=n})}else this.protvistaElements.forEach(r=>{this.propertyValues.forEach((n,a)=>{r[a]=n})})}isRegisteredAttribute(t){return[...this.attributeValues.keys()].includes(t)||IC.observedAttributes.includes(t)}_changeListener(t){if(t.detail)switch(t.detail.handler){case"property":this.propertyValues.set(t.detail.type,t.detail.value),this.applyProperties(t.detail.for);break;default:this.isRegisteredAttribute(t.detail.type)&&this.attributeValues.set(t.detail.type,t.detail.value),Object.keys(t.detail).forEach(r=>{this.isRegisteredAttribute(r)&&this.attributeValues.set(r,t.detail[r])}),this.applyAttributes()}}connectedCallback(){this.addEventListener("change",this._changeListener)}}var _xe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const zA=new Map,lX=(e,t=new Headers({accept:"application/json"}))=>{const r=zA.get(e);if(r)return r;const n=(()=>_xe(void 0,void 0,void 0,function*(){const a=yield window.fetch(e,{headers:t});if(!a.ok)throw new Error(`Request Failed: Status = ${a.status}; URI = ${e}; Time = ${new Date}`);return a.status===204?{payload:null,headers:a.headers}:{payload:yield a.json(),headers:a.headers}}))();return zA.set(e,n),n.catch(()=>zA.delete(e)),n};var F2,wxe=new Uint8Array(16);function Exe(){if(!F2&&(F2=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!F2))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return F2(wxe)}const Axe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Pxe(e){return typeof e=="string"&&Axe.test(e)}var ci=[];for(var VA=0;VA<256;++VA)ci.push((VA+256).toString(16).substr(1));function Txe(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(ci[e[t+0]]+ci[e[t+1]]+ci[e[t+2]]+ci[e[t+3]]+"-"+ci[e[t+4]]+ci[e[t+5]]+"-"+ci[e[t+6]]+ci[e[t+7]]+"-"+ci[e[t+8]]+ci[e[t+9]]+"-"+ci[e[t+10]]+ci[e[t+11]]+ci[e[t+12]]+ci[e[t+13]]+ci[e[t+14]]+ci[e[t+15]]).toLowerCase();if(!Pxe(r))throw TypeError("Stringified UUID is invalid");return r}var XB,HA,GA=0,qA=0;function r3(e,t,r){var n=t&&r||0,a=t||new Array(16);e=e||{};var i=e.node||XB,o=e.clockseq!==void 0?e.clockseq:HA;if(i==null||o==null){var s=e.random||(e.rng||Exe)();i==null&&(i=XB=[s[0]|1,s[1],s[2],s[3],s[4],s[5]]),o==null&&(o=HA=(s[6]<<8|s[7])&16383)}var u=e.msecs!==void 0?e.msecs:Date.now(),l=e.nsecs!==void 0?e.nsecs:qA+1,c=u-GA+(l-qA)/1e4;if(c<0&&e.clockseq===void 0&&(o=o+1&16383),(c<0||u>GA)&&e.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");GA=u,qA=l,HA=o,u+=122192928e5;var d=((u&268435455)*1e4+l)%4294967296;a[n++]=d>>>24&255,a[n++]=d>>>16&255,a[n++]=d>>>8&255,a[n++]=d&255;var f=u/4294967296*1e4&268435455;a[n++]=f>>>8&255,a[n++]=f&255,a[n++]=f>>>24&15|16,a[n++]=f>>>16&255,a[n++]=o>>>8|128,a[n++]=o&255;for(var h=0;h<6;++h)a[n+h]=i[h];return t||Txe(a)}const Ixe=[{name:"ECO:0000269",description:"Manual assertion based on experiment",shortDescription:"Publication",acronym:"EXP",isManual:!0},{name:"ECO:0000303",description:"Manual assertion based on opinion",shortDescription:"Publication",acronym:"NAS",isManual:!0},{name:"ECO:0000305",description:"Manual assertion inferred by curator",shortDescription:"Curated",acronym:"IC",isManual:!0},{name:"ECO:0000250",description:"Manual assertion inferred from sequence similarity",shortDescription:"By similarity",acronym:"ISS",isManual:!0},{name:"ECO:0000255",description:"Manual assertion according to rules",shortDescription:"Sequence Analysis",acronym:"ISM",isManual:!0},{name:"ECO:0007744",description:"Manual assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXM",isManual:!0},{name:"ECO:0000312",description:"Manual assertion inferred from database entries",shortDescription:"Imported",acronym:"MI",isManual:!0},{name:"ECO:0000256",description:"Automatic assertion according to rules",shortDescription:"Automatic annotation",acronym:"AA"},{name:"ECO:0000259",description:"Automatic assertion inferred from signature match",shortDescription:"Automatic annotation",acronym:"AA"},{name:"ECO:0007829",description:"Automatic assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXA"},{name:"ECO:0000213",description:"Automatic assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXA"},{name:"ECO:0000244",description:"Manual assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXM",isManual:!0},{name:"ECO:0000313",description:"Automatic assertion inferred from database entries",shortDescription:"Imported",acronym:"AI"},{name:"ECO:0000260",description:"Manual assertion inferred from signature match",shortDescription:"InterPro annotation",acronym:"SGNM",isManual:!0}],cX=e=>e.map(t=>{const r={};return t.begin&&(r.start=t.begin),{...t,...r}}),Mxe=e=>{var t;return((t=e.name)==null?void 0:t.toLowerCase())==="PubMed".toLowerCase()?`${e.id}&nbsp;(<a href='${e.url}' style="color:#FFF" target='_blank'>${e.name}</a>&nbsp;<a href='${e.alternativeUrl}' style="color:#FFF" target='_blank'>EuropePMC</a>)`:`&nbsp;<a href='${e.url}' style="color:#FFF" target='_blank'>${e.id}</a>&nbsp;${e.name?`(${e.name})`:""}`},dX=e=>e?`
      <ul>${e.map(t=>{const r=Ixe.find(n=>n.name===t.code);return r?`<li title='${r.description}' style="padding: .25rem 0">${r.shortDescription}:&nbsp;${t.source?Mxe(t.source):""}</li>`:""}).join("")}</ul>
    `:"",fX=e=>`<ul>${e.map(t=>`<li style="padding: .25rem 0">${t.name} ${t.url?`<a href="${t.url}" style="color:#FFF" target="_blank">${t.id}</a>`:`${t.name} ${t.id}`}</li>`).join("")}</ul>`,Dxe=e=>{if(!e)return"";const t=e.flatMap(({dbReferences:a})=>a.map(i=>i.id)),r=[...new Set(t.flat())],n="https://www.ebi.ac.uk/pride/archive/projects/";return`
  <ul>${r.map(a=>{const i=a==="Glue project"?"PXD012174":a;return`<li title='${i}' style="padding: .25rem 0">${i}&nbsp;(<a href="${n}${i}" style="color:#FFF" target="_blank">PRIDE</a>
      ${a==="Glue project"?')</li><li title="publication" style="padding: .25rem 0">Publication:&nbsp;31819260&nbsp;(<a href="https://pubmed.ncbi.nlm.nih.gov/31819260" style="color:#FFF" target="_blank">PubMed</a>)</li>':'&nbsp;<a href="http://www.peptideatlas.org/builds/rice/phospho/" style="color:#FFF" target="_blank">PeptideAtlas</a>)</li>'}`}).join("")}</ul>
`},Rxe=(e,t)=>{if(!t)return"";const r=t.map(i=>({name:i.name,position:i.position}));let n="",a=0;return r.forEach(i=>{n=`${n}${e.slice(a,i.position)}[${i.name}]`,a=i.position}),n=`${n}${e.slice(a)}`,`<p>${n}</p>`},kxe={A:"alanine",S:"serine",T:"threonine",Y:"tyrosine"},YB=(e,t)=>{const{peptide:r,begin:n}=e,a=Number(n)+t.position-1,i=r.charAt(t.position-1);return`${a} phospho${kxe[i]}`},hX=e=>{const t=e.type==="PROTEOMICS_PTM"?Dxe(e.ptms):dX(e.evidences),r=e.type==="PROTEOMICS_PTM"&&e.ptms.map(a=>YB(e,a)),n=e.type==="PROTEOMICS_PTM"&&e.ptms.flatMap(({dbReferences:a})=>a.map(i=>i.id));try{return`
      ${e.description?`<h5>Description</h5><p>${e.description}</p>`:""}
      ${e.matchScore?`<h5>Match score</h5><p>${e.matchScore}%</p>`:""}
      ${e.ftId?`<h5>Feature ID</h5><p>${e.ftId}</p>`:""}
      ${e.alternativeSequence?`<h5>Alternative sequence</h5><p>${e.alternativeSequence}</p>`:""}
      ${r?`<h5 data-article-id="ptm_processing_section">PTMs</h5><ul>${r.map(a=>`<li>${a}</li>`).join("")}</ul>
            `:""}
      ${e.peptide&&e.type==="PROTEOMICS_PTM"?`<h5 data-article-id="mod_res_large_scale#what-is-the-goldsilverbronze-criterion">Peptidoform</h5><p>${Rxe(e.peptide,e.ptms)}</p>`:""}
      ${e.peptide&&e.type!=="PROTEOMICS_PTM"?`<h5>Peptide</h5><p>${e.peptide}</p>`:""} 
      ${e.xrefs?`<h5>Cross-references</h5>${fX(e.xrefs)}`:""}
      ${t?`<h5>Evidence</h5>${t}`:""}
      ${e.ptms&&n&&!n.includes("Glue project")?`<hr /><h5 data-article-id="mod_res_large_scale#what-is-the-goldsilverbronze-criterion">PTM statistical attributes</h5><ul>${e.ptms.map(a=>a.dbReferences.map(i=>`<li><b>${i.id}</b></li>
                      <li style="text-indent: 1em"><b>${YB(e,a)}</b></li>
                      <li style="text-indent: 2em">PubMed ID: <a href="https://europepmc.org/article/MED/${i.properties["Pubmed ID"]}" style="color:#FFF" target="_blank">
                      ${i.properties["Pubmed ID"]}</a>
                      </li>
                      <li style="text-indent: 2em"><span data-article-id="mod_res_large_scale#confidence-score">Confidence score</span>: ${i.properties["Confidence score"]}</li>
                      <li style="text-indent: 2em">Universal Spectrum Id: 
                      <a href="http://proteomecentral.proteomexchange.org/usi/?usi=${i.properties["Universal Spectrum Id"]}" style="color:#FFF" target="_blank">View on ProteomeXchange</a>
                      </li>
                      <li style="text-indent: 2em">PSM Count: ${i.properties["PSM Count"]}</li>
                      <li style="text-indent: 2em">Site probability: ${i.properties["Site probability"]}</li>
                      `).join("")).join("")}</ul>`:""}
        `}catch(a){return console.error(a),""}},Oxe=e=>{let t=[];const{features:r}=e;return r&&r.length>0&&(t=r.map(n=>({...n,tooltipContent:hX(n),protvistaFeatureId:r3()})),t=cX(t)),t},Lxe=e=>{let t=[];return e&&e.length!==0&&(t=e.features.map(r=>Object.assign(r,{category:"PROTEOMICS",type:r.unique?"unique":"non_unique",tooltipContent:hX(r),protvistaFeatureId:r3()})),t=cX(t)),t},Nxe="PDBE_COVER",Fxe="STRUCTURE_COVERAGE",Bxe=e=>e.charAt(0).toUpperCase()+e.slice(1),Uxe=e=>Object.keys(e).reduce((t,r)=>`${t}${Bxe(r)}: ${e[r]}. `,""),jxe=e=>{const t=e.indexOf("="),r=e.indexOf("-");return t===-1||r===-1?{start:0,end:0}:{start:+e.slice(t+1,r),end:+e.slice(r+1)}},zxe=e=>e.dbReferences.filter(t=>t.type==="PDB").map(t=>{const r=t.properties.chains?jxe(t.properties.chains):{start:0,end:0};return{type:Nxe,category:Fxe,structures:[{description:Uxe(t.properties),start:r.start,end:r.end,source:{id:t.id,url:`http://www.ebi.ac.uk/pdbe-srv/view/entry/${t.id}`}}],start:r.start,end:r.end}}),Vxe=e=>{if(!e||e.length<=0)return[];const t=e.sort((n,a)=>n.start-a.start),r=[];return t.forEach(n=>{const a=r[r.length-1];!a||a.end<n.start?r.push(n):(a.end<n.end&&(a.end=n.end),a.structures.push(n.structures[0]))}),r},Hxe=e=>`<ul>
            ${e.map(t=>`<li style="margin: 0.25rem 0"><a style="color:#FFF" href='${t.source.url}' target='_blank'>
            ${t.source.id}
        </a> (${t.start}-${t.end})</li>`).join("")}
        </ul>`,Gxe=e=>{const t=Hxe(e.structures);return`${t?`<h5>Structures</h5>${t}`:""}`},qxe=e=>{let t=[];if(e&&e.length!==0){const r=zxe(e);t=Vxe(r),t.forEach(n=>{n.tooltipContent=Gxe(n),n.protvistaFeatureId=r3()})}return t},Wxe=e=>e==null?void 0:e.map(t=>`
              <h4>Disease association</h4><p>${t.name}</p>
              ${t.description?`<>${t.description}</p>`:""}
              ${t.dbReferences?`<h5>Cross-references</h5>${fX(t.dbReferences)}`:""}
              ${dX(t.evidences)}
          `).join(""),$xe=e=>`<hr/><h5>Description</h5>${e.map(t=>`<p>${t.value}</p>`).join("")}
  `,Xxe=e=>`<hr/><h5>Population frequencies</h5>${e.map(t=>`<p>${t.frequency} - ${t.populationName} (${t.source})</p>`).join("")}`,Yxe=e=>{if(e.locations.some(r=>r.source==="EnsemblViruses")){const r=e.xrefs.find(n=>n.name==="ENA");return r.id?`<h5>Ensembl COVID-19</h5>
          <p>
          <a href="https://covid-19.ensembl.org/Sars_cov_2/Variation/Explore?v=${r.id}" target="_blank" rel="noopener noreferrer">${r.id}</a>
        </p>`:""}return""},Kxe=e=>{const t=xg(e,"predAlgorithmNameType");return Object.keys(t).map(n=>{const a=xg(t[n],"predictionValType");return{algorithm:n,values:Object.keys(a).map(i=>({name:i,count:a[i].length}))}}).map(n=>`<h6>${n.algorithm}</h6><ul class="no-bullet">${n.values.map(a=>`<li>${a.name}</li>`).join("")}</ul>`).join("")},Qxe=e=>`
                <h5>Variant</h5><p>${e.wildType} > ${e.alternativeSequence||""}</p>
                ${e.populationFrequencies?Xxe(e.populationFrequencies):""}
                ${e.consequenceType?`<h5>Consequence</h5><p>${e.consequenceType}</p>`:""}
                ${e.somaticStatus?`<h5>Somatic</h5><p>${e.somaticStatus===0?"No":"Yes"}</p>`:""}
                ${e.genomicLocation?`<h5>Location</h5><p>${e.genomicLocation}</p>`:""}
                ${e.ftId?`<h5>Feature ID</h5><p>${e.ftId}</p>`:""}
                ${e.descriptions?$xe(e.descriptions):""}
                ${e.association?Wxe(e.association):""}
                ${e.predictions?Kxe(e.predictions):""}
                ${Yxe(e)}
                
        `;var VI;(function(e){e.A="A",e.C="C",e.D="D",e.E="E",e.Empty="*",e.F="F",e.G="G",e.H="H",e.I="I",e.K="K",e.L="L",e.M="M",e.N="N",e.Nl="NL",e.P="P",e.Q="Q",e.R="R",e.S="S",e.T="T",e.V="V",e.W="W",e.Y="Y"})(VI||(VI={}));var KB;(function(e){e.CLINVAR="ClinVar",e.ESP="ESP",e.EXAC="ExAC",e.GENOMES1K="1000Genomes",e.BOVINE_SNP50="BovineSNP50",e.BOVINE_LD="BovineLD",e.BOVINE_HD="BovineHD",e.EQUINE_SNP50="EquineSNP50",e.CHICKEN_600K="Chicken600K",e.KG_HQ="1kg_hq",e.COSMIC="cosmic curated",e.REVIEWED="reviewed",e.UNIPROT="UniProt",e.DBSNP="dbSNP",e.ENSEMBL="Ensembl",e.ENSEMBL_PLANTS="EnsemblPlants",e.VECTORBASE="VectorBase",e.REFSEQ="RefSeq",e.DBGAP="dbGaP",e.DDD="DDD",e.PHARMCOGKB="PharmGKB",e.ENSEMBL_FUNGI="EnsemblFungi",e.ENSEMBL_METAZOA="EnsemblMetazoa",e.GNOMAD_V2="gnomAD_v2.0",e.GNOMAD_V3="gnomAD_v3.0",e.TCGA="NCI-TCGA",e.TCGA_COSMIC="NCI-TCGA Cosmic",e.DECIPHER="ddG2P",e.TOPMED="TOPMed",e.GNOMAD="gnomAD",e.PHARMGKB="pharmgkb",e.SGRP="SGRP",e.SGD="SGD",e.JEFFARES_SNPS="Jeffares_SNPs",e.JEFFARES_INDELS="Jeffares_Indels",e.ENSEMBL_VIRUSES="EnsemblViruses"})(KB||(KB={}));var QB;(function(e){e.Benign="Benign",e.Disease="Disease",e.LikelyBenign="Likely benign",e.LikelyPathogenic="Likely pathogenic",e.Pathogenic="Pathogenic",e.Protective="Protective",e.VariantOfUncertainSignificance="Variant of uncertain significance"})(QB||(QB={}));var ZB;(function(e){e.Empty="-",e.Frameshift="frameshift",e.InframeDeletion="inframe deletion",e.Insertion="insertion",e.Missense="missense",e.StopGained="stop gained"})(ZB||(ZB={}));var JB;(function(e){e.PolyPhen="PolyPhen",e.Sift="SIFT"})(JB||(JB={}));var e8;(function(e){e.Benign="benign",e.Deleterious="deleterious",e.DeleteriousLowConfidence="deleterious - low confidence",e.PossiblyDamaging="possibly damaging",e.ProbablyDamaging="probably damaging",e.Tolerated="tolerated",e.ToleratedLowConfidence="tolerated - low confidence",e.Unknown="unknown"})(e8||(e8={}));var t8;(function(e){e.LargeScaleStudy="large_scale_study",e.Mixed="mixed",e.UniProt="uniprot"})(t8||(t8={}));const Zxe=(e,t)=>{const r=e?e.map(n=>n.name):[];return(t==="uniprot"||t==="mixed")&&r.push("uniprot"),r},Jxe=e=>{const{sequence:t,features:r}=e,n=r.map(a=>Object.assign(Object.assign({},a),{accession:a.genomicLocation,variant:a.alternativeSequence?a.alternativeSequence:VI.Empty,start:a.begin,xrefNames:Zxe(a.xrefs,a.sourceType),hasPredictions:a.predictions&&a.predictions.length>0,tooltipContent:Qxe(a),protvistaFeatureId:r3()}));return n?{sequence:t,variants:n}:null},eSe=e=>{try{return e.results.map(({metadata:t,proteins:r})=>({...t,locations:r[0].entry_protein_locations,start:Math.min(...r[0].entry_protein_locations.map(n=>Math.min(...n.fragments.map(a=>a.start)))),end:Math.max(...r[0].entry_protein_locations.map(n=>Math.max(...n.fragments.map(a=>a.end)))),tooltipContent:`
        <h5>Accession</h5>
        <a
          target="_blank"
          rel="noopener"
          href="https://www.ebi.ac.uk/interpro/entry/InterPro/${t.accession}/"
        >
        ${t.accession}
        </a>
        <h5>Name</h5>
        <p>${t.name}</p>
      `,length:r[0].protein_length}))}catch{throw new Error("Failed transforming the data")}};var HI;(function(e){e.Gold="#c39b00",e.Silver="#8194a1",e.Bronze="#a65708"})(HI||(HI={}));const r8={R:"Phosphoarginine",C:"Phosphocysteine",H:"Phosphohistidine",S:"Phosphoserine",T:"Phosphothreonine",Y:"Phosphotyrosine"},tSe=e=>{const t=e.toUpperCase();return t in r8?r8[t]:(console.error(`${t} not a valid amino acid for phosphorylation`),"")},rSe=(e,t,r)=>{const n=[...e.flatMap(({dbReferences:s})=>s==null?void 0:s.flatMap(({id:u})=>[u]))],a=new Set(e.flatMap(({dbReferences:s})=>s==null?void 0:s.map(({properties:u})=>u["Confidence score"])));let i;a.size?a.size>1?console.error(`PTM has a mixture of confidence scores: ${Array.from(a)}`):[i]=a:console.log("PTM has no confidence score");const o=`
  <h5>Description</h5><p>${tSe(t)}</p>
  ${i?`<h5 data-article-id="mod_res_large_scale#confidence-score">Confidence Score</h5><p>${i}</p>`:""}
  ${n?`<h5>Evidence</h5><ul>${n.map(s=>{const u=s==="Glue project"?"PXD012174":s;return`<li title='${u}' style="padding: .25rem 0">${u}&nbsp;
              (<a href="https://www.ebi.ac.uk/pride/archive/projects/${s}" style="color:#FFF" target="_blank">PRIDE</a>)
              </li>
              ${s==="Glue project"?'<li title="publication" style="padding: .25rem 0">Publication:&nbsp;31819260&nbsp;(<a href="https://pubmed.ncbi.nlm.nih.gov/31819260" style="color:#FFF" target="_blank">PubMed</a>)</li>':""}
              `}).join("")}</ul>`:""}
  `;return{source:"PTMeXchange",type:"MOD_RES_LS",start:r,end:r,shape:"triangle",tooltipContent:o,color:HI[i]||"black"}},nSe=e=>{if(e){const{features:t}=e,r={};if(t){for(const n of t)for(const a of n.ptms){const i=+n.begin+a.position-1;if(!Number.isFinite(i)){console.error(`Encountered infinite number: +feature.begin + ptm.position - 1 = ${+n.begin} + ${a.position} - 1`);continue}const o=n.peptide[a.position-1];i in r?r[i].aa!==o?console.error(`One PTM has different amino acid values: [${r[i].aa}, ${o}]`):r[i].ptms.push(a):r[i]={ptms:[a],aa:o}}return Object.entries(r).map(([n,{ptms:a,aa:i}])=>rSe(a,i,+n))}}return[]},aSe=[{name:"DOMAINS_AND_SITES",label:"Domains & sites",trackType:"protvista-track",tracks:[{name:"domain",label:"Domain",filter:"DOMAIN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold"},{name:"region",label:"Region",filter:"REGION",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation"},{name:"motif",label:"Motif",filter:"MOTIF",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Short conserved sequence motif of biological significance"},{name:"metal",label:"Metal binding",filter:"METAL",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Binding site for a metal ion"},{name:"site",label:"Site",filter:"SITE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Any interesting single amino acid site on the sequence"},{name:"repeat",label:"Repeat",filter:"REPEAT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Repeated sequence motifs or repeated domains within the protein"},{name:"ca_bind",label:"Calcium binding",filter:"CA_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Calcium-binding regions, such as the EF-hand motif"},{name:"dna_bind",label:"DNA binding",filter:"DNA_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain"},{name:"zn_fing",label:"Zinc finger",filter:"ZN_FING",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Small, functional, independently folded domain that coordinates one or more zinc ions"},{name:"np_bind",label:"Nucleotide binding",filter:"NP_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"(aka flavin-binding). Region in the protein which binds nucleotide phosphates"},{name:"binding",label:"Binding site",filter:"BINDING",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)"},{name:"act_site",label:"Active site",filter:"ACT_SITE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Amino acid(s) directly involved in the activity of an enzyme"}]},{name:"MOLECULE_PROCESSING",label:"Molecule processing",trackType:"protvista-track",tracks:[{name:"signal",label:"Signal peptide",filter:"SIGNAL",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"N-terminal signal peptide"},{name:"chain",label:"Chain",filter:"CHAIN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing"},{name:"transit",label:"Transit peptide",filter:"TRANSIT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"This describes the extent of a transit peptide"},{name:"init_met",label:"Initiator methionine",filter:"INIT_MET",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"This indicates that the initiator methionine is cleaved from the mature protein"},{name:"propep",label:"Propeptide",filter:"PROPEP",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Part of a protein that is cleaved during maturation or activation"},{name:"peptide",label:"Peptide",filter:"PEPTIDE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The position and length of an active peptide in the mature protein"}]},{name:"PTM",label:"PTM",trackType:"protvista-track",tracks:[{name:"mod_res",label:"Modified residue",filter:"MOD_RES",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Modified residues such as phosphorylation, acetylation, acylation, methylation"},{name:"mod_res_ls",label:"Modified residue (large scale data)",filter:"MOD_RES_LS",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-ptm-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"}],tooltip:"Modified residues from Large scale studies"},{name:"carbohyd",label:"Glycosylation",filter:"CARBOHYD",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalently attached glycan group(s)"},{name:"disulfid",label:"Disulfide bond",filter:"DISULFID",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of cysteine residues participating in disulphide bonds"},{name:"crosslnk",label:"Cross-link",filter:"CROSSLNK",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalent linkages of various types formed between two proteins or between two parts of the same protein"},{name:"lipid",label:"Lipidation",filter:"LIPID",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalently attached lipid group(s)"}]},{name:"SEQUENCE_INFORMATION",label:"Sequence information",trackType:"protvista-track",tracks:[{name:"compbias",label:"Compositional bias",filter:"COMPBIAS",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions"},{name:"conflict",label:"Sequence conflict",filter:"CONFLICT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Sequence discrepancies of unknown origin"},{name:"non_cons",filter:"NON_CONS",trackType:"protvista-track",label:"Non-adjacent residues",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them"},{name:"non_ter",filter:"NON_TER",trackType:"protvista-track",label:"Non-terminal residue",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The sequence is incomplete. The residue is not the terminal residue of the complete protein"},{name:"unsure",filter:"UNSURE",trackType:"protvista-track",label:"Sequence uncertainty",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Regions of a sequence for which the authors are unsure about the sequence assignment"},{name:"non_std",filter:"NON_STD",trackType:"protvista-track",label:"Non-standard residue",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Non-standard amino acids (selenocysteine and pyrrolysine)"}]},{name:"STRUCTURAL",label:"Structural features",trackType:"protvista-track",tracks:[{name:"helix",label:"Helix",filter:"HELIX",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined helical regions"},{name:"strand",label:"Beta strand",filter:"STRAND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined beta strands"},{name:"turn",label:"Turn",filter:"TURN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined hydrogen-bonded turns"},{name:"coiled",label:"Coiled coil",filter:"COILED",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil"}]},{name:"STRUCTURE_COVERAGE",label:"PDBe 3D structure coverage",trackType:"protvista-track",tracks:[{name:"pdbe_cover",label:"PDBe coverage",trackType:"protvista-track",tooltip:"PDBe 3D structure coverage",data:[{adapter:"protvista-structure-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteins/{accession}"}]}]},{name:"TOPOLOGY",label:"Topology",trackType:"protvista-track",tracks:[{name:"topo_dom",label:"Topological domain",filter:"TOPO_DOM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Location of non-membrane regions of membrane-spanning proteins"},{name:"transmem",label:"Transmembrane",filter:"TRANSMEM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Extent of a membrane-spanning region"},{name:"intramem",label:"Intramembrane",filter:"INTRAMEM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Extent of a region located in a membrane without crossing it"}]},{name:"MUTAGENESIS",label:"Mutagenesis",trackType:"protvista-track",tracks:[{name:"mutagen",label:"Mutagenesis",filter:"MUTAGEN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Site which has been experimentally altered by mutagenesis"},{name:"othermutagen",label:"Other Mutagenesis",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/mutagenesis/{accession}"}],tooltip:"Site which has been experimentally altered by mutagenesis"}]},{name:"PROTEOMICS",label:"Proteomics",trackType:"protvista-track",adapter:"protvista-proteomics-adapter",urls:["https://www.ebi.ac.uk/proteins/api/proteomics/{accession}","https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"],tracks:[{name:"unique",label:"Unique peptide",filter:"unique",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics/{accession}"}],tooltip:""},{name:"non_unique",label:"Non-unique peptide",filter:"non_unique",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics/{accession}"}],tooltip:""},{name:"proteomics-ptm",label:"PTM-containing peptide",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"}],tooltip:""}]},{name:"ANTIGEN",label:"Antigenic sequences",trackType:"protvista-track",tracks:[{name:"antigen",label:"Antibody binding sequences",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/antigen/{accession}"}],tooltip:""}]},{name:"VARIATION",label:"Variants",trackType:"protvista-variation-graph",tracks:[{name:"variation",filterComponent:"protvista-filter",trackType:"protvista-variation",data:[{adapter:"protvista-variation-adapter",url:"https://www.ebi.ac.uk/proteins/api/variation/{accession}"}],tooltip:"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events"}]}],iSe=[{type:"features",url:"https://www.ebi.ac.uk/proteins/api/features/"},{type:"variants",url:"https://www.ebi.ac.uk/proteins/api/variation/"},{type:"antigens",url:"https://www.ebi.ac.uk/proteins/api/antigen/"},{type:"proteomics",url:"https://www.ebi.ac.uk/proteins/api/proteomics/"}],oSe={categories:aSe,download:iSe};var sSe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const WA=new Map,n8=(e,t=new Headers({accept:"application/json"}))=>{const r=WA.get(e);if(r)return r;const n=(()=>sSe(void 0,void 0,void 0,function*(){const a=yield window.fetch(e,{headers:t});if(!a.ok)throw new Error(`Request Failed: Status = ${a.status}; URI = ${e}; Time = ${new Date}`);return a.status===204?{payload:null,headers:a.headers}:{payload:yield a.json(),headers:a.headers}}))();return WA.set(e,n),n.catch(()=>WA.delete(e)),n};function uSe(e,t){var r=-1,n=Ab(e)?Array(e.length):[];return V$(e,function(a,i,o){n[++r]=t(a,i,o)}),n}function lSe(e,t){var r=Jo(e)?Pb:uSe;return r(e,Q$(t))}function a8(e,t){return tk(lSe(e,t),1)}typeof window<"u"&&function(){window.console=window.console||{};for(var e=window.console,t,r,n={},a=function(){},i="memory".split(","),o="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");t=i.pop();)e[t]||(e[t]=n);for(;r=o.pop();)e[r]||(e[r]=a)}();typeof window.HTMLCanvasElement<"u"&&!window.HTMLCanvasElement.prototype.toBlob&&Object.defineProperty(window.HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,r){for(var n=window.atob(this.toDataURL(t,r).split(",")[1]),a=n.length,i=a>>2,o=new Uint8Array(a),s=new Uint32Array(o.buffer,0,i),u=0,l=0;l<i;l++)s[l]=n.charCodeAt(u++)|n.charCodeAt(u++)<<8|n.charCodeAt(u++)<<16|n.charCodeAt(u++)<<24;for(var c=a&3;c--;)o[u]=n.charCodeAt(u++);e(new window.Blob([o],{type:t||"image/png"}))}});Math.cbrt=Math.cbrt||function(e){var t=Math.pow(Math.abs(e),.3333333333333333);return e<0?-t:t};Math.sign||(Math.sign=function(e){return e=+e,e===0||isNaN(e)?Number(e):e>0?1:-1});Number.isInteger||(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t});Number.isNaN||(Number.isNaN=function(t){return t!==t});Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e==null)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),r=!1,n,a=1;a<arguments.length;a++){var i=arguments[a];if(i!=null){for(var o=Object.keys(Object(i)),s=0,u=o.length;s<u;s++){var l=o[s];try{var c=Object.getOwnPropertyDescriptor(i,l);c!==void 0&&c.enumerable&&(t[l]=i[l])}catch(d){r||(r=!0,n=d)}}if(r)throw n}}return t}});String.prototype.startsWith||function(){var e=function(){var n;try{var a={},i=Object.defineProperty;n=i(a,a,a)&&i}catch{}return n}(),t={}.toString,r=function(n){if(this===null)throw TypeError();var a=String(this);if(n&&t.call(n)==="[object RegExp]")throw TypeError();var i=a.length,o=String(n),s=o.length,u=arguments.length>1?arguments[1]:void 0,l=u?Number(u):0;Number.isNaN(l)&&(l=0);var c=Math.min(Math.max(l,0),i);if(s+c>i)return!1;for(var d=-1;++d<s;)if(a.charCodeAt(c+d)!==o.charCodeAt(d))return!1;return!0};e?e(String.prototype,"startsWith",{value:r,configurable:!0,writable:!0}):String.prototype.startsWith=r}();String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length),t-=e.length;var n=r.indexOf(e,t);return n!==-1&&n===t});String.prototype.repeat||(String.prototype.repeat=function(e){if(this===null)throw new TypeError("can't convert "+this+" to object");var t=""+this;if(e=+e,Number.isNaN(e)&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),t.length===0||e===0)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var r="";(e&1)===1&&(r+=t),e>>>=1,e!==0;)t+=t;return r});String.prototype.includes||(String.prototype.includes=function(e,t){return typeof t!="number"&&(t=0),t+e.length>this.length?!1:this.indexOf(e,t)!==-1});Array.prototype.includes||(Array.prototype.includes=function(e){if(this==null)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),r=parseInt(t.length,10)||0;if(r===0)return!1;var n=parseInt(arguments[1],10)||0,a;n>=0?a=n:(a=r+n,a<0&&(a=0));for(var i;a<r;){if(i=t[a],e===i||Number.isNaN(e)&&Number.isNaN(i))return!0;a++}return!1});Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(i){return typeof i=="function"||e.call(i)==="[object Function]"},r=function(i){var o=Number(i);return isNaN(o)?0:o===0||!isFinite(o)?o:(o>0?1:-1)*Math.floor(Math.abs(o))},n=Math.pow(2,53)-1,a=function(i){var o=r(i);return Math.min(Math.max(o,0),n)};return function(o){var s=this,u=Object(o);if(o==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");var l=arguments.length>1?arguments[1]:void 0,c;if(typeof l<"u"){if(!t(l))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(c=arguments[2])}for(var d=a(u.length),f=t(s)?Object(new s(d)):new Array(d),h=0,v;h<d;)v=u[h],l?f[h]=typeof c>"u"?l(v,h):l.call(c,v,h):f[h]=v,h+=1;return f.length=d,f}}());typeof window<"u"&&function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var a=new Date().getTime(),i=Math.max(0,16-(a-e)),o=window.setTimeout(function(){var s=a+i;n(s)},i);return e=a+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})}();Function.prototype.name===void 0&&Object.defineProperty!==void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});typeof window<"u"&&(window.performance===void 0&&(window.performance={}),window.performance.now===void 0&&function(){var e=Date.now();window.performance.now=function(){return Date.now()-e}}());Object.defineProperty!==void 0&&(Number.MAX_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MAX_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:Math.pow(2,53)-1}),Number.MIN_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MIN_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:-(Math.pow(2,53)-1)}));Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),r=t.length,n=new Array(r);r--;)n[r]=[t[r],e[t[r]]];return n});Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null)throw TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if(typeof e!="function")throw TypeError("predicate must be a function");for(var n=arguments[1],a=0;a<r;){var i=t[a];if(e.call(n,i,a,t))return i;a++}},configurable:!0,writable:!0});Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(this==null)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,n=arguments[1],a=n>>0,i=a<0?Math.max(r+a,0):Math.min(a,r),o=arguments[2],s=o===void 0?r:o>>0,u=s<0?Math.max(r+s,0):Math.min(s,r);i<u;)t[i]=e,i++;return t}});Array.prototype.copyWithin||Object.defineProperty(Array.prototype,"copyWithin",{value:function(e,t){if(this==null)throw new TypeError("this is null or not defined");var r=Object(this),n=r.length>>>0,a=e>>0,i=a<0?Math.max(n+a,0):Math.min(a,n),o=t>>0,s=o<0?Math.max(n+o,0):Math.min(o,n),u=arguments[2],l=u===void 0?n:u>>0,c=l<0?Math.max(n+l,0):Math.min(l,n),d=Math.min(c-s,n-i),f=1;for(s<i&&i<s+d&&(f=-1,s+=d-1,i+=d-1);d>0;)s in r?r[i]=r[s]:delete r[i],s+=f,i+=f,d--;return r},configurable:!0,writable:!0});Int8Array.prototype.copyWithin||Object.defineProperty(Int8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int16Array.prototype.copyWithin||Object.defineProperty(Int16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int32Array.prototype.copyWithin||Object.defineProperty(Int32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint8Array.prototype.copyWithin||Object.defineProperty(Uint8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint16Array.prototype.copyWithin||Object.defineProperty(Uint16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint32Array.prototype.copyWithin||Object.defineProperty(Uint32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float32Array.prototype.copyWithin||Object.defineProperty(Float32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float64Array.prototype.copyWithin||Object.defineProperty(Float64Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});var GI=function(e,t){return GI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},GI(e,t)};function Be(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");GI(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var E=function(){return E=Object.assign||function(t){for(var r,n=1,a=arguments.length;n<a;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},E.apply(this,arguments)};function de(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})}function fe(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(r=0)),r;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,a=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Ut(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,i;n<a;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}var mi;(function(e){function t(a){return a}e.create=t;function r(a,i){return(a&i)!==0}e.has=r;function n(a,i){return!!i&&(a&i)===i}e.hasAll=n})(mi||(mi={}));var Rr;(function(e){function t(S){return S===void 0&&(S=512),{current:[],offset:0,capacity:S,chunks:[]}}e.create=t;function r(S){return S.chunks.length?(S.offset>0&&(S.chunks[S.chunks.length]=S.current.length===S.offset?S.current.join(""):S.current.slice(0,S.offset).join("")),S.chunks.join("")):S.current.length===S.offset?S.current.join(""):S.current.splice(0,S.offset).join("")}e.getString=r;function n(S){for(var x=0,C=0,w=S.chunks;C<w.length;C++){var A=w[C];x+=A.length}for(var I=0;I<S.offset;I++)x+=S.current[I].length;return x}e.getSize=n;function a(S){return S.offset>0&&(S.current.length===S.offset?S.chunks[S.chunks.length]=S.current.join(""):S.chunks[S.chunks.length]=S.current.slice(0,S.offset).join(""),S.offset=0),S.chunks}e.getChunks=a;var i=[];(function(){for(var S="",x=0;x<512;x++)i[x]=S,S=S+" "})();function o(S){c(S,`
`)}e.newline=o;function s(S,x){x>0&&c(S,i[x])}e.whitespace=s;function u(S){c(S," ")}e.whitespace1=u;function l(S,x){x&&(S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=x)}e.write=l;function c(S,x){S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=x}e.writeSafe=c;function d(S,x,C){if(!x){s(S,C);return}var w=C-x.length;s(S,w),c(S,x)}e.writePadLeft=d;function f(S,x,C){if(!x){s(S,C);return}var w=C-x.length;c(S,x),s(S,w)}e.writePadRight=f;function h(S,x){c(S,""+x)}e.writeInteger=h;function v(S,x){c(S,""+x+" ")}e.writeIntegerAndSpace=v;function p(S,x,C){var w=""+x,A=C-w.length;s(S,A),c(S,w)}e.writeIntegerPadLeft=p;function g(S,x,C){var w=""+x,A=C-w.length;c(S,w),s(S,A)}e.writeIntegerPadRight=g;function m(S,x,C){c(S,""+Math.round(C*x)/C)}e.writeFloat=m;function y(S,x,C,w){var A=""+Math.round(C*x)/C,I=w-A.length;s(S,I),c(S,A)}e.writeFloatPadLeft=y;function b(S,x,C,w){var A=""+Math.round(C*x)/C,I=w-A.length;c(S,A),s(S,I)}e.writeFloatPadRight=b})(Rr||(Rr={}));var kn=function(){if(typeof window<"u"&&window.performance){var e=window.performance;return function(){return e.now()}}else return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();function dS(e,t){if(t===void 0&&(t=!0),isNaN(e))return"n/a";for(var r=Math.floor(e/(60*60*1e3)),n=Math.floor(e/(60*1e3)%60),a=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();i.length<3;)i="0"+i;for(;!t&&i.length>1&&i[i.length-1]==="0";)i=i.substr(0,i.length-1);return r>0?r+"h"+n+"m"+a+"."+i+"s":n>0?n+"m"+a+"."+i+"s":a>0?a+"."+i+"s":e.toFixed(0)+"ms"}var pn;(function(e){var t=typeof btoa<"u"?btoa:function(o){return Buffer.from(o).toString("base64")},r=[];function n(){for(var o=+new Date+kn(),s=0;s<16;s++)r[s]=String.fromCharCode((o+Math.random()*255)%255|0),o=Math.floor(o/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}e.create22=n;function a(){var o=+new Date+kn(),s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var l=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(u==="x"?l:l&3|8).toString(16)});return s}e.createv4=a;function i(o){return typeof o=="string"}e.is=i})(pn||(pn={}));function cSe(e,t){return e-t}function dSe(e){return Array.prototype.sort.call(e,cSe),e}var i8;(function(e){var t=function(){function h(){this.size=0}return h.prototype.has=function(v){return!1},h.prototype.forEach=function(v,p){return p},h}(),r=function(){function h(v){this.idx=v,this.size=1}return h.prototype.has=function(v){return v===this.idx},h.prototype.forEach=function(v,p){return v(this.idx,p),p},h}(),n=function(){function h(v,p){this.mask=v,this.size=p,this.length=v.length}return h.prototype.has=function(v){return v<this.length&&!!this.mask[v]},h.prototype._forEach=function(v,p){for(var g=0;g<this.length;g++)this.mask[g]&&v(g,p)},h.prototype.forEach=function(v,p){return this._forEach(v,p),p},h}(),a=function(){function h(v){this.size=v}return h.prototype.has=function(v){return!0},h.prototype._forEach=function(v,p){for(var g=0;g<this.size;g++)v(g,p)},h.prototype.forEach=function(v,p){return this._forEach(v,p),p},h}(),i=function(){function h(v){this.set=v,this._flat=void 0,this.size=v.size}return h.prototype.has=function(v){return this.set.has(v)},h.prototype._forEach=function(v,p){for(var g=0,m=this.flatten();g<m.length;g++){var y=m[g];v(y,p)}},h.prototype.flatten=function(){if(this._flat)return this._flat;var v=new Int32Array(this.size),p=0;return this.set.forEach(function(g){return v[p++]=g}),dSe(v),this._flat=v,this._flat},h.prototype.forEach=function(v,p){return this._forEach(v,p),p},h}();function o(h){return new a(h)}e.always=o,e.never=new t;function s(h){return new i(h)}e.ofSet=s;function u(h){return new r(h)}e.singleton=u;function l(h){var v=h.length;if(v===0)return new t;if(v===1)return new r(h[0]);for(var p=0,g=0,m=h;g<m.length;g++){var y=m[g];y>p&&(p=y)}if(v===p)return new a(v);var b=v/p;if(b<1/12){for(var S=new Set,x=0,C=h;x<C.length;x++){var y=C[x];S.add(y)}return new i(S)}for(var w=new Int8Array(p+1),A=0,I=h;A<I.length;A++){var y=I[A];w[y]=1}return new n(w,h.length)}e.ofUniqueIndices=l;function c(h,v){return new n(h,v)}e.ofMask=c;function d(h,v){for(var p=0,g=v;p<g.length;p++){var m=g[p];if(h.has(m))return!0}return!1}e.hasAny=d;function f(h,v){var p=0,g=0;if(v.forEach(function(b){h.has(b)||(p++,b>g&&(g=b))}),p/g<1/12){var m=new Set;return v.forEach(function(b){h.has(b)||m.add(b)}),s(m)}else{var y=new Uint8Array(g+1);return v.forEach(function(b){h.has(b)||(y[b]=1)}),c(y,p)}}e.complement=f})(i8||(i8={}));function zi(e,t){e===void 0&&(e=0),t===void 0&&(t=Number.MAX_SAFE_INTEGER);var r=e;return function(){var n=r;return r=(r+1)%t,n}}var Gy;(function(e){function t(n){return{ref:n}}e.create=t;function r(n,a){return n.ref=a,n}e.set=r})(Gy||(Gy={}));var fSe=zi(0,2147483647),Yf;(function(e){function t(n,a){return{id:fSe(),version:0,value:n,metadata:a}}e.create=t;function r(n,a){return{id:n.id,version:n.version+1,value:a,metadata:n.metadata}}e.withValue=r})(Yf||(Yf={}));var N;(function(e){function t(i,o){return Gy.create(Yf.create(i,o))}e.create=t;function r(i,o){return Gy.set(i,Yf.withValue(i.ref,o))}e.update=r;function n(i,o){return Gy.set(i,o)}e.set=n;function a(i,o){return i.ref.value!==o?r(i,o):i}e.updateIfChanged=a})(N||(N={}));var cf=function(){};function to(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var pX=Object.prototype.hasOwnProperty;function zc(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!zc(e[a],t[a]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;var o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;var u=e instanceof RegExp,l=t instanceof RegExp;if(u&&l)return e.toString()===t.toString();if(u!==l)return!1;for(var a=0;a<i.length;a++)if(!pX.call(t,i[a]))return!1;for(var a=0;a<i.length;a++)if(!zc(e[i[a]],t[i[a]]))return!1;return!0}return!1}function MC(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?hSe(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Cg(e,t):!1}function Cg(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!pX.call(e,i)||e[i]!==t[i])return!1}return!0}function hSe(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function Da(e,t){return e!==void 0?e:t}function o8(e){return(e<10?"0":"")+e}function pSe(e){var t=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return t+":"+o8(r)+":"+o8(n)}var qy=Math.PI/2,vX=Math.PI/180;function Xr(e){return e*vX}function Au(e){return e/vX}function vSe(e){return e!==0&&(e&e-1)===0}function mSe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=0,a=0,i=e.length;a<i;++a){var o=e[a],s=Math.abs(o);s>n&&(r=o,n=s)}return r}function mX(e,t){return e*t}function gSe(e,t,r){return(e-t)/(r-t)}function ki(e,t,r){return Math.max(t,Math.min(r,e))}function ySe(e){return ki(e,0,1)}function Wo(e,t,r){return e+(t-e)*r}function fS(e,t,r,n,a,i){var o=(r-e)*i,s=(n-t)*i,u=a*a,l=a*u;return(2*t-2*r+o+s)*l+(-3*t+3*r-2*o-s)*u+o*a+t}function $A(e,t,r,n){var a=1-n;return a*a*e+2*a*n*t+n*n*r}function gX(e,t,r){return r=ySe(gSe(r,e,t)),r*r*(3-2*r)}function ai(){return ai.zero()}(function(e){function t(){var D=[.1,0,0];return D[0]=0,D}e.zero=t;function r(D,k,R){var L=t();return L[0]=D,L[1]=k,L[2]=R,L}e.create=r;function n(D,k){var R=dt.toRgb(k),L=R[0],H=R[1],B=R[2],j=I(L,H,B),Q=j[0],G=j[1],W=j[2],q=116*G-16;return D[0]=q<0?0:q,D[1]=500*(Q-G),D[2]=200*(G-W),D}e.fromColor=n;function a(D,k){return Al.toLab(D,k)}e.fromHcl=a;function i(D){var k=(D[0]+16)/116,R=isNaN(D[1])?k:k+D[1]/500,L=isNaN(D[2])?k:k-D[2]/200;k=p*C(k),R=v*C(R),L=g*C(L);var H=x(3.2404542*R-1.5371385*k-.4985314*L),B=x(-.969266*R+1.8760108*k+.041556*L),j=x(.0556434*R-.2040259*k+1.0572252*L);return dt.fromRgb(Math.round(ki(H,0,255)),Math.round(ki(B,0,255)),Math.round(ki(j,0,255)))}e.toColor=i;function o(D,k){var R=k[0],L=k[1],H=k[2],B=Math.sqrt(L*L+H*H),j=(Au(Math.atan2(H,L))+360)%360;return Math.round(B*1e4)===0&&(j=Number.NaN),D[0]=j,D[1]=B,D[2]=R,D}e.toHcl=o;function s(D,k){return D[0]=k[0],D[1]=k[1],D[2]=k[2],D}e.copy=s;function u(D,k,R){return D[0]=k[0]-h*R,D[1]=k[1],D[2]=k[2],D}e.darken=u;function l(D,k,R){return u(D,k,-R)}e.lighten=l;var c=[0,0,0];function d(D,k,R){return o(c,k),Al.toLab(D,Al.saturate(c,c,R))}e.saturate=d;function f(D,k,R){return d(D,k,-R)}e.desaturate=f;var h=18,v=.95047,p=1,g=1.08883,m=.137931034,y=.206896552,b=.12841855,S=.008856452;function x(D){return 255*(D<=.00304?12.92*D:1.055*Math.pow(D,1/2.4)-.055)}function C(D){return D>y?D*D*D:b*(D-m)}function w(D){return(D/=255)<=.04045?D/12.92:Math.pow((D+.055)/1.055,2.4)}function A(D){return D>S?Math.pow(D,1/3):D/b+m}function I(D,k,R){D=w(D),k=w(k),R=w(R);var L=A((.4124564*D+.3575761*k+.1804375*R)/v),H=A((.2126729*D+.7151522*k+.072175*R)/p),B=A((.0193339*D+.119192*k+.9503041*R)/g);return[L,H,B]}})(ai||(ai={}));function Al(){return Al.zero()}(function(e){function t(){var g=[.1,0,0];return g[0]=0,g}e.zero=t;function r(g,m,y){var b=t();return b[0]=g,b[1]=m,b[2]=y,b}e.create=r;var n=[0,0,0];function a(g,m){return ai.toHcl(g,ai.fromColor(n,m))}e.fromColor=a;function i(g,m){return ai.toHcl(g,m)}e.fromLab=i;var o=[0,0,0];function s(g){return ai.toColor(u(o,g))}e.toColor=s;function u(g,m){var y=m[0],b=m[1],S=m[2];return isNaN(y)&&(y=0),y=Xr(y),g[0]=S,g[1]=Math.cos(y)*b,g[2]=Math.sin(y)*b,g}e.toLab=u;function l(g,m){return g[0]=m[0],g[1]=m[1],g[2]=m[2],g}e.copy=l;function c(g,m,y){return g[0]=m[0],g[1]=Math.max(0,m[1]+p*y),g[2]=m[2],g}e.saturate=c;function d(g,m,y){return c(g,m,-y)}e.desaturate=d;var f=[0,0,0];function h(g,m,y){return u(f,m),ai.toHcl(g,ai.darken(f,f,y))}e.darken=h;function v(g,m,y){return h(g,m,-y)}e.lighten=v;var p=18})(Al||(Al={}));function dt(e){return e}(function(e){function t(I){return"rgb("+(I>>16&255)+", "+(I>>8&255)+", "+(I&255)+")"}e.toStyle=t;function r(I){return"0x"+("000000"+I.toString(16)).slice(-6)}e.toHexString=r;function n(I){return"RGB: "+e.toRgb(I).join(", ")}e.toRgbString=n;function a(I){return[I>>16&255,I>>8&255,I&255]}e.toRgb=a;function i(I){return[(I>>16&255)/255,(I>>8&255)/255,(I&255)/255]}e.toRgbNormalized=i;function o(I,D,k){return I<<16|D<<8|k}e.fromRgb=o;function s(I,D,k){return I*255<<16|D*255<<8|k*255}e.fromNormalizedRgb=s;function u(I,D){return o(I[D],I[D+1],I[D+2])}e.fromArray=u;function l(I,D){return s(I[D],I[D+1],I[D+2])}e.fromNormalizedArray=l;function c(I,D,k){return D[k]=I>>16&255,D[k+1]=I>>8&255,D[k+2]=I&255,D}e.toArray=c;function d(I,D,k){return D[k]=(I>>16&255)/255,D[k+1]=(I>>8&255)/255,D[k+2]=(I&255)/255,D}e.toArrayNormalized=d;function f(I,D){return I[0]=D>>16&255,I[1]=D>>8&255,I[2]=D&255,I}e.toVec3=f;function h(I,D){return I[0]=(D>>16&255)/255,I[1]=(D>>8&255)/255,I[2]=(D&255)/255,I}e.toVec3Normalized=h;function v(I,D,k){var R=I>>16&255,L=I>>8&255,H=I&255,B=D>>16&255,j=D>>8&255,Q=D&255,G=R+(B-R)*k,W=L+(j-L)*k,q=H+(Q-H)*k;return G<<16|W<<8|q}e.interpolate=v;var p=[0,0,0];function g(I,D){return Al.fromColor(p,I),Al.toColor(Al.saturate(p,p,D))}e.saturate=g;function m(I,D){return g(I,-D)}e.desaturate=m;var y=[0,0,0];function b(I,D){return ai.fromColor(y,I),ai.toColor(ai.darken(y,y,D))}e.darken=b;function S(I,D){return b(I,-D)}e.lighten=S;function x(I){return I<.04045?I*.0773993808:Math.pow(I*.9478672986+.0521327014,2.4)}function C(I){return s(x((I>>16&255)/255),x((I>>8&255)/255),x((I&255)/255))}e.sRGBToLinear=C;function w(I){return I<.0031308?I*12.92:1.055*Math.pow(I,.41666)-.055}function A(I){return s(w((I>>16&255)/255),w((I>>8&255)/255),w((I&255)/255))}e.linearToSRGB=A})(dt||(dt={}));function br(e,t,r,n){return{label:e,description:r,list:n,type:t}}function n3(e,t,r){var n={};for(var a in e){var i=e[a];i=dt.saturate(i,t),i=dt.darken(i,-r),n[a]=i}return n}function yX(e,t){return t===void 0&&(t=" "),e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1"+t+"$2")}function Bi(e){return qg(yX(e))}var bSe=function(e){return e.toUpperCase()};function xSe(e){return e?typeof e=="string"?e.toUpperCase():(""+e).toUpperCase():""}function qg(e){return e.toLowerCase().replace(/^\w|\s\w/g,bSe)}function SSe(e){return e.replace(/_/g," ")}function CSe(e){return e.replace(/-/g," ")}function Yo(e){return qg(yX(SSe(CSe(e))))}function va(e,t,r,n){var a=n.length;if(a>r-t)return!1;for(var i=0;i<a;i++)if(e.charCodeAt(t+i)!==n.charCodeAt(i))return!1;return!0}function _Se(e,t){var r=Object.keys(t),n=Object.values(t);return new(Function.bind.apply(Function,Ut(Ut([void 0],r),["return `"+e+"`;"])))().apply(void 0,n)}function xf(e){return e.replace(/<\/?[^>]+>/g,"")}var wo={"orange-red":br("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":br("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":br("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:br("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":br("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":br("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":br("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:br("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":br("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:br("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":br("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:br("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":br("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:br("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":br("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":br("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:br("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":br("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:br("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":br("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":br("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":br("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":br("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":br("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":br("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":br("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":br("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":br("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:br("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":br("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":br("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":br("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:br("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":br("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":br("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":br("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:br("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:br("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:br("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:br("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:br("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:br("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:br("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:br("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":br("Red-White-Blue","diverging","",[12526114,16777215,3367393])},wSe=Object.keys(wo),ak=wSe.map(function(e){return[e,wo[e].label,qg(wo[e].type)]}),ESe=ak.filter(function(e){return wo[e[0]].type==="diverging"||wo[e[0]].type==="sequential"}),ASe=ak.filter(function(e){return wo[e[0]].type==="qualitative"});function Hs(e){return e in wo?wo[e]:(console.warn("unknown color list named '"+e+"'"),wo["red-yellow-blue"])}function vh(e){return{kind:"table-legend",table:e}}function PSe(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}var Je;(function(e){function t(f){return f.creator&&f.chunkSize}e.is=t;function r(f){var h=f.growBy*f.elementSize;f.currentSize=h,f.currentIndex=0,f.currentChunk=new f.ctor(h),f.allocatedSize+=h,f.chunks[f.chunks.length]=f.currentChunk}function n(f,h,v,p,g){f.currentIndex>=f.currentSize&&r(f);var m=f.currentChunk,y=f.currentIndex;return m[y]=h,m[y+1]=v,m[y+2]=p,m[y+3]=g,f.currentIndex+=4,f.elementCount++}e.add4=n;function a(f,h,v,p){f.currentIndex>=f.currentSize&&r(f);var g=f.currentChunk,m=f.currentIndex;return g[m]=h,g[m+1]=v,g[m+2]=p,f.currentIndex+=3,f.elementCount++}e.add3=a;function i(f,h,v){f.currentIndex>=f.currentSize&&r(f);var p=f.currentChunk,g=f.currentIndex;return p[g]=h,p[g+1]=v,f.currentIndex+=2,f.elementCount++}e.add2=i;function o(f,h){return f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex]=h,f.currentIndex+=1,f.elementCount++}e.add=o;function s(f,h,v){for(var p=0;p<h;p++)f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex++]=v,f.elementCount++;return f.elementCount}e.addRepeat=s;function u(f,h){for(var v=f.elementSize,p=0,g=h.length;p<g;p+=v){f.currentIndex>=f.currentSize&&r(f);for(var m=f.currentChunk,y=0;y<v;y++)m[f.currentIndex++]=h[p+y];f.elementCount++}return f.elementCount}e.addMany=u;function l(f,h){return h===void 0&&(h=!1),c(f,h)}e.compact=l;function c(f,h){var v=f.ctor,p=f.chunks,g=f.currentIndex;if(!p.length)return new v(0);if(p.length===1&&(h||g===f.allocatedSize))return p[0];for(var m=0,y=0,b=p.length-1;y<b;y++)m+=p[y].length;m+=f.currentIndex;var S=new v(m),x=0;if(S.buffer)for(var y=0,b=p.length-1;y<b;y++)S.set(p[y],x),x+=p[y].length;else for(var y=0,b=p.length-1;y<b;y++){for(var C=p[y],w=0,A=C.length;w<A;w++)S[x+w]=C[w];x+=C.length}var I=p[p.length-1];if(S.buffer&&g>=f.currentSize)S.set(I,x);else for(var w=0,A=I.length;w<A;w++)S[x+w]=I[w];return S}e._compact=c;function d(f,h,v,p){var g={ctor:f,elementSize:h,growBy:Math.max(1,Math.ceil(v)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof p>"u")return g;if(typeof p=="number")return g.currentChunk=new f(p*h),g.allocatedSize=p*h,g.currentSize=g.currentChunk.length,g.chunks[0]=g.currentChunk,g;var m=p;if(m.length%h!==0)throw new Error("initialChunk length must be a multiple of the element size.");return g.currentChunk=m,g.allocatedSize=m.length,g.currentSize=m.length,g.chunks[0]=m,g}e.create=d})(Je||(Je={}));function DC(e,t,r){return e[t]-e[r]}function op(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bX(e,t,r,n){var a=r+n>>1;return t(e,r,n)>0?t(e,r,a)>0?t(e,a,n)>0?a:n:r:t(e,n,a)>0?t(e,a,r)>0?a:r:n}function TSe(e,t,r){var n=e.cmp,a=e.swap,i=e.data,o=e.parts,s=t+1,u=r;for(a(i,t,bX(i,n,t,r));n(i,u,t)>0;)--u;for(var l=t+1;l<=u;l++){var c=n(i,l,t);if(c>0){for(a(i,l,u),--u;n(i,u,t)>0;)--u;l--}else c===0&&(a(i,l,s),s++)}for(var l=t;l<s;l++)a(i,l,t+u-l);o[0]=u-s+t+1,o[1]=u}function ISe(e,t,r){for(var n=e.data,a=e.cmp,i=e.swap,o=t+1;o<=r;o++)for(var s=o-1;s>=t&&a(n,s,s+1)>0;)i(n,s,s+1),s=s-1}function RC(e,t,r){for(var n=e.parts;t<r;){if(r-t<16){ISe(e,t,r);return}TSe(e,t,r);var a=n[0],i=n[1];a-t<r-i?(RC(e,t,a-1),t=i+1):(RC(e,i+1,r),r=a-1)}}function MSe(e,t,r,n){var a=r+1,i=n;op(e,r,bX(e,DC,r,n));for(var o=e[r];e[i]>o;)--i;for(var s=r+1;s<=i;s++){var u=e[s];if(u>o){for(op(e,s,i),--i;e[i]>o;)--i;s--}else u===o&&(op(e,s,a),++a)}for(var s=r;s<a;s++)op(e,s,r+i-s);t[0]=i-a+r+1,t[1]=i}function DSe(e,t,r){for(var n=t+1;n<=r;n++){for(var a=e[n],i=n-1;i>=t&&e[i]>a;)e[i+1]=e[i],i=i-1;e[i+1]=a}}function qI(e,t,r,n){for(;r<n;){if(n-r<16){DSe(e,r,n);return}MSe(e,t,r,n);var a=t[0],i=t[1];a-r<n-i?(qI(e,t,r,a-1),r=i+1):(qI(e,t,i+1,n),n=a-1)}}function Pu(e,t){return t===void 0&&(t=DC),RSe(e,0,e.length,t)}function RSe(e,t,r,n){return n===void 0&&(n=DC),n===DC?qI(e,[0,0],t,r-1):RC({data:e,cmp:n,swap:op,parts:[0,0]},t,r-1),e}function xX(e,t,r,n,a){var i={data:e,cmp:n,swap:a,parts:[0,0]};return RC(i,t,r-1),e}function kSe(e,t,r){return e[t].key<e[r].key?-1:1}function OSe(e,t,r,n,a){for(var i=new Map,o=[],s=t(e[0]),u=!0,l=n;l<a;l++){var c=t(e[l]);if(i.has(c))i.get(c).count++,s!==c&&(u=!1);else{var d={key:c,count:1,offset:l};i.set(c,d),o[o.length]=d}s=c}var f=new Int32Array(o.length+1);f[o.length]=a;var h=!0;if(r){for(var l=1,v=o.length;l<v;l++)if(o[l-1].key>o[l].key){h=!1;break}}if(u&&h){for(var l=0;l<o.length;l++)f[l]=o[l].offset;return f}r&&!h&&xX(o,0,o.length,kSe,op);for(var p=0,l=0;l<o.length;l++){var g=o[l];g.offset=p,p+=g.count}for(var m=new Int32Array(a-n),l=n;l<a;l++){var c=t(e[l]),d=i.get(c);m[d.offset++]=e[l]}for(var l=0,v=m.length;l<v;l++)e[l+n]=m[l];f[0]=n;for(var l=1;l<o.length;l++)f[l]=o[l-1].offset+n;return f}function XA(e,t,r){var n=r&&r.start||0,a=r&&r.end||e.length;if(a-n<=0)throw new Error("Can only bucket non-empty collections.");return OSe(e,t,!!(r&&r.sort),n,a)}var LSe=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(t,r){var n=this.id++,a=[t];return this.groups[n]=a,{id:n,keys:a,value:r}},e.prototype.add=function(t,r){var n=this.getHash(r);if(this.byHash.has(n)){for(var a=this.byHash.get(n),i=0,o=a.length;i<o;i++){var s=a[i];if(this.areEqual(r,s.value))return s.keys[s.keys.length]=t,s.value}var u=this.createGroup(t,r);return a[a.length]=u,u.value}else{var u=this.createGroup(t,r);return this.byHash.set(n,[u]),u.value}},e}();function NSe(e,t){return new LSe(e,t)}function SX(e){var t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function cv(e,t){var r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function FSe(e,t,r){var n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function BSe(e,t,r,n){var a=23;return a=31*a+e|0,a=31*a+t|0,a=31*a+r|0,a=31*a+n|0,a=a^a>>4,a=(a^3735928559)+(a<<5),a=a^a>>11,a}function ik(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r++)|0;return t}function Uf(e,t){return(e+t)*(e+t+1)/2+t}function Ui(e){for(var t=2166136261,r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function kC(e,t){var r=t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end<"u"?Math.min(t.end,e):e;return{start:r,end:n}}function Tb(e,t){var r=t&&typeof t.array<"u"?t.array:Array,n=kC(e,t),a=n.start,i=n.end;return{array:new r(i-a),start:a,end:i}}function USe(e,t,r){for(var n=0,a=t.length;n<a;n++)t[n]=e(r+n);return t}function ti(e,t,r){var n=Tb(e,r),a=n.array,i=n.start;return USe(t,a,i)}function ok(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function OC(e,t){var r=e.constructor,n=e.buffer,a=e.length,i=e.byteOffset,o=e.BYTES_PER_ELEMENT,s=kC(a,t),u=s.start,l=s.end;return u===0&&l===a?e:new r(n,i+o*u,Math.min(a,l-u))}var yn=1e-6;function mn(e,t,r){return Math.abs(e-t)<=r}function le(){return le.zero()}(function(e){function t(){var O=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return O[0]=0,O}e.zero=t;function r(){var O=t();return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.identity=r;function n(O){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.setIdentity=n;function a(O){for(var V=0;V<16;V++)O[V]=0;return O}e.setZero=a;function i(O){for(var V=t(),ve=0;ve<4;ve++)for(var Pe=O[ve],Me=0;Me<4;Me++)V[4*Me+ve]=Pe[Me];return V}e.ofRows=i;var o=r();function s(O,V){return l(O,o,typeof V>"u"?yn:V)}e.isIdentity=s;function u(O){for(var V=0;V<16;V++)if(isNaN(O[V]))return!0;return!1}e.hasNaN=u;function l(O,V,ve){for(var Pe=0;Pe<16;Pe++)if(Math.abs(O[Pe]-V[Pe])>ve)return!1;return!0}e.areEqual=l;function c(O,V,ve,Pe){O[4*ve+V]=Pe}e.setValue=c;function d(O,V,ve){return O[4*ve+V]}e.getValue=d;function f(O,V,ve){return V[ve+0]=O[0],V[ve+1]=O[1],V[ve+2]=O[2],V[ve+3]=O[3],V[ve+4]=O[4],V[ve+5]=O[5],V[ve+6]=O[6],V[ve+7]=O[7],V[ve+8]=O[8],V[ve+9]=O[9],V[ve+10]=O[10],V[ve+11]=O[11],V[ve+12]=O[12],V[ve+13]=O[13],V[ve+14]=O[14],V[ve+15]=O[15],V}e.toArray=f;function h(O,V,ve){return O[0]=V[ve+0],O[1]=V[ve+1],O[2]=V[ve+2],O[3]=V[ve+3],O[4]=V[ve+4],O[5]=V[ve+5],O[6]=V[ve+6],O[7]=V[ve+7],O[8]=V[ve+8],O[9]=V[ve+9],O[10]=V[ve+10],O[11]=V[ve+11],O[12]=V[ve+12],O[13]=V[ve+13],O[14]=V[ve+14],O[15]=V[ve+15],O}e.fromArray=h;function v(O,V,ve,Pe){return a(O),c(O,0,0,V[0]),c(O,1,0,V[1]),c(O,2,0,V[2]),c(O,0,1,ve[0]),c(O,1,1,ve[1]),c(O,2,1,ve[2]),c(O,0,2,Pe[0]),c(O,1,2,Pe[1]),c(O,2,2,Pe[2]),c(O,3,3,1),O}e.fromBasis=v;function p(O,V){return O[0]=V[0],O[1]=V[1],O[2]=V[2],O[3]=V[3],O[4]=V[4],O[5]=V[5],O[6]=V[6],O[7]=V[7],O[8]=V[8],O[9]=V[9],O[10]=V[10],O[11]=V[11],O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15],O}e.copy=p;function g(O){return p(t(),O)}e.clone=g;function m(O,V){return O[0]=V[12],O[1]=V[13],O[2]=V[14],O}e.getTranslation=m;function y(O,V){var ve=V[0],Pe=V[1],Me=V[2],Ge=V[4],$e=V[5],Ze=V[6],ht=V[8],Ue=V[9],rt=V[10];return O[0]=Math.sqrt(ve*ve+Pe*Pe+Me*Me),O[1]=Math.sqrt(Ge*Ge+$e*$e+Ze*Ze),O[2]=Math.sqrt(ht*ht+Ue*Ue+rt*rt),O}e.getScaling=y;function b(O,V){var ve=V[0]+V[5]+V[10],Pe=0;return ve>0?(Pe=Math.sqrt(ve+1)*2,O[3]=.25*Pe,O[0]=(V[6]-V[9])/Pe,O[1]=(V[8]-V[2])/Pe,O[2]=(V[1]-V[4])/Pe):V[0]>V[5]&&V[0]>V[10]?(Pe=Math.sqrt(1+V[0]-V[5]-V[10])*2,O[3]=(V[6]-V[9])/Pe,O[0]=.25*Pe,O[1]=(V[1]+V[4])/Pe,O[2]=(V[8]+V[2])/Pe):V[5]>V[10]?(Pe=Math.sqrt(1+V[5]-V[0]-V[10])*2,O[3]=(V[8]-V[2])/Pe,O[0]=(V[1]+V[4])/Pe,O[1]=.25*Pe,O[2]=(V[6]+V[9])/Pe):(Pe=Math.sqrt(1+V[10]-V[0]-V[5])*2,O[3]=(V[1]-V[4])/Pe,O[0]=(V[8]+V[2])/Pe,O[1]=(V[6]+V[9])/Pe,O[2]=.25*Pe),O}e.getRotation=b;function S(O,V){var ve=1/Math.sqrt(V[0]*V[0]+V[1]*V[1]+V[2]*V[2]),Pe=1/Math.sqrt(V[4]*V[4]+V[5]*V[5]+V[6]*V[6]),Me=1/Math.sqrt(V[8]*V[8]+V[9]*V[9]+V[10]*V[10]);return O[0]=V[0]*ve,O[1]=V[1]*ve,O[2]=V[2]*ve,O[3]=0,O[4]=V[4]*Pe,O[5]=V[5]*Pe,O[6]=V[6]*Pe,O[7]=0,O[8]=V[8]*Me,O[9]=V[9]*Me,O[10]=V[10]*Me,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.extractRotation=S;function x(O,V){if(O===V){var ve=V[1],Pe=V[2],Me=V[3],Ge=V[6],$e=V[7],Ze=V[11];O[1]=V[4],O[2]=V[8],O[3]=V[12],O[4]=ve,O[6]=V[9],O[7]=V[13],O[8]=Pe,O[9]=Ge,O[11]=V[14],O[12]=Me,O[13]=$e,O[14]=Ze}else O[0]=V[0],O[1]=V[4],O[2]=V[8],O[3]=V[12],O[4]=V[1],O[5]=V[5],O[6]=V[9],O[7]=V[13],O[8]=V[2],O[9]=V[6],O[10]=V[10],O[11]=V[14],O[12]=V[3],O[13]=V[7],O[14]=V[11],O[15]=V[15];return O}e.transpose=x;function C(O,V){var ve=V[0],Pe=V[1],Me=V[2],Ge=V[3],$e=V[4],Ze=V[5],ht=V[6],Ue=V[7],rt=V[8],ut=V[9],Ee=V[10],Te=V[11],ye=V[12],Se=V[13],Le=V[14],Ve=V[15],nt=ve*Ze-Pe*$e,Xe=ve*ht-Me*$e,He=ve*Ue-Ge*$e,se=Pe*ht-Me*Ze,pe=Pe*Ue-Ge*Ze,Ae=Me*Ue-Ge*ht,Ye=rt*Se-ut*ye,ct=rt*Le-Ee*ye,St=rt*Ve-Te*ye,Bt=ut*Le-Ee*Se,rr=ut*Ve-Te*Se,hr=Ee*Ve-Te*Le,Lt=nt*hr-Xe*rr+He*Bt+se*St-pe*ct+Ae*Ye;return Lt?(Lt=1/Lt,O[0]=(Ze*hr-ht*rr+Ue*Bt)*Lt,O[1]=(Me*rr-Pe*hr-Ge*Bt)*Lt,O[2]=(Se*Ae-Le*pe+Ve*se)*Lt,O[3]=(Ee*pe-ut*Ae-Te*se)*Lt,O[4]=(ht*St-$e*hr-Ue*ct)*Lt,O[5]=(ve*hr-Me*St+Ge*ct)*Lt,O[6]=(Le*He-ye*Ae-Ve*Xe)*Lt,O[7]=(rt*Ae-Ee*He+Te*Xe)*Lt,O[8]=($e*rr-Ze*St+Ue*Ye)*Lt,O[9]=(Pe*St-ve*rr-Ge*Ye)*Lt,O[10]=(ye*pe-Se*He+Ve*nt)*Lt,O[11]=(ut*He-rt*pe-Te*nt)*Lt,O[12]=(Ze*ct-$e*Bt-ht*Ye)*Lt,O[13]=(ve*Bt-Pe*ct+Me*Ye)*Lt,O[14]=(Se*Xe-ye*se-Le*nt)*Lt,O[15]=(rt*se-ut*Xe+Ee*nt)*Lt,!0):!1}e.tryInvert=C;function w(O,V){return C(O,V)||console.warn("non-invertible matrix.",V),O}e.invert=w;function A(O,V,ve){var Pe=V[0],Me=V[1],Ge=V[2],$e=V[3],Ze=V[4],ht=V[5],Ue=V[6],rt=V[7],ut=V[8],Ee=V[9],Te=V[10],ye=V[11],Se=V[12],Le=V[13],Ve=V[14],nt=V[15],Xe=ve[0],He=ve[1],se=ve[2],pe=ve[3];return O[0]=Xe*Pe+He*Ze+se*ut+pe*Se,O[1]=Xe*Me+He*ht+se*Ee+pe*Le,O[2]=Xe*Ge+He*Ue+se*Te+pe*Ve,O[3]=Xe*$e+He*rt+se*ye+pe*nt,Xe=ve[4],He=ve[5],se=ve[6],pe=ve[7],O[4]=Xe*Pe+He*Ze+se*ut+pe*Se,O[5]=Xe*Me+He*ht+se*Ee+pe*Le,O[6]=Xe*Ge+He*Ue+se*Te+pe*Ve,O[7]=Xe*$e+He*rt+se*ye+pe*nt,Xe=ve[8],He=ve[9],se=ve[10],pe=ve[11],O[8]=Xe*Pe+He*Ze+se*ut+pe*Se,O[9]=Xe*Me+He*ht+se*Ee+pe*Le,O[10]=Xe*Ge+He*Ue+se*Te+pe*Ve,O[11]=Xe*$e+He*rt+se*ye+pe*nt,Xe=ve[12],He=ve[13],se=ve[14],pe=ve[15],O[12]=Xe*Pe+He*Ze+se*ut+pe*Se,O[13]=Xe*Me+He*ht+se*Ee+pe*Le,O[14]=Xe*Ge+He*Ue+se*Te+pe*Ve,O[15]=Xe*$e+He*rt+se*ye+pe*nt,O}e.mul=A;function I(O,V,ve,Pe,Me,Ge){var $e=V[0+Me],Ze=V[1+Me],ht=V[2+Me],Ue=V[3+Me],rt=V[4+Me],ut=V[5+Me],Ee=V[6+Me],Te=V[7+Me],ye=V[8+Me],Se=V[9+Me],Le=V[10+Me],Ve=V[11+Me],nt=V[12+Me],Xe=V[13+Me],He=V[14+Me],se=V[15+Me],pe=ve[0+Ge],Ae=ve[1+Ge],Ye=ve[2+Ge],ct=ve[3+Ge];return O[0+Pe]=pe*$e+Ae*rt+Ye*ye+ct*nt,O[1+Pe]=pe*Ze+Ae*ut+Ye*Se+ct*Xe,O[2+Pe]=pe*ht+Ae*Ee+Ye*Le+ct*He,O[3+Pe]=pe*Ue+Ae*Te+Ye*Ve+ct*se,pe=ve[4+Ge],Ae=ve[5+Ge],Ye=ve[6+Ge],ct=ve[7+Ge],O[4+Pe]=pe*$e+Ae*rt+Ye*ye+ct*nt,O[5+Pe]=pe*Ze+Ae*ut+Ye*Se+ct*Xe,O[6+Pe]=pe*ht+Ae*Ee+Ye*Le+ct*He,O[7+Pe]=pe*Ue+Ae*Te+Ye*Ve+ct*se,pe=ve[8+Ge],Ae=ve[9+Ge],Ye=ve[10+Ge],ct=ve[11+Ge],O[8+Pe]=pe*$e+Ae*rt+Ye*ye+ct*nt,O[9+Pe]=pe*Ze+Ae*ut+Ye*Se+ct*Xe,O[10+Pe]=pe*ht+Ae*Ee+Ye*Le+ct*He,O[11+Pe]=pe*Ue+Ae*Te+Ye*Ve+ct*se,pe=ve[12+Ge],Ae=ve[13+Ge],Ye=ve[14+Ge],ct=ve[15+Ge],O[12+Pe]=pe*$e+Ae*rt+Ye*ye+ct*nt,O[13+Pe]=pe*Ze+Ae*ut+Ye*Se+ct*Xe,O[14+Pe]=pe*ht+Ae*Ee+Ye*Le+ct*He,O[15+Pe]=pe*Ue+Ae*Te+Ye*Ve+ct*se,O}e.mulOffset=I;function D(O,V,ve,Pe){return A(O,A(O,V,ve),Pe)}e.mul3=D;function k(O,V,ve){var Pe=ve[0],Me=ve[1],Ge=ve[2],$e,Ze,ht,Ue,rt,ut,Ee,Te,ye,Se,Le,Ve;return V===O?(O[12]=V[0]*Pe+V[4]*Me+V[8]*Ge+V[12],O[13]=V[1]*Pe+V[5]*Me+V[9]*Ge+V[13],O[14]=V[2]*Pe+V[6]*Me+V[10]*Ge+V[14],O[15]=V[3]*Pe+V[7]*Me+V[11]*Ge+V[15]):($e=V[0],Ze=V[1],ht=V[2],Ue=V[3],rt=V[4],ut=V[5],Ee=V[6],Te=V[7],ye=V[8],Se=V[9],Le=V[10],Ve=V[11],O[0]=$e,O[1]=Ze,O[2]=ht,O[3]=Ue,O[4]=rt,O[5]=ut,O[6]=Ee,O[7]=Te,O[8]=ye,O[9]=Se,O[10]=Le,O[11]=Ve,O[12]=$e*Pe+rt*Me+ye*Ge+V[12],O[13]=Ze*Pe+ut*Me+Se*Ge+V[13],O[14]=ht*Pe+Ee*Me+Le*Ge+V[14],O[15]=Ue*Pe+Te*Me+Ve*Ge+V[15]),O}e.translate=k;function R(O,V){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=V[0],O[13]=V[1],O[14]=V[2],O[15]=1,O}e.fromTranslation=R;function L(O,V){return O[12]=V[0],O[13]=V[1],O[14]=V[2],O}e.setTranslation=L;function H(O,V,ve,Pe){return O[0]=ve[0],O[4]=ve[1],O[8]=ve[2],O[1]=Pe[0],O[5]=Pe[1],O[9]=Pe[2],O[2]=V[0],O[6]=V[1],O[10]=V[2],O}e.setAxes=H;function B(O,V,ve,Pe){var Me=Pe[0],Ge=Pe[1],$e=Pe[2],Ze=Math.sqrt(Me*Me+Ge*Ge+$e*$e),ht,Ue,rt,ut,Ee,Te,ye,Se,Le,Ve,nt,Xe,He,se,pe,Ae,Ye,ct,St,Bt,rr,hr,Lt,En;return Math.abs(Ze)<yn?r():(Ze=1/Ze,Me*=Ze,Ge*=Ze,$e*=Ze,ht=Math.sin(ve),Ue=Math.cos(ve),rt=1-Ue,ut=V[0],Ee=V[1],Te=V[2],ye=V[3],Se=V[4],Le=V[5],Ve=V[6],nt=V[7],Xe=V[8],He=V[9],se=V[10],pe=V[11],Ae=Me*Me*rt+Ue,Ye=Ge*Me*rt+$e*ht,ct=$e*Me*rt-Ge*ht,St=Me*Ge*rt-$e*ht,Bt=Ge*Ge*rt+Ue,rr=$e*Ge*rt+Me*ht,hr=Me*$e*rt+Ge*ht,Lt=Ge*$e*rt-Me*ht,En=$e*$e*rt+Ue,O[0]=ut*Ae+Se*Ye+Xe*ct,O[1]=Ee*Ae+Le*Ye+He*ct,O[2]=Te*Ae+Ve*Ye+se*ct,O[3]=ye*Ae+nt*Ye+pe*ct,O[4]=ut*St+Se*Bt+Xe*rr,O[5]=Ee*St+Le*Bt+He*rr,O[6]=Te*St+Ve*Bt+se*rr,O[7]=ye*St+nt*Bt+pe*rr,O[8]=ut*hr+Se*Lt+Xe*En,O[9]=Ee*hr+Le*Lt+He*En,O[10]=Te*hr+Ve*Lt+se*En,O[11]=ye*hr+nt*Lt+pe*En,V!==O&&(O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15]),O)}e.rotate=B;function j(O,V,ve){var Pe=ve[0],Me=ve[1],Ge=ve[2],$e=Math.sqrt(Pe*Pe+Me*Me+Ge*Ge),Ze,ht,Ue;return Math.abs($e)<yn?n(O):($e=1/$e,Pe*=$e,Me*=$e,Ge*=$e,Ze=Math.sin(V),ht=Math.cos(V),Ue=1-ht,O[0]=Pe*Pe*Ue+ht,O[1]=Me*Pe*Ue+Ge*Ze,O[2]=Ge*Pe*Ue-Me*Ze,O[3]=0,O[4]=Pe*Me*Ue-Ge*Ze,O[5]=Me*Me*Ue+ht,O[6]=Ge*Me*Ue+Pe*Ze,O[7]=0,O[8]=Pe*Ge*Ue+Me*Ze,O[9]=Me*Ge*Ue-Pe*Ze,O[10]=Ge*Ge*Ue+ht,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O)}e.fromRotation=j;function Q(O,V,ve){var Pe=ve[0],Me=ve[1],Ge=ve[2];return O[0]=V[0]*Pe,O[1]=V[1]*Pe,O[2]=V[2]*Pe,O[3]=V[3]*Pe,O[4]=V[4]*Me,O[5]=V[5]*Me,O[6]=V[6]*Me,O[7]=V[7]*Me,O[8]=V[8]*Ge,O[9]=V[9]*Ge,O[10]=V[10]*Ge,O[11]=V[11]*Ge,O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15],O}e.scale=Q;function G(O,V,ve){return O[0]=V[0]*ve,O[1]=V[1]*ve,O[2]=V[2]*ve,O[3]=V[3]*ve,O[4]=V[4]*ve,O[5]=V[5]*ve,O[6]=V[6]*ve,O[7]=V[7]*ve,O[8]=V[8]*ve,O[9]=V[9]*ve,O[10]=V[10]*ve,O[11]=V[11]*ve,O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15],O}e.scaleUniformly=G;function W(O,V){return O[0]=V[0],O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=V[1],O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=V[2],O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromScaling=W;function q(O,V){return O[0]=V,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=V,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=V,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromUniformScaling=q;function J(O,V){return O[0]=V[0],O[1]=V[1],O[2]=V[2],O[4]=V[3],O[5]=V[4],O[6]=V[5],O[8]=V[6],O[9]=V[7],O[10]=V[8],O}e.fromMat3=J;function he(O){for(var V="",ve=0;ve<4;ve++){for(var Pe=0;Pe<4;Pe++)V+=O[4*Pe+ve].toString(),Pe<3&&(V+=" ");ve<3&&(V+=`
`)}return V}e.makeTable=he;function $(O){var V=O[0],ve=O[1],Pe=O[2],Me=O[3],Ge=O[4],$e=O[5],Ze=O[6],ht=O[7],Ue=O[8],rt=O[9],ut=O[10],Ee=O[11],Te=O[12],ye=O[13],Se=O[14],Le=O[15],Ve=V*$e-ve*Ge,nt=V*Ze-Pe*Ge,Xe=V*ht-Me*Ge,He=ve*Ze-Pe*$e,se=ve*ht-Me*$e,pe=Pe*ht-Me*Ze,Ae=Ue*ye-rt*Te,Ye=Ue*Se-ut*Te,ct=Ue*Le-Ee*Te,St=rt*Se-ut*ye,Bt=rt*Le-Ee*ye,rr=ut*Le-Ee*Se;return Ve*rr-nt*Bt+Xe*St+He*ct-se*Ye+pe*Ae}e.determinant=$;function X(O,V){return U(O,typeof V<"u"?V:yn)}e.isRotationAndTranslation=X;function U(O,V){var ve=O[0],Pe=O[1],Me=O[2],Ge=O[3],$e=O[4],Ze=O[5],ht=O[6],Ue=O[7],rt=O[8],ut=O[9],Ee=O[10],Te=O[11],ye=O[15];if(!mn(ye,1,V)||!mn(Ge,0,V)||!mn(Ue,0,V)||!mn(Te,0,V))return!1;var Se=Math.abs(ve*(Ze*Ee-ht*ut)-Pe*($e*Ee-ht*rt)+Me*($e*ut-Ze*rt));return!!mn(Se,1,V)}function z(O,V){return ee(O,typeof V<"u"?V:yn)}e.isTranslationAndUniformScaling=z;function ee(O,V){var ve=O[0];return mn(O[1],0,V)&&mn(O[2],0,V)&&mn(O[3],0,V)&&mn(O[4],0,V)&&mn(O[5],ve,V)&&mn(O[6],0,V)&&mn(O[7],0,V)&&mn(O[8],0,V)&&mn(O[9],0,V)&&mn(O[10],ve,V)&&mn(O[11],0,V)&&mn(O[15],1,V)}function Y(O,V){var ve=V[0],Pe=V[1],Me=V[2],Ge=V[3],$e=ve+ve,Ze=Pe+Pe,ht=Me+Me,Ue=ve*$e,rt=Pe*$e,ut=Pe*Ze,Ee=Me*$e,Te=Me*Ze,ye=Me*ht,Se=Ge*$e,Le=Ge*Ze,Ve=Ge*ht;return O[0]=1-ut-ye,O[1]=rt+Ve,O[2]=Ee-Le,O[3]=0,O[4]=rt-Ve,O[5]=1-Ue-ye,O[6]=Te+Se,O[7]=0,O[8]=Ee+Le,O[9]=Te-Se,O[10]=1-Ue-ut,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromQuat=Y;function Z(O,V,ve,Pe,Me,Ge,$e){var Ze=2*Ge/(ve-V),ht=2*Ge/(Pe-Me),Ue=(ve+V)/(ve-V),rt=(Pe+Me)/(Pe-Me),ut=-($e+Ge)/($e-Ge),Ee=-2*$e*Ge/($e-Ge);return O[0]=Ze,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=ht,O[6]=0,O[7]=0,O[8]=Ue,O[9]=rt,O[10]=ut,O[11]=-1,O[12]=0,O[13]=0,O[14]=Ee,O[15]=0,O}e.perspective=Z;function te(O,V,ve,Pe,Me,Ge,$e){var Ze=1/(ve-V),ht=1/(Pe-Me),Ue=1/($e-Ge),rt=(ve+V)*Ze,ut=(Pe+Me)*ht,Ee=($e+Ge)*Ue;return O[0]=2*Ze,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=2*ht,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=-2*Ue,O[11]=0,O[12]=-rt,O[13]=-ut,O[14]=-Ee,O[15]=1,O}e.ortho=te;function ce(O,V,ve,Pe){var Me,Ge,$e,Ze,ht,Ue,rt,ut,Ee,Te,ye=V[0],Se=V[1],Le=V[2],Ve=Pe[0],nt=Pe[1],Xe=Pe[2],He=ve[0],se=ve[1],pe=ve[2];return Math.abs(ye-He)<yn&&Math.abs(Se-se)<yn&&Math.abs(Le-pe)<yn?n(O):(rt=ye-He,ut=Se-se,Ee=Le-pe,Te=1/Math.sqrt(rt*rt+ut*ut+Ee*Ee),rt*=Te,ut*=Te,Ee*=Te,Me=nt*Ee-Xe*ut,Ge=Xe*rt-Ve*Ee,$e=Ve*ut-nt*rt,Te=Math.sqrt(Me*Me+Ge*Ge+$e*$e),Te?(Te=1/Te,Me*=Te,Ge*=Te,$e*=Te):(Me=0,Ge=0,$e=0),Ze=ut*$e-Ee*Ge,ht=Ee*Me-rt*$e,Ue=rt*Ge-ut*Me,Te=Math.sqrt(Ze*Ze+ht*ht+Ue*Ue),Te?(Te=1/Te,Ze*=Te,ht*=Te,Ue*=Te):(Ze=0,ht=0,Ue=0),O[0]=Me,O[1]=Ze,O[2]=rt,O[3]=0,O[4]=Ge,O[5]=ht,O[6]=ut,O[7]=0,O[8]=$e,O[9]=Ue,O[10]=Ee,O[11]=0,O[12]=-(Me*ye+Ge*Se+$e*Le),O[13]=-(Ze*ye+ht*Se+Ue*Le),O[14]=-(rt*ye+ut*Se+Ee*Le),O[15]=1,O)}e.lookAt=ce;function be(O,V,ve,Pe){var Me=V[0],Ge=V[1],$e=V[2],Ze=Pe[0],ht=Pe[1],Ue=Pe[2],rt=Me-ve[0],ut=Ge-ve[1],Ee=$e-ve[2],Te=rt*rt+ut*ut+Ee*Ee;Te>0&&(Te=1/Math.sqrt(Te),rt*=Te,ut*=Te,Ee*=Te);var ye=ht*Ee-Ue*ut,Se=Ue*rt-Ze*Ee,Le=Ze*ut-ht*rt;return Te=ye*ye+Se*Se+Le*Le,Te>0&&(Te=1/Math.sqrt(Te),ye*=Te,Se*=Te,Le*=Te),O[0]=ye,O[1]=Se,O[2]=Le,O[3]=0,O[4]=ut*Le-Ee*Se,O[5]=Ee*ye-rt*Le,O[6]=rt*Se-ut*ye,O[7]=0,O[8]=rt,O[9]=ut,O[10]=Ee,O[11]=0,O[12]=Me,O[13]=Ge,O[14]=$e,O[15]=1,O}e.targetTo=be;function xe(O,V){a(O);for(var ve=0;ve<4;ve++){var Pe=V[ve];c(O,ve,Pe,1)}return O}e.fromPermutation=xe;function Ie(O){var V=O[0]*O[0]+O[1]*O[1]+O[2]*O[2],ve=O[4]*O[4]+O[5]*O[5]+O[6]*O[6],Pe=O[8]*O[8]+O[9]*O[9]+O[10]*O[10];return Math.sqrt(Math.max(V,ve,Pe))}e.getMaxScaleOnAxis=Ie;var _e=[1,0,0],ae=[0,1,0],ie=[0,0,1];e.rotX90=j(t(),Xr(90),_e),e.rotX180=j(t(),Xr(180),_e),e.rotY90=j(t(),Xr(90),ae),e.rotY180=j(t(),Xr(180),ae),e.rotY270=j(t(),Xr(270),ae),e.rotZ90=j(t(),Xr(90),ie),e.rotZ180=j(t(),Xr(180),ie),e.rotXY90=A(t(),e.rotX90,e.rotY90),e.rotZY90=A(t(),e.rotZ90,e.rotY90),e.rotZYZ90=A(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=A(t(),e.rotZ90,e.rotX180),e.rotY90Z180=A(t(),e.rotY90,e.rotZ180),e.id=r()})(le||(le={}));function _(){return _.zero()}(function(e){function t(){var se=[.1,0,0];return se[0]=0,se}e.zero=t;function r(se){var pe=t();return pe[0]=se[0],pe[1]=se[1],pe[2]=se[2],pe}e.clone=r;function n(se){return isNaN(se[0])||isNaN(se[1])||isNaN(se[2])}e.hasNaN=n;function a(se){return se[0]=NaN,se[1]=NaN,se[2]=NaN,se}e.setNaN=a;function i(se){return l(se.x,se.y,se.z)}e.fromObj=i;function o(se){return{x:se[0],y:se[1],z:se[2]}}e.toObj=o;function s(se,pe,Ae){return se[0]=pe[Ae+0],se[1]=pe[Ae+1],se[2]=pe[Ae+2],se}e.fromArray=s;function u(se,pe,Ae){return pe[Ae+0]=se[0],pe[Ae+1]=se[1],pe[Ae+2]=se[2],pe}e.toArray=u;function l(se,pe,Ae){var Ye=t();return Ye[0]=se,Ye[1]=pe,Ye[2]=Ae,Ye}e.create=l;function c(se){var pe=t();return pe[0]=se[0],pe[1]=se[1],pe[2]=se[2],pe}e.ofArray=c;function d(se,pe,Ae,Ye){return se[0]=pe,se[1]=Ae,se[2]=Ye,se}e.set=d;function f(se,pe){return se[0]=pe[0],se[1]=pe[1],se[2]=pe[2],se}e.copy=f;function h(se,pe,Ae){return se[0]=pe[0]+Ae[0],se[1]=pe[1]+Ae[1],se[2]=pe[2]+Ae[2],se}e.add=h;function v(se,pe,Ae){return se[0]=pe[0]-Ae[0],se[1]=pe[1]-Ae[1],se[2]=pe[2]-Ae[2],se}e.sub=v;function p(se,pe,Ae){return se[0]=pe[0]*Ae[0],se[1]=pe[1]*Ae[1],se[2]=pe[2]*Ae[2],se}e.mul=p;function g(se,pe,Ae){return se[0]=pe[0]/Ae[0],se[1]=pe[1]/Ae[1],se[2]=pe[2]/Ae[2],se}e.div=g;function m(se,pe,Ae){return se[0]=pe[0]*Ae,se[1]=pe[1]*Ae,se[2]=pe[2]*Ae,se}e.scale=m;function y(se,pe,Ae,Ye){return se[0]=pe[0]+Ae[0]*Ye,se[1]=pe[1]+Ae[1]*Ye,se[2]=pe[2]+Ae[2]*Ye,se}e.scaleAndAdd=y;function b(se,pe,Ae,Ye){return se[0]=pe[0]-Ae[0]*Ye,se[1]=pe[1]-Ae[1]*Ye,se[2]=pe[2]-Ae[2]*Ye,se}e.scaleAndSub=b;function S(se,pe,Ae){return se[0]=pe[0]+Ae,se[1]=pe[1]+Ae,se[2]=pe[2]+Ae,se}e.addScalar=S;function x(se,pe,Ae){return se[0]=pe[0]-Ae,se[1]=pe[1]-Ae,se[2]=pe[2]-Ae,se}e.subScalar=x;function C(se,pe){return se[0]=Math.round(pe[0]),se[1]=Math.round(pe[1]),se[2]=Math.round(pe[2]),se}e.round=C;function w(se,pe){return se[0]=Math.ceil(pe[0]),se[1]=Math.ceil(pe[1]),se[2]=Math.ceil(pe[2]),se}e.ceil=w;function A(se,pe){return se[0]=Math.floor(pe[0]),se[1]=Math.floor(pe[1]),se[2]=Math.floor(pe[2]),se}e.floor=A;function I(se,pe){return se[0]=Math.trunc(pe[0]),se[1]=Math.trunc(pe[1]),se[2]=Math.trunc(pe[2]),se}e.trunc=I;function D(se,pe){return se[0]=Math.abs(pe[0]),se[1]=Math.abs(pe[1]),se[2]=Math.abs(pe[2]),se}e.abs=D;function k(se,pe,Ae){return se[0]=Math.min(pe[0],Ae[0]),se[1]=Math.min(pe[1],Ae[1]),se[2]=Math.min(pe[2],Ae[2]),se}e.min=k;function R(se,pe,Ae){return se[0]=Math.max(pe[0],Ae[0]),se[1]=Math.max(pe[1],Ae[1]),se[2]=Math.max(pe[2],Ae[2]),se}e.max=R;function L(se,pe){var Ae=pe[0]-se[0],Ye=pe[1]-se[1],ct=pe[2]-se[2];return Math.sqrt(Ae*Ae+Ye*Ye+ct*ct)}e.distance=L;function H(se,pe){var Ae=pe[0]-se[0],Ye=pe[1]-se[1],ct=pe[2]-se[2];return Ae*Ae+Ye*Ye+ct*ct}e.squaredDistance=H;function B(se){var pe=se[0],Ae=se[1],Ye=se[2];return Math.sqrt(pe*pe+Ae*Ae+Ye*Ye)}e.magnitude=B;function j(se){var pe=se[0],Ae=se[1],Ye=se[2];return pe*pe+Ae*Ae+Ye*Ye}e.squaredMagnitude=j;function Q(se,pe,Ae){return m(se,q(se,pe),Ae)}e.setMagnitude=Q;function G(se,pe){return se[0]=-pe[0],se[1]=-pe[1],se[2]=-pe[2],se}e.negate=G;function W(se,pe){return se[0]=1/pe[0],se[1]=1/pe[1],se[2]=1/pe[2],se}e.inverse=W;function q(se,pe){var Ae=pe[0],Ye=pe[1],ct=pe[2],St=Ae*Ae+Ye*Ye+ct*ct;return St>0&&(St=1/Math.sqrt(St),se[0]=pe[0]*St,se[1]=pe[1]*St,se[2]=pe[2]*St),se}e.normalize=q;function J(se,pe){return se[0]*pe[0]+se[1]*pe[1]+se[2]*pe[2]}e.dot=J;function he(se,pe,Ae){var Ye=pe[0],ct=pe[1],St=pe[2],Bt=Ae[0],rr=Ae[1],hr=Ae[2];return se[0]=ct*hr-St*rr,se[1]=St*Bt-Ye*hr,se[2]=Ye*rr-ct*Bt,se}e.cross=he;function $(se,pe,Ae,Ye){var ct=pe[0],St=pe[1],Bt=pe[2];return se[0]=ct+Ye*(Ae[0]-ct),se[1]=St+Ye*(Ae[1]-St),se[2]=Bt+Ye*(Ae[2]-Bt),se}e.lerp=$;var X=t();function U(se,pe,Ae,Ye){var ct=ki(J(pe,Ae),-1,1),St=Math.acos(ct)*Ye;return y(X,Ae,pe,-ct),q(X,X),h(se,m(se,pe,Math.cos(St)),m(X,X,Math.sin(St)))}e.slerp=U;function z(se,pe,Ae,Ye,ct,St){var Bt=St*St,rr=Bt*(2*St-3)+1,hr=Bt*(St-2)+St,Lt=Bt*(St-1),En=Bt*(3-2*St);return se[0]=pe[0]*rr+Ae[0]*hr+Ye[0]*Lt+ct[0]*En,se[1]=pe[1]*rr+Ae[1]*hr+Ye[1]*Lt+ct[1]*En,se[2]=pe[2]*rr+Ae[2]*hr+Ye[2]*Lt+ct[2]*En,se}e.hermite=z;function ee(se,pe,Ae,Ye,ct,St){var Bt=1-St,rr=Bt*Bt,hr=St*St,Lt=rr*Bt,En=3*St*rr,ha=3*hr*Bt,pa=hr*St;return se[0]=pe[0]*Lt+Ae[0]*En+Ye[0]*ha+ct[0]*pa,se[1]=pe[1]*Lt+Ae[1]*En+Ye[1]*ha+ct[1]*pa,se[2]=pe[2]*Lt+Ae[2]*En+Ye[2]*ha+ct[2]*pa,se}e.bezier=ee;function Y(se,pe,Ae,Ye,ct){return se[0]=$A(pe[0],Ae[0],Ye[0],ct),se[1]=$A(pe[1],Ae[1],Ye[1],ct),se[2]=$A(pe[2],Ae[2],Ye[2],ct),se}e.quadraticBezier=Y;function Z(se,pe,Ae,Ye,ct,St,Bt){return se[0]=fS(pe[0],Ae[0],Ye[0],ct[0],St,Bt),se[1]=fS(pe[1],Ae[1],Ye[1],ct[1],St,Bt),se[2]=fS(pe[2],Ae[2],Ye[2],ct[2],St,Bt),se}e.spline=Z;function te(se,pe){var Ae=Math.random()*2*Math.PI,Ye=Math.random()*2-1,ct=Math.sqrt(1-Ye*Ye)*pe;return se[0]=Math.cos(Ae)*ct,se[1]=Math.sin(Ae)*ct,se[2]=Ye*pe,se}e.random=te;function ce(se,pe,Ae){var Ye=pe[0],ct=pe[1],St=pe[2],Bt=1/(Ae[3]*Ye+Ae[7]*ct+Ae[11]*St+Ae[15]||1);return se[0]=(Ae[0]*Ye+Ae[4]*ct+Ae[8]*St+Ae[12])*Bt,se[1]=(Ae[1]*Ye+Ae[5]*ct+Ae[9]*St+Ae[13])*Bt,se[2]=(Ae[2]*Ye+Ae[6]*ct+Ae[10]*St+Ae[14])*Bt,se}e.transformMat4=ce;function be(se,pe,Ae,Ye,ct,St){var Bt=pe[0+ct],rr=pe[1+ct],hr=pe[2+ct],Lt=1/(Ae[3+St]*Bt+Ae[7+St]*rr+Ae[11+St]*hr+Ae[15+St]||1);return se[0+Ye]=(Ae[0+St]*Bt+Ae[4+St]*rr+Ae[8+St]*hr+Ae[12+St])*Lt,se[1+Ye]=(Ae[1+St]*Bt+Ae[5+St]*rr+Ae[9+St]*hr+Ae[13+St])*Lt,se[2+Ye]=(Ae[2+St]*Bt+Ae[6+St]*rr+Ae[10+St]*hr+Ae[14+St])*Lt,se}e.transformMat4Offset=be;function xe(se,pe,Ae){var Ye=pe[0],ct=pe[1],St=pe[2];return se[0]=Ye*Ae[0]+ct*Ae[3]+St*Ae[6],se[1]=Ye*Ae[1]+ct*Ae[4]+St*Ae[7],se[2]=Ye*Ae[2]+ct*Ae[5]+St*Ae[8],se}e.transformMat3=xe;function Ie(se,pe,Ae){var Ye=pe[0],ct=pe[1],St=pe[2],Bt=Ae[0],rr=Ae[1],hr=Ae[2],Lt=Ae[3],En=Lt*Ye+rr*St-hr*ct,ha=Lt*ct+hr*Ye-Bt*St,pa=Lt*St+Bt*ct-rr*Ye,ui=-Bt*Ye-rr*ct-hr*St;return se[0]=En*Lt+ui*-Bt+ha*-hr-pa*-rr,se[1]=ha*Lt+ui*-rr+pa*-Bt-En*-hr,se[2]=pa*Lt+ui*-hr+En*-rr-ha*-Bt,se}e.transformQuat=Ie;function _e(se,pe){var Ae=Math.sqrt(j(se)*j(pe));if(Ae===0)return Math.PI/2;var Ye=J(se,pe)/Ae;return Math.acos(ki(Ye,-1,1))}e.angle=_e;var ae=t(),ie=t(),O=t(),V=t(),ve=t(),Pe=t(),Me=t();function Ge(se,pe,Ae,Ye){v(ae,se,pe),v(ie,Ae,pe),v(O,pe,Ae),v(V,Ye,Ae),he(ve,ae,ie),he(Pe,O,V);var ct=_e(ve,Pe);return he(Me,ve,Pe),J(ie,Me)>0?ct:-ct}e.dihedralAngle=Ge;function $e(se,pe){return se[0]===pe[0]&&se[1]===pe[1]&&se[2]===pe[2]}e.exactEquals=$e;function Ze(se,pe){var Ae=se[0],Ye=se[1],ct=se[2],St=pe[0],Bt=pe[1],rr=pe[2];return Math.abs(Ae-St)<=yn*Math.max(1,Math.abs(Ae),Math.abs(St))&&Math.abs(Ye-Bt)<=yn*Math.max(1,Math.abs(Ye),Math.abs(Bt))&&Math.abs(ct-rr)<=yn*Math.max(1,Math.abs(ct),Math.abs(rr))}e.equals=Ze;var ht=t();function Ue(se,pe,Ae){var Ye=_e(pe,Ae);if(Math.abs(Ye)<1e-4)return le.setIdentity(se);if(Math.abs(Ye-Math.PI)<yn)return le.fromScaling(se,e.negUnit);var ct=he(ht,pe,Ae);return le.fromRotation(se,Ye,ct)}e.makeRotation=Ue;function rt(se){return se[0]===0&&se[1]===0&&se[2]===0}e.isZero=rt;function ut(se,pe,Ae,Ye){v(se,f(se,pe),Ye);var ct=J(Ae,se)/j(Ae);return h(se,m(se,f(se,Ae),ct),Ye)}e.projectPointOnVector=ut;function Ee(se,pe,Ae){var Ye=J(Ae,pe)/j(Ae);return m(se,Ae,Ye)}e.projectOnVector=Ee;var Te=t();function ye(se,pe,Ae){return Ee(Te,pe,Ae),v(se,pe,Te)}e.projectOnPlane=ye;function Se(se,pe,Ae){return q(se,he(se,he(se,pe,Ae),pe))}e.orthogonalize=Se;function Le(se,pe,Ae){return J(pe,Ae)>0?f(se,pe):G(se,f(se,pe)),se}e.matchDirection=Le;var Ve=t(),nt=t();function Xe(se,pe,Ae,Ye){return v(Ve,Ae,pe),v(nt,Ye,pe),q(se,he(se,Ve,nt))}e.triangleNormal=Xe;function He(se,pe){return"["+se[0].toPrecision(pe)+" "+se[1].toPrecision(pe)+" "+se[2].toPrecision(pe)+"]"}e.toString=He,e.origin=l(0,0,0),e.unit=l(1,1,1),e.negUnit=l(-1,-1,-1),e.unitX=l(1,0,0),e.unitY=l(0,1,0),e.unitZ=l(0,0,1),e.negUnitX=l(-1,0,0),e.negUnitY=l(0,-1,0),e.negUnitZ=l(0,0,-1)})(_||(_={}));function qn(){return qn.zero()}(function(e){function t(){var $=[.1,0,0,0,0,0,0,0,0];return $[0]=0,$}e.zero=t;function r(){var $=t();return $[0]=1,$[1]=0,$[2]=0,$[3]=0,$[4]=1,$[5]=0,$[6]=0,$[7]=0,$[8]=1,$}e.identity=r;function n($){return $[0]=1,$[1]=0,$[2]=0,$[3]=0,$[4]=1,$[5]=0,$[6]=0,$[7]=0,$[8]=1,$}e.setIdentity=n;function a($,X,U){return X[U+0]=$[0],X[U+1]=$[1],X[U+2]=$[2],X[U+3]=$[3],X[U+4]=$[4],X[U+5]=$[5],X[U+6]=$[6],X[U+7]=$[7],X[U+8]=$[8],X}e.toArray=a;function i($,X,U){return $[0]=X[U+0],$[1]=X[U+1],$[2]=X[U+2],$[3]=X[U+3],$[4]=X[U+4],$[5]=X[U+5],$[6]=X[U+6],$[7]=X[U+7],$[8]=X[U+8],$}e.fromArray=i;function o($,X){return $[0]=X[0],$[1]=X[1],$[2]=X[2],$[3]=X[4],$[4]=X[5],$[5]=X[6],$[6]=X[8],$[7]=X[9],$[8]=X[10],$}e.fromMat4=o;function s($,X,U,z,ee,Y,Z,te,ce){var be=t();return be[0]=$,be[1]=X,be[2]=U,be[3]=z,be[4]=ee,be[5]=Y,be[6]=Z,be[7]=te,be[8]=ce,be}e.create=s;var u=r();function l($,X){return f($,u,typeof X>"u"?yn:X)}e.isIdentity=l;function c($){for(var X=0;X<9;X++)if(isNaN($[X]))return!0;return!1}e.hasNaN=c;function d($){return p(t(),$)}e.clone=d;function f($,X,U){for(var z=0;z<9;z++)if(Math.abs($[z]-X[z])>U)return!1;return!0}e.areEqual=f;function h($,X,U,z){$[3*U+X]=z}e.setValue=h;function v($,X,U){return $[3*U+X]}e.getValue=v;function p($,X){return $[0]=X[0],$[1]=X[1],$[2]=X[2],$[3]=X[3],$[4]=X[4],$[5]=X[5],$[6]=X[6],$[7]=X[7],$[8]=X[8],$}e.copy=p;function g($,X){if($===X){var U=X[1],z=X[2],ee=X[5];$[1]=X[3],$[2]=X[6],$[3]=U,$[5]=X[7],$[6]=z,$[7]=ee}else $[0]=X[0],$[1]=X[3],$[2]=X[6],$[3]=X[1],$[4]=X[4],$[5]=X[7],$[6]=X[2],$[7]=X[5],$[8]=X[8];return $}e.transpose=g;function m($,X){var U=X[0],z=X[1],ee=X[2],Y=X[3],Z=X[4],te=X[5],ce=X[6],be=X[7],xe=X[8],Ie=xe*Z-te*be,_e=-xe*Y+te*ce,ae=be*Y-Z*ce,ie=U*Ie+z*_e+ee*ae;return ie?(ie=1/ie,$[0]=Ie*ie,$[1]=(-xe*z+ee*be)*ie,$[2]=(te*z-ee*Z)*ie,$[3]=_e*ie,$[4]=(xe*U-ee*ce)*ie,$[5]=(-te*U+ee*Y)*ie,$[6]=ae*ie,$[7]=(-be*U+z*ce)*ie,$[8]=(Z*U-z*Y)*ie,$):(console.warn("non-invertible matrix.",X),$)}e.invert=m;function y($,X){return $===X?($[3]=X[1],$[6]=X[2],$[7]=X[5]):($[0]=X[0],$[1]=X[1],$[2]=X[2],$[3]=X[1],$[4]=X[4],$[5]=X[5],$[6]=X[2],$[7]=X[5],$[8]=X[8]),$}e.symmtricFromUpper=y;function b($,X){return $===X?($[1]=X[3],$[2]=X[6],$[5]=X[7]):($[0]=X[0],$[1]=X[3],$[2]=X[6],$[3]=X[3],$[4]=X[4],$[5]=X[7],$[6]=X[6],$[7]=X[7],$[8]=X[8]),$}e.symmtricFromLower=b;function S($){var X=$[0],U=$[1],z=$[2],ee=$[3],Y=$[4],Z=$[5],te=$[6],ce=$[7],be=$[8],xe=be*Y-Z*ce,Ie=-be*ee+Z*te,_e=ce*ee-Y*te;return X*xe+U*Ie+z*_e}e.determinant=S;function x($){return $[0]+$[4]+$[8]}e.trace=x;function C($,X,U){return $[0]=X[0]-U[0],$[1]=X[1]-U[1],$[2]=X[2]-U[2],$[3]=X[3]-U[3],$[4]=X[4]-U[4],$[5]=X[5]-U[5],$[6]=X[6]-U[6],$[7]=X[7]-U[7],$[8]=X[8]-U[8],$}e.sub=C;function w($,X,U){return $[0]=X[0]+U[0],$[1]=X[1]+U[1],$[2]=X[2]+U[2],$[3]=X[3]+U[3],$[4]=X[4]+U[4],$[5]=X[5]+U[5],$[6]=X[6]+U[6],$[7]=X[7]+U[7],$[8]=X[8]+U[8],$}e.add=w;function A($,X,U){var z=X[0],ee=X[1],Y=X[2],Z=X[3],te=X[4],ce=X[5],be=X[6],xe=X[7],Ie=X[8],_e=U[0],ae=U[1],ie=U[2],O=U[3],V=U[4],ve=U[5],Pe=U[6],Me=U[7],Ge=U[8];return $[0]=_e*z+ae*Z+ie*be,$[1]=_e*ee+ae*te+ie*xe,$[2]=_e*Y+ae*ce+ie*Ie,$[3]=O*z+V*Z+ve*be,$[4]=O*ee+V*te+ve*xe,$[5]=O*Y+V*ce+ve*Ie,$[6]=Pe*z+Me*Z+Ge*be,$[7]=Pe*ee+Me*te+Ge*xe,$[8]=Pe*Y+Me*ce+Ge*Ie,$}e.mul=A;function I($,X,U){return $[0]=X[0]-U,$[1]=X[1]-U,$[2]=X[2]-U,$[3]=X[3]-U,$[4]=X[4]-U,$[5]=X[5]-U,$[6]=X[6]-U,$[7]=X[7]-U,$[8]=X[8]-U,$}e.subScalar=I;function D($,X,U){return $[0]=X[0]+U,$[1]=X[1]+U,$[2]=X[2]+U,$[3]=X[3]+U,$[4]=X[4]+U,$[5]=X[5]+U,$[6]=X[6]+U,$[7]=X[7]+U,$[8]=X[8]+U,$}e.addScalar=D;function k($,X,U){return $[0]=X[0]*U,$[1]=X[1]*U,$[2]=X[2]*U,$[3]=X[3]*U,$[4]=X[4]*U,$[5]=X[5]*U,$[6]=X[6]*U,$[7]=X[7]*U,$[8]=X[8]*U,$}e.mulScalar=k;var R=Math.PI/3,L=t();function H($,X){var U=X[1]*X[1]+X[2]*X[2]+X[5]*X[5];if(U===0)$[0]=X[0],$[1]=X[4],$[2]=X[8];else{var z=x(X)/3,ee=X[0]-z,Y=X[4]-z,Z=X[8]-z,te=ee*ee+Y*Y+Z*Z+2*U,ce=Math.sqrt(te/6);k(L,e.Identity,z),C(L,X,L),k(L,L,1/ce);var be=S(L)/2,xe=be<=-1?R:be>=1?0:Math.acos(be)/3;$[0]=z+2*ce*Math.cos(xe),$[2]=z+2*ce*Math.cos(xe+2*R),$[1]=3*z-$[0]-$[2]}return $}e.symmetricEigenvalues=H;var B=[.1,0,0],j=[.1,0,0],Q=[.1,0,0],G=[.1,0,0],W=[.1,0,0],q=[.1,0,0];function J($,X,U){_.set(B,X[0]-U,X[1],X[2]),_.set(j,X[1],X[4]-U,X[5]),_.set(Q,X[2],X[5],X[8]-U),_.cross(G,B,j),_.cross(W,B,Q),_.cross(q,j,Q);var z=_.dot(G,G),ee=_.dot(W,W),Y=_.dot(q,q),Z=z,te=0;return ee>Z&&(Z=ee,te=1),Y>Z&&(te=2),te===0?_.scale($,G,1/Math.sqrt(z)):te===1?_.scale($,W,1/Math.sqrt(ee)):_.scale($,q,1/Math.sqrt(Y)),$}e.eigenvector=J;function he($,X){return o($,X),m($,$),g($,$),$}e.directionTransform=he,e.Identity=r()})(qn||(qn={}));function Ke(){return Ke.zero()}(function(e){function t(){var A=[.1,0];return A[0]=0,A}e.zero=t;function r(A){var I=t();return I[0]=A[0],I[1]=A[1],I}e.clone=r;function n(A,I){var D=t();return D[0]=A,D[1]=I,D}e.create=n;function a(A){return isNaN(A[0])||isNaN(A[1])}e.hasNaN=a;function i(A,I,D){return I[D+0]=A[0],I[D+1]=A[1],I}e.toArray=i;function o(A,I,D){return A[0]=I[D+0],A[1]=I[D+1],A}e.fromArray=o;function s(A,I){return A[0]=I[0],A[1]=I[1],A}e.copy=s;function u(A,I,D){return A[0]=I,A[1]=D,A}e.set=u;function l(A,I,D){return A[0]=I[0]+D[0],A[1]=I[1]+D[1],A}e.add=l;function c(A,I,D){return A[0]=I[0]-D[0],A[1]=I[1]-D[1],A}e.sub=c;function d(A,I,D){return A[0]=I[0]*D[0],A[1]=I[1]*D[1],A}e.mul=d;function f(A,I,D){return A[0]=I[0]/D[0],A[1]=I[1]/D[1],A}e.div=f;function h(A,I,D){return A[0]=I[0]*D,A[1]=I[1]*D,A}e.scale=h;function v(A,I){return A[0]=Math.round(I[0]),A[1]=Math.round(I[1]),A}e.round=v;function p(A,I){return A[0]=Math.ceil(I[0]),A[1]=Math.ceil(I[1]),A}e.ceil=p;function g(A,I){return A[0]=Math.floor(I[0]),A[1]=Math.floor(I[1]),A}e.floor=g;function m(A,I){var D=I[0]-A[0],k=I[1]-A[1];return Math.sqrt(D*D+k*k)}e.distance=m;function y(A,I){var D=I[0]-A[0],k=I[1]-A[1];return D*D+k*k}e.squaredDistance=y;function b(A){var I=A[0],D=A[1];return Math.sqrt(I*I+D*D)}e.magnitude=b;function S(A){var I=A[0],D=A[1];return I*I+D*D}e.squaredMagnitude=S;function x(A,I){return A[0]=1/I[0],A[1]=1/I[1],A}e.inverse=x;function C(A,I){return A[0]===I[0]&&A[1]===I[1]}e.areEqual=C;function w(A,I){return"["+A[0].toPrecision(I)+" "+A[1].toPrecision(I)+"}]"}e.toString=w})(Ke||(Ke={}));function wr(){return wr.zero()}(function(e){function t(){var R=[.1,0,0,0];return R[0]=0,R}e.zero=t;function r(R){var L=t();return L[0]=R[0],L[1]=R[1],L[2]=R[2],L[3]=R[3],L}e.clone=r;function n(R,L,H,B){var j=t();return j[0]=R,j[1]=L,j[2]=H,j[3]=B,j}e.create=n;function a(R,L){return R[0]=L.center[0],R[1]=L.center[1],R[2]=L.center[2],R[3]=L.radius,R}e.fromSphere=a;function i(R){return a(t(),R)}e.ofSphere=i;function o(R){return isNaN(R[0])||isNaN(R[1])||isNaN(R[2])||isNaN(R[3])}e.hasNaN=o;function s(R,L,H){return L[H+0]=R[0],L[H+1]=R[1],L[H+2]=R[2],L[H+3]=R[3],L}e.toArray=s;function u(R,L,H){return R[0]=L[H+0],R[1]=L[H+1],R[2]=L[H+2],R[3]=L[H+3],R}e.fromArray=u;function l(R,L,H){L[H+0]=R[0],L[H+1]=R[1],L[H+2]=R[2]}e.toVec3Array=l;function c(R,L,H){return R[0]=L[H+0],R[1]=L[H+1],R[2]=L[H+2],R[3]=0,R}e.fromVec3Array=c;function d(R,L){return R[0]=L[0],R[1]=L[1],R[2]=L[2],R[3]=L[3],R}e.copy=d;function f(R,L,H,B,j){return R[0]=L,R[1]=H,R[2]=B,R[3]=j,R}e.set=f;function h(R,L,H){return R[0]=L[0]+H[0],R[1]=L[1]+H[1],R[2]=L[2]+H[2],R[3]=L[3]+H[3],R}e.add=h;function v(R,L){var H=L[0]-R[0],B=L[1]-R[1],j=L[2]-R[2],Q=L[3]-R[3];return Math.sqrt(H*H+B*B+j*j+Q*Q)}e.distance=v;function p(R,L,H){return R[0]=L[0]*H,R[1]=L[1]*H,R[2]=L[2]*H,R[4]=L[4]*H,R}e.scale=p;function g(R,L){return R[0]=Math.round(L[0]),R[1]=Math.round(L[1]),R[2]=Math.round(L[2]),R[3]=Math.round(L[3]),R}e.round=g;function m(R,L){return R[0]=Math.ceil(L[0]),R[1]=Math.ceil(L[1]),R[2]=Math.ceil(L[2]),R[3]=Math.ceil(L[3]),R}e.ceil=m;function y(R,L){return R[0]=Math.floor(L[0]),R[1]=Math.floor(L[1]),R[2]=Math.floor(L[2]),R[3]=Math.floor(L[3]),R}e.floor=y;function b(R,L){var H=L[0]-R[0],B=L[1]-R[1],j=L[2]-R[2],Q=L[3]-R[3];return H*H+B*B+j*j+Q*Q}e.squaredDistance=b;function S(R){var L=R[0],H=R[1],B=R[2],j=R[3];return Math.sqrt(L*L+H*H+B*B+j*j)}e.norm=S;function x(R){var L=R[0],H=R[1],B=R[2],j=R[3];return L*L+H*H+B*B+j*j}e.squaredNorm=x;function C(R,L,H){var B=L[0],j=L[1],Q=L[2],G=L[3];return R[0]=H[0]*B+H[4]*j+H[8]*Q+H[12]*G,R[1]=H[1]*B+H[5]*j+H[9]*Q+H[13]*G,R[2]=H[2]*B+H[6]*j+H[10]*Q+H[14]*G,R[3]=H[3]*B+H[7]*j+H[11]*Q+H[15]*G,R}e.transformMat4=C;function w(R,L){return R[0]*L[0]+R[1]*L[1]+R[2]*L[2]+R[3]*L[3]}e.dot=w;function A(R,L){return R[0]=1/L[0],R[1]=1/L[1],R[2]=1/L[2],R[3]=1/L[3],R}e.inverse=A;function I(R,L){return R[0]===L[0]&&R[1]===L[1]&&R[2]===L[2]&&R[3]===L[3]}e.exactEquals=I;function D(R,L){var H=R[0],B=R[1],j=R[2],Q=R[3],G=L[0],W=L[1],q=L[2],J=L[3];return Math.abs(H-G)<=yn*Math.max(1,Math.abs(H),Math.abs(G))&&Math.abs(B-W)<=yn*Math.max(1,Math.abs(B),Math.abs(W))&&Math.abs(j-q)<=yn*Math.max(1,Math.abs(j),Math.abs(q))&&Math.abs(Q-J)<=yn*Math.max(1,Math.abs(Q),Math.abs(J))}e.equals=D;function k(R,L){return"["+R[0].toPrecision(L)+" "+R[1].toPrecision(L)+" "+R[2].toPrecision(L)+"  "+R[3].toPrecision(L)+"]"}e.toString=k})(wr||(wr={}));function Gn(){return Gn.zero()}(function(e){function t(){var q=[.1,0,0,0];return q[0]=0,q}e.zero=t;function r(){var q=t();return q[3]=1,q}e.identity=r;function n(q){q[0]=0,q[1]=0,q[2]=0,q[3]=1}e.setIdentity=n;function a(q){return isNaN(q[0])||isNaN(q[1])||isNaN(q[2])||isNaN(q[3])}e.hasNaN=a;function i(q,J,he,$){var X=r();return X[0]=q,X[1]=J,X[2]=he,X[3]=$,X}e.create=i;function o(q,J,he){he=he*.5;var $=Math.sin(he);return q[0]=$*J[0],q[1]=$*J[1],q[2]=$*J[2],q[3]=Math.cos(he),q}e.setAxisAngle=o;function s(q,J){var he=Math.acos(J[3])*2,$=Math.sin(he/2);return $!==0?(q[0]=J[0]/$,q[1]=J[1]/$,q[2]=J[2]/$):(q[0]=1,q[1]=0,q[2]=0),he}e.getAxisAngle=s;function u(q,J,he){var $=J[0],X=J[1],U=J[2],z=J[3],ee=he[0],Y=he[1],Z=he[2],te=he[3];return q[0]=$*te+z*ee+X*Z-U*Y,q[1]=X*te+z*Y+U*ee-$*Z,q[2]=U*te+z*Z+$*Y-X*ee,q[3]=z*te-$*ee-X*Y-U*Z,q}e.multiply=u;function l(q,J,he){he*=.5;var $=J[0],X=J[1],U=J[2],z=J[3],ee=Math.sin(he),Y=Math.cos(he);return q[0]=$*Y+z*ee,q[1]=X*Y+U*ee,q[2]=U*Y-X*ee,q[3]=z*Y-$*ee,q}e.rotateX=l;function c(q,J,he){he*=.5;var $=J[0],X=J[1],U=J[2],z=J[3],ee=Math.sin(he),Y=Math.cos(he);return q[0]=$*Y-U*ee,q[1]=X*Y+z*ee,q[2]=U*Y+$*ee,q[3]=z*Y-X*ee,q}e.rotateY=c;function d(q,J,he){he*=.5;var $=J[0],X=J[1],U=J[2],z=J[3],ee=Math.sin(he),Y=Math.cos(he);return q[0]=$*Y+X*ee,q[1]=X*Y-$*ee,q[2]=U*Y+z*ee,q[3]=z*Y-U*ee,q}e.rotateZ=d;function f(q,J){var he=J[0],$=J[1],X=J[2];return q[0]=he,q[1]=$,q[2]=X,q[3]=Math.sqrt(Math.abs(1-he*he-$*$-X*X)),q}e.calculateW=f;function h(q,J,he,$){var X=J[0],U=J[1],z=J[2],ee=J[3],Y=he[0],Z=he[1],te=he[2],ce=he[3],be,xe,Ie,_e,ae;return xe=X*Y+U*Z+z*te+ee*ce,xe<0&&(xe=-xe,Y=-Y,Z=-Z,te=-te,ce=-ce),1-xe>1e-6?(be=Math.acos(xe),Ie=Math.sin(be),_e=Math.sin((1-$)*be)/Ie,ae=Math.sin($*be)/Ie):(_e=1-$,ae=$),q[0]=_e*X+ae*Y,q[1]=_e*U+ae*Z,q[2]=_e*z+ae*te,q[3]=_e*ee+ae*ce,q}e.slerp=h;function v(q,J){var he=J[0],$=J[1],X=J[2],U=J[3],z=he*he+$*$+X*X+U*U,ee=z?1/z:0;return q[0]=-he*ee,q[1]=-$*ee,q[2]=-X*ee,q[3]=U*ee,q}e.invert=v;function p(q,J){return q[0]=-J[0],q[1]=-J[1],q[2]=-J[2],q[3]=J[3],q}e.conjugate=p;function g(q,J){var he=J[0]+J[4]+J[8],$;if(he>0)$=Math.sqrt(he+1),q[3]=.5*$,$=.5/$,q[0]=(J[5]-J[7])*$,q[1]=(J[6]-J[2])*$,q[2]=(J[1]-J[3])*$;else{var X=0;J[4]>J[0]&&(X=1),J[8]>J[X*3+X]&&(X=2);var U=(X+1)%3,z=(X+2)%3;$=Math.sqrt(J[X*3+X]-J[U*3+U]-J[z*3+z]+1),q[X]=.5*$,$=.5/$,q[3]=(J[U*3+z]-J[z*3+U])*$,q[U]=(J[U*3+X]+J[X*3+U])*$,q[z]=(J[z*3+X]+J[X*3+z])*$}return q}e.fromMat3=g;var m=[0,0,0];function y(q,J,he){var $=_.dot(J,he)+1;return $<yn?($=0,Math.abs(J[0])>Math.abs(J[2])?_.set(m,-J[1],J[0],0):_.set(m,0,-J[2],J[1])):_.cross(m,J,he),q[0]=m[0],q[1]=m[1],q[2]=m[2],q[3]=$,I(q,q),q}e.fromUnitVec3=y;function b(q){var J=t();return J[0]=q[0],J[1]=q[1],J[2]=q[2],J[3]=q[3],J}e.clone=b;function S(q,J,he){return J[he+0]=q[0],J[he+1]=q[1],J[he+2]=q[2],J[he+3]=q[3],J}e.toArray=S;function x(q,J,he){return q[0]=J[he+0],q[1]=J[he+1],q[2]=J[he+2],q[3]=J[he+3],q}e.fromArray=x;function C(q,J){return q[0]=J[0],q[1]=J[1],q[2]=J[2],q[3]=J[3],q}e.copy=C;function w(q,J,he,$,X){return q[0]=J,q[1]=he,q[2]=$,q[3]=X,q}e.set=w;function A(q,J,he){return q[0]=J[0]+he[0],q[1]=J[1]+he[1],q[2]=J[2]+he[2],q[3]=J[3]+he[3],q}e.add=A;function I(q,J){var he=J[0],$=J[1],X=J[2],U=J[3],z=he*he+$*$+X*X+U*U;return z>0&&(z=1/Math.sqrt(z),q[0]=he*z,q[1]=$*z,q[2]=X*z,q[3]=U*z),q}e.normalize=I;var D=[0,0,0],k=[1,0,0],R=[0,1,0];function L(q,J,he){var $=_.dot(J,he);return $<-.999999?(_.cross(D,k,J),_.magnitude(D)<1e-6&&_.cross(D,R,J),_.normalize(D,D),o(q,D,Math.PI),q):$>.999999?(q[0]=0,q[1]=0,q[2]=0,q[3]=1,q):(_.cross(D,J,he),q[0]=D[0],q[1]=D[1],q[2]=D[2],q[3]=1+$,I(q,q))}e.rotationTo=L;var H=t(),B=t();function j(q,J,he,$,X,U){return h(H,J,X,U),h(B,he,$,U),h(q,H,B,2*U*(1-U)),q}e.sqlerp=j;var Q=[0,0,0,0,0,0,0,0,0];function G(q,J,he,$){return Q[0]=he[0],Q[3]=he[1],Q[6]=he[2],Q[1]=$[0],Q[4]=$[1],Q[7]=$[2],Q[2]=-J[0],Q[5]=-J[1],Q[8]=-J[2],I(q,g(q,Q))}e.setAxes=G;function W(q,J){return"["+q[0].toPrecision(J)+" "+q[1].toPrecision(J)+" "+q[2].toPrecision(J)+"  "+q[3].toPrecision(J)+"]"}e.toString=W,e.Identity=r()})(Gn||(Gn={}));var Pr;(function(e){function t(x,C,w){for(var A=[],I=0;I<C.length;I++)A[I]=C[C.length-I-1];for(var D=[1],I=1;I<x.length;I++)D[I]=x[A[I-1]];return{dimensions:x,axisOrderFastToSlow:A,axisOrderSlowToFast:C,accessDimensions:D,defaultCtor:w||Float64Array}}function r(x,C){return{space:x,data:C}}e.create=r;function n(x,C,w){var A=t(x,C,w),I=h(A),D=I.get,k=I.set,R=I.add,L=I.dataOffset,H=I.getCoords;return{rank:x.length,dimensions:x,axisOrderSlowToFast:C,create:v(A),get:D,set:k,add:R,dataOffset:L,getCoords:H}}e.Space=n;function a(x){return x}e.Data1=a;function i(x,C){return n([x],[0],C)}e.Vector=i;function o(x,C,w){return n([x,C],[1,0],w)}e.ColumnMajorMatrix=o;function s(x,C,w){return n([x,C],[0,1],w)}e.RowMajorMatrix=s;function u(x,C,w){if(C.rank!==2)throw new Error("Invalid tensor rank");for(var A=Math.min(4,C.dimensions[0]),I=Math.min(4,C.dimensions[1]),D=0;D<A;D++)for(var k=0;k<I;k++)le.setValue(x,D,k,C.get(w,D,k));return x}e.toMat4=u;function l(x,C,w){if(C.rank!==2)throw new Error("Invalid tensor rank");for(var A=Math.min(3,C.dimensions[0]),I=Math.min(3,C.dimensions[1]),D=0;D<A;D++)for(var k=0;k<I;k++)qn.setValue(x,D,k,C.get(w,D,k));return x}e.toMat3=l;function c(x,C,w){if(C.rank!==1)throw new Error("Invalid tensor rank");for(var A=Math.min(3,C.dimensions[0]),I=0;I<A;I++)x[I]=w[I];return x}e.toVec3=c;function d(x,C,w){if(C.rank!==1)throw new Error("Invalid tensor rank");for(var A=Math.min(4,C.dimensions[0]),I=0;I<A;I++)x[I]=w[I];return x}e.toVec4=d;function f(x,C){var w=x.length;if(w!==C.length)return!1;for(var A=0;A<w;A++)if(x[A]!==C[A])return!1;return!0}e.areEqualExact=f;function h(x){var C=x.dimensions,w=x.axisOrderFastToSlow;switch(C.length){case 1:return{get:function(Y,Z){return Y[Z]},set:function(Y,Z,te){return Y[Z]=te},add:function(Y,Z,te){return Y[Z]+=te},dataOffset:function(Y){return Y},getCoords:function(Y,Z){return Z[0]=Y,Z}};case 2:{if(w[0]===0&&w[1]===1){var A=C[0];return{get:function(Y,Z,te){return Y[te*A+Z]},set:function(Y,Z,te,ce){return Y[te*A+Z]=ce},add:function(Y,Z,te,ce){return Y[te*A+Z]+=ce},dataOffset:function(Y,Z){return Z*A+Y},getCoords:function(Y,Z){return Z[0]=Y%A,Z[1]=Math.floor(Y/A),Z}}}if(w[0]===1&&w[1]===0){var I=C[1];return{get:function(Y,Z,te){return Y[Z*I+te]},set:function(Y,Z,te,ce){return Y[Z*I+te]=ce},add:function(Y,Z,te,ce){return Y[Z*I+te]+=ce},dataOffset:function(Y,Z){return Y*I+Z},getCoords:function(Y,Z){return Z[0]=Math.floor(Y/I),Z[1]=Y%I,Z}}}throw new Error("bad axis order")}case 3:{if(w[0]===0&&w[1]===1&&w[2]===2){var D=C[0],k=C[1],R=D*k;return{get:function(Y,Z,te,ce){return Y[Z+te*D+ce*R]},set:function(Y,Z,te,ce,be){return Y[Z+te*D+ce*R]=be},add:function(Y,Z,te,ce,be){return Y[Z+te*D+ce*R]+=be},dataOffset:function(Y,Z,te){return Y+Z*D+te*R},getCoords:function(Y,Z){var te=Math.floor(Y/D);return Z[0]=Y%D,Z[1]=te%k,Z[2]=Math.floor(te/k),Z}}}if(w[0]===0&&w[1]===2&&w[2]===1){var L=C[0],H=C[2],B=L*H;return{get:function(Y,Z,te,ce){return Y[Z+ce*L+te*B]},set:function(Y,Z,te,ce,be){return Y[Z+ce*L+te*B]=be},add:function(Y,Z,te,ce,be){return Y[Z+ce*L+te*B]+=be},dataOffset:function(Y,Z,te){return Y+te*L+Z*B},getCoords:function(Y,Z){var te=Math.floor(Y/L);return Z[0]=Y%L,Z[1]=Math.floor(te/H),Z[2]=te%H,Z}}}if(w[0]===1&&w[1]===0&&w[2]===2){var j=C[1],Q=C[0],G=j*Q;return{get:function(Y,Z,te,ce){return Y[te+Z*j+ce*G]},set:function(Y,Z,te,ce,be){return Y[te+Z*j+ce*G]=be},add:function(Y,Z,te,ce,be){return Y[te+Z*j+ce*G]+=be},dataOffset:function(Y,Z,te){return Z+Y*j+te*G},getCoords:function(Y,Z){var te=Math.floor(Y/j);return Z[0]=te%Q,Z[1]=Y%j,Z[2]=Math.floor(te/Q),Z}}}if(w[0]===1&&w[1]===2&&w[2]===0){var W=C[1],q=C[2],J=W*q;return{get:function(Y,Z,te,ce){return Y[te+ce*W+Z*J]},set:function(Y,Z,te,ce,be){return Y[te+ce*W+Z*J]=be},add:function(Y,Z,te,ce,be){return Y[te+ce*W+Z*J]+=be},dataOffset:function(Y,Z,te){return Z+te*W+Y*J},getCoords:function(Y,Z){var te=Math.floor(Y/W);return Z[0]=Math.floor(te/q),Z[1]=Y%W,Z[2]=te%q,Z}}}if(w[0]===2&&w[1]===0&&w[2]===1){var he=C[2],$=C[0],X=he*$;return{get:function(Y,Z,te,ce){return Y[ce+Z*he+te*X]},set:function(Y,Z,te,ce,be){return Y[ce+Z*he+te*X]=be},add:function(Y,Z,te,ce,be){return Y[ce+Z*he+te*X]+=be},dataOffset:function(Y,Z,te){return te+Y*he+Z*X},getCoords:function(Y,Z){var te=Math.floor(Y/he);return Z[0]=te%$,Z[1]=Math.floor(te/$),Z[2]=Y%he,Z}}}if(w[0]===2&&w[1]===1&&w[2]===0){var U=C[2],z=C[1],ee=U*z;return{get:function(Y,Z,te,ce){return Y[ce+te*U+Z*ee]},set:function(Y,Z,te,ce,be){return Y[ce+te*U+Z*ee]=be},add:function(Y,Z,te,ce,be){return Y[ce+te*U+Z*ee]+=be},dataOffset:function(Y,Z,te){return te+Z*U+Y*ee},getCoords:function(Y,Z){var te=Math.floor(Y/U);return Z[0]=Math.floor(te/z),Z[1]=te%z,Z[2]=Y%U,Z}}}throw new Error("bad axis order")}default:return{get:function(Y){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return Y[p(x,Z)]},set:function(Y){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return Y[p(x,Z)]=Z[Z.length-1]},add:function(Y){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return Y[p(x,Z)]+=Z[Z.length-1]},dataOffset:function(){for(var Y=[],Z=0;Z<arguments.length;Z++)Y[Z]=arguments[Z];return p(x,Y)},getCoords:function(Y,Z){return g(x,Y,Z)}}}}function v(x){for(var C=x.dimensions,w=1,A=0,I=C.length;A<I;A++)w*=C[A];return function(D){return new(D||x.defaultCtor)(w)}}function p(x,C){for(var w=x.accessDimensions,A=x.axisOrderFastToSlow,I=w.length-1,D=w[I]*C[A[I]],k=I-1;k>=0;k--)D=(D+C[A[k]])*w[k];return D}function g(x,C,w){for(var A=x.dimensions,I=x.axisOrderFastToSlow,D=A.length,k=C,R=0;R<D;R++){var L=A[I[R]];w[I[R]]=k%L,k=Math.floor(k/L)}return w[I[D+1]]=k,w}function m(x){for(var C=[],w=0;w<x.length;w++)C[w]=x[x.length-w-1];return C}e.invertAxisOrder=m;function y(x,C){for(var w=[],A=0;A<x.length;A++)w[A]=x[C[A]];return w}function b(x){for(var C=new Int32Array(x.length),w=0;w<x.length;w++)C[x[w]]=w;return function(A){return y(A,C)}}e.convertToCanonicalAxisIndicesFastToSlow=b;function S(x){for(var C=new Int32Array(x.length),w=0;w<x.length;w++)C[x[x.length-w-1]]=w;return function(A){return y(A,C)}}e.convertToCanonicalAxisIndicesSlowToFast=S})(Pr||(Pr={}));function Xh(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return jf(e,t,r)}function jf(e,t,r){var n=t,a=0,i=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){var o=e.charCodeAt(n)-48;if(o>9||o<0)return i*a|0;a=10*a+o|0}return i*a}function s8(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,jf(t,r,n))}function jSe(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return Mc(e,t,r)}function Mc(e,t,r){var n=t,a=1,i=0,o=0,s=1;for(e.charCodeAt(n)===45?(a=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){var u=e.charCodeAt(n)-48;if(u>=0&&u<10)i=i*10+u,++n;else if(u===-2){for(++n;n<r;)if(u=e.charCodeAt(n)-48,u>=0&&u<10)o=10*o+u,s=10*s,++n;else return u===53||u===21?s8(a*(i+o/s),e,n+1,r):a*(i+o/s);return a*(i+o/s)}else{if(u===53||u===21)return s8(a*i,e,n+1,r);break}}return a*i}var me;(function(e){var t;(function(D){D.str={"@type":"str",T:"",valueType:"str"},D.int={"@type":"int",T:0,valueType:"int"},D.coord={"@type":"coord",T:0,valueType:"float"},D.float={"@type":"float",T:0,valueType:"float"};function k(W){return W===void 0&&(W=""),{"@type":"str",T:W,valueType:"str"}}D.Str=k;function R(W){return W===void 0&&(W=0),{"@type":"int",T:W,valueType:"int"}}D.Int=R;function L(W){return W===void 0&&(W=0),{"@type":"float",T:W,valueType:"float"}}D.Float=L;function H(W,q){return q===void 0&&(q=D.float),{"@type":"tensor",T:W.create(),space:W,valueType:"tensor",baseType:q}}D.Tensor=H;function B(W,q){return q===void 0&&(q=D.float),H(Pr.Vector(W,q["@type"]==="int"?Int32Array:Float64Array),q)}D.Vector=B;function j(W,q,J){return J===void 0&&(J=D.float),H(Pr.ColumnMajorMatrix(W,q,J["@type"]==="int"?Int32Array:Float64Array),J)}D.Matrix=j;function Q(W,q){return typeof q<"u"?E(E({},W),{T:q}):W}D.Aliased=Q;function G(W,q,J){return J===void 0&&(J=[]),{"@type":"list",T:J,separator:W,itemParse:q,valueType:"list"}}D.List=G})(t=e.Schema||(e.Schema={}));function r(D){return!!D&&!!D.schema&&!!D.value}e.is=r;function n(D,k){return u8(k.T,D,k,1)}e.Undefined=n;function a(D,k,R){return u8(D,k,R,0)}e.ofConst=a;function i(D){return B2(D)}e.ofLambda=i;function o(D,k){return i({value:function(R){return R+D},rowCount:Math.max(k-D+1,0),schema:t.int})}e.range=o;function s(D){return sc(D)}e.ofArray=s;function u(D){return sc({array:D,schema:t.int})}e.ofIntArray=u;function l(D){return sc({array:D,schema:t.float})}e.ofFloatArray=l;function c(D){return sc({array:D,schema:t.str})}e.ofStringArray=c;function d(D){return sc({array:D,schema:t.Aliased(t.str)})}e.ofStringAliasArray=d;function f(D,k){return k===void 0&&(k=","),sc({array:D,schema:t.List(k,function(R){return R})})}e.ofStringListArray=f;function h(D){var k=D.count,R=D.data,L=D.indices;return B2({value:function(H){return jf(R,L[2*H],L[2*H+1])||0},rowCount:k,schema:t.int})}e.ofIntTokens=h;function v(D){var k=D.count,R=D.data,L=D.indices;return B2({value:function(H){return Mc(R,L[2*H],L[2*H+1])||0},rowCount:k,schema:t.float})}e.ofFloatTokens=v;function p(D){var k=D.count,R=D.data,L=D.indices;return B2({value:function(H){var B=R.substring(L[2*H],L[2*H+1]);return B==="."||B==="?"?"":B},rowCount:k,schema:t.str})}e.ofStringTokens=p;function g(D,k,R){return HSe(D,k,R)}e.window=g;function m(D,k,R){return R===void 0&&(R=!0),$Se(D,k,R)}e.view=m;function y(D){return zSe(D)}e.createFirstIndexMap=y;function b(D){return VSe(D)}e.createIndexer=b;function S(D,k,R){return KSe(D,k,R||Array)}e.mapToArray=S;function x(D,k){return QSe(D,k)}e.areEqual=x;function C(D,k){return eCe(D,k)}e.indicesOf=C;function w(D,k){return D.__array?D:D.isDefined?sc({array:D.toArray({array:k}),schema:D.schema,valueKind:D.valueKind}):n(D.rowCount,D.schema)}e.asArrayColumn=w;function A(D,k,R){if(R===void 0&&(R=0),!!D.isDefined){var L=D.__array;if(L)for(var H=0,B=L.length;H<B;H++)k[R+H]=L[H];else for(var H=0,B=D.rowCount;H<B;H++)k[R+H]=D.value(H)}}e.copyToArray=A;function I(D){for(var k=0,R=D.rowCount;k<R;k++)if(k!==D.value(k))return!1;return!0}e.isIdentity=I})(me||(me={}));function zSe(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return t}function VSe(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return function(i){return t.has(i)?t.get(i):-1}}function u8(e,t,r,n){var a=function(i){return e};return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:a,valueKind:function(i){return n},toArray:function(i){for(var o=Tb(t,i).array,s=0,u=o.length;s<u;s++)o[s]=e;return o},areValuesEqual:function(i,o){return!0}}}function B2(e){var t=e.value,r=e.valueKind,n=e.areValuesEqual,a=e.rowCount,i=e.schema;return{schema:i,__array:void 0,isDefined:!0,rowCount:a,value:t,valueKind:r||function(o){return 0},toArray:function(o){for(var s=Tb(a,o),u=s.array,l=s.start,c=0,d=u.length;c<d;c++)u[c]=t(c+l);return u},areValuesEqual:n||function(o,s){return t(o)===t(s)}}}function sc(e){var t=e.array,r=e.schema,n=e.valueKind,a=t.length,i=r.valueType==="str"?function(s){var u=t[s];return typeof u=="string"?u:""+u}:function(s){return t[s]},o=ok(t);return{schema:r,__array:t,isDefined:!0,rowCount:a,value:i,valueKind:n||function(s){return 0},toArray:r.valueType==="str"?function(s){for(var u=kC(a,s),l=u.start,c=u.end,d=new(s&&typeof s.array<"u"?s.array:t.constructor)(c-l),f=0,h=c-l;f<h;f++){var v=t[l+f];d[f]=typeof v=="string"?v:""+v}return d}:o?function(s){return OC(t,s)}:function(s){var u=kC(a,s),l=u.start,c=u.end;if(l===0&&c===t.length)return t;for(var d=new(s&&typeof s.array<"u"?s.array:t.constructor)(c-l),f=0,h=c-l;f<h;f++)d[f]=t[l+f];return d},areValuesEqual:function(s,u){return t[s]===t[u]}}}function HSe(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:e.__array&&ok(e.__array)?GSe(e,t,r):qSe(e,t,r):me.Undefined(r-t,e.schema)}function GSe(e,t,r){var n=OC(e.__array,{start:t,end:r}),a=e.valueKind;return sc({array:n,schema:e.schema,valueKind:function(i){return a(t+i)}})}function qSe(e,t,r){var n=e.value,a=e.valueKind,i=e.areValuesEqual,o=t===0?n:function(u){return n(u+t)},s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:t===0?a:function(u){return a(u+t)},toArray:function(u){for(var l=Tb(s,u).array,c=0,d=l.length;c<d;c++)l[c]=n(c+t);return l},areValuesEqual:t===0?i:function(u,l){return i(u+t,l+t)}}}function WSe(e,t){if(e.length!==t)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function $Se(e,t,r){return e.rowCount===0||r&&WSe(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?XSe(e,t):YSe(e,t)}function XSe(e,t){for(var r=e.__array,n=new r.constructor(t.length),a=0,i=t.length;a<i;a++)n[a]=r[t[a]];var o=e.valueKind;return sc({array:n,schema:e.schema,valueKind:function(s){return o(t[s])}})}function YSe(e,t){var r=e.value,n=e.valueKind,a=e.areValuesEqual,i=function(s){return r(t[s])},o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:i,valueKind:function(s){return n(t[s])},toArray:function(s){for(var u=Tb(o,s).array,l=0,c=u.length;l<c;l++)u[l]=r(t[l]);return u},areValuesEqual:function(s,u){return a(t[s],t[u])}}}function KSe(e,t,r){for(var n=new r(e.rowCount),a=0,i=e.rowCount;a<i;a++)n[a]=t(e.value(a));return n}function QSe(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:e.__array&&t.__array?ZSe(e,t):JSe(e,t)}function ZSe(e,t){for(var r=e.__array,n=t.__array,a=0,i=e.rowCount;a<i;a++)if(r[a]!==n[a])return!1;return!0}function JSe(e,t){for(var r=e.value,n=t.value,a=0,i=e.rowCount;a<i;a++)if(r(a)!==n(a))return!1;return!0}function eCe(e,t){for(var r=[],n=e.value,a=0,i=e.rowCount;a<i;a++)t(n(a))&&(r[r.length]=a);return r}var Yr;(function(e){function t(S){return S&&typeof S._rowCount=="number"&&!!S._columns&&!!S._schema}e.is=t;function r(S,x,C){C===void 0&&(C={});var w=Object.create(null),A=Object.keys(S);w._rowCount=x._rowCount,w._columns=A,w._schema=S;for(var I=0,D=A;I<D.length;I++){var k=D[I];if(x[k])w[k]=x[k];else if(C[k])w[k]=C[k];else throw Error("Cannot find column '"+k+"'.")}return w}e.pickColumns=r;function n(S,x){var C=Object.keys(x),w=x[C[0]].rowCount;return E({_rowCount:w,_columns:C,_schema:S},x)}e.ofColumns=n;function a(S,x,C){var w=Object.create(null),A=Object.keys(S);w._rowCount=C,w._columns=A,w._schema=S;for(var I=0,D=A;I<D.length;I++){var k=D[I];k in x?w[k]=x[k]:w[k]=me.Undefined(C,S[k])}return w}e.ofPartialColumns=a;function i(S,x){var C=Object.create(null),w=Object.keys(S);C._rowCount=x,C._columns=w,C._schema=S;for(var A=0,I=w;A<I.length;A++){var D=I[A];C[D]=me.Undefined(x,S[D])}return C}e.ofUndefinedColumns=i;function o(S,x){var C=Object.create(null),w=x.length,A=Object.keys(S);C._rowCount=w,C._columns=A,C._schema=S;for(var I=function(L){C[L]=me.ofLambda({rowCount:w,schema:S[L],value:function(H){return x[H][L]},valueKind:function(H){return typeof x[H][L]>"u"?1:0}})},D=0,k=A;D<k.length;D++){var R=k[D];I(R)}return C}e.ofRows=o;function s(S,x){var C,w=Object.create(null),A=Object.keys(S);w._rowCount=0,w._columns=A,w._schema=S;for(var I=0,D=A;I<D.length;I++){var k=D[I];typeof x[k]<"u"?(w[k]=me.ofArray({array:x[k],schema:S[k]}),w._rowCount=(C=x[k])===null||C===void 0?void 0:C.length):w[k]=me.Undefined(w._rowCount,S[k])}return w}e.ofArrays=s;function u(S,x,C){var w=Object.create(null),A=Object.keys(x);w._rowCount=C.length,w._columns=A,w._schema=x;for(var I=0,D=A;I<D.length;I++){var k=D[I];w[k]=me.view(S[k],C)}return w}e.view=u;function l(S,x,C){for(var w=[],A=0,I=S._rowCount;A<I;++A)C(A)&&w.push(A);return u(S,x,w)}e.pick=l;function c(S,x,C,w){if(C===0&&w===S._rowCount)return S;var A=Object.create(null),I=Object.keys(x);A._rowCount=w-C,A._columns=I,A._schema=x;for(var D=0,k=I;D<k.length;D++){var R=k[D];A[R]=me.window(S[R],C,w)}return A}e.window=c;function d(S,x){var C=Object.create(null),w=Object.keys(x);C._rowCount=0;for(var A=0,I=S;A<I.length;A++){var D=I[A];C._rowCount+=D._rowCount}for(var k={},R=0,L=w;R<L.length;R++){var H=L[R];k[H]=new Array(C._rowCount)}C._columns=w,C._schema=x;for(var B=0,j=0,Q=S;j<Q.length;j++){for(var D=Q[j],G=0,W=w;G<W.length;G++){var q=W[G];me.copyToArray(D[q],k[q],B)}B+=D._rowCount}for(var J=0,he=w;J<he.length;J++){var q=he[J];C[q]=me.ofArray({array:k[q],schema:x[q]})}return C}e.concat=d;function f(S,x,C){S[x]=me.asArrayColumn(S[x],C)}e.columnToArray=f;function h(S,x){for(var C=new Int32Array(S._rowCount),w=0,A=C.length;w<A;w++)C[w]=w;Pu(C,function(H,B,j){return x(B,j)});for(var I=!0,w=0,A=C.length;w<A;w++)if(C[w]!==w){I=!1;break}if(I)return S;var D=Object.create(null);D._rowCount=S._rowCount,D._columns=S._columns,D._schema=S._schema;for(var k=0,R=S._columns;k<R.length;k++){var L=R[k];D[L]=me.view(S[L],C,!1)}return D}e.sort=h;function v(S,x){if(S._rowCount!==x._rowCount||S._columns.length!==x._columns.length)return!1;for(var C=0,w=S._columns;C<w.length;C++){var A=w[C];if(!x[A])return!1}for(var I=0,D=S._columns;I<D.length;I++){var A=D[I];if(!me.areEqual(S[A],x[A]))return!1}return!0}e.areEqual=v;function p(S,x){for(var C=Object.create(null),w=S._columns,A=0;A<w.length;A++){var I=w[A];C[I]=S[I].value(x)}return C}e.getRow=p;function g(S,x){for(var C=0,w=S._rowCount;C<w;++C)if(x(C))return p(S,C)}e.pickRow=g;function m(S){for(var x=[],C=S._rowCount,w=0;w<C;w++)x[w]=p(S,w);return x}e.getRows=m;function y(S){for(var x={},C=S._columns,w=0;w<C.length;w++){var A=C[w];x[A]=S[A].toArray()}return x}e.toArrays=y;function b(S){var x=Rr.create(),C=S._columns,w=S._rowCount,A=1;Rr.write(x,"|");for(var I=0;I<C.length;I++)Rr.write(x,C[I]),Rr.write(x,"|"),A+=C[I].length+1;Rr.newline(x),Rr.write(x,new Array(A+1).join("-")),Rr.newline(x);for(var D=0;D<w;D++){Rr.write(x,"|");for(var I=0;I<C.length;I++){var k=S[C[I]];k.valueKind(D)===0?(Rr.write(x,k.value(D)),Rr.write(x,"|")):Rr.write(x,".|")}Rr.newline(x)}return Rr.getString(x)}e.formatToString=b})(Yr||(Yr={}));var WI;(function(e){function t(n,a,i){var o=Object.keys(i),s=Object.create(null),u=[];s._name=n,s._tableNames=u,s._schema=a;for(var l=0,c=o;l<c.length;l++){var d=c[l];Yr.is(i[d])&&(s[d]=i[d],u[u.length]=d)}return s}e.ofTables=t;function r(n){for(var a={},i=0,o=n._tableNames;i<o.length;i++){var s=o[i];a[s]=Yr.getRows(n[s])}return a}e.getTablesAsRows=r})(WI||(WI={}));function sk(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function uk(e){if(Array.from)return Array.from(e);for(var t=[];;){var r=e.next(),n=r.done,a=r.value;if(n)break;t[t.length]=a}return t}function $I(e,t,r){for(var n=t-e+1,a=r?new r(n):new Int32Array(n),i=0;i<n;i++)a[i]=i+e;return a}function tCe(e,t){for(var r=new(rCe(e))(t.length),n=0,a=t.length;n<a;n++)r[n]=e[t[n]];return r}function rCe(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}var xa;(function(e){e.Zero=0;var t=function(){var p=new ArrayBuffer(8),g=new ArrayBuffer(8);return{_int32:new Int32Array(p),_float64:new Float64Array(p),_int32_1:new Int32Array(g),_float64_1:new Float64Array(g)}}(),r=t._int32,n=t._float64,a=t._int32_1,i=t._float64_1;function o(p){return typeof p=="number"}e.is=o;function s(p,g){return r[0]=p,r[1]=g,n[0]}e.create=s;function u(p){return n[0]=p,r[0]}e.fst=u;function l(p){return n[0]=p,r[1]}e.snd=l;function c(p,g){return n[0]=p,i[0]=g,r[0]===a[0]&&r[1]===a[1]}e.areEqual=c;function d(p,g){n[0]=p,i[0]=g;var m=r[0]-a[0];return m!==0?m:r[1]-a[1]}e.compare=d;function f(p,g,m){n[0]=p[g],i[0]=p[m];var y=r[0]-a[0];return y!==0?y:r[1]-a[1]}e.compareInArray=f;function h(p){return n[0]=p,cv(r[0],r[1])}e.hashCode=h;function v(p){return n[0]=p,"("+r[0]+", "+r[1]+")"}e.toString=v})(xa||(xa={}));var CX=xa.Zero;function l8(e,t){return t<e?xa.create(e,e):xa.create(e,t+1)}function lk(e,t){return t<=e?xa.create(e,e):xa.create(e,t)}function nCe(e){return e<0?xa.create(0,0):xa.create(0,e)}var aCe=xa.is,Vc=xa.fst,Kf=xa.snd,LC=xa.fst;function NC(e){return xa.snd(e)-1}function mp(e){return xa.snd(e)-xa.fst(e)}var iCe=xa.hashCode,oCe=xa.toString;function sCe(e,t){return xa.fst(e)<=t&&t<xa.snd(e)}function uCe(e,t){var r=Vc(e);return t>=r&&t<Kf(e)?t-r:-1}function lCe(e,t){return xa.fst(e)+t}var cCe=xa.areEqual;function _X(e,t){var r=mp(e),n=mp(t);return r===0&&n===0?!0:r>0&&n>0&&NC(e)>=LC(t)&&LC(e)<=NC(t)}function dCe(e,t){return mp(e)?mp(t)?Vc(e)<=Vc(t)&&Kf(e)>=Kf(t):!0:mp(t)===0}function XI(e,t){var r=Vc(e);if(t<=r)return 0;var n=Kf(e);return t>=n?n-r:t-r}function fCe(e,t,r){var n=Vc(r),a=Vc(e);if(t<=n+a)return n;var i=Kf(r);return t>=i+a?i:t-a}function wX(e,t,r){return lk(XI(e,t),XI(e,r+1))}function hCe(e,t){return _X(e,t)?lk(Math.max(Vc(e),Vc(t)),Math.min(Kf(e),Kf(t))):CX}function pCe(e,t){return mp(wX(e,LC(t),NC(t)))}var Re;(function(e){e.Empty=CX,e.ofSingleton=function(t){return l8(t,t)},e.ofRange=l8,e.ofBounds=lk,e.ofLength=nCe,e.is=aCe,e.has=sCe,e.indexOf=uCe,e.getAt=lCe,e.start=Vc,e.end=Kf,e.min=LC,e.max=NC,e.size=mp,e.hashCode=iCe,e.toString=oCe,e.areEqual=cCe,e.areIntersecting=_X,e.isSubInterval=dCe,e.findPredecessorIndex=XI,e.findPredecessorIndexInInterval=fCe,e.findRange=wX,e.intersectionSize=pCe,e.intersect=hCe})(Re||(Re={}));var z1=[];function vCe(e){return[e]}function mCe(e){return e}function gCe(e){return Pu(e),e}function c8(e,t){if(t<e)return[];for(var r=new Int32Array(t-e+1),n=e;n<=t;n++)r[n-e]=n;return r}function yCe(e){return e&&(Array.isArray(e)||!!e.buffer)}function YI(e){return e[0]}function KI(e){return e[e.length-1]+1}function bCe(e){return e[0]}function xCe(e){return e[e.length-1]}function EX(e){return e.length}function SCe(e){var t=e.length;return t?t>2?BSe(t,e[0],e[t-1],e[t>>1]):FSe(t,e[0],e[t-1]):0}function CCe(e){var t=e.length;return t>5?"["+e[0]+", "+e[1]+", ..., "+e[t-1]+"], length "+t:"["+e.join(", ")+"]"}function AX(e,t){var r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?TX(e,t,0,r):-1}function _Ce(e,t,r){return PX(e,t,Re.start(r),Re.end(r))}function PX(e,t,r,n){var a=e.length;return a===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?TX(e,t,r,n):-1}function wCe(e,t){return AX(e,t)>=0}function ECe(e,t){if(e===t)return!0;var r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function sp(e,t){var r=e.length;return t<=e[0]?0:t>e[r-1]?r:IX(e,t,0,r)}function ACe(e,t,r){var n=Re.start(r),a=Re.end(r),i=e[n];return t<=i?n:a>n&&t>e[a-1]?a:t-i<=11?TCe(e,t,n+1,a):IX(e,t,n,a)}function PCe(e,t,r){return Re.ofBounds(sp(e,t),sp(e,r+1))}function TX(e,t,r,n){for(var a=r,i=n-1;a<=i;){if(a+11>i){for(var o=a;o<=i;o++)if(t===e[o])return o;return-1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else if(t>u)a=s+1;else return s}return-1}function IX(e,t,r,n){for(var a=r,i=n-1;a<i;){if(a+11>i){for(var o=a;o<=i;o++)if(t<=e[o])return o;return i+1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else if(t>u)a=s+1;else return s}return a>i?i+1:e[a]>=t?a:a+1}function TCe(e,t,r,n){for(var a=r;a<n;a++)if(t<=e[a])return a;return n}function ICe(e,t){if(e===t)return!0;for(var r=dv(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;n<i&&a<o;){var s=e[n],u=t[a];if(s<u)n++;else if(s>u)a++;else return!0}return!1}function MCe(e,t){if(e===t)return!0;var r=t.length,n=dv(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ;if(s-i<r||o-a<r)return!1;for(var u=0;a<o&&i<s;){var l=e[a],c=t[i];l<c?a++:l>c?i++:(a++,i++,u++)}return u===r}function MX(e,t){if(e===t)return e;var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return MX(t,e);var a=dv(e,t),i=a.startI,o=a.startJ,s=a.endI,u=a.endJ,l=ck(e,t,i,o,s,u);if(l===r&&l===n||l===n)return e;if(l===r)return t;var c=new Int32Array(r+n-l),d=0,f=0,h=0;for(d=0;d<i;d++)c[h++]=e[d];for(;f<u&&e[i]>t[f];)c[h++]=t[f++];for(;d<s&&f<u;){var v=e[d],p=t[f];v<p?(c[h++]=v,d++):v>p?(c[h++]=p,f++):(c[h++]=v,d++,f++)}for(;d<s;d++)c[h++]=e[d];for(;f<u;f++)c[h++]=t[f];for(;d<r;d++)c[h++]=e[d];for(;f<n;f++)c[h++]=t[f];return c}function DCe(e,t){if(e===t)return EX(e);var r=dv(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;return ck(e,t,n,a,i,o)}function ck(e,t,r,n,a,i){for(var o=r,s=n,u=0;o<a&&s<i;){var l=e[o],c=t[s];l<c?o++:l>c?s++:(o++,s++,u++)}return u}function RCe(e,t){if(e===t)return e;var r=dv(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=ck(e,t,n,a,i,o),u=e.length,l=t.length;if(!s)return z1;if(s===u&&s===l||s===l)return t;if(s===u)return e;for(var c=new Int32Array(s),d=0,f=n,h=a;f<i&&h<o;){var v=e[f],p=t[h];v<p?f++:(v>p||(c[d++]=v,f++),h++)}return c}function kCe(e,t){if(e===t)return z1;for(var r=e.length,n=dv(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ,u=a,l=i,c=0;u<o&&l<s;){var d=e[u],f=t[l];d<f?u++:d>f?l++:(u++,l++,c++)}if(!c)return e;if(c>=r)return z1;for(var h=new Int32Array(r-c),v=0,p=0;p<a;p++)h[v++]=e[p];for(u=a,l=i;u<o&&l<s;){var d=e[u],f=t[l];d<f?(h[v++]=d,u++):(d>f||u++,l++)}for(;u<r;u++)h[v++]=e[u];return h}function OCe(e){if(e.length<2)return e;for(var t=1,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&t++;if(t===e.length)return e;for(var a=new Int32Array(t),i=0,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&(a[i++]=e[r]);return a[i]=e[e.length-1],a}function LCe(e,t){if(e===t)return $I(0,e.length-1);for(var r=dv(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=n,u=a,l=0;s<i&&u<o;){var c=e[s],d=t[u];c<d?s++:c>d?u++:(s++,u++,l++)}var f=e.length;if(!l)return z1;if(l===f)return $I(0,e.length-1);var h=new Int32Array(l),v=0;for(s=n,u=a;s<i&&u<o;){var c=e[s],d=t[u];c<d?s++:(c>d||(h[v++]=s,s++),u++)}return h}var ql={startI:0,startJ:0,endI:0,endJ:0};function dv(e,t){var r=e.length,n=t.length,a=r/n;return r>=128||n>=128||a<=.34||a>=2.99?(ql.startI=sp(e,YI(t)),ql.startJ=sp(t,YI(e)),ql.endI=sp(e,KI(t)),ql.endJ=sp(t,KI(e))):(ql.startI=0,ql.startJ=0,ql.endI=r,ql.endJ=n),ql}var it;(function(e){e.Empty=z1,e.ofUnsortedArray=gCe,e.ofSingleton=vCe,e.ofSortedArray=mCe,e.ofRange=c8,e.ofBounds=function(t,r){return c8(t,r-1)},e.is=yCe,e.has=wCe,e.indexOf=AX,e.indexOfInInterval=_Ce,e.indexOfInRange=PX,e.start=YI,e.end=KI,e.min=bCe,e.max=xCe,e.size=EX,e.hashCode=SCe,e.toString=CCe,e.areEqual=ECe,e.areIntersecting=ICe,e.isSubset=MCe,e.union=MX,e.intersect=RCe,e.subtract=kCe,e.findPredecessorIndex=sp,e.findPredecessorIndexInInterval=ACe,e.findRange=PCe,e.intersectionSize=DCe,e.deduplicate=OCe,e.indicesOf=LCe})(it||(it={}));var Tl=Re.Empty,NCe=Re.ofSingleton,FCe=Re.ofRange,BCe=Re.ofBounds;function qu(e){return e.length?e[e.length-1]-e[0]+1===e.length?Re.ofRange(e[0],e[e.length-1]):e:Tl}function gp(e){return Re.is(e)?Re.size(e):it.size(e)}function UCe(e,t){return Re.is(e)?Re.has(e,t):it.has(e,t)}function jCe(e,t){return Re.is(e)?Re.indexOf(e,t):it.indexOf(e,t)}function QI(e,t){return Re.is(e)?Re.getAt(e,t):e[t]}function _g(e){return Re.is(e)?Re.min(e):it.min(e)}function wg(e){return Re.is(e)?Re.max(e):it.max(e)}function zCe(e){return Re.is(e)?Re.start(e):it.start(e)}function VCe(e){return Re.is(e)?Re.end(e):it.end(e)}function HCe(e){return Re.is(e)?Re.hashCode(e):it.hashCode(e)}function GCe(e){return Re.is(e)?Re.toString(e):it.toString(e)}function qCe(e,t){return Re.is(e)?Re.is(t)?Re.areEqual(e,t):d8(e,t):Re.is(t)?d8(t,e):it.areEqual(e,t)}function WCe(e,t){return Re.is(e)?Re.is(t)?Re.areIntersecting(e,t):f8(t,e):Re.is(t)?f8(e,t):it.areIntersecting(e,t)}function $Ce(e,t){return Re.is(e)?Re.is(t)?Re.isSubInterval(e,t):r_e(e,t):Re.is(t)?t_e(e,t):it.isSubset(e,t)}function XCe(e,t){return Re.is(e)?Re.findPredecessorIndex(e,t):it.findPredecessorIndex(e,t)}function YCe(e,t,r){return Re.is(e)?Re.findPredecessorIndexInInterval(e,t,r):it.findPredecessorIndexInInterval(e,t,r)}function KCe(e,t,r){return Re.is(e)?Re.findRange(e,t,r):it.findRange(e,t,r)}function QCe(e,t){return Re.is(e)?Re.is(t)?Re.intersectionSize(e,t):p8(t,e):Re.is(t)?p8(e,t):it.intersectionSize(e,t)}function ZCe(e,t){return Re.is(e)?Re.is(t)?i_e(e,t):h8(t,e):Re.is(t)?h8(e,t):qu(it.union(e,t))}function JCe(e,t){return Re.is(e)?Re.is(t)?Re.intersect(e,t):v8(t,e):Re.is(t)?v8(e,t):qu(it.intersect(e,t))}function e_e(e,t){return Re.is(e)?Re.is(t)?o_e(e,t):u_e(e,t):Re.is(t)?s_e(e,t):qu(it.subtract(e,t))}function d8(e,t){return Re.size(e)===it.size(t)&&Re.start(e)===it.start(t)&&Re.end(e)===it.end(t)}function f8(e,t){return e.length!==0&&Re.size(it.findRange(e,Re.min(t),Re.max(t)))!==0}function t_e(e,t){var r=Re.min(t),n=Re.max(t);if(n-r+1===0)return!0;var a=it.min(e),i=it.max(e);if(r<a||n>i)return!1;var o=it.findRange(e,r,n);return Re.size(o)===Re.size(t)}function r_e(e,t){var r=Re.min(e),n=Re.max(e);if(n-r+1===0)return!1;var a=it.min(t),i=it.max(t);return a>=r&&i<=n}function n_e(e,t){var r=gp(e),n=gp(t);return r===0&&n===0?!0:r>0&&n>0&&wg(e)>=_g(t)&&_g(e)<=wg(t)}function a_e(e,t){return gp(e)?gp(t)?_g(e)<=_g(t)&&wg(e)>=wg(t):!0:gp(t)===0}function i_e(e,t){if(Re.areEqual(e,t))return e;var r=Re.size(e),n=Re.size(t);if(!n)return e;if(!r)return t;var a=Re.min(e),i=Re.min(t);if(n_e(e,t))return Re.ofRange(Math.min(a,i),Math.max(Re.max(e),Re.max(t)));var o,s,u,l;a<i?(o=r,s=a,u=n,l=i):(o=n,s=i,u=r,l=a);for(var c=new Int32Array(r+n),d=0;d<o;d++)c[d]=d+s;for(var d=0;d<u;d++)c[d+o]=d+l;return qu(c)}function h8(e,t){var r=Re.size(t);if(!r)return e;if(a_e(t,e))return t;for(var n=Re.min(t),a=Re.max(t),i=it.findRange(e,n,a),o=Re.start(i),s=Re.end(i),u=new Int32Array(o+(e.length-s)+r),l=0,c=0;c<o;c++)u[l++]=e[c];for(var c=n;c<=a;c++)u[l++]=c;for(var c=s,d=e.length;c<d;c++)u[l++]=e[c];return qu(u)}function p8(e,t){if(!Re.size(t))return 0;var r=it.findRange(e,Re.min(t),Re.max(t));return Re.end(r)-Re.start(r)}function v8(e,t){if(!Re.size(t))return Tl;var r=it.findRange(e,Re.min(t),Re.max(t)),n=Re.start(r),a=Re.end(r),i=a-n;if(!i)return Tl;if(i===e.length)return e;for(var o=new Int32Array(i),s=0,u=n;u<a;u++)o[s++]=e[u];return qu(o)}function o_e(e,t){if(Re.areEqual(e,t))return Tl;if(!Re.areIntersecting(e,t))return e;var r=Re.min(e),n=Re.max(e),a=Re.min(t),i=Re.max(t);if(n<r||i<a)return e;if(Re.isSubInterval(t,e))return Tl;if(Re.isSubInterval(e,t)){var o=a-r,s=n-i;if(o<=0)return Re.ofRange(i+1,i+s);if(s<=0)return Re.ofRange(r,r+o-1);for(var u=new Int32Array(o+s),l=0,c=0;c<o;c++)u[l++]=r+c;for(var c=1;c<=s;c++)u[l++]=i+c;return qu(u)}return r<a?Re.ofRange(r,a-1):Re.ofRange(i+1,n)}function s_e(e,t){var r=Re.min(t),n=Re.max(t);if(n<r)return e;var a=it.findRange(e,r,n),i=Re.start(a),o=Re.end(a),s=e.length-(o-i);if(s<=0)return Tl;if(s===e.length)return e;for(var u=new Int32Array(s),l=0,c=0;c<i;c++)u[l++]=e[c];for(var c=o,d=e.length;c<d;c++)u[l++]=e[c];return qu(u)}function u_e(e,t){var r=Re.min(e),n=Re.max(e);if(n<r)return e;var a=n-r+1,i=it.findRange(t,r,n),o=Re.start(i),s=Re.end(i),u=s-o;if(u===0)return e;var l=a-u;if(l<=0)return Tl;for(var c=new Int32Array(l),d=t.length-1,f=t[Math.min(o,d)],h=t[Math.min(s,d)],v=0,p=r;p<f;p++)c[v++]=p;for(var p=f;p<=h;p++)it.indexOfInInterval(t,p,i)<0&&(c[v++]=p);for(var p=h+1;p<=n;p++)c[v++]=p;return qu(c)}function l_e(e,t,r){if(Re.is(e))for(var n=Re.min(e),a=n,i=Re.max(e);a<=i;a++)t(a,a-n,r);else for(var a=0,i=e.length;a<i;a++)t(e[a],a,r);return r}function c_e(e,t,r,n){if(Re.is(e))for(var a=0,i=Re.min(e),o=Re.max(e);i<=o;i++){for(var s=t(i),u=i+1;u<o&&t(u)===s;)u++;i=u-1,r(s,a,n),a++}else for(var a=0,i=0,o=e.length;i<o;i++){for(var s=t(e[i]),u=i+1;u<o&&t(e[u])===s;)u++;i=u-1,r(s,a,n),a++}return n}function d_e(e,t,r){if(t===r)return e;var n=gp(e),a=t.length,i=r.length;if(n===0||a===0||i===0)return Tl;for(var o=it.findPredecessorIndex(r,t[_g(e)]),s=it.findPredecessorIndex(r,t[wg(e)]+1),u=0,l=0,c=0,d=o;c<n&&d<s;){var f=t[QI(e,c)],h=r[d];f<h?c++:(f>h||(u++,c++),d++)}if(u===0)return Tl;if(u===a&&u===i)return e;var v=new Int32Array(u);for(l=0,c=0,d=o;c<n&&d<s;){var f=t[QI(e,c)],h=r[d];f<h?c++:(f>h||(v[l++]=d,c++),d++)}return qu(v)}var Fe;(function(e){e.Empty=Tl,e.ofSingleton=NCe,e.ofRange=FCe,e.ofBounds=BCe,e.ofSortedArray=qu,e.has=UCe,e.indexOf=jCe,e.getAt=QI,e.min=_g,e.max=wg,e.start=zCe,e.end=VCe,e.size=gp,e.hashCode=HCe,e.areEqual=qCe,e.areIntersecting=WCe,e.isSubset=$Ce,e.union=ZCe,e.intersect=JCe,e.indexedIntersect=d_e,e.subtract=e_e,e.findPredecessorIndex=XCe,e.findPredecessorIndexInInterval=YCe,e.findRange=KCe,e.intersectionSize=QCe;function t(s,u,l){return l_e(s,u,l)}e.forEach=t;function r(s,u,l,c){return c_e(s,u,l,c)}e.forEachSegment=r;function n(s){return Re.is(s)}e.isInterval=n;function a(s){return!Re.is(s)}e.isSortedArray=a;function i(s){var u=[];return e.forEach(s,function(l){return u.push(l)}),u}e.toArray=i;function o(s){return GCe(s)}e.toString=o})(Fe||(Fe={}));function DX(e){for(var t=it.ofSortedArray(e),r=it.max(t),n=new Int32Array(r),a=0,i=e.length-1;a<i;a++)for(var o=e[a],s=e[a+1];o<s;o++)n[o]=a;return{offsets:t,index:n,count:e.length-1}}function f_e(e,t){for(var r=Re.start(t),n=new Int32Array(e.length+1),a=0,i=e.length;a<i;a++)n[a]=e[a]-r;return n[e.length]=Re.end(t)-r,DX(n)}function h_e(e){var t=e.count;return t}function p_e(e,t){var r=e.index;return r[t]}function v_e(e,t,r){var n=e.offsets,a=Fe.max(n),i=r>=a?-1:Fe.findPredecessorIndex(n,r-1);return Fe.findRange(t,Fe.getAt(n,i),Fe.getAt(n,i+1)-1)}var m_e=function(){function e(t,r,n,a){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=Re.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=a,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&Re.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value},e.prototype.updateValue=function(){var t=this.segments[this.segmentMin+1],r=Fe.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=Re.start(this.setRange),this.value.end=r,this.setRange=Re.ofBounds(r,Re.end(this.setRange)),r>this.value.start},e.prototype.updateSegmentRange=function(){var t=Re.min(this.setRange),r=Re.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[Fe.getAt(this.set,t)],this.segmentMax=this.segmentMap[Fe.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin},e.prototype.setSegment=function(t){this.setRange=Re.ofBounds(t.start,t.end),this.updateSegmentRange()},e}();function g_e(e,t,r){var n=typeof r<"u"?Re.ofBounds(r.start,r.end):Re.ofBounds(0,Fe.size(t));return new m_e(e.offsets,e.index,t,n)}var ar;(function(e){e.create=DX,e.ofOffsets=f_e,e.count=h_e,e.getSegment=p_e,e.projectValue=v_e,e.transientSegments=g_e})(ar||(ar={}));function y_e(e){return new b_e(e)}var b_e=function(){function e(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(var r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}return e.prototype.remove=function(t){var r=this,n=r.prev,a=r.next,i=n[t],o=a[t];i>=0&&(a[i]=o,n[t]=-1),o>=0&&(n[o]=i,a[t]=-1),t===this.head&&(i<0?this.head=o:this.head=i)},e.prototype.has=function(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t},e}(),Gs;(function(e){e.Empty=new Map;function t(o){return uk(o.keys())}e.keyArray=t;function r(){return new Map}e.Mutable=r;function n(o){return o}e.asImmutable=n;function a(o){for(var s=r(),u=o.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;s.set(d,o.get(d))}return s}e.copy=a;function i(o,s){for(var u=s.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;o.set(d,s.get(d))}return o}e.addFrom=i})(Gs||(Gs={}));var x_e=function(){function e(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),m8=function(){function e(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),S_e=function(){function e(t){this.value=t,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),C_e=function(){function e(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}return e.prototype.move=function(){var t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t},e}(),__e=function(){function e(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}return e.prototype.move=function(){var t=this.next;return this.hasNext=this.findNext(),t},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}(),FC;(function(e){e.Empty=new m8(0,-1);function t(s){return new x_e(s)}e.Array=t;function r(s){return new S_e(s)}e.Value=r;function n(s,u){return new m8(s,u)}e.Range=n;function a(s,u){return new C_e(s,u)}e.map=a;function i(s,u){return new __e(s,u)}e.filter=i;function o(s,u,l){for(;s.hasNext;){var c=u(s.move(),l);if(c)return l}return l}e.forEach=o})(FC||(FC={}));var w_e={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},Fu;(function(e){function t(r){var n=E(E({},w_e),r),a=n.domain,i=n.reverse,o=n.listOrName,s=typeof o=="string"?Hs(o).list:o,u=i?s.slice().reverse():s,l=u.length-1,c=0,d=0,f=0;function h(C,w){d=C,f=w,c=f-d||1}h(a[0],a[1]);var v=Da(r.minLabel,d.toString()),p=Da(r.maxLabel,f.toString()),g,m=u.every(function(C){return Array.isArray(C)});if(m){var y=Ut([],u);y.sort(function(C,w){return C[1]-w[1]});var b=y.map(function(C){return C[0]}),S=it.ofSortedArray(y.map(function(C){return C[1]})),x=b.length-1;g=function(C){var w=ki((C-d)/c,0,1),A=it.findPredecessorIndex(S,w);if(A===0)return b[d];if(A>x)return b[x];var I=S[A-1],D=S[A],k=ki((w-I)/(D-I),0,1);return dt.interpolate(b[A-1],b[A],k)}}else g=function(C){var w=Math.min(u.length-1,Math.max(0,(C-d)/c*l)),A=Math.floor(w),I=u[A],D=u[Math.ceil(w)];return dt.interpolate(I,D,w-A)};return{color:g,colorToArray:function(C,w,A){dt.toArray(g(C),w,A)},normalizedColorToArray:function(C,w,A){dt.toArrayNormalized(g(C),w,A)},setDomain:h,get legend(){return PSe(v,p,u)}}}e.create=t})(Fu||(Fu={}));function on(e){return e.svg?M.jsx("span",E({className:"msp-icon msp-material-icon"+(e.inline?" msp-icon-inline":""),title:e.title,style:e.style},{children:M.jsx(e.svg,{},void 0)}),void 0):null}var a3=M.jsx("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"},void 0),i3=M.jsx("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"},void 0),E_e=M.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[M.jsxs("defs",{children:[a3,i3]},void 0),M.jsxs("g",{children:[M.jsx("use",{href:"#circle-left",className:"msp-shape-filled"},void 0),M.jsx("use",{href:"#circle-right",className:"msp-shape-filled"},void 0),M.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function ZI(){return E_e}var A_e=M.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[M.jsxs("defs",{children:[a3,i3,M.jsxs("mask",E({id:"mask-left"},{children:[M.jsx("use",{href:"#circle-left",fill:"white",stroke:"white"},void 0),M.jsx("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"},void 0)]}),void 0)]},void 0),M.jsxs("g",{children:[M.jsx("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"},void 0),M.jsx("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function JI(){return A_e}var P_e=M.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[M.jsxs("defs",{children:[a3,i3,M.jsx("clipPath",E({id:"clip-left"},{children:M.jsx("use",{href:"#circle-right"},void 0)}),void 0)]},void 0),M.jsxs("g",{children:[M.jsx("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"},void 0),M.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),M.jsx("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function eM(){return P_e}var T_e=M.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[M.jsxs("defs",{children:[a3,i3]},void 0),M.jsxs("g",{children:[M.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),M.jsx("use",{href:"#circle-right",className:"msp-shape-filled"},void 0)]},void 0)]}),void 0);function BC(){return T_e}var I_e=M.jsx("svg",E({width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px"},{children:M.jsx("g",{children:M.jsx("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"},void 0)},void 0)}),void 0);function M_e(){return I_e}var D_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:M.jsx("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"},void 0)}),void 0);function tM(){return D_e}M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:M.jsx("path",{d:"M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z"},void 0)}),void 0);M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:M.jsx("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"},void 0)}),void 0);var R_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"},void 0)}),void 0);function k_e(){return R_e}M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:M.jsx("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"},void 0)}),void 0);var O_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:M.jsx("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"},void 0)}),void 0);function L_e(){return O_e}var N_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"},void 0)}),void 0);function RX(){return N_e}var F_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},void 0)}),void 0);function Wg(){return F_e}var B_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"},void 0)}),void 0);function o3(){return B_e}var U_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M7 10l5 5 5-5z"},void 0)}),void 0);function Hc(){return U_e}var j_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M10 17l5-5-5-5v10z"},void 0)}),void 0);function Gc(){return j_e}var z_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"},void 0)}),void 0);function s3(){return z_e}var V_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"},void 0)}),void 0);function H_e(){return V_e}var G_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"},void 0)}),void 0);function kX(){return G_e}var q_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"},void 0)}),void 0);function u3(){return q_e}var W_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"},void 0)}),void 0);function rM(){return W_e}var $_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"},void 0)}),void 0);function X_e(){return $_e}var Y_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"},void 0)}),void 0);function K_e(){return Y_e}var Q_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"},void 0)}),void 0);function Z_e(){return Q_e}var J_e=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"},void 0)}),void 0);function ewe(){return J_e}var twe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"},void 0)}),void 0);function dk(){return twe}var rwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"},void 0)}),void 0);function OX(){return rwe}var nwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"},void 0)}),void 0);function awe(){return nwe}var iwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},void 0)}),void 0);function $g(){return iwe}var owe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function LX(){return owe}var swe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function Sc(){return swe}var uwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"},void 0)}),void 0);function lwe(){return uwe}var cwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"},void 0)}),void 0);function dwe(){return cwe}var fwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"},void 0)}),void 0);function hwe(){return fwe}var pwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"},void 0)}),void 0);function vwe(){return pwe}var mwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"},void 0)}),void 0);function gwe(){return mwe}var ywe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"},void 0)}),void 0);function bwe(){return ywe}var xwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"},void 0)}),void 0);function Zs(){return xwe}M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},void 0)}),void 0);var Swe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"},void 0)}),void 0);function g8(){return Swe}M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"},void 0)}),void 0);var Cwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:M.jsx("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"},void 0)}),void 0);function _we(){return Cwe}var wwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"},void 0)}),void 0);function Ewe(){return wwe}var Awe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"},void 0)}),void 0);function nM(){return Awe}var Pwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"},void 0)}),void 0);function Il(){return Pwe}var Twe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"},void 0)}),void 0);function aM(){return Twe}M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},void 0)}),void 0);var Iwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"},void 0)}),void 0);function Mwe(){return Iwe}var Dwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},void 0)}),void 0);function Up(){return Dwe}var Rwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"},void 0)}),void 0);function NX(){return Rwe}var kwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"},void 0)}),void 0);function FX(){return kwe}var Owe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"},void 0)}),void 0);function Lwe(){return Owe}var Nwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M8 5v14l11-7z"},void 0)}),void 0);function BX(){return Nwe}var Fwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},void 0)}),void 0);function iM(){return Fwe}var Bwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M19 13H5v-2h14v2z"},void 0)}),void 0);function oM(){return Bwe}var Uwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"},void 0)}),void 0);function sM(){return Uwe}var jwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:M.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"},void 0)}),void 0);function UX(){return jwe}var zwe=M.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[M.jsx("circle",{cx:"7",cy:"14",r:"3"},void 0),M.jsx("circle",{cx:"11",cy:"6",r:"3"},void 0),M.jsx("circle",{cx:"16.6",cy:"17.6",r:"3"},void 0)]}),void 0);function Vwe(){return zwe}var Hwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"},void 0)}),void 0);function Gwe(){return Hwe}var qwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M6 6h12v12H6z"},void 0)}),void 0);function jX(){return qwe}var Wwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"},void 0)}),void 0);function $we(){return Wwe}var Xwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"},void 0)}),void 0);function Ywe(){return Xwe}var Kwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"},void 0)}),void 0);function jp(){return Kwe}var Qwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"},void 0)}),void 0);function fv(){return Qwe}var Zwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"},void 0)}),void 0);function hv(){return Zwe}var Jwe=M.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:M.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"},void 0)}),void 0);function e3e(){return Jwe}var t3e=k_e,r3e=Vwe,y8=Mwe,n3e=_we,Cc=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initialExpanded},r.headerClicked=function(){r.props.onHeaderClick?r.props.onHeaderClick():r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(r+=" "+this.props.childrenClassName),M.jsxs("div",E({className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0}},{children:[M.jsx("div",E({className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title},{children:M.jsxs(pr,E({onClick:this.headerClicked},{children:[!this.props.hideExpander&&M.jsx(on,{svg:this.state.isExpanded?Gc:Hc},void 0),this.props.topRightIcon&&M.jsx(on,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}},void 0),M.jsx("b",{children:this.props.header},void 0)]}),void 0)}),void 0),this.state.isExpanded&&M.jsx("div",E({className:r,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"}},{children:this.props.children}),void 0)]}),void 0)},t}(ze.Component);function b8(e){return e}var Dc=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.input=ze.createRef(),r.delayHandle=void 0,r.pendingValue=void 0,r.state={originalValue:"",value:""},r.onBlur=function(){r.setState({value:""+r.state.originalValue}),r.props.onBlur&&r.props.onBlur()},r.raiseOnChange=function(){r.pendingValue!==void 0&&(r.props.onChange(r.pendingValue),r.pendingValue=void 0)},r.onChange=function(n){var a=n.target.value,i=r.props.isValid&&!r.props.isValid(a)||r.props.numeric&&Number.isNaN(+a);if(i){r.clearTimeout(),r.setState({value:a});return}if(r.props.numeric)r.setState({value:a},function(){return r.triggerChanged(a,+a)});else{var o=(r.props.toValue||b8)(a),s=(r.props.fromValue||b8)(o);r.setState({value:s},function(){return r.triggerChanged(s,o)})}},r.onKeyUp=function(n){(n.charCode===27||n.keyCode===27||n.key==="Escape")&&r.props.blurOnEscape&&r.input.current&&r.input.current.blur()},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&(r.isPending&&(r.clearTimeout(),r.raiseOnChange()),r.props.blurOnEnter&&r.input.current&&r.input.current.blur(),r.props.onEnter&&r.props.onEnter()),n.stopPropagation()},r}return Object.defineProperty(t.prototype,"isPending",{get:function(){return typeof this.delayHandle<"u"},enumerable:!1,configurable:!0}),t.prototype.clearTimeout=function(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)},t.prototype.triggerChanged=function(r,n){this.clearTimeout(),r!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=n,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(n))},t.getDerivedStateFromProps=function(r,n){var a=r.fromValue?r.fromValue(r.value):r.value;return a===n.originalValue?null:{originalValue:a,value:a}},t.prototype.render=function(){return M.jsx("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled},void 0)},t}(ze.PureComponent),a3e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props,n=r.label,a=r.pivot,i=r.controls;return M.jsxs(M.Fragment,{children:[M.jsx(qs,E({label:M.jsxs(M.Fragment,{children:[n,M.jsx("button",E({className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:(this.state.isExpanded?"Less":"More")+" options",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:M.jsx(on,{svg:this.state.isExpanded?oM:Wg,style:{display:"inline-block"}},void 0)}),void 0)]},void 0),control:a},{children:this.props.colorStripe&&M.jsx("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:dt.toStyle(this.props.colorStripe)}},void 0)}),void 0),this.state.isExpanded&&M.jsx("div",E({className:"msp-control-offset"},{children:i}),void 0)]},void 0)},t}(ze.Component);function _c(e){return M.jsxs("div",E({className:"msp-section-header"+(e.accent?" msp-transform-header-brand-"+e.accent:"")},{children:[e.icon&&M.jsx(on,{svg:e.icon},void 0),e.title," ",M.jsx("small",{children:e.desc},void 0)]}),void 0)}function pr(e){var t="msp-btn";e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),(e.commit==="on"||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),e.commit==="off"&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className);var r=void 0;return e.flex&&(typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:typeof e.flex=="string"&&(r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex})),e.style&&(r?Object.assign(r,e.style):r=e.style),M.jsxs("button",E({onClick:e.onClick,title:e.title,disabled:e.disabled,style:r,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},{children:[e.icon&&M.jsx(on,{svg:e.icon},void 0),e.children]}),void 0)}function qt(e){var t="msp-btn msp-btn-icon"+(e.small?"-small":"")+(e.className?" "+e.className:"");typeof e.toggleState<"u"&&(t+=" msp-btn-link-toggle-"+(e.toggleState?"on":"off")),e.transparent&&(t+=" msp-transparent-bg");var r=void 0;return e.flex&&(typeof e.flex=="boolean"?r={flex:"0 0 32px",padding:0}:typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex}),e.style&&(r?Object.assign(r,e.style):r=e.style),M.jsxs("button",E({className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:r},{children:[e.svg&&M.jsx(on,{svg:e.svg},void 0),e.extraContent]}),void 0)}var Ra=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){n.currentTarget.blur(),r.props.toggle()},r}return t.prototype.render=function(){var r=this.props,n=r.label,a=r.isSelected?(r.className||"")+" msp-control-current":r.className;return M.jsx(pr,E({icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:r.disabled,style:r.style,className:a},{children:n&&this.props.isSelected?M.jsx("b",{children:n},void 0):n}),void 0)},t}(ze.PureComponent),Bu=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return M.jsxs(M.Fragment,{children:[M.jsx("div",E({className:"msp-control-group-header",style:{marginTop:this.props.marginTop!==void 0?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin}},{children:M.jsxs("button",E({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle},{children:[M.jsx(on,{svg:this.state.isExpanded?Hc:Gc},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&(this.props.noOffset?this.props.children:M.jsx("div",E({className:this.props.accent?"msp-accent-offset":"msp-control-offset"},{children:this.props.children}),void 0))]},void 0)},t}(ze.PureComponent);function qs(e){var t="msp-control-row";return e.className&&(t+=" "+e.className),M.jsxs("div",E({className:t},{children:[M.jsx("span",E({className:"msp-control-row-label",title:e.title},{children:e.label}),void 0),M.jsx("div",E({className:"msp-control-row-ctrl"},{children:e.control}),void 0),e.children]}),void 0)}var l3=ze.createContext(void 0),vr=function(e){Be(t,e);function t(r,n){var a=e.call(this,r)||this;return a.subs=void 0,a.plugin=n,a.init&&a.init(),a}return t.prototype.subscribe=function(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(this.subs){for(var r=0,n=this.subs;r<n.length;r++){var a=n[r];a.unsubscribe()}this.subs=void 0}},t.contextType=l3,t}(ze.Component),Ka=function(e){Be(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.subs=void 0,a.plugin=n,a.init&&a.init(),a}return t.prototype.subscribe=function(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(this.subs){for(var r=0,n=this.subs;r<n.length;r++){var a=n[r];a.unsubscribe()}this.subs=void 0}},t.contextType=l3,t}(ze.PureComponent),Xg=function(e){Be(t,e);function t(r,n){var a=e.call(this,r,n)||this;a.toggleCollapsed=function(){a.setState({isCollapsed:!a.state.isCollapsed})};var i=a.defaultState();return r.initiallyCollapsed!==void 0&&(i.isCollapsed=r.initiallyCollapsed),r.header!==void 0&&(i.header=r.header),a.state=i,a}return t.prototype.componentDidUpdate=function(r){this.props.initiallyCollapsed!==void 0&&r.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})},t.prototype.render=function(){var r;if(this.state.isHidden)return null;var n=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";return M.jsxs("div",E({className:n},{children:[M.jsx("div",E({className:"msp-transform-header"},{children:M.jsxs(pr,E({icon:this.state.brand?void 0:this.state.isCollapsed?Gc:Hc,noOverflow:!0,onClick:this.toggleCollapsed,className:this.state.brand?"msp-transform-header-brand msp-transform-header-brand-"+this.state.brand.accent:void 0,title:"Click to "+(this.state.isCollapsed?"expand":"collapse")},{children:[M.jsx(on,{svg:(r=this.state.brand)===null||r===void 0?void 0:r.svg,inline:!0},void 0),this.state.header,M.jsx("small",E({style:{margin:"0 6px"}},{children:this.state.isCollapsed?"":this.state.description}),void 0)]}),void 0)}),void 0),!this.state.isCollapsed&&this.renderControls()]}),void 0)},t}(vr),On;(function(e){function t(){return function(a){return r(a)}}e.factory=t;function r(a){var i;return i=function(){function o(s,u){this.data=s,this.id=pn.create22(),this.type=a,this.label=u&&u.label||a.name,this.description=u&&u.description}return o.is=function(s){return!!s&&a===s.type},o}(),i.type=a,i}e.create=r;function n(a,i){if(!a.tags)return!1;for(var o=0,s=a.tags;o<s.length;o++){var u=s[o];if(u===i)return!0}return!1}e.hasTag=n,e.Null={id:pn.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(On||(On={}));var V1;(function(e){function t(n){var a=n;return!!a&&!!a.transform&&!!a.parent&&!!a.status}e.is=t;function r(n,a){var i=typeof a=="string"?a:e.is(a)?a.transform.ref:a.ref;return n.cells.get(i)}e.resolve=r})(V1||(V1={}));var zX=function(){function e(t,r){this.ref=t,this.state=r}return Object.defineProperty(e.prototype,"cell",{get:function(){var t;return(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){var t,r;return(r=(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref))===null||r===void 0?void 0:r.obj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t;return(t=this.obj)===null||t===void 0?void 0:t.data},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r},e.prototype.checkValid=function(){if(!this.state)throw new Error("Unassigned State.");var t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===On.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")},Object.defineProperty(e.prototype,"isOk",{get:function(){var t=this.cell;return t&&t.status==="ok"&&t.obj!==On.Null},enumerable:!1,configurable:!0}),e}(),La;(function(e){function t(a){var i;if(a)return typeof a=="string"?a:V1.is(a)?a.transform.ref:(i=a.cell)===null||i===void 0?void 0:i.transform.ref}e.resolveRef=t;function r(a,i){if(i)return V1.is(i)?i:typeof i=="string"?a.cells.get(i):i.cell}e.resolve=r;function n(a,i){var o=r(a,i);if(!(!o||!o.obj||o.status!=="ok"))return o}e.resolveAndCheck=n})(La||(La={}));var VX={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Kh,function(){var r=Array.prototype.slice;function n(P,F){F&&(P.prototype=Object.create(F.prototype)),P.prototype.constructor=P}function a(P){return u(P)?P:xe(P)}n(i,a);function i(P){return l(P)?P:Ie(P)}n(o,a);function o(P){return c(P)?P:_e(P)}n(s,a);function s(P){return u(P)&&!d(P)?P:ae(P)}function u(P){return!!(P&&P[h])}function l(P){return!!(P&&P[v])}function c(P){return!!(P&&P[p])}function d(P){return l(P)||c(P)}function f(P){return!!(P&&P[g])}a.isIterable=u,a.isKeyed=l,a.isIndexed=c,a.isAssociative=d,a.isOrdered=f,a.Keyed=i,a.Indexed=o,a.Set=s;var h="@@__IMMUTABLE_ITERABLE__@@",v="@@__IMMUTABLE_KEYED__@@",p="@@__IMMUTABLE_INDEXED__@@",g="@@__IMMUTABLE_ORDERED__@@",m="delete",y=5,b=1<<y,S=b-1,x={},C={value:!1},w={value:!1};function A(P){return P.value=!1,P}function I(P){P&&(P.value=!0)}function D(){}function k(P,F){F=F||0;for(var K=Math.max(0,P.length-F),re=new Array(K),oe=0;oe<K;oe++)re[oe]=P[oe+F];return re}function R(P){return P.size===void 0&&(P.size=P.__iterate(H)),P.size}function L(P,F){if(typeof F!="number"){var K=F>>>0;if(""+K!==F||K===4294967295)return NaN;F=K}return F<0?R(P)+F:F}function H(){return!0}function B(P,F,K){return(P===0||K!==void 0&&P<=-K)&&(F===void 0||K!==void 0&&F>=K)}function j(P,F){return G(P,F,0)}function Q(P,F){return G(P,F,F)}function G(P,F,K){return P===void 0?K:P<0?Math.max(0,F+P):F===void 0?P:Math.min(F,P)}var W=0,q=1,J=2,he=typeof Symbol=="function"&&Symbol.iterator,$="@@iterator",X=he||$;function U(P){this.next=P}U.prototype.toString=function(){return"[Iterator]"},U.KEYS=W,U.VALUES=q,U.ENTRIES=J,U.prototype.inspect=U.prototype.toSource=function(){return this.toString()},U.prototype[X]=function(){return this};function z(P,F,K,re){var oe=P===0?F:P===1?K:[F,K];return re?re.value=oe:re={value:oe,done:!1},re}function ee(){return{value:void 0,done:!0}}function Y(P){return!!ce(P)}function Z(P){return P&&typeof P.next=="function"}function te(P){var F=ce(P);return F&&F.call(P)}function ce(P){var F=P&&(he&&P[he]||P[$]);if(typeof F=="function")return F}function be(P){return P&&typeof P.length=="number"}n(xe,a);function xe(P){return P==null?$e():u(P)?P.toSeq():Ue(P)}xe.of=function(){return xe(arguments)},xe.prototype.toSeq=function(){return this},xe.prototype.toString=function(){return this.__toString("Seq {","}")},xe.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},xe.prototype.__iterate=function(P,F){return ut(this,P,F,!0)},xe.prototype.__iterator=function(P,F){return Ee(this,P,F,!0)},n(Ie,xe);function Ie(P){return P==null?$e().toKeyedSeq():u(P)?l(P)?P.toSeq():P.fromEntrySeq():Ze(P)}Ie.prototype.toKeyedSeq=function(){return this},n(_e,xe);function _e(P){return P==null?$e():u(P)?l(P)?P.entrySeq():P.toIndexedSeq():ht(P)}_e.of=function(){return _e(arguments)},_e.prototype.toIndexedSeq=function(){return this},_e.prototype.toString=function(){return this.__toString("Seq [","]")},_e.prototype.__iterate=function(P,F){return ut(this,P,F,!1)},_e.prototype.__iterator=function(P,F){return Ee(this,P,F,!1)},n(ae,xe);function ae(P){return(P==null?$e():u(P)?l(P)?P.entrySeq():P:ht(P)).toSetSeq()}ae.of=function(){return ae(arguments)},ae.prototype.toSetSeq=function(){return this},xe.isSeq=Me,xe.Keyed=Ie,xe.Set=ae,xe.Indexed=_e;var ie="@@__IMMUTABLE_SEQ__@@";xe.prototype[ie]=!0,n(O,_e);function O(P){this._array=P,this.size=P.length}O.prototype.get=function(P,F){return this.has(P)?this._array[L(this,P)]:F},O.prototype.__iterate=function(P,F){for(var K=this._array,re=K.length-1,oe=0;oe<=re;oe++)if(P(K[F?re-oe:oe],oe,this)===!1)return oe+1;return oe},O.prototype.__iterator=function(P,F){var K=this._array,re=K.length-1,oe=0;return new U(function(){return oe>re?ee():z(P,oe,K[F?re-oe++:oe++])})},n(V,Ie);function V(P){var F=Object.keys(P);this._object=P,this._keys=F,this.size=F.length}V.prototype.get=function(P,F){return F!==void 0&&!this.has(P)?F:this._object[P]},V.prototype.has=function(P){return this._object.hasOwnProperty(P)},V.prototype.__iterate=function(P,F){for(var K=this._object,re=this._keys,oe=re.length-1,Ce=0;Ce<=oe;Ce++){var De=re[F?oe-Ce:Ce];if(P(K[De],De,this)===!1)return Ce+1}return Ce},V.prototype.__iterator=function(P,F){var K=this._object,re=this._keys,oe=re.length-1,Ce=0;return new U(function(){var De=re[F?oe-Ce:Ce];return Ce++>oe?ee():z(P,De,K[De])})},V.prototype[g]=!0,n(ve,_e);function ve(P){this._iterable=P,this.size=P.length||P.size}ve.prototype.__iterateUncached=function(P,F){if(F)return this.cacheResult().__iterate(P,F);var K=this._iterable,re=te(K),oe=0;if(Z(re))for(var Ce;!(Ce=re.next()).done&&P(Ce.value,oe++,this)!==!1;);return oe},ve.prototype.__iteratorUncached=function(P,F){if(F)return this.cacheResult().__iterator(P,F);var K=this._iterable,re=te(K);if(!Z(re))return new U(ee);var oe=0;return new U(function(){var Ce=re.next();return Ce.done?Ce:z(P,oe++,Ce.value)})},n(Pe,_e);function Pe(P){this._iterator=P,this._iteratorCache=[]}Pe.prototype.__iterateUncached=function(P,F){if(F)return this.cacheResult().__iterate(P,F);for(var K=this._iterator,re=this._iteratorCache,oe=0;oe<re.length;)if(P(re[oe],oe++,this)===!1)return oe;for(var Ce;!(Ce=K.next()).done;){var De=Ce.value;if(re[oe]=De,P(De,oe++,this)===!1)break}return oe},Pe.prototype.__iteratorUncached=function(P,F){if(F)return this.cacheResult().__iterator(P,F);var K=this._iterator,re=this._iteratorCache,oe=0;return new U(function(){if(oe>=re.length){var Ce=K.next();if(Ce.done)return Ce;re[oe]=Ce.value}return z(P,oe,re[oe++])})};function Me(P){return!!(P&&P[ie])}var Ge;function $e(){return Ge||(Ge=new O([]))}function Ze(P){var F=Array.isArray(P)?new O(P).fromEntrySeq():Z(P)?new Pe(P).fromEntrySeq():Y(P)?new ve(P).fromEntrySeq():typeof P=="object"?new V(P):void 0;if(!F)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+P);return F}function ht(P){var F=rt(P);if(!F)throw new TypeError("Expected Array or iterable object of values: "+P);return F}function Ue(P){var F=rt(P)||typeof P=="object"&&new V(P);if(!F)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+P);return F}function rt(P){return be(P)?new O(P):Z(P)?new Pe(P):Y(P)?new ve(P):void 0}function ut(P,F,K,re){var oe=P._cache;if(oe){for(var Ce=oe.length-1,De=0;De<=Ce;De++){var qe=oe[K?Ce-De:De];if(F(qe[1],re?qe[0]:De,P)===!1)return De+1}return De}return P.__iterateUncached(F,K)}function Ee(P,F,K,re){var oe=P._cache;if(oe){var Ce=oe.length-1,De=0;return new U(function(){var qe=oe[K?Ce-De:De];return De++>Ce?ee():z(F,re?qe[0]:De-1,qe[1])})}return P.__iteratorUncached(F,K)}function Te(P,F){return F?ye(F,P,"",{"":P}):Se(P)}function ye(P,F,K,re){return Array.isArray(F)?P.call(re,K,_e(F).map(function(oe,Ce){return ye(P,oe,Ce,F)})):Le(F)?P.call(re,K,Ie(F).map(function(oe,Ce){return ye(P,oe,Ce,F)})):F}function Se(P){return Array.isArray(P)?_e(P).map(Se).toList():Le(P)?Ie(P).map(Se).toMap():P}function Le(P){return P&&(P.constructor===Object||P.constructor===void 0)}function Ve(P,F){if(P===F||P!==P&&F!==F)return!0;if(!P||!F)return!1;if(typeof P.valueOf=="function"&&typeof F.valueOf=="function"){if(P=P.valueOf(),F=F.valueOf(),P===F||P!==P&&F!==F)return!0;if(!P||!F)return!1}return!!(typeof P.equals=="function"&&typeof F.equals=="function"&&P.equals(F))}function nt(P,F){if(P===F)return!0;if(!u(F)||P.size!==void 0&&F.size!==void 0&&P.size!==F.size||P.__hash!==void 0&&F.__hash!==void 0&&P.__hash!==F.__hash||l(P)!==l(F)||c(P)!==c(F)||f(P)!==f(F))return!1;if(P.size===0&&F.size===0)return!0;var K=!d(P);if(f(P)){var re=P.entries();return F.every(function(ot,ft){var bt=re.next().value;return bt&&Ve(bt[1],ot)&&(K||Ve(bt[0],ft))})&&re.next().done}var oe=!1;if(P.size===void 0)if(F.size===void 0)typeof P.cacheResult=="function"&&P.cacheResult();else{oe=!0;var Ce=P;P=F,F=Ce}var De=!0,qe=F.__iterate(function(ot,ft){if(K?!P.has(ot):oe?!Ve(ot,P.get(ft,x)):!Ve(P.get(ft,x),ot))return De=!1,!1});return De&&P.size===qe}n(Xe,_e);function Xe(P,F){if(!(this instanceof Xe))return new Xe(P,F);if(this._value=P,this.size=F===void 0?1/0:Math.max(0,F),this.size===0){if(He)return He;He=this}}Xe.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},Xe.prototype.get=function(P,F){return this.has(P)?this._value:F},Xe.prototype.includes=function(P){return Ve(this._value,P)},Xe.prototype.slice=function(P,F){var K=this.size;return B(P,F,K)?this:new Xe(this._value,Q(F,K)-j(P,K))},Xe.prototype.reverse=function(){return this},Xe.prototype.indexOf=function(P){return Ve(this._value,P)?0:-1},Xe.prototype.lastIndexOf=function(P){return Ve(this._value,P)?this.size:-1},Xe.prototype.__iterate=function(P,F){for(var K=0;K<this.size;K++)if(P(this._value,K,this)===!1)return K+1;return K},Xe.prototype.__iterator=function(P,F){var K=this,re=0;return new U(function(){return re<K.size?z(P,re++,K._value):ee()})},Xe.prototype.equals=function(P){return P instanceof Xe?Ve(this._value,P._value):nt(P)};var He;function se(P,F){if(!P)throw new Error(F)}n(pe,_e);function pe(P,F,K){if(!(this instanceof pe))return new pe(P,F,K);if(se(K!==0,"Cannot step a Range by 0"),P=P||0,F===void 0&&(F=1/0),K=K===void 0?1:Math.abs(K),F<P&&(K=-K),this._start=P,this._end=F,this._step=K,this.size=Math.max(0,Math.ceil((F-P)/K-1)+1),this.size===0){if(Ae)return Ae;Ae=this}}pe.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},pe.prototype.get=function(P,F){return this.has(P)?this._start+L(this,P)*this._step:F},pe.prototype.includes=function(P){var F=(P-this._start)/this._step;return F>=0&&F<this.size&&F===Math.floor(F)},pe.prototype.slice=function(P,F){return B(P,F,this.size)?this:(P=j(P,this.size),F=Q(F,this.size),F<=P?new pe(0,0):new pe(this.get(P,this._end),this.get(F,this._end),this._step))},pe.prototype.indexOf=function(P){var F=P-this._start;if(F%this._step===0){var K=F/this._step;if(K>=0&&K<this.size)return K}return-1},pe.prototype.lastIndexOf=function(P){return this.indexOf(P)},pe.prototype.__iterate=function(P,F){for(var K=this.size-1,re=this._step,oe=F?this._start+K*re:this._start,Ce=0;Ce<=K;Ce++){if(P(oe,Ce,this)===!1)return Ce+1;oe+=F?-re:re}return Ce},pe.prototype.__iterator=function(P,F){var K=this.size-1,re=this._step,oe=F?this._start+K*re:this._start,Ce=0;return new U(function(){var De=oe;return oe+=F?-re:re,Ce>K?ee():z(P,Ce++,De)})},pe.prototype.equals=function(P){return P instanceof pe?this._start===P._start&&this._end===P._end&&this._step===P._step:nt(this,P)};var Ae;n(Ye,a);function Ye(){throw TypeError("Abstract")}n(ct,Ye);function ct(){}n(St,Ye);function St(){}n(Bt,Ye);function Bt(){}Ye.Keyed=ct,Ye.Indexed=St,Ye.Set=Bt;var rr=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(F,K){F=F|0,K=K|0;var re=F&65535,oe=K&65535;return re*oe+((F>>>16)*oe+re*(K>>>16)<<16>>>0)|0};function hr(P){return P>>>1&1073741824|P&3221225471}function Lt(P){if(P===!1||P===null||P===void 0||typeof P.valueOf=="function"&&(P=P.valueOf(),P===!1||P===null||P===void 0))return 0;if(P===!0)return 1;var F=typeof P;if(F==="number"){if(P!==P||P===1/0)return 0;var K=P|0;for(K!==P&&(K^=P*4294967295);P>4294967295;)P/=4294967295,K^=P;return hr(K)}if(F==="string")return P.length>fs?En(P):ha(P);if(typeof P.hashCode=="function")return P.hashCode();if(F==="object")return pa(P);if(typeof P.toString=="function")return ha(P.toString());throw new Error("Value type "+F+" cannot be hashed.")}function En(P){var F=xh[P];return F===void 0&&(F=ha(P),zl===bh&&(zl=0,xh={}),zl++,xh[P]=F),F}function ha(P){for(var F=0,K=0;K<P.length;K++)F=31*F+P.charCodeAt(K)|0;return hr(F)}function pa(P){var F;if(Xn&&(F=so.get(P),F!==void 0)||(F=P[An],F!==void 0)||!Vi&&(F=P.propertyIsEnumerable&&P.propertyIsEnumerable[An],F!==void 0||(F=tn(P),F!==void 0)))return F;if(F=++tu,tu&1073741824&&(tu=0),Xn)so.set(P,F);else{if(ui!==void 0&&ui(P)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(Vi)Object.defineProperty(P,An,{enumerable:!1,configurable:!1,writable:!1,value:F});else if(P.propertyIsEnumerable!==void 0&&P.propertyIsEnumerable===P.constructor.prototype.propertyIsEnumerable)P.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},P.propertyIsEnumerable[An]=F;else if(P.nodeType!==void 0)P[An]=F;else throw new Error("Unable to set a non-enumerable property on object.")}return F}var ui=Object.isExtensible,Vi=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function tn(P){if(P&&P.nodeType>0)switch(P.nodeType){case 1:return P.uniqueID;case 9:return P.documentElement&&P.documentElement.uniqueID}}var Xn=typeof WeakMap=="function",so;Xn&&(so=new WeakMap);var tu=0,An="__immutablehash__";typeof Symbol=="function"&&(An=Symbol(An));var fs=16,bh=255,zl=0,xh={};function Hi(P){se(P!==1/0,"Cannot perform this action with an infinite size.")}n(Qr,ct);function Qr(P){return P==null?ru():pE(P)&&!f(P)?P:ru().withMutations(function(F){var K=i(P);Hi(K.size),K.forEach(function(re,oe){return F.set(oe,re)})})}Qr.of=function(){var P=r.call(arguments,0);return ru().withMutations(function(F){for(var K=0;K<P.length;K+=2){if(K+1>=P.length)throw new Error("Missing value for key: "+P[K]);F.set(P[K],P[K+1])}})},Qr.prototype.toString=function(){return this.__toString("Map {","}")},Qr.prototype.get=function(P,F){return this._root?this._root.get(0,void 0,P,F):F},Qr.prototype.set=function(P,F){return _L(this,P,F)},Qr.prototype.setIn=function(P,F){return this.updateIn(P,x,function(){return F})},Qr.prototype.remove=function(P){return _L(this,P,x)},Qr.prototype.deleteIn=function(P){return this.updateIn(P,function(){return x})},Qr.prototype.update=function(P,F,K){return arguments.length===1?P(this):this.updateIn([P],F,K)},Qr.prototype.updateIn=function(P,F,K){K||(K=F,F=void 0);var re=TL(this,YL(P),F,K);return re===x?void 0:re},Qr.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):ru()},Qr.prototype.merge=function(){return Zb(this,void 0,arguments)},Qr.prototype.mergeWith=function(P){var F=r.call(arguments,1);return Zb(this,P,F)},Qr.prototype.mergeIn=function(P){var F=r.call(arguments,1);return this.updateIn(P,ru(),function(K){return typeof K.merge=="function"?K.merge.apply(K,F):F[F.length-1]})},Qr.prototype.mergeDeep=function(){return Zb(this,EL,arguments)},Qr.prototype.mergeDeepWith=function(P){var F=r.call(arguments,1);return Zb(this,AL(P),F)},Qr.prototype.mergeDeepIn=function(P){var F=r.call(arguments,1);return this.updateIn(P,ru(),function(K){return typeof K.mergeDeep=="function"?K.mergeDeep.apply(K,F):F[F.length-1]})},Qr.prototype.sort=function(P){return Sa(Lv(this,P))},Qr.prototype.sortBy=function(P,F){return Sa(Lv(this,F,P))},Qr.prototype.withMutations=function(P){var F=this.asMutable();return P(F),F.wasAltered()?F.__ensureOwner(this.__ownerID):this},Qr.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new D)},Qr.prototype.asImmutable=function(){return this.__ensureOwner()},Qr.prototype.wasAltered=function(){return this.__altered},Qr.prototype.__iterator=function(P,F){return new vE(this,P,F)},Qr.prototype.__iterate=function(P,F){var K=this,re=0;return this._root&&this._root.iterate(function(oe){return re++,P(oe[1],oe[0],K)},F),re},Qr.prototype.__ensureOwner=function(P){return P===this.__ownerID?this:P?gE(this.size,this._root,P,this.__hash):(this.__ownerID=P,this.__altered=!1,this)};function pE(P){return!!(P&&P[xL])}Qr.isMap=pE;var xL="@@__IMMUTABLE_MAP__@@",Gr=Qr.prototype;Gr[xL]=!0,Gr[m]=Gr.remove,Gr.removeIn=Gr.deleteIn;function d0(P,F){this.ownerID=P,this.entries=F}d0.prototype.get=function(P,F,K,re){for(var oe=this.entries,Ce=0,De=oe.length;Ce<De;Ce++)if(Ve(K,oe[Ce][0]))return oe[Ce][1];return re},d0.prototype.update=function(P,F,K,re,oe,Ce,De){for(var qe=oe===x,ot=this.entries,ft=0,bt=ot.length;ft<bt&&!Ve(re,ot[ft][0]);ft++);var Nt=ft<bt;if(Nt?ot[ft][1]===oe:qe)return this;if(I(De),(qe||!Nt)&&I(Ce),!(qe&&ot.length===1)){if(!Nt&&!qe&&ot.length>=Sne)return mne(P,ot,re,oe);var Wt=P&&P===this.ownerID,Sr=Wt?ot:k(ot);return Nt?qe?ft===bt-1?Sr.pop():Sr[ft]=Sr.pop():Sr[ft]=[re,oe]:Sr.push([re,oe]),Wt?(this.entries=Sr,this):new d0(P,Sr)}};function Iv(P,F,K){this.ownerID=P,this.bitmap=F,this.nodes=K}Iv.prototype.get=function(P,F,K,re){F===void 0&&(F=Lt(K));var oe=1<<((P===0?F:F>>>P)&S),Ce=this.bitmap;return Ce&oe?this.nodes[IL(Ce&oe-1)].get(P+y,F,K,re):re},Iv.prototype.update=function(P,F,K,re,oe,Ce,De){K===void 0&&(K=Lt(re));var qe=(F===0?K:K>>>F)&S,ot=1<<qe,ft=this.bitmap,bt=(ft&ot)!==0;if(!bt&&oe===x)return this;var Nt=IL(ft&ot-1),Wt=this.nodes,Sr=bt?Wt[Nt]:void 0,zr=yE(Sr,P,F+y,K,re,oe,Ce,De);if(zr===Sr)return this;if(!bt&&zr&&Wt.length>=Cne)return yne(P,Wt,ft,qe,zr);if(bt&&!zr&&Wt.length===2&&wL(Wt[Nt^1]))return Wt[Nt^1];if(bt&&zr&&Wt.length===1&&wL(zr))return zr;var Kn=P&&P===this.ownerID,nu=bt?zr?ft:ft^ot:ft|ot,Yu=bt?zr?ML(Wt,Nt,zr,Kn):xne(Wt,Nt,Kn):bne(Wt,Nt,zr,Kn);return Kn?(this.bitmap=nu,this.nodes=Yu,this):new Iv(P,nu,Yu)};function f0(P,F,K){this.ownerID=P,this.count=F,this.nodes=K}f0.prototype.get=function(P,F,K,re){F===void 0&&(F=Lt(K));var oe=(P===0?F:F>>>P)&S,Ce=this.nodes[oe];return Ce?Ce.get(P+y,F,K,re):re},f0.prototype.update=function(P,F,K,re,oe,Ce,De){K===void 0&&(K=Lt(re));var qe=(F===0?K:K>>>F)&S,ot=oe===x,ft=this.nodes,bt=ft[qe];if(ot&&!bt)return this;var Nt=yE(bt,P,F+y,K,re,oe,Ce,De);if(Nt===bt)return this;var Wt=this.count;if(!bt)Wt++;else if(!Nt&&(Wt--,Wt<_ne))return gne(P,ft,Wt,qe);var Sr=P&&P===this.ownerID,zr=ML(ft,qe,Nt,Sr);return Sr?(this.count=Wt,this.nodes=zr,this):new f0(P,Wt,zr)};function Mv(P,F,K){this.ownerID=P,this.keyHash=F,this.entries=K}Mv.prototype.get=function(P,F,K,re){for(var oe=this.entries,Ce=0,De=oe.length;Ce<De;Ce++)if(Ve(K,oe[Ce][0]))return oe[Ce][1];return re},Mv.prototype.update=function(P,F,K,re,oe,Ce,De){K===void 0&&(K=Lt(re));var qe=oe===x;if(K!==this.keyHash)return qe?this:(I(De),I(Ce),bE(this,P,F,K,[re,oe]));for(var ot=this.entries,ft=0,bt=ot.length;ft<bt&&!Ve(re,ot[ft][0]);ft++);var Nt=ft<bt;if(Nt?ot[ft][1]===oe:qe)return this;if(I(De),(qe||!Nt)&&I(Ce),qe&&bt===2)return new Vl(P,this.keyHash,ot[ft^1]);var Wt=P&&P===this.ownerID,Sr=Wt?ot:k(ot);return Nt?qe?ft===bt-1?Sr.pop():Sr[ft]=Sr.pop():Sr[ft]=[re,oe]:Sr.push([re,oe]),Wt?(this.entries=Sr,this):new Mv(P,this.keyHash,Sr)};function Vl(P,F,K){this.ownerID=P,this.keyHash=F,this.entry=K}Vl.prototype.get=function(P,F,K,re){return Ve(K,this.entry[0])?this.entry[1]:re},Vl.prototype.update=function(P,F,K,re,oe,Ce,De){var qe=oe===x,ot=Ve(re,this.entry[0]);if(ot?oe===this.entry[1]:qe)return this;if(I(De),qe){I(Ce);return}return ot?P&&P===this.ownerID?(this.entry[1]=oe,this):new Vl(P,this.keyHash,[re,oe]):(I(Ce),bE(this,P,F,Lt(re),[re,oe]))},d0.prototype.iterate=Mv.prototype.iterate=function(P,F){for(var K=this.entries,re=0,oe=K.length-1;re<=oe;re++)if(P(K[F?oe-re:re])===!1)return!1},Iv.prototype.iterate=f0.prototype.iterate=function(P,F){for(var K=this.nodes,re=0,oe=K.length-1;re<=oe;re++){var Ce=K[F?oe-re:re];if(Ce&&Ce.iterate(P,F)===!1)return!1}},Vl.prototype.iterate=function(P,F){return P(this.entry)},n(vE,U);function vE(P,F,K){this._type=F,this._reverse=K,this._stack=P._root&&SL(P._root)}vE.prototype.next=function(){for(var P=this._type,F=this._stack;F;){var K=F.node,re=F.index++,oe;if(K.entry){if(re===0)return mE(P,K.entry)}else if(K.entries){if(oe=K.entries.length-1,re<=oe)return mE(P,K.entries[this._reverse?oe-re:re])}else if(oe=K.nodes.length-1,re<=oe){var Ce=K.nodes[this._reverse?oe-re:re];if(Ce){if(Ce.entry)return mE(P,Ce.entry);F=this._stack=SL(Ce,F)}continue}F=this._stack=this._stack.__prev}return ee()};function mE(P,F){return z(P,F[0],F[1])}function SL(P,F){return{node:P,index:0,__prev:F}}function gE(P,F,K,re){var oe=Object.create(Gr);return oe.size=P,oe._root=F,oe.__ownerID=K,oe.__hash=re,oe.__altered=!1,oe}var CL;function ru(){return CL||(CL=gE(0))}function _L(P,F,K){var re,oe;if(P._root){var Ce=A(C),De=A(w);if(re=yE(P._root,P.__ownerID,0,void 0,F,K,Ce,De),!De.value)return P;oe=P.size+(Ce.value?K===x?-1:1:0)}else{if(K===x)return P;oe=1,re=new d0(P.__ownerID,[[F,K]])}return P.__ownerID?(P.size=oe,P._root=re,P.__hash=void 0,P.__altered=!0,P):re?gE(oe,re):ru()}function yE(P,F,K,re,oe,Ce,De,qe){return P?P.update(F,K,re,oe,Ce,De,qe):Ce===x?P:(I(qe),I(De),new Vl(F,re,[oe,Ce]))}function wL(P){return P.constructor===Vl||P.constructor===Mv}function bE(P,F,K,re,oe){if(P.keyHash===re)return new Mv(F,re,[P.entry,oe]);var Ce=(K===0?P.keyHash:P.keyHash>>>K)&S,De=(K===0?re:re>>>K)&S,qe,ot=Ce===De?[bE(P,F,K+y,re,oe)]:(qe=new Vl(F,re,oe),Ce<De?[P,qe]:[qe,P]);return new Iv(F,1<<Ce|1<<De,ot)}function mne(P,F,K,re){P||(P=new D);for(var oe=new Vl(P,Lt(K),[K,re]),Ce=0;Ce<F.length;Ce++){var De=F[Ce];oe=oe.update(P,0,void 0,De[0],De[1])}return oe}function gne(P,F,K,re){for(var oe=0,Ce=0,De=new Array(K),qe=0,ot=1,ft=F.length;qe<ft;qe++,ot<<=1){var bt=F[qe];bt!==void 0&&qe!==re&&(oe|=ot,De[Ce++]=bt)}return new Iv(P,oe,De)}function yne(P,F,K,re,oe){for(var Ce=0,De=new Array(b),qe=0;K!==0;qe++,K>>>=1)De[qe]=K&1?F[Ce++]:void 0;return De[re]=oe,new f0(P,Ce+1,De)}function Zb(P,F,K){for(var re=[],oe=0;oe<K.length;oe++){var Ce=K[oe],De=i(Ce);u(Ce)||(De=De.map(function(qe){return Te(qe)})),re.push(De)}return PL(P,F,re)}function EL(P,F,K){return P&&P.mergeDeep&&u(F)?P.mergeDeep(F):Ve(P,F)?P:F}function AL(P){return function(F,K,re){if(F&&F.mergeDeepWith&&u(K))return F.mergeDeepWith(P,K);var oe=P(F,K,re);return Ve(F,oe)?F:oe}}function PL(P,F,K){return K=K.filter(function(re){return re.size!==0}),K.length===0?P:P.size===0&&!P.__ownerID&&K.length===1?P.constructor(K[0]):P.withMutations(function(re){for(var oe=F?function(De,qe){re.update(qe,x,function(ot){return ot===x?De:F(ot,De,qe)})}:function(De,qe){re.set(qe,De)},Ce=0;Ce<K.length;Ce++)K[Ce].forEach(oe)})}function TL(P,F,K,re){var oe=P===x,Ce=F.next();if(Ce.done){var De=oe?K:P,qe=re(De);return qe===De?P:qe}se(oe||P&&P.set,"invalid keyPath");var ot=Ce.value,ft=oe?x:P.get(ot,x),bt=TL(ft,F,K,re);return bt===ft?P:bt===x?P.remove(ot):(oe?ru():P).set(ot,bt)}function IL(P){return P=P-(P>>1&1431655765),P=(P&858993459)+(P>>2&858993459),P=P+(P>>4)&252645135,P=P+(P>>8),P=P+(P>>16),P&127}function ML(P,F,K,re){var oe=re?P:k(P);return oe[F]=K,oe}function bne(P,F,K,re){var oe=P.length+1;if(re&&F+1===oe)return P[F]=K,P;for(var Ce=new Array(oe),De=0,qe=0;qe<oe;qe++)qe===F?(Ce[qe]=K,De=-1):Ce[qe]=P[qe+De];return Ce}function xne(P,F,K){var re=P.length-1;if(K&&F===re)return P.pop(),P;for(var oe=new Array(re),Ce=0,De=0;De<re;De++)De===F&&(Ce=1),oe[De]=P[De+Ce];return oe}var Sne=b/4,Cne=b/2,_ne=b/4;n(jn,St);function jn(P){var F=xE();if(P==null)return F;if(DL(P))return P;var K=o(P),re=K.size;return re===0?F:(Hi(re),re>0&&re<b?p0(0,re,y,null,new Td(K.toArray())):F.withMutations(function(oe){oe.setSize(re),K.forEach(function(Ce,De){return oe.set(De,Ce)})}))}jn.of=function(){return this(arguments)},jn.prototype.toString=function(){return this.__toString("List [","]")},jn.prototype.get=function(P,F){if(P=L(this,P),P>=0&&P<this.size){P+=this._origin;var K=LL(this,P);return K&&K.array[P&S]}return F},jn.prototype.set=function(P,F){return wne(this,P,F)},jn.prototype.remove=function(P){return this.has(P)?P===0?this.shift():P===this.size-1?this.pop():this.splice(P,1):this},jn.prototype.insert=function(P,F){return this.splice(P,0,F)},jn.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=y,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):xE()},jn.prototype.push=function(){var P=arguments,F=this.size;return this.withMutations(function(K){Id(K,0,F+P.length);for(var re=0;re<P.length;re++)K.set(F+re,P[re])})},jn.prototype.pop=function(){return Id(this,0,-1)},jn.prototype.unshift=function(){var P=arguments;return this.withMutations(function(F){Id(F,-P.length);for(var K=0;K<P.length;K++)F.set(K,P[K])})},jn.prototype.shift=function(){return Id(this,1)},jn.prototype.merge=function(){return Jb(this,void 0,arguments)},jn.prototype.mergeWith=function(P){var F=r.call(arguments,1);return Jb(this,P,F)},jn.prototype.mergeDeep=function(){return Jb(this,EL,arguments)},jn.prototype.mergeDeepWith=function(P){var F=r.call(arguments,1);return Jb(this,AL(P),F)},jn.prototype.setSize=function(P){return Id(this,0,P)},jn.prototype.slice=function(P,F){var K=this.size;return B(P,F,K)?this:Id(this,j(P,K),Q(F,K))},jn.prototype.__iterator=function(P,F){var K=0,re=kL(this,F);return new U(function(){var oe=re();return oe===h0?ee():z(P,K++,oe)})},jn.prototype.__iterate=function(P,F){for(var K=0,re=kL(this,F),oe;(oe=re())!==h0&&P(oe,K++,this)!==!1;);return K},jn.prototype.__ensureOwner=function(P){return P===this.__ownerID?this:P?p0(this._origin,this._capacity,this._level,this._root,this._tail,P,this.__hash):(this.__ownerID=P,this)};function DL(P){return!!(P&&P[RL])}jn.isList=DL;var RL="@@__IMMUTABLE_LIST__@@",Gi=jn.prototype;Gi[RL]=!0,Gi[m]=Gi.remove,Gi.setIn=Gr.setIn,Gi.deleteIn=Gi.removeIn=Gr.removeIn,Gi.update=Gr.update,Gi.updateIn=Gr.updateIn,Gi.mergeIn=Gr.mergeIn,Gi.mergeDeepIn=Gr.mergeDeepIn,Gi.withMutations=Gr.withMutations,Gi.asMutable=Gr.asMutable,Gi.asImmutable=Gr.asImmutable,Gi.wasAltered=Gr.wasAltered;function Td(P,F){this.array=P,this.ownerID=F}Td.prototype.removeBefore=function(P,F,K){if(K===F?1<<F:this.array.length===0)return this;var re=K>>>F&S;if(re>=this.array.length)return new Td([],P);var oe=re===0,Ce;if(F>0){var De=this.array[re];if(Ce=De&&De.removeBefore(P,F-y,K),Ce===De&&oe)return this}if(oe&&!Ce)return this;var qe=Dv(this,P);if(!oe)for(var ot=0;ot<re;ot++)qe.array[ot]=void 0;return Ce&&(qe.array[re]=Ce),qe},Td.prototype.removeAfter=function(P,F,K){if(K===(F?1<<F:0)||this.array.length===0)return this;var re=K-1>>>F&S;if(re>=this.array.length)return this;var oe;if(F>0){var Ce=this.array[re];if(oe=Ce&&Ce.removeAfter(P,F-y,K),oe===Ce&&re===this.array.length-1)return this}var De=Dv(this,P);return De.array.splice(re+1),oe&&(De.array[re]=oe),De};var h0={};function kL(P,F){var K=P._origin,re=P._capacity,oe=v0(re),Ce=P._tail;return De(P._root,P._level,0);function De(ft,bt,Nt){return bt===0?qe(ft,Nt):ot(ft,bt,Nt)}function qe(ft,bt){var Nt=bt===oe?Ce&&Ce.array:ft&&ft.array,Wt=bt>K?0:K-bt,Sr=re-bt;return Sr>b&&(Sr=b),function(){if(Wt===Sr)return h0;var zr=F?--Sr:Wt++;return Nt&&Nt[zr]}}function ot(ft,bt,Nt){var Wt,Sr=ft&&ft.array,zr=Nt>K?0:K-Nt>>bt,Kn=(re-Nt>>bt)+1;return Kn>b&&(Kn=b),function(){do{if(Wt){var nu=Wt();if(nu!==h0)return nu;Wt=null}if(zr===Kn)return h0;var Yu=F?--Kn:zr++;Wt=De(Sr&&Sr[Yu],bt-y,Nt+(Yu<<bt))}while(!0)}}}function p0(P,F,K,re,oe,Ce,De){var qe=Object.create(Gi);return qe.size=F-P,qe._origin=P,qe._capacity=F,qe._level=K,qe._root=re,qe._tail=oe,qe.__ownerID=Ce,qe.__hash=De,qe.__altered=!1,qe}var OL;function xE(){return OL||(OL=p0(0,0,y))}function wne(P,F,K){if(F=L(P,F),F!==F)return P;if(F>=P.size||F<0)return P.withMutations(function(De){F<0?Id(De,F).set(0,K):Id(De,0,F+1).set(F,K)});F+=P._origin;var re=P._tail,oe=P._root,Ce=A(w);return F>=v0(P._capacity)?re=SE(re,P.__ownerID,0,F,K,Ce):oe=SE(oe,P.__ownerID,P._level,F,K,Ce),Ce.value?P.__ownerID?(P._root=oe,P._tail=re,P.__hash=void 0,P.__altered=!0,P):p0(P._origin,P._capacity,P._level,oe,re):P}function SE(P,F,K,re,oe,Ce){var De=re>>>K&S,qe=P&&De<P.array.length;if(!qe&&oe===void 0)return P;var ot;if(K>0){var ft=P&&P.array[De],bt=SE(ft,F,K-y,re,oe,Ce);return bt===ft?P:(ot=Dv(P,F),ot.array[De]=bt,ot)}return qe&&P.array[De]===oe?P:(I(Ce),ot=Dv(P,F),oe===void 0&&De===ot.array.length-1?ot.array.pop():ot.array[De]=oe,ot)}function Dv(P,F){return F&&P&&F===P.ownerID?P:new Td(P?P.array.slice():[],F)}function LL(P,F){if(F>=v0(P._capacity))return P._tail;if(F<1<<P._level+y){for(var K=P._root,re=P._level;K&&re>0;)K=K.array[F>>>re&S],re-=y;return K}}function Id(P,F,K){F!==void 0&&(F=F|0),K!==void 0&&(K=K|0);var re=P.__ownerID||new D,oe=P._origin,Ce=P._capacity,De=oe+F,qe=K===void 0?Ce:K<0?Ce+K:oe+K;if(De===oe&&qe===Ce)return P;if(De>=qe)return P.clear();for(var ot=P._level,ft=P._root,bt=0;De+bt<0;)ft=new Td(ft&&ft.array.length?[void 0,ft]:[],re),ot+=y,bt+=1<<ot;bt&&(De+=bt,oe+=bt,qe+=bt,Ce+=bt);for(var Nt=v0(Ce),Wt=v0(qe);Wt>=1<<ot+y;)ft=new Td(ft&&ft.array.length?[ft]:[],re),ot+=y;var Sr=P._tail,zr=Wt<Nt?LL(P,qe-1):Wt>Nt?new Td([],re):Sr;if(Sr&&Wt>Nt&&De<Ce&&Sr.array.length){ft=Dv(ft,re);for(var Kn=ft,nu=ot;nu>y;nu-=y){var Yu=Nt>>>nu&S;Kn=Kn.array[Yu]=Dv(Kn.array[Yu],re)}Kn.array[Nt>>>y&S]=Sr}if(qe<Ce&&(zr=zr&&zr.removeAfter(re,0,qe)),De>=Wt)De-=Wt,qe-=Wt,ot=y,ft=null,zr=zr&&zr.removeBefore(re,0,De);else if(De>oe||Wt<Nt){for(bt=0;ft;){var o2=De>>>ot&S;if(o2!==Wt>>>ot&S)break;o2&&(bt+=(1<<ot)*o2),ot-=y,ft=ft.array[o2]}ft&&De>oe&&(ft=ft.removeBefore(re,ot,De-bt)),ft&&Wt<Nt&&(ft=ft.removeAfter(re,ot,Wt-bt)),bt&&(De-=bt,qe-=bt)}return P.__ownerID?(P.size=qe-De,P._origin=De,P._capacity=qe,P._level=ot,P._root=ft,P._tail=zr,P.__hash=void 0,P.__altered=!0,P):p0(De,qe,ot,ft,zr)}function Jb(P,F,K){for(var re=[],oe=0,Ce=0;Ce<K.length;Ce++){var De=K[Ce],qe=o(De);qe.size>oe&&(oe=qe.size),u(De)||(qe=qe.map(function(ot){return Te(ot)})),re.push(qe)}return oe>P.size&&(P=P.setSize(oe)),PL(P,F,re)}function v0(P){return P<b?0:P-1>>>y<<y}n(Sa,Qr);function Sa(P){return P==null?e2():NL(P)?P:e2().withMutations(function(F){var K=i(P);Hi(K.size),K.forEach(function(re,oe){return F.set(oe,re)})})}Sa.of=function(){return this(arguments)},Sa.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Sa.prototype.get=function(P,F){var K=this._map.get(P);return K!==void 0?this._list.get(K)[1]:F},Sa.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):e2()},Sa.prototype.set=function(P,F){return BL(this,P,F)},Sa.prototype.remove=function(P){return BL(this,P,x)},Sa.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Sa.prototype.__iterate=function(P,F){var K=this;return this._list.__iterate(function(re){return re&&P(re[1],re[0],K)},F)},Sa.prototype.__iterator=function(P,F){return this._list.fromEntrySeq().__iterator(P,F)},Sa.prototype.__ensureOwner=function(P){if(P===this.__ownerID)return this;var F=this._map.__ensureOwner(P),K=this._list.__ensureOwner(P);return P?CE(F,K,P,this.__hash):(this.__ownerID=P,this._map=F,this._list=K,this)};function NL(P){return pE(P)&&f(P)}Sa.isOrderedMap=NL,Sa.prototype[g]=!0,Sa.prototype[m]=Sa.prototype.remove;function CE(P,F,K,re){var oe=Object.create(Sa.prototype);return oe.size=P?P.size:0,oe._map=P,oe._list=F,oe.__ownerID=K,oe.__hash=re,oe}var FL;function e2(){return FL||(FL=CE(ru(),xE()))}function BL(P,F,K){var re=P._map,oe=P._list,Ce=re.get(F),De=Ce!==void 0,qe,ot;if(K===x){if(!De)return P;oe.size>=b&&oe.size>=re.size*2?(ot=oe.filter(function(ft,bt){return ft!==void 0&&Ce!==bt}),qe=ot.toKeyedSeq().map(function(ft){return ft[0]}).flip().toMap(),P.__ownerID&&(qe.__ownerID=ot.__ownerID=P.__ownerID)):(qe=re.remove(F),ot=Ce===oe.size-1?oe.pop():oe.set(Ce,void 0))}else if(De){if(K===oe.get(Ce)[1])return P;qe=re,ot=oe.set(Ce,[F,K])}else qe=re.set(F,oe.size),ot=oe.set(oe.size,[F,K]);return P.__ownerID?(P.size=qe.size,P._map=qe,P._list=ot,P.__hash=void 0,P):CE(qe,ot)}n(hs,Ie);function hs(P,F){this._iter=P,this._useKeys=F,this.size=P.size}hs.prototype.get=function(P,F){return this._iter.get(P,F)},hs.prototype.has=function(P){return this._iter.has(P)},hs.prototype.valueSeq=function(){return this._iter.valueSeq()},hs.prototype.reverse=function(){var P=this,F=_E(this,!0);return this._useKeys||(F.valueSeq=function(){return P._iter.toSeq().reverse()}),F},hs.prototype.map=function(P,F){var K=this,re=jL(this,P,F);return this._useKeys||(re.valueSeq=function(){return K._iter.toSeq().map(P,F)}),re},hs.prototype.__iterate=function(P,F){var K=this,re;return this._iter.__iterate(this._useKeys?function(oe,Ce){return P(oe,Ce,K)}:(re=F?WL(this):0,function(oe){return P(oe,F?--re:re++,K)}),F)},hs.prototype.__iterator=function(P,F){if(this._useKeys)return this._iter.__iterator(P,F);var K=this._iter.__iterator(q,F),re=F?WL(this):0;return new U(function(){var oe=K.next();return oe.done?oe:z(P,F?--re:re++,oe.value,oe)})},hs.prototype[g]=!0,n(Rv,_e);function Rv(P){this._iter=P,this.size=P.size}Rv.prototype.includes=function(P){return this._iter.includes(P)},Rv.prototype.__iterate=function(P,F){var K=this,re=0;return this._iter.__iterate(function(oe){return P(oe,re++,K)},F)},Rv.prototype.__iterator=function(P,F){var K=this._iter.__iterator(q,F),re=0;return new U(function(){var oe=K.next();return oe.done?oe:z(P,re++,oe.value,oe)})},n(kv,ae);function kv(P){this._iter=P,this.size=P.size}kv.prototype.has=function(P){return this._iter.includes(P)},kv.prototype.__iterate=function(P,F){var K=this;return this._iter.__iterate(function(re){return P(re,re,K)},F)},kv.prototype.__iterator=function(P,F){var K=this._iter.__iterator(q,F);return new U(function(){var re=K.next();return re.done?re:z(P,re.value,re.value,re)})},n(Ov,Ie);function Ov(P){this._iter=P,this.size=P.size}Ov.prototype.entrySeq=function(){return this._iter.toSeq()},Ov.prototype.__iterate=function(P,F){var K=this;return this._iter.__iterate(function(re){if(re){qL(re);var oe=u(re);return P(oe?re.get(1):re[1],oe?re.get(0):re[0],K)}},F)},Ov.prototype.__iterator=function(P,F){var K=this._iter.__iterator(q,F);return new U(function(){for(;;){var re=K.next();if(re.done)return re;var oe=re.value;if(oe){qL(oe);var Ce=u(oe);return z(P,Ce?oe.get(0):oe[0],Ce?oe.get(1):oe[1],re)}}})},Rv.prototype.cacheResult=hs.prototype.cacheResult=kv.prototype.cacheResult=Ov.prototype.cacheResult=AE;function UL(P){var F=Wu(P);return F._iter=P,F.size=P.size,F.flip=function(){return P},F.reverse=function(){var K=P.reverse.apply(this);return K.flip=function(){return P.reverse()},K},F.has=function(K){return P.includes(K)},F.includes=function(K){return P.has(K)},F.cacheResult=AE,F.__iterateUncached=function(K,re){var oe=this;return P.__iterate(function(Ce,De){return K(De,Ce,oe)!==!1},re)},F.__iteratorUncached=function(K,re){if(K===J){var oe=P.__iterator(K,re);return new U(function(){var Ce=oe.next();if(!Ce.done){var De=Ce.value[0];Ce.value[0]=Ce.value[1],Ce.value[1]=De}return Ce})}return P.__iterator(K===q?W:q,re)},F}function jL(P,F,K){var re=Wu(P);return re.size=P.size,re.has=function(oe){return P.has(oe)},re.get=function(oe,Ce){var De=P.get(oe,x);return De===x?Ce:F.call(K,De,oe,P)},re.__iterateUncached=function(oe,Ce){var De=this;return P.__iterate(function(qe,ot,ft){return oe(F.call(K,qe,ot,ft),ot,De)!==!1},Ce)},re.__iteratorUncached=function(oe,Ce){var De=P.__iterator(J,Ce);return new U(function(){var qe=De.next();if(qe.done)return qe;var ot=qe.value,ft=ot[0];return z(oe,ft,F.call(K,ot[1],ft,P),qe)})},re}function _E(P,F){var K=Wu(P);return K._iter=P,K.size=P.size,K.reverse=function(){return P},P.flip&&(K.flip=function(){var re=UL(P);return re.reverse=function(){return P.flip()},re}),K.get=function(re,oe){return P.get(F?re:-1-re,oe)},K.has=function(re){return P.has(F?re:-1-re)},K.includes=function(re){return P.includes(re)},K.cacheResult=AE,K.__iterate=function(re,oe){var Ce=this;return P.__iterate(function(De,qe){return re(De,qe,Ce)},!oe)},K.__iterator=function(re,oe){return P.__iterator(re,!oe)},K}function zL(P,F,K,re){var oe=Wu(P);return re&&(oe.has=function(Ce){var De=P.get(Ce,x);return De!==x&&!!F.call(K,De,Ce,P)},oe.get=function(Ce,De){var qe=P.get(Ce,x);return qe!==x&&F.call(K,qe,Ce,P)?qe:De}),oe.__iterateUncached=function(Ce,De){var qe=this,ot=0;return P.__iterate(function(ft,bt,Nt){if(F.call(K,ft,bt,Nt))return ot++,Ce(ft,re?bt:ot-1,qe)},De),ot},oe.__iteratorUncached=function(Ce,De){var qe=P.__iterator(J,De),ot=0;return new U(function(){for(;;){var ft=qe.next();if(ft.done)return ft;var bt=ft.value,Nt=bt[0],Wt=bt[1];if(F.call(K,Wt,Nt,P))return z(Ce,re?Nt:ot++,Wt,ft)}})},oe}function Ene(P,F,K){var re=Qr().asMutable();return P.__iterate(function(oe,Ce){re.update(F.call(K,oe,Ce,P),0,function(De){return De+1})}),re.asImmutable()}function Ane(P,F,K){var re=l(P),oe=(f(P)?Sa():Qr()).asMutable();P.__iterate(function(De,qe){oe.update(F.call(K,De,qe,P),function(ot){return ot=ot||[],ot.push(re?[qe,De]:De),ot})});var Ce=$L(P);return oe.map(function(De){return Dn(P,Ce(De))})}function wE(P,F,K,re){var oe=P.size;if(F!==void 0&&(F=F|0),K!==void 0&&(K===1/0?K=oe:K=K|0),B(F,K,oe))return P;var Ce=j(F,oe),De=Q(K,oe);if(Ce!==Ce||De!==De)return wE(P.toSeq().cacheResult(),F,K,re);var qe=De-Ce,ot;qe===qe&&(ot=qe<0?0:qe);var ft=Wu(P);return ft.size=ot===0?ot:P.size&&ot||void 0,!re&&Me(P)&&ot>=0&&(ft.get=function(bt,Nt){return bt=L(this,bt),bt>=0&&bt<ot?P.get(bt+Ce,Nt):Nt}),ft.__iterateUncached=function(bt,Nt){var Wt=this;if(ot===0)return 0;if(Nt)return this.cacheResult().__iterate(bt,Nt);var Sr=0,zr=!0,Kn=0;return P.__iterate(function(nu,Yu){if(!(zr&&(zr=Sr++<Ce)))return Kn++,bt(nu,re?Yu:Kn-1,Wt)!==!1&&Kn!==ot}),Kn},ft.__iteratorUncached=function(bt,Nt){if(ot!==0&&Nt)return this.cacheResult().__iterator(bt,Nt);var Wt=ot!==0&&P.__iterator(bt,Nt),Sr=0,zr=0;return new U(function(){for(;Sr++<Ce;)Wt.next();if(++zr>ot)return ee();var Kn=Wt.next();return re||bt===q?Kn:bt===W?z(bt,zr-1,void 0,Kn):z(bt,zr-1,Kn.value[1],Kn)})},ft}function Pne(P,F,K){var re=Wu(P);return re.__iterateUncached=function(oe,Ce){var De=this;if(Ce)return this.cacheResult().__iterate(oe,Ce);var qe=0;return P.__iterate(function(ot,ft,bt){return F.call(K,ot,ft,bt)&&++qe&&oe(ot,ft,De)}),qe},re.__iteratorUncached=function(oe,Ce){var De=this;if(Ce)return this.cacheResult().__iterator(oe,Ce);var qe=P.__iterator(J,Ce),ot=!0;return new U(function(){if(!ot)return ee();var ft=qe.next();if(ft.done)return ft;var bt=ft.value,Nt=bt[0],Wt=bt[1];return F.call(K,Wt,Nt,De)?oe===J?ft:z(oe,Nt,Wt,ft):(ot=!1,ee())})},re}function VL(P,F,K,re){var oe=Wu(P);return oe.__iterateUncached=function(Ce,De){var qe=this;if(De)return this.cacheResult().__iterate(Ce,De);var ot=!0,ft=0;return P.__iterate(function(bt,Nt,Wt){if(!(ot&&(ot=F.call(K,bt,Nt,Wt))))return ft++,Ce(bt,re?Nt:ft-1,qe)}),ft},oe.__iteratorUncached=function(Ce,De){var qe=this;if(De)return this.cacheResult().__iterator(Ce,De);var ot=P.__iterator(J,De),ft=!0,bt=0;return new U(function(){var Nt,Wt,Sr;do{if(Nt=ot.next(),Nt.done)return re||Ce===q?Nt:Ce===W?z(Ce,bt++,void 0,Nt):z(Ce,bt++,Nt.value[1],Nt);var zr=Nt.value;Wt=zr[0],Sr=zr[1],ft&&(ft=F.call(K,Sr,Wt,qe))}while(ft);return Ce===J?Nt:z(Ce,Wt,Sr,Nt)})},oe}function Tne(P,F){var K=l(P),re=[P].concat(F).map(function(De){return u(De)?K&&(De=i(De)):De=K?Ze(De):ht(Array.isArray(De)?De:[De]),De}).filter(function(De){return De.size!==0});if(re.length===0)return P;if(re.length===1){var oe=re[0];if(oe===P||K&&l(oe)||c(P)&&c(oe))return oe}var Ce=new O(re);return K?Ce=Ce.toKeyedSeq():c(P)||(Ce=Ce.toSetSeq()),Ce=Ce.flatten(!0),Ce.size=re.reduce(function(De,qe){if(De!==void 0){var ot=qe.size;if(ot!==void 0)return De+ot}},0),Ce}function HL(P,F,K){var re=Wu(P);return re.__iterateUncached=function(oe,Ce){var De=0,qe=!1;function ot(ft,bt){var Nt=this;ft.__iterate(function(Wt,Sr){return(!F||bt<F)&&u(Wt)?ot(Wt,bt+1):oe(Wt,K?Sr:De++,Nt)===!1&&(qe=!0),!qe},Ce)}return ot(P,0),De},re.__iteratorUncached=function(oe,Ce){var De=P.__iterator(oe,Ce),qe=[],ot=0;return new U(function(){for(;De;){var ft=De.next();if(ft.done!==!1){De=qe.pop();continue}var bt=ft.value;if(oe===J&&(bt=bt[1]),(!F||qe.length<F)&&u(bt))qe.push(De),De=bt.__iterator(oe,Ce);else return K?ft:z(oe,ot++,bt,ft)}return ee()})},re}function Ine(P,F,K){var re=$L(P);return P.toSeq().map(function(oe,Ce){return re(F.call(K,oe,Ce,P))}).flatten(!0)}function Mne(P,F){var K=Wu(P);return K.size=P.size&&P.size*2-1,K.__iterateUncached=function(re,oe){var Ce=this,De=0;return P.__iterate(function(qe,ot){return(!De||re(F,De++,Ce)!==!1)&&re(qe,De++,Ce)!==!1},oe),De},K.__iteratorUncached=function(re,oe){var Ce=P.__iterator(q,oe),De=0,qe;return new U(function(){return(!qe||De%2)&&(qe=Ce.next(),qe.done)?qe:De%2?z(re,De++,F):z(re,De++,qe.value,qe)})},K}function Lv(P,F,K){F||(F=XL);var re=l(P),oe=0,Ce=P.toSeq().map(function(De,qe){return[qe,De,oe++,K?K(De,qe,P):De]}).toArray();return Ce.sort(function(De,qe){return F(De[3],qe[3])||De[2]-qe[2]}).forEach(re?function(De,qe){Ce[qe].length=2}:function(De,qe){Ce[qe]=De[1]}),re?Ie(Ce):c(P)?_e(Ce):ae(Ce)}function t2(P,F,K){if(F||(F=XL),K){var re=P.toSeq().map(function(oe,Ce){return[oe,K(oe,Ce,P)]}).reduce(function(oe,Ce){return GL(F,oe[1],Ce[1])?Ce:oe});return re&&re[0]}else return P.reduce(function(oe,Ce){return GL(F,oe,Ce)?Ce:oe})}function GL(P,F,K){var re=P(K,F);return re===0&&K!==F&&(K==null||K!==K)||re>0}function EE(P,F,K){var re=Wu(P);return re.size=new O(K).map(function(oe){return oe.size}).min(),re.__iterate=function(oe,Ce){for(var De=this.__iterator(q,Ce),qe,ot=0;!(qe=De.next()).done&&oe(qe.value,ot++,this)!==!1;);return ot},re.__iteratorUncached=function(oe,Ce){var De=K.map(function(ft){return ft=a(ft),te(Ce?ft.reverse():ft)}),qe=0,ot=!1;return new U(function(){var ft;return ot||(ft=De.map(function(bt){return bt.next()}),ot=ft.some(function(bt){return bt.done})),ot?ee():z(oe,qe++,F.apply(null,ft.map(function(bt){return bt.value})))})},re}function Dn(P,F){return Me(P)?F:P.constructor(F)}function qL(P){if(P!==Object(P))throw new TypeError("Expected [K, V] tuple: "+P)}function WL(P){return Hi(P.size),R(P)}function $L(P){return l(P)?i:c(P)?o:s}function Wu(P){return Object.create((l(P)?Ie:c(P)?_e:ae).prototype)}function AE(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):xe.prototype.cacheResult.call(this)}function XL(P,F){return P>F?1:P<F?-1:0}function YL(P){var F=te(P);if(!F){if(!be(P))throw new TypeError("Expected iterable or array-like: "+P);F=te(a(P))}return F}n(ko,ct);function ko(P,F){var K,re=function(De){if(De instanceof re)return De;if(!(this instanceof re))return new re(De);if(!K){K=!0;var qe=Object.keys(P);Dne(oe,qe),oe.size=qe.length,oe._name=F,oe._keys=qe,oe._defaultValues=P}this._map=Qr(De)},oe=re.prototype=Object.create(li);return oe.constructor=re,re}ko.prototype.toString=function(){return this.__toString(KL(this)+" {","}")},ko.prototype.has=function(P){return this._defaultValues.hasOwnProperty(P)},ko.prototype.get=function(P,F){if(!this.has(P))return F;var K=this._defaultValues[P];return this._map?this._map.get(P,K):K},ko.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var P=this.constructor;return P._empty||(P._empty=r2(this,ru()))},ko.prototype.set=function(P,F){if(!this.has(P))throw new Error('Cannot set unknown key "'+P+'" on '+KL(this));if(this._map&&!this._map.has(P)){var K=this._defaultValues[P];if(F===K)return this}var re=this._map&&this._map.set(P,F);return this.__ownerID||re===this._map?this:r2(this,re)},ko.prototype.remove=function(P){if(!this.has(P))return this;var F=this._map&&this._map.remove(P);return this.__ownerID||F===this._map?this:r2(this,F)},ko.prototype.wasAltered=function(){return this._map.wasAltered()},ko.prototype.__iterator=function(P,F){var K=this;return i(this._defaultValues).map(function(re,oe){return K.get(oe)}).__iterator(P,F)},ko.prototype.__iterate=function(P,F){var K=this;return i(this._defaultValues).map(function(re,oe){return K.get(oe)}).__iterate(P,F)},ko.prototype.__ensureOwner=function(P){if(P===this.__ownerID)return this;var F=this._map&&this._map.__ensureOwner(P);return P?r2(this,F,P):(this.__ownerID=P,this._map=F,this)};var li=ko.prototype;li[m]=li.remove,li.deleteIn=li.removeIn=Gr.removeIn,li.merge=Gr.merge,li.mergeWith=Gr.mergeWith,li.mergeIn=Gr.mergeIn,li.mergeDeep=Gr.mergeDeep,li.mergeDeepWith=Gr.mergeDeepWith,li.mergeDeepIn=Gr.mergeDeepIn,li.setIn=Gr.setIn,li.update=Gr.update,li.updateIn=Gr.updateIn,li.withMutations=Gr.withMutations,li.asMutable=Gr.asMutable,li.asImmutable=Gr.asImmutable;function r2(P,F,K){var re=Object.create(Object.getPrototypeOf(P));return re._map=F,re.__ownerID=K,re}function KL(P){return P._name||P.constructor.name||"Record"}function Dne(P,F){try{F.forEach(Rne.bind(void 0,P))}catch{}}function Rne(P,F){Object.defineProperty(P,F,{get:function(){return this.get(F)},set:function(K){se(this.__ownerID,"Cannot set on an immutable record."),this.set(F,K)}})}n(Yn,Bt);function Yn(P){return P==null?IE():PE(P)&&!f(P)?P:IE().withMutations(function(F){var K=s(P);Hi(K.size),K.forEach(function(re){return F.add(re)})})}Yn.of=function(){return this(arguments)},Yn.fromKeys=function(P){return this(i(P).keySeq())},Yn.prototype.toString=function(){return this.__toString("Set {","}")},Yn.prototype.has=function(P){return this._map.has(P)},Yn.prototype.add=function(P){return TE(this,this._map.set(P,!0))},Yn.prototype.remove=function(P){return TE(this,this._map.remove(P))},Yn.prototype.clear=function(){return TE(this,this._map.clear())},Yn.prototype.union=function(){var P=r.call(arguments,0);return P=P.filter(function(F){return F.size!==0}),P.length===0?this:this.size===0&&!this.__ownerID&&P.length===1?this.constructor(P[0]):this.withMutations(function(F){for(var K=0;K<P.length;K++)s(P[K]).forEach(function(re){return F.add(re)})})},Yn.prototype.intersect=function(){var P=r.call(arguments,0);if(P.length===0)return this;P=P.map(function(K){return s(K)});var F=this;return this.withMutations(function(K){F.forEach(function(re){P.every(function(oe){return oe.includes(re)})||K.remove(re)})})},Yn.prototype.subtract=function(){var P=r.call(arguments,0);if(P.length===0)return this;P=P.map(function(K){return s(K)});var F=this;return this.withMutations(function(K){F.forEach(function(re){P.some(function(oe){return oe.includes(re)})&&K.remove(re)})})},Yn.prototype.merge=function(){return this.union.apply(this,arguments)},Yn.prototype.mergeWith=function(P){var F=r.call(arguments,1);return this.union.apply(this,F)},Yn.prototype.sort=function(P){return $u(Lv(this,P))},Yn.prototype.sortBy=function(P,F){return $u(Lv(this,F,P))},Yn.prototype.wasAltered=function(){return this._map.wasAltered()},Yn.prototype.__iterate=function(P,F){var K=this;return this._map.__iterate(function(re,oe){return P(oe,oe,K)},F)},Yn.prototype.__iterator=function(P,F){return this._map.map(function(K,re){return re}).__iterator(P,F)},Yn.prototype.__ensureOwner=function(P){if(P===this.__ownerID)return this;var F=this._map.__ensureOwner(P);return P?this.__make(F,P):(this.__ownerID=P,this._map=F,this)};function PE(P){return!!(P&&P[QL])}Yn.isSet=PE;var QL="@@__IMMUTABLE_SET__@@",Oo=Yn.prototype;Oo[QL]=!0,Oo[m]=Oo.remove,Oo.mergeDeep=Oo.merge,Oo.mergeDeepWith=Oo.mergeWith,Oo.withMutations=Gr.withMutations,Oo.asMutable=Gr.asMutable,Oo.asImmutable=Gr.asImmutable,Oo.__empty=IE,Oo.__make=ZL;function TE(P,F){return P.__ownerID?(P.size=F.size,P._map=F,P):F===P._map?P:F.size===0?P.__empty():P.__make(F)}function ZL(P,F){var K=Object.create(Oo);return K.size=P?P.size:0,K._map=P,K.__ownerID=F,K}var JL;function IE(){return JL||(JL=ZL(ru()))}n($u,Yn);function $u(P){return P==null?ME():eN(P)?P:ME().withMutations(function(F){var K=s(P);Hi(K.size),K.forEach(function(re){return F.add(re)})})}$u.of=function(){return this(arguments)},$u.fromKeys=function(P){return this(i(P).keySeq())},$u.prototype.toString=function(){return this.__toString("OrderedSet {","}")};function eN(P){return PE(P)&&f(P)}$u.isOrderedSet=eN;var n2=$u.prototype;n2[g]=!0,n2.__empty=ME,n2.__make=tN;function tN(P,F){var K=Object.create(n2);return K.size=P?P.size:0,K._map=P,K.__ownerID=F,K}var rN;function ME(){return rN||(rN=tN(e2()))}n(wa,St);function wa(P){return P==null?DE():nN(P)?P:DE().unshiftAll(P)}wa.of=function(){return this(arguments)},wa.prototype.toString=function(){return this.__toString("Stack [","]")},wa.prototype.get=function(P,F){var K=this._head;for(P=L(this,P);K&&P--;)K=K.next;return K?K.value:F},wa.prototype.peek=function(){return this._head&&this._head.value},wa.prototype.push=function(){if(arguments.length===0)return this;for(var P=this.size+arguments.length,F=this._head,K=arguments.length-1;K>=0;K--)F={value:arguments[K],next:F};return this.__ownerID?(this.size=P,this._head=F,this.__hash=void 0,this.__altered=!0,this):m0(P,F)},wa.prototype.pushAll=function(P){if(P=o(P),P.size===0)return this;Hi(P.size);var F=this.size,K=this._head;return P.reverse().forEach(function(re){F++,K={value:re,next:K}}),this.__ownerID?(this.size=F,this._head=K,this.__hash=void 0,this.__altered=!0,this):m0(F,K)},wa.prototype.pop=function(){return this.slice(1)},wa.prototype.unshift=function(){return this.push.apply(this,arguments)},wa.prototype.unshiftAll=function(P){return this.pushAll(P)},wa.prototype.shift=function(){return this.pop.apply(this,arguments)},wa.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):DE()},wa.prototype.slice=function(P,F){if(B(P,F,this.size))return this;var K=j(P,this.size),re=Q(F,this.size);if(re!==this.size)return St.prototype.slice.call(this,P,F);for(var oe=this.size-K,Ce=this._head;K--;)Ce=Ce.next;return this.__ownerID?(this.size=oe,this._head=Ce,this.__hash=void 0,this.__altered=!0,this):m0(oe,Ce)},wa.prototype.__ensureOwner=function(P){return P===this.__ownerID?this:P?m0(this.size,this._head,P,this.__hash):(this.__ownerID=P,this.__altered=!1,this)},wa.prototype.__iterate=function(P,F){if(F)return this.reverse().__iterate(P);for(var K=0,re=this._head;re&&P(re.value,K++,this)!==!1;)re=re.next;return K},wa.prototype.__iterator=function(P,F){if(F)return this.reverse().__iterator(P);var K=0,re=this._head;return new U(function(){if(re){var oe=re.value;return re=re.next,z(P,K++,oe)}return ee()})};function nN(P){return!!(P&&P[aN])}wa.isStack=nN;var aN="@@__IMMUTABLE_STACK__@@",Nv=wa.prototype;Nv[aN]=!0,Nv.withMutations=Gr.withMutations,Nv.asMutable=Gr.asMutable,Nv.asImmutable=Gr.asImmutable,Nv.wasAltered=Gr.wasAltered;function m0(P,F,K,re){var oe=Object.create(Nv);return oe.size=P,oe._head=F,oe.__ownerID=K,oe.__hash=re,oe.__altered=!1,oe}var iN;function DE(){return iN||(iN=m0(0))}function Xu(P,F){var K=function(re){P.prototype[re]=F[re]};return Object.keys(F).forEach(K),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(F).forEach(K),P}a.Iterator=U,Xu(a,{toArray:function(){Hi(this.size);var P=new Array(this.size||0);return this.valueSeq().__iterate(function(F,K){P[K]=F}),P},toIndexedSeq:function(){return new Rv(this)},toJS:function(){return this.toSeq().map(function(P){return P&&typeof P.toJS=="function"?P.toJS():P}).__toJS()},toJSON:function(){return this.toSeq().map(function(P){return P&&typeof P.toJSON=="function"?P.toJSON():P}).__toJS()},toKeyedSeq:function(){return new hs(this,!0)},toMap:function(){return Qr(this.toKeyedSeq())},toObject:function(){Hi(this.size);var P={};return this.__iterate(function(F,K){P[K]=F}),P},toOrderedMap:function(){return Sa(this.toKeyedSeq())},toOrderedSet:function(){return $u(l(this)?this.valueSeq():this)},toSet:function(){return Yn(l(this)?this.valueSeq():this)},toSetSeq:function(){return new kv(this)},toSeq:function(){return c(this)?this.toIndexedSeq():l(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return wa(l(this)?this.valueSeq():this)},toList:function(){return jn(l(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(P,F){return this.size===0?P+F:P+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+F},concat:function(){var P=r.call(arguments,0);return Dn(this,Tne(this,P))},includes:function(P){return this.some(function(F){return Ve(F,P)})},entries:function(){return this.__iterator(J)},every:function(P,F){Hi(this.size);var K=!0;return this.__iterate(function(re,oe,Ce){if(!P.call(F,re,oe,Ce))return K=!1,!1}),K},filter:function(P,F){return Dn(this,zL(this,P,F,!0))},find:function(P,F,K){var re=this.findEntry(P,F);return re?re[1]:K},forEach:function(P,F){return Hi(this.size),this.__iterate(F?P.bind(F):P)},join:function(P){Hi(this.size),P=P!==void 0?""+P:",";var F="",K=!0;return this.__iterate(function(re){K?K=!1:F+=P,F+=re!=null?re.toString():""}),F},keys:function(){return this.__iterator(W)},map:function(P,F){return Dn(this,jL(this,P,F))},reduce:function(P,F,K){Hi(this.size);var re,oe;return arguments.length<2?oe=!0:re=F,this.__iterate(function(Ce,De,qe){oe?(oe=!1,re=Ce):re=P.call(K,re,Ce,De,qe)}),re},reduceRight:function(P,F,K){var re=this.toKeyedSeq().reverse();return re.reduce.apply(re,arguments)},reverse:function(){return Dn(this,_E(this,!0))},slice:function(P,F){return Dn(this,wE(this,P,F,!0))},some:function(P,F){return!this.every(i2(P),F)},sort:function(P){return Dn(this,Lv(this,P))},values:function(){return this.__iterator(q)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(P,F){return R(P?this.toSeq().filter(P,F):this)},countBy:function(P,F){return Ene(this,P,F)},equals:function(P){return nt(this,P)},entrySeq:function(){var P=this;if(P._cache)return new O(P._cache);var F=P.toSeq().map(One).toIndexedSeq();return F.fromEntrySeq=function(){return P.toSeq()},F},filterNot:function(P,F){return this.filter(i2(P),F)},findEntry:function(P,F,K){var re=K;return this.__iterate(function(oe,Ce,De){if(P.call(F,oe,Ce,De))return re=[Ce,oe],!1}),re},findKey:function(P,F){var K=this.findEntry(P,F);return K&&K[0]},findLast:function(P,F,K){return this.toKeyedSeq().reverse().find(P,F,K)},findLastEntry:function(P,F,K){return this.toKeyedSeq().reverse().findEntry(P,F,K)},findLastKey:function(P,F){return this.toKeyedSeq().reverse().findKey(P,F)},first:function(){return this.find(H)},flatMap:function(P,F){return Dn(this,Ine(this,P,F))},flatten:function(P){return Dn(this,HL(this,P,!0))},fromEntrySeq:function(){return new Ov(this)},get:function(P,F){return this.find(function(K,re){return Ve(re,P)},void 0,F)},getIn:function(P,F){for(var K=this,re=YL(P),oe;!(oe=re.next()).done;){var Ce=oe.value;if(K=K&&K.get?K.get(Ce,x):x,K===x)return F}return K},groupBy:function(P,F){return Ane(this,P,F)},has:function(P){return this.get(P,x)!==x},hasIn:function(P){return this.getIn(P,x)!==x},isSubset:function(P){return P=typeof P.includes=="function"?P:a(P),this.every(function(F){return P.includes(F)})},isSuperset:function(P){return P=typeof P.isSubset=="function"?P:a(P),P.isSubset(this)},keyOf:function(P){return this.findKey(function(F){return Ve(F,P)})},keySeq:function(){return this.toSeq().map(kne).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(P){return this.toKeyedSeq().reverse().keyOf(P)},max:function(P){return t2(this,P)},maxBy:function(P,F){return t2(this,F,P)},min:function(P){return t2(this,P?oN(P):uN)},minBy:function(P,F){return t2(this,F?oN(F):uN,P)},rest:function(){return this.slice(1)},skip:function(P){return this.slice(Math.max(0,P))},skipLast:function(P){return Dn(this,this.toSeq().reverse().skip(P).reverse())},skipWhile:function(P,F){return Dn(this,VL(this,P,F,!0))},skipUntil:function(P,F){return this.skipWhile(i2(P),F)},sortBy:function(P,F){return Dn(this,Lv(this,F,P))},take:function(P){return this.slice(0,Math.max(0,P))},takeLast:function(P){return Dn(this,this.toSeq().reverse().take(P).reverse())},takeWhile:function(P,F){return Dn(this,Pne(this,P,F))},takeUntil:function(P,F){return this.takeWhile(i2(P),F)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=Nne(this))}});var qi=a.prototype;qi[h]=!0,qi[X]=qi.values,qi.__toJS=qi.toArray,qi.__toStringMapper=sN,qi.inspect=qi.toSource=function(){return this.toString()},qi.chain=qi.flatMap,qi.contains=qi.includes,Xu(i,{flip:function(){return Dn(this,UL(this))},mapEntries:function(P,F){var K=this,re=0;return Dn(this,this.toSeq().map(function(oe,Ce){return P.call(F,[Ce,oe],re++,K)}).fromEntrySeq())},mapKeys:function(P,F){var K=this;return Dn(this,this.toSeq().flip().map(function(re,oe){return P.call(F,re,oe,K)}).flip())}});var a2=i.prototype;a2[v]=!0,a2[X]=qi.entries,a2.__toJS=qi.toObject,a2.__toStringMapper=function(P,F){return JSON.stringify(F)+": "+sN(P)},Xu(o,{toKeyedSeq:function(){return new hs(this,!1)},filter:function(P,F){return Dn(this,zL(this,P,F,!1))},findIndex:function(P,F){var K=this.findEntry(P,F);return K?K[0]:-1},indexOf:function(P){var F=this.keyOf(P);return F===void 0?-1:F},lastIndexOf:function(P){var F=this.lastKeyOf(P);return F===void 0?-1:F},reverse:function(){return Dn(this,_E(this,!1))},slice:function(P,F){return Dn(this,wE(this,P,F,!1))},splice:function(P,F){var K=arguments.length;if(F=Math.max(F|0,0),K===0||K===2&&!F)return this;P=j(P,P<0?this.count():this.size);var re=this.slice(0,P);return Dn(this,K===1?re:re.concat(k(arguments,2),this.slice(P+F)))},findLastIndex:function(P,F){var K=this.findLastEntry(P,F);return K?K[0]:-1},first:function(){return this.get(0)},flatten:function(P){return Dn(this,HL(this,P,!1))},get:function(P,F){return P=L(this,P),P<0||this.size===1/0||this.size!==void 0&&P>this.size?F:this.find(function(K,re){return re===P},void 0,F)},has:function(P){return P=L(this,P),P>=0&&(this.size!==void 0?this.size===1/0||P<this.size:this.indexOf(P)!==-1)},interpose:function(P){return Dn(this,Mne(this,P))},interleave:function(){var P=[this].concat(k(arguments)),F=EE(this.toSeq(),_e.of,P),K=F.flatten(!0);return F.size&&(K.size=F.size*P.length),Dn(this,K)},keySeq:function(){return pe(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(P,F){return Dn(this,VL(this,P,F,!1))},zip:function(){var P=[this].concat(k(arguments));return Dn(this,EE(this,Lne,P))},zipWith:function(P){var F=k(arguments);return F[0]=this,Dn(this,EE(this,P,F))}}),o.prototype[p]=!0,o.prototype[g]=!0,Xu(s,{get:function(P,F){return this.has(P)?P:F},includes:function(P){return this.has(P)},keySeq:function(){return this.valueSeq()}}),s.prototype.has=qi.includes,s.prototype.contains=s.prototype.includes,Xu(Ie,i.prototype),Xu(_e,o.prototype),Xu(ae,s.prototype),Xu(ct,i.prototype),Xu(St,o.prototype),Xu(Bt,s.prototype);function kne(P,F){return F}function One(P,F){return[F,P]}function i2(P){return function(){return!P.apply(this,arguments)}}function oN(P){return function(){return-P.apply(this,arguments)}}function sN(P){return typeof P=="string"?JSON.stringify(P):String(P)}function Lne(){return k(arguments)}function uN(P,F){return P<F?1:P>F?-1:0}function Nne(P){if(P.size===1/0)return 0;var F=f(P),K=l(P),re=F?1:0,oe=P.__iterate(K?F?function(Ce,De){re=31*re+lN(Lt(Ce),Lt(De))|0}:function(Ce,De){re=re+lN(Lt(Ce),Lt(De))|0}:F?function(Ce){re=31*re+Lt(Ce)|0}:function(Ce){re=re+Lt(Ce)|0});return Fne(oe,re)}function Fne(P,F){return F=rr(F,3432918353),F=rr(F<<15|F>>>-15,461845907),F=rr(F<<13|F>>>-13,5),F=(F+3864292196|0)^P,F=rr(F^F>>>16,2246822507),F=rr(F^F>>>13,3266489909),F=hr(F^F>>>16),F}function lN(P,F){return P^F+2654435769+(P<<6)+(P>>2)|0}var Bne={Iterable:a,Seq:xe,Collection:Ye,Map:Qr,OrderedMap:Sa,List:jn,Stack:wa,Set:Yn,OrderedSet:$u,Record:ko,Range:pe,Repeat:Xe,is:Ve,fromJS:Te};return Bne})})(VX);var ia=VX.exports,c3=Object.prototype.hasOwnProperty;function i3e(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];c3.call(t,a)&&typeof e[a]>"u"&&(e[a]=t[a])}return e}function o3e(e,t){for(var r=!1,n=0,a=Object.keys(t);n<a.length;n++){var i=a[n];if(c3.call(t,i)&&t[i]!==e[i]){r=!0;break}}return r?Object.assign({},e,t):e}function fk(e,t){if(!e)return!t;if(!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!c3.call(e,i)||e[i]!==t[i])return!1}return!0}function s3e(e,t){for(var r=e,n=0;n<t.length;n++)if(t[n]&&(r=o3e(e,t[n]),r!==e)){for(var a=n+1;a<t.length;a++)r=Object.assign(r,t[a]);break}return r}function Qf(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=Qf(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){var t={};for(var a in e)c3.call(e,a)&&(t[a]=Qf(e[a]));return t}throw new Error(`Can't clone, type "`+typeof e+'" unsupported')}function Uu(e,t){if(e)for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];t(e[a],a)}}function u3e(){var e=function(){var p=typeof window<"u"&&window,g=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self,m=typeof e<"u"&&e;return p||m||g}(),t={},r=typeof document<"u"?document:void 0,n=1,a;function i(p){for(var g=[],m=1;m<arguments.length;m++)g[m-1]=arguments[m];typeof p!="function"&&(p=new Function(""+p));var y={callback:p,args:g};return t[n]=y,a(n),n++}function o(p){delete t[p]}function s(p){var g=p.callback,m=p.args;switch(m.length){case 0:g();break;case 1:g(m[0]);break;case 2:g(m[0],m[1]);break;case 3:g(m[0],m[1],m[2]);break;default:g.apply(void 0,m);break}}function u(p){var g=t[p];o(p),s(g)}function l(){a=function(p){process.nextTick(function(){u(p)})}}function c(){if(e&&e.postMessage&&!e.importScripts){var p=!0,g=e.onmessage;return e.onmessage=function(){p=!1},e.postMessage("","*"),e.onmessage=g,p}}function d(){var p="setImmediate$"+Math.random()+"$",g=function(m){m.source===e&&typeof m.data=="string"&&m.data.indexOf(p)===0&&u(+m.data.slice(p.length))};window.addEventListener?window.addEventListener("message",g,!1):window.attachEvent("onmessage",g),a=function(m){window.postMessage(p+m,"*")}}function f(){var p=new MessageChannel;p.port1.onmessage=function(g){var m=g.data;u(m)},a=function(g){p.port2.postMessage(g)}}function h(){var p=r.documentElement;a=function(g){var m=r.createElement("script");m.onreadystatechange=function(){u(g),m.onreadystatechange=null,p.removeChild(m),m=null},p.appendChild(m)}}function v(){a=function(p){setTimeout(u,0,p)}}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?l():c()?d():typeof MessageChannel<"u"?f():r&&"onreadystatechange"in r.createElement("script")?h():v(),{setImmediate:i,clearImmediate:o}}var uM=function(){return typeof setImmediate<"u"?typeof window<"u"?{setImmediate:function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=window).setImmediate.apply(t,Ut([e],r))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate,clearImmediate}:u3e()}();function l3e(e){uM.setImmediate(e)}var hk={setImmediate:uM.setImmediate,clearImmediate:uM.clearImmediate,immediatePromise:function(){return new Promise(l3e)},delay:function(e,t){return t===void 0&&(t=void 0),new Promise(function(r){return setTimeout(r,e,t)})}},Yg=function(){try{return!0}catch{return!1}}(),Mr=function(){try{var t={}.DEBUG;return t==="*"||t==="molstar"}catch{return!1}}(),c3e=typeof performance<"u"&&performance.mark&&performance.measure,YA=c3e&&!Yg,Wy;(function(e){function t(o){return"startTask"+o.id}function r(o){return"endTask"+o.id}function n(o){YA&&performance.mark(t(o))}e.markStart=n;function a(o){YA&&performance.mark(r(o))}e.markEnd=a;function i(o){YA&&performance.measure("✳️ "+o.name,t(o),r(o))}e.measure=i})(Wy||(Wy={}));function d3e(e,t,r){r===void 0&&(r=250);var n=qX(e,t,r),a=new QX(n,n.root);return pk(e,a)}function f3e(e,t,r){r===void 0&&(r=250);var n=qX(e,t,r);return new QX(n,n.root)}function HX(e,t){return pk(t,e)}function h3e(e,t,r){return e.runChild(t,r)}function GX(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function qX(e,t,r){var n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:kn(),observer:t,abortToken:n,taskId:e.id,root:{progress:GX(e),children:[]},tryAbort:p3e(n)}}function p3e(e){return function(t){e.abortRequested=!0,e.reason=t||e.reason}}function WX(e){return{progress:E({},e.progress),children:e.children.map(WX)}}function $X(e){return e.progress.canAbort&&e.children.every($X)}function v3e(e){return{root:WX(e.root),canAbort:$X(e.root),requestAbort:e.tryAbort}}function pk(e,t){return de(this,void 0,void 0,function(){var r,n;return fe(this,function(a){switch(a.label){case 0:Wy.markStart(e),t.node.progress.startedTime=kn(),a.label=1;case 1:return a.trys.push([1,3,,7]),[4,e.f(t)];case 2:return r=a.sent(),Wy.markEnd(e),Wy.measure(e),t.info.abortToken.abortRequested&&XX(t.info),[2,r];case 3:return n=a.sent(),et.isAbort(n)?(t.isAborted=!0,t.node.children.length>0?[4,new Promise(function(i){t.onChildrenFinished=i})]:[3,5]):[3,6];case 4:a.sent(),a.label=5;case 5:e.onAbort&&e.onAbort(),a.label=6;case 6:throw Mr&&console.error(n),n;case 7:return[2]}})})}function XX(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,YX(e.root),KX(e,kn())),et.Aborted(e.abortToken.reason)}function YX(e){var t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(var r=0,n=e.children;r<n.length;r++){var a=n[r];YX(a)}}function KX(e,t){e.lastNotified=t;var r=v3e(e);e.observer(r)}var QX=function(){function e(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&(this.isAborted=!0,XX(this.info))},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),kn()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!1,configurable:!0}),e.prototype.updateProgress=function(t){if(this.checkAborted(),!!t){var r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort<"u"&&(r.canAbort=t.canAbort),typeof t.message<"u"&&(r.message=t.message),typeof t.current<"u"&&(r.current=t.current),typeof t.max<"u"&&(r.max=t.max),r.isIndeterminate=typeof r.current>"u"||typeof r.max>"u",typeof t.isIndeterminate<"u"&&(r.isIndeterminate=t.isIndeterminate))}},e.prototype.update=function(t,r){if(this.lastUpdatedTime=kn(),this.updateProgress(t),!r)return KX(this.info,this.lastUpdatedTime),this.checkAborted(),hk.immediatePromise()},e.prototype.runChild=function(t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return fe(this,function(c){switch(c.label){case 0:this.updateProgress(r),n={progress:GX(t),children:[]},a=this.node.children,a.push(n),i=new e(this.info,n),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,pk(t,i)];case 2:return[2,c.sent()];case 3:if(o=c.sent(),et.isAbort(o)&&this.isAborted)return[2,void 0];throw o;case 4:if(s=a.indexOf(n),s>=0){for(u=s,l=a.length-1;u<l;u++)a[u]=a[u+1];a.pop()}return a.length===0&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}(),m3e=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(t,r){},e}(),hS=new m3e,et;(function(e){var t=function(){function d(f,h,v){this.name=f,this.f=h,this.onAbort=v,this.id=c()}return d.prototype.run=function(f,h){return h===void 0&&(h=250),f?d3e(this,f,h):this.f(hS)},d.prototype.runAsChild=function(f,h){return f.isSynchronous?this.f(hS):h3e(f,this,h)},d.prototype.runInContext=function(f){return f.isSynchronous?this.f(hS):HX(f,this)},d}();function r(d){var f=d;return!!d&&typeof f.id=="number"&&typeof f.name=="string"&&!!f.run}e.is=r;function n(d){return!!d&&!!d.isAborted}e.isAbort=n;function a(d){return{isAborted:!0,reason:d,toString:function(){return"Aborted"+(d?": "+d:"")}}}e.Aborted=a;function i(d,f,h){return new t(d,f,h)}e.create=i;function o(d,f){var h=this;return i(d,function(v){return de(h,void 0,void 0,function(){return fe(this,function(p){return[2,f]})})})}e.constant=o;function s(){var d=this;return i("",function(f){return de(d,void 0,void 0,function(){return fe(this,function(h){return[2]})})})}e.empty=s;function u(d,f){var h=this;return i(d,function(v){return de(h,void 0,void 0,function(){return fe(this,function(p){throw new Error(f)})})})}e.fail=u;function l(d,f){return r(d)?f?d.runInContext(f):d.run():d}e.resolveInContext=l;var c=zi(0,1073741823)})(et||(et={}));var x8;(function(e){e.Synchronous=hS})(x8||(x8={}));var S8;(function(e){function t(n,a){a===void 0&&(a="");var i=n.progress;if(!n.children.length)return i.isIndeterminate?""+a+i.taskName+": "+i.message:""+a+i.taskName+": ["+i.current+"/"+i.max+"] "+i.message;var o=a+"  |_ ",s=n.children.map(function(u){return t(u,o)});return i.isIndeterminate?""+a+i.taskName+": "+i.message+`
`+s.join(`
`):""+a+i.taskName+": ["+i.current+"/"+i.max+"] "+i.message+`
`+s.join(`
`)}function r(n){return t(n.root)}e.format=r})(S8||(S8={}));function qc(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:if(i=Math.max(t,0),o=0,s=0,e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),[2,r];u=kn(),l=0,c=0,f.label=1;case 1:return(l=n(i,r))>0?(o+=l,d=kn()-u,c+=d,s+=d,e.shouldUpdate?[4,a(e,r,o)]:[3,3]):[3,4];case 2:f.sent(),i=Math.round(c*o/s)+1,u=kn(),c=0,f.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,a(e,r,o)]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,r]}})})}function g3e(e){return e>>0}function Sf(e,t){return e[t]|e[t+1]<<8}function Qh(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function Zh(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function dc(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function y3e(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n}function b3e(e){return e.length<2?"0"+e:e}function x3e(e,t,r){for(var n="",a,i=0;i<r;i++)n+="%"+b3e(e[t+i].toString(16));try{a=decodeURIComponent(n)}catch{return y3e(e,t,r)}return a}function S3e(e,t,r){for(var n=r.length,a=0,i=0;i<n;i++){var o=r.charCodeAt(i);if(!(o&4294967295-(1<<7)+1))e[t+a]=o,a++;else if(!(o&4294967295-(1<<11)+1))e[t+a]=192|o>>6,e[t+a+1]=128|o>>0&63,a+=2;else if(!(o&4294967295-(1<<16)+1))e[t+a]=224|o>>12,e[t+a+1]=128|o>>6&63,e[t+a+2]=128|o>>0&63,a+=3;else if(!(o&4294967295-(1<<21)+1))e[t+a]=240|o>>18,e[t+a+1]=128|o>>12&63,e[t+a+2]=128|o>>6&63,e[t+a+3]=128|o>>0&63,a+=4;else throw"e"}return a}function ZX(e){for(var t=e.length,r=0,n=0;n<t;n++){var a=e.charCodeAt(n);if(!(a&4294967295-(1<<7)+1))r++;else if(!(a&4294967295-(1<<11)+1))r+=2;else if(!(a&4294967295-(1<<16)+1))r+=3;else if(!(a&4294967295-(1<<21)+1))r+=4;else throw"e"}return r}var C3e=function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}();function _3e(e,t,r,n){for(var a=0;a<n;a++)e=C3e[(e^t[r+a])&255]^e>>>8;return e}function JX(e,t,r){return _3e(4294967295,e,t,r)^4294967295}var xt=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(1<<15),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(1<<16),prev:new e(1<<15)}}();(function(){for(var e=32768,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,xt.rev15[t]=(r>>>16|r<<16)>>>17}function n(a,i,o){for(;i--!==0;)a.push(0,o)}for(var t=0;t<32;t++)xt.ldef[t]=xt.of0[t]<<3|xt.exb[t],xt.ddef[t]=xt.df0[t]<<4|xt.dxb[t];n(xt.fltree,144,8),n(xt.fltree,255-143,9),n(xt.fltree,279-255,7),n(xt.fltree,287-279,8),zf(xt.fltree,9),$y(xt.fltree,9,xt.flmap),Xy(xt.fltree,9),n(xt.fdtree,32,5),zf(xt.fdtree,5),$y(xt.fdtree,5,xt.fdmap),Xy(xt.fdtree,5),n(xt.itree,19,0),n(xt.ltree,286,0),n(xt.dtree,30,0),n(xt.ttree,320,0)})();function $y(e,t,r){for(var n=e.length,a=xt.rev15,i=0;i<n;i+=2)if(e[i+1]!==0)for(var o=i>>1,s=e[i+1],u=o<<4|s,l=t-s,c=e[i]<<l,d=c+(1<<l);c!==d;){var f=a[c]>>>15-t;r[f]=u,c++}}function zf(e,t){for(var r=e.length,n=xt.bl_count,a=0;a<=t;a++)n[a]=0;for(var a=1;a<r;a+=2)n[e[a]]++;var i=xt.next_code,o=0;n[0]=0;for(var s=1;s<=t;s++)o=o+n[s-1]<<1,i[s]=o;for(var u=0;u<r;u+=2){var l=e[u+1];l!==0&&(e[u]=i[l],i[l]++)}}function Xy(e,t){for(var r=xt.rev15,n=15-t,a=0;a<e.length;a+=2){var i=e[a]<<t-e[a+1];e[a]=r[i]>>>n}}function w3e(e,t){var r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function E3e(e,t){for(var r=e.data,n=e.noBuf,a=e.buf,i=e.BFINAL,o=e.off,s=e.pos,u=0;i===0&&u<t;){var l=void 0,c=void 0,d=0,f=0;i=QA(r,s,1),u+=1;var h=QA(r,s+1,2);if(s+=3,h===0){s&7&&(s+=8-(s&7));var v=(s>>>3)+4,p=r[v-4]|r[v-3]<<8;n&&(a=KA(a,o+p)),a.set(new Uint8Array(r.buffer,r.byteOffset+v,p),o),s=v+p<<3,o+=p;continue}if(n&&(a=KA(a,o+(1<<17))),h===1)l=xt.flmap,c=xt.fdmap,d=(1<<9)-1,f=(1<<5)-1;else if(h===2){var g=df(r,s,5)+257,m=df(r,s+5,5)+1,y=df(r,s+10,4)+4;s+=14;for(var b=0;b<38;b+=2)xt.itree[b]=0,xt.itree[b+1]=0;for(var S=1,b=0;b<y;b++){var x=df(r,s+b*3,3);xt.itree[(xt.ordr[b]<<1)+1]=x,x>S&&(S=x)}s+=3*y,zf(xt.itree,S),$y(xt.itree,S,xt.imap),l=xt.lmap,c=xt.dmap,s=P3e(xt.imap,(1<<S)-1,g+m,r,s,xt.ttree);var C=C8(xt.ttree,0,g,xt.ltree);d=(1<<C)-1;var w=C8(xt.ttree,g,m,xt.dtree);f=(1<<w)-1,zf(xt.ltree,C),$y(xt.ltree,C,l),zf(xt.dtree,w),$y(xt.dtree,w,c)}else throw new Error("unknown BTYPE "+h);for(;;){var A=l[lM(r,s)&d];s+=A&15;var I=A>>>4;if(!(I>>>8))a[o++]=I;else{if(I===256)break;var D=o+I-254;if(I>264){var k=xt.ldef[I-257];D=o+(k>>>3)+df(r,s,k&7),s+=k&7}var R=c[lM(r,s)&f];s+=R&15;var L=R>>>4,H=xt.ddef[L],B=(H>>>4)+QA(r,s,H&15);for(s+=H&15,n&&(a=KA(a,o+(1<<17)));o<D;)a[o]=a[o++-B],a[o]=a[o++-B],a[o]=a[o++-B],a[o]=a[o++-B];o=D}}}e.buf=a,e.BFINAL=i,e.off=o,e.pos=s}function A3e(e,t,r){return de(this,void 0,void 0,function(){var n;return fe(this,function(a){switch(a.label){case 0:if(t[0]===3&&t[1]===0)return[2,r||new Uint8Array(0)];n=w3e(t,r),a.label=1;case 1:return n.BFINAL!==0?[3,4]:e.shouldUpdate?[4,e.update({message:"Inflating blocks...",current:n.pos,max:t.length})]:[3,3];case 2:a.sent(),a.label=3;case 3:return E3e(n,100),[3,1];case 4:return[2,n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)]}})})}function KA(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function P3e(e,t,r,n,a,i){for(var o=0;o<r;){var s=e[lM(n,a)&t];a+=s&15;var u=s>>>4;if(u<=15)i[o]=u,o++;else{var l=0,c=0;u===16?(c=3+df(n,a,2),a+=2,l=i[o-1]):u===17?(c=3+df(n,a,3),a+=3):u===18&&(c=11+df(n,a,7),a+=7);for(var d=o+c;o<d;)i[o]=l,o++}}return a}function C8(e,t,r,n){for(var a=0,i=0,o=n.length>>>1;i<r;){var s=e[i+t];n[i<<1]=0,n[(i<<1)+1]=s,s>a&&(a=s),i++}for(;i<o;)n[i<<1]=0,n[(i<<1)+1]=0,i++;return a}function df(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function QA(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function lM(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function ZA(e,t,r){for(var n=[],a=e.length,i=t.length,o=0;o<i;o+=2)t[o]=0,t[o+1]=0;for(var o=0;o<a;o++)e[o]!==0&&n.push({lit:o,f:e[o],d:void 0});var s=n.length,u=n.slice(0);if(s===0)return 0;if(s===1){var l=n[0].lit,c=l===0?1:0;return t[(l<<1)+1]=1,t[(c<<1)+1]=1,1}n.sort(function(m,y){return m.f-y.f});var d=n[0],f=n[1],h=0,v=1,p=2;for(n[0]={lit:-1,f:d.f+f.f,l:d,r:f,d:0};v!==s-1;)h!==v&&(p===s||n[h].f<n[p].f)?d=n[h++]:d=n[p++],h!==v&&(p===s||n[h].f<n[p].f)?f=n[h++]:f=n[p++],n[v++]={lit:-1,f:d.f+f.f,l:d,r:f,d:void 0};var g=cM(n[v-1],0);g>r&&(T3e(u,r,g),g=r);for(var o=0;o<s;o++)t[(u[o].lit<<1)+1]=u[o].d;return g}function cM(e,t){return e.lit!==-1?(e.d=t,t):Math.max(cM(e.l,t+1),cM(e.r,t+1))}function T3e(e,t,r){var n=0,a=1<<r-t,i=0;for(e.sort(function(s,u){return u.d===s.d?s.f-u.f:u.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){var o=e[n].d;e[n].d=t,i+=a-(1<<r-o)}for(i=i>>>r-t;i>0;){var o=e[n].d;o<t?(e[n].d++,i-=1<<t-o-1):n++}for(;n>=0;n--)e[n].d===t&&i<0&&(e[n].d--,i++);i!==0&&console.log("debt left")}function I3e(e,t,r,n){var a=xt.lits,i=xt.strt,o=xt.prev;return{data:e,out:t,opt:D3e[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:a,strt:i,prev:o}}function M3e(e,t){for(var r=e.data,n=e.dlen,a=e.out,i=e.opt,o=e.i,s=e.pos,u=e.cvrd,l=e.li,c=e.lc,d=e.bs,f=e.ebits,h=e.c,v=e.nc,p=xt.lits,g=xt.strt,m=xt.prev,y=Math.min(o+t,n);o<y;o++){if(h=v,o+1<n-2){v=vk(r,o+1);var b=o+1&32767;m[b]=g[v],g[v]=b}if(u<=o){(l>14e3||c>26697)&&n-o>100&&(u<o&&(p[l]=o-u,l+=2,u=o),s=eY(o===n-1||u===n?1:0,p,l,f,r,d,o-d,a,s),l=c=f=0,d=o);var S=0;if(o<n-2&&(S=k3e(r,o,m,h,Math.min(i[2],n-o),i[3])),S!==0){var x=S>>>16,C=S&65535,w=E8(x,xt.of0);xt.lhst[257+w]++;var A=E8(C,xt.df0);xt.dhst[A]++,f+=xt.exb[w]+xt.dxb[A],p[l]=x<<23|o-u,p[l+1]=C<<16|w<<8|A,l+=2,u=o+x}else xt.lhst[r[o]]++;c++}}e.i=o,e.pos=s,e.cvrd=u,e.li=l,e.lc=c,e.bs=d,e.ebits=f,e.c=h,e.nc=v}var D3e=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function R3e(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,h,v,p,g;return fe(this,function(m){switch(m.label){case 0:if(i=I3e(t,r,n,a),o=i.dlen,a===0){for(s=i.i,u=i.pos;s<o;)l=Math.min(65535,o-s),Jh(r,u,s+l===o?1:0),u=tY(t,s,l,r,u+8),s+=l;return[2,u>>>3]}o>2&&(i.nc=vk(t,0),i.strt[i.nc]=0),m.label=1;case 1:return i.i<o?e.shouldUpdate?[4,e.update({message:"Deflating...",current:i.i,max:o})]:[3,3]:[3,4];case 2:m.sent(),m.label=3;case 3:return M3e(i,1024*1024),[3,1];case 4:for(c=i.li,d=i.cvrd,f=i.pos,h=i.i,v=i.lits,p=i.bs,g=i.ebits,(p!==h||t.length===0)&&(d<h&&(v[c]=h-d,c+=2,d=h),f=eY(1,v,c,g,t,p,h-p,r,f));f&7;)f++;return[2,f>>>3]}})})}function k3e(e,t,r,n,a,i){var o=t&32767,s=r[o],u=o-s+(1<<15)&32767;if(s===o||n!==vk(e,t-u))return 0;for(var l=0,c=0,d=Math.min(32767,t);u<=d&&--i!==0&&s!==o;){if(l===0||e[t+l]===e[t+l-u]){var f=O3e(e,t,u);if(f>l){if(l=f,c=u,l>=a)break;u+2<f&&(f=u+2);for(var h=0,v=0;v<f-2;v++){var p=t-u+v+32768&32767,g=r[p],m=p-g+(1<<15)&32767;m>h&&(h=m,s=p)}}}o=s,s=r[o],u+=o-s+(1<<15)&32767}return l<<16|c}function O3e(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;var n=t,a=Math.min(e.length,t+258);for(t+=3;t<a&&e[t]===e[t-r];)t++;return t-n}function vk(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function eY(e,t,r,n,a,i,o,s,u){xt.lhst[256]++;var l=L3e(),c=l[0],d=l[1],f=l[2],h=l[3],v=l[4],p=l[5],g=l[6],m=l[7],y=(u+3&7?8-(u+3&7):0)+32+(o<<3),b=n+F0(xt.fltree,xt.lhst)+F0(xt.fdtree,xt.dhst),S=n+F0(xt.ltree,xt.lhst)+F0(xt.dtree,xt.dhst);S+=14+3*p+F0(xt.itree,xt.ihst)+(xt.ihst[16]*2+xt.ihst[17]*3+xt.ihst[18]*7);for(var x=0;x<286;x++)xt.lhst[x]=0;for(var x=0;x<30;x++)xt.dhst[x]=0;for(var x=0;x<19;x++)xt.ihst[x]=0;var C=y<b&&y<S?0:b<S?1:2;if(pS(s,u,e),pS(s,u+1,C),u+=3,C===0){for(;u&7;)u++;u=tY(a,i,o,s,u)}else{var w=void 0,A=void 0;if(C===1)w=xt.fltree,A=xt.fdtree;else if(C===2){zf(xt.ltree,c),Xy(xt.ltree,c),zf(xt.dtree,d),Xy(xt.dtree,d),zf(xt.itree,f),Xy(xt.itree,f),w=xt.ltree,A=xt.dtree,Jh(s,u,h-257),u+=5,Jh(s,u,v-1),u+=5,Jh(s,u,p-4),u+=4;for(var I=0;I<p;I++)Jh(s,u+I*3,xt.itree[(xt.ordr[I]<<1)+1]);u+=3*p,u=_8(g,xt.itree,s,u),u=_8(m,xt.itree,s,u)}else throw new Error("unknown BTYPE "+C);for(var D=i,k=0;k<r;k+=2){for(var R=t[k],L=R>>>23,H=D+(R&(1<<23)-1);D<H;)u=by(a[D++],w,s,u);if(L!==0){var B=t[k+1],j=B>>16,Q=B>>8&255,G=B&255;u=by(257+Q,w,s,u),Jh(s,u,L-xt.of0[Q]),u+=xt.exb[Q],u=by(G,A,s,u),pS(s,u,j-xt.df0[G]),u+=xt.dxb[G],D+=L}}u=by(256,w,s,u)}return u}function tY(e,t,r,n,a){var i=a>>>3;return n[i]=r,n[i+1]=r>>>8,n[i+2]=255-n[i],n[i+3]=255-n[i+1],i+=4,n.set(new Uint8Array(e.buffer,t,r),i),a+(r+4<<3)}function L3e(){for(var e=ZA(xt.lhst,xt.ltree,15),t=ZA(xt.dhst,xt.dtree,15),r=[],n=w8(xt.ltree,r),a=[],i=w8(xt.dtree,a),o=0;o<r.length;o+=2)xt.ihst[r[o]]++;for(var o=0;o<a.length;o+=2)xt.ihst[a[o]]++;for(var s=ZA(xt.ihst,xt.itree,7),u=19;u>4&&xt.itree[(xt.ordr[u-1]<<1)+1]===0;)u--;return[e,t,s,n,i,u,r,a]}function F0(e,t){for(var r=0,n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function _8(e,t,r,n){for(var a=0;a<e.length;a+=2){var i=e[a],o=e[a+1];n=by(i,t,r,n);var s=i===16?2:i===17?3:7;i>15&&(Jh(r,n,o),n+=s)}return n}function w8(e,t){for(var r=e.length;r!==2&&e[r-1]===0;)r-=2;for(var n=0;n<r;n+=2){var a=e[n+1],i=n+3<r?e[n+3]:-1,o=n+5<r?e[n+5]:-1,s=n===0?-1:e[n-1];if(a===0&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;var l=Math.min(u+1-n>>>1,138);l<11?t.push(17,l-3):t.push(18,l-11),n+=l*2-2}else if(a===s&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;var l=Math.min(u+1-n>>>1,6);t.push(16,l-3),n+=l*2-2}else t.push(a,0)}return r>>>1}function E8(e,t){var r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function by(e,t,r,n){return pS(r,n,t[e<<1]),n+t[(e<<1)+1]}function Jh(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function pS(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}function rY(e,t,r){return r===void 0&&(r=!1),de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v,p;return fe(this,function(g){switch(g.label){case 0:for(n=Object.create(null),a=new Uint8Array(t),i=a.length-4;Zh(a,i)!==101010256;)i--;o=i,o+=4,o+=4,s=Sf(a,o),o+=2,o+=2,o+=4,u=Zh(a,o),o+=4,o=u,l=0,g.label=1;case 1:return l<s?(o+=4,o+=4,o+=4,o+=4,o+=4,c=Zh(a,o),o+=4,d=Zh(a,o),o+=4,f=Sf(a,o),h=Sf(a,o+2),v=Sf(a,o+4),o+=6,o+=8,p=Zh(a,o),o+=4,o+=f+h+v,[4,N3e(e,a,p,n,c,d,r)]):[3,4];case 2:g.sent(),g.label=3;case 3:return l++,[3,1];case 4:return[2,n]}})})}function N3e(e,t,r,n,a,i,o){return de(this,void 0,void 0,function(){var s,u,l,c,d,f;return fe(this,function(h){switch(h.label){case 0:return r+=4,r+=2,r+=2,s=Sf(t,r),r+=2,r+=4,r+=4,r+=8,u=Sf(t,r),r+=2,l=Sf(t,r),r+=2,c=x3e(t,r,u),r+=u,r+=l,o?(n[c]={size:i,csize:a},[2]):(d=new Uint8Array(t.buffer,r),s!==0?[3,1]:(n[c]=new Uint8Array(d.buffer.slice(r,r+a)),[3,4]));case 1:return s!==8?[3,3]:(f=new Uint8Array(i),[4,nY(e,d,f)]);case 2:return h.sent(),n[c]=f,[3,4];case 3:throw"unknown compression method: "+s;case 4:return[2]}})})}function nY(e,t,r){return de(this,void 0,void 0,function(){return fe(this,function(n){return[2,A3e(e,t,r)]})})}function F3e(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:if(n=t[3],a=10,n&4&&(i=Sf(t,a),a+=i),n&8){for(o=a;t[o]!==0;)++o;a=o+1}if(n&16){for(o=a;t[o]!==0;)++o;a=o+1}return n&1&&(a+=2),s=g3e(Zh(t,t.length-8)),u=Zh(t,t.length-4),r===void 0&&(r=new Uint8Array(u)),l=new Uint8Array(t.buffer,t.byteOffset+a,t.length-a-8),[4,nY(e,l,r)];case 1:return c=f.sent(),d=JX(c,0,c.length),s!==d&&console.error("ungzip: checksums don't match"),[2,c]}})})}function B3e(e,t,r){return de(this,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return r===void 0&&(r={level:6}),n=new Uint8Array(50+Math.floor(t.length*1.1)),[4,R3e(e,t,n,0,r.level)];case 1:return a=i.sent(),[2,new Uint8Array(n.buffer,0,a)]}})})}function U3e(e,t){return t===void 0&&(t=!1),et.create("Zip",function(r){return j3e(r,e,t)})}function j3e(e,t,r){return r===void 0&&(r=!1),de(this,void 0,void 0,function(){var n,a,i,o,s,b,u,l,c,d,f,h,b,v,p,g,b,S,m,y,b,S,x,C;return fe(this,function(w){switch(w.label){case 0:n=0,a={},i=[];for(o in t)i.push(o);s=0,w.label=1;case 1:return s<i.length?(b=i[s],u=!z3e(b)&&!r,l=t[b],c=JX(l,0,l.length),d=a,f=b,C={cpr:u,usize:l.length,crc:c},u?[4,B3e(e,l)]:[3,3]):[3,6];case 2:return h=w.sent(),[3,4];case 3:h=l,w.label=4;case 4:d[f]=(C.file=h,C),w.label=5;case 5:return s++,[3,1];case 6:for(b in a)n+=a[b].file.length+30+46+2*ZX(b);n+=22,v=new Uint8Array(n),p=0,g=[];for(b in a)S=a[b],g.push(p),p=A8(v,p,b,S,0);m=0,y=p;for(b in a)S=a[b],g.push(p),p=A8(v,p,b,S,1,g[m++]);return x=p-y,dc(v,p,101010256),p+=4,p+=4,Qh(v,p,m),p+=2,Qh(v,p,m),p+=2,dc(v,p,x),p+=4,dc(v,p,y),p+=4,p+=2,[2,v.buffer]}})})}function z3e(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function A8(e,t,r,n,a,i){i===void 0&&(i=0);var o=n.file;dc(e,t,a===0?67324752:33639248),t+=4,a===1&&(t+=2),Qh(e,t,20),t+=2,Qh(e,t,0),t+=2,Qh(e,t,n.cpr?8:0),t+=2,dc(e,t,0),t+=4,dc(e,t,n.crc),t+=4,dc(e,t,o.length),t+=4,dc(e,t,n.usize),t+=4,Qh(e,t,ZX(r)),t+=2,Qh(e,t,0),t+=2,a===1&&(t+=2,t+=2,t+=6,dc(e,t,i),t+=4);var s=S3e(e,t,r);return t+=s,a===0&&(e.set(o,t),t+=o.length),t}function Am(e,t,r){for(var n=0,a=r.length;n<a;n++){var i=r.charCodeAt(n);if(i<128){e[t++]=i>>>0&127|0;continue}if(i<2048){e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;continue}if(i<65536){e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}if(i<1114112){e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}throw new Error("bad codepoint "+i)}}var V3e=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function aY(e){throw new Error(e)}function H3e(e,t,r){for(var n=V3e,a=void 0,i=[],o=512,s=0,u=t,l=t+r;u<l;u++){var c=e[u];c&128?(c&224)===192?i[s++]=n[(c&15)<<6|e[++u]&63]:(c&240)===224?i[s++]=String.fromCharCode((c&15)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):(c&248)===240?i[s++]=String.fromCharCode((c&7)<<18|(e[++u]&63)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):aY("Invalid byte "+c.toString(16)):i[s++]=n[c],s===o&&(a=a||[],a[a.length]=i.join(""),s=0)}return a?(s>0&&(a[a.length]=i.slice(0,s).join("")),a.join("")):i.slice(0,s).join("")}var P8=typeof TextDecoder<"u"?new TextDecoder:void 0;function mk(e,t,r){if(P8){var n=t||r!==e.length?e.subarray(t,t+r):e;return P8.decode(n)}else return H3e(e,t,r)}function UC(e){for(var t=0,r=0,n=e.length;r<n;r++){var a=e.charCodeAt(r);if(a<128){t+=1;continue}if(a<2048){t+=2;continue}if(a<65536){t+=3;continue}if(a<1114112){t+=4;continue}aY("bad codepoint "+a)}return t}var G3e=typeof document>"u"?require("xhr2"):XMLHttpRequest,Tu;(function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip"})(Tu||(Tu={}));function Cf(e,t){return Y3e(e,t)}function dM(e){return typeof e=="string"?I8(e,e,"string"):I8(e.title,e.url,e.type||"string",e.body,e.headers)}function q3e(e){if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function T8(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function iY(e,t,r){return new Promise(function(n,a){if(q3e(r)){var i=r.error;i!=null?a(i??T8(r instanceof XMLHttpRequest)):n(r);return}var o=!1;r.onerror=function(s){if(!o){var u=s.target.error;a(u??T8(r instanceof XMLHttpRequest))}},r.onprogress=function(s){if(!(!e.shouldUpdate||o))try{s.lengthComputable?e.update({message:t,isIndeterminate:!1,current:s.loaded,max:s.total}):e.update({message:t+" "+(s.loaded/1024/1024).toFixed(2)+" MB",isIndeterminate:!0})}catch(u){o=!0,a(u)}},r.onload=function(s){n(r)}})}function W3e(e){return/\.gz$/i.test(e)?Tu.Gzip:/\.zip$/i.test(e)?Tu.Zip:Tu.None}function $3e(e,t,r){return de(this,void 0,void 0,function(){var n,a,i;return fe(this,function(o){switch(o.label){case 0:switch(n=r,n){case Tu.None:return[3,1];case Tu.Gzip:return[3,2];case Tu.Zip:return[3,3]}return[3,5];case 1:return[2,t];case 2:return[2,F3e(e,t)];case 3:return[4,rY(e,t.buffer)];case 4:if(a=o.sent(),i=Object.keys(a),i.length!==1)throw new Error("can only decompress zip files with a single entry");return[2,a[i[0]]];case 5:return[2]}})})}function X3e(e,t,r,n){return de(this,void 0,void 0,function(){var a,i,o,s;return fe(this,function(u){switch(u.label){case 0:if(a=t.result,i=a instanceof ArrayBuffer?new Uint8Array(a):a,i===null)throw new Error("no data given");if(n===Tu.None)return[3,4];if(!(i instanceof Uint8Array))throw new Error("need Uint8Array for decompression");return[4,$3e(e,i,n)];case 1:return o=u.sent(),r!=="string"?[3,3]:[4,e.update({message:"Decoding text..."})];case 2:return u.sent(),i=mk(o,0,o.length),[3,4];case 3:i=o,u.label=4;case 4:return r==="binary"&&i instanceof Uint8Array?[2,i]:[3,5];case 5:return r==="zip"&&i instanceof Uint8Array?[4,rY(e,i.buffer)]:[3,7];case 6:return[2,u.sent()];case 7:if(r==="string"&&typeof i=="string")return[2,i];if(r==="xml"&&typeof i=="string")return s=new DOMParser,[2,s.parseFromString(i,"application/xml")];if(r==="json"&&typeof i=="string")return[2,JSON.parse(i)];u.label=8;case 8:throw new Error("could not get requested response data '"+r+"'")}})})}function Y3e(e,t){var r=this,n=void 0;return et.create("Read File",function(a){return de(r,void 0,void 0,function(){var i,o;return fe(this,function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),n=new FileReader,i=t==="zip"?Tu.None:W3e(e.name),t==="binary"||t==="zip"||i!==Tu.None?n.readAsArrayBuffer(e):n.readAsText(e),[4,a.update({message:"Opening file...",canAbort:!0})];case 1:return s.sent(),[4,iY(a,"Reading...",n)];case 2:return o=s.sent(),[4,a.update({message:"Processing file...",canAbort:!1})];case 3:return s.sent(),[4,X3e(a,o,t,i)];case 4:return[2,s.sent()];case 5:return n=void 0,[7];case 6:return[2]}})})},function(){n&&n.abort()})}var fM=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new G3e},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function K3e(e,t){if(e.status>=200&&e.status<400){var r=e.response;if(fM.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error("could not get requested response data '"+t+"'")}else throw fM.deposit(e),new Error("Download failed with status code "+e.status)}function Q3e(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function I8(e,t,r,n,a){var i=this,o=void 0;return et.create(e||"Download",function(s){return de(i,void 0,void 0,function(){var u,l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:if(o=fM.get(),o.open(n?"post":"get",t,!0),a)for(u=0,l=a;u<l.length;u++)c=l[u],d=c[0],f=c[1],o.setRequestHeader(d,f);return o.responseType=Q3e(r),o.send(n),[4,s.update({message:"Waiting for server...",canAbort:!0})];case 1:return p.sent(),[4,iY(s,"Downloading...",o)];case 2:return h=p.sent(),o=void 0,[4,s.update({message:"Parsing response...",canAbort:!1})];case 3:return p.sent(),v=K3e(h,r),[2,v]}})})},function(){o&&(o.abort(),o=void 0)})}function Z3e(e,t,r,n){return de(this,void 0,void 0,function(){var a,i,o,s,u,l,v,c,d,f,h,v,p;return fe(this,function(g){switch(g.label){case 0:return a=r.length,i=new Array(r.length),[4,e.update({message:"Downloading...",current:0,max:a})];case 1:for(g.sent(),o=[],s=[],u=0,l=Math.min(a,n);u<l;u++)v=r[u],o.push(D8(u,v.id,t.resolve(Pn.getUrlAsset(t,v.url),v.isBinary?"binary":"string").runAsChild(e))),s.push(u);c=0,g.label=2;case 2:return o.length>0?[4,Promise.race(o)]:[3,6];case 3:if(d=g.sent(),f=r[d.index],h=s.indexOf(d.index),c++,d.kind==="error"&&!f.canFail)throw new Error(f.url+": "+d.error);return e.shouldUpdate?[4,e.update({message:"Downloading...",current:c,max:a})]:[3,5];case 4:g.sent(),g.label=5;case 5:return i[d.index]=d,o=o.filter(M8,h),s=s.filter(M8,h),u<a&&(v=r[u],p=t.resolve(Pn.getUrlAsset(t,v.url),v.isBinary?"binary":"string").runAsChild(e),o.push(D8(u,v.id,p)),s.push(u),u++),[3,2];case 6:return[2,i]}})})}function M8(e,t){return this!==t}function D8(e,t,r){return de(this,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r];case 1:return n=i.sent(),[2,{kind:"ok",result:n,index:e,id:t}];case 2:return a=i.sent(),[2,{kind:"error",error:a,index:e,id:t}];case 3:return[2]}})})}var Pn;(function(e){function t(u,l){return E({kind:"url",id:pn.create22(),url:u},l)}e.Url=t;function r(u){return{kind:"file",id:pn.create22(),name:u.name,file:u}}e.File=r;function n(u){return(u==null?void 0:u.kind)==="url"}e.isUrl=n;function a(u){return(u==null?void 0:u.kind)==="file"}e.isFile=a;function i(u,l,c){return{data:u,dispose:function(){c.release(l)}}}e.Wrapper=i;function o(u){return typeof u=="string"?u:u.url}e.getUrl=o;function s(u,l,c){if(typeof l=="string"){var d=u.tryFindUrl(l,c);return d||t(l,{body:c})}return l}e.getUrlAsset=s})(Pn||(Pn={}));var J3e=function(){function e(){this._assets=new Map}return Object.defineProperty(e.prototype,"assets",{get:function(){return uk(this._assets.values())},enumerable:!1,configurable:!0}),e.prototype.tryFindUrl=function(t,r){for(var n=this.assets.values();;){var a=n.next();if(a.done)return;var i=a.value.asset;if(Pn.isUrl(i)&&i.url===t&&(i.body||"")===(r||""))return i}},e.prototype.set=function(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})},e.prototype.resolve=function(t,r,n){var a=this;return n===void 0&&(n=!0),Pn.isUrl(t)?et.create("Download "+(t.title||t.url),function(i){return de(a,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Pn).Wrapper,[4,Cf(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[p.sent(),t,this])];case 2:return n?[3,4]:(c=(l=Pn).Wrapper,[4,dM(E(E({},t),{type:r})).runInContext(i)]);case 3:return[2,c.apply(l,[p.sent(),t,this])];case 4:return[4,dM(E(E({},t),{type:"binary"})).runInContext(i)];case 5:return d=p.sent(),f=new File([d],"raw-data"),this._assets.set(t.id,{asset:t,file:f,refCount:1}),v=(h=Pn).Wrapper,[4,Cf(f,r).runInContext(i)];case 6:return[2,v.apply(h,[p.sent(),t,this])]}})})}):et.create("Read "+t.name,function(i){return de(a,void 0,void 0,function(){var o,s,u,l,c;return fe(this,function(d){switch(d.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Pn).Wrapper,[4,Cf(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[d.sent(),t,this])];case 2:if(!(t.file instanceof File))throw new Error("Cannot resolve file asset '"+t.name+"' ("+t.id+")");return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),c=(l=Pn).Wrapper,[4,Cf(t.file,r).runInContext(i)];case 3:return[2,c.apply(l,[d.sent(),t,this])]}})})})},e.prototype.release=function(t){var r=this._assets.get(t.id);r&&(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))},e}(),T;(function(e){e.Essential={isEssential:!0};function t(ae,ie){return ie&&(ie.label&&(ae.label=ie.label),ie.description&&(ae.description=ie.description),ie.legend&&(ae.legend=ie.legend),ie.fieldLabels&&(ae.fieldLabels=ie.fieldLabels),ie.isHidden&&(ae.isHidden=ie.isHidden),ie.shortLabel&&(ae.shortLabel=ie.shortLabel),ie.twoColumns&&(ae.twoColumns=ie.twoColumns),ie.isEssential&&(ae.isEssential=ie.isEssential),ie.category&&(ae.category=ie.category),ie.hideIf&&(ae.hideIf=ie.hideIf),ie.help&&(ae.help=ie.help)),ae}function r(ae){var ie=E({},ae);return ie.isOptional=!0,ie}e.Optional=r;function n(ae,ie){return t({type:"value",defaultValue:ae},ie)}e.Value=n;function a(ae,ie,O){return t({type:"select",defaultValue:_e(ae,ie),options:ie,cycle:O==null?void 0:O.cycle},O)}e.Select=a;function i(ae,ie,O){var V=t({type:"multi-select",defaultValue:ae,options:ie},O);return O!=null&&O.emptyValue&&(V.emptyValue=O.emptyValue),V}e.MultiSelect=i;function o(ae,ie){return t({type:"boolean",defaultValue:ae},ie)}e.Boolean=o;function s(ae,ie){return ae===void 0&&(ae=""),t({type:"text",defaultValue:ae},ie)}e.Text=s;function u(ae,ie){var O=t({type:"color",defaultValue:ae},ie);return ie!=null&&ie.isExpanded&&(O.isExpanded=ie.isExpanded),O}e.Color=u;function l(ae,ie){var O;if(typeof ae=="string"){var V=Hs(ae);O={kind:V.type!=="qualitative"?"interpolate":"set",colors:V.list}}else O=ae;return t({type:"color-list",presetKind:(ie==null?void 0:ie.presetKind)||"all",defaultValue:O,offsets:!!(ie!=null&&ie.offsets)},ie)}e.ColorList=l;function c(ae,ie,O){return t(p({type:"vec3",defaultValue:ae},ie),O)}e.Vec3=c;function d(ae,ie){return t({type:"mat4",defaultValue:ae},ie)}e.Mat4=d;function f(ae,ie){var O=typeof ae=="string"?Pn.Url(ae):Pn.Url(ae.url,{body:ae.body}),V=t({type:"url",defaultValue:O},ie);return V}e.Url=f;function h(ae){var ie=t({type:"file",defaultValue:null},ae);return ae!=null&&ae.accept&&(ie.accept=ae.accept),ie}e.File=h;function v(ae){var ie=t({type:"file-list",defaultValue:null},ae);return ae!=null&&ae.accept&&(ie.accept=ae.accept),ie}e.FileList=v;function p(ae,ie){return ie&&(typeof ie.min<"u"&&(ae.min=ie.min),typeof ie.max<"u"&&(ae.max=ie.max),typeof ie.step<"u"&&(ae.step=ie.step)),ae}function g(ae,ie,O){var V=t(p({type:"number",defaultValue:ae},ie),O);return O!=null&&O.immediateUpdate&&(V.immediateUpdate=!0),V}e.Numeric=g;function m(ae,ie,O){return t(p({type:"interval",defaultValue:ae},ie),O)}e.Interval=m;function y(ae,ie){return t({type:"line-graph",defaultValue:ae},ie)}e.LineGraph=y;function b(ae,ie){var O=t({type:"group",defaultValue:(ie==null?void 0:ie.customDefault)||j(ae),params:ae},ie);return ie!=null&&ie.isExpanded&&(O.isExpanded=ie.isExpanded),ie!=null&&ie.isFlat&&(O.isFlat=ie.isFlat),ie!=null&&ie.pivot&&(O.pivot=ie.pivot),O}e.Group=b;function S(ae){return b({},ae)}e.EmptyGroup=S;function x(ae,ie,O,V){var ve=_e(ae,ie);return t({type:"mapped",defaultValue:{name:ve,params:O(ve).defaultValue},select:a(ve,ie,V),map:O},V)}e.Mapped=x;function C(ae,ie,O){var V=O!=null&&O.options?O.options:Object.keys(ie).map(function(Pe){return[Pe,ie[Pe].label||Yo(Pe)]}),ve=_e(ae,V);return t({type:"mapped",defaultValue:{name:ve,params:ie[ve].defaultValue},select:a(ve,V,O),map:function(Pe){return ie[Pe]}},O)}e.MappedStatic=C;function w(ae,ie,O){return t({type:"object-list",element:ae,getLabel:ie,ctor:A,defaultValue:(O==null?void 0:O.defaultValue)||[]},O)}e.ObjectList=w;function A(){return j(this.element)}function I(){throw new Error("getValue not set. Fix runtime.")}function D(ae,ie,O){var V;return t({type:"value-ref",defaultValue:{ref:(V=O==null?void 0:O.defaultRef)!==null&&V!==void 0?V:"",getValue:I},getOptions:ae,resolveRef:ie},O)}e.ValueRef=D;function k(ae){var ie;return t({type:"data-ref",defaultValue:{ref:(ie=ae==null?void 0:ae.defaultRef)!==null&&ie!==void 0?ie:"",getValue:I}},ae)}e.DataRef=k;function R(ae,ie,O){return{type:"converted",defaultValue:ie(O.defaultValue),converted:O,fromValue:ae,toValue:ie}}e.Converted=R;function L(ae,ie,O,V,ve){var Pe=Object.keys(ie).map(function(Me){return[Me,Me]});return t({type:"conditioned",select:a(O(ae),Pe,ve),defaultValue:ae,conditionParams:ie,conditionForValue:O,conditionedValue:V},ve)}e.Conditioned=L;function H(ae,ie){return t({type:"script",defaultValue:ae},ie)}e.Script=H;function B(ae){return 0}e.For=B;function j(ae){for(var ie={},O=0,V=Object.keys(ae);O<V.length;O++){var ve=V[O];ae[ve].isOptional||(ie[ve]=ae[ve].defaultValue)}return ie}e.getDefaultValues=j;function Q(ae,ie){return function(){return ae(ie)}}function G(ae,ie,O){if(ie){if(ae.type==="value-ref"){var V=ie;V.ref?V.getValue=Q(ae.resolveRef,V.ref):V.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ae.type==="data-ref"){var V=ie;V.ref?V.getValue=Q(O,V.ref):V.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ae.type==="group")J(ae.params,ie,O);else if(ae.type==="mapped"){var V=ie,ve=ae.map(V.name);G(ve,V.params,O)}else if(ae.type==="object-list"){if(!q(ae.element))return;for(var Pe=0,Me=ie;Pe<Me.length;Pe++){var Ge=Me[Pe];J(ae.element,Ge,O)}}}}function W(ae){if(ae.type==="value-ref"||ae.type==="data-ref")return!0;if(ae.type==="group"){if(q(ae.params))return!0}else if(ae.type==="mapped")for(var ie=0,O=ae.select.options;ie<O.length;ie++){var V=O[ie][0];if(W(ae.map(V)))return!0}else if(ae.type==="object-list")return q(ae.element);return!1}function q(ae){for(var ie=0,O=Object.keys(ae);ie<O.length;ie++){var V=O[ie];if(W(ae[V]))return!0}return!1}function J(ae,ie,O){for(var V=0,ve=Object.keys(ae);V<ve.length;V++){var Pe=ve[V];G(ae[Pe],ie==null?void 0:ie[Pe],O)}}e.resolveRefs=J;function he(ae,ie){for(var O=0,V=Object.keys(ae);O<V.length;O++){var ve=V[O];ae[ve].isOptional||(ae[ve].defaultValue=ie[ve])}}e.setDefaultValues=he;function $(ae){return Qf(ae)}e.clone=$;function X(ae,ie){}e.validate=X;function U(ae,ie,O){if(ie===O)return!0;if(typeof ie!="object"||typeof O!="object")return!1;for(var V=0,ve=Object.keys(ae);V<ve.length;V++){var Pe=ve[V];if(!z(ae[Pe],ie[Pe],O[Pe]))return!1}return!0}e.areEqual=U;function z(ae,ie,O){if(ie===O)return!0;if(ae.type==="group")return U(ae.params,ie,O);if(ae.type==="mapped"){var V=ie,ve=O;if(V.name!==ve.name)return!1;var Pe=ae.map(V.name);return z(Pe,V.params,ve.params)}else if(ae.type==="multi-select"){var V=ie,ve=O;if(V.length!==ve.length)return!1;if(V.length<10){for(var Me=0,Ge=V.length;Me<Ge;Me++)if(V[Me]!==ve[Me]&&ve.indexOf(V[Me])<0)return!1}else for(var $e=new Set(ve),Me=0,Ge=V.length;Me<Ge;Me++)if(V[Me]!==ve[Me]&&!$e.has(V[Me]))return!1;return!0}else{if(ae.type==="interval")return ie[0]===O[0]&&ie[1]===O[1];if(ae.type==="line-graph"){var V=ie,ve=O;if(V.length!==ve.length)return!1;for(var Me=0,Ge=V.length;Me<Ge;Me++)if(!Ke.areEqual(V[Me],ve[Me]))return!1;return!0}else{if(ae.type==="vec3")return _.equals(ie,O);if(ae.type==="mat4")return le.areEqual(ie,O,yn);if(ae.type==="script"){var V=ie,ve=O;return V.language===ve.language&&V.expression===ve.expression}else if(ae.type==="object-list"){var V=ie,ve=O,Ze=V.length;if(Ze!==ve.length)return!1;for(var Me=0;Me<Ze;Me++)if(!U(ae.element,V[Me],ve[Me]))return!1;return!0}else if(typeof ie=="object"&&typeof O=="object")return Cg(ie,O)}}return!1}e.isParamEqual=z;function ee(ae,ie,O){if(ie===void 0)return E({},O);if(O===void 0)return E({},ie);for(var V=Object.create(null),ve=0,Pe=Object.keys(ae);ve<Pe.length;ve++){var Me=Pe[ve];V[Me]=Y(ae[Me],ie[Me],O[Me])}return V}e.merge=ee;function Y(ae,ie,O){if(ie===void 0)return typeof O=="object"&&!Array.isArray(O)?E({},O):O;if(O===void 0)return typeof ie=="object"&&!Array.isArray(ie)?E({},ie):ie;if(ae.type==="group")return ee(ae.params,ie,O);if(ae.type==="mapped"){var V=ie,ve=O;if(V.name!==ve.name)return E({},ve);var Pe=ae.map(ve.name);return{name:ve.name,params:Y(Pe,V.params,ve.params)}}else return ae.type==="value"?O:typeof ie=="object"&&typeof O=="object"?Array.isArray(O)?O:E(E({},ie),O):O}e.mergeParam=Y;function Z(ae,ie){for(var O=0,V=ae.options;O<V.length;O++){var ve=V[O];if(ve[0]===ie)return!0}return!1}function te(ae,ie,O){if(ie==null)return O?ae.defaultValue:void 0;if(ae.type==="value")return ie;if(ae.type==="group"){for(var V=Object.create(null),ve=0,Pe=Object.keys(ae.params);ve<Pe.length;ve++){var Me=Pe[ve],Ge=ae.params[Me];ie[Me]===void 0?O&&(V[Me]=Ge.defaultValue):V[Me]=te(Ge,ie[Me],O)}return V}else if(ae.type==="mapped"){var $e=ie;if(typeof $e.name!="string")return ae.defaultValue;if(typeof $e.params>"u")return O?ae.defaultValue:void 0;if(!Z(ae.select,$e.name))return ae.defaultValue;var Ge=ae.map($e.name);return{name:$e.name,params:te(Ge,$e.params,O)}}else{if(ae.type==="select")return Z(ae,ie)?ie:ae.defaultValue;if(ae.type==="multi-select"){if(!Array.isArray(ie))return ae.defaultValue;var V=ie.filter(function(ht){return Z(this,ht)},ae);return ie.length>0&&V.length===0?ae.defaultValue:V}else if(ae.type==="object-list")return Array.isArray(ie)?ie.map(function(Ze){return ce(ae.element,Ze,O?"all":"skip")}):ae.defaultValue}return ie}function ce(ae,ie,O){if(typeof ie!="object"||ie===null)return O?j(ae):ie;for(var V=Object.create(null),ve=0,Pe=Object.keys(ae);ve<Pe.length;ve++){var Me=Pe[ve],Ge=ae[Me];ie[Me]===void 0?O==="all"&&(V[Me]=Ge.defaultValue):V[Me]=te(Ge,ie[Me],O!=="skip")}return V}e.normalizeParams=ce;function be(ae,ie){for(var O=[],V=0,ve=Object.keys(ae);V<ve.length;V++){var Pe=ve[V];if(!ie)typeof ae[Pe]=="string"?O.push([Pe,ae[Pe]]):O.push([Pe,ie===null?Pe:Yo(Pe)]);else{var Me=ie(Pe,ae[Pe]);O.push(typeof Me=="string"?[Pe,Me]:[Pe,Me[0],Me[1]])}}return O}e.objectToOptions=be;function xe(ae,ie){for(var O=[],V=0,ve=ae;V<ve.length;V++){var Pe=ve[V];ie?O.push([Pe,ie(Pe)]):O.push([Pe,ie===null?Pe:Yo(Pe)])}return O}e.arrayToOptions=xe;function Ie(ae,ie){for(var O=0,V=ae.options;O<V.length;O++){var ve=V[O];if(ve[0]===ie)return ve[1]}return""}e.optionLabel=Ie;function _e(ae,ie){for(var O=0,V=ie;O<V.length;O++){var ve=V[O];if(ve[0]===ae)return ae}return ie.length>0?ie[0][0]:void 0}})(T||(T={}));var Ao;(function(e){function t(a){var i={create:function(o){return{action:i,params:o}},id:pn.create22(),definition:a,createDefaultParams:function(o,s){return a.params?T.getDefaultValues(a.params(o,s)):{}}};return i}e.create=t;function r(a){var i=a.definition;return t({from:i.from,display:i.display,params:i.params,isApplicable:a.definition.isApplicable?function(o,s,u){return a.definition.isApplicable(o,u)}:void 0,run:function(o){var s=o.cell,u=o.state,l=o.params,c=u.build().to(s.transform.ref).apply(a,l);return u.updateTree(c)}})}e.fromTransformer=r;var n;(function(a){function i(o){return function(s){return t(E({from:o.from instanceof Array?o.from:o.from?[o.from]:[],display:typeof o.display=="string"?{name:o.display}:o.display?o.display:{name:"Unnamed State Action"},params:typeof o.params=="object"?function(){return o.params}:o.params?o.params:void 0,isApplicable:o.isApplicable},typeof s=="function"?{run:s}:s))}}a.build=function(o){return i(o)}})(n=e.Builder||(e.Builder={})),e.build=n.build})(Ao||(Ao={}));var vt;(function(e){function t(p,g,m){return p.definition.params?p.definition.params(g,m):{}}e.getParamDefinition=t;function r(p){return!!p&&typeof p.toAction=="function"&&typeof p.apply=="function"}e.is=r;var n;(function(p){p[p.Unchanged=0]="Unchanged",p[p.Updated=1]="Updated",p[p.Recreate=2]="Recreate",p[p.Null=3]="Null"})(n=e.UpdateResult||(e.UpdateResult={}));var a=new Map,i=new Map;function o(p){for(var g=0,m=p.definition.from;g<m.length;g++){var y=m[g];i.has(y.type)?i.get(y.type).push(p):i.set(y.type,[p])}}function s(){return Array.from(a.values())}e.getAll=s;function u(p){var g=a.get(p);if(!g)throw new Error("A transformer with signature '"+p+"' is not registered.");return g}e.get=u;function l(p){return i.get(p)||[]}e.fromType=l;function c(p,g){var m=g.name,y=p+"."+m;if(a.has(y))throw new Error("A transform with id '"+m+"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.");var b={apply:function(S,x,C){return cr.create(S,b,x,C)},toAction:function(){return Ao.fromTransformer(b)},namespace:p,id:y,definition:g,createDefaultParams:function(S,x){return g.params?T.getDefaultValues(g.params(S,x)):{}}};return a.set(y,b),o(b),b}e.create=c;function d(p){return function(g){return c(p,g)}}e.factory=d;function f(p){return h.build(p)}e.builderFactory=f;var h;(function(p){function g(y,b){return function(S){return c(y,E({name:b.name,from:b.from instanceof Array?b.from:[b.from],to:b.to instanceof Array?b.to:[b.to],display:typeof b.display=="string"?{name:b.display}:b.display?b.display:{name:qg(b.name.replace(/[-]/g," "))},params:typeof b.params=="object"?function(){return b.params}:b.params?b.params:void 0,isDecorator:b.isDecorator},S))}}function m(y){return function(b){return g(y,b)}}p.build=m})(h=e.Builder||(e.Builder={}));function v(p){return h.build(p)}e.build=v,e.ROOT=c("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return n.Unchanged}})})(vt||(vt={}));var cr;(function(e){e.RootRef="-=root=-";function t(g,m){return!!g.isHidden!=!!m.isHidden||!!g.isCollapsed!=!!m.isCollapsed||!!g.isGhost!=!!m.isGhost||!!g.isLocked!=!!m.isLocked}e.areStatesEqual=t;function r(g,m){return m?typeof m.isCollapsed<"u"&&g.isCollapsed!==m.isCollapsed||typeof m.isHidden<"u"&&g.isHidden!==m.isHidden||typeof m.isGhost<"u"&&g.isGhost!==m.isGhost||typeof m.isLocked<"u"&&g.isLocked!==m.isLocked:!1}e.isStateChange=r;function n(g,m){if(!m)return!1;for(var y=!1,b=0,S=Object.keys(m);b<S.length;b++){var x=S[b],C=m[x],w=g[x];!!C!=!!w&&(y=!0,g[x]=C)}return y}e.assignState=n;function a(g,m){if(!m)return!1;for(var y=!1,b=0,S=Object.keys(m);b<S.length;b++){var x=S[b],C=m[x],w=g[x];!!C!=!!w&&(y=!0,g[x]=C)}for(var A=0,I=Object.keys(g);A<I.length;A++){var x=I[A],C=m[x],w=g[x];!!C!=!!w&&(y=!0,g[x]=C)}return y}e.syncState=a;function i(g,m,y,b){var S=b&&b.ref?b.ref:pn.create22(),x=void 0;return b&&b.tags&&(x=typeof b.tags=="string"?[b.tags]:b.tags,x.length===0?x=void 0:x.sort()),{parent:g,transformer:m,state:(b==null?void 0:b.state)||{},tags:x,ref:S,dependsOn:b&&b.dependsOn,params:y,version:pn.create22()}}e.create=i;function o(g,m){return E(E({},g),{params:m,version:pn.create22()})}e.withParams=o;function s(g,m){return m?E(E({},g),{state:E(E({},g.state),m)}):g}e.withState=s;function u(g,m){var y=void 0;return m&&(y=typeof m=="string"?[m]:m,y.length===0?y=void 0:y.sort()),E(E({},g),{tags:y,version:pn.create22()})}e.withTags=u;function l(g,m){return E(E({},g),{parent:m,version:pn.create22()})}e.withParent=l;function c(g){return i(e.RootRef,vt.ROOT,{},{ref:e.RootRef,state:g})}e.createRoot=c;function d(g,m){return g.tags?g.tags.indexOf(m)>=0:!1}e.hasTag=d;function f(g,m){if(!g.tags)return typeof m!="string"&&m.length===0;if(typeof m=="string")return d(g,m);for(var y=0,b=m;y<b.length;y++){var S=b[y];if(g.tags.indexOf(S)<0)return!1}return!0}e.hasTags=f;function h(g){return g}function v(g){for(var m=g.transformer.definition.customSerialization?g.transformer.definition.customSerialization.toJSON:h,y=void 0,b=0,S=Object.keys(g.state);b<S.length;b++){var x=S[b],C=g.state[x];C&&(y||(y={}),y[x]=!0)}return{parent:g.parent,transformer:g.transformer.id,params:g.params?m(g.params):void 0,state:y,tags:g.tags,ref:g.ref,dependsOn:g.dependsOn,version:g.version}}e.toJSON=v;function p(g){var m=vt.get(g.transformer),y=m.definition.customSerialization?m.definition.customSerialization.fromJSON:h;return{parent:g.parent,transformer:m,params:g.params?y(g.params):void 0,state:g.state||{},tags:g.tags,ref:g.ref,dependsOn:g.dependsOn,version:g.version}}e.fromJSON=p})(cr||(cr={}));function Ml(e){for(var t=-1/0,r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function d3(e){for(var t=1/0,r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function Bo(e){for(var t=1/0,r=-1/0,n=0,a=e.length;n<a;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function Yy(e,t,r){t===void 0&&(t=1),r===void 0&&(r=0);for(var n=e.length,a=0,i=r;i<n;i+=t)a+=e[i];return a}function f3(e,t,r){return t===void 0&&(t=1),r===void 0&&(r=0),Yy(e,t,r)/(e.length/t)}function h3(e){for(var t=e.length,r=0,n=0;n<t;++n){var a=e[n];r+=a*a}return Math.sqrt(r/t)}function Ws(e,t){for(var r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function H1(e,t){for(var r=0,n=e.length,a=!1;r<n;r++)if(e[r]===t){a=!0;break}return a?(G1(e,r),!0):!1}function G1(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function Di(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function yp(e,t){var r=e.indexOf(t);if(r<0)return!1;for(var n=r,a=e.length-1;n<a;n++)e[n]=e[n+1];return e.pop(),!0}function jC(e,t){for(var r=0,n=0,a=e.length;n<a;++n)t.includes(e[n])&&(r+=1);return r}function gk(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function eEe(e){for(var t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function tEe(e,t,r){for(var n=0,a=e.length;n<a;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}var rEe=function(){function e(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependencyMutations",{get:function(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)},enumerable:!1,configurable:!0}),e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},e.prototype.changeDependencies=function(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(cr.RootRef)},enumerable:!1,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{var n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.removeChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{var n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.clearRoot=function(){var t=cr.RootRef;if(this.children.get(t).size!==0){this.changeChildren();var r=ia.OrderedSet();this.children.set(t,r),this.childMutations.set(t,r)}},e.prototype.mutateDependency=function(t,r,n){var a=this.dependencyMutations.get(t);if(!a){var i=this.dependencies.get(t);if(!i&&n==="remove")return;this.changeDependencies(),a=i?i.asMutable():ia.OrderedSet().asMutable(),this.dependencyMutations.set(t,a),this.dependencies.set(t,a)}n==="add"?a.add(r):a.remove(r)},e.prototype.changeParent=function(t,r){U2(this.transforms,t);var n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,cr.withParent(n,r))},e.prototype.add=function(t){var r=t.ref;if(this.transforms.has(t.ref)){var n=this.transforms.get(t.ref);n.parent!==t.parent&&iEe(t.ref)}var a=this.children.get(t.parent);if(a||oEe(t.parent),a.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,ia.OrderedSet())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(var i=0,o=t.dependsOn;i<o.length;i++){var s=o[i];this.mutateDependency(s,r,"add")}return this},e.prototype.setParams=function(t,r){U2(this.transforms,t);var n=this.transforms.get(t);return fk(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,cr.withParams(n,r)),!0)},e.prototype.setTags=function(t,r){U2(this.transforms,t);var n=this.transforms.get(t),a=cr.withParams(n,r);return gk(n.tags,a.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,a),!0)},e.prototype.assignState=function(t,r){U2(this.transforms,t);var n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return cr.assignState(n.state,r),n;this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();var a=cr.withState(n,r);return this.transforms.set(t,a),a},e.prototype.remove=function(t){var r=this.transforms.get(t);if(!r)return[];var n=sa.subtreePostOrder(this,r);if(t===cr.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(var a=0,i=n;a<i.length;a++){var o=i[a];this.transforms.delete(o.ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref)}for(var s=[],u=0,l=n;u<l.length;u++){var o=l[u];if(o.dependsOn)for(var c=0,d=o.dependsOn;c<d.length;c++){var f=d[c];this.transforms.has(f)&&this.mutateDependency(f,o.ref,"remove")}if(this.dependencies.has(o.ref)){var h=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(var v=0,p=h;v<p.length;v++){var g=p[v];if(this.transforms.has(g))for(var m=0,y=this.remove(g);m<y.length;m++){var b=y[m];s[s.length]=b}}}}for(var S=0,x=s;S<x.length;S++){var g=x[S];n[n.length]=g}return n},e.prototype.asImmutable=function(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(nEe,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(aEe,this.dependencies),sa.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))},e}();function nEe(e,t){this.set(t,e.asImmutable())}function aEe(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function iEe(e){throw new Error("Transform '"+e+"' is already present in the tree.")}function oEe(e){throw new Error("Parent '"+e+"' must be present in the tree.")}function U2(e,t){if(!e.has(t))throw new Error("Node '"+t+"' is not present in the tree.")}var sa;(function(e){var t=function(){function b(S,x,C){this.transforms=S,this.children=x,this.dependencies=C}return Object.defineProperty(b.prototype,"root",{get:function(){return this.transforms.get(cr.RootRef)},enumerable:!1,configurable:!0}),b.prototype.asTransient=function(){return new rEe(this)},b}();function r(b){var S=b||cr.createRoot();return n(ia.Map([[S.ref,S]]),ia.Map([[S.ref,ia.OrderedSet()]]),ia.Map())}e.createEmpty=r;function n(b,S,x){return new t(b,S,x)}e.create=n;function a(b){i(this,this.tree.transforms.get(b))}function i(b,S){var x=b.tree.children.get(S.ref);x&&x.size&&x.forEach(a,b),b.f(S,b.tree,b.state)}function o(b,S,x,C){var w={tree:b,state:x,f:C};return i(w,S),w.state}e.doPostOrder=o;function s(b){u(this,this.tree.transforms.get(b))}function u(b,S){var x=b.f(S,b.tree,b.state);if(!(typeof x=="boolean"&&!x)){var C=b.tree.children.get(S.ref);C&&C.size&&C.forEach(s,b)}}function l(b,S,x,C){var w={tree:b,state:x,f:C};return u(w,S),w.state}e.doPreOrder=l;function c(b,S,x){x.push(b)}function d(b,S){return o(b,S,[],c)}e.subtreePostOrder=d;function f(b,S,x){x.push(cr.toJSON(b))}function h(b){var S=[];return l(b,b.root,S,f),{transforms:S}}e.toJSON=h;function v(b){for(var S=ia.Map().asMutable(),x=ia.Map().asMutable(),C=ia.Map().asMutable(),w=0,A=b.transforms;w<A.length;w++){var I=A[w],D=cr.fromJSON(I);S.set(D.ref,D),x.has(D.ref)||x.set(D.ref,ia.OrderedSet().asMutable()),D.ref!==D.parent&&x.get(D.parent).add(D.ref)}for(var k=new Set,R=0,L=b.transforms;R<L.length;R++){var I=L[R],H=I.ref;if(x.set(H,x.get(H).asImmutable()),!!I.dependsOn)for(var B=0,j=I.dependsOn;B<j.length;B++){var Q=j[B];k.add(Q),C.has(Q)?C.get(Q).add(H):C.set(Q,ia.OrderedSet([H]).asMutable())}}return k.forEach(function(G){C.set(G,C.get(G).asImmutable())}),n(S.asImmutable(),x.asImmutable(),C.asImmutable())}e.fromJSON=v;function p(b){console.log({tr:b.transforms.keySeq().toArray(),tr1:b.transforms.valueSeq().toArray().map(function(S){return S.ref}),ch:b.children.keySeq().toArray()})}e.dump=p;function g(b,S,x){if(S===x)return!0;for(var C=b.children.get(S),w=C.values();;){var A=w.next();if(A.done)return!1;if(g(b,A.value,x))return!0}}function m(b,S,x){return!b.transforms.has(S)||!b.transforms.has(x)?!1:g(b,S,x)}e.subtreeHasRef=m;function y(b,S){var x=b.children.get(S);if(x.size!==1)return S;var C=b.transforms.get(x.first());return C.transformer.definition.isDecorator?y(b,C.ref):S}e.getDecoratorRoot=y})(sa||(sa={}));var ir;(function(e){function t(U,z){return r(U)(z)}e.select=t;function r(U){var z=U||l.root,ee;return a(z)?ee=z.compile():n(z)?ee=l.byValue(z).compile():i(z)?ee=z:ee=l.byRef(z).compile(),ee}e.compile=r;function n(U){return U.transform!==void 0&&U.status!==void 0}function a(U){return U.compile!==void 0}function i(U){return typeof U=="function"}var o={select:function(U){return t(this,U||this.state)}};function s(U,z){o[U]=function(){for(var ee=[],Y=0;Y<arguments.length;Y++)ee[Y]=arguments[Y];return z.call.apply(z,Ut([void 0,this],ee))}}function u(U){return Object.create(o,{compile:{writable:!1,configurable:!1,value:U}})}var l;(function(U){U.root=u(function(){return function(ae){return[ae.cells.get(ae.tree.root.ref)]}});function z(){for(var ae=[],ie=0;ie<arguments.length;ie++)ae[ie]=arguments[ie];return u(function(){return function(O){for(var V=[],ve=0,Pe=ae;ve<Pe.length;ve++){var Me=Pe[ve],Ge=O.cells.get(Me);Ge&&V.push(Ge)}return V}})}U.byRef=z;function ee(){for(var ae=[],ie=0;ie<arguments.length;ie++)ae[ie]=arguments[ie];return u(function(){return function(O){return ae}})}U.byValue=ee;function Y(ae,ie){return ie===void 0&&(ie=cr.RootRef),u(function(){return function(O){var V={roots:[],cells:O.cells,type:ae.type};return sa.doPreOrder(O.tree,O.tree.transforms.get(ie),V,be),V.roots}})}U.rootsOfType=Y;function Z(ae,ie){return ie===void 0&&(ie=cr.RootRef),u(function(){return function(O){var V={ret:[],cells:O.cells,type:ae.type};return sa.doPreOrder(O.tree,O.tree.transforms.get(ie),V,xe),V.ret}})}U.ofType=Z;function te(ae,ie){return ie===void 0&&(ie=cr.RootRef),u(function(){return function(O){var V={ret:[],cells:O.cells,t:ae};return sa.doPreOrder(O.tree,O.tree.transforms.get(ie),V,Ie),V.ret}})}U.ofTransformer=te;function ce(ae,ie){return ie===void 0&&(ie=cr.RootRef),u(function(){return function(O){var V={ret:[],cells:O.cells,t:ae};return sa.doPreOrder(O.tree,O.tree.transforms.get(ie),V,_e),V.ret}})}U.ofTransformerWithError=ce;function be(ae,ie,O){var V=O.cells.get(ae.ref);return V&&V.obj&&V.obj.type===O.type?(O.roots.push(V),!1):!0}function xe(ae,ie,O){var V=O.cells.get(ae.ref);return V&&V.obj&&V.obj.type===O.type&&O.ret.push(V),!0}function Ie(ae,ie,O){var V=O.cells.get(ae.ref);return V&&V.obj&&V.transform.transformer===O.t&&O.ret.push(V),!0}function _e(ae,ie,O){var V=O.cells.get(ae.ref);return V&&V.status==="error"&&V.transform.transformer===O.t&&O.ret.push(V),!0}})(l=e.Generators||(e.Generators={})),s("flatMap",c);function c(U,z){var ee=r(U);return u(function(){return function(Y){for(var Z=[],te=0,ce=ee(Y);te<ce.length;te++)for(var be=ce[te],xe=0,Ie=z(be,Y);xe<Ie.length;xe++){var _e=Ie[xe];Z.push(_e)}return Z}})}e.flatMap=c,s("mapObject",d);function d(U,z){var ee=r(U);return u(function(){return function(Y){for(var Z=[],te=0,ce=ee(Y);te<ce.length;te++){var be=ce[te],xe=z(be,Y);xe&&Z.push(xe)}return Z}})}e.mapObject=d,s("unique",f);function f(U){var z=r(U);return u(function(){return function(ee){for(var Y=new Set,Z=[],te=0,ce=z(ee);te<ce.length;te++){var be=ce[te];be&&(Y.has(be.transform.ref)||(Y.add(be.transform.ref),Z.push(be)))}return Z}})}e.unique=f,s("first",h);function h(U){var z=r(U);return u(function(){return function(ee){var Y=z(ee);return Y.length?[Y[0]]:[]}})}e.first=h,s("filter",v);function v(U,z){return c(U,function(ee){return z(ee)?[ee]:[]})}e.filter=v,s("withStatus",p);function p(U,z){return v(U,function(ee){return ee.status===z})}e.withStatus=p,s("withTag",g);function g(U,z){return v(U,function(ee){return!!ee.transform.tags&&ee.transform.tags.indexOf(z)>=0})}e.withTag=g,s("subtree",m);function m(U){return c(U,function(z,ee){var Y=[];return sa.doPreOrder(ee.tree,ee.tree.transforms.get(z.transform.ref),Y,function(Z,te,ce){ce.push(Z.ref)}),Y.map(function(Z){return ee.cells.get(Z)})})}e.subtree=m,s("children",y);function y(U){return c(U,function(z,ee){var Y=[];return ee.tree.children.get(z.transform.ref).forEach(function(Z){return Y.push(ee.cells.get(Z))}),Y})}e.children=y,s("ofType",b);function b(U,z){return v(U,function(ee){return ee.obj?ee.obj.type===z.type:!1})}e.ofType=b,s("ancestor",S);function S(U,z){return f(d(U,function(ee,Y){return R(Y.tree,Y.cells,ee.transform.ref,z)}))}e.ancestor=S,s("ancestorOfType",x);function x(U,z){return f(d(U,function(ee,Y){return B(Y.tree,Y.cells,ee.transform.ref,z)}))}e.ancestorOfType=x,s("ancestorWithTransformer",C);function C(U,z){return f(d(U,function(ee,Y){return H(Y.tree,Y.cells,ee.transform.ref,z)}))}e.ancestorWithTransformer=C,s("withTransformer",w);function w(U,z){return v(U,function(ee){return ee.transform.transformer===z})}e.withTransformer=w,s("root",A);function A(U,z){return f(d(U,function(ee,Y){return L(Y.tree,Y.cells,ee.transform.ref,z)}))}e.root=A,s("rootOfType",I);function I(U,z){return f(d(U,function(ee,Y){return j(Y.tree,Y.cells,ee.transform.ref,z)}))}e.rootOfType=I,s("parent",D);function D(U){return f(d(U,function(z,ee){return ee.cells.get(ee.tree.transforms.get(z.transform.ref).parent)}))}e.parent=D;function k(U,z,ee,Y,Z){for(var te=U.transforms.get(ee),ce=void 0;;){te=U.transforms.get(te.parent);var be=z.get(te.ref);if(be.obj&&Y(be)&&(ce=be,Z)||te.ref===cr.RootRef)return ce}}function R(U,z,ee,Y){return k(U,z,ee,Y,!0)}e.findAncestor=R;function L(U,z,ee,Y){return k(U,z,ee,Y,!1)}e.findRoot=L;function H(U,z,ee,Y){return R(U,z,ee,Array.isArray(Y)?function(Z){return Y.indexOf(Z.transform.transformer)>=0}:function(Z){return Z.transform.transformer===Y})}e.findAncestorWithTransformer=H;function B(U,z,ee,Y){return R(U,z,ee,Q(Y))}e.findAncestorOfType=B;function j(U,z,ee,Y){return L(U,z,ee,Q(Y))}e.findRootOfType=j;function Q(U){return Array.isArray(U)?function(z){for(var ee=0,Y=U;ee<Y.length;ee++){var Z=Y[ee];if(Z.type===z.obj.type)return!0}}:function(z){return z.obj.type===U.type}}function G(U,z,ee){return sa.doPreOrder(U,U.transforms.get(z),{refs:{},tags:ee},W).refs}e.findUniqueTagsInSubtree=G;function W(U,z,ee){if(U.tags)for(var Y=0,Z=U.tags;Y<Z.length;Y++){var te=Z[Y];if(ee.tags.has(te)){ee.refs[te]=U.ref;break}}return!0}function q(U,z,ee){return sa.doPreOrder(U,U.transforms.get(z),{ref:void 0,tag:ee},J).ref}e.findTagInSubtree=q;function J(U,z,ee){return U.tags&&U.tags.indexOf(ee.tag)>=0?(ee.ref=U.ref,!1):!0}function he(U,z,ee){return sa.doPreOrder(U,U.transforms.get(z),{refs:[],tags:ee},$).refs}e.findWithAllTags=he;function $(U,z,ee){if(U.tags)for(var Y=ee.tags.size,Z=0,te=0,ce=U.tags;te<ce.length;te++){var be=ce[te];if(ee.tags.has(be)&&(Z++,Z===Y)){ee.refs.push(U);break}}else ee.tags.size===0&&ee.refs.push(U)}function X(U,z,ee){var Y=U.transforms.get(z);if(Y.transformer===ee)return U.cells.get(z);var Z=U.tree.children.get(z);if(Z.size===1){var te=Z.first();if(U.transforms.get(te).transformer.definition.isDecorator)return X(U,te,ee)}}e.tryFindDecorator=X})(ir||(ir={}));/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var hM=function(e,t){return hM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)n.hasOwnProperty(a)&&(r[a]=n[a])},hM(e,t)};function yi(e,t){hM(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function pM(e){return typeof e=="function"}var R8=!1,dl={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;""+t.stack}R8=e},get useDeprecatedSynchronousErrorHandling(){return R8}};function Pm(e){setTimeout(function(){throw e},0)}var zC={closed:!0,next:function(e){},error:function(e){if(dl.useDeprecatedSynchronousErrorHandling)throw e;Pm(e)},complete:function(){}},sEe=function(){return Array.isArray||function(e){return e&&typeof e.length=="number"}}();function oY(e){return e!==null&&typeof e=="object"}var uEe=function(){function e(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return e.prototype=Object.create(Error.prototype),e}(),vS=uEe,Dl=function(){function e(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r=this,n=r._parentOrParents,a=r._ctorUnsubscribe,i=r._unsubscribe,o=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(n!==null)for(var s=0;s<n.length;++s){var u=n[s];u.remove(this)}if(pM(i)){a&&(this._unsubscribe=void 0);try{i.call(this)}catch(d){t=d instanceof vS?k8(d.errors):[d]}}if(sEe(o))for(var s=-1,l=o.length;++s<l;){var c=o[s];if(oY(c))try{c.unsubscribe()}catch(f){t=t||[],f instanceof vS?t=t.concat(k8(f.errors)):t.push(f)}}if(t)throw new vS(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case"function":r=new e(t);case"object":if(r===this||r.closed||typeof r.unsubscribe!="function")return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;r=new e,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=r._parentOrParents;if(a===null)r._parentOrParents=this;else if(a instanceof e){if(a===this)return r;r._parentOrParents=[a,this]}else if(a.indexOf(this)===-1)a.push(this);else return r;var i=this._subscriptions;return i===null?this._subscriptions=[r]:i.push(r),r},e.prototype.remove=function(t){var r=this._subscriptions;if(r){var n=r.indexOf(t);n!==-1&&r.splice(n,1)}},e.EMPTY=function(t){return t.closed=!0,t}(new e),e}();function k8(e){return e.reduce(function(t,r){return t.concat(r instanceof vS?r.errors:r)},[])}var VC=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),Us=function(e){yi(t,e);function t(r,n,a){var i=e.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=zC;break;case 1:if(!r){i.destination=zC;break}if(typeof r=="object"){r instanceof t?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new O8(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new O8(i,r,n,a);break}return i}return t.prototype[VC]=function(){return this},t.create=function(r,n,a){var i=new t(r,n,a);return i.syncErrorThrowable=!1,i},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){this.destination.error(r),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var r=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=r,this},t}(Dl),O8=function(e){yi(t,e);function t(r,n,a,i){var o=e.call(this)||this;o._parentSubscriber=r;var s,u=o;return pM(n)?s=n:n&&(s=n.next,a=n.error,i=n.complete,n!==zC&&(u=Object.create(n),pM(u.unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(o))),o._context=u,o._next=s,o._error=a,o._complete=i,o}return t.prototype.next=function(r){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!dl.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,r):this.__tryOrSetError(n,this._next,r)&&this.unsubscribe()}},t.prototype.error=function(r){if(!this.isStopped){var n=this._parentSubscriber,a=dl.useDeprecatedSynchronousErrorHandling;if(this._error)!a||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,r),this.unsubscribe()):(this.__tryOrSetError(n,this._error,r),this.unsubscribe());else if(n.syncErrorThrowable)a?(n.syncErrorValue=r,n.syncErrorThrown=!0):Pm(r),this.unsubscribe();else{if(this.unsubscribe(),a)throw r;Pm(r)}}},t.prototype.complete=function(){var r=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var a=function(){return r._complete.call(r._context)};!dl.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(a),this.unsubscribe()):(this.__tryOrSetError(n,a),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(r,n){try{r.call(this._context,n)}catch(a){if(this.unsubscribe(),dl.useDeprecatedSynchronousErrorHandling)throw a;Pm(a)}},t.prototype.__tryOrSetError=function(r,n,a){if(!dl.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,a)}catch(i){return dl.useDeprecatedSynchronousErrorHandling?(r.syncErrorValue=i,r.syncErrorThrown=!0,!0):(Pm(i),!0)}return!1},t.prototype._unsubscribe=function(){var r=this._parentSubscriber;this._context=null,this._parentSubscriber=null,r.unsubscribe()},t}(Us);function lEe(e){for(;e;){var t=e,r=t.closed,n=t.destination,a=t.isStopped;if(r||a)return!1;n&&n instanceof Us?e=n:e=null}return!0}function cEe(e,t,r){if(e){if(e instanceof Us)return e;if(e[VC])return e[VC]()}return!e&&!t&&!r?new Us(zC):new Us(e,t,r)}var Ib=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function sY(e){return e}function dEe(e){return e.length===0?sY:e.length===1?e[0]:function(r){return e.reduce(function(n,a){return a(n)},r)}}var es=function(){function e(t){this._isScalar=!1,t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var a=this.operator,i=cEe(t,r,n);if(a?i.add(a.call(i,this.source)):i.add(this.source||dl.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),dl.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){dl.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),lEe(t)?t.error(r):console.warn(r)}},e.prototype.forEach=function(t,r){var n=this;return r=L8(r),new r(function(a,i){var o;o=n.subscribe(function(s){try{t(s)}catch(u){i(u),o&&o.unsubscribe()}},i,a)})},e.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},e.prototype[Ib]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.length===0?this:dEe(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=L8(t),new t(function(n,a){var i;r.subscribe(function(o){return i=o},function(o){return a(o)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function L8(e){if(e||(e=Promise),!e)throw new Error("no Promise impl found");return e}var fEe=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),om=fEe,hEe=function(e){yi(t,e);function t(r,n){var a=e.call(this)||this;return a.subject=r,a.subscriber=n,a.closed=!1,a}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var r=this.subject,n=r.observers;if(this.subject=null,!(!n||n.length===0||r.isStopped||r.closed)){var a=n.indexOf(this.subscriber);a!==-1&&n.splice(a,1)}}},t}(Dl),pEe=function(e){yi(t,e);function t(r){var n=e.call(this,r)||this;return n.destination=r,n}return t}(Us),ta=function(e){yi(t,e);function t(){var r=e.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype[VC]=function(){return new pEe(this)},t.prototype.lift=function(r){var n=new N8(this,this);return n.operator=r,n},t.prototype.next=function(r){if(this.closed)throw new om;if(!this.isStopped)for(var n=this.observers,a=n.length,i=n.slice(),o=0;o<a;o++)i[o].next(r)},t.prototype.error=function(r){if(this.closed)throw new om;this.hasError=!0,this.thrownError=r,this.isStopped=!0;for(var n=this.observers,a=n.length,i=n.slice(),o=0;o<a;o++)i[o].error(r);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new om;this.isStopped=!0;for(var r=this.observers,n=r.length,a=r.slice(),i=0;i<n;i++)a[i].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(r){if(this.closed)throw new om;return e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){if(this.closed)throw new om;return this.hasError?(r.error(this.thrownError),Dl.EMPTY):this.isStopped?(r.complete(),Dl.EMPTY):(this.observers.push(r),new hEe(this,r))},t.prototype.asObservable=function(){var r=new es;return r.source=this,r},t.create=function(r,n){return new N8(r,n)},t}(es),N8=function(e){yi(t,e);function t(r,n){var a=e.call(this)||this;return a.destination=r,a.source=n,a}return t.prototype.next=function(r){var n=this.destination;n&&n.next&&n.next(r)},t.prototype.error=function(r){var n=this.destination;n&&n.error&&this.destination.error(r)},t.prototype.complete=function(){var r=this.destination;r&&r.complete&&this.destination.complete()},t.prototype._subscribe=function(r){var n=this.source;return n?this.source.subscribe(r):Dl.EMPTY},t}(ta),_f=function(e){yi(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return n&&!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new om;return this._value},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(ta),vEe=function(e){yi(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(Dl),mEe=function(e){yi(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.scheduler=r,a.work=n,a.pending=!1,a}return t.prototype.schedule=function(r,n){if(n===void 0&&(n=0),this.closed)return this;this.state=r;var a=this.id,i=this.scheduler;return a!=null&&(this.id=this.recycleAsyncId(i,a,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(i,this.id,n),this},t.prototype.requestAsyncId=function(r,n,a){return a===void 0&&(a=0),setInterval(r.flush.bind(r,this),a)},t.prototype.recycleAsyncId=function(r,n,a){if(a===void 0&&(a=0),a!==null&&this.delay===a&&this.pending===!1)return n;clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var a=this._execute(r,n);if(a)return a;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var a=!1,i=void 0;try{this.work(r)}catch(o){a=!0,i=!!o&&o||new Error(o)}if(a)return this.unsubscribe(),i},t.prototype._unsubscribe=function(){var r=this.id,n=this.scheduler,a=n.actions,i=a.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,i!==-1&&a.splice(i,1),r!=null&&(this.id=this.recycleAsyncId(n,r,null)),this.delay=null},t}(vEe),F8=function(){function e(t,r){r===void 0&&(r=e.now),this.SchedulerAction=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.SchedulerAction(this,t).schedule(n,r)},e.now=function(){return Date.now()},e}(),gEe=function(e){yi(t,e);function t(r,n){n===void 0&&(n=F8.now);var a=e.call(this,r,function(){return t.delegate&&t.delegate!==a?t.delegate.now():n()})||this;return a.actions=[],a.active=!1,a.scheduled=void 0,a}return t.prototype.schedule=function(r,n,a){return n===void 0&&(n=0),t.delegate&&t.delegate!==this?t.delegate.schedule(r,n,a):e.prototype.schedule.call(this,r,n,a)},t.prototype.flush=function(r){var n=this.actions;if(this.active){n.push(r);return}var a;this.active=!0;do if(a=r.execute(r.state,r.delay))break;while(r=n.shift());if(this.active=!1,a){for(;r=n.shift();)r.unsubscribe();throw a}},t}(F8),yEe=new es(function(e){return e.complete()});function bEe(e){return e?xEe(e):yEe}function xEe(e){return new es(function(t){return e.schedule(function(){return t.complete()})})}function SEe(e){return e&&typeof e.schedule=="function"}var uY=function(e){return function(t){for(var r=0,n=e.length;r<n&&!t.closed;r++)t.next(e[r]);t.complete()}};function lY(e,t){return new es(function(r){var n=new Dl,a=0;return n.add(t.schedule(function(){if(a===e.length){r.complete();return}r.next(e[a++]),r.closed||n.add(this.schedule())})),n})}function CEe(e,t){return t?lY(e,t):new es(uY(e))}var _Ee=new gEe(mEe),wEe=_Ee,EEe=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),AEe=EEe;function PEe(e,t){return function(n){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new TEe(e,t))}}var TEe=function(){function e(t,r){this.project=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new IEe(t,this.project,this.thisArg))},e}(),IEe=function(e){yi(t,e);function t(r,n,a){var i=e.call(this,r)||this;return i.project=n,i.count=0,i.thisArg=a||i,i}return t.prototype._next=function(r){var n;try{n=this.project.call(this.thisArg,r,this.count++)}catch(a){this.destination.error(a);return}this.destination.next(n)},t}(Us),MEe=function(e){return function(t){return e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,Pm),t}};function DEe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var p3=DEe(),REe=function(e){return function(t){var r=e[p3]();do{var n=void 0;try{n=r.next()}catch(a){return t.error(a),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}while(!0);return typeof r.return=="function"&&t.add(function(){r.return&&r.return()}),t}},kEe=function(e){return function(t){var r=e[Ib]();if(typeof r.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)}},cY=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function dY(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}var fY=function(e){if(e&&typeof e[Ib]=="function")return kEe(e);if(cY(e))return uY(e);if(dY(e))return MEe(e);if(e&&typeof e[p3]=="function")return REe(e);var t=oY(e)?"an invalid object":"'"+e+"'",r="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(r)};function OEe(e,t){return new es(function(r){var n=new Dl;return n.add(t.schedule(function(){var a=e[Ib]();n.add(a.subscribe({next:function(i){n.add(t.schedule(function(){return r.next(i)}))},error:function(i){n.add(t.schedule(function(){return r.error(i)}))},complete:function(){n.add(t.schedule(function(){return r.complete()}))}}))})),n})}function LEe(e,t){return new es(function(r){var n=new Dl;return n.add(t.schedule(function(){return e.then(function(a){n.add(t.schedule(function(){r.next(a),n.add(t.schedule(function(){return r.complete()}))}))},function(a){n.add(t.schedule(function(){return r.error(a)}))})})),n})}function NEe(e,t){if(!e)throw new Error("Iterable cannot be null");return new es(function(r){var n=new Dl,a;return n.add(function(){a&&typeof a.return=="function"&&a.return()}),n.add(t.schedule(function(){a=e[p3](),n.add(t.schedule(function(){if(!r.closed){var i,o;try{var s=a.next();i=s.value,o=s.done}catch(u){r.error(u);return}o?r.complete():(r.next(i),this.schedule())}}))})),n})}function FEe(e){return e&&typeof e[Ib]=="function"}function BEe(e){return e&&typeof e[p3]=="function"}function UEe(e,t){if(e!=null){if(FEe(e))return OEe(e,t);if(dY(e))return LEe(e,t);if(cY(e))return lY(e,t);if(BEe(e)||typeof e=="string")return NEe(e,t)}throw new TypeError((e!==null&&typeof e||e)+" is not observable")}function jEe(e,t){return t?UEe(e,t):e instanceof es?e:new es(fY(e))}var zEe=function(e){yi(t,e);function t(r){var n=e.call(this)||this;return n.parent=r,n}return t.prototype._next=function(r){this.parent.notifyNext(r)},t.prototype._error=function(r){this.parent.notifyError(r),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(Us),VEe=function(e){yi(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyError=function(r){this.destination.error(r)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(Us);function HEe(e,t){if(!t.closed){if(e instanceof es)return e.subscribe(t);var r;try{r=fY(e)(t)}catch(n){t.error(n)}return r}}function hY(e,t,r){return r===void 0&&(r=Number.POSITIVE_INFINITY),typeof t=="function"?function(n){return n.pipe(hY(function(a,i){return jEe(e(a,i)).pipe(PEe(function(o,s){return t(a,o,i,s)}))},r))}:(typeof t=="number"&&(r=t),function(n){return n.lift(new GEe(e,r))})}var GEe=function(){function e(t,r){r===void 0&&(r=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=r}return e.prototype.call=function(t,r){return r.subscribe(new qEe(t,this.project,this.concurrent))},e}(),qEe=function(e){yi(t,e);function t(r,n,a){a===void 0&&(a=Number.POSITIVE_INFINITY);var i=e.call(this,r)||this;return i.project=n,i.concurrent=a,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return t.prototype._next=function(r){this.active<this.concurrent?this._tryNext(r):this.buffer.push(r)},t.prototype._tryNext=function(r){var n,a=this.index++;try{n=this.project(r,a)}catch(i){this.destination.error(i);return}this.active++,this._innerSub(n)},t.prototype._innerSub=function(r){var n=new zEe(this),a=this.destination;a.add(n);var i=HEe(r,n);i!==n&&a.add(i)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyComplete=function(){var r=this.buffer;this.active--,r.length>0?this._next(r.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(VEe);function WEe(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),hY(sY,e)}function fc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Number.POSITIVE_INFINITY,n=null,a=e[e.length-1];return SEe(a)?(n=e.pop(),e.length>1&&typeof e[e.length-1]=="number"&&(r=e.pop())):typeof a=="number"&&(r=e.pop()),n===null&&e.length===1&&e[0]instanceof es?e[0]:WEe(r)(CEe(e,n))}function v3(e,t){return function(n){return n.lift(new $Ee(e,t))}}var $Ee=function(){function e(t,r){this.predicate=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new XEe(t,this.predicate,this.thisArg))},e}(),XEe=function(e){yi(t,e);function t(r,n,a){var i=e.call(this,r)||this;return i.predicate=n,i.thisArg=a,i.count=0,i}return t.prototype._next=function(r){var n;try{n=this.predicate.call(this.thisArg,r,this.count++)}catch(a){this.destination.error(a);return}n&&this.destination.next(r)},t}(Us),Wc;(function(e){function t(){var r=new YEe,n=function(){return r.create()};return n.dispose=function(){return r.dispose()},n.behavior=function(a){return r.behavior(a)},n}e.create=t})(Wc||(Wc={}));var YEe=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var t=new ta;return this._eventList.push(t),t},e.prototype.behavior=function(t){var r=new _f(t);return this._eventList.push(r),r},e.prototype.dispose=function(){if(!this._disposed){for(var t=0,r=this._eventList;t<r.length;t++){var n=r[t];n.complete()}this._disposed=!0}},e}();function bu(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(a){return"'"+a+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Eg(e){return!!e&&!!e[ts]}function zp(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return typeof n=="function"&&Function.toString.call(n)===nAe}(e)||Array.isArray(e)||!!e[q8]||!!e.constructor[q8]||yk(e)||bk(e))}function q1(e,t,r){r===void 0&&(r=!1),Kg(e)===0?(r?Object.keys:wk)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,a){return t(a,n,e)})}function Kg(e){var t=e[ts];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:yk(e)?2:bk(e)?3:0}function vM(e,t){return Kg(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function KEe(e,t){return Kg(e)===2?e.get(t):e[t]}function pY(e,t,r){var n=Kg(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function QEe(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function yk(e){return tAe&&e instanceof Map}function bk(e){return rAe&&e instanceof Set}function Yh(e){return e.o||e.t}function xk(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=aAe(e);delete t[ts];for(var r=wk(t),n=0;n<r.length;n++){var a=r[n],i=t[a];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[a]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function Sk(e,t){return t===void 0&&(t=!1),Ck(e)||Eg(e)||!zp(e)||(Kg(e)>1&&(e.set=e.add=e.clear=e.delete=ZEe),Object.freeze(e),t&&q1(e,function(r,n){return Sk(n,!0)},!0)),e}function ZEe(){bu(2)}function Ck(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function Rc(e){var t=iAe[e];return t||bu(18,e),t}function B8(){return W1}function JA(e,t){t&&(Rc("Patches"),e.u=[],e.s=[],e.v=t)}function HC(e){mM(e),e.p.forEach(JEe),e.p=null}function mM(e){e===W1&&(W1=e.l)}function U8(e){return W1={p:[],l:W1,h:e,m:!0,_:0}}function JEe(e){var t=e[ts];t.i===0||t.i===1?t.j():t.g=!0}function eP(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||Rc("ES5").S(t,e,n),n?(r[ts].P&&(HC(t),bu(4)),zp(e)&&(e=GC(t,e),t.l||qC(t,e)),t.u&&Rc("Patches").M(r[ts],e,t.u,t.s)):e=GC(t,r,[]),HC(t),t.u&&t.v(t.u,t.s),e!==vY?e:void 0}function GC(e,t,r){if(Ck(t))return t;var n=t[ts];if(!n)return q1(t,function(i,o){return j8(e,n,t,i,o,r)},!0),t;if(n.A!==e)return t;if(!n.P)return qC(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var a=n.i===4||n.i===5?n.o=xk(n.k):n.o;q1(n.i===3?new Set(a):a,function(i,o){return j8(e,n,a,i,o,r)}),qC(e,a,!1),r&&e.u&&Rc("Patches").R(n,r,e.u,e.s)}return n.o}function j8(e,t,r,n,a,i){if(Eg(a)){var o=GC(e,a,i&&t&&t.i!==3&&!vM(t.D,n)?i.concat(n):void 0);if(pY(r,n,o),!Eg(o))return;e.m=!1}if(zp(a)&&!Ck(a)){if(!e.h.F&&e._<1)return;GC(e,a),t&&t.A.l||qC(e,a)}}function qC(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&Sk(t,r)}function tP(e,t){var r=e[ts];return(r?Yh(r):e)[t]}function z8(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function gM(e){e.P||(e.P=!0,e.l&&gM(e.l))}function rP(e){e.o||(e.o=xk(e.t))}function yM(e,t,r){var n=yk(t)?Rc("MapSet").N(t,r):bk(t)?Rc("MapSet").T(t,r):e.O?function(a,i){var o=Array.isArray(a),s={i:o?1:0,A:i?i.A:B8(),P:!1,I:!1,D:{},l:i,t:a,k:null,o:null,j:null,C:!1},u=s,l=mS;o&&(u=[s],l=gS);var c=Proxy.revocable(u,l),d=c.revoke,f=c.proxy;return s.k=f,s.j=d,f}(t,r):Rc("ES5").J(t,r);return(r?r.A:B8()).p.push(n),n}function eAe(e){return Eg(e)||bu(22,e),function t(r){if(!zp(r))return r;var n,a=r[ts],i=Kg(r);if(a){if(!a.P&&(a.i<4||!Rc("ES5").K(a)))return a.t;a.I=!0,n=V8(r,i),a.I=!1}else n=V8(r,i);return q1(n,function(o,s){a&&KEe(a.t,o)===s||pY(n,o,t(s))}),i===3?new Set(n):n}(e)}function V8(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return xk(e)}var H8,W1,_k=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",tAe=typeof Map<"u",rAe=typeof Set<"u",G8=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",vY=_k?Symbol.for("immer-nothing"):((H8={})["immer-nothing"]=!0,H8),q8=_k?Symbol.for("immer-draftable"):"__$immer_draftable",ts=_k?Symbol.for("immer-state"):"__$immer_state",nAe=""+Object.prototype.constructor,wk=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,aAe=Object.getOwnPropertyDescriptors||function(e){var t={};return wk(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},iAe={},mS={get:function(e,t){if(t===ts)return e;var r=Yh(e);if(!vM(r,t))return function(a,i,o){var s,u=z8(i,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(a.k):void 0}(e,r,t);var n=r[t];return e.I||!zp(n)?n:n===tP(e.t,t)?(rP(e),e.o[t]=yM(e.A.h,n,e)):n},has:function(e,t){return t in Yh(e)},ownKeys:function(e){return Reflect.ownKeys(Yh(e))},set:function(e,t,r){var n=z8(Yh(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var a=tP(Yh(e),t),i=a==null?void 0:a[ts];if(i&&i.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(QEe(r,a)&&(r!==void 0||vM(e.t,t)))return!0;rP(e),gM(e)}return e.o[t]===r&&typeof r!="number"||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return tP(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,rP(e),gM(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=Yh(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){bu(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){bu(12)}},gS={};q1(mS,function(e,t){gS[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),gS.deleteProperty=function(e,t){return mS.deleteProperty.call(this,e[0],t)},gS.set=function(e,t,r){return mS.set.call(this,e[0],t,r,e[0])};var oAe=function(){function e(r){var n=this;this.O=G8,this.F=!0,this.produce=function(a,i,o){if(typeof a=="function"&&typeof i!="function"){var s=i;i=a;var u=n;return function(h){var v=this;h===void 0&&(h=s);for(var p=arguments.length,g=Array(p>1?p-1:0),m=1;m<p;m++)g[m-1]=arguments[m];return u.produce(h,function(y){var b;return(b=i).call.apply(b,[v,y].concat(g))})}}var l;if(typeof i!="function"&&bu(6),o!==void 0&&typeof o!="function"&&bu(7),zp(a)){var c=U8(n),d=yM(n,a,void 0),f=!0;try{l=i(d),f=!1}finally{f?HC(c):mM(c)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(h){return JA(c,o),eP(h,c)},function(h){throw HC(c),h}):(JA(c,o),eP(l,c))}if(!a||typeof a!="object")return(l=i(a))===vY?void 0:(l===void 0&&(l=a),n.F&&Sk(l,!0),l);bu(21,a)},this.produceWithPatches=function(a,i){return typeof a=="function"?function(u){for(var l=arguments.length,c=Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=arguments[d];return n.produceWithPatches(u,function(f){return a.apply(void 0,[f].concat(c))})}:[n.produce(a,i,function(u,l){o=u,s=l}),o,s];var o,s},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){zp(r)||bu(8),Eg(r)&&(r=eAe(r));var n=U8(this),a=yM(this,r,void 0);return a[ts].C=!0,mM(n),a},t.finishDraft=function(r,n){var a=r&&r[ts],i=a.A;return JA(i,n),eP(void 0,i)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!G8&&bu(20),this.O=r},t.applyPatches=function(r,n){var a;for(a=n.length-1;a>=0;a--){var i=n[a];if(i.path.length===0&&i.op==="replace"){r=i.value;break}}var o=Rc("Patches").$;return Eg(r)?o(r,n):this.produce(r,function(s){return o(s,n.slice(a+1))})},e}(),rs=new oAe,Vp=rs.produce;rs.produceWithPatches.bind(rs);var sAe=rs.setAutoFreeze.bind(rs);rs.setUseProxies.bind(rs);rs.applyPatches.bind(rs);rs.createDraft.bind(rs);rs.finishDraft.bind(rs);const Ek=Vp;var ep;(function(e){function t(o){if(!o.state||o.state.tree===o.editInfo.sourceTree)return o.tree.asImmutable();for(var s=o.state.tree.asTransient(),u=0,l=o.actions;u<l.length;u++){var c=l[u];switch(c.kind){case"add":s.add(c.transform);break;case"update":s.setParams(c.ref,c.params);break;case"delete":s.remove(c.ref);break;case"insert":{var d=s.children.get(c.ref).toArray();s.add(c.transform);for(var f=0,h=d;f<h.length;f++){var v=h[f];s.changeParent(v,c.transform.ref)}break}}}return o.editInfo.sourceTree=o.tree,s.asImmutable()}function r(o){return!!o&&typeof o.getTree=="function"}e.is=r;function n(o){return!!o&&typeof o.getTree=="function"&&typeof o.ref=="string"}e.isTo=n;var a=function(){function o(s,u){this.state={state:u,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTree",{get:function(){return this.state.tree},enumerable:!1,configurable:!0}),o.prototype.to=function(s){var u=typeof s=="string"?s:V1.is(s)?s.transform.ref:s.ref;return new i(this.state,u,this)},o.prototype.toRoot=function(){return new i(this.state,this.state.tree.root.ref,this)},o.prototype.delete=function(s){var u=La.resolveRef(s);return!u||!this.state.tree.transforms.has(u)?this:(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.Root=a;var i=function(){function o(s,u,l){if(this.state=s,this.root=l,this.ref=u,!this.state.tree.transforms.has(u))throw new Error("Could not find node '"+u+"'.")}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selector",{get:function(){return new zX(this.ref,this.state.state)},enumerable:!1,configurable:!0}),o.prototype.getApplyRoot=function(){return sa.getDecoratorRoot(this.state.tree,this.ref)},o.prototype.apply=function(s,u,l){if(s.definition.isDecorator)return this.insert(s,u,l);var c=this.getApplyRoot(),d=s.apply(c,u,l);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new o(this.state,d.ref,this.root)},o.prototype.applyOrUpdate=function(s,u,l,c){if(this.state.tree.transforms.has(s)){var d=this.to(s);return l&&d.update(l),d}else return this.apply(u,l,E(E({},c),{ref:s}))},o.prototype.applyOrUpdateTagged=function(s,u,l,c){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");for(var d=this.getApplyRoot(),f=this.state.tree.children.get(d).values();;){var h=f.next();if(h.done)break;var v=this.state.tree.transforms.get(h.value);if(v&&cr.hasTags(v,s)){var p=this.to(h.value);return p.updateTagged(l,W8(v.tags,s,c&&c.tags)),p}}var g=u.apply(d,l,E(E({},c),{tags:W8(s,c&&c.tags)}));return this.state.tree.add(g),this.editInfo.count++,this.editInfo.lastUpdate=g.ref,this.state.actions.push({kind:"add",transform:g}),new o(this.state,g.ref,this.root)},o.prototype.group=function(s,u,l){return this.apply(s,u,l)},o.prototype.insert=function(s,u,l){var c=this.state.tree.children.get(this.ref).toArray(),d=s.apply(this.ref,u,l);this.state.tree.add(d);for(var f=0,h=c;f<h.length;f++){var v=h[f];this.state.tree.changeParent(v,d.ref)}return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new o(this.state,d.ref,this.root)},o.prototype.updateTagged=function(s,u){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))},o.prototype.update=function(s,u){var l;if(u){var c=this.state.tree.transforms.get(this.ref);l=Vp(c.params,u)}else l=typeof s=="function"?Vp(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,l)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:l})),this.root},o.prototype.to=function(s){return this.root.to(s)},o.prototype.toRoot=function(){return this.root.toRoot()},o.prototype.delete=function(s){return this.root.delete(s)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.To=i})(ep||(ep={}));function W8(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=[],a=0,i=e;a<i.length;a++){var o=i[a];if(o)if(r||(r=new Set),typeof o=="string"){if(r.has(o))continue;r.add(o),n.push(o)}else for(var s=0,u=o;s<u.length;s++){var l=u[s];r.has(l)||(r.add(l),n.push(l))}}return n}var uAe=function(){function e(){this.ev=Wc.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}return e.prototype.add=function(t){var r=vt.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(var n=0,a=r.definition.from;n<a.length;n++){var i=a[n];this.fromTypeIndex.has(i.type)?this.fromTypeIndex.get(i.type).push(r):this.fromTypeIndex.set(i.type,[r])}return this.events.added.next(),this},e.prototype.remove=function(t){var r=vt.is(t)?t.toAction().id:pn.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(var a=0,i=n.definition.from;a<i.length;a++){var o=i[a],s=this.fromTypeIndex.get(o.type);s&&(yp(s,n),s.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(),this},e.prototype.fromCell=function(t,r){var n=t.obj;if(!n)return[];var a=this.fromTypeIndex.get(n.type);if(!a)return[];for(var i=!1,o=0,s=a;o<s.length;o++){var u=s[o];if(u.definition.isApplicable){i=!0;break}}if(!i)return a;for(var l=[],c=0,d=a;c<d.length;c++){var u=d[c];u.definition.isApplicable?u.definition.isApplicable(n,t.transform,r)&&l.push(u):l.push(u)}return l},e.prototype.dispose=function(){this.ev.dispose()},e}(),bl;(function(e){function t(i){return{type:"message",timestamp:new Date,message:i}}e.message=t;function r(i){return{type:"error",timestamp:new Date,message:i}}e.error=r;function n(i){return{type:"warning",timestamp:new Date,message:i}}e.warning=n;function a(i){return{type:"info",timestamp:new Date,message:i}}e.info=a})(bl||(bl={}));var $1;(function(e){var t=function(){function a(i){this.cells=i,this._current=void 0}return Object.defineProperty(a.prototype,"current",{get:function(){return this._current},set:function(i){this._current=i},enumerable:!1,configurable:!0}),a.prototype.getAncestorOfType=function(i){if(this._current)for(var o=this._current;;){if(o=this.cells.get(o.transform.parent),!o.obj)return;if(o.obj.type===i.type)return o.obj;if(o.transform.ref===cr.RootRef)return}},a.prototype.getRootOfType=function(i){if(this._current)for(var o=this._current,s=void 0;;){if(!o.obj)return;if(o.obj.type===i.type&&(s=o),o.transform.ref===cr.RootRef)return s?s.obj:void 0;o=this.cells.get(o.transform.parent)}},a}();e.Impl=t;function r(a,i){for(var o=a.cells,s=o.get(i),u=[s];s!=null&&s.transform.transformer.definition.isDecorator;)s=o.get(s.transform.parent),u.push(s);return u}e.getDecoratorChain=r;function n(a,i,o){var s=void 0,u=a.cells.get(o);if(u)for(;;){if(!u.obj)return;if(u.obj.type===i.type&&(s=u),u.transform.ref===cr.RootRef)return s?s.obj:void 0;u=a.cells.get(u.transform.parent)}}e.getRootOfType=n})($1||($1={}));var lAe=function(){function e(){this.queue=[],this.signal=new ta}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)},e.prototype.handled=function(t){H1(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})},e.prototype.remove=function(t){var r=H1(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r},e.prototype.waitFor=function(t){var r=this;return new Promise(function(n){var a=r.signal.subscribe(function(i){var o=i.v,s=i.stillPresent;o===t&&(a.unsubscribe(),n(s))})})},e}(),cAe=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}return e.prototype.add=function(t){var r=this.getHash(t);if(this.byHash.has(r)){for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0},e.prototype.has=function(t){var r=this.getHash(t);if(!this.byHash.has(r))return!1;for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!0;return!1},e}();function Ak(e,t){return new cAe(e,t)}function bM(){return new dAe}function $8(e){return{previous:null,next:null,inList:!0,value:e}}var dAe=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(t){var r=$8(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r},e.prototype.addLast=function(t){var r=$8(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r},e.prototype.removeFirst=function(){var t=this.first;if(t)return this.remove(t),t.value},e.prototype.removeLast=function(){var t=this.last;if(t)return this.remove(t),t.value},e.prototype.remove=function(t){t.inList&&(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)},e.prototype.find=function(t){for(var r=this.first;r!==null;){if(r.value===t)return r;r=r.next}},e}(),Jr;(function(e){function t(){return{keys:new Set,array:[]}}e.create=t;function r(a,i,o){var s=a.keys,u=a.array;return s.has(i)?!1:(s.add(i),u[u.length]=o,!0)}e.add=r;function n(a,i){var o=a.keys;return o.has(i)}e.has=n})(Jr||(Jr={}));var Zf=function(){function e(t,r){var n=this;this.errorFree=!0,this.ev=Wc.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:cr.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new uAe,this.cells=new Map,this.spine=new $1.Impl(this.cells),this.tryGetCellData=function(o){var s,u,l=(u=(s=n.cells.get(o))===null||s===void 0?void 0:s.obj)===null||u===void 0?void 0:u.data;if(!o)throw new Error("Cell '"+o+"' data undefined.");return l},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new lAe,this._tree=sa.createEmpty(cr.createRoot(r&&r.rootState)).asTransient();var a=this._tree,i=a.root;this.runTask=r.runTask,(r==null?void 0:r.historyCapacity)!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(i.ref,{parent:this,transform:i,sourceRef:void 0,obj:t,status:"ok",state:E({},i.state),errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:i.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.cells.get(this._tree.root.ref)},enumerable:!1,configurable:!0}),e.prototype.build=function(){return new ep.Root(this.tree,this)},e.prototype.addHistory=function(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))},e.prototype.clearHistory=function(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))},Object.defineProperty(e.prototype,"latestUndoLabel",{get:function(){return this.history.length>0?this.history[0][1]:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this.history.length>0},enumerable:!1,configurable:!0}),e.prototype.undo=function(){var t=this;return et.create("Undo",function(r){return de(t,void 0,void 0,function(){var n;return fe(this,function(a){switch(a.label){case 0:if(n=this.history.shift(),!n)return[2];this.events.historyUpdated.next({state:this}),this.undoingHistory=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.updateTree(n[0],{canUndo:!1}).runInContext(r)];case 2:return a.sent(),[3,4];case 3:return this.undoingHistory=!1,[7];case 4:return[2]}})})})},e.prototype.getSnapshot=function(){return{tree:sa.toJSON(this._tree)}},e.prototype.setSnapshot=function(t){var r=sa.fromJSON(t.tree);return this.updateTree(r)},e.prototype.setCurrent=function(t){this.behaviors.currentObject.next({state:this,ref:t})},e.prototype.updateCellState=function(t,r){var n=this.cells.get(t);if(n){var a=typeof r=="function"?r(n.state):r;cr.assignState(n.state,a)&&(n.transform=this._tree.assignState(n.transform.ref,a),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}},e.prototype.dispose=function(){this.ev.dispose(),this.actions.dispose()},e.prototype.select=function(t){return ir.select(t,this)},e.prototype.selectQ=function(t){return typeof t=="string"?ir.select(t,this):ir.select(t(ir.Generators),this)},e.prototype.applyAction=function(t,r,n){var a=this;return n===void 0&&(n=cr.RootRef),et.create("Apply Action",function(i){var o=a.cells.get(n);if(!o)throw new Error("'"+n+"' does not exist.");if(o.status!=="ok")throw new Error("Action cannot be applied to a cell with status '"+o.status+"'");return Pk(t.definition.run({ref:n,cell:o,a:o.obj,params:r,state:a},a.globalContext),i)})},e.prototype.transaction=function(t,r){var n=this;return et.create("State Transaction",function(a){return de(n,void 0,void 0,function(){var i,o,s,u;return fe(this,function(l){switch(l.label){case 0:i=this.inTransaction,o=this._tree.asImmutable(),s=!1,l.label=1;case 1:return l.trys.push([1,5,8,9]),i||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,[4,t(a)];case 2:return l.sent(),this.inTransactionError?(s=!0,[4,this.updateTree(o).runInContext(a)]):[3,4];case 3:l.sent(),l.label=4;case 4:return[3,9];case 5:return u=l.sent(),s?[3,7]:(s=!0,[4,this.updateTree(o).runInContext(a)]);case 6:l.sent(),this.events.log.next(bl.error(""+u)),l.label=7;case 7:if(i)throw this.inTransactionError=!0,u;if(r!=null&&r.rethrowErrors)throw u;return[3,9];case 8:return i||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||(r!=null&&r.canUndo?this.addHistory(o,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory())),[7];case 9:return[2]}})})})},Object.defineProperty(e.prototype,"inUpdate",{get:function(){return this._inUpdate},enumerable:!1,configurable:!0}),e.prototype.updateTree=function(t,r){var n=this,a={tree:t,options:r};return et.create("Update Tree",function(i){return de(n,void 0,void 0,function(){var o,s,u,l,c;return fe(this,function(d){switch(d.label){case 0:return[4,this.updateQueue.enqueue(a)];case 1:if(o=d.sent(),!o)return[2];this._inUpdate=!0,s=r!=null&&r.canUndo?this._tree.asImmutable():void 0,u=!1,this.inTransaction||this.behaviors.isUpdating.next(!0),d.label=2;case 2:if(d.trys.push([2,,7,8]),ep.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}return this.reverted=!1,r&&(r.revertIfAborted||r.revertOnError)?[4,this._revertibleTreeUpdate(i,a,r)]:[3,4];case 3:return c=d.sent(),[3,6];case 4:return[4,this._updateTree(i,a)];case 5:c=d.sent(),d.label=6;case 6:return l=c,u=this.reverted,l.ctx.hadError&&(this.inTransactionError=!0),l.cell?[2,new zX(l.cell.transform.ref,this)]:[2];case 7:return this._inUpdate=!1,this.updateQueue.handled(a),this.inTransaction||(this.behaviors.isUpdating.next(!1),r!=null&&r.canUndo?u||this.addHistory(s,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory()),[7];case 8:return[2]}})})},function(){n.updateQueue.remove(a)})},e.prototype._revertibleTreeUpdate=function(t,r,n){return de(this,void 0,void 0,function(){var a,i,o;return fe(this,function(s){switch(s.label){case 0:return a=this.tree,[4,this._updateTree(t,r)];case 1:return i=s.sent(),o=(i.ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted,o?(this.reverted=!0,[4,this._updateTree(t,{tree:a,options:r.options})]):[3,3];case 2:return[2,s.sent()];case 3:return[2,i]}})})},e.prototype._updateTree=function(t,r){return de(this,void 0,void 0,function(){var n,a,i;return fe(this,function(o){switch(o.label){case 0:n=!1,a=this.updateTreeAndCreateCtx(r.tree,t,r.options),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,hAe(a)];case 2:return n=o.sent(),ep.isTo(r.tree)?(i=this.select(r.tree.ref)[0],[2,{ctx:a,cell:i}]):[2,{ctx:a}];case 3:return this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction}),[7];case 4:return[2]}})})},e.prototype.updateTreeAndCreateCtx=function(t,r,n){var a=(ep.is(t)?t.getTree():t).asTransient(),i=this._tree;this._tree=a;var o=this.cells,s={parent:this,editInfo:ep.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:i,tree:a,cells:this.cells,spine:this.spine,results:[],options:E(E({},fAe),n),changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:function(u){var l;return(l=o.get(u).obj)===null||l===void 0?void 0:l.data}};return this.errorFree=!0,s},e}();(function(e){function t(r,n){return new e(r,n)}e.create=t,function(r){function n(a,i){return!!i&&a.ref===i.transform.ref&&a.state===i.parent}r.isCell=n}(e.ObjectEvent||(e.ObjectEvent={}))})(Zf||(Zf={}));var fAe={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function hAe(e){return de(this,void 0,void 0,function(){var t,r,n,a,L,i,o,s,g,u,p,S,l,c,g,S,d,f,h,v,S,p,g,m,y,b,S,x,C,w,A,I,D,k,R,L,H;return fe(this,function(B){switch(B.label){case 0:if(t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),n=[],t)r=[],a=[e.editInfo.lastUpdate];else{for(r=gAe(e),L=e.parent.current,i=!1,o=0,s=r;o<s.length;o++)if(g=s[o],g===L){i=!0;break}for(i&&(u=X8(e.oldTree,L,r,e.cells),e.parent.setCurrent(u)),p=r.length-1;p>=0;p--)S=e.cells.get(r[p]),S&&SM(S.transform,S.obj,S==null?void 0:S.transform.params,S.cache,e.parent.globalContext);for(l=0,c=r;l<c.length;l++)g=c[l],S=e.cells.get(g),S&&(S.parent=void 0,CAe(S)),d=S&&S.obj,e.cells.delete(g),n.push(d);a=pAe(e.cells,e.tree)}for(f=EAe(e,a),h=0,v=f.added;h<v.length;h++)S=v[h],e.parent.events.cell.created.next({state:e.parent,ref:S.transform.ref,cell:S});for(p=0;p<r.length;p++)g=r[p],m=e.oldTree.transforms.get(g).parent,e.parent.events.object.removed.next({state:e.parent,ref:g,obj:n[p]}),e.parent.events.cell.removed.next({state:e.parent,ref:g,parent:m});if(n.length&&(n=[]),f.dependent)for(y=0,b=f.dependent;y<b.length;y++)S=b[y],a.push(S.transform.ref);SAe(e,a),x=0,C=a,B.label=1;case 1:return x<C.length?(w=C[x],[4,gY(e,w)]):[3,4];case 2:B.sent(),B.label=3;case 3:return x++,[3,1];case 4:for(e.editInfo||bAe(e),A=e.newCurrent,I=0,D=e.results;I<D.length;I++)k=D[I],k.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:k.ref,obj:k.obj}),e.newCurrent||(R=e.tree.transforms.get(k.ref),!R.state.isGhost&&k.obj!==On.Null&&(A=k.ref))):k.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:k.ref,action:"in-place",obj:k.obj,oldData:k.oldData}):k.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:k.ref,action:"recreate",obj:k.obj,oldObj:k.oldObj});return A?e.options.doNotUpdateCurrent||e.parent.setCurrent(A):(L=e.parent.current,H=e.cells.get(L),H&&(H.obj===On.Null||H.status==="error"&&H.errorText===AAe)&&(A=X8(e.oldTree,L,[],e.cells),e.parent.setCurrent(A))),[2,r.length>0||a.length>0||e.changed]}})})}function pAe(e,t){var r={roots:[],cells:e};return sa.doPreOrder(t,t.root,r,vAe),r.roots}function vAe(e,t,r){var n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===On.Null)}function mAe(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function gAe(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return sa.doPostOrder(e.oldTree,e.oldTree.root,t,mAe),t.deletes}function yAe(e,t,r){var n=r.cells.get(e.ref);!n||!cr.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function bAe(e){sa.doPreOrder(e.tree,e.tree.root,e,yAe)}function WC(e,t,r,n){var a=e.cells.get(t),i=a.status!==r;a.status=r,a.errorText=n,i&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:a})}function xAe(e,t,r){r.cells.get(e.ref).transform=e,WC(r,e.ref,"pending")}function SAe(e,t){for(var r=0,n=t;r<n.length;r++){var a=n[r];sa.doPreOrder(e.tree,e.tree.transforms.get(a),e,xAe)}}function CAe(e){for(var t=0,r=e.dependencies.dependsOn;t<r.length;t++){var n=r[t];yp(n.dependencies.dependentBy,e)}}function _Ae(e,t,r){var n=r.ctx,a=r.added,i=r.visited;if(i.add(e.ref),!n.cells.has(e.ref)){var o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:E({},e.state),errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),a.push(o)}}function wAe(e,t){if(e.transform.dependsOn)for(var r=0,n=e.transform.dependsOn;r<n.length;r++){var a=n[r],i=t.tree.transforms.get(a);if(!i)throw new Error("Cannot depend on a non-existent transform.");var o=t.cells.get(a);Di(e.dependencies.dependsOn,o),Di(o.dependencies.dependentBy,e)}}function EAe(e,t){for(var r={ctx:e,visited:new Set,added:[]},n=0,a=t;n<a.length;n++){var i=a[n];sa.doPreOrder(e.tree,e.tree.transforms.get(i),r,_Ae)}for(var o=0,s=r.added;o<s.length;o++){var u=s[o];wAe(u,e)}var l;return r.visited.forEach(function(c){for(var d=e.cells.get(c),f=0,h=d.dependencies.dependentBy;f<h.length;f++){var v=h[f];r.visited.has(v.transform.ref)||(l||(l=Jr.create()),Jr.add(l,v.transform.ref,v))}}),{added:r.added,dependent:l?l.array:void 0}}function X8(e,t,r,n){var a=new Set(r);return mY(e,t,a,n)}function mY(e,t,r,n){if(t===cr.RootRef)return t;for(var a=e.transforms.get(t),i=e.children.get(a.parent).values(),o=void 0,s=!1;;){var u=i.next();if(u.done)break;if(!r.has(u.value)){var l=n.get(u.value);if(!(!l||l.status==="error"||l.obj===On.Null)){var c=e.transforms.get(u.value);if(!c.state.isGhost){if(u.value===t){s=!0,r.has(t)||(o=t);continue}if(s)return c.ref;o=c.ref}}}}return o||mY(e,a.parent,r,n)}function xM(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);var a=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||et.isAbort(r);var i=""+r;WC(e,t,"error",i),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:i})}else a.params=void 0;if(a.obj){var o=a.obj;a.obj=void 0,a.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:o})}for(var s=e.tree.children.get(t).values();;){var u=s.next();if(u.done)return;xM(e,u.value,void 0,n)}}var AAe="Parent is null";function gY(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o,s,u;return fe(this,function(l){switch(l.label){case 0:WC(e,t,"processing"),r=!1,l.label=1;case 1:return l.trys.push([1,3,,4]),n=kn(),[4,TAe(e,t)];case 2:return a=l.sent(),i=kn()-n,a.action!=="none"&&(e.changed=!0),WC(e,t,"ok"),e.results.push(a),a.action==="created"?(r=a.obj===On.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(bl.info("Created "+a.obj.label+" in "+dS(i)+"."))):(a.action==="updated"||a.action==="replaced")&&(r=a.obj===On.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(bl.info("Updated "+a.obj.label+" in "+dS(i)+"."))),[3,4];case 3:return o=l.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),xM(e,t,o,!1),Yg||console.error(o),[2];case 4:s=e.tree.children.get(t).values(),l.label=5;case 5:return u=s.next(),u.done?[2]:r?(xM(e,u.value,void 0,!0),[3,8]):[3,6];case 6:return[4,gY(e,u.value)];case 7:l.sent(),l.label=8;case 8:return[3,5];case 9:return[2]}})})}function PAe(e,t,r,n){var a=t.transformer.definition.params,i=a?a(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=T.normalizeParams(i,t.params,"all"),n.paramsNormalizedVersion=t.version;else{var o=T.getDefaultValues(i);t.params=t.params?i3e(t.params,o):o}return T.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}function TAe(e,t){var r;return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b;return fe(this,function(S){switch(S.label){case 0:if(n=e.oldTree,a=e.tree,i=e.cells.get(t),o=i.transform,i.transform.ref===cr.RootRef)return[2,{action:"none"}];if(s=o.transformer.definition.from.length===0?e.cells.get(i.transform.parent):ir.findAncestorOfType(a,e.cells,t,o.transformer.definition.from),!s)throw new Error("No suitable parent found for '"+t+"'");return e.spine.current=i,u=s.obj,i.sourceRef=s.transform.ref,l=PAe(e,o,u,i),!n.transforms.has(t)||!i.params?(i.params=l,[4,Y8(e,i,o.transformer,u,l.values)]):[3,2];case 1:return c=S.sent(),nP(c,o),i.obj=c,[2,{ref:t,action:"created",obj:c}];case 2:return d=i.params.values,f=i.cache,h=(r=i.obj)===null||r===void 0?void 0:r.data,v=l.values,i.params=l,i.obj&&i.obj!==On.Null?[4,IAe(e,i,o.transformer,u,i.obj,d,v)]:[3,4];case 3:return g=S.sent(),[3,5];case 4:g=vt.UpdateResult.Recreate,S.label=5;case 5:switch(p=g,m=p,m){case vt.UpdateResult.Recreate:return[3,6];case vt.UpdateResult.Updated:return[3,8];case vt.UpdateResult.Null:return[3,9]}return[3,10];case 6:return y=i.obj,SM(o,y,d,f,e.parent.globalContext),[4,Y8(e,i,o.transformer,u,v)];case 7:return b=S.sent(),nP(b,o),i.obj=b,[2,{ref:t,action:"replaced",oldObj:y,obj:b}];case 8:return nP(i.obj,o),[2,{ref:t,action:"updated",oldData:h,obj:i.obj}];case 9:return SM(o,i.obj,d,f,e.parent.globalContext),i.obj=On.Null,[2,{ref:t,action:"updated",obj:i.obj}];case 10:return[2,{action:"none"}]}})})}function SM(e,t,r,n,a){var i,o;(o=(i=e.transformer.definition).dispose)===null||o===void 0||o.call(i,{b:t!==On.Null?t:void 0,params:r,cache:n},a)}function nP(e,t){!e||e===On.Null||(e.tags=t.tags)}function Pk(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function yY(e){if(e.dependencies.dependsOn.length!==0){for(var t=Object.create(null),r=0,n=e.dependencies.dependsOn;r<n.length;r++){var a=n[r];if(!a.obj)throw new Error("Unresolved dependency.");t[a.transform.ref]=a.obj}return t}}function Y8(e,t,r,n,a){return t.cache||(t.cache=Object.create(null)),Pk(r.definition.apply({a:n,params:a,cache:t.cache,spine:e.spine,dependencies:yY(t)},e.parent.globalContext),e.taskCtx)}function IAe(e,t,r,n,a,i,o){return de(this,void 0,void 0,function(){return fe(this,function(s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),[2,Pk(r.definition.update({a:n,oldParams:i,b:a,newParams:o,cache:t.cache,spine:e.spine,dependencies:yY(t)},e.parent.globalContext),e.taskCtx)]):[2,vt.UpdateResult.Recreate]})})}var ns={kind:"null-location"};function bY(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function bn(e,t,r,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=function(){return!1}),e%r!==0)throw new Error("incompatible groupCount and stride");var o={location:ns,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},s=o.groupIndex<e,u=!1,l=0,c=0,d=!1;return{get hasNext(){return s},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:a,move:function(){return s&&(o.groupIndex=l,o.instanceIndex=c,o.index=c*e+l,o.location=n(l,d?-1:c),o.isSecondary=i(l,d?-1:c),l+=r,l===e?(++c,u=!0,c<t&&(l=0)):u=!1,s=l<e),o},reset:function(){o.location=ns,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,s=o.groupIndex<e,u=!1,l=0,c=0,d=!1},skipInstance:function(){s&&o.instanceIndex===c&&(++c,l=0,s=c<t)},voidInstances:function(){d=!0}}}function pv(e){return{kind:"position-location",position:e?_.clone(e):_()}}var K8=qn(),MAe=le();function DAe(e,t){for(var r=0;r<t;r++)if(qn.fromMat4(K8,le.fromArray(MAe,e,r*16)),qn.determinant(K8)<0)return!0;return!1}function Tk(e,t,r){var n=DAe(e,t);if(r){N.update(r.matrix,r.matrix.ref.value),N.update(r.transform,e),N.updateIfChanged(r.uInstanceCount,t),N.updateIfChanged(r.instanceCount,t);var a=r.aTransform.ref.value.length>=t*16?r.aTransform.ref.value:new Float32Array(t*16);a.set(e),N.update(r.aTransform,a);var i=r.extraTransform.ref.value.length>=t*16?r.extraTransform.ref.value:new Float32Array(t*16);N.update(r.extraTransform,$C(i,t));var o=r.aInstance.ref.value.length>=t?r.aInstance.ref.value:new Float32Array(t);return N.update(r.aInstance,Ws(o,t)),N.update(r.hasReflection,n),xY(r),r}else return{aTransform:N.create(new Float32Array(e)),matrix:N.create(le.identity()),transform:N.create(e),extraTransform:N.create($C(new Float32Array(t*16),t)),uInstanceCount:N.create(t),instanceCount:N.create(t),aInstance:N.create(Ws(new Float32Array(t))),hasReflection:N.create(n)}}var Ik=new Float32Array(16);le.toArray(le.identity(),Ik,0);function Mk(e){return Tk(new Float32Array(Ik),1,e)}function $C(e,t){for(var r=0;r<t;r++)e.set(Ik,r*16);return e}function xY(e){for(var t=e.aTransform.ref.value,r=e.instanceCount.ref.value,n=e.matrix.ref.value,a=e.transform.ref.value,i=e.extraTransform.ref.value,o=0;o<r;o++){var s=o*16;le.mulOffset(t,i,a,s,s,s),le.mulOffset(t,n,t,s,0,s)}N.update(e.aTransform,t)}var dr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};(function(){var e=new Map;return Object.keys(dr).forEach(function(t){e.set(dr[t],t)}),e})();var SY=dt(13421772),RAe="Gives everything the same, uniform color.",CY={value:T.Color(SY)};function kAe(e){return CY}function Dk(e,t){var r=Da(t.value,SY);return{factory:Dk,granularity:"uniform",color:function(){return r},props:t,description:RAe,legend:vh([["uniform",r]])}}var OAe={name:"uniform",label:"Uniform",category:"Miscellaneous",factory:Dk,getParams:kAe,defaultValues:T.getDefaultValues(CY),isApplicable:function(e){return!0}},LAe="Gives everything the same, uniform size.",_Y={value:T.Numeric(1,{min:0,max:20,step:.1})};function NAe(e){return _Y}function Rk(e,t){var r=t.value;return{factory:Rk,granularity:"uniform",size:function(){return r},props:t,description:LAe}}var FAe={name:"uniform",label:"Uniform",category:"",factory:Rk,getParams:NAe,defaultValues:T.getDefaultValues(_Y),isApplicable:function(e){return!0}},BAe={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},UAe=Object.keys(BAe),kk=T.arrayToOptions(UAe),At;(function(e){e.Params={alpha:T.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:T.Select("auto",kk,{isEssential:!0,description:"Visual/rendering quality of the representation."})},e.ShadingCategory={category:"Shading"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:function(o){return typeof o.quality<"u"&&o.quality!=="custom"}};function t(o,s,u){o===void 0&&(o=dr.grey),s===void 0&&(s=1),u||(u=Mk());var l=bn(1,u.instanceCount.ref.value,1,function(){return ns},!1,function(){return!1}),c={color:Dk({},{value:o}),size:Rk({},{value:s})};return{transform:u,locationIterator:l,theme:c}}e.createSimple=t;function r(o,s){return{alpha:N.create(o.alpha),uAlpha:N.create(o.alpha),uVertexCount:N.create(s.vertexCount),uGroupCount:N.create(s.groupCount),drawCount:N.create(s.drawCount)}}e.createValues=r;function n(o,s){N.updateIfChanged(o.alpha,s.alpha)}e.updateValues=n;function a(o){o===void 0&&(o={});var s=o.alpha===void 0?!0:o.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:s,writeDepth:s,noClip:!1}}e.createRenderableState=a;function i(o,s){o.opaque=s.alpha*o.alphaFactor>=1,o.writeDepth=o.opaque}e.updateRenderableState=i})(At||(At={}));function ff(e,t){return{value:e,unit:t}}var X1;(function(e){function t(u,l,c){var d=!!u[0].cell,f=!!u[0].velocities,h=!!u[0].forces;return{id:pn.create22(),frames:u,hasCell:d,hasVelocities:f,hasForces:h,deltaTime:l,timeOffset:c}}e.create=t;function r(u,l,c){var d=u.x,f=u.y,h=u.z;return u.xyzOrdering.frozen?c?u.xyzOrdering.isIdentity?(d=o(d,c),f=o(f,c),h=o(h,c)):to(u.xyzOrdering.index,c)||(d=i(d,u.xyzOrdering.index,c),f=i(f,u.xyzOrdering.index,c),h=i(h,u.xyzOrdering.index,c)):u.xyzOrdering.isIdentity||(d=s(d,u.xyzOrdering.index),f=s(f,u.xyzOrdering.index),h=s(h,u.xyzOrdering.index)):c&&(u.xyzOrdering.isIdentity?(u.xyzOrdering.isIdentity=!1,u.xyzOrdering.index=c,a(d,c),a(f,c),a(h,c)):to(u.xyzOrdering.index,c)||(d=i(d,u.xyzOrdering.index,c),f=i(f,u.xyzOrdering.index,c),h=i(h,u.xyzOrdering.index,c))),u.xyzOrdering.frozen=!0,{id:pn.create22(),atomId:l,occupancy:me.ofConst(1,u.elementCount,me.Schema.int),B_iso_or_equiv:me.ofConst(0,u.elementCount,me.Schema.float),xyzDefined:!0,x:d,y:f,z:h}}e.getAtomicConformation=r;var n=[.123];function a(u,l){for(var c=n,d=0,f=u.length;d<f;d++)c[d]=u[l[d]];for(var d=0,f=u.length;d<f;d++)u[d]=c[d]}function i(u,l,c){for(var d=new Float32Array(u.length),f=0,h=u.length;f<h;f++)d[f]=u[l[c[f]]];return d}function o(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[d]=u[l[d]];return c}function s(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[l[d]]=u[d];return c}})(X1||(X1={}));var CM;(function(e){function t(r,n,a,i){return{id:pn.create22(),label:r,basic:n,sourceData:i,bonds:a}}e.create=t})(CM||(CM={}));function Po(e){return e}(function(e){function t(r){return r.__key||(r.__key=pn.create22()),r.__key}e.getUUID=t})(Po||(Po={}));var Nl=function(){function e(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._set.has(t)||(this._list.push(t),this._set.add(t))},e.prototype.reference=function(t,r){var n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))},e.prototype.hasReference=function(t){return(this._refs.get(t)||0)>0},e.prototype.has=function(t){return this._set.has(t)},e.prototype.assets=function(t,r){var n=this._assets.get(t);if(n)for(var a=0,i=n;a<i.length;a++){var o=i[a];o.dispose()}r?this._assets.set(t,r):this._assets.delete(t)},e.prototype.dispose=function(){this._assets.forEach(function(t){for(var r=0,n=t;r<n.length;r++){var a=n[r];a.dispose()}})},e}();function jAe(e,t){var r=[],n=[],a=[];e.x.length&&(r.push.apply(r,Bo(e.x)),n.push.apply(n,Bo(e.y)),a.push.apply(a,Bo(e.z))),t&&(t.spheres.x.length&&(r.push.apply(r,Bo(t.spheres.x)),n.push.apply(n,Bo(t.spheres.y)),a.push.apply(a,Bo(t.spheres.z))),t.gaussians.x.length&&(r.push.apply(r,Bo(t.gaussians.x)),n.push.apply(n,Bo(t.gaussians.y)),a.push.apply(a,Bo(t.gaussians.z))));var i=Bo(r),o=i[0],s=i[1],u=Bo(n),l=u[0],c=u[1],d=Bo(a),f=d[0],h=d[1],v=o+(s-o)/2,p=l+(c-l)/2,g=f+(h-f)/2;return _.create(v,p,g)}function zAe(e){var t=new Set,r=new Set;return e.properties.structAsymMap.forEach(function(n,a){var i=n.auth_id;t.add(i),r.add(a)}),{auth:t.size,label:r.size}}var To;(function(e){function t(d,f){if(d===f)return!0;if(d.vertexCount!==f.vertexCount||d.edgeCount!==f.edgeCount)return!1;for(var h=d.a,v=d.b,p=d.offset,g=f.a,m=f.b,y=f.offset,b=0,S=d.a.length;b<S;b++)if(h[b]!==g[b])return!1;for(var b=0,S=d.b.length;b<S;b++)if(v[b]!==m[b])return!1;for(var b=0,S=d.offset.length;b<S;b++)if(p[b]!==y[b])return!1;for(var x=0,C=Object.keys(d.edgeProps);x<C.length;x++){var w=C[x],A=d.edgeProps[w],I=f.edgeProps[w];if(!I)return!1;for(var b=0,S=A.length;b<S;b++)if(A[b]!==I[b])return!1}return!0}e.areEqual=t;var r=function(){function d(f,h,v,p,g,m){this.offset=f,this.a=h,this.b=v,this.edgeCount=p,this.props=m,this.vertexCount=f.length-1,this.edgeProps=g||{}}return d.prototype.getEdgeIndex=function(f,h){var v,p;f<h?(v=f,p=h):(v=h,p=f);for(var g=this.offset[v],m=this.offset[v+1];g<m;g++)if(this.b[g]===p)return g;return-1},d.prototype.getDirectedEdgeIndex=function(f,h){for(var v=this.offset[f],p=this.offset[f+1];v<p;v++)if(this.b[v]===h)return v;return-1},d.prototype.getVertexEdgeCount=function(f){return this.offset[f+1]-this.offset[f]},d}();function n(d,f,h,v,p,g){return new r(d,f,h,v,p,g)}e.create=n;var a=function(){function d(f,h,v){this.vertexCount=f,this.xs=h,this.ys=v,this.current=0,this.curA=0,this.curB=0,this.edgeCount=h.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var p=new Int32Array(this.vertexCount),g=0,m=this.xs.length;g<m;g++)p[this.xs[g]]++;for(var g=0,m=this.ys.length;g<m;g++)p[this.ys[g]]++;for(var y=0,g=0;g<this.vertexCount;g++)this.offsets[g]=y,y+=p[g];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,h){return n(this.offsets,this.a,this.b,this.edgeCount,f,h)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],h=this.ys[this.current],v=this.offsets[f]+this.bucketFill[f],p=this.offsets[h]+this.bucketFill[h];this.a[v]=f,this.b[v]=h,this.bucketFill[f]++,this.a[p]=h,this.b[p]=f,this.bucketFill[h]++,this.current++,this.curA=v,this.curB=p},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,h){f[this.curA]=h,f[this.curB]=h},d}();e.EdgeBuilder=a;var i=function(){function d(f,h,v){this.vertexCount=f,this.xs=h,this.ys=v,this.current=0,this.curA=0,this.edgeCount=h.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var p=new Int32Array(this.vertexCount),g=0,m=this.xs.length;g<m;g++)p[this.xs[g]]++;for(var y=0,g=0;g<this.vertexCount;g++)this.offsets[g]=y,y+=p[g];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f){return n(this.offsets,this.a,this.b,this.edgeCount,f)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],h=this.ys[this.current],v=this.offsets[f]+this.bucketFill[f];this.a[v]=f,this.b[v]=h,this.bucketFill[f]++,this.current++,this.curA=v},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,h){f[this.curA]=h},d}();e.DirectedEdgeBuilder=i;var o=function(){function d(f){this.vertexCount=f,this.xs=[],this.ys=[],this.included=new Set}return d.prototype.addEdge=function(f,h){var v=f,p=h;f>h&&(v=h,p=f);var g=Uf(v,p);return this.included.has(g)?!1:(this.included.add(g),this.xs[this.xs.length]=v,this.ys[this.ys.length]=p,!0)},d.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},d.prototype.getEdgeBuiler=function(){return new a(this.vertexCount,this.xs,this.ys)},d}();e.UniqueEdgeBuilder=o;function s(d,f,h){var v=new e.EdgeBuilder(d,f,h);return v.addAllEdges(),v.createGraph({})}e.fromVertexPairs=s;function u(d,f){for(var h=d.b,v=d.offset,p=d.vertexCount,g=d.edgeProps,m=new Int32Array(p),y=0,b=f.length;y<b;y++)m[f[y]]=y+1;for(var S=0,y=0;y<p;y++)if(m[y]!==0)for(var x=v[y],C=v[y+1];x<C;x++)h[x]>y&&m[h[x]]!==0&&S++;for(var w=new Int32Array(f.length+1),A=new Int32Array(2*S),I=new Int32Array(2*S),D=new Int32Array(2*S),k=0,R=0,y=0;y<p;y++)if(m[y]!==0){for(var L=m[y]-1,x=v[y],C=v[y+1];x<C;x++){var H=m[h[x]];H!==0&&(I[k]=L,D[k]=H-1,A[k]=x,k++)}w[++R]=k}for(var B={},j=0,Q=Object.keys(g);j<Q.length;j++){var G=Q[j];B[G]=tCe(g[G],A)}return n(w,I,D,S,B)}e.induceByVertices=u;function l(d){var f=d.vertexCount;if(f===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(d.edgeCount===0){for(var h=new Int32Array(f),v=0,p=f;v<p;v++)h[v]=v;return{componentCount:f,componentIndex:h}}for(var g=new Int32Array(f),v=0,p=f;v<p;v++)g[v]=-1;var m=0;g[0]=m;var y=d.offset,b=d.b,S=[0],x=y_e(f);for(x.remove(0);S.length>0;){for(var C=S.pop(),w=g[C],A=y[C],I=y[C+1];A<I;A++){var D=b[A];x.has(D)&&(x.remove(D),S.push(D),g[D]=w)}S.length===0&&x.head>=0&&(S.push(x.head),g[x.head]=++m,x.remove(x.head))}return{componentCount:f,componentIndex:g}}e.connectedComponents=l;function c(d,f,h,v){if(it.areIntersecting(f,h))return!0;if(v<1)return!1;for(var p=new Set,g=0,m=f.length;g<m;++g)p.add(f[g]);return wY(d,f,h,v,p)}e.areVertexSetsConnected=c})(To||(To={}));function wY(e,t,r,n,a){for(var i=e.b,o=e.offset,s=[],u=0,l=t.length;u<l;++u)for(var c=t[u],d=o[c],f=o[c+1];d<f;++d){var h=i[d];if(!a.has(h)){if(it.has(r,h))return!0;a.add(h),s[s.length]=h}}return n>1?wY(e,s,r,n-1,a):!1}var VAe=function(){function e(){this.map=new Map,this.applicable=new Map}return e.prototype.add=function(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)},e.prototype.remove=function(t){this.map.delete(t),this.applicable.delete(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.isApplicable=function(t){var r=this.applicable.get(t.sourceData.kind);return r?r(t):!0},e}(),ju;(function(e){function t(r){var n=r.name,a=new VAe;return{descriptor:r,formatRegistry:a,isApplicable:function(i){return a.isApplicable(i)},get:function(i){if(i._staticPropertyData[n])return i._staticPropertyData[n];if(!i.customProperties.has(r)){var o=a.get(i.sourceData.kind);if(o)return i._staticPropertyData[n]=o(i),i.customProperties.add(r),i._staticPropertyData[n]}},set:function(i,o){i._staticPropertyData[n]=o},delete:function(i){delete i._staticPropertyData[n]}}}e.create=t})(ju||(ju={}));function HAe(e,t,r,n){for(var a=new To.EdgeBuilder(n,e,t),i=new Int8Array(a.slotCount),o=new Array(a.slotCount),s=new Array(a.slotCount),u=0,l=a.edgeCount;u<l;u++)a.addNextEdge(),a.assignProperty(i,r.order?r.order[u]:1),a.assignProperty(o,r.distance?r.distance[u]:-1),a.assignProperty(s,r.flag?r.flag[u]:1);return a.createGraph({order:i,distance:o,flag:s})}var gi;(function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=ju.create(e.Descriptor);function t(r){var n=r.pairs,a=r.count,i=n.indexA.toArray(),o=n.indexB.toArray(),s=n.order&&n.order.toArray(),u=n.distance&&n.distance.toArray(),l=n.flag&&n.flag.toArray();return HAe(i,o,{order:s,distance:u,flag:l},a)}e.fromData=t})(gi||(gi={}));var mh=me.Schema,ne=mh.str,Ne=mh.int,ur=mh.float,aP=mh.coord,Mt=mh.Aliased,Rd=mh.Matrix,j2=mh.Vector,Ch=mh.List,mr={atom_site:{auth_asym_id:ne,auth_atom_id:ne,auth_comp_id:ne,auth_seq_id:Ne,B_iso_or_equiv:ur,Cartn_x:aP,Cartn_y:aP,Cartn_z:aP,group_PDB:Mt(ne),id:Ne,label_alt_id:ne,label_asym_id:ne,label_atom_id:ne,label_comp_id:ne,label_entity_id:ne,label_seq_id:Ne,occupancy:ur,type_symbol:ne,pdbx_PDB_ins_code:ne,pdbx_PDB_model_num:Ne,pdbx_formal_charge:Ne,ihm_model_id:Ne},atom_site_anisotrop:{id:Ne,type_symbol:ne,U:Rd(3,3),U_esd:Rd(3,3),pdbx_auth_seq_id:ne,pdbx_auth_asym_id:ne,pdbx_auth_atom_id:ne,pdbx_auth_comp_id:ne,pdbx_label_seq_id:Ne,pdbx_label_alt_id:ne,pdbx_label_asym_id:ne,pdbx_label_atom_id:ne,pdbx_label_comp_id:ne,pdbx_PDB_ins_code:ne},atom_sites:{entry_id:ne,fract_transf_matrix:Rd(3,3),fract_transf_vector:j2(3)},audit_author:{name:ne,pdbx_ordinal:Ne,identifier_ORCID:ne},audit_conform:{dict_location:ne,dict_name:ne,dict_version:ne},cell:{angle_alpha:ur,angle_beta:ur,angle_gamma:ur,entry_id:ne,length_a:ur,length_b:ur,length_c:ur,Z_PDB:Ne,pdbx_unique_axis:ne},chem_comp:{formula:ne,formula_weight:ur,id:ne,mon_nstd_flag:Mt(ne),name:ne,type:Mt(ne),pdbx_synonyms:Ch(";",function(e){return e})},chem_comp_bond:{atom_id_1:ne,atom_id_2:ne,comp_id:ne,value_order:Mt(ne),pdbx_ordinal:Ne,pdbx_stereo_config:Mt(ne),pdbx_aromatic_flag:Mt(ne)},citation:{book_publisher:ne,country:ne,id:ne,journal_abbrev:ne,journal_id_ASTM:ne,journal_id_CSD:ne,journal_id_ISSN:ne,journal_volume:ne,page_first:ne,page_last:ne,title:ne,year:Ne,pdbx_database_id_DOI:ne,pdbx_database_id_PubMed:Ne},citation_author:{citation_id:ne,name:ne,ordinal:Ne},database_2:{database_id:Mt(ne),database_code:ne},entity:{details:ne,formula_weight:ur,id:ne,src_method:Mt(ne),type:Mt(ne),pdbx_description:Ch(",",function(e){return e}),pdbx_number_of_molecules:Ne,pdbx_mutation:ne,pdbx_fragment:ne,pdbx_ec:Ch(",",function(e){return e})},entity_poly:{entity_id:ne,nstd_linkage:Mt(ne),nstd_monomer:Mt(ne),type:Mt(ne),pdbx_strand_id:Ch(",",function(e){return e}),pdbx_seq_one_letter_code:ne,pdbx_seq_one_letter_code_can:ne,pdbx_target_identifier:ne},entity_poly_seq:{entity_id:ne,hetero:Mt(ne),mon_id:ne,num:Ne},entry:{id:ne},exptl:{entry_id:ne,method:Mt(ne)},struct:{entry_id:ne,title:ne,pdbx_descriptor:ne},struct_asym:{details:ne,entity_id:ne,id:ne,pdbx_modified:ne,pdbx_blank_PDB_chainid_flag:Mt(ne)},struct_conf:{beg_label_asym_id:ne,beg_label_comp_id:ne,beg_label_seq_id:Ne,beg_auth_asym_id:ne,beg_auth_comp_id:ne,beg_auth_seq_id:Ne,conf_type_id:Mt(ne),details:ne,end_label_asym_id:ne,end_label_comp_id:ne,end_label_seq_id:Ne,end_auth_asym_id:ne,end_auth_comp_id:ne,end_auth_seq_id:Ne,id:ne,pdbx_beg_PDB_ins_code:ne,pdbx_end_PDB_ins_code:ne,pdbx_PDB_helix_class:ne,pdbx_PDB_helix_length:Ne,pdbx_PDB_helix_id:ne},struct_conn:{conn_type_id:Mt(ne),details:ne,id:ne,ptnr1_label_asym_id:ne,ptnr1_label_atom_id:ne,ptnr1_label_comp_id:ne,ptnr1_label_seq_id:Ne,ptnr1_auth_asym_id:ne,ptnr1_auth_comp_id:ne,ptnr1_auth_seq_id:Ne,ptnr1_symmetry:ne,ptnr2_label_asym_id:ne,ptnr2_label_atom_id:ne,ptnr2_label_comp_id:ne,ptnr2_label_seq_id:Ne,ptnr2_auth_asym_id:ne,ptnr2_auth_comp_id:ne,ptnr2_auth_seq_id:Ne,ptnr2_symmetry:ne,pdbx_ptnr1_PDB_ins_code:ne,pdbx_ptnr1_label_alt_id:ne,pdbx_ptnr1_standard_comp_id:ne,pdbx_ptnr2_PDB_ins_code:ne,pdbx_ptnr2_label_alt_id:ne,pdbx_ptnr3_PDB_ins_code:ne,pdbx_ptnr3_label_alt_id:ne,pdbx_ptnr3_label_asym_id:ne,pdbx_ptnr3_label_atom_id:ne,pdbx_ptnr3_label_comp_id:ne,pdbx_ptnr3_label_seq_id:Ne,pdbx_PDB_id:ne,pdbx_dist_value:ur,pdbx_value_order:Mt(ne)},struct_conn_type:{criteria:ne,id:Mt(ne),reference:ne},struct_keywords:{entry_id:ne,text:Ch(",",function(e){return e}),pdbx_keywords:ne},struct_ncs_oper:{code:Mt(ne),details:ne,id:Ne,matrix:Rd(3,3),vector:j2(3)},struct_sheet_range:{beg_label_asym_id:ne,beg_label_comp_id:ne,beg_label_seq_id:Ne,end_label_asym_id:ne,end_label_comp_id:ne,end_label_seq_id:Ne,beg_auth_asym_id:ne,beg_auth_comp_id:ne,beg_auth_seq_id:Ne,end_auth_asym_id:ne,end_auth_comp_id:ne,end_auth_seq_id:Ne,id:ne,sheet_id:ne,pdbx_beg_PDB_ins_code:ne,pdbx_end_PDB_ins_code:ne},struct_site:{details:ne,id:ne,pdbx_num_residues:Ne,pdbx_evidence_code:ne,pdbx_auth_asym_id:ne,pdbx_auth_comp_id:ne,pdbx_auth_seq_id:ne,pdbx_auth_ins_code:ne},struct_site_gen:{details:ne,id:ne,label_alt_id:ne,label_asym_id:ne,label_atom_id:ne,label_comp_id:ne,label_seq_id:Ne,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ne,site_id:ne,symmetry:ne,pdbx_auth_ins_code:ne,pdbx_num_res:Ne},symmetry:{entry_id:ne,cell_setting:Mt(ne),Int_Tables_number:Ne,space_group_name_Hall:ne,"space_group_name_H-M":ne},pdbx_database_status:{status_code:Mt(ne),status_code_sf:Mt(ne),status_code_mr:Mt(ne),entry_id:ne,recvd_initial_deposition_date:ne,SG_entry:Mt(ne),deposit_site:Mt(ne),process_site:Mt(ne),status_code_cs:Mt(ne),methods_development_category:Mt(ne),pdb_format_compatible:Mt(ne)},pdbx_nonpoly_scheme:{asym_id:ne,entity_id:ne,mon_id:ne,pdb_strand_id:ne,ndb_seq_num:ne,pdb_seq_num:ne,auth_seq_num:ne,pdb_mon_id:ne,auth_mon_id:ne,pdb_ins_code:ne},pdbx_database_related:{db_name:ne,details:ne,db_id:ne,content_type:Mt(ne)},pdbx_entity_nonpoly:{entity_id:ne,comp_id:ne,name:ne},pdbx_chem_comp_synonyms:{name:ne,comp_id:ne,provenance:Mt(ne)},pdbx_chem_comp_identifier:{comp_id:ne,identifier:ne,type:Mt(ne),program:ne,program_version:ne},pdbx_unobs_or_zero_occ_residues:{id:Ne,polymer_flag:Mt(ne),occupancy_flag:Mt(Ne),PDB_model_num:Ne,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ne,PDB_ins_code:ne,label_asym_id:ne,label_comp_id:ne,label_seq_id:Ne},pdbx_struct_mod_residue:{id:Ne,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:Ne,PDB_ins_code:ne,label_asym_id:ne,label_comp_id:ne,label_seq_id:Ne,parent_comp_id:ne,details:ne},pdbx_struct_oper_list:{id:ne,type:Mt(ne),name:ne,symmetry_operation:ne,matrix:Rd(3,3),vector:j2(3)},pdbx_struct_assembly:{method_details:ne,oligomeric_details:ne,oligomeric_count:Ne,details:ne,id:ne},pdbx_struct_assembly_gen:{asym_id_list:Ch(",",function(e){return e}),assembly_id:ne,oper_expression:ne},pdbx_reference_entity_list:{prd_id:ne,ref_entity_id:ne,type:Mt(ne),details:ne,component_id:Ne},pdbx_reference_entity_link:{link_id:Ne,prd_id:ne,details:ne,ref_entity_id_1:ne,ref_entity_id_2:ne,entity_seq_num_1:Ne,entity_seq_num_2:Ne,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,atom_id_2:ne,value_order:Mt(ne),component_1:Ne,component_2:Ne,link_class:Mt(ne)},pdbx_reference_entity_poly_link:{link_id:Ne,prd_id:ne,ref_entity_id:ne,component_id:Ne,entity_seq_num_1:Ne,entity_seq_num_2:Ne,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,atom_id_2:ne,value_order:Mt(ne)},pdbx_molecule:{prd_id:ne,instance_id:Ne,asym_id:ne},pdbx_molecule_features:{prd_id:ne,class:Mt(ne),type:Mt(ne),name:ne,details:ne},entity_src_nat:{entity_id:ne,pdbx_organism_scientific:ne,pdbx_plasmid_name:ne,pdbx_src_id:Ne,pdbx_beg_seq_num:Ne,pdbx_end_seq_num:Ne},entity_src_gen:{entity_id:ne,pdbx_gene_src_gene:Ch(",",function(e){return e}),pdbx_gene_src_scientific_name:ne,plasmid_name:ne,pdbx_src_id:Ne,pdbx_beg_seq_num:Ne,pdbx_end_seq_num:Ne},pdbx_entity_src_syn:{organism_scientific:ne,entity_id:ne,pdbx_src_id:Ne,pdbx_beg_seq_num:Ne,pdbx_end_seq_num:Ne},pdbx_entity_branch_descriptor:{entity_id:ne,descriptor:ne,type:Mt(ne),program:ne,program_version:ne,ordinal:Ne},pdbx_entity_instance_feature:{details:ne,feature_type:Mt(ne),auth_asym_id:ne,asym_id:ne,auth_seq_num:ne,seq_num:Ne,comp_id:ne,auth_comp_id:ne,ordinal:Ne},pdbx_entity_branch_list:{entity_id:ne,hetero:Mt(ne),comp_id:ne,num:Ne},pdbx_entity_branch_link:{link_id:Ne,details:ne,entity_id:ne,entity_branch_list_num_1:Ne,entity_branch_list_num_2:Ne,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,leaving_atom_id_1:ne,atom_stereo_config_1:Mt(ne),atom_id_2:ne,leaving_atom_id_2:ne,atom_stereo_config_2:Mt(ne),value_order:Mt(ne)},pdbx_entity_branch:{entity_id:ne,type:Mt(ne)},pdbx_branch_scheme:{entity_id:ne,hetero:Mt(ne),asym_id:ne,mon_id:ne,num:Ne,pdb_asym_id:ne,pdb_seq_num:ne,pdb_mon_id:ne,auth_asym_id:ne,auth_seq_num:ne,auth_mon_id:ne},pdbx_chem_comp_related:{comp_id:ne,related_comp_id:ne,relationship_type:Mt(ne),details:ne},ihm_starting_model_details:{starting_model_id:ne,entity_id:ne,entity_description:ne,asym_id:ne,entity_poly_segment_id:Ne,starting_model_source:Mt(ne),starting_model_auth_asym_id:ne,starting_model_sequence_offset:Ne,dataset_list_id:Ne},ihm_starting_comparative_models:{id:Ne,starting_model_id:ne,starting_model_auth_asym_id:ne,starting_model_seq_id_begin:Ne,starting_model_seq_id_end:Ne,template_auth_asym_id:ne,template_seq_id_begin:Ne,template_seq_id_end:Ne,template_sequence_identity:ur,template_sequence_identity_denominator:Mt(Ne),template_dataset_list_id:Ne,alignment_file_id:Ne},ihm_starting_model_seq_dif:{id:Ne,entity_id:ne,asym_id:ne,seq_id:Ne,comp_id:ne,starting_model_id:ne,db_asym_id:ne,db_seq_id:Ne,db_comp_id:ne,details:ne},ihm_model_representation:{id:Ne,name:ne,details:ne},ihm_model_representation_details:{id:Ne,representation_id:Ne,entity_poly_segment_id:Ne,entity_id:ne,entity_description:ne,entity_asym_id:ne,model_object_primitive:Mt(ne),starting_model_id:ne,model_mode:Mt(ne),model_granularity:Mt(ne),model_object_count:Ne},ihm_struct_assembly_details:{id:Ne,assembly_id:Ne,parent_assembly_id:Ne,entity_description:ne,entity_id:ne,asym_id:ne,entity_poly_segment_id:Ne},ihm_struct_assembly:{id:Ne,name:ne,description:ne},ihm_modeling_protocol:{id:Ne,num_steps:Ne,protocol_name:ne},ihm_modeling_protocol_details:{id:Ne,protocol_id:Ne,step_id:Ne,struct_assembly_id:Ne,dataset_group_id:Ne,struct_assembly_description:ne,step_name:ne,step_method:ne,num_models_begin:Ne,num_models_end:Ne,multi_scale_flag:Mt(ne),multi_state_flag:Mt(ne),ordered_flag:Mt(ne),script_file_id:Ne,software_id:Ne},ihm_multi_state_modeling:{state_id:Ne,state_group_id:Ne,population_fraction:ur,population_fraction_sd:ur,state_type:ne,state_name:ne,experiment_type:Mt(ne),details:ne},ihm_modeling_post_process:{id:Ne,protocol_id:Ne,analysis_id:Ne,step_id:Ne,type:Mt(ne),feature:Mt(ne),num_models_begin:Ne,num_models_end:Ne},ihm_ensemble_info:{ensemble_id:Ne,ensemble_name:ne,post_process_id:Ne,model_group_id:Ne,ensemble_clustering_method:Mt(ne),ensemble_clustering_feature:Mt(ne),num_ensemble_models:Ne,num_ensemble_models_deposited:Ne,ensemble_precision_value:ur,ensemble_file_id:Ne},ihm_model_list:{model_id:Ne,model_name:ne,assembly_id:Ne,protocol_id:Ne,representation_id:Ne},ihm_model_group:{id:Ne,name:ne,details:ne},ihm_model_group_link:{model_id:Ne,group_id:Ne},ihm_model_representative:{id:Ne,model_group_id:Ne,model_id:Ne,selection_criteria:Mt(ne)},ihm_dataset_list:{id:Ne,data_type:Mt(ne),database_hosted:Mt(ne)},ihm_dataset_group:{id:Ne,name:ne,application:Mt(ne),details:ne},ihm_dataset_group_link:{dataset_list_id:Ne,group_id:Ne},ihm_related_datasets:{dataset_list_id_derived:Ne,dataset_list_id_primary:Ne},ihm_dataset_related_db_reference:{id:Ne,dataset_list_id:Ne,db_name:Mt(ne),accession_code:ne,version:ne,details:ne},ihm_external_reference_info:{reference_id:Ne,reference_provider:ne,reference_type:Mt(ne),reference:ne,refers_to:Mt(ne),associated_url:ne},ihm_external_files:{id:Ne,reference_id:Ne,file_path:ne,content_type:Mt(ne),file_size_bytes:ur,details:ne},ihm_dataset_external_reference:{id:Ne,dataset_list_id:Ne,file_id:Ne},ihm_localization_density_files:{id:Ne,file_id:Ne,ensemble_id:Ne,entity_id:ne,entity_poly_segment_id:Ne,asym_id:ne},ihm_predicted_contact_restraint:{id:Ne,group_id:Ne,entity_id_1:ne,entity_id_2:ne,asym_id_1:ne,asym_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Ne,seq_id_2:Ne,rep_atom_1:Mt(ne),rep_atom_2:Mt(ne),distance_lower_limit:ur,distance_upper_limit:ur,probability:ur,restraint_type:Mt(ne),model_granularity:Mt(ne),dataset_list_id:Ne,software_id:Ne},ihm_cross_link_list:{id:Ne,group_id:Ne,entity_description_1:ne,entity_description_2:ne,entity_id_1:ne,entity_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Ne,seq_id_2:Ne,linker_type:Mt(ne),dataset_list_id:Ne},ihm_cross_link_restraint:{id:Ne,group_id:Ne,entity_id_1:ne,entity_id_2:ne,asym_id_1:ne,asym_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Ne,seq_id_2:Ne,atom_id_1:ne,atom_id_2:ne,restraint_type:Mt(ne),conditional_crosslink_flag:Mt(ne),model_granularity:Mt(ne),distance_threshold:ur,psi:ur,sigma_1:ur,sigma_2:ur},ihm_cross_link_result_parameters:{id:Ne,restraint_id:Ne,model_id:Ne,psi:ur,sigma_1:ur,sigma_2:ur},ihm_2dem_class_average_restraint:{id:Ne,dataset_list_id:Ne,number_raw_micrographs:Ne,pixel_size_width:ur,pixel_size_height:ur,image_resolution:ur,image_segment_flag:Mt(ne),number_of_projections:Ne,struct_assembly_id:Ne,details:ne},ihm_2dem_class_average_fitting:{id:Ne,restraint_id:Ne,model_id:Ne,cross_correlation_coefficient:ur,rot_matrix:Rd(3,3),tr_vector:j2(3)},ihm_3dem_restraint:{id:Ne,dataset_list_id:Ne,model_id:Ne,struct_assembly_id:Ne,fitting_method:ne,number_of_gaussians:Ne,cross_correlation_coefficient:ur},ihm_sas_restraint:{id:Ne,dataset_list_id:Ne,model_id:Ne,struct_assembly_id:Ne,profile_segment_flag:Mt(ne),fitting_atom_type:ne,fitting_method:ne,fitting_state:Mt(ne),radius_of_gyration:ur,chi_value:ur,details:ne},ihm_starting_model_coord:{ordinal_id:Ne,starting_model_id:ne,group_PDB:Mt(ne),id:Ne,type_symbol:ne,entity_id:ne,atom_id:ne,comp_id:ne,seq_id:Ne,asym_id:ne,Cartn_x:ur,Cartn_y:ur,Cartn_z:ur,B_iso_or_equiv:ur},ihm_sphere_obj_site:{id:Ne,entity_id:ne,seq_id_begin:Ne,seq_id_end:Ne,asym_id:ne,Cartn_x:ur,Cartn_y:ur,Cartn_z:ur,object_radius:ur,rmsf:ur,model_id:Ne},ihm_gaussian_obj_site:{id:Ne,entity_id:ne,seq_id_begin:Ne,seq_id_end:Ne,asym_id:ne,mean_Cartn_x:ur,mean_Cartn_y:ur,mean_Cartn_z:ur,weight:ur,covariance_matrix:Rd(3,3),model_id:Ne},ihm_gaussian_obj_ensemble:{id:Ne,entity_id:ne,seq_id_begin:Ne,seq_id_end:Ne,asym_id:ne,mean_Cartn_x:ur,mean_Cartn_y:ur,mean_Cartn_z:ur,weight:ur,covariance_matrix:Rd(3,3),ensemble_id:Ne},ihm_feature_list:{feature_id:Ne,feature_type:Mt(ne),entity_type:Mt(ne)},ihm_poly_residue_feature:{ordinal_id:Ne,feature_id:Ne,entity_id:ne,asym_id:ne,comp_id_begin:ne,comp_id_end:ne,seq_id_begin:Ne,seq_id_end:Ne},ihm_derived_distance_restraint:{id:Ne,group_id:Ne,feature_id_1:Ne,feature_id_2:Ne,group_conditionality:Mt(ne),random_exclusion_fraction:ur,distance_upper_limit:ur,restraint_type:Mt(ne),dataset_list_id:Ne}},GAe={type_symbol:me.Schema.Aliased(mr.atom_site.type_symbol),label_atom_id:mr.atom_site.label_atom_id,auth_atom_id:mr.atom_site.auth_atom_id,label_alt_id:mr.atom_site.label_alt_id,label_comp_id:mr.atom_site.label_comp_id,auth_comp_id:mr.atom_site.auth_comp_id,pdbx_formal_charge:mr.atom_site.pdbx_formal_charge},qAe={group_PDB:mr.atom_site.group_PDB,label_seq_id:mr.atom_site.label_seq_id,auth_seq_id:mr.atom_site.auth_seq_id,pdbx_PDB_ins_code:mr.atom_site.pdbx_PDB_ins_code},WAe={label_asym_id:mr.atom_site.label_asym_id,auth_asym_id:mr.atom_site.auth_asym_id,label_entity_id:mr.atom_site.label_entity_id},_M;(function(e){function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}e.EmptyResidueKey=t})(_M||(_M={}));var Hp;(function(e){function t(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i]]}e.chainStartResidueIndex=t;function r(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i+1]-1]+1}e.chainEndResidueIndexExcl=r;function n(a,i){return r(a,i)-t(a,i)}e.chainResidueCount=n})(Hp||(Hp={}));var m3={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},$Ae={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},XAe={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},YAe=1.7,KAe=10.81,QAe=0;function Mb(e){var t=m3[e];return t===void 0?YAe:$Ae[t]}function ZAe(e){var t=m3[e];return t===void 0?KAe:XAe[t]}function Db(e){var t=m3[e];return t===void 0?QAe:t}function Ky(e,t){return t?t.length===1?Uf(t.charCodeAt(0),e):t.length===2?Uf(t.charCodeAt(0),Uf(t.charCodeAt(1),e)):e+" "+t:e}function JAe(e,t,r,n){if(e.has(t)){var a=e.get(t);a.has(r)||a.set(r,n)}else{var a=new Map;e.set(t,a),a.set(r,n)}}function ePe(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function tPe(e,t,r){return{entities:e,segments:r,label_seq_id:it.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var B0=_M.EmptyResidueKey(),rPe=function(){function e(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(t){return this.map.chain_index_entity_index[t]},e.prototype.findEntity=function(t){var r=this.map.label_asym_id.get(t);return r!==void 0?r:-1},e.prototype.findChainLabel=function(t){var r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;var n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1},e.prototype.findChainAuth=function(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;var r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1},e.prototype.findResidue=function(t,r,n,a){var i;arguments.length===1?i=t:(B0.label_entity_id=t,B0.label_asym_id=r,B0.auth_seq_id=n,B0.pdbx_PDB_ins_code=a,i=B0);var o=this.findChainLabel(i);if(o<0)return-1;var s=this.map.chain_index_auth_seq_id.get(o),u=Ky(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return s.has(u)?s.get(u):-1},e.prototype.findResidueAuth=function(t){var r=this.findChainAuth(t);if(r<0)return-1;var n=this.map.chain_index_auth_seq_id.get(r),a=Ky(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(a)?n.get(a):-1},e.prototype.findResidueInsertion=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),a=Ky(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(a))return n.get(a);var i=it.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),o=Hp.chainStartResidueIndex(this.map.segments,r);if(i<o)return o;var s=Hp.chainEndResidueIndexExcl(this.map.segments,r)-1;return i>=s?s:i},e.prototype.findAtom=function(t){var r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id>"u"?iP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):oP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)},e.prototype.findAtomAuth=function(t){var r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id>"u"?iP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):oP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)},e.prototype.findAtomOnResidue=function(t,r,n){return typeof n>"u"?iP(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):oP(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)},e.prototype.findAtomsOnResidue=function(t,r){return nPe(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)},e}();function iP(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}function nPe(e,t,r,n){for(var a=e;a<t;a++)if(n.has(r.value(a)))return a;return-1}function oP(e,t,r,n,a,i){for(var o=e;o<t;o++)if(r.value(o)===a&&n.value(o)===i)return o;return-1}function aPe(e,t,r){for(var n=tPe(t,e,r),a=e.residues,i=a.label_seq_id,o=a.auth_seq_id,s=a.pdbx_PDB_ins_code,u=e.chains,l=u.label_entity_id,c=u.label_asym_id,d=u.auth_asym_id,f=Re.ofBounds(0,e.atoms._rowCount),h=ar.transientSegments(r.chainAtomSegments,f);h.hasNext;){var v=h.move(),p=v.index,g=t.getEntityIndex(l.value(p));g<0&&ePe(l.value(p)),n.chain_index_entity_index[p]=g;var m=d.value(p),y=n.auth_asym_id_auth_seq_id.get(m);y||(y=new Map,n.auth_asym_id_auth_seq_id.set(m,y));var b=c.value(p);n.label_asym_id.has(b)||n.label_asym_id.set(b,g),JAe(n.entity_index_label_asym_id,g,b,p);var S=new Map,x=new Map;n.chain_index_label_seq_id.set(p,S),n.chain_index_auth_seq_id.set(p,x);for(var C=ar.transientSegments(r.residueAtomSegments,f,v);C.hasNext;){var w=C.move(),A=w.index,I=o.value(A),D=s.value(A);S.set(Ky(i.value(A),D),A),x.set(Ky(I,D),A),y.set(I,p)}}return new rPe(n)}var uo,lo,Dt={Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817};uo={},uo[0]="Hexose",uo[1]="HexNAc",uo[2]="Hexosamine",uo[3]="Hexuronate",uo[4]="Deoxyhexose",uo[5]="DeoxyhexNAc",uo[6]="Di-deoxyhexose",uo[7]="Pentose",uo[8]="Deoxynonulosonate",uo[9]="Di-deoxynonulosonate",uo[10]="Unknown",uo[11]="Assigned";var iPe=(lo={},lo[0]=0,lo[1]=1,lo[2]=2,lo[3]=3,lo[4]=4,lo[5]=5,lo[6]=6,lo[7]=7,lo[8]=8,lo[9]=9,lo[10]=10,lo[11]=11,lo);function oPe(e,t){return e===10?t===4?12:t===5?13:t===6?14:t===7?15:10:iPe[e]}var EY={abbr:"Unk",name:"Unknown",color:Dt.Secondary,type:10},XC=[{abbr:"Glc",name:"Glucose",color:Dt.Blue,type:0},{abbr:"Man",name:"Mannose",color:Dt.Green,type:0},{abbr:"Gal",name:"Galactose",color:Dt.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:Dt.Orange,type:0},{abbr:"Alt",name:"Altrose",color:Dt.Pink,type:0},{abbr:"All",name:"Allose",color:Dt.Purple,type:0},{abbr:"Tal",name:"Talose",color:Dt.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:Dt.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:Dt.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:Dt.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:Dt.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:Dt.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:Dt.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:Dt.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:Dt.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:Dt.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:Dt.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:Dt.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:Dt.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:Dt.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:Dt.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:Dt.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:Dt.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:Dt.Brown,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:Dt.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:Dt.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:Dt.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:Dt.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:Dt.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:Dt.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:Dt.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:Dt.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:Dt.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:Dt.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:Dt.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:Dt.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:Dt.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:Dt.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:Dt.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:Dt.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:Dt.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:Dt.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:Dt.Red,type:5},{abbr:"Oli",name:"Olivose",color:Dt.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:Dt.Green,type:6},{abbr:"Abe",name:"Abequose",color:Dt.Orange,type:6},{abbr:"Par",name:"Paratose",color:Dt.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:Dt.Purple,type:6},{abbr:"Col",name:"Colitose",color:Dt.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:Dt.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:Dt.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:Dt.Orange,type:7},{abbr:"Rib",name:"Ribose",color:Dt.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:Dt.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:Dt.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:Dt.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:Dt.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:Dt.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:Dt.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:Dt.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:Dt.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:Dt.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:Dt.Blue,type:10},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:Dt.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:Dt.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:Dt.Orange,type:10},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:Dt.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:Dt.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:Dt.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:Dt.Brown,type:10},{abbr:"Api",name:"Apicose",color:Dt.Green,type:11},{abbr:"Fru",name:"Fructose",color:Dt.Green,type:11},{abbr:"Tag",name:"Tagatose",color:Dt.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:Dt.Orange,type:11},{abbr:"Psi",name:"Psicose",color:Dt.Pink,type:11}],sPe=function(){for(var e=new Map,t=0,r=XC.length;t<r;++t){var n=XC[t];e.set(n.abbr,n)}return e}(),uPe=[["Glc-family",Dt.Blue],["Man-family",Dt.Green],["Gal-family",Dt.Yellow],["Gul-family",Dt.Orange],["Alt-family",Dt.Pink],["All-family",Dt.Purple],["Tal-family",Dt.LightBlue],["Ido-family",Dt.Brown],["Fuc-family",Dt.Red],["Generic/Unknown/Secondary",Dt.Secondary]],lPe={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},Q8=["NGZ","LAT","PUF","GDA","9WJ"],bp=function(){for(var e=new Map,t=0,r=XC.length;t<r;++t){var n=XC[t],a=lPe[n.abbr];if(a)for(var i=0,o=a.length;i<o;++i)e.set(a[i],n)}for(var t=0,r=Q8.length;t<r;++t)e.set(Q8[t],EY);return e}(),fa;(function(e){function t(h){return uk(h.values())}e.toArray=t;function r(h,v){var p=!0;return v.forEach(function(g){h.has(g)||(p=!1)}),p}e.isSuperset=r;function n(h){for(var v=[],p=1;p<arguments.length;p++)v[p-1]=arguments[p];for(var g=0;g<v.length;g++)v[g].forEach(function(m){return h.add(m)});return h}e.add=n;function a(h,v){var p=new Set(h);return v.forEach(function(g){return p.add(g)}),p}e.union=a;function i(){for(var h=[],v=0;v<arguments.length;v++)h[v]=arguments[v];if(h.length===0)return new Set;h.length===1&&new Set(h[0]);for(var p=new Set(h[0]),g=1,m=h.length;g<m;g++)h[g].forEach(function(y){return p.add(y)});return p}e.unionMany=i;function o(h){if(h.length===0)return new Set;for(var v=new Set(h[0]),p=1;p<h.length;p++)for(var g=0,m=h[p];g<m.length;g++){var y=m[g];v.add(y)}return v}e.unionManyArrays=o;function s(h,v){var p=new Set;return v.forEach(function(g){h.has(g)&&p.add(g)}),p}e.intersection=s;function u(h,v){var p=!1;return v.forEach(function(g){h.has(g)&&(p=!0)}),p}e.areIntersecting=u;function l(h,v){var p=0;return v.forEach(function(g){h.has(g)&&(p+=1)}),p}e.intersectionSize=l;function c(h,v){var p=new Set(h);return v.forEach(function(g){return p.delete(g)}),p}e.difference=c;function d(h,v){var p=h.size;return h.forEach(function(g){v.has(g)&&(p-=1)}),p}e.differenceSize=d;function f(h,v){if(h.size!==v.size)return!1;var p=!0;return v.forEach(function(g){h.has(g)||(p=!1)}),p}e.areEqual=f})(fa||(fa={}));var AY=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),PY=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),Wl,cPe=function(){for(var e=Object.create(null),t=[],r="A".charCodeAt(0);r<="Z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="a".charCodeAt(0);r<="z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="0".charCodeAt(0);r<="9".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var n=0,a=t;n<a.length;n++){var i=a[n];e[i]=i.toUpperCase();for(var o=0,s=t;o<s.length;o++){var u=s[o];e[i+u]=(i+u).toUpperCase();for(var l=0,c=t;l<c.length;l++){var d=c[l];e[i+u+d]=(i+u+d).toUpperCase()}}}return e}();function Qg(e){return cPe[e]||e.toUpperCase()}var Z8=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(function(e){return[e[0],Qg(e[1])]}));function dPe(e){return Z8.has(e)?Z8.get(e):Qg("H")}var fPe=(Wl={},Wl[0]={trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},Wl[1]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},Wl[2]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},Wl[3]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},Wl[4]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Wl[5]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Wl[6]={trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])},Wl),$c=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),g3=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),TY=new Set(["D-PEPTIDE LINKING","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-BETA-PEPTIDE, C-GAMMA LINKING"]),IY=new Set(["L-PEPTIDE LINKING","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),hPe=new Set(["D-GAMMA-PEPTIDE, C-DELTA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING"]),pPe=new Set(["D-BETA-PEPTIDE, C-GAMMA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),vPe=new Set(["D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS"]),MY=new Set(["PEPTIDE LINKING","PEPTIDE-LIKE"]),mPe=fa.unionMany(TY,IY,MY),DY=new Set(["DNA LINKING","L-DNA LINKING","DNA OH 5 PRIME TERMINUS","DNA OH 3 PRIME TERMINUS"]),RY=new Set(["RNA LINKING","L-RNA LINKING","RNA OH 5 PRIME TERMINUS","RNA OH 3 PRIME TERMINUS"]),kY=new Set(["D-SACCHARIDE, BETA LINKING","L-SACCHARIDE, BETA LINKING","D-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE","D-SACCHARIDE","SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING"]),gPe=new Set(["NON-POLYMER","OTHER"]),yPe=new Set(["ION"]),bPe=new Set(["LIPID"]),y3=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),Ok=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),OY=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),b3=fa.unionMany(Ok,OY),x3=new Set(["A","C","T","G","I","U","N"]),S3=new Set(["DA","DC","DT","DG","DI","DU","DN"]),Lk=new Set(["APN","CPN","TPN","GPN"]),xPe=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),SPe=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),C3=fa.unionMany(x3,S3,Lk),LY=function(e){return xPe.has(e.toUpperCase())},NY=function(e){return SPe.has(e.toUpperCase())},Rb=fa.unionMany(b3,C3);function Zg(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),Lk.has(t)?8:mPe.has(e)?5:RY.has(e)?6:DY.has(e)?7:kY.has(e)?9:y3.has(t)?2:PY.has(t)?3:AY.has(t)?4:gPe.has(e)?bp.has(t)?9:1:0}function CPe(e,t){return e=e.toUpperCase(),t===5?hPe.has(e)?2:pPe.has(e)?3:vPe.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function FY(e){return e=e.toUpperCase(),b3.has(e)?"peptide linking":x3.has(e)?"RNA linking":S3.has(e)?"DNA linking":bp.has(e)?"saccharide":"other"}function _Pe(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:Rb.has(e)?"y":"n",pdbx_synonyms:[],type:FY(e)}}function wPe(e){return e=e.toUpperCase(),y3.has(e)?"water":Rb.has(e)?"polymer":bp.has(e)?"branched":"non-polymer"}function EPe(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),IY.has(t)?"polypeptide(L)":TY.has(t)?"polypeptide(D)":RY.has(t)?"polyribonucleotide":DY.has(t)?"polydeoxyribonucleotide":kY.has(t)||bp.has(e)?"oligosaccharide":Lk.has(e)?"peptide nucleic acid":Ok.has(e)?"polypeptide(L)":OY.has(e)?"polypeptide(D)":x3.has(e)?"polyribonucleotide":S3.has(e)?"polydeoxyribonucleotide":yPe.has(t)||PY.has(e)?"ion":bPe.has(t)||AY.has(e)?"lipid":MY.has(t)?"peptide-like":"other"}function Nk(e){return Fl(e)||BY(e)}function Fl(e){return e===7||e===6||e===8}function BY(e){return e===5}var Lr;(function(e){e.is=mi.has,e.create=mi.create,e.SecondaryStructureMmcif={HELX_LH_27_P:1058,HELX_LH_3T_P:2082,HELX_LH_AL_P:4130,HELX_LH_A_N:524321,HELX_LH_B_N:1048609,HELX_LH_GA_P:8226,HELX_LH_N:33,HELX_LH_OM_P:16418,HELX_LH_OT_N:131105,HELX_LH_OT_P:546,HELX_LH_P:34,HELX_LH_PI_P:32802,HELX_LH_PP_P:65570,HELX_LH_Z_N:262177,HELX_N:1,HELX_OT_N:1,HELX_OT_P:2,HELX_P:2,HELX_RH_27_P:1090,HELX_RH_3T_P:2114,HELX_RH_AL_P:4162,HELX_RH_A_N:524353,HELX_RH_B_N:1048641,HELX_RH_GA_P:8258,HELX_RH_N:65,HELX_RH_OM_P:16450,HELX_RH_OT_N:131137,HELX_RH_OT_P:578,HELX_RH_P:66,HELX_RH_PI_P:32834,HELX_RH_PP_P:65602,HELX_RH_Z_N:262209,STRN:4194308,TURN_OT_P:33554448,TURN_P:16,TURN_TY1P_P:67109136,TURN_TY1_P:67109008,TURN_TY2P_P:134218e3,TURN_TY2_P:134217872,TURN_TY3P_P:268435728,TURN_TY3_P:268435600},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}})(Lr||(Lr={}));var Nr;(function(e){e.is=mi.has;function t(s){return mi.create(s)}e.create=t;function r(s){return(s&1)!==0}e.isCovalent=r;function n(s){return s===Math.pow(2,6)-1}e.isAll=n,e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32};function a(s){return s in e.Names}e.isName=a;function i(s){switch(s){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.fromName=i;function o(s){for(var u=0,l=0,c=s.length;l<c;++l)u|=i(s[l]);return u}e.fromNames=o})(Nr||(Nr={}));var wM={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]};function APe(e,t){var r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,a=e.coarseElements.seq_id_begin.value(t);return n.compId.value(a-1)}function Fk(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var r=APe(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return Zg(n.type,r)}return 0}var PPe=new Set;function wf(e,t){var r=fPe[e];if(r!==void 0){var n=r[t];if(n!==void 0)return n}return PPe}var J8=_.zero();function UY(e,t){for(var r=e.conformation.position,n=new Float32Array(t.length*3),a=e.elements,i=0,o=t.length;i<o;++i)r(a[t[i]],J8),_.toArray(J8,n,i*3);return n}function TPe(e,t,r,n){for(var a=e.atoms,i=a.label_comp_id,o=a.type_symbol,s=a._rowCount,u=e.residues._rowCount,l=t.residueAtomSegments.offsets,c=new Uint8Array(s),d=0;d<s;++d)c[d]=Db(o.value(d));for(var f=new Int32Array(u),h=new Int32Array(u),v=new Int32Array(u),p=new Uint8Array(u),g=new Uint8Array(u),m=new Map,y=new Map,d=0;d<u;++d){var b=i.value(l[d]),S=n,x=void 0,C=void 0;if(m.has(b))x=m.get(b),C=y.get(b);else{var w=void 0;S.has(b)?w=S.get(b).type:(Yg||console.info("chemComp not found",b),w=FY(b)),x=Zg(w,b),C=CPe(w,x),m.set(b,x),y.set(b,C)}p[d]=x,g[d]=C;var A=wf(C,"trace"),I=r.findAtomsOnResidue(d,A);if(I===-1){var D=wf(C,"coarseBackbone");I=r.findAtomsOnResidue(d,D)}f[d]=I;var k=wf(C,"directionFrom");h[d]=r.findAtomsOnResidue(d,k);var R=wf(C,"directionTo");v[d]=r.findAtomsOnResidue(d,R)}return{atom:{atomicNumber:c},residue:{traceElementIndex:f,directionFromElementIndex:h,directionToElementIndex:v,moleculeType:p,polymerType:g}}}function Km(e,t,r){for(var n=new Float32Array(e),a=0;a<n.length;a++)n[a]=t+r*a;return n}var gn;(function(e){e.DefaultName="1_555",e.Default=t(e.DefaultName,le.identity()),e.RotationTranslationEpsilon=.005;function t(v,p,g){var m=g||{},y=m.assembly,b=m.ncsId,S=m.hkl,x=m.spgrOp,C=S?_.clone(S):_();x=Da(x,-1),b=b||-1;var w=r(g);if(le.isIdentity(p))return{name:v,assembly:y,matrix:p,inverse:le.identity(),isIdentity:!0,hkl:C,spgrOp:x,ncsId:b,suffix:w};if(!le.isRotationAndTranslation(p,e.RotationTranslationEpsilon))throw new Error("Symmetry operator ("+v+") must be a composition of rotation and translation.");return{name:v,assembly:y,matrix:p,inverse:le.invert(le(),p),isIdentity:!1,hkl:C,spgrOp:x,ncsId:b,suffix:w}}e.create=t;function r(v){if(!v)return"";if(v.assembly)return"_"+v.assembly.operId;if(typeof v.spgrOp<"u"&&typeof v.hkl<"u"&&v.spgrOp!==-1){var p=v.hkl,g=p[0],m=p[1],y=p[2];return"-"+(v.spgrOp+1)+"_"+(5+g)+(5+m)+(5+y)}return v.ncsId!==-1?"_"+v.ncsId:""}function n(v,p){for(var g=le.identity(),m=0;m<3;m++)for(var y=0;y<3;y++)le.setValue(g,m,y,qn.getValue(v,m,y));return le.setTranslation(g,p),le.isRotationAndTranslation(g,e.RotationTranslationEpsilon)}e.checkIfRotationAndTranslation=n;function a(v,p,g,m){for(var y=le.identity(),b=0;b<3;b++)for(var S=0;S<3;S++)le.setValue(y,b,S,qn.getValue(p,b,S));return le.setTranslation(y,g),t(v,y,{ncsId:m})}e.ofRotationAndOffset=a;var i=Gn.identity(),o=Gn(),s=Gn(),u=_();function l(v,p,g){var m=p.inverse;if(p.isIdentity)return le.copy(v,m);var y=1-g;le.getRotation(o,m),Gn.slerp(o,i,o,y);var b=Gn.getAxisAngle(u,o);return le.fromRotation(v,b,u),le.setValue(v,0,3,y*le.getValue(m,0,3)),le.setValue(v,1,3,y*le.getValue(m,1,3)),le.setValue(v,2,3,y*le.getValue(m,2,3)),v}e.lerpFromIdentity=l;function c(v,p,g,m){if(Math.abs(m)<=1e-5)return le.copy(v,p);if(Math.abs(m-1)<=1e-5)return le.copy(v,g);le.getRotation(o,p),le.getRotation(s,g),Gn.slerp(s,o,s,m);var y=Gn.getAxisAngle(u,s);return le.fromRotation(v,y,u),le.setValue(v,0,3,Wo(le.getValue(p,0,3),le.getValue(g,0,3),m)),le.setValue(v,1,3,Wo(le.getValue(p,1,3),le.getValue(g,1,3),m)),le.setValue(v,2,3,Wo(le.getValue(p,2,3),le.getValue(g,2,3),m)),v}e.slerp=c;function d(v,p){var g=le.mul(le(),p.matrix,v.matrix);return t(p.name,g,p)}e.compose=d;function f(v,p,g){var m=e.createCoordinateMapper(e.Default,p),y=v.isIdentity?m:e.createCoordinateMapper(v,p),b=MPe(v,p),S=b.x,x=b.y,C=b.z;return{operator:v,coordinates:p,invariantPosition:m,position:y,x:S,y:x,z:C,r:g||IPe}}e.createMapping=f;function h(v,p){return v.isIdentity?OPe(p):LPe(v,p)}e.createCoordinateMapper=h})(gn||(gn={}));function IPe(e){return 0}function MPe(e,t){return e.isIdentity?{x:sP(t.x),y:sP(t.y),z:sP(t.z)}:{x:DPe(e,t),y:RPe(e,t),z:kPe(e,t)}}function sP(e){return function(r){return e[r]}}function _3(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}function DPe(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[0],s=r[4],u=r[8],l=r[12];return _3(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],h=a[d],v=i[d],p=r[3]*f+r[7]*h+r[11]*v+r[15]||1;return(o*f+s*h+u*v+l)/p}}function RPe(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[1],s=r[5],u=r[9],l=r[13];return _3(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],h=a[d],v=i[d],p=r[3]*f+r[7]*h+r[11]*v+r[15]||1;return(o*f+s*h+u*v+l)/p}}function kPe(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[2],s=r[6],u=r[10],l=r[14];return _3(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],h=a[d],v=i[d],p=r[3]*f+r[7]*h+r[11]*v+r[15]||1;return(o*f+s*h+u*v+l)/p}}function OPe(e){var t=e.x,r=e.y,n=e.z;return function(i,o){return o[0]=t[i],o[1]=r[i],o[2]=n[i],o}}function LPe(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z;return _3(r)?function(s,u){var l=n[s],c=a[s],d=i[s];return u[0]=r[0]*l+r[4]*c+r[8]*d+r[12],u[1]=r[1]*l+r[5]*c+r[9]*d+r[13],u[2]=r[2]*l+r[6]*c+r[10]*d+r[14],u}:function(s,u){return u[0]=n[s],u[1]=a[s],u[2]=i[s],_.transformMat4(u,u,r),u}}var uP=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],NPe=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],FPe=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],Y1={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function BPe(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}var t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function UPe(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error("unknown spacegroup index '"+e+"'")}var jY=function(){for(var e=Object.create(null),t=0,r=Object.keys(Y1);t<r.length;t++){var n=r[t];e[Y1[n]]=n}return e}(),jPe=function(){for(var e=Object.create(null),t=0,r=Object.keys(Y1);t<r.length;t++){var n=r[t],a=Y1[n];e[a]=UPe(a)}return e}();function zPe(e){var t=typeof e=="number"?BPe(e):Y1[e];return typeof t>"u"||typeof jY[t]>"u"?-1:t}var Io;(function(e){e.Zero=r("P 1",_.create(1,1,1),_.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(n){return n?n.index===0&&n.size[0]===1&&n.size[1]===1&&n.size[1]===1:!0}e.isZero=t;function r(n,a,i){var o=zPe(n);if(o<0)return console.warn("Unknown spacegroup '"+n+"', returning a 'P 1' with cellsize [1, 1, 1]"),e.Zero;var s=a[0]*a[1]*a[2],u=i[0],l=i[1],c=i[2],d=a[0],f=a[1],h=a[2],v=Math.cos(l),p=(Math.cos(u)-Math.cos(l)*Math.cos(c))/Math.sin(c),g=Math.sqrt(1-v*v-p*p),m=[d,0,0],y=[Math.cos(c)*f,Math.sin(c)*f,0],b=[v*h,p*h,g*h],S=le.ofRows([[m[0],y[0],b[0],0],[0,y[1],b[1],0],[0,0,b[2],0],[0,0,0,1]]),x=le.invert(le.zero(),S);return{index:o,size:a,volume:s,anglesInRadians:i,toFractional:x,fromFractional:S}}e.create=r})(Io||(Io={}));var zu;(function(e){e.ZeroP1=t(Io.Zero);function t(g){var m=FPe[g.index].map(function(S){return d(NPe[S])}),y=jY[g.index],b=jPe[g.index];return{name:y,num:b,cell:g,operators:m}}e.create=t;var r=_(),n=le();function a(g,m,y,b,S,x){return _.set(r,y,b,S),le.fromTranslation(n,r),le.mul(x,le.mul(x,le.mul(x,g.cell.fromFractional,n),g.operators[m]),g.cell.toFractional)}e.setOperatorMatrix=a;function i(g,m,y,b,S){var x=a(g,m,y,b,S,le.zero());return gn.create(m+1+"_"+(5+y)+(5+b)+(5+S),x,{hkl:_.create(y,b,S),spgrOp:m})}e.getSymmetryOperator=i;var o=_(),s=_(),u=_(),l=_();function c(g,m,y,b,S,x){var C=le.zero();_.set(r,y,b,S),_.floor(o,x),le.copy(C,g.operators[m]),_.floor(s,_.transformMat4(s,x,C)),le.getTranslation(l,C),_.sub(l,l,s),_.add(l,l,o),_.add(l,l,r),le.setTranslation(C,l),le.mul(C,g.cell.fromFractional,C),le.mul(C,C,g.cell.toFractional),_.sub(u,s,o);var w=y-u[0],A=b-u[1],I=S-u[2];return gn.create(m+1+"_"+(5+w)+(5+A)+(5+I),C,{hkl:_.create(w,A,I),spgrOp:m})}e.getSymmetryOperatorRef=c;function d(g){var m=uP[g[0]],y=uP[g[1]],b=uP[g[2]];return le.ofRows([m,y,b,[0,0,0,1]])}function f(g){return[p(h(g[0],g[4],g[8]),v(g[12])),p(h(g[1],g[5],g[9]),v(g[13])),p(h(g[2],g[6],g[10]),v(g[14]))].join(",")}e.getOperatorXyz=f;function h(g,m,y){var b=[];if(g>0?b.push("+X"):g<0&&b.push("-X"),m>0?b.push("+Y"):m<0&&b.push("-Y"),y>0?b.push("+Z"):y<0&&b.push("-Z"),b.length===1)return b[0].charAt(0)==="+"?b[0].substr(1):b[0];if(b.length===2){var S=b[0].charAt(0),x=b[1].charAt(0);if(S==="+")return""+b[0].substr(1)+b[1];if(x==="+")return""+b[1].substr(1)+b[0]}throw new Error("unknown rotation '"+b+"', "+g+" "+m+" "+y)}function v(g){switch(g){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function p(g,m){return m===""?g:g.length>2?g+"+"+m:g.charAt(0)==="-"?""+m+g:m+"+"+g}})(zu||(zu={}));var Jf;(function(e){function t(i,o,s){i.squaredDistances[i.count]=s,i.indices[i.count++]=o}e.add=t;function r(i){i.count=0}e.reset=r;function n(){return{count:0,indices:[],squaredDistances:[]}}e.create=n;function a(i,o){for(var s=0;s<o.count;++s)i.indices[s]=o.indices[s],i.squaredDistances[s]=o.squaredDistances[s];return i.count=o.count,i}e.copy=a})(Jf||(Jf={}));function je(){return je.zero()}(function(e){function t(k){return k.extrema!==void 0}e.hasExtrema=t;function r(k,R){return{center:k,radius:R}}e.create=r;function n(){return{center:_(),radius:0}}e.zero=n;function a(k){var R=r(_.clone(k.center),k.radius);return t(k)&&(R.extrema=k.extrema.map(function(L){return _.clone(L)})),R}e.clone=a;function i(k,R,L){return _.copy(k.center,R),k.radius=L,k}e.set=i;function o(k,R){return _.copy(k.center,R.center),k.radius=R.radius,t(R)&&s(k,R.extrema.map(function(L){return _.clone(L)})),k}e.copy=o;function s(k,R){var L;return k.extrema!==void 0?(k.extrema.length=0,(L=k.extrema).push.apply(L,R)):k.extrema=R,k}e.setExtrema=s;function u(k){for(var R=k.x,L=k.y,H=k.z,B=k.indices,j=0,Q=0,G=0,W=0,q=Fe.size(B),J=0;J<q;J++){var he=Fe.getAt(B,J);j+=R[he],Q+=L[he],G+=H[he]}q>0&&(j/=q,Q/=q,G/=q);for(var J=0;J<q;J++){var he=Fe.getAt(B,J),$=R[he]-j,X=L[he]-Q,U=H[he]-G,z=$*$+X*X+U*U;z>W&&(W=z)}return{center:_.create(j,Q,G),radius:Math.sqrt(W)}}e.computeBounding=u;function l(k,R,L){return _.transformMat4(k.center,R.center,L),k.radius=R.radius*le.getMaxScaleOnAxis(L),t(R)&&s(k,R.extrema.map(function(H){return _.transformMat4(_(),H,L)})),k}e.transform=l;function c(k,R,L){return _.add(k.center,R.center,L),t(R)&&s(k,R.extrema.map(function(H){return _.add(_(),H,L)})),k}e.translate=c;function d(k,R,L){_.toArray(k.center,R,L),R[L+3]=k.radius}e.toArray=d;function f(k,R,L){return _.fromArray(k.center,R,L),k.radius=R[L+3],k}e.fromArray=f;function h(k,R){return _.scale(k.center,_.add(k.center,R.max,R.min),.5),k.radius=_.distance(k.center,R.max),e.setExtrema(k,[_.create(R.min[0],R.min[1],R.min[2]),_.create(R.max[0],R.max[1],R.max[2]),_.create(R.max[0],R.min[1],R.min[2]),_.create(R.min[0],R.max[1],R.max[2]),_.create(R.min[0],R.min[1],R.max[2]),_.create(R.max[0],R.min[1],R.max[2]),_.create(R.max[0],R.max[1],R.min[2]),_.create(R.min[0],R.max[1],R.min[2])]),k}e.fromBox3D=h;function v(k,R){return _.copy(k.center,R.origin),k.radius=Math.max(_.magnitude(R.dirA),_.magnitude(R.dirB),_.magnitude(R.dirC)),k}e.fromAxes3D=v;var p=_();function g(k,R,L){var H=R[0],B=R[1],j=R[2],Q=_.create(0,0,0);_.transformMat4(Q,Q,L);var G=_.create(H,B,j);_.transformMat4(G,G,L);var W=_.create(H,0,0);_.transformMat4(W,W,L);var q=_.create(0,B,j);_.transformMat4(q,q,L);var J=_.create(0,0,j);_.transformMat4(J,J,L);var he=_.create(H,0,j);_.transformMat4(he,he,L);var $=_.create(H,B,0);_.transformMat4($,$,L);var X=_.create(0,B,0);_.transformMat4(X,X,L),_.add(p,Q,G),_.scale(p,p,.5);var U=Math.max(_.distance(Q,G),_.distance(W,q));return e.set(k,p,U/2),e.setExtrema(k,[Q,G,W,q,J,he,$,X]),k}e.fromDimensionsAndTransform=g;var m=_();function y(k,R,L){var H=_.distance(R.center,L);return H<R.radius?e.copy(k,R):(_.sub(m,R.center,L),_.sub(m,R.center,m),_.setMagnitude(m,m,R.radius),_.scale(k.center,_.add(m,m,L),.5),k.radius=_.distance(k.center,L),k)}e.addVec3=y;function b(k,R,L){return _.copy(k.center,R.center),k.radius=Math.max(R.radius,_.distance(R.center,L.center)+L.radius),t(R)&&t(L)&&s(k,Ut(Ut([],R.extrema.map(function(H){return _.clone(H)})),L.extrema.map(function(H){return _.clone(H)}))),k}e.expandBySphere=b;var S=_();function x(k,R,L){var H,B;return _.copy(k.center,R.center),k.radius=R.radius+L,R.radius<1e-12||((B=(H=R.extrema)===null||H===void 0?void 0:H.length)!==null&&B!==void 0?B:0)<=1?(k.extrema=void 0,k):(t(R)&&s(k,R.extrema.map(function(j){_.sub(S,j,R.center);var Q=_.distance(R.center,j);return _.normalize(S,S),_.scaleAndAdd(_(),R.center,S,Q+L)})),k)}e.expand=x;function C(k,R){return k.radius===R.radius&&_.exactEquals(k.center,R.center)}e.exactEquals=C;function w(k,R){var L=k.radius,H=R.radius;return Math.abs(L-H)<=yn*Math.max(1,Math.abs(L),Math.abs(H))&&_.equals(k.center,R.center)}e.equals=w;function A(k,R){if(t(R)){for(var L=0,H=R.extrema;L<H.length;L++){var B=H[L];if(_.distance(k.center,B)>k.radius)return!1}return!0}else return _.distance(k.center,R.center)+R.radius<=k.radius}e.includes=A;function I(k,R){return _.distance(k.center,R.center)<=k.radius+R.radius}e.overlaps=I;function D(k,R){return _.distance(k.center,R.center)-k.radius+R.radius}e.distance=D})(je||(je={}));function Yt(){return Yt.zero()}(function(e){function t(y,b){return{min:y,max:b}}e.create=t;function r(){return{min:_(),max:_()}}e.zero=r;function n(y,b){return _.copy(y.min,b.min),_.copy(y.max,b.max),y}e.copy=n;function a(y){return n(r(),y)}e.clone=a;function i(y,b){if(je.hasExtrema(b))return o(y,b.extrema);var S=_.create(b.radius,b.radius,b.radius);return _.sub(y.min,b.center,S),_.add(y.max,b.center,S),y}e.fromSphere3D=i;function o(y,b){e.setEmpty(y);for(var S=0,x=b.length;S<x;S++)e.add(y,b[S]);return y}e.fromVec3Array=o;function s(y){for(var b=_.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=_.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),x=y.x,C=y.y,w=y.z,A=y.indices,I=0,D=Fe.size(A);I<D;I++){var k=Fe.getAt(A,I);b[0]=Math.min(x[k],b[0]),b[1]=Math.min(C[k],b[1]),b[2]=Math.min(w[k],b[2]),S[0]=Math.max(x[k],S[0]),S[1]=Math.max(C[k],S[1]),S[2]=Math.max(w[k],S[2])}return{min:b,max:S}}e.computeBounding=s;function u(y,b){return _.sub(y,b.max,b.min)}e.size=u;var l=_();function c(y){return u(l,y),l[0]*l[1]*l[2]}e.volume=c;function d(y){return _.set(y.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),_.set(y.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),y}e.setEmpty=d;function f(y,b){return _.min(y.min,y.min,b),_.max(y.max,y.max,b),y}e.add=f;function h(y,b,S){return _.sub(y.min,b.min,S),_.add(y.max,b.max,S),y}e.expand=h;function v(y,b,S){return _.scale(y.min,b.min,S),_.scale(y.max,b.max,S),y}e.scale=v;var p=_();function g(y,b,S){var x=b.min,C=x[0],w=x[1],A=x[2],I=b.max,D=I[0],k=I[1],R=I[2];return d(y),f(y,_.transformMat4(p,_.set(p,C,w,A),S)),f(y,_.transformMat4(p,_.set(p,C,w,R),S)),f(y,_.transformMat4(p,_.set(p,C,k,A),S)),f(y,_.transformMat4(p,_.set(p,C,k,R),S)),f(y,_.transformMat4(p,_.set(p,D,w,A),S)),f(y,_.transformMat4(p,_.set(p,D,w,R),S)),f(y,_.transformMat4(p,_.set(p,D,k,A),S)),f(y,_.transformMat4(p,_.set(p,D,k,R),S)),y}e.transform=g;function m(y,b){return!(b[0]<y.min[0]||b[0]>y.max[0]||b[1]<y.min[1]||b[1]>y.max[1]||b[2]<y.min[2]||b[2]>y.max[2])}e.containsVec3=m})(Yt||(Yt={}));function Gp(e,t,r){return new VPe(e,t,r)}var VPe=function(){function e(t,r,n){var a=GPe(t,r,n);this.ctx=qPe(a),this.boundary={box:a.boundingBox,sphere:a.boundingSphere},this.buckets={offset:a.bucketOffset,count:a.bucketCounts,array:a.bucketArray},this.result=Jf.create()}return e.prototype.find=function(t,r,n,a,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!1;var o=i??this.result;return e7(this.ctx,o),o},e.prototype.check=function(t,r,n,a){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!0,e7(this.ctx,this.result)},e}();function HPe(e){for(var t=e.expandedBox,r=e.size,n=r[0],a=r[1],i=r[2],o=e.data,s=o.x,u=o.y,l=o.z,c=o.radius,d=o.indices,f=e.elementCount,h=e.delta,v=n*a*i,p=t.min,g=p[0],m=p[1],y=p[2],b=0,S=0,x=new Uint32Array(v),C=new Int32Array(f),w=0;w<f;w++){var A=Fe.getAt(d,w),I=Math.floor((s[A]-g)/h[0]),D=Math.floor((u[A]-m)/h[1]),k=Math.floor((l[A]-y)/h[2]),R=(I*a+D)*i+k;(x[R]+=1)===1&&(S+=1),C[w]=R}if(c)for(var w=0;w<f;w++){var A=Fe.getAt(d,w);c[A]>b&&(b=c[A])}for(var L=new Int32Array(S),A=0,H=0;A<v;A++){var B=x[A];B>0&&(x[A]=H+1,L[H]=B,H+=1)}for(var j=new Uint32Array(S),A=1;A<S;++A)j[A]+=j[A-1]+L[A-1];for(var Q=new Int32Array(S),G=new Int32Array(f),A=0;A<f;A++){var W=x[C[A]];if(W>0){var q=W-1;G[j[q]+Q[q]]=A,Q[q]+=1}}return{size:e.size,bucketArray:G,bucketCounts:L,bucketOffset:j,grid:x,delta:h,min:e.expandedBox.min,data:e.data,maxRadius:b,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}function GPe(e,t,r){var n=Yt.expand(Yt(),t.box,_.create(.5,.5,.5)),a=e.indices,i=Yt.size(_.zero(),n),o,s,u=Fe.size(a),l=typeof r=="number"?r:32,c=Array.isArray(r)&&r;if(c)s=[Math.ceil(i[0]/c[0]),Math.ceil(i[1]/c[1]),Math.ceil(i[2]/c[2])],o=c;else if(u>0){var d=Math.ceil(u/l),f=Math.pow(d/(i[0]*i[1]*i[2]),1/3);s=[Math.ceil(i[0]*f),Math.ceil(i[1]*f),Math.ceil(i[2]*f)],o=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}else o=i,s=[1,1,1];var h={x:e.x,y:e.y,z:e.z,indices:a,radius:e.radius},v={size:s,data:h,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:u,delta:o};return HPe(v)}function qPe(e){return{grid:e,x:.1,y:.1,z:.1,radius:.1,isCheck:!1}}function e7(e,t){var r=e.grid,n=r.min,a=r.size,i=a[0],o=a[1],s=a[2],u=r.bucketOffset,l=r.bucketCounts,c=r.bucketArray,d=r.grid,f=r.data,h=f.x,v=f.y,p=f.z,g=f.indices,m=f.radius,y=r.delta,b=r.maxRadius,S=e.radius,x=e.isCheck,C=e.x,w=e.y,A=e.z,I=S+b,D=I*I;Jf.reset(t);var k=Math.max(0,Math.floor((C-I-n[0])/y[0])),R=Math.max(0,Math.floor((w-I-n[1])/y[1])),L=Math.max(0,Math.floor((A-I-n[2])/y[2])),H=Math.min(i-1,Math.floor((C+I-n[0])/y[0])),B=Math.min(o-1,Math.floor((w+I-n[1])/y[1])),j=Math.min(s-1,Math.floor((A+I-n[2])/y[2]));if(k>H||R>B||L>j)return!1;for(var Q=k;Q<=H;Q++)for(var G=R;G<=B;G++)for(var W=L;W<=j;W++){var q=d[(Q*o+G)*s+W];if(q!==0)for(var J=q-1,he=u[J],$=l[J],X=he+$,U=he;U<X;U++){var z=Fe.getAt(g,c[U]),ee=h[z]-C,Y=v[z]-w,Z=p[z]-A,te=ee*ee+Y*Y+Z*Z;if(te<=D){if(b>0&&Math.sqrt(te)-m[z]>S)continue;if(x)return!0;Jf.add(t,c[U],te)}}}return t.count>0}function Su(){return Su.empty()}(function(e){function t(d,f,h,v){return{origin:d,dirA:f,dirB:h,dirC:v}}e.create=t;function r(){return{origin:_(),dirA:_(),dirB:_(),dirC:_()}}e.empty=r;function n(d,f){return _.copy(d.origin,f.origin),_.copy(d.dirA,f.dirA),_.copy(d.dirB,f.dirB),_.copy(d.dirC,f.dirC),d}e.copy=n;function a(d){return n(r(),d)}e.clone=a;function i(d,f){return _.set(d,_.magnitude(f.dirA)*2,_.magnitude(f.dirB)*2,_.magnitude(f.dirC)*2)}e.size=i;var o=_();function s(d){return i(o,d),o[0]*o[1]*o[2]}e.volume=s;function u(d,f){return _.copy(d.origin,f.origin),_.normalize(d.dirA,f.dirA),_.normalize(d.dirB,f.dirB),_.normalize(d.dirC,f.dirC),d}e.normalize=u;var l=qn.zero();function c(d,f,h){_.transformMat4(d.origin,f.origin,h);var v=qn.directionTransform(l,h);return _.transformMat3(d.dirA,f.dirA,v),_.transformMat3(d.dirB,f.dirB,v),_.transformMat3(d.dirC,f.dirC,v),d}e.transform=c})(Su||(Su={}));function Wr(e){return function(t){return Bk(e,t)}}function Bk(e,t){var r=e.data,n=e.indices,a=e.count,i=t.valueType,o=i==="str"?function(s){return r.substring(n[2*s],n[2*s+1])}:i==="int"?function(s){return jf(r,n[2*s],n[2*s+1])||0}:function(s){return Mc(r,n[2*s],n[2*s+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:a,value:o,valueKind:function(s){return 0},toArray:function(s){return ti(a,o,s)},areValuesEqual:zY(e)}}function zY(e){var t=e.data,r=e.indices;return function(n,a){var i=r[2*n],o=r[2*a],s=r[2*n+1]-i;if(s!==r[2*a+1]-o)return!1;for(var u=0;u<s;u++)if(t.charCodeAt(u+i)!==t.charCodeAt(u+o))return!1;return!0}}function VY(e,t){return{name:t,blocks:e}}function Uk(e,t,r,n){return n===void 0&&(n=[]),{categoryNames:e,header:r,categories:t,saveFrames:n,getField:function(a){var i=a.split("."),o=i[0],s=i[1];return t[o].getField(s||"")}}}function WPe(e,t,r){return{categoryNames:e,header:r,categories:t}}function fi(e,t,r,n){return{rowCount:t,name:e,fieldNames:Ut([],r),getField:function(a){return n[a]}}}(function(e){function t(a){return{rowCount:0,name:a,fieldNames:[],getField:function(i){}}}e.empty=t;function r(a,i){var o=Object.keys(i);return{rowCount:o.length>0?i[o[0]].rowCount:0,name:a,fieldNames:o,getField:function(s){return i[s]}}}e.ofFields=r;function n(a,i){for(var o={},s=0,u=i._columns;s<u.length;s++){var l=u[s];o[l]=Ct.ofColumn(i[l])}return r(a,o)}e.ofTable=n})(fi||(fi={}));var Ct;(function(e){function t(s){return r([s])}e.ofString=t;function r(s){var u=s.length,l=function(h){var v=s[h];return!v||v==="."||v==="?"?"":v},c=function(h){var v=s[h];return jf(v,0,v.length)||0},d=function(h){var v=s[h];return Mc(v,0,v.length)||0},f=function(h){var v=s[h],p=v.length;if(p>1)return 0;if(p===0)return 1;var g=v.charCodeAt(0);return g===46?1:g===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:d,valueKind:f,areValuesEqual:function(h,v){return s[h]===s[v]},toStringArray:function(h){return h?ti(u,l,h):s},toIntArray:function(h){return ti(u,c,h)},toFloatArray:function(h){return ti(u,d,h)}}}e.ofStrings=r;function n(s){var u=s.length,l=function(h){return""+s[h]},c=function(h){return s[h]},d=function(h){return 0},f=function(h){return!h||h.array&&s instanceof h.array?s:ti(u,c,h)};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:c,valueKind:d,areValuesEqual:function(h,v){return s[h]===s[v]},toStringArray:function(h){return ti(u,l,h)},toIntArray:f,toFloatArray:f}}e.ofNumbers=n;function a(s){var u=s.data,l=s.indices,c=s.count,d=function(p){var g=u.substring(l[2*p],l[2*p+1]);return g==="."||g==="?"?"":g},f=function(p){return jf(u,l[2*p],l[2*p+1])||0},h=function(p){return Mc(u,l[2*p],l[2*p+1])||0},v=function(p){var g=l[2*p],m=l[2*p+1]-g;if(m>1)return 0;if(m===0)return 1;var y=u.charCodeAt(g);return y===46?1:y===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:c,str:d,int:f,float:h,valueKind:v,areValuesEqual:zY(s),toStringArray:function(p){return ti(c,d,p)},toIntArray:function(p){return ti(c,f,p)},toFloatArray:function(p){return ti(c,h,p)}}}e.ofTokens=a;function i(s){var u=s.rowCount,l=s.valueKind,c=s.areValuesEqual,d=s.isDefined,f,h,v;switch(s.schema.valueType){case"float":case"int":f=function(g){return""+s.value(g)},h=s.value,v=s.value;break;case"str":f=s.value,h=function(g){var m=s.value(g);return jf(m,0,m.length)||0},v=function(g){var m=s.value(g);return Mc(m,0,m.length)||0};break;case"list":var p=s.schema.separator;f=function(g){return s.value(g).join(p)},h=function(g){return NaN},v=function(g){return NaN};break;default:throw new Error("unsupported valueType '"+s.schema.valueType+"'")}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:u,str:f,int:h,float:v,valueKind:l,areValuesEqual:c,toStringArray:function(g){return ti(u,f,g)},toIntArray:function(g){return ti(u,h,g)},toFloatArray:function(g){return ti(u,v,g)}}}e.ofColumn=i;function o(s,u){return i(me.Undefined(s,u))}e.ofUndefined=o})(Ct||(Ct={}));function $Pe(e,t,r,n){var a=r?0:1;switch(t){case 1:return n==="brackets"?function(i){return e+"["+(i+a)+"]"}:function(i){return e+"_"+(i+a)};case 2:return n==="brackets"?function(i,o){return e+"["+(i+a)+"]["+(o+a)+"]"}:function(i,o){return e+"_"+(i+a)+(o+a)};case 3:return n==="brackets"?function(i,o,s){return e+"["+(i+a)+"]["+(o+a)+"]["+(s+a)+"]"}:function(i,o,s){return e+"_"+(i+a)+(o+a)+(s+a)};default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function XPe(e,t,r,n){var a=t.create();if(t.rank===1)for(var i=t.dimensions[0],o=0;o<i;o++){var s=e.getField(n(o));t.set(a,o,s?s.float(r):0)}else if(t.rank===2)for(var i=t.dimensions[0],u=t.dimensions[1],o=0;o<i;o++)for(var l=0;l<u;l++){var s=e.getField(n(o,l));t.set(a,o,l,s?s.float(r):0)}else if(t.rank===3)for(var c=t.dimensions[0],d=t.dimensions[1],f=t.dimensions[2],o=0;o<c;o++)for(var l=0;l<d;l++)for(var h=0;h<f;h++){var s=e.getField(n(o,l,h));t.set(a,o,l,h,s?s.float(r):0)}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return a}function It(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(function(e){function t(y){return y.data.substring(y.tokenStart,y.tokenEnd)}e.getTokenString=t;function r(y){y.position=0,y.lineNumber=1,y.tokenStart=0,y.tokenEnd=0}e.reset=r;function n(y){for(var b=y.data;y.position<y.length;)switch(b.charCodeAt(y.position)){case 10:return y.tokenEnd=y.position,++y.position,++y.lineNumber,!0;case 13:return y.tokenEnd=y.position,++y.position,++y.lineNumber,b.charCodeAt(y.position)===10&&++y.position,!0;default:++y.position;break}return y.tokenEnd=y.position,y.tokenStart!==y.tokenEnd}e.eatLine=n;function a(y){y.tokenStart=y.position}e.markStart=a;function i(y){return y.tokenStart=y.position,n(y)}e.markLine=i;function o(y){return i(y),t(y)}e.readLine=o;function s(y){i(y);var b=y.position;return m(y,y.tokenStart,y.tokenEnd),y.position=b,t(y)}e.readLineTrim=s;function u(y,b,S){for(var x=0,C=0;C<b;C++){if(!i(y))return x;mt.addUnchecked(S,y.tokenStart,y.tokenEnd),x++}return x}function l(y,b){var S=mt.create(y.data,b*2);return u(y,b,S),S}e.markLines=l;function c(y,b){for(var S=[],x=0;x<b;x++)S.push(e.readLine(y));return S}e.readLines=c;function d(y,b,S,x){return x===void 0&&(x=1e5),de(this,void 0,void 0,function(){var C,w,A;return fe(this,function(I){switch(I.label){case 0:return C=y.length,w=mt.create(y.data,b*2),A=0,[4,qc(S,x,y,function(D,k){var R=Math.min(b-A,D);return u(k,R,w),A+=R,R},function(D,k){return D.update({message:"Parsing...",current:k.position,max:C})})];case 1:return I.sent(),[2,w]}})})}e.readLinesAsync=d;function f(y){for(var b=e(y),S=mt.create(b.data,Math.max(y.length/80,2));i(b);)mt.add(S,b.tokenStart,b.tokenEnd);return S}e.readAllLines=f;function h(y,b,S){for(var x=0,C=0;C<b;C++){if(!i(y))return x;mt.add(S,y.tokenStart,y.tokenEnd),x++}return x}function v(y,b,S){return S===void 0&&(S=1e5),de(this,void 0,void 0,function(){var x,C;return fe(this,function(w){switch(w.label){case 0:return x=e(y),C=mt.create(x.data,Math.max(y.length/80,2)),[4,qc(b,S,x,function(A,I){return h(I,A,C),I.position<I.length?A:0},function(A,I){return A.update({message:"Parsing...",current:I.position,max:length})})];case 1:return w.sent(),[2,C]}})})}e.readAllLinesAsync=v;function p(y){for(;y.position<y.length;)switch(y.data.charCodeAt(y.position)){case 9:case 10:case 13:case 32:y.tokenEnd=y.position;return;default:++y.position;break}y.tokenEnd=y.position}e.eatValue=p;function g(y){for(var b=-1;y.position<y.length;){var S=y.data.charCodeAt(y.position);switch(S){case 9:case 32:b=S,++y.position;break;case 10:b!==13&&++y.lineNumber,b=S,++y.position;break;case 13:b=S,++y.position,++y.lineNumber;break;default:return b}}return b}e.skipWhitespace=g;function m(y,b,S){for(var x=y.data,C=b,w=S-1,A=x.charCodeAt(C);(A===9||A===32)&&C<=w;)A=x.charCodeAt(++C);for(A=x.charCodeAt(w);(A===9||A===32)&&w>=C;)A=x.charCodeAt(--w);return y.tokenStart=C,y.tokenEnd=w+1,y.position=S,y}e.trim=m})(It||(It={}));function YPe(e,t,r){for(var n=t,a=r-1,i=e.charCodeAt(n);(i===9||i===32)&&n<=a;)i=e.charCodeAt(++n);for(i=e.charCodeAt(a);(i===9||i===32)&&a>=n;)i=e.charCodeAt(--a);return e.substring(n,a+1)}var mt;(function(e){function t(o){var s=new Uint32Array(1.61*o.indices.length|0);s.set(o.indices),o.indices=s,o.indicesLenMinus2=s.length-2|0}function r(o,s,u){var l=o;l.offset>l.indicesLenMinus2&&t(l),l.indices[l.offset++]=s,l.indices[l.offset++]=u,o.count++}e.add=r;function n(o,s){r(o,s.tokenStart,s.tokenEnd)}e.addToken=n;function a(o,s,u){o.indices[o.offset++]=s,o.indices[o.offset++]=u,o.count++}e.addUnchecked=a;function i(o,s){return s=Math.max(10,s),{data:o,indicesLenMinus2:s-2|0,count:0,offset:0,indices:new Uint32Array(s)}}e.create=i})(mt||(mt={}));var In;(function(e){function t(i,o){return o===void 0&&(o=-1),new n(i,o)}e.error=t;function r(i,o){return o===void 0&&(o=[]),new a(i,o)}e.success=r;var n=function(){function i(o,s){this.message=o,this.line=s,this.isError=!0}return i.prototype.toString=function(){return this.line>=0?"[Line "+this.line+"] "+this.message:this.message},i}();e.Error=n;var a=function(){function i(o,s){this.result=o,this.warnings=s,this.isError=!1}return i}();e.Success=a})(In||(In={}));function t7(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function KPe(e,t){var r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(r===void 0){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function QPe(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&HY(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function ZPe(e){for(var t=59,r=e.position+1,n;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function JPe(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function eTe(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function tTe(e){for(var t=10;e.position<e.length;){var r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function HY(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function rTe(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function nTe(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function aTe(e){if(e.tokenEnd-e.tokenStart!==5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function iTe(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function oTe(e,t,r){var n,a=r-t,i=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<a)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+i))return!1;return a===o||e.data.charCodeAt(n+i)===46}function GY(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function qY(e,t){return e.data.substring(e.tokenStart,t)}function sTe(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function EM(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function r7(e){var t=tTe(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var r=e.data.charCodeAt(e.position);switch(r){case 35:eTe(e),e.tokenType=5;break;case 39:if(HY(e)){QPe(e),e.tokenType=3;break}case 34:KPe(e,r),e.tokenType=3;break;case 59:t===10||t===13?ZPe(e):t7(e),e.tokenType=3;break;default:e.isImportGet?JPe(e):t7(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&iTe(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?rTe(e)?e.tokenType=0:nTe(e)?e.tokenType=1:aTe(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function Vf(e){for(r7(e);e.tokenType===5;)r7(e)}function uTe(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function z2(){return{categoryNames:[],categoryData:Object.create(null)}}function jk(e,t){for(var r=Object.create(null),n=0,a=e;n<a.length;n++){var i=a[n],o=t[i];r[i]=fi(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function n7(e,t,r){return Uk(e.categoryNames,jk(e.categoryNames,e.categoryData),t,r)}function lTe(e,t){return Uk(e.categoryNames,jk(e.categoryNames,e.categoryData),t)}function AM(e,t,r,n,a){var i;if(t in e.categoryData){var o=e.categoryData[t];(i=o.fieldNames).push.apply(i,n),Object.assign(o.fields,a)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:a},e.categoryNames.push(t)}function cTe(e,t){for(var r=e.tokenStart,n=GY(e),a=qY(e,n),i=Object.create(null),o=[],s=!0;s;){if(e.tokenType!==4||!oTe(e,r,n)){s=!1;break}var u=EM(e).substring(a.length+1);if(Vf(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};i[u]=Ct.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=u,Vf(e)}return AM(t,a.substr(1),1,o,i),{hasError:!1,errorLine:0,errorMessage:""}}function dTe(e,t){for(var r=t.tokenizer,n=t.tokens,a=t.fieldCount,i=t.tokenCount,o=0;r.tokenType===3&&o<e;)mt.add(n[i++%a],r.tokenStart,r.tokenEnd),Vf(r),o++;return t.tokenCount=i,o}function fTe(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function hTe(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o,s,u,f,l,c,f,d,d,f;return fe(this,function(h){switch(h.label){case 0:for(r=e.lineNumber,Vf(e),n=qY(e,GY(e)),a=sTe(e),i=[];e.tokenType===4;)i[i.length]=a?EM(e):EM(e).substring(n.length+1),Vf(e);for(o=n==="_atom_site"?e.data.length/100|0:32,s=[],u=i.length,f=0;f<u;f++)s[f]=mt.create(e.data,o);return l={fieldCount:u,tokenCount:0,tokenizer:e,tokens:s},[4,qc(e.runtimeCtx,1e6,l,dTe,fTe)];case 1:if(h.sent(),l.tokenCount%u!==0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line "+r+" is not a multiple of the number of columns."}];if(c=l.tokenCount/u|0,a)for(f=0;f<u;f++)d={"":Ct.ofTokens(s[f])},AM(t,i[f].substr(1),c,[""],d);else{for(d=Object.create(null),f=0;f<u;f++)d[i[f]]=Ct.ofTokens(s[f]);AM(t,n.substr(1),c,i,d)}return[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function zv(e,t){return In.error(t,e)}function pTe(e){return In.success(e)}function vTe(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,d;return fe(this,function(f){switch(f.label){case 0:r=[],n=uTe(e,t),a="",i=z2(),o=[],s=z2(),u=WPe(s.categoryNames,jk(s.categoryNames,s.categoryData),""),l="",t.update({message:"Parsing...",current:0,max:e.length}),Vf(n),f.label=1;case 1:return n.tokenType===6?[3,7]:(c=n.tokenType,c!==0?[3,2]:n.inSaveFrame?[2,zv(n.lineNumber,"Unexpected data block inside a save frame.")]:(i.categoryNames.length>0&&r.push(n7(i,a,o)),a=e.substring(n.tokenStart+5,n.tokenEnd),i=z2(),o=[],Vf(n),[3,6]));case 2:if(c!==1)return[3,3];if(n.tokenEnd-n.tokenStart===5)s.categoryNames.length>0&&(o[o.length]=lTe(s,l)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return[2,zv(n.lineNumber,"Save frames cannot be nested.")];n.inSaveFrame=!0,l=e.substring(n.tokenStart+5,n.tokenEnd),s=z2()}return Vf(n),[3,6];case 3:return c!==2?[3,5]:[4,hTe(n,n.inSaveFrame?s:i)];case 4:return d=f.sent(),d.hasError?[2,zv(d.errorLine,d.errorMessage)]:[3,6];case 5:if(c===4){if(d=cTe(n,n.inSaveFrame?s:i),d.hasError)return[2,zv(d.errorLine,d.errorMessage)]}else return console.log(n.tokenType,It.getTokenString(n)),[2,zv(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];f.label=6;case 6:return[3,1];case 7:return n.inSaveFrame?[2,zv(n.lineNumber,"Unfinished save frame ("+u.header+").")]:((i.categoryNames.length>0||o.length>0)&&r.push(n7(i,a,o)),[2,pTe(VY(r))])}})})}function a7(e){var t=this;return et.create("Parse CIF",function(r){return de(t,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return[4,vTe(e,r)];case 1:return[2,n.sent()]}})})})}var mTe=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function gTe(e,t){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),a=0,i=e.length;a<i;a+=t)for(var o=0;o<t;o++)n[a+t-o-1]=e[a+o];return r}var lP=28672;function yTe(e){if(e.length>lP){for(var t=[],r=0;r<e.length;r+=lP)t.push(String.fromCharCode.apply(null,e.subarray(r,r+lP)));return t.join("")}else return String.fromCharCode.apply(null,e)}function YC(e){for(var t=e.data,r=e.encoding.length-1;r>=0;r--)t=bTe(t,e.encoding[r]);return t}function bTe(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return xTe(e);case 2:return STe(e);case 5:return CTe(e);case 3:return _Te(e);case 6:return wTe(e);case 32:return ETe(e);case 33:return ATe(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return PTe(e,t);case"IntervalQuantization":return TTe(e,t);case"RunLength":return ITe(e,t);case"Delta":return MTe(e,t);case"IntegerPacking":return kTe(e,t);case"StringArray":return OTe(e,t)}}function WY(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function $Y(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}function xTe(e){return new Int8Array(e.buffer,e.byteOffset)}function Jg(e,t,r){return mTe?new r(e.buffer):new r(gTe(e,t))}function STe(e){return Jg(e,2,Int16Array)}function CTe(e){return Jg(e,2,Uint16Array)}function _Te(e){return Jg(e,4,Int32Array)}function wTe(e){return Jg(e,4,Uint32Array)}function ETe(e){return Jg(e,4,Float32Array)}function ATe(e){return Jg(e,8,Float64Array)}function PTe(e,t){for(var r=e.length,n=$Y(t.srcType,r),a=1/t.factor,i=0;i<r;i++)n[i]=a*e[i];return n}function TTe(e,t){for(var r=e.length,n=$Y(t.srcType,r),a=(t.max-t.min)/(t.numSteps-1),i=t.min,o=0;o<r;o++)n[o]=i+a*e[o];return n}function ITe(e,t){for(var r=WY(t.srcType,t.srcSize),n=0,a=0,i=e.length;a<i;a+=2)for(var o=e[a],s=e[a+1],u=0;u<s;++u)r[n++]=o;return r}function MTe(e,t){var r=e.length,n=WY(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(var a=1;a<r;++a)n[a]=e[a]+n[a-1];return n}function DTe(e,t){for(var r=t.byteCount===1?127:32767,n=-r-1,a=e.length,i=new Int32Array(t.srcSize),o=0,s=0;o<a;){for(var u=0,l=e[o];l===r||l===n;)u+=l,o++,l=e[o];u+=l,i[s]=u,o++,s++}return i}function RTe(e,t){for(var r=t.byteCount===1?255:65535,n=e.length,a=new Int32Array(t.srcSize),i=0,o=0;i<n;){for(var s=0,u=e[i];u===r;)s+=u,i++,u=e[i];s+=u,a[o]=s,i++,o++}return a}function kTe(e,t){return e.length===t.srcSize?e:t.isUnsigned?RTe(e,t):DTe(e,t)}function OTe(e,t){var r=YC({encoding:t.offsetEncoding,data:t.offsets}),n=YC({encoding:t.dataEncoding,data:e}),a=t.stringData,i=new Array(r.length);i[0]="";for(var o=1,s=r.length;o<s;o++)i[o]=a.substring(r[o-1],r[o]);for(var u=0,l=new Array(n.length),o=0,s=n.length;o<s;o++)l[u++]=i[n[o]+1];return l}var LTe="0.3.0",ef;(function(e){function t(n){var a;return n instanceof Int8Array?a=1:n instanceof Int16Array?a=2:n instanceof Int32Array?a=3:n instanceof Uint8Array?a=4:n instanceof Uint16Array?a=5:n instanceof Uint32Array?a=6:n instanceof Float32Array?a=32:n instanceof Float64Array?a=33:a=3,a}e.getDataType=t;function r(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(var a=0,i=n.length;a<i;a++)if(a<0)return!1;return!0}e.isSignedIntegerDataType=r})(ef||(ef={}));function NTe(e,t,r){var n=1,a;for(a=0;a<t;a++){var i=n*e;if(Math.abs(Math.round(i)-i)<=r)return a;n*=10}return-1}function FTe(e,t){var r=Math.abs(e);return r<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function BTe(e,t,r){for(var n=1,a=0,i=0,o=e.length;i<o;i++){if(n>=0){var s=NTe(e[i],t,r);s<0?n=-1:s>n&&(n=s)}var u=Math.abs(e[i]);if(u>r){var l=Math.floor(Math.log10(Math.abs(u)))+1;l>a&&(a=l)}}return{mantissaDigits:n,integerDigits:a}}function UTe(e){e=e.trim();var t=parseInt(e,10);return isNaN(t)?!1:t.toString()===e}function KC(e){if(!isFinite(e))return 0;for(var t=1,r=0;Math.round(e*t)/t!==e;)t*=10,++r;return r}function PM(e,t){return parseFloat(e.toPrecision(t))}function TM(e){return K1.classify(e)}function jTe(e){return IM.classify(e)}var K1;(function(e){function t(h,v){return h>=0?Math.ceil((h+1)/v):Math.ceil((h+1)/(-v-1))}function r(h){for(var v=!1,p=0,g=h.length;p<g;p++)if(h[p]<0){v=!0;break}return v?{signed:v,limit8:127,limit16:32767}:{signed:v,limit8:255,limit16:65535}}function n(){return{pack8:0,pack16:0,count:0}}function a(h,v,p){var g=h.limit8,m=h.limit16;v.pack8+=t(p,g),v.pack16+=t(p,m),v.count+=1}function i(h,v){h.pack8+=t(v,127),h.pack16+=t(v,32767),h.count+=1}function o(h){return h.count*4<h.pack16*2?{length:h.count*4,elem:4}:h.pack16*2<h.pack8?{length:h.pack16*2,elem:2}:{length:h.pack8,elem:1}}function s(h,v){for(var p=n(),g=0,m=h.length;g<m;g++)a(v,p,h[g]);return E(E({},o(p)),{kind:"pack"})}function u(h,v){for(var p=n(),g=h[0],m=1,y=h.length;m<y;m++)i(p,h[m]-g),g=h[m];return E(E({},o(p)),{kind:"delta"})}function l(h,v){for(var p=n(),g=1,m=1,y=h.length;m<y;m++)h[m-1]!==h[m]?(a(v,p,h[m-1]),a(v,p,g),g=1):g++;return a(v,p,h[h.length-1]),a(v,p,g),E(E({},o(p)),{kind:"rle"})}function c(h,v){for(var p=n(),g=1,m=0,y=0,b=1,S=h.length;b<S;b++){var x=h[b]-m;y!==x?(i(p,y),i(p,g),g=1):g++,y=x,m=h[b]}return i(p,y),i(p,g),E(E({},o(p)),{kind:"delta-rle"})}function d(h){var v=r(h),p=[s(h,v),l(h,v),u(h),c(h)];return p.sort(function(g,m){return g.length-m.length}),p}e.getSize=d;function f(h){if(h.length<2)return gr.by(gr.byteArray);var v=d(h),p=v[0];switch(p.kind){case"pack":return gr.by(gr.integerPacking);case"rle":return gr.by(gr.runLength).and(gr.integerPacking);case"delta":return gr.by(gr.delta).and(gr.integerPacking);case"delta-rle":return gr.by(gr.delta).and(gr.runLength).and(gr.integerPacking)}throw new Error("should not happen :)")}e.classify=f})(K1||(K1={}));var IM;(function(e){var t=1e-6;function r(a){var i=4,o=BTe(a,i,t),s=o.mantissaDigits,u=o.integerDigits;if(s<0||s+u>10)return gr.by(gr.byteArray);if(s===0)return K1.classify(a);for(var l=n(s),c=new Int32Array(a.length),d=0,f=a.length;d<f;d++)c[d]=Math.round(l*a[d]);var h=K1.getSize(c),v=h[0],p=gr.by(gr.fixedPoint(l));switch(v.kind){case"pack":return p.and(gr.integerPacking);case"rle":return p.and(gr.runLength).and(gr.integerPacking);case"delta":return p.and(gr.delta).and(gr.integerPacking);case"delta-rle":return p.and(gr.delta).and(gr.runLength).and(gr.integerPacking)}throw new Error("should not happen :)")}e.classify=r;function n(a){for(var i=1,o=0;o<a;o++)i*=10;return i}})(IM||(IM={}));var XY=function(){function e(t){this.providers=t}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(t){for(var r=[],n=0,a=this.providers;n<a.length;n++){var i=a[n],o=i(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(var s=0,u=o.encodings;s<u.length;s++){var l=u[s];r.push(l)}}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}},e}(),eh;(function(e){function t(a){return new XY([a])}e.by=t;function r(a){for(var i=t(n(a[0])),o=1;o<a.length;o++)i=i.and(n(a[o]));return i}e.fromEncoding=r;function n(a){switch(a.kind){case"ByteArray":return gr.byteArray;case"FixedPoint":return gr.fixedPoint(a.factor);case"IntervalQuantization":return gr.intervalQuantizaiton(a.min,a.max,a.numSteps);case"RunLength":return gr.runLength;case"Delta":return gr.delta;case"IntegerPacking":return gr.integerPacking;case"StringArray":return gr.stringArray}}})(eh||(eh={}));var gr;(function(e){var t,r;function n(x){return new XY([x])}e.by=n;function a(x){return{encodings:[{kind:"ByteArray",type:4}],data:x}}function i(x){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(x.buffer,x.byteOffset)}}var o=(t={},t[2]=function(x,C,w){x.setInt16(2*C,w,!0)},t[5]=function(x,C,w){x.setUint16(2*C,w,!0)},t[3]=function(x,C,w){x.setInt32(4*C,w,!0)},t[6]=function(x,C,w){x.setUint32(4*C,w,!0)},t[32]=function(x,C,w){x.setFloat32(4*C,w,!0)},t[33]=function(x,C,w){x.setFloat64(8*C,w,!0)},t),s=(r={},r[2]=2,r[5]=2,r[3]=4,r[6]=4,r[32]=4,r[33]=8,r);function u(x){var C=ef.getDataType(x);if(C===1)return i(x);if(C===4)return a(x);for(var w=new Uint8Array(x.length*s[C]),A=o[C],I=new DataView(w.buffer),D=0,k=x.length;D<k;D++)A(I,D,x[D]);return{encodings:[{kind:"ByteArray",type:C}],data:w}}e.byteArray=u;function l(x,C){for(var w=ef.getDataType(x),A=new Int32Array(x.length),I=0,D=x.length;I<D;I++)A[I]=Math.round(x[I]*C);return{encodings:[{kind:"FixedPoint",factor:C,srcType:w}],data:A}}function c(x){return function(C){return l(C,x)}}e.fixedPoint=c;function d(x,C,w,A,I){var D=ef.getDataType(x);if(!x.length)return{encodings:[{kind:"IntervalQuantization",min:C,max:w,numSteps:A,srcType:D}],data:new Int32Array(0)};if(w<C){var k=C;C=w,w=k}for(var R=(w-C)/(A-1),L=new I(x.length),H=0,B=x.length;H<B;H++){var j=x[H];j<=C?L[H]=0:j>=w?L[H]=A-1:L[H]=Math.round((j-C)/R)|0}return{encodings:[{kind:"IntervalQuantization",min:C,max:w,numSteps:A,srcType:D}],data:L}}function f(x,C,w,A){return A===void 0&&(A=Int32Array),function(I){return d(I,x,C,w,A)}}e.intervalQuantizaiton=f;function h(x){var C=ef.getDataType(x);if(C===void 0&&(x=new Int32Array(x),C=3),!x.length)return{encodings:[{kind:"RunLength",srcType:C,srcSize:0}],data:new Int32Array(0)};for(var w=2,A=1,I=x.length;A<I;A++)x[A-1]!==x[A]&&(w+=2);for(var D=new Int32Array(w),k=0,R=1,A=1,I=x.length;A<I;A++)x[A-1]!==x[A]?(D[k]=x[A-1],D[k+1]=R,R=1,k+=2):++R;return D[k]=x[x.length-1],D[k+1]=R,{encodings:[{kind:"RunLength",srcType:C,srcSize:x.length}],data:D}}e.runLength=h;function v(x){if(!ef.isSignedIntegerDataType(x))throw new Error("Only signed integer types can be encoded using delta encoding.");var C=ef.getDataType(x);if(C===void 0&&(x=new Int32Array(x),C=3),!x.length)return{encodings:[{kind:"Delta",origin:0,srcType:C}],data:new x.constructor(0)};var w=new x.constructor(x.length),A=x[0];w[0]=x[0];for(var I=1,D=x.length;I<D;I++)w[I]=x[I]-x[I-1];return w[0]=0,{encodings:[{kind:"Delta",origin:A,srcType:C}],data:w}}e.delta=v;function p(x){for(var C=0,w=x.length;C<w;C++)if(x[C]<0)return!0;return!1}function g(x,C){for(var w=-C-1,A=0,I=0,D=x.length;I<D;I++){var k=x[I];k===0?A+=1:k>0?(A+=Math.ceil(k/C),k%C===0&&(A+=1)):(A+=Math.ceil(k/w),k%w===0&&(A+=1))}return A}function m(x){var C=p(x),w=C?g(x,127):g(x,255),A=C?g(x,32767):g(x,65535);return x.length*4<A*2?{isSigned:C,size:x.length,bytesPerElement:4}:A*2<w?{isSigned:C,size:A,bytesPerElement:2}:{isSigned:C,size:w,bytesPerElement:1}}function y(x,C){for(var w=C.isSigned?C.bytesPerElement===1?127:32767:C.bytesPerElement===1?255:65535,A=-w-1,I=x.length,D=C.isSigned?C.bytesPerElement===1?new Int8Array(C.size):new Int16Array(C.size):C.bytesPerElement===1?new Uint8Array(C.size):new Uint16Array(C.size),k=0,R=0;R<I;R++){var L=x[R];if(L>=0)for(;L>=w;)D[k]=w,++k,L-=w;else for(;L<=A;)D[k]=A,++k,L-=A;D[k]=L,++k}var H=u(D);return{encodings:[{kind:"IntegerPacking",byteCount:C.bytesPerElement,isUnsigned:!C.isSigned,srcSize:I},H.encodings[0]],data:H.data}}function b(x){var C=m(x);return C.bytesPerElement===4?u(x):y(x,C)}e.integerPacking=b;function S(x){var C=Object.create(null),w=[],A=new Int32Array(x.length),I=Je.create(Int32Array,1,Math.min(1024,x.length<32?x.length+1:Math.round(x.length/8)+1));Je.add(I,0);for(var D=0,k=0,R=0,L=x;R<L.length;R++){var H=L[R];if(H==null){A[k++]=-1;continue}var B=C[H];B===void 0&&(D+=H.length,B=w.length,w[B]=H,C[H]=B,Je.add(I,D)),A[k++]=B}var j=Je.compact(I),Q=TM(j),G=Q.encode(j),W=TM(A),q=W.encode(A);return{encodings:[{kind:"StringArray",dataEncoding:q.encoding,stringData:w.join(""),offsetEncoding:G.encoding,offsets:G.data}],data:q.data}}e.stringArray=S})(gr||(gr={}));function zTe(e){var t=e.mask?YC(e.mask):void 0,r=YC(e.data),n=ok(r),a=n?t?function(l){return t[l]===0?""+r[l]:""}:function(l){return""+r[l]}:t?function(l){return t[l]===0?r[l]:""}:function(l){return r[l]},i=n?function(l){return r[l]}:function(l){var c=r[l];return jf(c,0,c.length)},o=n?function(l){return r[l]}:function(l){var c=r[l];return Mc(c,0,c.length)},s=t?function(l){return t[l]}:function(l){return 0},u=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:u,str:a,int:i,float:o,valueKind:s,areValuesEqual:function(l,c){return r[l]===r[c]},toStringArray:function(l){return ti(u,a,l)},toIntArray:n?function(l){return OC(r,l)}:function(l){return ti(u,i,l)},toFloatArray:n?function(l){return OC(r,l)}:function(l){return ti(u,o,l)}}}function YY(e){return QC({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function cP(e,t){for(var r={},n=0;n<t;n++){var a=QC(e);r[a]=QC(e)}return r}function dP(e,t){for(var r=new Uint8Array(t),n=e.offset,a=0;a<t;a++)r[a]=e.buffer[a+n];return e.offset+=t,r}function V2(e,t){var r=mk(e.buffer,e.offset,t);return e.offset+=t,r}function fP(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=QC(e);return r}function QC(e){var t=e.buffer[e.offset],r,n;if(!(t&128))return e.offset++,t;if((t&240)===128)return n=t&15,e.offset++,cP(e,n);if((t&240)===144)return n=t&15,e.offset++,fP(e,n);if((t&224)===160)return n=t&31,e.offset++,V2(e,n);if((t&224)===224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,dP(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,dP(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,dP(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,V2(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,V2(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,V2(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,fP(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,fP(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,cP(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,cP(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function VTe(e,t){for(var r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function HTe(e){for(var t=Object.create(null),r=Object.create(null),n=0,a=e.columns;n<a.length;n++){var i=a[n];t[i.name]=i}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(o){return o.name}),getField:function(o){var s=t[o];if(s)return r[o]||(r[o]=zTe(s)),r[o]}}}function i7(e){var t=this;return et.create("Parse BinaryCIF",function(r){return de(t,void 0,void 0,function(){var n,a,i;return fe(this,function(o){n=[0,3];try{return a=YY(e),VTe(n,a.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(s){return+s}))?(i=VY(a.dataBlocks.map(function(s){for(var u=Object.create(null),l=0,c=s.categories;l<c.length;l++){var d=c[l];u[d.name.substr(1)]=HTe(d)}return Uk(s.categories.map(function(f){return f.name.substr(1)}),u,s.header)})),[2,In.success(i)]):[2,In.error("Unsupported format version. Current "+a.version+", required "+n.join(".")+".")]}catch(s){return[2,In.error(""+s)]}return[2]})})})}var Qm;(function(e){function t(a){return a.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t;function r(a,i){return t(a)===t(i)}e.equal=r;function n(a,i,o){o===void 0&&(o=!1);var s=""+a+(i?"."+i:"");return o?t(s):s}e.create=n})(Qm||(Qm={}));function GTe(e,t,r){for(var n={},a=0,i=t.blocks;a<i.length;a++){var o=i[a];n[o.header]=uc(e,o,r)}return n}function uc(e,t,r){return XTe(e,t,r)}function KY(e,t){return new QY(t,e,!0)}function qTe(e){switch(e.valueType){case"str":return function(t,r,n){return hP(e,t,t.str,t.toStringArray)};case"int":return function(t,r,n){return hP(e,t,t.int,t.toIntArray)};case"float":return function(t,r,n){return hP(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function hP(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function WTe(e,t,r){var n=e.separator,a=e.itemParse,i=t.getField(r),o=i?function(u){return i.str(u).split(n).map(function(l){return a(l.trim())}).filter(function(l){return!!l})}:function(u){return[]},s=function(u){return ti(t.rowCount,o,u)};return{schema:e,__array:void 0,isDefined:!!i,rowCount:t.rowCount,value:o,valueKind:i?i.valueKind:function(){return 1},areValuesEqual:function(u,l){return to(o(u),o(l))},toArray:s}}function $Te(e,t,r){var n=e.space,a=t.fieldNames.includes(r+"[0]")||t.fieldNames.includes(r+"[0][0]")||t.fieldNames.includes(r+"[0][0][0]"),i=a?0:1,o=t.fieldNames.includes(r+"_1")||t.fieldNames.includes(r+"_11")||t.fieldNames.includes(r+"_111")?"underscore":"brackets",s=$Pe(r,n.rank,a,o),u=t.getField(s(i,i,i))||me.Undefined(t.rowCount,e),l=function(d){return XPe(t,n,d,s)},c=function(d){return ti(t.rowCount,l,d)};return{schema:e,__array:void 0,isDefined:u.isDefined,rowCount:t.rowCount,value:l,valueKind:u.valueKind,areValuesEqual:function(d,f){return Pr.areEqualExact(l(d),l(f))},toArray:c}}var QY=function(){function e(t,r,n){this._isDefined=n;var a=Object.keys(r);this._rowCount=t.rowCount,this._columns=a,this._schema=r;for(var i=Object.create(null),o=function(d){Object.defineProperty(s,d,{get:function(){if(i[d])return i[d];var f=r[d];if(f.valueType==="list")i[d]=WTe(f,t,d);else if(f.valueType==="tensor")i[d]=$Te(f,t,d);else{var h=qTe(f),v=t.getField(d);i[d]=v?h(v,t,d):me.Undefined(t.rowCount,f)}return i[d]},enumerable:!0,configurable:!1})},s=this,u=0,l=a;u<l.length;u++){var c=l[u];o(c)}}return e}();function XTe(e,t,r){for(var n=Object.create(null),a=0,i=Object.keys(e);a<i.length;a++){var o=i[a];n[o]=QTe(o,e[o],t,r)}return WI.ofTables(t.header,e,n)}function YTe(e){for(var t=Object.create(null),r=0,n=Object.keys(e.categories);r<n.length;r++)for(var a=n[r],i=0,o=e.categories[a].fieldNames;i<o.length;i++){var s=o[i],u=Qm.create(a,s,!0);t[u]=e.categories[a].getField(s)}return t}function KTe(e,t,r,n){var a=Qm.create(t,e),i=Qm.canonical(a);if(i in r)return r[i];if(n&&a in n)for(var o=0,s=n[a];o<s.length;o++){var u=s[o],l=Qm.canonical(u);if(l in r)return r[l]}}function QTe(e,t,r,n){var a=r.categories[e];if(n){for(var i=YTe(r),o=Object.create(null),s=[],u=0,l=0,c=Object.keys(t);l<c.length;l++){var d=c[l],f=KTe(d,e,i,n);f&&(o[d]=f,s.push(d),u=f.rowCount)}a={rowCount:u,name:e,fieldNames:Ut([],s),getField:function(h){return o[h]}}}return new QY(a||fi.empty(e),t,!!a)}var e0=me.Schema,Tr=e0.str,ZTe=e0.float,o7=e0.List,Lo=e0.Aliased,U0=e0.int,Vv=e0.coord,JTe={chem_comp:{formula:Tr,formula_weight:ZTe,id:Tr,mon_nstd_parent_comp_id:o7(",",function(e){return e}),name:Tr,one_letter_code:Tr,three_letter_code:Tr,type:Lo(Tr),pdbx_synonyms:o7(";",function(e){return e}),pdbx_type:Tr,pdbx_ambiguous_flag:Tr,pdbx_replaced_by:Tr,pdbx_replaces:Tr,pdbx_formal_charge:U0,pdbx_model_coordinates_details:Tr,pdbx_model_coordinates_db_code:Tr,pdbx_ideal_coordinates_details:Tr,pdbx_ideal_coordinates_missing_flag:Lo(Tr),pdbx_model_coordinates_missing_flag:Lo(Tr),pdbx_initial_date:Tr,pdbx_modified_date:Tr,pdbx_release_status:Lo(Tr),pdbx_processing_site:Lo(Tr)},chem_comp_atom:{alt_atom_id:Tr,atom_id:Tr,charge:U0,model_Cartn_x:Vv,model_Cartn_y:Vv,model_Cartn_z:Vv,comp_id:Tr,type_symbol:Tr,pdbx_align:U0,pdbx_ordinal:U0,pdbx_model_Cartn_x_ideal:Vv,pdbx_model_Cartn_y_ideal:Vv,pdbx_model_Cartn_z_ideal:Vv,pdbx_stereo_config:Lo(Tr),pdbx_aromatic_flag:Lo(Tr),pdbx_leaving_atom_flag:Lo(Tr)},chem_comp_bond:{atom_id_1:Tr,atom_id_2:Tr,comp_id:Tr,value_order:Lo(Tr),pdbx_ordinal:U0,pdbx_stereo_config:Lo(Tr),pdbx_aromatic_flag:Lo(Tr)},pdbx_chem_comp_descriptor:{comp_id:Tr,descriptor:Tr,type:Lo(Tr),program:Tr,program_version:Tr},pdbx_chem_comp_identifier:{comp_id:Tr,identifier:Tr,type:Lo(Tr),program:Tr,program_version:Tr}},w3=me.Schema,Vt=w3.str,e4e=w3.float,Wi=w3.Aliased,ps=w3.int,t4e={pdbx_reference_molecule:{prd_id:Vt,formula_weight:e4e,formula:Vt,type:Wi(Vt),type_evidence_code:Vt,class:Wi(Vt),class_evidence_code:Vt,name:Vt,represent_as:Wi(Vt),chem_comp_id:Vt,compound_details:Vt,description:Vt,representative_PDB_id_code:Vt,release_status:Wi(Vt),replaces:Vt,replaced_by:Vt},pdbx_reference_entity_list:{prd_id:Vt,ref_entity_id:Vt,type:Wi(Vt),details:Vt,component_id:ps},pdbx_reference_entity_nonpoly:{prd_id:Vt,ref_entity_id:Vt,name:Vt,chem_comp_id:Vt},pdbx_reference_entity_link:{link_id:ps,prd_id:Vt,details:Vt,ref_entity_id_1:Vt,ref_entity_id_2:Vt,entity_seq_num_1:ps,entity_seq_num_2:ps,comp_id_1:Vt,comp_id_2:Vt,atom_id_1:Vt,atom_id_2:Vt,value_order:Wi(Vt),component_1:ps,component_2:ps,link_class:Wi(Vt)},pdbx_reference_entity_poly_link:{link_id:ps,prd_id:Vt,ref_entity_id:Vt,component_id:ps,entity_seq_num_1:ps,entity_seq_num_2:ps,comp_id_1:Vt,comp_id_2:Vt,atom_id_1:Vt,atom_id_2:Vt,value_order:Wi(Vt)},pdbx_reference_entity_poly:{prd_id:Vt,ref_entity_id:Vt,type:Wi(Vt),db_code:Vt,db_name:Vt},pdbx_reference_entity_poly_seq:{prd_id:Vt,ref_entity_id:Vt,mon_id:Vt,parent_mon_id:Vt,num:ps,observed:Wi(Vt),hetero:Wi(Vt)},pdbx_reference_entity_sequence:{prd_id:Vt,ref_entity_id:Vt,type:Wi(Vt),NRP_flag:Wi(Vt),one_letter_codes:Vt},pdbx_reference_entity_src_nat:{prd_id:Vt,ref_entity_id:Vt,ordinal:ps,organism_scientific:Vt,taxid:Vt,db_code:Vt,db_name:Vt},pdbx_prd_audit:{prd_id:Vt,date:Vt,processing_site:Wi(Vt),action_type:Wi(Vt)}},ZY=me.Schema,ba=ZY.str,r4e=ZY.float,n4e={id:ba,description:ba},a4e={title:ba,datablock_id:ba,version:ba},i4e={version:ba,update:ba,revision:ba},o4e={id:ba,description:ba},s4e={id:ba,parent_id:ba,description:ba},u4e={code:ba,primitive_code:ba,construct:ba,detail:ba},l4e={code:ba,detail:ba},c4e={from_code:ba,to_code:ba,operator:ba,factor:r4e},d4e={datablock:n4e,dictionary:a4e,dictionary_history:i4e,sub_category:o4e,category_group_list:s4e,item_type_list:u4e,item_units_list:l4e,item_units_conversion:c4e},kb=me.Schema,al=kb.str,H2=kb.int,$l=kb.float,G2=kb.Aliased,tf=kb.Vector;G2(al),G2(al),G2(al),G2(al),tf(3),tf(3);var f4e={volume_data_3d_info:{name:al,axis_order:tf(3,H2),origin:tf(3),dimensions:tf(3),sample_rate:H2,sample_count:tf(3,H2),spacegroup_number:H2,spacegroup_cell_size:tf(3),spacegroup_cell_angles:tf(3),mean_source:$l,mean_sampled:$l,sigma_source:$l,sigma_sampled:$l,min_source:$l,min_sampled:$l,max_source:$l,max_sampled:$l},volume_data_3d:{values:$l}},E3=me.Schema,pP=E3.int,vn=E3.float,dn=E3.str,s7=E3.Matrix,h4e={cell:{formula_units_Z:pP,volume:vn,angle_alpha:vn,angle_beta:vn,angle_gamma:vn,length_a:vn,length_b:vn,length_c:vn},chemical:{melting_point:vn,name_common:dn,name_systematic:dn},chemical_formula:{moiety:dn,sum:dn,weight:vn},space_group:{crystal_system:dn,IT_number:pP,"name_H-M_full":dn},space_group_symop:{operation_xyz:dn},geom_bond:{atom_site_label_1:dn,atom_site_label_2:dn,distance:vn,publ_flag:dn,site_symmetry_1:dn,site_symmetry_2:dn,valence:vn},audit:{block_doi:dn},database_code:{COD:dn,CSD:dn,depnum_ccdc_archive:dn,depnum_ccdc_fiz:dn,ICSD:dn,MDF:dn,NBS:dn},atom_site:{adp_type:dn,calc_flag:dn,disorder_assembly:dn,disorder_group:dn,fract_x:vn,fract_y:vn,fract_z:vn,label:dn,occupancy:vn,refinement_flags:dn,site_symmetry_multiplicity:pP,type_symbol:dn,U_iso_or_equiv:vn},atom_site_aniso:{label:dn,U_11:vn,U:s7(3,3),U_11_su:vn,U_su:s7(3,3),U_12:vn,U_12_su:vn,U_13:vn,U_13_su:vn,U_22:vn,U_22_su:vn,U_23:vn,U_23_su:vn,U_33:vn,U_33_su:vn},atom_type:{description:dn,symbol:dn},atom_type_scat:{dispersion_imag:vn,dispersion_real:vn,source:dn}},p4e={"atom_site_aniso.U":["atom_site_anisotrop_U"],"atom_site_aniso.U_su":["atom_site_aniso_U_esd","atom_site_anisotrop_U_esd"],"space_group.IT_number":["symmetry_Int_Tables_number"],"space_group.name_H-M_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"atom_site.adp_type":["atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.U_11":["atom_site_anisotrop_U_11"],"atom_site_aniso.U_11_su":["atom_site_aniso_U_11_esd","atom_site_anisotrop_U_11_esd"],"atom_site_aniso.U_12":["atom_site_anisotrop_U_12"],"atom_site_aniso.U_12_su":["atom_site_aniso_U_12_esd","atom_site_anisotrop_U_12_esd"],"atom_site_aniso.U_13":["atom_site_anisotrop_U_13"],"atom_site_aniso.U_13_su":["atom_site_aniso_U_13_esd","atom_site_anisotrop_U_13_esd"],"atom_site_aniso.U_22":["atom_site_anisotrop_U_22"],"atom_site_aniso.U_22_su":["atom_site_aniso_U_22_esd","atom_site_anisotrop_U_22_esd"],"atom_site_aniso.U_23":["atom_site_anisotrop_U_23"],"atom_site_aniso.U_23_su":["atom_site_aniso_U_23_esd","atom_site_anisotrop_U_23_esd"],"atom_site_aniso.U_33":["atom_site_anisotrop_U_33"],"atom_site_aniso.U_33_su":["atom_site_aniso_U_33_esd","atom_site_anisotrop_U_33_esd"]},Xc={parse:function(e){return typeof e=="string"?a7(e):i7(e)},parseText:a7,parseBinary:i7,toDatabaseCollection:GTe,toDatabase:uc,schema:{mmCIF:function(e){return uc(mr,e)},CCD:function(e){return uc(JTe,e)},BIRD:function(e){return uc(t4e,e)},dic:function(e){return uc(d4e,e)},cifCore:function(e){return uc(h4e,e,p4e)},densityServer:function(e){return uc(f4e,e)}}},MM=function(){function e(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)},enumerable:!1,configurable:!0}),e}();(function(e){function t(r,n,a){return new e(r,n,a)}e.create=t})(MM||(MM={}));var Q1;(function(e){e.Default={assemblies:[],spacegroup:zu.ZeroP1,isNonStandardCrystalFrame:!1};function t(n,a){var i=a.toLocaleLowerCase(),o=ca.Provider.get(n);return o?sk(o.assemblies,function(s){return s.id.toLowerCase()===i}):void 0}e.findAssembly=t;function r(n){var a=n.spacegroup,i=a.cell,o=a.name,s=a.num,u=i.size,l=i.anglesInRadians,c=u[0].toFixed(2),d=u[1].toFixed(2),f=u[2].toFixed(2),h=Au(l[0]).toFixed(2),v=Au(l[1]).toFixed(2),p=Au(l[2]).toFixed(2),g=[];return g.push("Unit Cell <b>"+o+"</b> #"+s),g.push(c+"×"+d+"×"+f+" Å"),g.push("α="+h+"° β="+v+"° γ="+p+"°"),g.join(" | ")}e.getUnitcellLabel=r})(Q1||(Q1={}));function v4e(e,t,r){if(!e._rowCount)return[];for(var n=y4e(r),a=[],i=0;i<e._rowCount;i++)a[a.length]=m4e(e,t,i,n);return a}function m4e(e,t,r,n){for(var a=e.id.value(r),i=e.details.value(r),o=[],s=t.assembly_id,u=t.oper_expression,l=t.asym_id_list,c=0,d=t._rowCount;c<d;c++)s.value(c)===a&&(o[o.length]={assemblyId:a,expression:u.value(c),asymIds:l.value(c)});return MM.create(a,i,g4e(o,n))}function g4e(e,t){return function(){for(var r=[],n=0,a=0;a<e.length;a++){var i=e[a],o=S4e(i.expression),s=b4e(o),u=x4e(t,s,n,i.assemblyId),l=rn.generators.atoms({chainTest:rn.pred.and(rn.pred.eq(function(c){return pt.unit.operator_name(c.element)},gn.DefaultName),rn.pred.inSet(function(c){return pt.chain.label_asym_id(c.element)},i.asymIds))});r[r.length]={selector:l,operators:u},n+=u.length}return r}}function y4e(e){for(var t=e.id,r=e.matrix,n=e.vector,a=e._schema,i=new Map,o=0,s=e._rowCount;o<s;o++){var u=Pr.toMat4(le(),a.matrix.space,r.value(o)),l=Pr.toVec3(_(),a.vector.space,n.value(o));le.setTranslation(u,l),le.setValue(u,3,3,1),i.set(t.value(o),u)}return i}function b4e(e){for(var t=[],r=[],n=0;n<e.length;n++)r[n]="";return JY(e,t,e.length-1,r),t}function JY(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}for(var a=e[r],i=a.length,o=0;o<i;o++)n[r]=a[o],JY(e,t,r-1,n)}function x4e(e,t,r,n){for(var a=[],i=r,o=0,s=t;o<s.length;o++){for(var u=s[o],l=le.identity(),c=0;c<u.length;c++)le.mul(l,l,e.get(u[c]));i++,a[a.length]=gn.create("ASM_"+i,l,{assembly:{id:n,operId:i,operList:u}})}return a}function S4e(e){for(var t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],a;a=t.exec(e);)r[r.length]=a[1];return r.forEach(function(i){var o=[];i.split(",").forEach(function(s){var u=s.indexOf("-");if(u>0)for(var l=parseInt(s.substring(0,u)),c=parseInt(s.substr(u+1)),d=l;d<=c;d++)o[o.length]=d.toString();else o[o.length]=s.trim()}),n[n.length]=o}),n}var ca;(function(e){e.Descriptor={name:"model_symmetry"},e.Provider=ju.create(e.Descriptor);function t(n){var a=v4e(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),i=w4e(n.symmetry,n.cell),o=C4e(n.atom_sites);return{assemblies:a,spacegroup:i,isNonStandardCrystalFrame:o,ncsOperators:E4e(n.struct_ncs_oper)}}e.fromData=t;function r(n,a){var i=Io.create("P 1",n,a),o=zu.create(i);return{assemblies:[],spacegroup:o,isNonStandardCrystalFrame:!1}}e.fromCell=r})(ca||(ca={}));function C4e(e,t){return e._rowCount===0,!1}function _4e(e){var t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function w4e(e,t){if(e._rowCount===0||t._rowCount===0)return zu.ZeroP1;var r=_4e(e),n=Io.create(r,_.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),_.scale(_.zero(),_.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return zu.create(n)}function E4e(e){if(e._rowCount!==0){for(var t=e.id,r=e.matrix,n=e.vector,a=mr.struct_ncs_oper.matrix.space,i=mr.struct_ncs_oper.vector.space,o=[],s=0;s<e._rowCount;s++){var u=Pr.toMat3(qn(),a,r.value(s)),l=Pr.toVec3(_(),i,n.value(s));if(gn.checkIfRotationAndTranslation(u,l)&&!(e.code.value(s)==="given"&&!qn.isIdentity(u)&&!_.isZero(l))){var c=t.value(s);o[o.length]=gn.ofRotationAndOffset("ncs_"+c,u,l,c)}}return o}}function eK(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}var Z1;(function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=ju.create(e.Descriptor);function t(r,n,a){var i=new Map,o=[{kind:"none"}],s=A4e(r,n);P4e(r,s,i,o),T4e(n,s,i,r._rowCount,o);var u=a.residues._rowCount,l=function(d){return d},c={type:new Int32Array(u),key:new Int32Array(u),elements:o};return i.size>0&&M4e(a,s,i,c),eK(c.type,c.key,c.elements,l)}e.fromStruct=t})(Z1||(Z1={}));function A4e(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==0||e.end_label_seq_id.valueKind(0)!==0)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==0||t.end_label_seq_id.valueKind(0)!==0))return"auth";return"label"}function P4e(e,t,r,n){if(e._rowCount)for(var a=e.beg_label_asym_id,i=e.beg_label_seq_id,o=e.beg_auth_seq_id,s=e.pdbx_beg_PDB_ins_code,u=e.end_label_seq_id,l=e.end_auth_seq_id,c=e.pdbx_end_PDB_ins_code,d=e.pdbx_PDB_helix_class,f=e.conf_type_id,h=e.details,v=t==="label"?i:o,p=t==="label"?u:l,g=0,m=e._rowCount;g<m;g++){var y=Lr.create(d.valueKind(g)===0?Lr.SecondaryStructurePdb[d.value(g)]:f.valueKind(g)===0?Lr.SecondaryStructureMmcif[f.value(g)]:536870912),b={kind:"helix",flags:y,type_id:f.valueKind(g)===0?f.value(g):"HELIX_P",helix_class:d.value(g),details:h.valueKind(g)===0?h.value(g):void 0},S={startSeqId:v.value(g),startInsCode:s.value(g),endSeqId:p.value(g),endInsCode:c.value(g),type:y,key:n.length};n[n.length]=b;var x=a.value(g);if(r.has(x)){var C=r.get(x);C.has(S.startSeqId)?C.get(S.startSeqId).push(S):C.set(S.startSeqId,[S])}else r.set(x,new Map([[S.startSeqId,[S]]]))}}function T4e(e,t,r,n,a){if(e._rowCount)for(var i=e.beg_label_asym_id,o=e.beg_label_seq_id,s=e.beg_auth_seq_id,u=e.pdbx_beg_PDB_ins_code,l=e.end_label_seq_id,c=e.end_auth_seq_id,d=e.pdbx_end_PDB_ins_code,f=e.sheet_id,h=t==="label"?o:s,v=t==="label"?l:c,p=new Map,g=n+1,m=0,y=e._rowCount;m<y;m++){var b=f.value(m),S=void 0;p.has(b)?S=p.get(b):(S=g++,p.set(b,S));var x=Lr.create(8388612),C={kind:"sheet",flags:x,sheet_id:b,symmetry:void 0},w={startSeqId:h.value(m),startInsCode:u.value(m),endSeqId:v.value(m),endInsCode:d.value(m),type:x,key:a.length};a[a.length]=C;var A=i.value(m);if(r.has(A)){var I=r.get(A);I.has(w.startSeqId)?I.get(w.startSeqId).push(w):I.set(w.startSeqId,[w])}else r.set(A,new Map([[w.startSeqId,[w]]]))}}function I4e(e,t,r,n,a,i){for(var o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=r.endSeqId,d=r.endInsCode,f=r.key,h=r.type,v=t==="label"?u:s,p=n;p<a;){var g=v.value(p);if(i.type[p]=h,i.key[p]=f,g>c||g===c&&l.value(p)===d)break;p++}}function M4e(e,t,r,n){for(var a=e.chainAtomSegments.count,i=e.chains.label_asym_id,o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=t==="label"?u:s,d=0;d<a;d++){var f=Hp.chainStartResidueIndex(e,d),h=Hp.chainEndResidueIndexExcl(e,d),v=i.value(d);if(r.has(v))for(var p=r.get(v),g=f;g<h;g++){var m=c.value(g);if(p.has(m))for(var y=p.get(m),b=0,S=y;b<S.length;b++){var x=S[b],C=l.value(g);x.startInsCode===C&&I4e(e,t,x,g,h,n)}}}}var DM;(function(e){function t(s,u,l){return{name:s,type:0,value:u,valueKind:l&&l.valueKind,defaultFormat:l&&l.encoder?{encoder:l.encoder}:void 0,shouldInclude:l&&l.shouldInclude}}e.str=t;function r(s,u,l){return{name:s,type:1,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray}:void 0,shouldInclude:l&&l.shouldInclude}}e.int=r;function n(s,u,l){return{name:s,type:2,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray,digitCount:typeof l.digitCount<"u"?l.digitCount:void 0}:void 0,shouldInclude:l&&l.shouldInclude}}e.float=n;function a(s){return r(s,function(u,l,c){return c+1},{typedArray:Int32Array,encoder:gr.by(gr.delta).and(gr.runLength).and(gr.integerPacking)})}e.index=a;var i=function(){function s(){this.fields=[]}return s.prototype.index=function(u){return this.fields.push(e.index(u)),this},s.prototype.str=function(u,l,c){return this.fields.push(e.str(u,l,c)),this},s.prototype.int=function(u,l,c){return this.fields.push(e.int(u,l,c)),this},s.prototype.vec=function(u,l,c){for(var d=0;d<l.length;d++)this.fields.push(e.int(u+"["+(d+1)+"]",l[d],c));return this},s.prototype.float=function(u,l,c){return this.fields.push(e.float(u,l,c)),this},s.prototype.many=function(u){for(var l=0;l<u.length;l++)this.fields.push(u[l]);return this},s.prototype.add=function(u){return this.fields.push(u),this},s.prototype.getFields=function(){return this.fields},s}();e.Builder=i;function o(){return new i}e.build=o})(DM||(DM={}));var $o;(function(e){e.Empty={fields:[],source:[]};function t(n){for(var a=[],i=[],o=[],s=[],u=0,l=n.split(/[\r\n]+/);u<l.length;u++){var c=l[u];if(c=c.trim(),c.length!==0){var d=/^!/.test(c);d&&(c=c.substr(1));var f=c.split(/\./),h=f[1],v=d?h?s:i:h?o:a;v[v.length]=c,h&&!a.includes(f[0])&&(a[a.length]=f[0])}}var p=o.map(function(g){return g.split(".")[0]});return{includeCategory:function(g){return i.includes(g)?!1:a.length<=0||a.indexOf(g)!==-1},includeField:function(g,m){var y=g+"."+m;return s.includes(y)?!1:!p.includes(g)||o.includes(y)}}}e.filterOf=t,e.DefaultFilter={includeCategory:function(n){return!0},includeField:function(n,a){return!0}},e.DefaultFormatter={getFormat:function(n,a){}};function r(n,a){return a?{fields:u7(n._schema),source:[{data:n,rowCount:a.length,keys:function(){return FC.Array(a)}}]}:{fields:u7(n._schema),source:[{data:n,rowCount:n._rowCount}]}}e.ofTable=r})($o||($o={}));var RM;(function(e){function t(n,a,i){n.startDataBlock(a);for(var o=function(c){n.writeCategory({name:c,instance:function(){return $o.ofTable(i[c])}})},s=0,u=i._tableNames;s<u.length;s++){var l=u[s];o(l)}}e.writeDatabase=t;function r(n,a){for(var i=0,o=Object.keys(a);i<o.length;i++){var s=o[i];t(n,s,a[s])}}e.writeDatabaseCollection=r})(RM||(RM={}));function vP(e){return function(t,r){return r[e].value(t)}}function D4e(e){return function(t,r){return r[e].value(t).join(r[e].schema.separator)}}function mP(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(n,a){var i;return(i=a[e].schema.space).get.apply(i,Ut([a[e].value(n)],t))}}function xy(e){return function(t,r){return r[e].valueKind(t)}}function R4e(e,t){var r=[],n=2,a=xy(e);if(t.rank===1)for(var i=t.dimensions[0],o=0;o<i;o++){var s=e+"["+(o+1)+"]";r.push({name:s,type:n,value:mP(e,o),valueKind:a})}else if(t.rank===2)for(var i=t.dimensions[0],u=t.dimensions[1],o=0;o<i;o++)for(var l=0;l<u;l++){var c=e+"["+(o+1)+"]["+(l+1)+"]";r.push({name:c,type:n,value:mP(e,o,l),valueKind:a})}else if(t.rank===3)for(var d=t.dimensions[0],f=t.dimensions[1],h=t.dimensions[2],o=0;o<d;o++)for(var l=0;l<f;l++)for(var v=0;v<h;v++){var p=e+"["+(o+1)+"]["+(l+1)+"]["+(v+1)+"]";r.push({name:p,type:n,value:mP(e,o,l,v),valueKind:a})}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function u7(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=e[a];if(i.valueType==="int")t.push({name:a,type:1,value:vP(a),valueKind:xy(a)});else if(i.valueType==="float")t.push({name:a,type:2,value:vP(a),valueKind:xy(a)});else if(i.valueType==="str")t.push({name:a,type:0,value:vP(a),valueKind:xy(a)});else if(i.valueType==="list")t.push({name:a,type:0,value:D4e(a),valueKind:xy(a)});else if(i.valueType==="tensor")t.push.apply(t,R4e(a,i.space));else throw new Error("Unknown valueType "+i.valueType)}return t}function k4e(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function zk(e){return e.fields.some(function(t){return!!t.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(r){return t.shouldInclude(r.data)})}):e.fields}function tK(e,t){var r=e.instance(t),n=r.source.filter(function(o){return o.rowCount>0});if(!n.length)return{instance:r,rowCount:0,source:[]};var a=n.reduce(function(o,s){return o+s.rowCount},0),i=n.map(function(o){return{data:o.data,keys:function(){return o.keys?o.keys():FC.Range(0,o.rowCount-1)},rowCount:o.rowCount}});return{instance:r,rowCount:a,source:i}}var O4e=function(){function e(){this.builder=Rr.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=$o.DefaultFilter,this.formatter=$o.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}return e.prototype.setFilter=function(t){this.filter=t||$o.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||$o.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlockCreated=!0,Rr.write(this.builder,"data_"+(t||"").replace(/[ \n\t]/g,"").toUpperCase()+`
#
`)},e.prototype.writeCategory=function(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!(!(n!=null&&n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var a=tK(t,r),i=a.instance,o=a.rowCount,s=a.source;o&&(o===1?L4e(t,i,s,this.builder,this.filter,this.formatter):N4e(t,i,s,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(t){for(var r=Rr.getChunks(this.builder),n=0,a=r.length;n<a;n++)t.writeString(r[n])},e.prototype.getSize=function(){return Rr.getSize(this.builder)},e.prototype.getData=function(){return Rr.getString(this.builder)},e}();function rK(e,t,r,n,a,i){var o=n.valueKind,s=o?o(r,t):0;if(s!==0)s===1?j4e(e):z4e(e);else{var u=n.value(r,t,i),l=n.type;if(l===0)return F4e(u)?(yS(e,u),!0):V4e(e,u);l===1?B4e(e,u):U4e(e,u,a)}return!1}function nK(e,t,r){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=r.getFormat(e,o.name);s&&typeof s.digitCount<"u"?n[n.length]=o.type===2?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:n[n.length]=o.type===2?Math.pow(10,k4e(o)):0}return n}function L4e(e,t,r,n,a,i){var o=zk(t),s=r[0],u=s.data,l=o.reduce(function(g,m){return a.includeField(e.name,m.name)?Math.max(g,m.name.length):0},0);if(l!==0){l+=e.name.length+6;for(var c=s.keys(),d=c.move(),f=nK(e.name,t.fields,i),h=0;h<o.length;h++){var v=o[h];if(a.includeField(e.name,v.name)){Rr.writePadRight(n,"_"+e.name+"."+v.name,l);var p=rK(n,u,d,v,f[h],0);p||Rr.newline(n)}}Rr.write(n,`#
`)}}function N4e(e,t,r,n,a,i){var o=zk(t),s=a===$o.DefaultFilter?o:o.filter(function(b){return a.includeField(e.name,b.name)}),u=s.length;if(u!==0){var l=nK(e.name,s,i);l7(n,"loop_");for(var c=0;c<u;c++)l7(n,"_"+e.name+"."+s[c].name);for(var d=0,f=0;f<r.length;f++){var h=r[f],v=h.data;if(h.rowCount!==0)for(var p=h.keys();p.hasNext;){for(var g=p.move(),m=!1,y=0;y<u;y++)m=rK(n,v,g,s[y],l[y],d);m||Rr.newline(n),d++}}Rr.write(n,`#
`)}}function F4e(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function l7(e,t){Rr.write(e,t),Rr.newline(e)}function B4e(e,t){Rr.writeInteger(e,t),Rr.whitespace1(e)}function U4e(e,t,r){Rr.writeFloat(e,t,r),Rr.whitespace1(e)}function j4e(e){Rr.writeSafe(e,". ")}function z4e(e){Rr.writeSafe(e,"? ")}function V4e(e,t){if(!t)return Rr.writeSafe(e,". "),!1;for(var r=t.charCodeAt(0),n=!1,a=0,i=!1,o=!1,s=0,u=t.length-1;s<=u;s++){var l=t.charCodeAt(s);switch(l){case 9:n=!0;break;case 10:return yS(e,t),!0;case 32:n=!0;break;case 34:if(s&&s===u)break;if(i)return yS(e,t),!0;o=!0,n=!0,a=0;break;case 39:if(s&&s===u)break;if(o)return yS(e,t),!0;i=!0,n=!0,a=1;break}}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(Rr.writeSafe(e,a?'"':"'"),Rr.writeSafe(e,t),Rr.writeSafe(e,a?'" ':"' ")):(Rr.writeSafe(e,t),Rr.writeSafe(e," ")),!1}function yS(e,t){Rr.writeSafe(e,`
;`+t),Rr.writeSafe(e,`
;
`)}function H4e(e){var t=new ArrayBuffer(bS(e)),r=new DataView(t),n=new Uint8Array(t);return xS(e,r,n,0),n}function bS(e){var t=typeof e;if(t==="string"){var r=UC(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){var a,i=0;if(Array.isArray(e)){a=e.length;for(var o=0;o<a;o++)i+=bS(e[o])}else{var s=Object.keys(e);a=s.length;for(var o=0;o<a;o++){var u=s[o];i+=bS(u)+bS(e[u])}}if(a<16)return 1+i;if(a<65536)return 3+i;if(a<4294967296)return 5+i;throw new Error("Array or object too long 0x"+a.toString(16))}throw new Error("Unknown type "+t)}function xS(e,t,r,n){var a=typeof e;if(a==="string"){var i=UC(e);if(i<32)return t.setUint8(n,i|160),Am(r,n+1,e),1+i;if(i<256)return t.setUint8(n,217),t.setUint8(n+1,i),Am(r,n+2,e),2+i;if(i<65536)return t.setUint8(n,218),t.setUint16(n+1,i),Am(r,n+3,e),3+i;if(i<4294967296)return t.setUint8(n,219),t.setUint32(n+1,i),Am(r,n+5,e),5+i}if(e instanceof Uint8Array){var o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(n,196),t.setUint8(n+1,o),s.set(e,n+2),2+o;if(o<65536)return t.setUint8(n,197),t.setUint16(n+1,o),s.set(e,n+3),3+o;if(o<4294967296)return t.setUint8(n,198),t.setUint32(n+1,o),s.set(e,n+5),5+o}if(a==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(a==="boolean")return t.setUint8(n,e?195:194),1;if(a==="object"){var u,l=0,c=Array.isArray(e),d=void 0;if(c?u=e.length:(d=Object.keys(e),u=d.length),u<16?(t.setUint8(n,u|(c?144:128)),l=1):u<65536?(t.setUint8(n,c?220:222),t.setUint16(n+1,u),l=3):u<4294967296&&(t.setUint8(n,c?221:223),t.setUint32(n+1,u),l=5),c)for(var f=0;f<u;f++)l+=xS(e[f],t,r,n+l);else for(var f=0,h=d.length;f<h;f++){var v=d[f];l+=xS(v,t,r,n+l),l+=xS(e[v],t,r,n+l)}return l}throw new Error("Unknown type "+a)}var G4e=function(){function e(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=$o.DefaultFilter,this.formatter=$o.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:LTe,dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(t){this.filter=t||$o.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||$o.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!(!(n!=null&&n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var a=tK(t,r),i=a.instance,o=a.rowCount,s=a.source;if(o){for(var u={name:"_"+t.name,columns:[],rowCount:o},l=zk(i),c=0,d=l;c<d.length;c++){var f=d[c];if(this.filter.includeField(t.name,f.name)){var h=this.formatter.getFormat(t.name,f.name);u.columns.push(Y4e(t.name,f,s,o,h,this.binaryEncodingProvider,this.autoClassify))}}u.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=H4e(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(t){t.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e.prototype.getSize=function(){return this.encodedData.length},e}();function q4e(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===0?Array:e.type===1?Int32Array:Float64Array}function W4e(e){return e===0?eh.by(gr.stringArray):eh.by(gr.byteArray)}function $4e(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function X4e(e,t){return e===0?eh.by(gr.stringArray):e===1?TM(t):jTe(t)}function Y4e(e,t,r,n,a,i,o){var s=K4e(t,q4e(t,a),n,r),u=s.array,l=s.allPresent,c=s.mask,d=$4e(e,t,a,i);d||(o?d=X4e(t.type,u):d=W4e(t.type));var f=d.encode(u),h=void 0;if(!l){var v=eh.by(gr.runLength).and(gr.byteArray).encode(c);v.data.length<c.length?h=v:h=eh.by(gr.byteArray).encode(c)}return{name:t.name,data:f,mask:h}}function K4e(e,t,r,n){for(var a=e.type===0,i=new t(r),o=new Uint8Array(r),s=e.valueKind,u=e.value,l=!0,c=0,d=0;d<n.length;d++)for(var f=n[d].data,h=n[d].keys();h.hasNext;){var v=h.move(),p=s?s(v,f):0;p!==0?(o[c]=p,a&&(i[c]=""),l=!1):(o[c]=0,i[c]=u(v,f,c)),c++}return{array:i,allPresent:l,mask:o}}var Fa;(function(e){e.Encoder=RM,e.Category=$o,e.Field=DM,e.Encoding=gr;function t(u){var l=u||{},c=l.binary,d=c===void 0?!1:c,f=l.encoderName,h=f===void 0?"mol*":f;return d?new G4e(h,u?u.binaryEncodingPovider:void 0,u?!!u.binaryAutoClassifyEncoding:!1):new O4e}e.createEncoder=t;function r(){return e.Field.build()}e.fields=r;var n=e.Encoding;e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)};function a(u,l){return{fields:u,source:[l]}}e.categoryInstance=a;function i(u){return{get:function(l,c){var d=u.categories[l];if(d){var f=d.getField(c);return f&&f.binaryEncoding?eh.fromEncoding(f.binaryEncoding):void 0}}}}e.createEncodingProviderFromCifFrame=i;function o(u){return{get:function(l,c){for(var d=0;d<u.length;d++){var f=u[d];if(f.categoryName===l&&f.columnName===c)return s(f)}}}}e.createEncodingProviderFromJsonConfig=o;function s(u){var l=u.precision;if(l!==void 0){var c=Math.pow(10,l),d=n.by(n.fixedPoint(c));switch(u.encoding){case"pack":return d.and(n.integerPacking);case"rle":return d.and(n.runLength).and(n.integerPacking);case"delta":return d.and(n.delta).and(n.integerPacking);case"delta-rle":return d.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(u.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}})(Fa||(Fa={}));var Q4e={U:mr.atom_site_anisotrop.U,U_esd:mr.atom_site_anisotrop.U_esd},Rl;(function(e){e.Schema=Q4e,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:function(n){var a=e.Provider.get(n.firstModel);return!a||!nn.is(n.firstModel.sourceData)?Fa.Category.Empty:Fa.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop)}}]}},e.Provider=ju.create(e.Descriptor);function t(n,a){var i=new Int32Array(n.rowCount);i.fill(-1);for(var o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=a.rowCount;o<s;++o){var l=i[a.value(o)];l!==-1&&(u[l]=o)}return u}e.getElementToAnsiotrop=t;function r(n,a){for(var i={},o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=a.rowCount;o<s;++o){var l=i[a.value(o)];l!==void 0&&(u[l]=o)}return u}e.getElementToAnsiotropFromLabel=r})(Rl||(Rl={}));var J1;(function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(a){var i=e.Provider.get(a.firstModel);if(!i)return Fa.Category.Empty;var o=i.data;if(!o)return Fa.Category.Empty;for(var s=a.structures[0].uniqueResidueNames,u=o.comp_id,l=o._rowCount,c=[],d=0;d<l;d++)s.has(u.value(d))&&(c[c.length]=d);return Fa.Category.ofTable(o,c)}}]}},e.Provider=ju.create(e.Descriptor);function t(a,i){return Yr.pick(i,mr.chem_comp_bond,function(o){return a.properties.chemicalComponentMap.has(i.comp_id.value(o))})}e.chemCompBondFromTable=t;function r(a){var i=new Map;function o(C){if(i.has(C))return i.get(C);var w=new n(C);return i.set(C,w),w}for(var s=a.comp_id,u=a.atom_id_1,l=a.atom_id_2,c=a.value_order,d=a.pdbx_aromatic_flag,f=a._rowCount,h=o(s.value(0)),v=0;v<f;v++){var p=s.value(v),g=u.value(v),m=l.value(v),y=c.value(v),b=d.value(v)==="Y";h.id!==p&&(h=o(p));var S=1,x=1;switch(b&&(S|=16),y.toLowerCase()){case"doub":case"delo":x=2;break;case"trip":x=3;break;case"quad":x=4;break}h.add(g,m,x,S)}return i}e.getEntriesFromChemCompBond=r;var n=function(){function a(i){this.id=i,this.map=new Map}return a.prototype.add=function(i,o,s,u,l){l===void 0&&(l=!0);var c=this.map.get(i);if(c!==void 0){var d=c.get(o);d===void 0&&c.set(o,{order:s,flags:u})}else{var f=new Map;f.set(o,{order:s,flags:u}),this.map.set(i,f)}l&&this.add(o,i,s,u,!1)},a}();e.Entry=n})(J1||(J1={}));var Z4e=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function J4e(e,t,r){var n;return n=t<r?[t,r]:[r,t],t=n[0],r=n[1],b3.has(e)&&t==="C"&&r==="O"||C3.has(e)&&t==="OP1"&&r==="P"?2:Z4e.get(e+"|"+t+"|"+r)||1}var eIe=new Map([["LYS|NZ|RET|C15",2]]);function aK(e,t,r,n){var a,i;return e>r&&(a=[r,e],e=a[0],r=a[1],i=[n,t],t=i[0],n=i[1]),eIe.get(e+"|"+t+"|"+r+"|"+n)||1}var kl;(function(e){e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(i){var o=e.Provider.get(i.firstModel);if(!o||o.entries.length===0)return Fa.Category.Empty;for(var s=i.structures[0],u=[],l=0,c=o.entries;l<c.length;l++){var d=c[l];r(s,d.partnerA.atomIndex)&&r(s,d.partnerB.atomIndex)&&(u[u.length]=d.rowIndex)}return Fa.Category.ofTable(o.data,u)}}]}},e.Provider=ju.create(e.Descriptor);function t(i){var o=e.Provider.get(i);return!!o&&o.data.id.rowCount/i.atomicConformation.atomId.rowCount>.95}e.isExhaustive=t;function r(i,o){for(var s=i.units,u=0,l=s.length;u<l;u++)if(it.indexOf(s[u].elements,o)>=0)return!0;return!1}function n(i){for(var o=new Map,s=0,u=i;s<u.length;s++){var l=u[s],c=l.partnerA.atomIndex,d=l.partnerB.atomIndex;o.has(c)?o.get(c).push(l):o.set(c,[l]),o.has(d)?o.get(d).push(l):o.set(d,[l])}return o}e.getAtomIndexFromEntries=n;function a(i,o){for(var s=i.conn_type_id,u=i.pdbx_dist_value,l=i.pdbx_value_order,c={label_asym_id:i.ptnr1_label_asym_id,label_seq_id:i.ptnr1_label_seq_id,auth_seq_id:i.ptnr1_auth_seq_id,label_atom_id:i.ptnr1_label_atom_id,label_alt_id:i.pdbx_ptnr1_label_alt_id,ins_code:i.pdbx_ptnr1_PDB_ins_code,symmetry:i.ptnr1_symmetry},d={label_asym_id:i.ptnr2_label_asym_id,label_seq_id:i.ptnr2_label_seq_id,auth_seq_id:i.ptnr2_auth_seq_id,label_atom_id:i.ptnr2_label_atom_id,label_alt_id:i.pdbx_ptnr2_label_alt_id,ins_code:i.pdbx_ptnr2_PDB_ins_code,symmetry:i.ptnr2_symmetry},f=function(x,C){if(C.label_asym_id.valueKind(x)===0){var w=C.label_asym_id.value(x),A=o.atomicHierarchy.index.findEntity(w);if(!(A<0)){var I=o.atomicHierarchy.index.findResidue(o.entities.data.id.value(A),w,C.auth_seq_id.value(x),C.ins_code.value(x));if(!(I<0)){var D=C.label_atom_id.value(x);if(D){var k=o.atomicHierarchy.index.findAtomOnResidue(I,D,C.label_alt_id.value(x));if(!(k<0))return{residueIndex:I,atomIndex:k,symmetry:C.symmetry.value(x)}}}}}},h=[],v=0;v<i._rowCount;v++){var p=f(v,c),g=f(v,d);if(!(p===void 0||g===void 0)){var m=s.value(v),y=(l.value(v)||"").toLowerCase(),b=0,S=1;switch(y){case"sing":S=1;break;case"doub":S=2;break;case"trip":S=3;break;case"quad":S=4;break;default:S=aK(i.ptnr1_label_comp_id.value(v),i.ptnr1_label_atom_id.value(v),i.ptnr2_label_comp_id.value(v),i.ptnr2_label_atom_id.value(v))}switch(m){case"covale":b=1;break;case"disulf":b=9;break;case"hydrog":b=4;break;case"metalc":b=2;break}h.push({rowIndex:v,flags:b,order:S,distance:u.value(v),partnerA:p,partnerB:g})}}return h}e.getEntriesFromStructConn=a})(kl||(kl={}));var xp;(function(e){var t,r="molstar_global_model_transform_info";e.Schema=(t={},t[r]={matrix:me.Schema.Matrix(4,4,me.Schema.float)},t),e.Descriptor=Po({name:r,cifExport:{categories:[{name:r,instance:function(u){var l=a(u.firstModel);if(!l)return Fa.Category.Empty;var c=Yr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return Fa.Category.ofTable(c)}}],prefix:"molstar"}}),e.Provider=ju.create(e.Descriptor);function n(u,l){u.customProperties.has(e.Descriptor)||u.customProperties.add(e.Descriptor),e.Provider.set(u,l)}e.attach=n;function a(u){return e.Provider.get(u)}e.get=a;function i(u){if(nn.is(u.sourceData)){var l=u.sourceData.data.frame.categories[r];if(l){var c=KY(e.Schema[r],l);if(c._rowCount!==0)return c.matrix.value(0)}}}e.fromMmCif=i;function o(u){if(!nn.is(u.sourceData))return!1;var l=u.sourceData.data.frame.categories[r];return!!l&&l.rowCount>0}e.hasData=o;function s(u,l){u.writeCategory({name:r,instance:function(){var c=Yr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return Fa.Category.ofTable(c)}})}e.writeMmCif=s})(xp||(xp={}));function tIe(e){if(nn.is(e.sourceData))return ca.fromData(e.sourceData.data.db)}ca.Provider.formatRegistry.add("mmCIF",tIe);function rIe(e){if(nn.is(e.sourceData)){var t=e.sourceData.data.db,r=t.struct_conf,n=t.struct_sheet_range;return Z1.fromStruct(r,n,e.atomicHierarchy)}}Z1.Provider.formatRegistry.add("mmCIF",rIe);function nIe(e){if(nn.is(e.sourceData)){var t=e.sourceData.data.db.atom_site_anisotrop,r=Yr.ofColumns(Rl.Schema,t),n=Rl.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}}function aIe(e){return nn.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}Rl.Provider.formatRegistry.add("mmCIF",nIe,aIe);function iIe(e){if(nn.is(e.sourceData)){var t=e.sourceData.data.db.chem_comp_bond;if(t._rowCount!==0)return{data:t,entries:J1.getEntriesFromChemCompBond(t)}}}J1.Provider.formatRegistry.add("mmCIF",iIe);function oIe(e){if(nn.is(e.sourceData)){var t=e.sourceData.data.db.struct_conn;if(t._rowCount!==0){var r=kl.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:kl.getAtomIndexFromEntries(r),entries:r}}}}kl.Provider.formatRegistry.add("mmCIF",oIe);xp.Provider.formatRegistry.add("mmCIF",xp.fromMmCif,xp.hasData);var nn;(function(e){function t(n){return(n==null?void 0:n.kind)==="mmCIF"}e.is=t;function r(n,a,i){return a||(a=Xc.schema.mmCIF(n)),{kind:"mmCIF",name:a._name,data:{db:a,frame:n,source:i}}}e.fromFrame=r})(nn||(nn={}));function iK(e){var t=nn.fromFrame(e);return et.create("Create mmCIF Model",function(r){return fd(t.data.db,t,r)})}var at;(function(e){function t(f,h,v){return{kind:"element-location",structure:f,unit:h,element:v||0}}e.create=t;function r(f){return t(f.structure,f.unit,f.element)}e.clone=r;function n(f,h,v,p){return h&&(f.structure=h),v&&(f.unit=v),p!==void 0&&(f.element=p),f}e.set=n;function a(f,h){return f.unit=h.unit,f.element=h.element,f}e.copy=a;function i(f){return!!f&&f.kind==="element-location"}e.is=i;function o(f,h){return f.unit===h.unit&&f.element===h.element}e.areEqual=o;var s=_.zero(),u=_.zero();function l(f,h){return f.unit.conformation.position(f.element,s),h.unit.conformation.position(h.element,u),_.distance(s,u)}e.distance=l;function c(f){return f.unit.model.atomicHierarchy.residueAtomSegments.index[f.element]}e.residueIndex=c;function d(f){return f.unit.model.atomicHierarchy.chainAtomSegments.index[f.element]}e.chainIndex=d})(at||(at={}));var ke;(function(e){function t(s,u,l){return{kind:"variable",name:s,type:u,isConstraint:l}}e.Variable=t;function r(s,u,l){return{kind:"value",namespace:s,name:u,parent:l}}e.Value=r;function n(s,u,l,c){return{kind:"container",namespace:s,name:u,child:l,alias:c}}e.Container=n;function a(s){return{kind:"union",types:s}}e.Union=a;function i(s,u,l,c){for(var d=Object.create(null),f=0,h=c;f<h.length;f++){var v=h[f];d[v]=!0}return{kind:"oneof",namespace:s,name:u,type:l,values:d}}e.OneOf=i,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=i("","Bool",e.Str,["true","false"]);function o(s){var u=s.values;return Object.keys(u).sort()}e.oneOfValues=o})(ke||(ke={}));var Ia;(function(e){function t(u){return{name:u}}e.Symbol=t;function r(u,l){return l?{head:u,args:l}:{head:u}}e.Apply=r;function n(u){return!!u&&Array.isArray(u)}e.isArgumentsArray=n;function a(u){return!!u&&!Array.isArray(u)}e.isArgumentsMap=a;function i(u){return!o(u)&&!s(u)}e.isLiteral=i;function o(u){return!!u&&!!u.head&&typeof u=="object"}e.isApply=o;function s(u){return!!u&&typeof u.name=="string"}e.isSymbol=s})(Ia||(Ia={}));function gt(e,t){var r=t||{},n=r.description,a=n===void 0?void 0:n,i=r.isOptional,o=i===void 0?!1:i,s=r.isRest,u=s===void 0?!1:s,l=r.defaultValue,c=l===void 0?void 0:l;return{type:e,isOptional:o,isRest:u,defaultValue:c,description:a}}var Rt;(function(e){e.None=t({});function t(n){return{kind:"dictionary",map:n,"@type":0}}e.Dictionary=t;function r(n,a){var i=(a||{}).nonEmpty,o=i===void 0?!1:i;return{kind:"list",type:n,nonEmpty:o,"@type":0}}e.List=r})(Rt||(Rt={}));function Sy(e,t,r,n){var a=function(i){return Ia.Apply(Ia.Symbol(a.id),i)};return a.info={namespace:"",name:e,description:n},a.id="",a.args=t,a.type=r,a}function c7(e,t,r,n){var a=function(i){return Ia.Apply(Ia.Symbol(a.id),i)};return a.info={namespace:e,name:t,description:n},a.id=e+"."+t,a.args=Rt.None,a.type=r,a}function ZC(e){var t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function jt(e,t,r){return Sy("",e,t,r)}function oK(e){uK("","",e)}function sK(e){var t=[];return lK(e,t),t}function d7(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(r,n,a,i){return n+"-"+a.toLocaleLowerCase()+i}).replace(t,function(r,n,a,i){return n+"-"+a.toLocaleLowerCase()+i})}function uK(e,t,r){if(ZC(r)){r.info.namespace=e,r.info.name=r.info.name||d7(t),r.id=r.info.namespace+"."+r.info.name;return}for(var n=""+(r["@namespace"]||d7(t)),a=e?e+"."+n:n,i=0,o=Object.keys(r);i<o.length;i++){var s=o[i];typeof r[s]!="object"&&!ZC(r[s])||uK(a,s,r[s])}}function lK(e,t){if(ZC(e)){t.push(e);return}for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];typeof e[a]!="object"&&!ZC(e[a])||lK(e[a],t)}}var _r;(function(e){e.AnyVar=ke.Variable("a",ke.Any),e.AnyValueVar=ke.Variable("a",ke.Any),e.ConstrainedVar=ke.Variable("a",ke.Any,!0),e.Regex=ke.Value("Core","Regex"),e.Set=function(t){return ke.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return ke.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,r){return ke.Container("Core","Fn",t||e.AnyVar,r)},e.Flags=function(t,r){return ke.Container("Core","Flags",t,r)},e.BitFlags=e.Flags(ke.Num,"BitFlags")})(_r||(_r={}));function Ua(e,t){return jt(Rt.Dictionary({0:gt(e)}),e,t)}function hf(e,t){return jt(Rt.List(e,{nonEmpty:!0}),e,t)}function fl(e,t,r){return jt(Rt.Dictionary({0:gt(e),1:gt(e)}),t,r)}Rt.Dictionary({0:gt(ke.Num),1:gt(ke.Num)});gt(ke.Str);var sIe={"@header":"Types",bool:jt(Rt.Dictionary({0:gt(ke.AnyValue)}),ke.Bool,"Convert a value to boolean."),num:jt(Rt.Dictionary({0:gt(ke.AnyValue)}),ke.Num,"Convert a value to number."),str:jt(Rt.Dictionary({0:gt(ke.AnyValue)}),ke.Str,"Convert a value to string."),regex:jt(Rt.Dictionary({0:gt(ke.Str,{description:"Expression"}),1:gt(ke.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),_r.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:jt(Rt.List(_r.AnyVar),_r.List()),set:jt(Rt.List(_r.AnyValueVar),_r.Set()),bitflags:jt(Rt.Dictionary({0:gt(ke.Num)}),_r.BitFlags,"Interpret a number as bitflags."),compositeKey:jt(Rt.List(ke.AnyValue),ke.AnyValue)},uIe={"@header":"Logic",not:Ua(ke.Bool),and:hf(ke.Bool),or:hf(ke.Bool)},lIe={"@header":"Control",eval:jt(Rt.Dictionary({0:gt(_r.Fn(_r.AnyVar))}),_r.AnyVar,"Evaluate a function."),fn:jt(Rt.Dictionary({0:gt(_r.AnyVar)}),_r.Fn(_r.AnyVar),'Wrap an expression to a "lazy" function.'),if:jt(Rt.Dictionary({0:gt(ke.Bool,{description:"Condition"}),1:gt(ke.Variable("a",ke.Any),{description:"If true"}),2:gt(ke.Variable("b",ke.Any),{description:"If false"})}),ke.Union([ke.Variable("a",ke.Any),ke.Variable("b",ke.Any)])),assoc:jt(Rt.Dictionary({0:gt(ke.Str,{description:"Name"}),1:gt(ke.Variable("a",ke.Any),{description:"Value to assign"})}),ke.Variable("a",ke.Any))},cIe={"@header":"Relational",eq:fl(ke.Variable("a",ke.AnyValue,!0),ke.Bool),neq:fl(ke.Variable("a",ke.AnyValue,!0),ke.Bool),lt:fl(ke.Num,ke.Bool),lte:fl(ke.Num,ke.Bool),gr:fl(ke.Num,ke.Bool),gre:fl(ke.Num,ke.Bool),inRange:jt(Rt.Dictionary({0:gt(ke.Num,{description:"Value to test"}),1:gt(ke.Num,{description:"Minimum value"}),2:gt(ke.Num,{description:"Maximum value"})}),ke.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},dIe={"@header":"Math",add:hf(ke.Num),sub:hf(ke.Num),mult:hf(ke.Num),div:fl(ke.Num,ke.Num),pow:fl(ke.Num,ke.Num),mod:fl(ke.Num,ke.Num),min:hf(ke.Num),max:hf(ke.Num),floor:Ua(ke.Num),ceil:Ua(ke.Num),roundInt:Ua(ke.Num),abs:Ua(ke.Num),sqrt:Ua(ke.Num),cbrt:Ua(ke.Num),sin:Ua(ke.Num),cos:Ua(ke.Num),tan:Ua(ke.Num),asin:Ua(ke.Num),acos:Ua(ke.Num),atan:Ua(ke.Num),sinh:Ua(ke.Num),cosh:Ua(ke.Num),tanh:Ua(ke.Num),exp:Ua(ke.Num),log:Ua(ke.Num),log10:Ua(ke.Num),atan2:fl(ke.Num,ke.Num)},fIe={"@header":"Strings",concat:hf(ke.Str),match:jt(Rt.Dictionary({0:gt(_r.Regex),1:gt(ke.Str)}),ke.Bool)},hIe={"@header":"Lists",getAt:jt(Rt.Dictionary({0:gt(_r.List()),1:gt(ke.Num)}),_r.AnyVar),equal:jt(Rt.Dictionary({0:gt(_r.List()),1:gt(_r.List())}),ke.Bool)},pIe={"@header":"Sets",has:jt(Rt.Dictionary({0:gt(_r.Set(_r.ConstrainedVar)),1:gt(_r.ConstrainedVar)}),ke.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:jt(Rt.Dictionary({0:gt(_r.Set(_r.ConstrainedVar)),1:gt(_r.Set(_r.ConstrainedVar))}),ke.Bool,"Check if the the 1st argument is a subset of the 2nd.")},vIe={"@header":"Flags",hasAny:jt(Rt.Dictionary({0:gt(_r.Flags(_r.ConstrainedVar)),1:gt(_r.Flags(_r.ConstrainedVar))}),ke.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:jt(Rt.Dictionary({0:gt(_r.Flags(_r.ConstrainedVar)),1:gt(_r.Flags(_r.ConstrainedVar))}),ke.Bool,"Check if the the 1st argument has all 2nd one's flags.")},Vk={"@header":"Language Primitives",type:sIe,logic:uIe,ctrl:lIe,rel:cIe,math:dIe,str:fIe,list:hIe,set:pIe,flags:vIe};oK(Vk);var mIe=sK(Vk);(function(){for(var e=Object.create(null),t=0,r=mIe;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var Pt;(function(e){e.ElementSymbol=ke.Value("Structure","ElementSymbol"),e.AtomName=ke.Value("Structure","AtomName"),e.BondFlag=ke.OneOf("Structure","BondFlag",ke.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=_r.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=ke.OneOf("Structure","SecondaryStructureFlag",ke.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=_r.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=ke.Value("Structure","RingFingerprint"),e.EntityType=ke.OneOf("Structure","EntityType",ke.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=ke.OneOf("Structure","EntitySubtype",ke.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=ke.OneOf("Structure","ObjectPrimitive",ke.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=ke.Value("Structure","ResidueId"),e.ElementSet=ke.Value("Structure","ElementSet"),e.ElementSelection=ke.Value("Structure","ElementSelection"),e.ElementReference=ke.Value("Structure","ElementReference"),e.ElementSelectionQuery=_r.Fn(e.ElementSelection,"ElementSelectionQuery")})(Pt||(Pt={}));var gIe={"@header":"Types",elementSymbol:jt(Rt.Dictionary({0:gt(ke.Str)}),Pt.ElementSymbol,"Create element symbol representation from a string value."),atomName:jt(Rt.Dictionary({0:gt(ke.AnyValue)}),Pt.AtomName,"Convert a value to an atom name."),entityType:jt(Rt.Dictionary({0:gt(Pt.EntityType)}),Pt.EntityType,"Create normalized representation of entity type: "+ke.oneOfValues(Pt.EntityType).join(", ")+"."),bondFlags:jt(Rt.List(Pt.BondFlag),Pt.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: "+ke.oneOfValues(Pt.BondFlag).join(", ")+"."),ringFingerprint:jt(Rt.List(Pt.ElementSymbol,{nonEmpty:!0}),Pt.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:jt(Rt.List(Pt.SecondaryStructureFlag),Pt.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: "+ke.oneOfValues(Pt.SecondaryStructureFlag).join(", ")+"."),authResidueId:jt(Rt.Dictionary({0:gt(ke.Str,{description:"auth_asym_id"}),1:gt(ke.Num,{description:"auth_seq_id"}),2:gt(ke.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Pt.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:jt(Rt.Dictionary({0:gt(ke.Str,{description:"label_entity_id"}),1:gt(ke.Str,{description:"label_asym_id"}),2:gt(ke.Num,{description:"label_seq_id"}),3:gt(ke.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Pt.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},yIe={"@header":"Iteration Slots",element:jt(Rt.None,Pt.ElementReference,"A reference to the current element."),elementSetReduce:jt(Rt.None,ke.Variable("a",ke.AnyValue,!0),"Current value of the element set reducer.")},bIe={"@header":"Generators",all:jt(Rt.None,Pt.ElementSelectionQuery,"The entire structure."),atomGroups:jt(Rt.Dictionary({"entity-test":gt(ke.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":gt(ke.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":gt(ke.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":gt(ke.Bool,{isOptional:!0,defaultValue:!0}),"group-by":gt(ke.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),Pt.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:jt(Rt.Dictionary({0:gt(ke.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),Pt.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:jt(Rt.Dictionary({fingerprint:gt(Pt.RingFingerprint,{isOptional:!0}),"only-aromatic":gt(ke.Bool,{isOptional:!0,defaultValue:!1})}),Pt.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),query:gt(Pt.ElementSelectionQuery),"in-complement":gt(ke.Bool,{isOptional:!0,defaultValue:!1})}),Pt.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:jt(Rt.None,Pt.ElementSelectionQuery,"Nada.")},xIe={"@header":"Selection Modifications",queryEach:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),query:gt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),by:gt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),by:gt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),by:gt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),"min-distance":gt(ke.Num,{isOptional:!0,defaultValue:0}),"max-distance":gt(ke.Num),"min-size":gt(ke.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":gt(ke.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),Pt.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),radius:gt(ke.Num),"atom-radius":gt(ke.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":gt(ke.Bool,{isOptional:!0})}),Pt.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),radius:gt(ke.Num),"include-water":gt(ke.Bool,{isOptional:!0,defaultValue:!0})}),Pt.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),"bond-test":gt(ke.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":gt(ke.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":gt(ke.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":gt(ke.Bool,{isOptional:!0})}),Pt.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),property:gt(ke.AnyValue)}),Pt.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},SIe={"@header":"Selection Filters",pick:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),test:gt(ke.Bool)}),Pt.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),source:gt(Pt.ElementSelectionQuery),property:gt(ke.Any)}),Pt.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),by:gt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),target:gt(Pt.ElementSelectionQuery),"min-radius":gt(ke.Num,{isOptional:!0,defaultValue:0}),"max-radius":gt(ke.Num),"atom-radius":gt(ke.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:gt(ke.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),Pt.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery),target:gt(Pt.ElementSelectionQuery),"bond-test":gt(ke.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:gt(ke.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:gt(ke.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),Pt.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},CIe={"@header":"Selection Combinators",intersect:jt(Rt.List(Pt.ElementSelectionQuery),Pt.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:jt(Rt.List(Pt.ElementSelectionQuery),Pt.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:jt(Rt.Dictionary({matrix:gt(_r.List(_r.List(ke.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:gt(_r.List(Pt.ElementSelectionQuery),{description:"A list of held selections."})}),Pt.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},_Ie={"@header":"Atom Sets",atomCount:jt(Rt.None,ke.Num),countQuery:jt(Rt.Dictionary({0:gt(Pt.ElementSelectionQuery)}),ke.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:jt(Rt.Dictionary({initial:gt(ke.Variable("a",ke.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:gt(ke.Variable("a",ke.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),ke.Variable("a",ke.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:jt(Rt.Dictionary({0:gt(_r.ConstrainedVar)}),_r.Set(_r.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},wIe={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:xr(Pt.ElementSymbol),vdw:xr(ke.Num,"Van der Waals radius"),mass:xr(ke.Num,"Atomic weight"),atomicNumber:xr(ke.Num,"Atomic number"),x:xr(ke.Num,"Cartesian X coordinate"),y:xr(ke.Num,"Cartesian Y coordinate"),z:xr(ke.Num,"Cartesian Z coordinate"),atomKey:xr(ke.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:jt(Rt.Dictionary({0:gt(Pt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:gt(Pt.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),ke.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:xr(ke.Num,"Index of the atom/element in the input file."),operatorName:xr(ke.Str,"Name of the symmetry operator applied to this element."),modelIndex:xr(ke.Num,"Index of the model in the input file."),modelLabel:xr(ke.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:xr(ke.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:xr(Pt.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:xr(Pt.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:xr(ke.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:xr(ke.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:xr(ke.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:xr(ke.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:xr(ke.Num,"_atom_site.id"),label_atom_id:xr(Pt.AtomName),label_alt_id:xr(ke.Str),label_comp_id:xr(ke.Str),label_asym_id:xr(ke.Str),label_entity_id:xr(ke.Str),label_seq_id:xr(ke.Num),auth_atom_id:xr(Pt.AtomName),auth_comp_id:xr(ke.Str),auth_asym_id:xr(ke.Str),auth_seq_id:xr(ke.Num),pdbx_PDB_ins_code:xr(ke.Str),pdbx_formal_charge:xr(ke.Num),occupancy:xr(ke.Num),B_iso_or_equiv:xr(ke.Num),entityType:xr(Pt.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:xr(Pt.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:xr(ke.Str,"The PRD ID of the entity."),entityDescription:xr(_r.List(ke.Str)),objectPrimitive:xr(Pt.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:xr(ke.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:xr(Pt.SecondaryStructureFlags),isModified:xr(ke.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:xr(ke.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:xr(ke.Bool,"True if this is a non-standard residue."),chemCompType:xr(ke.Str,"Type of the chemical component as defined in mmCIF.")}},EIe={"@header":"Bond Properties",flags:j0(Pt.BondFlags),order:j0(ke.Num),length:j0(ke.Num),atomA:j0(Pt.ElementReference),atomB:j0(Pt.ElementReference)};function xr(e,t){return jt(Rt.Dictionary({0:gt(Pt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function j0(e,t){return jt(Rt.None,e,t)}var AIe={"@header":"Structure Queries",type:gIe,slot:yIe,generator:bIe,modifier:xIe,filter:SIe,combinator:CIe,atomSet:_Ie,atomProperty:wIe,bondProperty:EIe},PIe={"@header":"Generators",bundleElement:jt(Rt.Dictionary({groupedUnits:gt(ke.Any),set:gt(ke.Any),ranges:gt(ke.Any)}),ke.Any),bundle:jt(Rt.Dictionary({elements:gt(ke.Any)}),Pt.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:jt(Rt.None,Pt.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},TIe={"@header":"Internal Queries",generator:PIe},we={core:Vk,structureQuery:AIe,internal:TIe};oK(we);var IIe=sK(we);(function(){for(var e=Object.create(null),t=0,r=IIe;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var ue;(function(e){e.core=we.core,e.struct=we.structureQuery,e.internal=we.internal;function t(y){return e.struct.type.atomName([y])}e.atomName=t;function r(y){return e.struct.type.elementSymbol([y])}e.es=r;function n(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.list(y)}e.list=n;function a(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.set(y)}e.set=a;function i(y,b){return e.core.type.regex([y,b])}e.re=i;function o(y){return e.core.ctrl.fn([y])}e.fn=o;function s(y){return e.core.ctrl.eval([y])}e.evaluate=s;var u=e.struct.atomProperty.core,l=e.struct.atomProperty.macromolecular,c=e.struct.atomProperty.topology;function d(y){return u[y]()}e.acp=d;function f(y){return c[y]()}e.atp=f;function h(y){return l[y]()}e.ammp=h;var v=e.struct.atomSet.propertySet;function p(y){return v([d(y)])}e.acpSet=p;function g(y){return v([f(y)])}e.atpSet=g;function m(y){return v([h(y)])}e.ammpSet=m})(ue||(ue={}));var Yc=function(){function e(){this.count=0,this.center=_(),this.radiusSq=0}return e.prototype.reset=function(){_.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(t){_.add(this.center,this.center,t),this.count++},e.prototype.finishedIncludeStep=function(){this.count!==0&&_.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(t){var r=_.squaredDistance(t,this.center);r>this.radiusSq&&(this.radiusSq=r)},e.prototype.radiusSphereStep=function(t,r){var n=_.distance(t,this.center)+r,a=n*n;a>this.radiusSq&&(this.radiusSq=a)},e.prototype.getSphere=function(t){return t||(t=je()),_.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t},e.prototype.getCount=function(){return this.count},e}();(function(e){var t=new e,r=_(),n=_();function a(s,u){var l=s.x,c=s.y,d=s.z;t.reset();for(var f=l.length,h=0;h<f;h++)_.set(r,l[h],c[h],d[h]),t.includeStep(r);t.finishedIncludeStep();for(var h=0;h<f;h++)_.set(r,l[h],c[h],d[h]),t.radiusStep(r);return _.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u}e.fromArrays=a;function i(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r),t.includeStep(r);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r),t.radiusStep(r);return _.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromProvider=i;function o(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r,n),t.includeStep(r),t.includeStep(n);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r,n),t.radiusStep(r),t.radiusStep(n);return _.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromPairProvider=o})(Yc||(Yc={}));var qp=function(){function e(t){this.map=t;var r=0,n=[],a=new Map,i=new Map;this.map.forEach(function(o){o.forEach(function(s){r+=s.edgeCount,s.connectedIndices.forEach(function(u){s.getEdges(u).forEach(function(l){var c=s.unitA,d=s.unitB,f=e.getEdgeKey(u,c,l.indexB,d);a.set(f,n.length);var h=e.getVertexKey(u,c),v=i.get(h);v===void 0?i.set(h,[n.length]):v.push(n.length),n.push(E(E({},l),{indexA:u,unitA:c,unitB:d}))})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=a,this.vertexKeyIndex=i}return e.prototype.getConnectedUnits=function(t){return this.map.has(t)?this.map.get(t):cK},e.prototype.getEdgeIndex=function(t,r,n,a){var i=e.getEdgeKey(t,r,n,a),o=this.edgeKeyIndex.get(i);return o!==void 0?o:-1},e.prototype.hasEdge=function(t,r,n,a){return this.getEdgeIndex(t,r,n,a)!==-1},e.prototype.getEdge=function(t,r,n,a){var i=this.getEdgeIndex(t,r,n,a);return i!==-1?this.edges[i]:void 0},e.prototype.getEdgeIndices=function(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]},e}();(function(e){var t=function(){function o(s,u,l,c,d){this.unitA=s,this.unitB=u,this.edgeCount=l,this.connectedIndices=c,this.edgeMap=d}return o.prototype.hasEdges=function(s){return this.edgeMap.has(s)},o.prototype.getEdges=function(s){return this.edgeMap.has(s)?this.edgeMap.get(s):cK},Object.defineProperty(o.prototype,"areUnitsOrdered",{get:function(){return this.unitA<this.unitB},enumerable:!1,configurable:!0}),o}();e.UnitPairEdges=t;function r(o,s,u,l){return o+"|"+s+"|"+u+"|"+l}e.getEdgeKey=r;function n(o,s){return o+"|"+s}e.getVertexKey=n;function a(o,s,u){o.has(s)?o.get(s).push(u):o.set(s,[u])}var i=function(){function o(){this.map=new Map}return o.prototype.startUnitPair=function(s,u){this.uA=s,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=Jr.create(),this.linkedB=Jr.create(),this.linkCount=0},o.prototype.finishUnitPair=function(){this.linkCount!==0&&(a(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),a(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))},o.prototype.add=function(s,u,l){a(this.mapAB,s,{indexB:u,props:l}),a(this.mapBA,u,{indexB:s,props:l}),Jr.add(this.linkedA,s,s),Jr.add(this.linkedB,u,u),this.linkCount+=1},o.prototype.getMap=function(){return this.map},o}();e.Builder=i})(qp||(qp={}));var cK=[],kM;(function(e){e.Empty=To.create([],[],[],0,{flags:[],order:[]})})(kM||(kM={}));var Qy=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBondFromLocation=function(r){return We.isAtomic(r.aUnit)&&We.isAtomic(r.bUnit)?this.getEdge(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):void 0},t.prototype.getBondIndexFromLocation=function(r){return We.isAtomic(r.aUnit)&&We.isAtomic(r.bUnit)?this.getEdgeIndex(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):-1},t}(qp);(function(e){var t=function(r){Be(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n}(qp.UnitPairEdges);e.UnitPairBonds=t})(Qy||(Qy={}));var dK={forceCompute:!1,noCompute:!1},Hk={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},MIe={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},DIe={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},f7=2.001,eb=function(){for(var e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set,r=0,n=e;r<n.length;r++){var a=n[r];t.add(Hk[a])}return t}();function RIe(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function Ag(e){var t=Hk[e];return t===void 0?-1:t}function fK(e,t){if(e<0||t<0)return-1;var r=DIe[RIe(e,t)];return r===void 0?-1:r}function JC(e){if(e<0)return f7;var t=MIe[e];return t===void 0?f7:t}var kIe=Hk.H;function tb(e){return e===kIe}function hK(e,t,r,n,a,i){for(var o=new To.EdgeBuilder(a,e,t),s=new Uint16Array(o.slotCount),u=new Int8Array(o.slotCount),l=0,c=o.edgeCount;l<c;l++)o.addNextEdge(),o.assignProperty(s,n[l]),o.assignProperty(u,r[l]);return o.createGraph({flags:s,order:u},{canRemap:i})}var h7=_(),p7=_();function OIe(e,t,r){return e.conformation.position(t,h7),e.conformation.position(r,p7),_.distance(h7,p7)}var LIe=new Set;function NIe(e){for(var t=gi.Provider.get(e.model),r=e.elements,n=e.model.atomicHierarchy.atoms.type_symbol,a=e.elements.length,i=t.edgeProps,o=e.model.atomicHierarchy.atomSourceIndex,s=Xt.getInvertedAtomSourceIndex(e.model).invertedIndex,u=[],l=[],c=[],d=[],f=0;f<a;f++)for(var h=r[f],v=n.value(h)==="H",p=o.value(h),g=t.offset[p],m=t.offset[p+1];g<m;++g){var y=s[t.b[g]];if(!(h>=y)){var b=it.indexOf(e.elements,y);if(!(b<0)&&!(v&&n.value(y)==="H")){var S=i.distance[g];(S===-1||S===void 0||mn(OIe(e,h,y),S,.5))&&(u[u.length]=f,l[l.length]=b,d[d.length]=i.order[g],c[c.length]=i.flag[g])}}}return hK(u,l,d,c,a,!1)}function FIe(e,t){for(var r=4,n=e.model.atomicConformation,a=n.x,i=n.y,o=n.z,s=e.elements.length,u=e.elements,l=e.residueIndex,c=e.chainIndex,d=e.model.atomicHierarchy.atoms,f=d.type_symbol,h=d.label_atom_id,v=d.label_alt_id,p=d.label_comp_id,g=e.model.atomicHierarchy.residues.label_seq_id,m=e.model.atomicHierarchy.index,y=e.model.sequence.byEntityKey,b=e.lookup3d,S=kl.Provider.get(e.model),x=J1.Provider.get(e.model),C=kl.isExhaustive(e.model),w=[],A=[],I=[],D=[],k=-1,R=void 0,L=!0,H=!0,B=!0,j=LIe,Q=0;Q<s;Q++){var G=u[Q],W=f.value(G);L&&(W!=="H"||W!=="O")&&(L=!1);var q=t.forceCompute?void 0:S&&S.byAtomIndex.get(G),J=!1;if(q)for(var he=0,$=q;he<$.length;he++){var X=$[he],U=X.partnerA,z=X.partnerB;if(U.symmetry===z.symmetry){var ee=U.atomIndex===G?z:U,Y=it.indexOf(e.elements,ee.atomIndex);Y<0||(w[w.length]=Q,A[A.length]=Y,I[I.length]=X.flags,D[D.length]=X.order,J||j.clear(),J=!0,j.add(Y))}}if(!C){var Z=l[G],te=g.value(Z),ce=p.value(G);if(!t.forceCompute&&Z!==k)if(x&&x.entries.has(ce)){var be=y[m.getEntityFromChain(c[G])];be&&be.sequence.microHet.has(te)?R=void 0:R=x.entries.get(ce).map}else R=void 0;k=Z;for(var xe=Ag(W),Ie=h.value(G),_e=R?R.get(Ie):void 0,ae=b.find(a[G],i[G],o[G],r),ie=ae.indices,O=ae.count,V=ae.squaredDistances,ve=tb(xe),Pe=JC(xe),Me=v.value(G),Ge=eb.has(xe),$e=0;$e<O;$e++){var Y=ie[$e];if(!(J&&j.has(Y))){var Ze=u[Y];if(!(Ze<=G)){var ht=v.value(Ze);if(!(Me&&ht&&Me!==ht)){var Ue=Ag(f.value(Ze)),rt=tb(Ue);if(!(ve&&rt)){var ut=(Ge||eb.has(Ue))&&!(ve||rt),Ee=l[Ze];if(Z===Ee&&_e){var Te=_e.get(h.value(Ze));if(Te){w[w.length]=Q,A[A.length]=Y,D[D.length]=Te.order;var ye=Te.flags;ut&&(ye|1&&(ye^=1),ye|=2),I[I.length]=ye}continue}var Se=Math.sqrt(V[$e]);if(Se!==0){var Le=fK(xe,Ue),Ve=Le>0?Le:Ue<0?Pe:(Pe+JC(Ue))/1.95;if(Se<=Ve){w[w.length]=Q,A[A.length]=Y,D[D.length]=J4e(ce,Ie,h.value(Ze)),I[I.length]=(ut?2:1)|32;var nt=g.value(Ee);te===nt&&(H=!1),Math.abs(te-nt)>1&&(B=!1)}}}}}}}}}var Xe=L||H&&B;return hK(w,A,D,I,s,Xe)}function BIe(e,t){var r=E(E({},dK),t);return r.noCompute||Xt.isCoarseGrained(e.model)?kM.Empty:!r.forceCompute&&gi.Provider.get(e.model)?NIe(e):FIe(e,r)}var Cy=4,v7=_(),m7=_();function g7(e,t,r,n){return e.conformation.position(t,v7),r.conformation.position(n,m7),_.distance(v7,m7)}var UIe=le(),_h=_();function jIe(e,t,r,n){var a=e.elements,i=e.residueIndex,o=e.model.atomicConformation,s=o.x,u=o.y,l=o.z,c=t.elements,d=t.residueIndex,f=e.elements.length,h=e.model.atomicHierarchy.atoms,v=h.type_symbol,p=h.label_alt_id,g=h.label_atom_id,m=h.label_comp_id,y=t.model.atomicHierarchy.atoms,b=y.type_symbol,S=y.label_alt_id,x=y.label_atom_id,C=y.label_comp_id,w=e.model.atomicHierarchy.residues.auth_seq_id,A=t.model.atomicHierarchy.residues.auth_seq_id,I=e.model.atomicConformation.occupancy,D=t.model.atomicConformation.occupancy,k=I.isDefined&&D.isDefined,R=e.model===t.model&&kl.Provider.get(e.model),L=!r.forceCompute&&e.model===t.model&&gi.Provider.get(e.model),H=e.model.atomicHierarchy.atomSourceIndex,B=(L?Xt.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0}).invertedIndex,j=e.model===t.model&&kl.isExhaustive(e.model),Q=le.mul(UIe,t.conformation.operator.inverse,e.conformation.operator.matrix),G=!le.isIdentity(Q),W=t.boundary.sphere,q=W.center,J=W.radius,he=(J+Cy)*(J+Cy);n.startUnitPair(e.id,t.id);for(var $=0;$<f;$++){var X=a[$];if(_.set(_h,s[X],u[X],l[X]),G&&_.transformMat4(_h,_h,Q),!(_.squaredDistance(_h,q)>he)){if(!r.forceCompute&&L){for(var U=L.edgeProps,z=U.order,ee=U.distance,Y=U.flag,Z=H.value(X),te=L.offset[Z],ce=L.offset[Z+1];te<ce;++te){var be=B[L.b[te]],xe=it.indexOf(t.elements,be);if(!(xe<0)&&!(v.value(X)==="H"&&b.value(be)==="H")){var Ie=ee[te];Ie!==-1&&mn(g7(e,X,t,be),Ie,.5)&&n.add($,xe,{order:z[te],flag:Y[te]})}}continue}var _e=r.forceCompute?void 0:R&&R.byAtomIndex.get(X);if(_e&&_e.length){for(var ae=!1,ie=0,O=_e;ie<O.length;ie++){var V=O[ie],ve=V.partnerA,Pe=V.partnerB,Me=ve.atomIndex===X?Pe:ve,xe=it.indexOf(t.elements,Me.atomIndex);xe<0||g7(e,X,t,Me.atomIndex)>Cy||(n.add($,xe,{order:V.order,flag:V.flags}),ae=!0)}if(ae)continue}if(!j){var Ge=I.value(X),$e=t.lookup3d,Ze=$e.find(_h[0],_h[1],_h[2],Cy),ht=Ze.indices,Ue=Ze.count,rt=Ze.squaredDistances;if(Ue!==0)for(var ut=Ag(v.value(X)),Ee=tb(ut),Te=JC(ut),ye=p.value(X),Se=eb.has(ut),Le=g.value(X),Ve=m.value(i[X]),nt=0;nt<Ue;nt++){var xe=ht[nt],be=c[xe],Xe=S.value(be);if(!(ye&&Xe&&ye!==Xe)&&!(k&&D.value(be)<1&&Ge<1&&w.value(X)===A.value(be))){var He=Ag(b.value(be)),se=tb(He);if(!(Ee&&se)){var pe=(Se||eb.has(He))&&!(Ee||se),Ae=Math.sqrt(rt[nt]);if(Ae!==0){var Ye=fK(ut,He),ct=Ye>0?Ye:He<0?Te:(Te+JC(He))/1.95;if(Ae<=ct){var St=x.value(be),Bt=C.value(d[be]);n.add($,xe,{order:aK(Ve,Bt,Le,St),flag:(pe?2:1)|32})}}}}}}}}n.finishUnitPair()}function zIe(e,t){var r=new qp.Builder;if(t.noCompute||e.isCoarseGrained)return new Qy(r.getMap());var n=e.models.length===1&&gi.Provider.get(e.model);if(n){for(var a=n.edgeProps.distance,i=!1,o=0,s=a.length;o<s;++o)if(a[o]!==-1){i=!0;break}if(!i)return new Qy(r.getMap())}return tt.eachUnitPair(e,function(u,l){jIe(u,l,t,r)},{maxRadius:Cy,validUnit:function(u){return We.isAtomic(u)},validUnitPair:function(u,l){return t.validUnitPair(e,u,l)}}),new Qy(r.getMap())}function VIe(e,t){return zIe(e,E(E({},dK),{validUnitPair:t&&t.validUnitPair||function(r,n,a){var i=n.model.atomicHierarchy.derived.residue.moleculeType,o=a.model.atomicHierarchy.derived.residue.moleculeType,s=(!We.isAtomic(n)||i[n.residueIndex[n.elements[0]]]!==2)&&(!We.isAtomic(a)||o[a.residueIndex[a.elements[0]]]!==2);return tt.validUnitPair(r,n,a)&&s}}))}var Gt;(function(e){function t(p,g,m,y,b,S){return{kind:"bond-location",aStructure:p,aUnit:g,aIndex:m,bStructure:y,bUnit:b,bIndex:S}}e.Location=t;function r(p){return!!p&&p.kind==="bond-location"}e.isLocation=r;function n(p,g){return p.aStructure.label===g.aStructure.label&&p.bStructure.label===g.bStructure.label&&p.aIndex===g.aIndex&&p.bIndex===g.bIndex&&p.aUnit.id===g.aUnit.id&&p.bUnit.id===g.bUnit.id}e.areLocationsEqual=n;function a(p,g){return{kind:"bond-loci",structure:p,bonds:g}}e.Loci=a;function i(p){return!!p&&p.kind==="bond-loci"}e.isLoci=i;function o(p,g){if(p.structure!==g.structure||p.bonds.length!==g.bonds.length)return!1;for(var m=0,y=p.bonds.length;m<y;++m)if(!n(p.bonds[m],g.bonds[m]))return!1;return!0}e.areLociEqual=o;function s(p){return p.bonds.length===0}e.isLociEmpty=s;function u(p,g){if(g===p.structure)return p;var m=[];return p.bonds.forEach(function(y){var b=g.unitMap.get(y.aUnit.id);if(b){var S=g.unitMap.get(y.bUnit.id);if(S){var x=y.aUnit.elements[y.aIndex],C=it.indexOf(b.elements,x);if(C!==-1){var w=y.bUnit.elements[y.bIndex],A=it.indexOf(S.elements,w);A!==-1&&m.push(t(p.structure,b,C,p.structure,S,A))}}}}),a(g,m)}e.remapLoci=u;function l(p){for(var g=[],m=new Map,y=0,b=p.bonds;y<b.length;y++){var S=b[y],x=S.aIndex,C=S.aUnit,w=S.bIndex,A=S.bUnit;C===A?m.has(C.id)?m.get(C.id).push(x,w):m.set(C.id,[x,w]):(m.has(C.id)?m.get(C.id).push(x):m.set(C.id,[x]),m.has(A.id)?m.get(A.id).push(w):m.set(A.id,[w]))}return m.forEach(function(I,D){g.push({unit:p.structure.unitMap.get(D),indices:it.deduplicate(it.ofUnsortedArray(I))})}),Oe(p.structure,g)}e.toStructureElementLoci=l;function c(p,g){if(g.aUnit===g.bUnit){var m=g.aUnit.bonds,y=m.getEdgeIndex(g.aIndex,g.bIndex);return y<0?Nr.create(0):Nr.create(m.edgeProps.flags[y])}else{var b=p.interUnitBonds.getBondFromLocation(g);return b?Nr.create(b.props.flag):Nr.create(0)}}e.getType=c;function d(p,g){if(g.aUnit===g.bUnit){var m=g.aUnit.bonds,y=m.getEdgeIndex(g.aIndex,g.bIndex);return y<0?0:m.edgeProps.order[y]}else{var b=p.interUnitBonds.getBondFromLocation(g);return b?b.props.order:0}}e.getOrder=d;function f(p){for(var g=0,m=0,y=p.units.length;m<y;++m){var b=p.units[m];We.isAtomic(b)&&(g+=b.bonds.edgeCount)}return g}e.getIntraUnitBondCount=f;var h=function(){function p(){this.current={},this.hasNext=!1}return p.prototype.move=function(){return this.advance(),this.current},p.prototype.setElement=function(g,m,y){this.structure=g,this.unit=m,this.index=y,this.interBondIndices=g.interUnitBonds.getEdgeIndices(y,m.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=m.bonds.offset[y+1],this.intraBondIndex=m.bonds.offset[y],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},p.prototype.advance=function(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){var g=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(g.unitA!==this.unit.id?g.unitA:g.unitB),this.current.otherIndex=g.indexA!==this.index?g.indexA:g.indexB,this.current.type=g.props.flag,this.current.order=g.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},p}();e.ElementBondIterator=h;function v(p,g){return Yc.fromPairProvider(p.bonds.length,function(m,y,b){var S=p.bonds[m],x=S.aUnit,C=S.aIndex,w=S.bUnit,A=S.bIndex;x.conformation.position(x.elements[C],y),w.conformation.position(w.elements[A],b)},g)}e.getBoundingSphere=v})(Gt||(Gt={}));function HIe(e){for(var t=qIe(e),r=GIe(e,t),n=ar.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var a=n.move();WIe(r,a.start,a.end)}return r.rings}function GIe(e,t){return{startVertex:0,endVertex:0,count:0,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(4),right:new Int32Array(4),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function y7(e){e.count=e.endVertex-e.startVertex;for(var t=e.visited,r=e.pred,n=e.color,a=0;a<e.count;a++)t[a]=-1,r[a]=-1,n[a]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function qIe(e){for(var t=ar.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;t.hasNext;){var n=t.move();r=Math.max(r,n.end-n.start)}return r}function WIe(e,t,r){var n=e.visited;if(e.startVertex=t,e.endVertex=r,!(e.endVertex-e.startVertex<3)){e.currentRings=[];for(var a=e.unit.elements,i=[],o=e.startVertex;o<e.endVertex;o++){var s=e.altLoc.value(a[o]);Di(i,s)}if(yp(i,""),i.length===0){y7(e);for(var o=0;o<e.count;o++)n[o]>=0||b7(e,o)}else for(var u=0;u<i.length;u++){y7(e),e.hasAltLoc=!0,e.currentAltLoc=i[u];for(var o=0;o<e.count;o++)if(!(n[o]>=0)){var s=e.altLoc.value(a[e.startVertex+o]);s&&s!==e.currentAltLoc||b7(e,o)}}for(var o=0,l=e.currentRings.length;o<l;o++)e.rings.push(e.currentRings[o])}}function $Ie(e,t,r){if(!(r<t)){for(var n=e.pred,a=e.color,i=e.left,o=e.right,s=++e.currentColor,u=t,l=0;l<4&&(a[u]=s,u=n[u],!(u<0));l++);var c=0,d=0,f=!1,h=0;u=r;for(var l=0;l<4;l++){if(a[u]===s){h=u,f=!0;break}if(o[d++]=u,u=n[u],u<0)break}if(f){u=t;for(var l=0;l<4&&(i[c++]=u,!(h===u||(u=n[u],u<0)));l++);var v=c+d;if(!(v<3)){for(var p=new Int32Array(v),g=0,l=0;l<c;l++)p[g++]=e.startVertex+i[l];for(var l=d-1;l>=0;l--)p[g++]=e.startVertex+o[l];if(Pu(p),e.hasAltLoc)for(var m=0,y=e.currentRings.length;m<y;m++){var b=e.currentRings[m];if(p[0]===b[0]&&p.length===b.length){for(var S=!0,x=0,C=p.length;x<C;x++)if(p[x]!==b[x]){S=!1;break}if(S)return}}e.currentRings.push(it.ofSortedArray(p))}}}}function b7(e,t){var r=e.bonds,n=e.startVertex,a=e.endVertex,i=e.visited,o=e.queue,s=e.pred,u=e.unit.elements,l=r.b,c=r.edgeProps.flags,d=r.offset;i[t]=1,o[0]=t;for(var f=0,h=1;f<h;)for(var v=o[f++],p=n+v,g=d[p],m=d[p+1],y=g;y<m;y++){var b=l[y];if(!(b<n||b>=a||!Nr.isCovalent(c[y]))){if(e.hasAltLoc){var S=e.altLoc.value(u[b]);if(S&&e.currentAltLoc!==S)continue}var x=b-n;if(i[x]>0){s[x]!==v&&s[v]!==x&&$Ie(e,v,x);continue}i[x]=1,o[h++]=x,s[x]=v}}}function XIe(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[t-n-1];for(var a=x7(e),i=x7(r),o=!1,n=0;n<t;n++){var s=e[(n+a)%t],u=r[(n+i)%t];if(s!==u){o=s<u;break}}return o?S7(e,a):S7(r,i)}function x7(e){for(var t=e.length,r=new Int32Array(t*2),n=0;n<r.length;n++)r[n]=-1;for(var a="",i="",o=0,s=1;s<r.length;s++){for(var n=r[s-o-1];n!==-1&&(a=e[s%t],i=e[(o+n+1)%t],a!==i);)a<i&&(o=s-n-1),n=r[n];n===-1?(a=e[s%t],i=e[(o+n+1)%t],a!==i?(a<i&&(o=s),r[s-o]=-1):r[s-o]=n+1):r[s-o]=n+1}return o}function S7(e,t){var r=e.length,n=[],a;for(a=0;a<r-1;a++)n.push(e[(a+t)%r]),n.push("-");return n.push(e[(a+t)%r]),n.join("")}function YIe(e,t){for(var r=new Map,n=new Map,a=0,i=e.length;a<i;a++)for(var o=e[a],s=0,u=o.length;s<u;s++){var l=o[s];r.has(l)?r.get(l).push(a):r.set(l,[a])}for(var c=0,d=t.length;c<d;c++)for(var a=t[c],o=e[a],s=0,u=o.length;s<u;s++){var l=o[s];n.has(l)?n.get(l).push(a):n.set(l,[a])}for(var f=new To.UniqueEdgeBuilder(e.length),a=0,i=e.length;a<i;a++)for(var o=e[a],s=0,u=o.length;s<u;s++){var l=o[s],h=r.get(l);if(h.length!==1)for(var v=0,p=h.length;v<p;v++){var g=h[v];a>=g||f.addEdge(a,g)}}for(var m=To.connectedComponents(f.getGraph()),y=m.componentIndex,b=[],s=0;s<m.componentCount;s++)b[s]=[];for(var a=0,i=e.length;a<i;a++)b[y[a]].push(a);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:y,ringComponents:b}}var Ar;(function(e){function t(f,h,v){v===void 0&&(v=Float32Array);var p=f*h;return{data:new v(p),size:p,cols:f,rows:h}}e.create=t;function r(f,h,v){return f.data[f.rows*v+h]}e.get=r;function n(f,h,v,p){return f.data[f.rows*v+h]=p,f}e.set=n;function a(f,h,v,p){return f.data[f.rows*v+h]+=p,f}e.add=a;function i(f){return f.data.fill(0),f}e.makeZero=i;function o(f){return{data:f.data.slice(),size:f.size,cols:f.cols,rows:f.rows}}e.clone=o;function s(f,h,v){return{data:f,size:h*v,cols:h,rows:v}}e.fromArray=s;function u(f,h){if(f.cols!==h.rows||f.rows!==h.cols)throw new Error("transpose: matrix dimensions incompatible");if(f.data===h.data)throw new Error("transpose: matrices share memory");for(var v=h.rows,p=h.cols,g=h.data,m=f.data,y=0,b=0,S=0;y<v;S+=1,b+=p,++y)for(var x=S,C=0;C<p;x+=v,C++)m[x]=g[b+C];return f}e.transpose=u;function l(f,h,v){for(var p=h.cols,g=h.rows,m=v.rows,y=h.data,b=v.data,S=f.data,x=0,C=0,w=0;x<g;C+=p,x++)for(var A=0,I=0;I<m;w++,I++){for(var D=0,k=C,R=0;R<p;k++,A++,R++)D+=y[k]*b[A];S[w]=D}return f}e.multiplyABt=l;function c(f){for(var h=f.rows,v=f.cols,p=f.data,g=new Array(v),m=0;m<v;++m)g[m]=0;for(var y=0,b=0;y<h;++y)for(var m=0;m<v;++m,++b)g[m]+=p[b];for(var m=0;m<v;++m)g[m]/=h;return g}e.meanRows=c;function d(f,h){for(var v=f.rows,p=f.cols,g=f.data,m=0,y=0;m<v;++m)for(var b=0;b<p;++b,++y)g[y]-=h[b];return f}e.subRows=d})(Ar||(Ar={}));function gP(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function KIe(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var QIe=1192092896e-16,ZIe=1e-37;function JIe(e,t,r,n,a,i,o,s){for(var u=QIe*2,l=ZIe,c=0,d=0,f=0,h=0,v=Math.max(i,30),p=0,g=0,m=0,y=0,b=0,S=0,x=0,C=0,w=0,A=0,I=0,D=0,k=0,R=0,L=0,H=0,B=0,j=4660,Q=0,G=0,W=0,q=new Float64Array(o<<3);c<o;c++){for(f=0,I=0;f<i;f++)C=e[c*t+f],I+=C*C;if(q[c]=I,n){for(f=0;f<o;f++)n[c*a+f]=0;n[c*a+c]=1}}for(;h<v;h++){for(b=0,c=0;c<o-1;c++)for(d=c+1;d<o;d++){for(p=c*t|0,g=d*t|0,L=q[c],H=0,B=q[d],f=2,H+=e[p]*e[g],H+=e[p+1]*e[g+1];f<i;f++)H+=e[p+f]*e[g+f];if(!(Math.abs(H)<=u*Math.sqrt(L*B))){for(H*=2,D=L-B,k=KIe(H,D),D<0?(R=(k-D)*.5,x=Math.sqrt(R/k),S=H/(k*x*2)):(S=Math.sqrt((k+D)/(k*2)),x=H/(k*S*2)),L=0,B=0,f=2,w=S*e[p]+x*e[g],A=-x*e[p]+S*e[g],e[p]=w,e[g]=A,L+=w*w,B+=A*A,w=S*e[p+1]+x*e[g+1],A=-x*e[p+1]+S*e[g+1],e[p+1]=w,e[g+1]=A,L+=w*w,B+=A*A;f<i;f++)w=S*e[p+f]+x*e[g+f],A=-x*e[p+f]+S*e[g+f],e[p+f]=w,e[g+f]=A,L+=w*w,B+=A*A;if(q[c]=L,q[d]=B,b=1,n)for(m=c*a|0,y=d*a|0,f=2,w=S*n[m]+x*n[y],A=-x*n[m]+S*n[y],n[m]=w,n[y]=A,w=S*n[m+1]+x*n[y+1],A=-x*n[m+1]+S*n[y+1],n[m+1]=w,n[y+1]=A;f<o;f++)w=S*n[m+f]+x*n[y+f],A=-x*n[m+f]+S*n[y+f],n[m+f]=w,n[y+f]=A}}if(b===0)break}for(c=0;c<o;c++){for(f=0,I=0;f<i;f++)C=e[c*t+f],I+=C*C;q[c]=Math.sqrt(I)}for(c=0;c<o-1;c++){for(d=c,f=c+1;f<o;f++)q[d]<q[f]&&(d=f);if(c!==d&&(gP(q,c,d,I),n)){for(f=0;f<i;f++)gP(e,c*t+f,d*t+f,C);for(f=0;f<o;f++)gP(n,c*a+f,d*a+f,C)}}for(c=0;c<o;c++)r[c]=q[c];if(n)for(c=0;c<s;c++){for(I=c<o?q[c]:0;I<=l;){for(G=1/i,f=0;f<i;f++)j=j*214013+2531011,Q=j>>16&32767&256?G:-G,e[c*t+f]=Q;for(h=0;h<2;h++)for(d=0;d<c;d++){for(I=0,f=0;f<i;f++)I+=e[c*t+f]*e[d*t+f];for(W=0,f=0;f<i;f++)C=e[c*t+f]-I*e[d*t+f],e[c*t+f]=C,W+=Math.abs(C);for(W=W?1/W:0,f=0;f<i;f++)e[c*t+f]*=W}for(I=0,f=0;f<i;f++)C=e[c*t+f],I+=C*C;I=Math.sqrt(I)}for(x=1/I,f=0;f<i;f++)e[c*t+f]*=x}}function eMe(e,t,r,n){var a=0,i=0,o=e.rows,s=e.cols,u=o,l=s;u<l&&(a=1,i=u,u=l,l=i);var c=Ar.create(u,u),d=Ar.create(1,l),f=Ar.create(l,l);if(a===0)Ar.transpose(c,e);else{for(i=0;i<s*o;i++)c.data[i]=e.data[i];for(;i<l*u;i++)c.data[i]=0}if(JIe(c.data,u,d.data,f.data,l,u,l,u),t){for(i=0;i<l;i++)t.data[i]=d.data[i];for(;i<s;i++)t.data[i]=0}a===0?(r&&Ar.transpose(r,c),n&&Ar.transpose(n,f)):(r&&Ar.transpose(r,f),n&&Ar.transpose(n,c))}var Wp;(function(e){function t(u){var l=r(u),c=s(u,l);return{momentsAxes:l,boxAxes:c}}e.ofPositions=t;function r(u){if(u.length===3)return Su.create(_.fromArray(_(),u,0),_.create(1,0,0),_.create(0,1,0),_.create(0,1,0));var l=Ar.fromArray(u,3,u.length/3),c=l.rows,d=c/3,f=Ar.create(3,3),h=Ar.create(1,3),v=Ar.create(3,3),p=Ar.create(3,3),g=Ar.meanRows(l),m=Ar.subRows(Ar.clone(l),g),y=Ar.transpose(Ar.create(c,3),m);Ar.multiplyABt(f,y,y),eMe(f,h,v,p);var b=_.create(g[0],g[1],g[2]),S=_.create(v.data[0],v.data[3],v.data[6]),x=_.create(v.data[1],v.data[4],v.data[7]),C=_.create(v.data[2],v.data[5],v.data[8]);return _.scale(S,S,Math.sqrt(h.data[0]/d)),_.scale(x,x,Math.sqrt(h.data[1]/d)),_.scale(C,C,Math.sqrt(h.data[2]/d)),Su.create(b,S,x,C)}e.calculateMomentsAxes=r;var n=_(),a=_(),i=_(),o=_();function s(u,l){if(u.length===3)return Su.clone(l);for(var c=-1/0,d=-1/0,f=-1/0,h=-1/0,v=-1/0,p=-1/0,g=_(),m=_(),y=l.origin,b=_.normalize(a,l.dirA),S=_.normalize(i,l.dirB),x=_.normalize(o,l.dirC),C=0,w=u.length;C<w;C+=3){_.projectPointOnVector(g,_.fromArray(g,u,C),b,y);var A=_.dot(b,_.normalize(m,_.sub(m,g,y))),I=_.distance(g,y);A>0?I>c&&(c=I):I>d&&(d=I),_.projectPointOnVector(g,_.fromArray(g,u,C),S,y);var D=_.dot(S,_.normalize(m,_.sub(m,g,y))),k=_.distance(g,y);D>0?k>f&&(f=k):k>h&&(h=k),_.projectPointOnVector(g,_.fromArray(g,u,C),x,y);var R=_.dot(x,_.normalize(m,_.sub(m,g,y))),L=_.distance(g,y);R>0?L>v&&(v=L):L>p&&(p=L)}var H=_.setMagnitude(_(),b,(c+d)/2),B=_.setMagnitude(_(),S,(f+h)/2),j=_.setMagnitude(_(),x,(v+p)/2),Q=_(),G=function(W,q,J){_.copy(n,y),_.scaleAndAdd(n,n,b,W),_.scaleAndAdd(n,n,S,q),_.scaleAndAdd(n,n,x,J),_.add(Q,Q,n)};return G(c,f,v),G(c,f,-p),G(c,-h,-p),G(c,-h,v),G(-d,-h,-p),G(-d,-h,v),G(-d,f,v),G(-d,f,-p),_.scale(Q,Q,1/8),Su.create(Q,H,B,j)}e.calculateBoxAxes=s})(Wp||(Wp={}));var e_=function(){function e(t,r){this.unit=r,this.all=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index?this._index:(this._index=YIe(this.all,this.aromaticRings),this._index)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=tMe(this.unit,this.all),this._byFingerprint)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementAromaticRingIndices",{get:function(){return this.index.elementAromaticRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aromaticRings",{get:function(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=aMe(this.unit,this.all),this._aromaticRings)},enumerable:!1,configurable:!0}),e}(),Ls;(function(e){function t(s,u){for(var l=s.elements,c=s.model.atomicHierarchy.atoms.type_symbol,d=[],f=0,h=u.length;f<h;f++)d[d.length]=c.value(l[u[f]]);return r(d)}e.fingerprint=t;function r(s){return XIe(s)}e.elementFingerprint=r;var n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),a=.05;function i(s,u){var l=s.elements,c=s.bonds,d=c.b,f=c.offset,h=c.edgeProps.flags,v=s.model.atomicHierarchy.atoms,p=v.type_symbol,g=v.label_comp_id;if(g.value(s.elements[u[0]])==="PRO")return!1;for(var m=0,y=!1,b=0,S=u.length;b<S;++b){var x=u[b];!y&&n.has(p.value(l[x]))&&(y=!0);for(var C=f[x],w=f[x+1];C<w;++C)Nr.is(16,h[C])&&it.has(u,d[C])&&(m+=1)}if(m===2*u.length)return!0;if(!y)return!1;var A=Wp.calculateMomentsAxes(UY(s,u));return _.magnitude(A.dirC)<a}e.isAromatic=i;function o(s,u){for(var l=s.model.atomicHierarchy.atoms.label_alt_id,c=s.elements,d=0,f=u.length;d<f;++d){var h=c[u[d]],v=l.value(h);if(v)return v}return""}e.getAltId=o})(Ls||(Ls={}));(function(e){function t(n){var a=HIe(n);return new e(a,n)}e.create=t;function r(n,a){for(var i=new Map,o=0,s=a.length;o<s;o++){var u=a[o];nMe(n,u,i)}return i}e.byFingerprintAndResidue=r})(e_||(e_={}));function tMe(e,t){for(var r=new Map,n=0,a=0,i=t.length;a<i;a++){var o=t[a],s=Ls.fingerprint(e,o);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}function rMe(e,t){for(var r=e.elements,n=e.model.atomicHierarchy.residueAtomSegments.index,a=n[r[t[0]]],i=1,o=t.length;i<o;i++)if(a!==n[r[t[i]]])return-1;return a}function nMe(e,t,r){var n=e.byFingerprint.get(t);if(n)for(var a=0,i=n.length;a<i;a++){var o=n[a],s=rMe(e.unit,e.all[o]);s>=0&&(r.has(s)?r.get(s).push(o):r.set(s,[o]))}}function aMe(e,t){for(var r=[],n=0,a=t.length;n<a;++n)Ls.isAromatic(e,t[n])&&r.push(n);return r}var Zr;(function(e){function t(S){return it.ofSortedArray(S)}e.ofSortedRanges=t;function r(S){return S[0]}e.start=r;function n(S){return S[S.length-1]+1}e.end=n;function a(S){return S[0]}e.min=a;function i(S){return S[S.length-1]}e.max=i;function o(S){for(var x=0,C=0,w=S.length;C<w;C+=2)x+=S[C+1]-S[C]+1;return x}e.size=o;function s(S){return S.length/2}e.count=s;function u(S,x){return S[x*2]}e.startAt=u;function l(S,x){return S[x*2+1]+1}e.endAt=l;function c(S,x){return S[x*2]}e.minAt=c;function d(S,x){return S[x*2+1]}e.maxAt=d;function f(S,x){if(S.length!==x.length)return!1;for(var C=0,w=S.length;C<w;++C)if(S[C]!==x[C])return!1;return!0}e.areEqual=f;function h(S,x){for(var C=0,w=0,A=S.length;w<A;w+=2)for(var I=S[w],D=S[w+1];I<=D;++I)x(I,C),++C}e.forEach=h;function v(S,x){return g(S,x)!==-1}e.has=v;function p(S,x,C){return m(S,x,C)!==-1}e.hasFrom=p;function g(S,x){return m(S,x,0)}e.firstIntersectionIndex=g;function m(S,x,C){if(c(S,C)>Fe.max(x)||i(S)<Fe.min(x))return-1;for(var w=C,A=s(S);w<A;++w){var I=Re.ofRange(c(S,w),d(S,w));if(Fe.areIntersecting(I,x))return w}return-1}e.firstIntersectionIndexFrom=m;function y(S,x){return new b(S,x)}e.transientSegments=y;var b=function(){function S(x,C){this.ranges=x,this.set=C,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=g(x,C),this.hasNext=this.curIndex!==-1}return S.prototype.updateValue=function(){this.value.index=this.curIndex,this.value.start=Fe.findPredecessorIndex(this.set,u(this.ranges,this.curIndex)),this.value.end=Fe.findPredecessorIndex(this.set,l(this.ranges,this.curIndex))},S.prototype.move=function(){return this.hasNext&&(this.updateValue(),this.curIndex=m(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value},S}();e.Iterator=b})(Zr||(Zr={}));function iMe(e){for(var t=[],r=e.elements,n=e.model,a=e.model.atomicHierarchy.residueAtomSegments,i=n.atomicHierarchy.derived.residue.traceElementIndex,o=Zr.transientSegments(e.model.atomicRanges.polymerRanges,r),s=ar.transientSegments(a,r);o.hasNext;){var u=o.move();for(s.setSegment(u);s.hasNext;){var l=s.move(),c=l.start,d=l.end,f=l.index;if(Fe.areIntersecting(Re.ofRange(r[c],r[d-1]),r)){var h=i[f];t.push(h===-1?a.offsets[f]:h)}}}return it.ofSortedArray(t)}function oMe(e){for(var t=[],r=e.elements,n=e.model,a=n.coarseHierarchy,i=a.spheres,o=a.gaussians,s=We.isSpheres(e)?i.polymerRanges:o.polymerRanges,u=Zr.transientSegments(s,r);u.hasNext;)for(var l=u.move(),c=l.start,d=l.end,f=c;f<d;++f)t.push(r[f]);return it.ofSortedArray(t)}function sMe(e){for(var t=[],r=e.elements,n=e.model,a=e.residueIndex,i=e.model.atomicHierarchy.residueAtomSegments,o=n.atomicHierarchy.derived.residue.traceElementIndex,s=Zr.transientSegments(e.model.atomicRanges.gapRanges,e.elements);s.hasNext;){var u=s.move(),l=a[r[u.start]],c=a[r[u.end-1]],d=o[l],f=o[c];t.push(d===-1?i.offsets[l]:d),t.push(f===-1?i.offsets[c]:f)}return it.ofSortedArray(t)}function uMe(e){for(var t=[],r=e.elements,n=e.model,a=n.coarseHierarchy,i=a.spheres,o=a.gaussians,s=We.isSpheres(e)?i.gapRanges:o.gapRanges,u=Zr.transientSegments(s,r);u.hasNext;){var l=u.move(),c=l.start,d=l.end;t.push(r[c],r[d-1])}return it.ofSortedArray(t)}function lMe(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,i=a.chainAtomSegments,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=ar.transientSegments(i,r),d=ar.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(Fl(u[f])){var h=l[f];t.push(h===-1?o.offsets[f]:h)}}return it.ofSortedArray(t)}function cMe(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,i=a.chainAtomSegments,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=ar.transientSegments(i,r),d=ar.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(BY(u[f])){var h=l[f];t.push(h===-1?o.offsets[f]:h)}}return it.ofSortedArray(t)}var C7=_.zero();function dMe(e){for(var t=e.conformation.invariantPosition,r=e.elements,n=new Float32Array(r.length*3),a=0,i=r.length;a<i;a++)t(r[a],C7),_.toArray(C7,n,a*3);return n}function _7(e){var t=dMe(e);return Wp.ofPositions(t)}var ls=function(){function e(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new Yc,this.dir=fMe(t),this.reset()}return e.prototype.computeExtrema=function(t,r){var n=_.dot(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,_.copy(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,_.copy(this.extrema[t*2+1],r))},e.prototype.computeSphereExtrema=function(t,r,n){var a=_.dot(this.dir[t],r);a-n<this.minDist[t]&&(this.minDist[t]=a-n,_.scaleAndSub(this.extrema[t*2],r,this.dir[t],n)),a+n>this.maxDist[t]&&(this.maxDist[t]=a+n,_.scaleAndAdd(this.extrema[t*2+1],r,this.dir[t],n))},e.prototype.includeSphere=function(t){if(je.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var a=n[r];this.includePosition(a)}else this.includePositionRadius(t.center,t.radius)},e.prototype.includePosition=function(t){for(var r=0,n=this.dir.length;r<n;++r)this.computeExtrema(r,t)},e.prototype.includePositionRadius=function(t,r){for(var n=0,a=this.dir.length;n<a;++n)this.computeSphereExtrema(n,t,r)},e.prototype.finishedIncludeStep=function(){for(var t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()},e.prototype.radiusSphere=function(t){if(je.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var a=n[r];this.radiusPosition(a)}else this.radiusPositionRadius(t.center,t.radius)},e.prototype.radiusPosition=function(t){this.centroidHelper.radiusStep(t)},e.prototype.radiusPositionRadius=function(t,r){this.centroidHelper.radiusSphereStep(t,r)},e.prototype.getSphere=function(t){return je.setExtrema(this.centroidHelper.getSphere(t),Ut([],this.extrema))},e.prototype.getBox=function(t){return Yt.fromVec3Array(t||Yt(),this.extrema)},e.prototype.reset=function(){for(var t=0,r=this.dir.length;t<r;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=_(),this.extrema[t*2+1]=_();this.centroidHelper.reset()},e}();function fMe(e){var t;switch(e){case"6":t=Ut([],q2);break;case"14":t=Ut(Ut([],q2),yP);break;case"26":t=Ut(Ut(Ut([],q2),yP),w7);break;case"98":t=Ut(Ut(Ut(Ut(Ut(Ut([],q2),yP),w7),hMe),pMe),vMe);break}return t.map(function(r){var n=_.create(r[0],r[1],r[2]);return _.normalize(n,n)})}var q2=[[1,0,0],[0,1,0],[0,0,1]],yP=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],w7=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],hMe=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],pMe=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],vMe=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]],E7=_.set,mMe=new ls("14"),gMe=new ls("98");function yMe(e){return e>1e4?mMe:gMe}var W2=_();function Pg(e){var t=e.x,r=e.y,n=e.z,a=e.radius,i=e.indices,o=Fe.size(i);if(o>25e4){var s=Yt.computeBounding(e);return{box:s,sphere:je.fromBox3D(je(),s)}}var u=yMe(o);u.reset();for(var l=0;l<o;l++){var c=Fe.getAt(i,l);E7(W2,t[c],r[c],n[c]),u.includePositionRadius(W2,a&&a[c]||0)}u.finishedIncludeStep();for(var l=0;l<o;l++){var c=Fe.getAt(i,l);E7(W2,t[c],r[c],n[c]),u.radiusPositionRadius(W2,a&&a[c]||0)}var d=u.getSphere();if(!a&&je.hasExtrema(d)&&o<=d.extrema.length){for(var f=[],l=0;l<o;l++){var c=Fe.getAt(i,l);f.push(_.create(t[c],r[c],n[c]))}je.setExtrema(d,f)}return{box:u.getBox(),sphere:d}}var bMe=function(){function e(){this.data=new Map}return e.prototype.get=function(t){var r=it.hashCode(t);if(this.data.has(r))for(var n=0,a=this.data.get(r);n<a.length;n++){var i=a[n],o=i[0],s=i[1];if(it.areEqual(t,o))return s}},e.prototype.set=function(t,r){var n=it.hashCode(t);if(this.data.has(n)){for(var a=this.data.get(n),i=0,o=a;i<o.length;i++){var s=o[i];if(it.areEqual(t,s[0])){s[1]=r;return}}a.push([t,r])}else this.data.set(n,[[t,r]])},e.get=function(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache},e}(),We;(function(e){function t(B){return B.kind===0}e.isAtomic=t;function r(B){return B.kind===1||B.kind===2}e.isCoarse=r;function n(B){return B.kind===1}e.isSpheres=n;function a(B){return B.kind===2}e.isGaussians=a;function i(B,j,Q,G,W,q,J,he,$){switch(W){case 0:return new v(B,j,Q,G,q,he,gn.createMapping(J,q.atomicConformation,void 0),$??p());case 1:return x(B,j,Q,G,q,1,he,gn.createMapping(J,q.coarseConformation.spheres,f(q)),$??y());case 2:return x(B,j,Q,G,q,2,he,gn.createMapping(J,q.coarseConformation.gaussians,h()),$??y())}}e.create=i;function o(B){for(var j=Gs.Mutable(),Q=0,G=B.length;Q<G;Q++)j.set(B[Q].id,Q);return j}function s(B){for(var j=[],Q=0,G=B.length;Q<G;Q++)j.push(B[Q].id);return Ui(j)}function u(B){var j={};return{elements:B[0].elements,units:B,get unitIndexMap(){return j.unitIndexMap||(j.unitIndexMap=o(B)),j.unitIndexMap},hashCode:c(B[0]),transformHash:s(B)}}e.SymmetryGroup=u,function(B){function j(G,W){return G.hashCode!==W.hashCode?!1:it.areEqual(G.elements,W.elements)}B.areInvariantElementsEqual=j;function Q(G){for(var W=Gs.Mutable(),q=0,J=G.length;q<J;++q)for(var he=G[q],$=0,X=he.units.length;$<X;++$)W.set(he.units[$].id,q);return W}B.getUnitSymmetryGroupsIndexMap=Q}(u=e.SymmetryGroup||(e.SymmetryGroup={}));function l(B){return e.isAtomic(B)?B.model.atomicConformation.id:B.model.coarseConformation.id}e.conformationId=l;function c(B){return cv(B.invariantId,it.hashCode(B.elements))}e.hashUnit=c,function(B){B.is=mi.has,B.create=mi.create}(e.Traits||(e.Traits={}));function d(){return{}}function f(B){var j=B.coarseConformation.spheres.radius;return function(Q){return j[Q]}}function h(B){return function(j){return 0}}var v=function(){function B(j,Q,G,W,q,J,he,$){this.kind=0,this.objectPrimitive="atomistic",this.id=j,this.invariantId=Q,this.chainGroupId=G,this.traits=W,this.model=q,this.elements=J,this.conformation=he,this.residueIndex=q.atomicHierarchy.residueAtomSegments.index,this.chainIndex=q.atomicHierarchy.chainAtomSegments.index,this.props=$}return B.prototype.getChild=function(j){return j.length===this.elements.length?this:new B(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,j,this.conformation,p())},B.prototype.applyOperator=function(j,Q,G){G===void 0&&(G=!1);var W=G?Q:gn.compose(this.conformation.operator,Q);return new B(j,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,gn.createMapping(W,this.model.atomicConformation,this.conformation.r),this.props)},B.prototype.remapModel=function(j,Q){Q||(Q=E(E({},this.props),{bonds:I(this,this.props.bonds,j)}),e.isSameConformation(this,j)||(Q.boundary=void 0,Q.lookup3d=void 0,Q.principalAxes=void 0));var G=this.conformation.operator,W=ca.Provider.get(j);if(G.spgrOp!==-1&&W&&W!==ca.Provider.get(this.model)){var q=G.hkl,J=q[0],he=q[1],$=q[2],X=W.spacegroup.cell.toFractional,U=_.transformMat4(_(),Xt.getCenter(j),X);G=zu.getSymmetryOperatorRef(W.spacegroup,G.spgrOp,J,he,$,U)}var z=this.model.atomicConformation!==j.atomicConformation||G!==this.conformation.operator?gn.createMapping(G,j.atomicConformation):this.conformation;return new B(this.id,this.invariantId,this.chainGroupId,this.traits,j,this.elements,z,Q)},Object.defineProperty(B.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var j=this.model.atomicConformation,Q=j.x,G=j.y,W=j.z;return this.props.boundary=Pg({x:Q,y:G,z:W,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var j=this.model.atomicConformation,Q=j.x,G=j.y,W=j.z;return this.props.lookup3d=Gp({x:Q,y:G,z:W,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=_7(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"bonds",{get:function(){if(this.props.bonds)return this.props.bonds;var j=bMe.get(this.model),Q=j.get(this.elements);return Q||(Q=BIe(this),j.set(this.elements,Q)),this.props.bonds=Q,this.props.bonds},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"rings",{get:function(){return this.props.rings?this.props.rings:(this.props.rings=e_.create(this),this.props.rings)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=iMe(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=sMe(this),this.props.gapElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=lMe(this),this.props.nucleotideElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"proteinElements",{get:function(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=cMe(this),this.props.proteinElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"residueCount",{get:function(){if(this.props.residueCount!==void 0)return this.props.residueCount;for(var j=0,Q=ar.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);Q.hasNext;)Q.move(),j+=1;return this.props.residueCount=j,this.props.residueCount},enumerable:!1,configurable:!0}),B.prototype.getResidueIndex=function(j){return this.residueIndex[this.elements[j]]},B}();e.Atomic=v;function p(){return d()}var g=function(){function B(j,Q,G,W,q,J,he,$,X){this.kind=J,this.objectPrimitive=J===1?"sphere":"gaussian",this.id=j,this.invariantId=Q,this.chainGroupId=G,this.traits=W,this.model=q,this.elements=he,this.conformation=$,this.coarseElements=J===1?q.coarseHierarchy.spheres:q.coarseHierarchy.gaussians,this.coarseConformation=J===1?q.coarseConformation.spheres:q.coarseConformation.gaussians,this.props=X}return B.prototype.getChild=function(j){return j.length===this.elements.length?this:x(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,j,this.conformation,y())},B.prototype.applyOperator=function(j,Q,G){G===void 0&&(G=!1);var W=G?Q:gn.compose(this.conformation.operator,Q);return x(j,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,gn.createMapping(W,this.getCoarseConformation(),this.conformation.r),this.props)},B.prototype.remapModel=function(j,Q){var G=this.getCoarseConformation(),W=m(this.kind,j);Q||(Q=E({},this.props),e.isSameConformation(this,j)||(Q.boundary=void 0,Q.lookup3d=void 0,Q.principalAxes=void 0));var q=G!==W?gn.createMapping(this.conformation.operator,W):this.conformation;return new B(this.id,this.invariantId,this.chainGroupId,this.traits,j,this.kind,this.elements,q,Q)},Object.defineProperty(B.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var j=this.getCoarseConformation(),Q=j.x,G=j.y,W=j.z;return this.props.boundary=Pg({x:Q,y:G,z:W,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var j=this.getCoarseConformation(),Q=j.x,G=j.y,W=j.z;return this.props.lookup3d=Gp({x:Q,y:G,z:W,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=_7(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=oMe(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=uMe(this),this.props.gapElements)},enumerable:!1,configurable:!0}),B.prototype.getCoarseConformation=function(){return m(this.kind,this.model)},B}();function m(B,j){return B===1?j.coarseConformation.spheres:j.coarseConformation.gaussians}function y(){return d()}var b=function(B){Be(j,B);function j(){return B!==null&&B.apply(this,arguments)||this}return j}(g);e.Spheres=b;var S=function(B){Be(j,B);function j(){return B!==null&&B.apply(this,arguments)||this}return j}(g);e.Gaussians=S;function x(B,j,Q,G,W,q,J,he,$){return new g(B,j,Q,G,W,q,J,he,$)}function C(B,j){return B.chainGroupId===j.chainGroupId&&B.conformation.operator.name===j.conformation.operator.name}e.areSameChainOperatorGroup=C;function w(B,j){return le.areEqual(B.conformation.operator.matrix,j.conformation.operator.matrix,1e-6)}e.areOperatorsEqual=w;function A(B,j){return it.areEqual(B.elements,j.elements)?D(B,j.model):!1}e.areConformationsEqual=A;function I(B,j,Q){var G;if(j){if(B.model.atomicConformation.id===Q.atomicConformation.id)return j;var W=gi.Provider.get(B.model);if(W){var q=gi.Provider.get(Q);return!q||W===q?j:void 0}return!((G=j.props)===null||G===void 0)&&G.canRemap||D(B,Q)?j:void 0}}function D(B,j){var Q=Xt.CoordinatesHistory.get(Xt.getRoot(j));if(Q)return Q.areEqual(B.elements,B.kind,j);for(var G=B.elements,W=B.conformation.coordinates,q=W.x,J=W.y,he=W.z,$=k(B.kind,j),X=$.x,U=$.y,z=$.z,ee=0,Y=G.length;ee<Y;ee++){var Z=G[ee];if(q[Z]!==X[Z]||J[Z]!==U[Z]||he[Z]!==z[Z])return!1}return!0}e.isSameConformation=D;function k(B,j){return B===0?j.atomicConformation:B===1?j.coarseConformation.spheres:j.coarseConformation.gaussians}e.getModelConformationOfKind=k;function R(B){return k(B.kind,B.model)}e.getConformation=R;function L(B,j){return B===0?j.atomicHierarchy:B===1?j.coarseHierarchy.spheres:j.coarseHierarchy.gaussians}e.getModelHierarchyOfKind=L;function H(B){return L(B.kind,B.model)}e.getHierarchy=H})(We||(We={}));var t_;(function(e){function t(a,i,o,s){a.indices[a.count]=o,a.units[a.count]=i,a.squaredDistances[a.count]=s,a.count++}e.add=t;function r(){return{count:0,indices:[],units:[],squaredDistances:[]}}e.create=r;function n(a,i){for(var o=0;o<i.count;++o)a.indices[o]=i.indices[o],a.units[o]=i.units[o],a.squaredDistances[o]=i.squaredDistances[o];return a.count=i.count,a}e.copy=n})(t_||(t_={}));function pK(){return{result:t_.create(),closeUnitsResult:Jf.create(),unitGroupResult:Jf.create()}}var xMe=function(){function e(t){this.structure=t,this.pivot=_(),this.findContext=pK();for(var r=t.units,n=t.boundary,a=r.length,i=new Float32Array(a),o=new Float32Array(a),s=new Float32Array(a),u=new Float32Array(a),l=_(),c=0;c<a;c++){var d=r[c],f=d.boundary.sphere;_.transformMat4(l,f.center,d.conformation.operator.matrix),i[c]=l[0],o[c]=l[1],s[c]=l[2],u[c]=f.radius}var h={x:i,y:o,z:s,radius:u,indices:Fe.ofBounds(0,a)};this.unitLookup=Gp(h,n)}return e.prototype.findUnitIndices=function(t,r,n,a){return this.unitLookup.find(t,r,n,a)},e.prototype.find=function(t,r,n,a,i){return this._find(t,r,n,a,i??this.findContext)},e.prototype._find=function(t,r,n,a,i){Jf.reset(i.result);var o=this.structure.units,s=this.unitLookup.find(t,r,n,a,i.closeUnitsResult);if(s.count===0)return i.result;for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];_.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);for(var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],a,i.unitGroupResult),h=0,v=f.count;h<v;h++)t_.add(i.result,c,f.indices[h],f.squaredDistances[h])}return i.result},e.prototype.findIntoBuilder=function(t,r,n,a,i){var o=this.structure.units,s=this.unitLookup.find(t,r,n,a);if(s.count!==0)for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];_.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(f.count!==0){var h=c.elements;i.beginUnit(c.id);for(var v=0,p=f.count;v<p;v++)i.addElement(h[f.indices[v]]);i.commitUnit()}}},e.prototype.findIntoBuilderIf=function(t,r,n,a,i,o){var s=this.structure.units,u=this.unitLookup.find(t,r,n,a);if(u.count!==0)for(var l=at.create(this.structure),c=0,d=u.count;c<d;c++){var f=s[u.indices[c]];_.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);var h=f.lookup3d,v=h.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(v.count!==0){var p=f.elements;l.unit=f,i.beginUnit(f.id);for(var g=0,m=v.count;g<m;g++)l.element=p[v.indices[g]],o(l)&&i.addElement(l.element);i.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(t,r,n,a,i,o,s,u){var l=this.structure.units,c=this.unitLookup.find(t,r,n,o);if(c.count!==0)for(var d=at.create(this.structure),f=a+i+o,h=0,v=c.count;h<v;h++){var p=l[c.indices[h]];_.set(this.pivot,t,r,n),p.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,p.conformation.operator.inverse);var g=p.lookup3d,m=g.find(this.pivot[0],this.pivot[1],this.pivot[2],f);if(m.count!==0){var y=p.elements;d.unit=p,u.beginUnit(p.id);for(var b=0,S=m.count;b<S;b++){d.element=y[m.indices[b]];var x=s(d);Math.sqrt(m.squaredDistances[b])-a-x>o||u.addElement(y[m.indices[b]])}u.commitUnit()}}},e.prototype.check=function(t,r,n,a){var i=this.structure.units,o=this.unitLookup.find(t,r,n,a);if(o.count===0)return!1;for(var s=0,u=o.count;s<u;s++){var l=i[o.indices[s]];_.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var c=l.lookup3d;if(c.check(this.pivot[0],this.pivot[1],this.pivot[2],a))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.structure.boundary},enumerable:!1,configurable:!0}),e}();function rb(e,t){if(t.length===0)return tt.Empty;if(t.length===1)return t[0];for(var r=new Map,n=new Set,a=0,i=t;a<i.length;a++)for(var o=i[a].units,s=0,u=o.length;s<u;s++){var l=o[s];if(r.has(l.id)){if(n.has(l.id))continue;var c=it.union(r.get(l.id),l.elements);r.set(l.id,c),c.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}else r.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}var d=e.subsetBuilder(!0);return r.forEach(SMe,d),d.getStructure()}function SMe(e,t){this.setUnit(t,e)}function CMe(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;for(var r=e.units,n=t.unitMap,a=0,i=r.length;a<i;a++){var o=r[a];if(!n.has(o.id))return!1;var s=n.get(o.id);if(!it.areEqual(o.elements,s.elements))return!1}return!0}function A3(e,t){if(e===t)return!0;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=0,s=a.length;o<s;o++){var u=a[o];if(i.has(u.id)){var l=i.get(u.id);if(it.areIntersecting(u.elements,l.elements))return!0}}return!1}function vK(e,t){if(e===t)return e;if(!A3(e,t))return tt.Empty;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=[],s=0,u=a.length;s<u;s++){var l=a[s];if(i.has(l.id)){var c=i.get(l.id);if(it.areIntersecting(l.elements,c.elements)){var d=it.intersect(l.elements,c.elements);o[o.length]=l.getChild(d)}}}return tt.create(o,{parent:e.parent||t.parent})}function Gk(e,t){if(e===t)return tt.Empty;if(!A3(e,t))return e;for(var r=e.units,n=t.unitMap,a=[],i=0,o=r.length;i<o;i++){var s=r[i];if(!n.has(s.id)){a[a.length]=s;continue}var u=n.get(s.id),l=it.subtract(s.elements,u.elements);l.length>0&&(a[a.length]=s.getChild(l))}return tt.create(a,{parent:e.parent||t.parent})}var yt;(function(e){function t(m,y){return{kind:"singletons",source:m,structure:y}}e.Singletons=t;function r(m,y){return{kind:"sequence",source:m,structures:y}}e.Sequence=r;function n(m){return t(m,tt.Empty)}e.Empty=n;function a(m){return m.kind==="singletons"}e.isSingleton=a;function i(m){return a(m)?m.structure.units.length===0:m.structures.length===0}e.isEmpty=i;function o(m){return a(m)?m.structure.elementCount:m.structures.length}e.structureCount=o;function s(m){return i(m)?tt.Empty:a(m)?m.structure:rb(m.source,m.structures)}e.unionStructure=s;function u(m){for(var y=[],b=m.source.unitMap,S=0,x=s(m).units;S<x.length;S++){var C=x[S];C===b.get(C.id)?y[y.length]={unit:C,indices:Fe.ofBounds(0,C.elements.length)}:y[y.length]={unit:C,indices:Fe.ofSortedArray(it.indicesOf(b.get(C.id).elements,C.elements))}}return Oe(m.source,y)}e.toLociWithCurrentUnits=u;function l(m){for(var y=[],b=m.source.unitMap,S=0,x=s(m).units;S<x.length;S++){var C=x[S],w=b.get(C.id);w===C?y[y.length]={unit:w,indices:Fe.ofBounds(0,w.elements.length)}:y[y.length]={unit:w,indices:Fe.ofSortedArray(it.indicesOf(w.elements,C.elements))}}return Oe(m.source,y)}e.toLociWithSourceUnits=l;function c(m,y,b){var S=y.length;return S===0?n(m):b?t(m,rb(m,y)):r(m,y)}var d=function(){function m(y){this.source=y,this.structures=[],this.allSingletons=!0}return m.prototype.add=function(y){var b=y.elementCount;b!==0&&(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},m.prototype.getSelection=function(){return c(this.source,this.structures,this.allSingletons)},m}(),f=function(){function m(y){this.structure=y,this.structures=[],this.allSingletons=!0,this.uniqueSets=Ak(tt.hashCode,tt.areUnitIdsAndIndicesEqual)}return m.prototype.add=function(y){var b=y.elementCount;b===0||!this.uniqueSets.add(y)||(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},m.prototype.getSelection=function(){return c(this.structure,this.structures,this.allSingletons)},m}();function h(m){return new d(m)}e.LinearBuilder=h;function v(m){return new f(m)}e.UniqueBuilder=v;function p(m,y){var b=0;if(e.isSingleton(m))for(var S=0,x=m.structure.units;S<x.length;S++)for(var C=x[S],w=C.elements,A=0,I=w.length;A<I;A++){var D=tt.create([C.getChild(it.ofSingleton(w[A]))],{parent:m.source});y(D,b++)}else for(var k=0,R=m.structures;k<R.length;k++){var D=R[k];y(D,b++)}}e.forEach=p;function g(m,y){return a(m)?t(y,m.structure):r(y,m.structures)}e.withInputStructure=g})(yt||(yt={}));var en;(function(e){e.Empty={hash:-1,elements:[]};function t(c,d){return n(yt.toLociWithSourceUnits(yt.Singletons(c,d)))}e.fromSubStructure=t;function r(c){return n(yt.toLociWithSourceUnits(c))}e.fromSelection=r;function n(c){for(var d=[],f=0,h=c.elements;f<h.length;f++){var v=h[f],p=v.unit,g=v.indices;if(Fe.size(g)!==0){var m=[],y=[];if(Fe.isInterval(g))Fe.size(g)===1?y.push(Re.min(g)):m.push(Re.min(g),Re.max(g));else for(var b=0,S=g.length;b<S;){var x=b;for(b++;b<S&&g[b-1]+1===g[b];)b++;var C=b;if(C-x>2)m.push(g[x],g[C-1]);else for(var w=x;w<C;w++)y[y.length]=g[w]}d.push({unit:p,set:it.ofSortedArray(y),ranges:Zr.ofSortedRanges(m)})}}for(var A=new Map,b=0,I=d.length;b<I;++b){var v=d[b],D=cv(Ui(v.ranges),Ui(v.set));if(A.has(D)){var k=A.get(D).groupedUnits;k.has(v.unit.invariantId)?k.get(v.unit.invariantId).push(v.unit.id):k.set(v.unit.invariantId,[v.unit.id])}else{var k=new Map;k.set(v.unit.invariantId,[v.unit.id]),A.set(D,{groupedUnits:k,set:v.set,ranges:v.ranges})}}var R=[];return A.forEach(function(L){var H=[];L.groupedUnits.forEach(function(B){return H.push(it.ofUnsortedArray(B))}),H.sort(function(B,j){return B[0]-j[0]}),R.push({groupedUnits:H,set:L.set,ranges:L.ranges})}),{hash:c.structure.hashCode,elements:R}}e.fromLoci=n;function a(c,d){for(var f=[],h=0,v=c.length;h<v;++h){var p=c[h];d.unitMap.has(p)&&f.push(d.unitMap.get(p))}return f}function i(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],h=0,v=c.elements;h<v.length;h++)for(var p=v[h],g=function(S){var x=a(S,d);if(x.length===0)return"continue";var C=void 0;if(p.ranges.length===0)C=p.set;else if(p.set.length===0)if(p.ranges.length===2)C=Re.ofRange(p.ranges[0],p.ranges[1]);else{var w=new Int32Array(Zr.size(p.ranges));Zr.forEach(p.ranges,function(L,H){return w[H]=L}),C=it.ofSortedArray(w)}else{var A=Zr.size(p.ranges),I=new Int32Array(p.set.length+A);Zr.forEach(p.ranges,function(L,H){return I[H]=L}),I.set(p.set,A),C=it.ofUnsortedArray(I)}for(var D=0,k=x;D<k.length;D++){var R=k[D];f.push({unit:R,indices:C})}},m=0,y=p.groupedUnits;m<y.length;m++){var b=y[m];g(b)}return Oe(d,f)}e.toLoci=i;function o(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],h=0,v=c.elements;h<v.length;h++)for(var p=v[h],g=function(S){var x=a(S,d);if(x.length===0)return"continue";var C=x[0].elements,w=Zr.size(p.ranges),A=p.set.length,I=new Int32Array(A+w),D=void 0;if(w===0){for(var k=0,R=A;k<R;++k)I[k]=C[p.set[k]];D=it.ofSortedArray(I)}else if(A===0)Zr.forEach(p.ranges,function(j,Q){return I[Q]=C[j]}),D=it.ofSortedArray(I);else if(it.min(p.set)>Zr.max(p.ranges)){Zr.forEach(p.ranges,function(j,Q){return I[Q]=C[j]});for(var k=0,R=A;k<R;++k)I[k+w]=C[p.set[k]];D=it.ofSortedArray(I)}else if(Zr.min(p.ranges)>it.max(p.set)){for(var k=0,R=A;k<R;++k)I[k]=C[p.set[k]];Zr.forEach(p.ranges,function(j,Q){return I[Q+A]=C[j]}),D=it.ofSortedArray(I)}else{Zr.forEach(p.ranges,function(j,Q){return I[Q]=C[j]});for(var k=0,R=A;k<R;++k)I[k+w]=C[p.set[k]];D=it.ofUnsortedArray(I)}for(var L=0,H=x;L<H.length;L++){var B=H[L];f.push(B.getChild(D))}},m=0,y=p.groupedUnits;m<y.length;m++){var b=y[m];g(b)}return tt.create(f,{parent:d})}e.toStructure=o;function s(c){return ue.internal.generator.bundleElement({groupedUnits:ue.core.type.list(c.groupedUnits.map(function(d){return ue.core.type.list(d)})),ranges:ue.core.type.list(c.ranges),set:ue.core.type.list(c.set)})}function u(c){return ue.internal.generator.bundle({elements:ue.core.type.list(c.elements.map(s))})}e.toExpression=u;function l(c,d){if(c.elements.length!==d.elements.length)return!1;for(var f=0,h=c.elements.length;f<h;++f){var v=c.elements[f],p=d.elements[f];if(v.groupedUnits.length!==p.groupedUnits.length)return!1;for(var g=0,m=p.groupedUnits.length;g<m;++g)if(!it.areEqual(v.groupedUnits[g],p.groupedUnits[g]))return!1;if(!it.areEqual(v.set,p.set)||!Zr.areEqual(v.ranges,p.ranges))return!1}return!0}e.areEqual=l})(en||(en={}));function OM(e){return Nr.isCovalent(e.atomicBond.type)}function _Me(){return function(t){for(var r=t.inputStructure,n=at.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],pt.entity.type(n)==="polymer"){for(var l=ar.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();c<8||a.push(s)}}}return yt.Singletons(r,tt.create(a,{parent:r}))}}function wMe(){return function(t){for(var r=t.inputStructure,n=at.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;n.element=u[0],pt.entity.type(n)==="water"&&a.push(s)}}return yt.Singletons(r,tt.create(a,{parent:r}))}}function EMe(){return function(t){for(var r=t.inputStructure,n=at.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],pt.entity.type(n)!=="water"){if(pt.entity.type(n)==="polymer"){for(var l=ar.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();if(c>=8)continue}a.push(s)}}}return yt.Singletons(r,tt.create(a,{parent:r}))}}function AMe(){return function(t){for(var r=t.inputStructure,n=[],a=0,i=r.units;a<i.length;a++){var o=i[a];o.kind===1&&n.push(o)}return yt.Singletons(r,tt.create(n,{parent:r}))}}function mK(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function gK(e){return function(r){var n={hash:r.inputStructure.hashCode,elements:e};return yt.Sequence(r.inputStructure,[en.toStructure(n,r.inputStructure)])}}const PMe=Object.freeze(Object.defineProperty({__proto__:null,atomicHet:EMe,atomicSequence:_Me,bundleElementImpl:mK,bundleGenerator:gK,defaultBondTest:OM,spheres:AMe,water:wMe},Symbol.toStringTag,{value:"Module"}));var as=function(){function e(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=kn(),this.element=at.create(void 0),this.currentStructure=void 0,this.atomicBond=new A7,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}return e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=at.create(void 0),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentBond=function(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new A7,this.atomicBond},e.prototype.popCurrentBond=function(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0},e.prototype.pushInputStructure=function(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t},e.prototype.popInputStructure=function(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(this.timeoutMs!==0&&kn()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> "+this.timeoutMs/1e3+"s).")},e.prototype.tryGetCurrentSelection=function(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection},e}(),A7=function(){function e(){this.a=at.create(void 0),this.aIndex=0,this.b=at.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.testFn=OM}return e.prototype.setStructure=function(t){this.a.structure=t,this.b.structure=t},e.prototype.setTestFn=function(t){this.testFn=t||OM},e.prototype.test=function(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1},e.prototype.swap=function(){var t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;var r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;var n=this.a.element;this.a.element=this.b.element,this.b.element=n},Object.defineProperty(e.prototype,"length",{get:function(){return at.distance(this.a,this.b)},enumerable:!1,configurable:!0}),e}(),LM;(function(e){function t(r,n,a){return r(new as(n,a))}e.run=t})(LM||(LM={}));var NM=function(){function e(t){this.source=t,this.set=Ak(tt.hashCode,tt.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(t){t.elementCount&&(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))},e.prototype.getSelection=function(){return this.allSingletons?yt.Singletons(this.source,rb(this.source,this.structures)):yt.Sequence(this.source,this.structures)},e}(),TMe=function(){function e(t){this.source=t,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(t,r,n){var a=this.builderMap.get(t);a||(a=this.source.subsetBuilder(!0),this.builders[this.builders.length]=a,this.builderMap.set(t,a)),a.addToUnit(r,n)},e.prototype.allSingletons=function(){for(var t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var t=this.source.subsetBuilder(!0),r=at.create(this.source),n=0,a=this.builders.length;n<a;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return yt.Singletons(this.source,t.getStructure())},e.prototype.fullSelection=function(){for(var t=new Array(this.builders.length),r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return yt.Sequence(this.source,t)},e.prototype.getSelection=function(){var t=this.builders.length;return t===0?yt.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}(),qk=function(e){return yt.Sequence(e.inputStructure,[])},yK=function(e){return yt.Singletons(e.inputStructure,e.inputStructure)};function IMe(e){return Wk(E(E({},e),{groupBy:function(t){return pt.residue.key(t.element)}}))}function MMe(e){return Wk(E(E({},e),{groupBy:function(t){return pt.chain.key(t.element)}}))}function pf(e){return!0}function DMe(e){return 0}function Wk(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return yK;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return RMe(e.atomTest);var t={unitTest:e.unitTest||pf,entityTest:e.entityTest||pf,chainTest:e.chainTest||pf,residueTest:e.residueTest||pf,atomTest:e.atomTest||pf,groupBy:e.groupBy||DMe};return e.groupBy?OMe(t):kMe(t)}function RMe(e){return function(r){var n=r.inputStructure,a=n.units,i=r.pushCurrentElement(),o=n.subsetBuilder(!0);i.structure=n;for(var s=0,u=a;s<u.length;s++){var l=u[s];i.unit=l;var c=l.elements;o.beginUnit(l.id);for(var d=0,f=c.length;d<f;d++)i.element=c[d],e(r)&&o.addElement(i.element);o.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),yt.Singletons(n,o.getStructure())}}function kMe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest;return function(s){var u=s.inputStructure,l=u.units,c=s.pushCurrentElement(),d=u.subsetBuilder(!0),f=a===pf&&i===pf,h=i===pf;c.structure=u;for(var v=0,p=l;v<p.length;v++){var g=p[v];if(c.unit=g,!!t(s)){var m=g.elements,y=g.model;if(d.beginUnit(g.id),g.kind===0)for(var b=ar.transientSegments(g.model.atomicHierarchy.chainAtomSegments,m),S=ar.transientSegments(g.model.atomicHierarchy.residueAtomSegments,m);b.hasNext;){var x=b.move();if(c.element=m[x.start],!(!r(s)||!n(s))){if(f){d.addElementRange(m,x.start,x.end);continue}for(S.setSegment(x);S.hasNext;){var C=S.move();if(c.element=m[C.start],!!a(s)){if(h){d.addElementRange(m,C.start,C.end);continue}for(var w=C.start,A=C.end;w<A;w++)c.element=m[w],i(s)&&d.addElement(c.element)}}}}else for(var I=y.coarseHierarchy.spheres.chainElementSegments,b=ar.transientSegments(I,m);b.hasNext;){var x=b.move();if(c.element=m[x.start],!(!r(s)||!n(s))){if(f){d.addElementRange(m,x.start,x.end);continue}for(var w=x.start,A=x.end;w<A;w++)c.element=m[w],a(s)&&d.addElement(c.element)}}d.commitUnit(),s.throwIfTimedOut()}}return s.popCurrentElement(),yt.Singletons(u,d.getStructure())}}function OMe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest,o=e.groupBy;return function(u){var l=u.inputStructure,c=l.units,d=u.pushCurrentElement(),f=new TMe(l);d.structure=l;for(var h=0,v=c;h<v.length;h++){var p=v[h];if(d.unit=p,!!t(u)){var g=p.elements,m=p.model;if(p.kind===0)for(var y=ar.transientSegments(m.atomicHierarchy.chainAtomSegments,g),b=ar.transientSegments(m.atomicHierarchy.residueAtomSegments,g);y.hasNext;){var S=y.move();if(d.element=g[S.start],!(!r(u)||!n(u)))for(b.setSegment(S);b.hasNext;){var x=b.move();if(d.element=g[x.start],!!a(u))for(var C=x.start,w=x.end;C<w;C++)d.element=g[C],i(u)&&f.add(o(u),p.id,d.element)}}else for(var A=m.coarseHierarchy.spheres.chainElementSegments,y=ar.transientSegments(A,g);y.hasNext;){var S=y.move();if(d.element=g[S.start],!(!r(u)||!n(u)))for(var C=S.start,w=S.end;C<w;C++)d.element=g[C],a(u)&&f.add(o(u),p.id,d.element)}u.throwIfTimedOut()}}return u.popCurrentElement(),f.getSelection()}}function bP(e,t,r){for(var n=new Int32Array(t.length),a=0,i=t.length;a<i;a++)n[a]=e.elements[t[a]];return tt.create([e.getChild(it.ofSortedArray(n))],{parent:r})}function LMe(e,t){return function(n){var a=n.inputStructure.units,i=yt.LinearBuilder(n.inputStructure);if(!e||e.length===0)for(var o=0,s=a;o<s.length;o++){var u=s[o];if(We.isAtomic(u))if(t)for(var l=0,c=u.rings.aromaticRings;l<c.length;l++){var d=c[l];i.add(bP(u,u.rings.all[d],n.inputStructure))}else for(var f=0,h=u.rings.all;f<h.length;f++){var d=h[f];i.add(bP(u,d,n.inputStructure))}}else{for(var v=Jr.create(),p=0;p<e.length;p++)Jr.add(v,e[p],e[p]);for(var g=0,m=a;g<m.length;g++){var u=m[g];if(We.isAtomic(u))for(var y=u.rings,b=0,S=v.array;b<S.length;b++){var x=S[b];if(y.byFingerprint.has(x))for(var C=0,w=y.byFingerprint.get(x);C<w.length;C++){var d=w[C];t&&!y.aromaticRings.includes(d)||i.add(bP(u,y.all[d],n.inputStructure))}}}}return i.getSelection()}}function NMe(e,t,r){return r===void 0&&(r=!1),function(a){var i=e(a);if(yt.structureCount(i)===0)return i;var o=r?Gk(a.inputStructure,yt.unionStructure(i)):yt.unionStructure(i);if(o.elementCount===0)return yt.Empty(a.inputStructure);a.throwIfTimedOut(),a.pushInputStructure(o);var s=t(a);return a.popInputStructure(),yt.withInputStructure(s,a.inputStructure)}}function FMe(e){return function(r){var n=r.inputStructure,a=n.interUnitBonds,i=yt.UniqueBuilder(r.inputStructure);r.pushCurrentBond();var o=r.atomicBond;o.setTestFn(e),o.setStructure(n);for(var s=0,u=n.units;s<u.length;s++){var l=u[s];if(l.kind===0){var c=l.bonds,d=c.offset,f=c.b,h=c.edgeProps,v=h.flags,p=h.order;o.a.unit=l,o.b.unit=l;for(var g=0,m=l.elements.length;g<m;g++){o.aIndex=g,o.a.element=l.elements[g];for(var y=d[g],b=d[g+1];y<b;y++)if(o.bIndex=f[y],o.b.element=l.elements[f[y]],o.type=v[y],o.order=p[y],o.test(r,!1)){var S=n.subsetBuilder(!1);S.beginUnit(l.id),S.addElement(o.a.element),S.addElement(o.b.element),S.commitUnit(),i.add(S.getStructure())}}}}for(var x=0,C=a.edges;x<C.length;x++){var w=C[x];if(o.a.unit=n.unitMap.get(w.unitA),o.a.element=o.a.unit.elements[w.indexA],o.aIndex=w.indexA,o.b.unit=n.unitMap.get(w.unitA),o.b.element=o.b.unit.elements[w.indexB],o.bIndex=w.indexB,o.order=w.props.order,o.type=w.props.flag,o.test(r,!1)){var S=n.subsetBuilder(!1);S.addToUnit(o.a.unit.id,o.a.element),S.addToUnit(o.b.unit.id,o.b.element),i.add(S.getStructure())}}return r.popCurrentBond(),i.getSelection()}}const BMe=Object.freeze(Object.defineProperty({__proto__:null,all:yK,atoms:Wk,bondedAtomicPairs:FMe,chains:MMe,none:qk,querySelection:NMe,residues:IMe,rings:LMe},Symbol.toStringTag,{value:"Module"}));var P3=function(){function e(t){this.parent=t,this.ids=[],this.unitMap=Gs.Mutable(),this.parentId=-1,this.currentUnit=Jr.create(),this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);if(n)Jr.add(n,r,r)&&this.elementCount++;else{var a=Jr.create();Jr.add(a,r,r),this.unitMap.set(t,a),this.ids[this.ids.length]=t,this.elementCount++}},e.prototype.has=function(t,r){var n=this.unitMap.get(t);return n?Jr.has(n,r):!1},e.prototype.beginUnit=function(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?Jr.create():this.currentUnit},e.prototype.addElement=function(t){Jr.add(this.currentUnit,t,t)&&this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return tt.Empty;var t=[];Pu(this.ids);for(var r=xl.UnitEquivalenceBuilder(),n=0,a=this.ids.length;n<a;n++){var i=this.ids[n],o=this.parent.unitMap.get(i),s=this.unitMap.get(i).array,u=s.length;if(s.length===o.elements.length){t[t.length]=o,r.add(o.id,o);continue}u>1&&Pu(s);var l=o.getChild(it.ofSortedArray(s)),c=r.add(l.id,l);l!==c&&(l=c.applyOperator(l.id,l.conformation.operator,!0)),t[t.length]=l}return tt.create(t,{parent:this.parent})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function UMe(e){var t=e.unit,r=e.flags,n=e.proteinInfo,a=t.conformation.position,i=t.model.atomicHierarchy.derived.residue.traceElementIndex,o=n.residueIndices,s=n.nIndices,u=o.length,l=function(k,R){return k===-1?_.setNaN(R):a(k,R)},c=_(),d=_(),f=_(),h=_(),v=_(),p=_(),g=_();e:for(var m=2;m<u-2;m++){for(var y=0;y<4;y++){var b=m+y-2;if(l(i[b],h),l(s[b+1],v),_.squaredDistance(h,v)>6.25)continue e}var S=o[m-2],x=o[m],C=o[m+2],w=i[S],A=i[x],I=i[C];l(w,c),l(A,d),l(I,f),_.sub(p,c,d),_.sub(g,d,f);var D=Au(_.angle(p,g));D&&D>70&&(r[m]|=32)}}var jMe=9,$2=-27.888,zMe=-.5,P7=-9.9;function VMe(e,t,r,n){var a=_.distance(e,n),i=_.distance(t,n),o=_.distance(t,r),s=_.distance(e,r),u=$2/a-$2/i,l=$2/o-$2/s,c=u+l;return c<P7?P7:c}function HMe(e,t,r){for(var n=t.residueIndices,a=t.cIndices,i=t.hIndices,o=t.nIndices,s=t.oIndices,u=e.model.atomicHierarchy.index,l=e.conformation.invariantPosition,c=e.model.atomicHierarchy.derived.residue.traceElementIndex,d=n.length,f=[],h=[],v=[],p=_(),g=_(),m=_(),y=_(),b=_(),S=_(),x=_(),C=0,w=n.length;C<w;++C){var A=C,I=n[C],D=s[A],k=a[A],R=c[I];if(!(D===-1||k===-1)&&u.findAtomOnResidue(I,"OXT")===-1){l(D,p),l(k,g),l(R,m);for(var L=r.find(m[0],m[1],m[2],jMe),H=L.indices,B=L.count,j=0;j<B;++j){var Q=H[j];if(!(Q===A||Q-1===A||Q+1===A)){var G=o[Q];if(G!==-1){l(G,y);var W=i[Q];if(W===-1){if(Q===0)continue;var q=Q-1,J=s[q],he=a[q];if(J===-1||he===-1)continue;l(J,x),l(he,S),_.sub(b,S,x);var $=_.distance(x,S);_.scaleAndAdd(b,y,b,1/$)}else l(W,b);var X=VMe(p,g,y,b);X>zMe||(f[f.length]=A,h[h.length]=Q,v[v.length]=X)}}}}}return GMe(d,f,h,v)}function GMe(e,t,r,n){for(var a=new To.DirectedEdgeBuilder(e,t,r),i=new Float32Array(a.slotCount),o=0,s=a.edgeCount;o<s;o++)a.addNextEdge(),a.assignProperty(i,n[o]);return a.createGraph({energies:n})}var nr;(function(e){e.is=mi.has,e.create=mi.create})(nr||(nr={}));var X2=function(){function e(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}return e}();function qMe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=[1024,2048,4096,128,256,512],i=0;i<3;i++)for(var o=0,s=t.residueIndices.length-1;o<s;++o)if(r.getDirectedEdgeIndex(o,o+i+3)!==-1)if(n[o]|=a[i+3]|a[i],e.params.oldDefinition)for(var u=1;u<i+3;++u)n[o+u]|=a[i+3]|64;else for(var u=0;u<=i+3;++u)n[o+u]|=a[i+3]|64}function WMe(e){for(var t=e.proteinInfo,r=e.flags,n=t.residueIndices.length,a=[1024,2048,4096,128,256,512],i=[0,0,0,8,1,16],o=e.params.oldOrdering?[4,3,5]:[3,4,5],s=0;s<o.length;s++)for(var u=o[s],l=1,c=n-u;l<c;l++){var d=nr.create(r[l]),f=nr.create(r[l-1]),h=nr.create(r[l+1]);if(e.params.oldOrdering){if(u===3&&(nr.is(d,1)||nr.is(h,1))||u===5&&(nr.is(d,1)||nr.is(d,8)||nr.is(h,1)||nr.is(h,8)))continue}else if(u===4&&(nr.is(d,8)||nr.is(h,8))||u===5&&(nr.is(d,1)||nr.is(d,8)||nr.is(h,1)||nr.is(h,8)))continue;if(nr.is(d,a[u])&&nr.is(d,a[u-3])&&nr.is(f,a[u])&&nr.is(f,a[u-3]))if(e.params.oldDefinition)for(var v=0;v<u;v++)r[l+v]|=i[u];else for(var v=-1;v<=u;v++)r[l+v]|=i[u]}}function $Me(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function XMe(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?T7(e,t):T7(t,e):!1}function T7(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function YMe(e){for(var t=e.bridges,r=e.ladders,n=0;n<t.length;n++){for(var a=t[n],i=!1,o=0;o<r.length;o++){var s=r[o];$Me(s,a)&&(i=!0,s.firstEnd++,a.type===0?s.secondEnd++:s.secondStart--)}i||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:a.partner1,firstEnd:a.partner1,secondStart:a.partner2,secondEnd:a.partner2,type:a.type})}for(var u=0;u<r.length;u++)for(var l=r[u],c=u;c<r.length;c++){var d=r[c];XMe(l,d)&&(l.nextLadder=c,d.previousLadder=u)}}function KMe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=e.bridges,i=r.offset,o=r.b,s,u,l=0,c=t.residueIndices.length;l<c;++l)for(var d=i[l],f=i[l+1];d<f;d++){var h=o[d];l>h||(s=l+1,u=h,s!==u&&r.getDirectedEdgeIndex(u,s+1)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new X2(s,u,0)),s=l,u=h-1,s!==u&&r.getDirectedEdgeIndex(u-1,s)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new X2(u,s,0)),s=l,u=h,s!==u&&r.getDirectedEdgeIndex(u,s)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new X2(u,s,1)),s=l+1,u=h-1,s!==u&&r.getDirectedEdgeIndex(u-1,s+1)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new X2(u,s,1)))}a.sort(function(v,p){return v.partner1>p.partner1?1:v.partner1<p.partner1?-1:0})}function I7(e){return nr.is(e,8)||nr.is(e,1)||nr.is(e,16)}function QMe(e){for(var t=e.ladders,r=e.flags,n=0;n<t.length;n++){for(var a=t[n],i=a.firstStart;i<=a.firstEnd;i++){var o=a.firstStart-i,s=a.secondStart-o;a.firstStart!==a.firstEnd?(r[i]|=4,r[s]|=4):(!I7(r[i])&&nr.is(r[i],4)&&(r[i]|=2),!I7(r[s])&&nr.is(r[s],4)&&(r[s]|=2))}if(a.nextLadder!==0){for(var u=t[a.nextLadder],i=a.firstStart;i<=u.firstEnd;i++)r[i]|=4;if(a.type===0)for(var i=a.secondStart;i<=u.secondEnd;i++)r[i]|=4;else for(var i=u.secondEnd;i<=a.secondStart;i++)r[i]|=4}}}function ZMe(e,t){var r=t.cIndices,n=t.nIndices,a=t.residueIndices,i=e.conformation.position,o=e.model.atomicHierarchy.index,s=e.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.length,l=function(C,w){return C===-1?_.setNaN(w):i(C,w)},c=_(),d=_(),f=_(),h=_(),v=_(),p=_(),g=_(),m=_(),y=_();if(u===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};var b=new Float32Array(u-1),S=new Float32Array(u-1);l(-1,c),l(-1,d),l(-1,f),l(r[0],h),l(s[a[0]],v),l(n[0],p),l(r[1],g),l(s[a[1]],m),l(n[1],y);for(var x=0;x<u-1;++x)o.findAtomOnResidue(a[x],"OXT")===-1&&(b[x]=Au(_.dihedralAngle(c,p,v,h)),S[x]=Au(_.dihedralAngle(p,v,h,y)),c=h,d=v,f=p,h=g,v=m,p=y,l(r[x+1],g),l(s[a[x+1]],m),l(n[x+1],y));return{phi:b,psi:S}}function JMe(e,t){for(var r=e.model.atomicConformation,n=r.x,a=r.y,i=r.z,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=new Uint32Array(t.length),u=0,l=t.length;u<l;++u)s[u]=o[t[u]];var c={x:n,y:a,z:i,indices:it.ofSortedArray(s)};return Gp(c,Pg(c))}function eDe(e){for(var t=e.model.atomicHierarchy.index,r=e.proteinElements,n=e.residueIndex,a=r.length,i=new Uint32Array(a),o=new Int32Array(a),s=new Int32Array(a),u=new Int32Array(a),l=new Int32Array(a),c=0;c<a;++c){var d=n[r[c]];i[c]=d,o[c]=t.findAtomOnResidue(d,"C"),s[c]=t.findAtomOnResidue(d,"H"),u[c]=t.findAtomOnResidue(d,"O"),l[c]=t.findAtomOnResidue(d,"N")}return{residueIndices:it.ofSortedArray(i),cIndices:o,hIndices:s,oIndices:u,nIndices:l}}var tDe={oldDefinition:T.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:T.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function rDe(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C;return fe(this,function(w){for(r=eDe(e),n=r.residueIndices,a=JMe(e,n),i=HMe(e,r,a),o=n.length,s=new Uint32Array(o),u=ZMe(e,r),l=[],c=[],d=t.oldDefinition?iDe:sDe,f=t.oldOrdering?oDe:uDe,h={params:t,getResidueFlag:d,getFlagName:f,unit:e,proteinInfo:r,flags:s,hbonds:i,torsionAngles:u,ladders:l,bridges:c},qMe(h),WMe(h),UMe(h),KMe(h),YMe(h),QMe(h),v=lDe(s,d),p=new Uint32Array(o),g=[],m=[],y=function(A){return it.indexOf(n,A)},b=0,S=n.length;b<S;++b)x=v[b],p[b]=x,C=d(s[b]),(m.length===0||C!==m[m.length-1].flags)&&(m[m.length]=nDe(aDe(x),s[b],d)),g[b]=m.length-1;return[2,eK(p,g,m,y)]})})}function nDe(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function aDe(e){return e===Lr.SecondaryStructureDssp.H||e===Lr.SecondaryStructureDssp.G||e===Lr.SecondaryStructureDssp.I?"helix":e===Lr.SecondaryStructureDssp.B||e===Lr.SecondaryStructureDssp.E?"sheet":e===Lr.SecondaryStructureDssp.T?"turn":e===Lr.SecondaryStructureDssp.S?"bend":"none"}function iDe(e){return nr.is(e,1)?Lr.SecondaryStructureDssp.H:nr.is(e,4)?Lr.SecondaryStructureDssp.E:nr.is(e,2)?Lr.SecondaryStructureDssp.B:nr.is(e,8)?Lr.SecondaryStructureDssp.G:nr.is(e,16)?Lr.SecondaryStructureDssp.I:nr.is(e,64)?Lr.SecondaryStructureDssp.T:nr.is(e,32)?Lr.SecondaryStructureDssp.S:0}function oDe(e){return nr.is(e,1)?"H":nr.is(e,4)?"E":nr.is(e,2)?"B":nr.is(e,8)?"G":nr.is(e,16)?"I":nr.is(e,64)?"T":nr.is(e,32)?"S":"-"}function sDe(e){return nr.is(e,16)?Lr.SecondaryStructureDssp.I:nr.is(e,1)?Lr.SecondaryStructureDssp.H:nr.is(e,4)?Lr.SecondaryStructureDssp.E:nr.is(e,2)?Lr.SecondaryStructureDssp.B:nr.is(e,8)?Lr.SecondaryStructureDssp.G:nr.is(e,64)?Lr.SecondaryStructureDssp.T:nr.is(e,32)?Lr.SecondaryStructureDssp.S:0}function uDe(e){return nr.is(e,16)?"I":nr.is(e,1)?"H":nr.is(e,4)?"E":nr.is(e,2)?"B":nr.is(e,8)?"G":nr.is(e,64)?"T":nr.is(e,32)?"S":"-"}function lDe(e,t){for(var r=new Uint32Array(e.length),n=0,a=e.length;n<a;++n){var i=nr.create(e[n]);r[n]=t(i)}return r}var th;(function(e){function t(n){var a=this,i=n.descriptor.name,o=n.type==="root"?"inheritedPropertyData":"currentPropertyData",s=function(l){return i in l[o]||(l[o][i]={props:E({},T.getDefaultValues(n.getParams(l))),data:Yf.create(void 0)}),l[o][i]},u=function(l,c,d){var f=s(l);l[o][i]={props:c,data:Yf.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=T.clone(n.getParams(l));return T.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),de(a,void 0,void 0,function(){var h,v,p,g,m,y;return fe(this,function(b){switch(b.label){case 0:return f&&c.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(c=c.root),h=s(c.root).props,v=s(c),p=T.merge(n.defaultParams,h,d),v.data.value&&T.areEqual(n.defaultParams,v.props,p)?[2]:[4,n.obtain(l,c,p)];case 1:return g=b.sent(),m=g.value,y=g.assets,c.customPropertyDescriptors.add(n.descriptor),c.customPropertyDescriptors.assets(n.descriptor,y),u(c,p,m),[2]}})})},ref:function(l,c){return l.customPropertyDescriptors.reference(n.descriptor,c)},get:function(l){return s(l).data},set:function(l,c,d){c===void 0&&(c={}),n.type==="root"&&(l=l.root);var f=s(l),h=T.merge(n.defaultParams,f.props,c);T.areEqual(n.defaultParams,f.props,h)||(u(l,h,d),l.customPropertyDescriptors.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,a,i){var o=this,s={value:T.Value(i,{isHidden:!0})};return t({label:Yo(n),descriptor:Po({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:T.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return de(o,void 0,void 0,function(){return fe(this,function(d){return[2,E(E({},T.getDefaultValues(s)),c)]})})}})}e.createSimple=r})(th||(th={}));function bK(e){var t="model";if(e){t="dssp";for(var r=0,n=e.models.length;r<n;++r){var a=e.models[r];if(Xt.isFromPdbArchive(a)||Xt.hasSecondaryStructure(a)){t="model";break}}}return{type:T.MappedStatic(t,{model:T.EmptyGroup({label:"Model"}),dssp:T.Group(tDe,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}var M7=bK(),Ol=th.createProvider({label:"Secondary Structure",descriptor:Po({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:M7,getParams:bK,isApplicable:function(e){return!0},obtain:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a,i,o;return fe(this,function(s){switch(s.label){case 0:switch(n=E(E({},T.getDefaultValues(M7)),r),a=n.type.name,a){case"dssp":return[3,1];case"model":return[3,3]}return[3,5];case 1:return i={},[4,cDe(t,n.type.params)];case 2:return[2,(i.value=s.sent(),i)];case 3:return o={},[4,dDe(t)];case 4:return[2,(o.value=s.sent(),o)];case 5:return[2]}})})}});function cDe(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o;return fe(this,function(s){switch(s.label){case 0:r=new Map,n=0,a=e.unitSymmetryGroups.length,s.label=1;case 1:return n<a?(i=e.unitSymmetryGroups[n].units[0],We.isAtomic(i)&&!Xt.isCoarseGrained(i.model)?[4,rDe(i,t)]:[3,3]):[3,4];case 2:o=s.sent(),r.set(i.invariantId,o),s.label=3;case 3:return++n,[3,1];case 4:return[2,r]}})})}function dDe(e){return de(this,void 0,void 0,function(){var t,r,n,a,i;return fe(this,function(o){for(t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r)a=e.unitSymmetryGroups[r].units[0],We.isAtomic(a)&&(i=Z1.Provider.get(a.model),i&&t.set(a.invariantId,i));return[2,t]})})}var fDe={true:function(e){return!0},false:function(e){return!1},zero:function(e){return 0}};function Nn(){throw"Property only available for atomic models."}function kd(e){throw e?"Property only available for coarse models ("+e+").":"Property only available for coarse models."}var _y={key:function(e){return e.element},x:function(e){return e.unit.conformation.x(e.element)},y:function(e){return e.unit.conformation.y(e.element)},z:function(e){return e.unit.conformation.z(e.element)},id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):Nn()},occupancy:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):Nn()},B_iso_or_equiv:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):Nn()},sourceIndex:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element},type_symbol:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):Nn()},label_atom_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):Nn()},auth_atom_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):Nn()},label_alt_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):Nn()},label_comp_id:r_,auth_comp_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):Nn()},pdbx_formal_charge:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):Nn()},vdw_radius:function(e){return We.isAtomic(e.unit)?Mb(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):Nn()}};function r_(e){return We.isAtomic(e.unit)||Nn(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function $k(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):Nn()}function hDe(e){We.isAtomic(e.unit)||Nn();var t=e.unit.model.sequence.byEntityKey[$i(e)];return t&&t.sequence.microHet.has($k(e))}function D7(e){We.isAtomic(e.unit)||Nn();var t=e.unit.model.sequence.byEntityKey[$i(e)];return t?t.sequence.microHet.get($k(e))||[r_(e)]:[r_(e)]}var pDe={key:function(e){return We.isAtomic(e.unit)?e.unit.residueIndex[e.element]:Nn()},group_PDB:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):Nn()},label_seq_id:$k,auth_seq_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):Nn()},pdbx_PDB_ins_code:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):Nn()},isNonStandard:function(e){return We.isAtomic(e.unit)?D7(e).some(function(t){return e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"}):Nn()},hasMicroheterogeneity:hDe,microheterogeneityCompIds:D7,secondary_structure_type:function(e){var t,r;We.isAtomic(e.unit)||Nn();var n=(t=Ol.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n==null?void 0:n.type[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:536870912},secondary_structure_key:function(e){var t,r;We.isAtomic(e.unit)||Nn();var n=(t=Ol.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n==null?void 0:n.key[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:-1},chem_comp_type:function(e){return We.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(r_(e)).type:Nn()}},vDe={key:function(e){return We.isAtomic(e.unit)?e.unit.chainIndex[e.element]:Nn()},label_asym_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):Nn()},auth_asym_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):Nn()},label_entity_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):Nn()}},mDe={key:_y.key,entityKey:function(e){return We.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:kd()},x:_y.x,y:_y.y,z:_y.z,asym_id:function(e){return We.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):kd()},seq_id_begin:function(e){return We.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):kd()},seq_id_end:function(e){return We.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):kd()},sphere_radius:function(e){return We.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:kd("spheres")},sphere_rmsf:function(e){return We.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:kd("spheres")},gaussian_weight:function(e){return We.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:kd("gaussians")},gaussian_covariance_matrix:function(e){return We.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:kd("gaussians")}};function $i(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var gDe={key:$i,id:function(e){return e.unit.model.entities.data.id.value($i(e))},type:function(e){return e.unit.model.entities.data.type.value($i(e))},src_method:function(e){return e.unit.model.entities.data.src_method.value($i(e))},pdbx_description:function(e){return e.unit.model.entities.data.pdbx_description.value($i(e))},formula_weight:function(e){return e.unit.model.entities.data.formula_weight.value($i(e))},pdbx_number_of_molecules:function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value($i(e))},details:function(e){return e.unit.model.entities.data.details.value($i(e))},pdbx_mutation:function(e){return e.unit.model.entities.data.pdbx_mutation.value($i(e))},pdbx_fragment:function(e){return e.unit.model.entities.data.pdbx_fragment.value($i(e))},pdbx_ec:function(e){return e.unit.model.entities.data.pdbx_ec.value($i(e))},subtype:function(e){return e.unit.model.entities.subtype.value($i(e))},prd_id:function(e){return e.unit.model.entities.prd_id.value($i(e))}},yDe=[],bDe={id:function(e){return e.unit.id},chainGroupId:function(e){return e.unit.chainGroupId},multiChain:function(e){return We.Traits.is(e.unit.traits,1)},object_primitive:function(e){return e.unit.objectPrimitive},operator_name:function(e){return e.unit.conformation.operator.name},model_index:function(e){return e.unit.model.modelNum},model_label:function(e){return e.unit.model.label},model_entry_id:function(e){return e.unit.model.entryId},hkl:function(e){return e.unit.conformation.operator.hkl},spgrOp:function(e){return e.unit.conformation.operator.spgrOp},model_num:function(e){return e.unit.model.modelNum},pdbx_struct_assembly_id:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.id)||gn.DefaultName},pdbx_struct_oper_list_ids:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.operList)||yDe},struct_ncs_oper_id:function(e){return e.unit.conformation.operator.ncsId}},pt={constant:fDe,atom:_y,residue:pDe,chain:vDe,entity:gDe,unit:bDe,coarse:mDe},Zy=function(){function e(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=(r=t==null?void 0:t.checkOperator)!==null&&r!==void 0?r:!1}return e.prototype.add=function(t){var r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));var n=r.get(t.label_seq_id);n||(n=[],r.set(t.label_seq_id,n));var a=this._find(t,n);return a?!1:(n.push(t),!0)},e.prototype.hasLabelAsymId=function(t){return this.index.has(t)},e.prototype.has=function(t){var r,n,a=R7(t);if(this.index.has(a)){var i=this.index.get(a),o=k7(t);if(i.has(o))for(var s=i.get(o),u=O7(t),l=L7(t),c=N7(t),d=(r=F7(t))!==null&&r!==void 0?r:"1_555",f=0,h=s;f<h.length;f++){var v=h[f];if(!(v.label_comp_id!==u||v.label_alt_id!==l||v.ins_code!==c)&&!(this.checkOperator&&((n=v.operator_name)!==null&&n!==void 0?n:"1_555")!==d))return v}}},e.getLabel=function(t,r){var n;return r===void 0&&(r=!1),t.label_asym_id+" "+t.label_comp_id+" "+t.label_seq_id+":"+t.ins_code+":"+t.label_alt_id+(r?" "+((n=t.operator_name)!==null&&n!==void 0?n:"1_555"):"")},e.getEntryFromLocation=function(t){var r;return{label_asym_id:R7(t),label_comp_id:O7(t),label_seq_id:k7(t),label_alt_id:L7(t),ins_code:N7(t),operator_name:(r=F7(t))!==null&&r!==void 0?r:"1_555"}},e.prototype._find=function(t,r){for(var n,a,i=0,o=r;i<o.length;i++){var s=o[i];if(!(s.label_comp_id!==t.label_comp_id||s.label_alt_id!==t.label_alt_id||s.ins_code!==t.ins_code)&&!(this.checkOperator&&((n=s.operator_name)!==null&&n!==void 0?n:"1_555")!==((a=t.operator_name)!==null&&a!==void 0?a:"1_555")))return!0}return!1},e}(),R7=pt.chain.label_asym_id,k7=pt.residue.label_seq_id,O7=pt.atom.label_comp_id,L7=pt.atom.label_alt_id,N7=pt.residue.pdbx_PDB_ins_code,F7=pt.unit.operator_name;function Tg(e,t,r){for(var n=t.subsetBuilder(!0),a=0,i=r.units;a<i.length;a++){var o=i[a];if(o.kind!==0){n.setUnit(o.id,o.elements);continue}var s=o.model.atomicHierarchy.residueAtomSegments,u=t.unitMap.get(o.id).elements,l=o.elements;n.beginUnit(o.id);for(var c=ar.transientSegments(s,l);c.hasNext;)for(var d=c.move().index,f=s.offsets[d],h=s.offsets[d+1];f<h;f++)it.has(u,f)&&n.addElement(f);n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function xDe(e){return function(r){var n=e(r);if(yt.isSingleton(n))return yt.Singletons(r.inputStructure,Tg(r,r.inputStructure,n.structure));for(var a=new NM(r.inputStructure),i=0,o=n.structures;i<o.length;i++){var s=o[i];a.add(Tg(r,r.inputStructure,s))}return a.getSelection()}}function FM(e,t,r,n){for(var a=new P3(t),i=t.lookup3d,o=n.radius,s=0,u=r.units;s<u.length;s++){for(var l=u[s],c=l.conformation,d=c.x,f=c.y,h=c.z,v=l.elements,p=0,g=v.length;p<g;p++){var m=v[p];i.findIntoBuilder(d(m),f(m),h(m),o,a)}e.throwIfTimedOut()}return n.wholeResidues?Tg(e,t,a.getStructure()):a.getStructure()}function B7(e,t,r,n){var a=new P3(t),i=t.lookup3d,o=n.elementRadius,s=n.elementRadiusClosure,u=n.sourceMaxRadius,l=n.radius;e.pushCurrentElement(),e.element.structure=r;for(var c=0,d=r.units;c<d.length;c++){var f=d[c];e.element.unit=f;for(var h=f.conformation,v=h.x,p=h.y,g=h.z,m=f.elements,y=0,b=m.length;y<b;y++){var S=m[y];e.element.element=S;var x=o(e);i.findIntoBuilderWithRadius(v(S),p(S),g(S),x,u,l,s,a)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?Tg(e,t,a.getStructure()):a.getStructure()}function SDe(e,t){return function(r){return e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e)}}function CDe(e,t){var r=0;e.element.structure=e.inputStructure;for(var n=0,a=e.inputStructure.units;n<a.length;n++){var i=a[n];e.element.unit=i;for(var o=i.elements,s=0,u=o.length;s<u;s++){var l=o[s];e.element.element=l;var c=t(e);c>r&&(r=c)}}return e.throwIfTimedOut(),r}function _De(e,t){return function(n){var a=e(n);if(t.elementRadius){var i=E(E({},t),{elementRadius:t.elementRadius,elementRadiusClosure:SDe(n,t.elementRadius),sourceMaxRadius:CDe(n,t.elementRadius)});if(yt.isSingleton(a)){var o=B7(n,n.inputStructure,a.structure,i),s=yt.Singletons(n.inputStructure,o);return s}else{for(var u=new NM(n.inputStructure),l=0,c=a.structures;l<c.length;l++){var d=c[l];u.add(B7(n,n.inputStructure,d,i))}return u.getSelection()}}if(yt.isSingleton(a)){var o=FM(n,n.inputStructure,a.structure,t),s=yt.Singletons(n.inputStructure,o);return s}else{for(var u=new NM(n.inputStructure),f=0,h=a.structures;f<h.length;f++){var d=h[f];u.add(FM(n,n.inputStructure,d,t))}return u.getSelection()}}}function wDe(e,t){return function(n){var a=e(n);if(yt.structureCount(a)===0)return a;var i=yt.UniqueBuilder(n.inputStructure),o=function(s){return i.add(s)};return yt.forEach(a,function(s,u){n.pushInputStructure(s),yt.forEach(t(n),o),n.popInputStructure(),u%10===0&&n.throwIfTimedOut()}),i.getSelection()}}function EDe(e,t){return function(n){var a=e(n);if(yt.structureCount(a)===0)return a;var i=t(n);if(yt.structureCount(i)===0)return yt.Empty(n.inputStructure);var o=yt.unionStructure(i),s=yt.UniqueBuilder(n.inputStructure);return yt.forEach(a,function(u,l){var c=vK(o,u);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function ADe(e,t){return function(n){var a=e(n);if(yt.structureCount(a)===0)return a;var i=t(n);if(yt.structureCount(i)===0)return a;var o=yt.unionStructure(i),s=yt.UniqueBuilder(n.inputStructure);return yt.forEach(a,function(u,l){var c=Gk(u,o);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function PDe(e){return function(r){var n=yt.LinearBuilder(r.inputStructure);return n.add(yt.unionStructure(e(r))),n.getSelection()}}function TDe(e,t){return function(n){var a=e(n),i=new Map,o=[];n.pushCurrentElement(),yt.forEach(a,function(x,C){n.element.structure=x;for(var w=0,A=x.units;w<A.length;w++){var I=A[w];n.element.unit=I;for(var D=I.elements,k=0,R=D.length;k<R;k++){n.element.element=D[k];var L=t(n),H=void 0;i.has(L)?H=i.get(L):(H=Jr.create(),i.set(L,H)),Jr.add(H,C,C)}}o[C]=n.inputStructure.subsetBuilder(!0),C%10===0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(var s=0,u=n.inputStructure.units;s<u.length;s++){var l=u[s];n.element.unit=l;for(var c=l.elements,d=0,f=c.length;d<f;d++){n.element.element=c[d];var h=t(n);if(i.has(h))for(var v=i.get(h).array,p=0,g=v.length;p<g;p++)o[v[p]].addToUnit(l.id,c[d])}}n.popCurrentElement();for(var m=yt.UniqueBuilder(n.inputStructure),y=0,b=o;y<b.length;y++){var S=b[y];m.add(S.getStructure())}return m.getSelection()}}function IDe(e){var t=e.query,r=e.layerCount,n=e.wholeResidues,a=e.bondTest,i=e.fixedPoint,o=Math.max(r,0);return function(u){var l=yt.UniqueBuilder(u.inputStructure),c=t(u);return u.pushCurrentBond(),u.atomicBond.setTestFn(a),yt.forEach(c,function(d,f){var h=d;if(i)for(;;){var v=h.elementCount;if(h=U7(u,n,h),h.elementCount===v)break}else for(var p=0;p<o;p++)h=U7(u,n,h);l.add(h),f%10===0&&u.throwIfTimedOut()}),u.popCurrentBond(),l.getSelection()}}function U7(e,t,r){var n=MDe(e,r);return t?Tg(e,e.inputStructure,n):n}function MDe(e,t){for(var r=e.inputStructure,n=r.interUnitBonds,a=new P3(r),i=e.atomicBond,o=0,s=t.units;o<s.length;o++){var u=s[o];if(u.kind!==0){a.beginUnit(u.id);for(var l=0,c=u.elements.length;l<c;l++)a.addElement(u.elements[l]);a.commitUnit();continue}var d=r.unitMap.get(u.id),f=d.bonds,h=f.offset,v=f.b,p=f.edgeProps,g=p.flags,m=p.order;i.setStructure(r),i.a.unit=d,i.b.unit=d;for(var l=0,c=u.elements.length;l<c;l++){a.addToUnit(u.id,u.elements[l]);for(var y=it.indexOf(d.elements,u.elements[l]),b=h[y],S=h[y+1];b<S;b++){var x=v[b],C=d.elements[x];it.has(u.elements,C)||a.has(u.id,C)||(i.aIndex=y,i.a.element=u.elements[l],i.bIndex=x,i.b.element=C,i.type=g[b],i.order=m[b],i.test(e,!0)&&a.addToUnit(u.id,C))}}for(var w=0,A=n.getConnectedUnits(d.id);w<A.length;w++)for(var I=A[w],D=t.unitMap.get(I.unitB),k=r.unitMap.get(I.unitB),R=0,L=I.connectedIndices;R<L.length;R++){var H=L[R];if(it.has(u.elements,d.elements[H]))for(var B=0,j=I.getEdges(H);B<j.length;B++){var Q=j[B],C=k.elements[Q.indexB];D&&it.has(D.elements,C)||a.has(I.unitB,C)||(i.a.unit=d,i.aIndex=H,i.a.element=d.elements[H],i.b.unit=k,i.bIndex=Q.indexB,i.b.element=C,i.type=Q.props.flag,i.order=Q.props.order,i.test(e,!0)&&a.addToUnit(I.unitB,C))}}}return a.getStructure()}function DDe(e){var t=e.query,r=e.radius,n=e.includeWater;return function(i){for(var o=yt.unionStructure(t(i)),s=Tg(i,i.inputStructure,FM(i,i.inputStructure,o,{radius:r})),u=ODe(i.inputStructure),l=LDe(i.inputStructure),c=at.create(s),d=new Map,f=new Zy({checkOperator:!0}),h=0,v=s.units;h<v.length;h++){var p=v[h];if(p.kind===0){c.unit=p;for(var g=p.elements,m=ar.transientSegments(p.model.atomicHierarchy.chainAtomSegments,g),y=ar.transientSegments(p.model.atomicHierarchy.residueAtomSegments,g);m.hasNext;){var b=m.move();c.element=g[b.start];var S=pt.chain.label_asym_id(c),x=pt.unit.operator_name(c);if(u.has(S)){d.has(S)?Di(d.get(S),x):d.set(S,[x]);continue}var C=pt.entity.type(c);if(!(C==="water"||C==="polymer"))for(y.setSegment(b);y.hasNext;){var w=y.move();c.element=g[w.start],l.addComponent(Zy.getEntryFromLocation(c),f)}}i.throwIfTimedOut()}}for(var A=i.inputStructure.subsetBuilder(!0),I=0,D=i.inputStructure.units;I<D.length;I++){var p=D[I];if(p.kind===0){c.unit=p;var g=p.elements,m=ar.transientSegments(p.model.atomicHierarchy.chainAtomSegments,g),y=ar.transientSegments(p.model.atomicHierarchy.residueAtomSegments,g);for(A.beginUnit(p.id);m.hasNext;){var b=m.move();c.element=g[b.start];var S=pt.chain.label_asym_id(c),x=pt.unit.operator_name(c);if(d.has(S)&&d.get(S).indexOf(x)>=0){A.addElementRange(g,b.start,b.end);continue}if(f.hasLabelAsymId(S))for(y.setSegment(b);y.hasNext;){var w=y.move();c.element=g[w.start],f.has(c)&&A.addElementRange(g,w.start,w.end)}}A.commitUnit(),i.throwIfTimedOut()}}var k=rb(i.inputStructure,[A.getStructure(),o]);if(n){for(var R=new P3(i.inputStructure),L=i.inputStructure.lookup3d,H=0,B=k.units;H<B.length;H++){for(var p=B[H],j=p.conformation,Q=j.x,G=j.y,W=j.z,g=p.elements,q=0,J=g.length;q<J;q++){var he=g[q];L.findIntoBuilderIf(Q(he),G(he),W(he),r,R,kDe),R.addToUnit(p.id,he)}i.throwIfTimedOut()}return yt.Sequence(i.inputStructure,[R.getStructure()])}else return yt.Sequence(i.inputStructure,[k])}}var RDe=pt.entity.type;function kDe(e){return RDe(e)==="water"}function ODe(e){var t=e.models[0],r=new Set;if(!nn.is(t.sourceData))return r;for(var n=t.sourceData.data.db.pdbx_molecule,a=n._rowCount,i=n.asym_id,o=0;o<a;o++)r.add(i.value(o));return r}function LDe(e){var t,r,n=e.models[0],a=new NDe;if(!nn.is(n.sourceData))return a;for(var i=n.sourceData.data.db.struct_conn,o=i.conn_type_id,s=i.ptnr1_label_asym_id,u=i.ptnr1_label_comp_id,l=i.ptnr1_label_seq_id,c=i.ptnr1_symmetry,d=i.pdbx_ptnr1_label_alt_id,f=i.pdbx_ptnr1_PDB_ins_code,h=i.ptnr2_label_asym_id,v=i.ptnr2_label_comp_id,p=i.ptnr2_label_seq_id,g=i.ptnr2_symmetry,m=i.pdbx_ptnr2_label_alt_id,y=i.pdbx_ptnr2_PDB_ins_code,b=0;b<i._rowCount;b++){var S=o.value(b);if(!(S!=="covale"&&S!=="metalc")){var x={label_asym_id:s.value(b),label_comp_id:u.value(b),label_seq_id:l.value(b),label_alt_id:d.value(b),ins_code:f.value(b),operator_name:(t=c.value(b))!==null&&t!==void 0?t:"1_555"},C={label_asym_id:h.value(b),label_comp_id:v.value(b),label_seq_id:p.value(b),label_alt_id:m.value(b),ins_code:y.value(b),operator_name:(r=g.value(b))!==null&&r!==void 0?r:"1_555"};a.addEdge(x,C)}}return a}var NDe=function(){function e(){this.vertices=new Map,this.edges=new Map}return e.prototype.addVertex=function(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))},e.prototype.addEdge=function(t,r){var n=Zy.getLabel(t),a=Zy.getLabel(r);this.addVertex(t,n),this.addVertex(r,a),Di(this.edges.get(n),a),Di(this.edges.get(a),n)},e.prototype.addComponent=function(t,r){var n=Zy.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}var a=new Set,i=new Set,o=[n];for(i.add(n),r.add(t);o.length>0;){var s=o.pop();a.add(s);for(var u=this.vertices.get(s),l=0,c=this.edges.get(s);l<c.length;l++){var d=c[l];if(!a.has(d)&&(o.push(d),!i.has(d))){i.add(d);var f=this.vertices.get(d);u.operator_name===f.operator_name?r.add(E(E({},f),{operator_name:t.operator_name})):r.add(f)}}}},e}();const FDe=Object.freeze(Object.defineProperty({__proto__:null,exceptBy:ADe,expandProperty:TDe,includeConnected:IDe,includeSurroundings:_De,intersectBy:EDe,querySelection:wDe,surroundingLigands:DDe,union:PDe,wholeResidues:xDe},Symbol.toStringTag,{value:"Module"}));function BDe(e,t,r,n,a,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?n_.check(e,t,r,n,a,i):n_.check(e,r,t,n,a,i)}function UDe(e,t,r,n,a){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?a_.check(e,t,r,n,a):a_.check(e,r,t,n,a)}var n_;(function(e){var t=_.zero();function r(o,s,u,l,c,d,f){var h=s.elements,v=s.conformation.position,p=t;o.element.unit=s;for(var g=!1,m=0,y=h.length;m<y;m++){var b=h[m];o.element.element=b;var S=Math.max(0,_.distance(u,v(b,p))-l-f(o));if(S<c)return 0;S<d&&(g=!0)}return g?1:2}function n(o,s,u,l,c,d,f){for(var h=s.units,v=!1,p=0,g=h.length;p<g;p++){var m=r(o,h[p],u,l,c,d,f);if(m===0)return 0;m===1&&(v=!0)}return v?1:2}e.toPoint=n;var a=_.zero();function i(o,s,u,l,c,d){if(s.elementCount===0||u.elementCount===0)return 0;var f=s.units,h=!1;o.element.structure=s;for(var v=0,p=f.length;v<p;v++){var g=f[v],m=g.elements,y=g.conformation.position;o.element.unit=g;for(var b=0,S=m.length;b<S;b++){var x=m[b];o.element.element=x;var C=n(o,u,y(x,a),d(o),l,c,d);if(C===0)return 0;C===1&&(h=!0)}}return h}e.check=i})(n_||(n_={}));var a_;(function(e){var t=_.zero();function r(o,s,u,l,c,d){var f=s.elements,h=s.conformation.position,v=t;o.element.unit=s;for(var p=0,g=f.length;p<g;p++){var m=f[p];if(o.element.element=m,Math.max(0,_.distance(u,h(m,v))-l-d(o))<=c)return!0}return!1}function n(o,s,u,l,c,d){for(var f=s.units,h=0,v=f.length;h<v;h++)if(r(o,f[h],u,l,c,d))return!0;return!1}e.toPoint=n;var a=_.zero();function i(o,s,u,l,c){if(s.elementCount===0||u.elementCount===0)return 0;var d=s.units;o.element.structure=s;for(var f=0,h=d.length;f<h;f++){var v=d[f];o.element.unit=v;for(var p=v.elements,g=v.conformation.position,m=0,y=p.length;m<y;m++){var b=p[m];if(o.element.element=b,n(o,u,g(b,a),c(o),l,c))return!0}}return!1}e.check=i})(a_||(a_={}));function jDe(e,t){return function(r){var n=e(r),a=yt.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),yt.forEach(n,function(i,o){r.currentStructure=i,t(r)&&a.add(i),o%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),a.getSelection()}}function zDe(e){return function(t){var r=e(t),n=yt.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){var a=r.structure.units[0],i=tt.create([a.getChild(it.ofSingleton(a.elements[0]))],{parent:t.inputStructure});n.add(i)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function Xk(e,t,r){var n=e.currentStructure.units,a=e.pushCurrentElement();a.structure=e.currentStructure;for(var i=0,o=n;i<o.length;i++){var s=o[i];a.unit=s;var u=s.elements,l=void 0;if(We.isAtomic(s)?l=t.atomic:l=t.coarse,!!l){for(var c=0,d=u.length;c<d;c++)a.element=u[c],r.add(l(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function VDe(e,t,r){var n=new Set,a=t(e);return e.pushCurrentElement(),yt.forEach(a,function(i,o){e.currentStructure=i,Xk(e,r,n),o%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function HDe(e,t,r){return function(n){var a=e(n),i=VDe(n,t,r),o=yt.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),yt.forEach(a,function(s,u){n.currentStructure=s;var l=Xk(n,r,new Set);fa.isSuperset(l,i)&&o.add(s),u%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),o.getSelection()}}function GDe(e,t){return function(r){var n=yt.unionStructure(t(r)),a=yt.LinearBuilder(r.inputStructure);return yt.forEach(e(r),function(i,o){A3(n,i)&&a.add(i),o%10&&r.throwIfTimedOut()}),a.getSelection()}}function qDe(e){return function(t){var r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius>"u"?WDe(r):r.minRadius===0?$De(r):XDe(r)}}function WDe(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.maxRadius,i=e.invert,o=yt.unionStructure(n).lookup3d,s=yt.LinearBuilder(t.inputStructure),u=_.zero();return yt.forEach(r,function(l,c){for(var d=l.units,f=!1,h=0,v=d.length;h<v;h++){for(var p=d[h],g=p.elements,m=p.conformation,y=m.position,b=m.r,S=0,x=g.length;S<x;S++){var C=g[S];if(y(C,u),o.check(u[0],u[1],u[2],a+b(C))){f=!0;break}}if(f)break}i&&(f=!f),f&&s.add(l),c%10===0&&t.throwIfTimedOut()}),s.getSelection()}function $De(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.maxRadius,i=e.invert,o=e.elementRadius,s=yt.unionStructure(n),u=yt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),yt.forEach(r,function(l,c){var d=UDe(t,s,l,a,o);i&&(d=!d),d&&u.add(l),c%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),u.getSelection()}function XDe(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.minRadius,i=e.maxRadius,o=e.invert,s=e.elementRadius,u=yt.unionStructure(n),l=yt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),yt.forEach(r,function(c,d){var f=BDe(t,u,c,a,i,s);o&&(f=!f),f&&l.add(c),d%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),l.getSelection()}function YDe(e,t){var r=e.queryCtx,n=e.input,a=e.target,i=e.disjunct,o=r.atomicBond,s=n.interUnitBonds;o.setStructure(n);for(var u=0,l=t.units;u<l.length;u++){var c=l[u];if(We.isAtomic(c))for(var d=n.unitMap.get(c.id),f=d.bonds,h=f.offset,v=f.b,p=f.edgeProps,g=p.flags,m=p.order,y=s.getConnectedUnits(c.id),b=y.length,S=c.elements,x=d.elements,C=0,w=S.length;C<w;C++){var A=it.indexOf(x,S[C]);o.a.unit=d,o.b.unit=d;for(var I=h[A],D=h[A+1];I<D;I++)if(o.b.element=d.elements[v[I]],!(i&&it.has(c.elements,o.b.element))&&a.hasElement(o.b)&&(o.aIndex=A,o.a.element=S[C],o.bIndex=v[I],o.type=g[I],o.order=m[I],o.test(r,!0)))return!0;for(var k=0;k<b;k++)for(var R=y[k],L=n.unitMap.get(R.unitB),H=L.elements,B=R.getEdges(A),j=0,Q=B.length;j<Q;j++){var G=B[j];if(o.b.unit=L,o.b.element=H[G.indexB],!!a.hasElement(o.b)&&!(i&&t.hasElement(o.b))&&(o.a.unit=d,o.aIndex=A,o.a.element=S[C],o.bIndex=G.indexB,o.type=G.props.flag,o.order=G.props.order,o.test(r,!0)))return!0}}}return!1}function KDe(e){var t=e.query,r=e.target,n=e.disjunct,a=e.invert,i=e.bondTest;return function(o){var s=r(o);if(yt.isEmpty(s))return s;var u=t(o);if(yt.isEmpty(u))return u;var l={queryCtx:o,input:o.inputStructure,disjunct:n,target:yt.unionStructure(s)},c=yt.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(i),yt.forEach(u,function(d,f){(YDe(l,d)||a)&&c.add(d),f%5===0&&o.throwIfTimedOut()}),o.popCurrentBond(),c.getSelection()}}const QDe=Object.freeze(Object.defineProperty({__proto__:null,areIntersectedBy:GDe,first:zDe,getCurrentStructureProperties:Xk,isConnectedTo:KDe,pick:jDe,withSameAtomProperties:HDe,within:qDe},Symbol.toStringTag,{value:"Module"}));function ZDe(e){return e.length===0?qk:e.length===1?e[0]:function(t){for(var r=yt.UniqueBuilder(t.inputStructure),n=function(i){yt.forEach(e[i](t),function(o,s){r.add(o),i%100&&t.throwIfTimedOut()})},a=0;a<e.length;a++)n(a);return r.getSelection()}}function JDe(e){return e.length===0?qk:e.length===1?e[0]:function(t){for(var r=[],n=0;n<e.length;n++)r.push(e[n](t));for(var a=0,i=yt.structureCount(r[0]),n=1;n<r.length;n++){var o=yt.structureCount(r[n]);o<i&&(a=n,i=o)}t.throwIfTimedOut();var s=Ak(function(c){return c.hashCode},tt.areUnitIdsAndIndicesEqual);yt.forEach(r[a],function(c){return s.add(c)});for(var u=yt.UniqueBuilder(t.inputStructure),l=0;l<r.length;l++)l!==a&&(yt.forEach(r[l],function(c){s.has(c)&&u.add(c)}),t.throwIfTimedOut());return u.getSelection()}}const e5e=Object.freeze(Object.defineProperty({__proto__:null,intersect:JDe,merge:ZDe},Symbol.toStringTag,{value:"Module"}));var BM;(function(e){function t(f){return!!f&&!!f.has}function r(f,h){return function(v){return f(v)===h}}e.eq=r;function n(f,h){return function(v){return f(v)<h}}e.lt=n;function a(f,h){return function(v){return f(v)<=h}}e.lte=a;function i(f,h){return function(v){return f(v)>h}}e.gt=i;function o(f,h){return function(v){return f(v)>=h}}e.gte=o;function s(f){return!0}function u(f){return!1}function l(f,h){if(t(h))return function(g){return h.has(f(g))};if(h.length===0)return u;for(var v=new Set,p=0;p<h.length;p++)v.add(h[p]);return function(g){return v.has(f(g))}}e.inSet=l;function c(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];switch(f.length){case 0:return s;case 1:return f[0];case 2:{var v=f[0],p=f[1];return function(W){return v(W)&&p(W)}}case 3:{var g=f[0],m=f[1],y=f[2];return function(W){return g(W)&&m(W)&&y(W)}}case 4:{var b=f[0],S=f[1],x=f[2],C=f[3];return function(W){return b(W)&&S(W)&&x(W)&&C(W)}}case 5:{var w=f[0],A=f[1],I=f[2],D=f[3],k=f[4];return function(W){return w(W)&&A(W)&&I(W)&&D(W)&&k(W)}}case 6:{var R=f[0],L=f[1],H=f[2],B=f[3],j=f[4],Q=f[5];return function(W){return R(W)&&L(W)&&H(W)&&B(W)&&j(W)&&Q(W)}}default:{var G=f.length;return function(W){for(var q=0;q<G;q++)if(!f[q])return!1;return!0}}}}e.and=c;function d(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];switch(f.length){case 0:return u;case 1:return f[0];case 2:{var v=f[0],p=f[1];return function(W){return v(W)||p(W)}}case 3:{var g=f[0],m=f[1],y=f[2];return function(W){return g(W)||m(W)||y(W)}}case 4:{var b=f[0],S=f[1],x=f[2],C=f[3];return function(W){return b(W)||S(W)||x(W)||C(W)}}case 5:{var w=f[0],A=f[1],I=f[2],D=f[3],k=f[4];return function(W){return w(W)||A(W)||I(W)||D(W)||k(W)}}case 6:{var R=f[0],L=f[1],H=f[2],B=f[3],j=f[4],Q=f[5];return function(W){return R(W)||L(W)||H(W)||B(W)||j(W)||Q(W)}}default:{var G=f.length;return function(W){for(var q=0;q<G;q++)if(f[q])return!0;return!1}}}}e.or=d})(BM||(BM={}));var rn={generators:BMe,filters:QDe,modifiers:FDe,combinators:e5e,pred:BM,internal:PMe},xl;(function(e){function t(c,d){var f=this;return et.create("Build Assembly",function(h){return de(f,void 0,void 0,function(){var v,p,g,m,y,b,S,x,C,w,A,I,D,k,R,L;return fe(this,function(H){if(v=c.models,v.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");if(p=Q1.findAssembly(v[0],d),!p)throw new Error("Assembly '"+d+"' is not defined.");for(g=gn.create(p.id,le.identity(),{assembly:{id:p.id,operId:0,operList:[]}}),m=tt.Builder({coordinateSystem:g,label:c.label}),y=new as(c),b=0,S=p.operatorGroups;b<S.length;b++)if(x=S[b],C=x.selector(y),yt.structureCount(C)!==0)for(w=yt.unionStructure(C).units,A=0,I=x.operators;A<I.length;A++)for(D=I[A],k=0,R=w;k<R.length;k++)L=R[k],m.addWithOperator(L,D);return[2,m.getStructure()]})})})}e.buildAssembly=t;function r(c,d,f){var h=this;return et.create("Build Symmetry Assembly",function(v){return de(h,void 0,void 0,function(){var p,g,m,y,b,S,x,C,w,A,I,D,k,R,L,H,B,j,Q,G,W,q,J,he,$;return fe(this,function(X){if(p=c.models,p.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");for(g=_(),m=tt.Builder({label:c.label,representativeModel:p[0]}),y=new as(c),b=0,S=d;b<S.length;b++)if(x=S[b],C=t5e(x.asymIds),w=C(y),yt.structureCount(w)!==0)for(A=yt.unionStructure(w).units,I=0,D=x.operators;I<D.length;I++)for(k=D[I],R=k.index,L=k.shift,H=L[0],B=L[1],j=L[2],Q=xK(f,R,H,B,j,g),G=0,W=A;G<W.length;G++)for(q=W[G],J=0,he=Q;J<he.length;J++)$=he[J],m.addWithOperator(q,$);return[2,m.getStructure()]})})})}e.buildSymmetryAssembly=r;function n(c,d){return et.create("Find Symmetry Mates",function(f){return i5e(f,c,d)})}e.builderSymmetryMates=n;function a(c,d,f){return et.create("Build Symmetry",function(h){return a5e(h,c,d,f)})}e.buildSymmetryRange=a;function i(c){return et.create("Build NCS",function(d){return n5e(d,c)})}e.buildNcs=i;function o(c,d){return c.invariantId===d.invariantId&&c.model.id===d.model.id&&it.areEqual(c.elements,d.elements)}e.areUnitsEquivalent=o;function s(){return NSe(We.hashUnit,o)}e.UnitEquivalenceBuilder=s;function u(c){for(var d=s(),f=0,h=c.units;f<h.length;f++){var v=h[f];d.add(v.id,v)}for(var p=[],g=0,m=d.groups;g<m.length;g++){var y=m[g];p.push(We.SymmetryGroup(y.map(function(b){return c.unitMap.get(b)})))}return p}e.computeTransformGroups=u;function l(c,d){if(c.length!==d.length)return!1;for(var f=0,h=c.length;f<h;++f){var v=c[f].units,p=d[f].units;if(v.length!==p.length||c[f].hashCode!==d[f].hashCode)return!1;for(var g=0,m=v.length;g<m;g++)if(v[g].conformation!==p[g].conformation)return!1}return!0}e.areTransformGroupsEquivalent=l})(xl||(xl={}));function t5e(e){return rn.generators.atoms({chainTest:rn.pred.and(rn.pred.eq(function(t){return pt.unit.operator_name(t.element)},gn.DefaultName),rn.pred.inSet(function(t){return pt.chain.label_asym_id(t.element)},e))})}function xK(e,t,r,n,a,i){var o=e.spacegroup,s=e.ncsOperators,u=[],l=o.cell.toFractional,c=_.transformMat4(_(),i,l),d=zu.getSymmetryOperatorRef(o,t,r,n,a,c);if(s&&s.length)for(var f=0,h=s.length;f<h;++f){var v=s[f],p=le.mul(le(),d.matrix,v.matrix),g=gn.create(d.name+" "+v.name,p,{assembly:d.assembly,ncsId:v.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});u.push(g)}else u.push(d);return u}function SK(e,t,r,n){var a=e.spacegroup,i=e.ncsOperators,o=i&&i.length||0,s=[];!o&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=zu.getSymmetryOperator(a,0,0,0,0));for(var u=a.cell.toFractional,l=_.transformMat4(_(),n,u),c=0;c<a.operators.length;c++)for(var d=t[0];d<=r[0];d++)for(var f=t[1];f<=r[1];f++)for(var h=t[2];h<=r[2];h++)!o&&c===0&&d===0&&f===0&&h===0||s.push.apply(s,xK(e,c,d,f,h,l));return s}function r5e(e,t){return e._operators_333&&_.equals(t,e._operators_333.ref)||(e._operators_333={ref:_.clone(t),operators:SK(e,_.create(-3,-3,-3),_.create(3,3,3),t)}),e._operators_333.operators}function CK(e,t){for(var r=tt.Builder({label:e.label}),n=e.units,a=0,i=t;a<i.length;a++)for(var o=i[a],s=0,u=n;s<u.length;s++){var l=u[s];r.addWithOperator(l,o)}return r.getStructure()}function n5e(e,t){return de(this,void 0,void 0,function(){var r,n,a;return fe(this,function(i){if(r=t.models,r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");return n=ca.Provider.get(r[0]),n?(a=n.ncsOperators,!a||!a.length?[2,t]:[2,CK(t,a)]):[2,t]})})}function a5e(e,t,r,n){return de(this,void 0,void 0,function(){var a,i,o,s,u;return fe(this,function(l){if(a=t.models,a.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return i=ca.Provider.get(a[0]),i?(o=i.spacegroup,Io.isZero(o.cell)?[2,t]:(s=Xt.getCenter(a[0]),u=SK(i,r,n,s),[2,CK(t,u)])):[2,t]})})}function i5e(e,t,r){return de(this,void 0,void 0,function(){function n(D,k){return D.invariantId+"|"+k.name}var a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C,w,A,I;return fe(this,function(D){switch(D.label){case 0:if(a=t.models,a.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return i=ca.Provider.get(a[0]),i?(o=i.spacegroup,Io.isZero(o.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2]):[2,t];case 1:D.sent(),D.label=2;case 2:s=Xt.getCenter(a[0]),u=r5e(i,s),l=t.lookup3d,c=new Set,d=tt.Builder({label:t.label}),f=t.units,h=_.zero(),v=0,p=u,D.label=3;case 3:if(!(v<p.length))return[3,6];for(g=p[v],m=0,y=f;m<y.length;m++)for(b=y[m],S=b.lookup3d.boundary.sphere,_.transformMat4(h,S.center,g.matrix),x=l.findUnitIndices(h[0],h[1],h[2],S.radius+r),C=0,w=x.count;C<w;C++)A=f[x.indices[C]],A.lookup3d.check(h[0],h[1],h[2],S.radius+r)&&(I=n(b,g),c.has(I)||(d.addWithOperator(b,g),c.add(I)));return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:D.sent(),D.label=5;case 5:return v++,[3,3];case 6:return[2,d.getStructure()]}})})}var o5e=function(){function e(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=Gs.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++},e.prototype.addElementRange=function(t,r,n){for(var a=r;a<n;a++)this.currentUnit[this.currentUnit.length]=t[a],this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length},e.prototype._getStructure=function(t){if(this.isEmpty)return tt.Empty;var r=[];Pu(this.ids);for(var n=xl.UnitEquivalenceBuilder(),a=0,i=this.ids.length;a<i;a++){var o=this.ids[a],s=this.parent.unitMap.get(o),u=this.unitMap.get(o),l=!1;t&&(this.isSorted||Pu(u),u=it.deduplicate(it.ofSortedArray(this.currentUnit)),l=!0);var c=u.length;if(u.length===s.elements.length){r[r.length]=s,n.add(s.id,s);continue}!this.isSorted&&!l&&c>1&&Pu(u);var d=s.getChild(it.ofSortedArray(u)),f=n.add(d.id,d);d!==f&&(d=f.applyOperator(d.id,d.conformation.operator,!0)),r[r.length]=d}return tt.create(r,{parent:this.parent})},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(t){var r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function j7(e,t){for(var r=1;t--;)r*=e--;return r}function s5e(e,t){return t>e?0:j7(e,t)/j7(t,t)}function u5e(e){var t=e&-e,r=e+t,n=r&-r,a=(n/t>>1)-1;return r|a}var l5e=function(){function e(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=s5e(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}return e.prototype.move=function(){if(this.hasNext){for(var t=0,r=0,n=this.index;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=u5e(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();function _K(e,t){for(var r=[],n=new l5e(e,t);n.hasNext;)r.push(n.move().slice());return r}var wh=[],c5e={links:wh,terminalLinks:wh,elements:wh,partialElements:wh,getElementIndices:function(){return wh},getLinkIndices:function(){return wh},getTerminalLinkIndices:function(){return wh}},Pa=Qg("C"),wy=Qg("O"),d5e=[Ls.elementFingerprint([Pa,Pa,Pa,wy]),Ls.elementFingerprint([Pa,Pa,Pa,Pa,wy]),Ls.elementFingerprint([Pa,Pa,Pa,Pa,Pa,wy]),Ls.elementFingerprint([Pa,Pa,Pa,Pa,Pa,Pa,wy])];function f5e(e,t){for(var r=-1,n=-1,a=-1,i=-1,o=e.elements,s=e.model.atomicHierarchy.atoms,u=s.type_symbol,l=s.label_atom_id,c=e.bonds,d=c.b,f=c.offset,h=0,v=t.length;h<v;++h){var p=o[t[h]];if(u.value(p)===Pa){for(var g=0,m=0,y=f[t[h]],b=f[t[h]+1];y<b;++y){var S=o[d[y]],x=u.value(S);x===wy?++g:x===Pa&&++m}if(g===2){r=p;break}else g===1&&m===1?n=p:l.value(p).startsWith("C1")?a=p:i=p}}return r!==-1?r:n!==-1?n:a!==-1?a:i!==-1?i:o[t[0]]}function h5e(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_alt_id;return n.value(r[t])}function p5e(e,t,r,n){var a=t.conformation.position;return _.normalize(e,_.sub(e,n,a(r,e))),e}function z7(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_atom_id;return n.value(r[t])}function v5e(e,t){if(!(!t||!t.length)){for(var r=e.unit,n=e.all,a=new Set,i=_K(Ws(new Array(t.length)),2),o=0,s=i.length;o<s;++o){var u=i[o],l=n[t[u[0]]],c=n[t[u[1]]];it.areIntersecting(l,c)&&Ls.getAltId(r,l)===Ls.getAltId(r,c)&&(a.add(t[u[0]]),a.add(t[u[1]]))}if(a.size){for(var d=[],o=0,s=t.length;o<s;++o)a.has(t[o])||d.push(t[o]);return d}else return t}}function m5e(e,t){return t.properties.saccharideComponentMap.get(e)}function g5e(e){if(e.models.reduce(function(xe,Ie){return xe+Ie.properties.saccharideComponentMap.size},0)===0)return c5e;var t=[],r=[],n=[],a=[],i=new Map;function o(xe,Ie,_e){return xe+"|"+Ie+"|"+_e}function s(xe,Ie){i.has(xe)?i.get(xe).push(Ie):i.set(xe,[Ie])}function u(xe,Ie){_.sub(n[xe].geometry.direction,n[Ie].geometry.center,n[xe].geometry.center),_.normalize(n[xe].geometry.direction,n[xe].geometry.direction)}var l=_.zero();function c(xe,Ie,_e){var ae=_e.conformation.position,ie=n[xe].geometry;_.sub(ie.direction,ae(_e.elements[Ie],l),ie.center),_.normalize(ie.direction,ie.direction)}for(var d=0,f=e.units.length;d<f;++d){var h=e.units[d];if(We.isAtomic(h))for(var v=h.model,p=h.rings,g=v.atomicHierarchy,m=g.chainAtomSegments,y=g.residueAtomSegments,b=g.atoms,S=b.label_comp_id,x=ar.transientSegments(m,h.elements),C=ar.transientSegments(y,h.elements),w=void 0;x.hasNext;)for(C.setSegment(x.move());C.hasNext;){var A=C.move().index,I=m5e(S.value(y.offsets[A]),v);if(I){w||(w=e_.byFingerprintAndResidue(p,d5e));var D=v5e(p,w.get(A));if(!D||!D.length){a.push({unit:h,residueIndex:A,component:I});continue}for(var k=[],R=0,L=D.length;R<L;++R){var H=p.all[D[R]],B=f5e(h,H),j=Wp.calculateMomentsAxes(UY(h,H)),Q=_.copy(_.zero(),j.origin),G=_.copy(_.zero(),j.dirC),W=p5e(_.zero(),h,B,Q);_.orthogonalize(W,G,W);var q=Ls.getAltId(h,H),J=n.length;k.push(J),s(o(A,h.id,q),J),q&&s(o(A,h.id,""),J),n.push({geometry:{center:Q,normal:G,direction:W},component:I,ringIndex:D[R],altId:q,unit:h,residueIndex:A})}for(var he=_K(Ws(new Array(D.length)),2),R=0,L=he.length;R<L;++R){var $=he[R],X=p.all[D[$[0]]],U=p.all[D[$[1]]];if(To.areVertexSetsConnected(h.bonds,X,U,3)){var z=k[$[0]],ee=k[$[1]];n[z].altId===n[ee].altId&&(u(z,ee),u(ee,z),t.push({carbohydrateIndexA:z,carbohydrateIndexB:ee}),t.push({carbohydrateIndexA:ee,carbohydrateIndexB:z}))}}}}}function Y(xe,Ie){return i.get(o(xe.getResidueIndex(Ie),xe.id,h5e(xe,Ie)))||[]}for(var d=0,f=n.length;d<f;++d)for(var Z=n[d],h=Z.unit,R=d+1;R<f;++R){var te=n[R];if(!(h!==te.unit||Z.residueIndex===te.residueIndex)){var ce=h.rings.all[Z.ringIndex],be=h.rings.all[te.ringIndex];To.areVertexSetsConnected(h.bonds,ce,be,3)&&(u(d,R),u(R,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:R}),t.push({carbohydrateIndexA:R,carbohydrateIndexB:d}))}}for(var d=0,f=e.units.length;d<f;++d){var h=e.units[d];We.isAtomic(h)&&e.interUnitBonds.getConnectedUnits(h.id).forEach(function(ae){ae.connectedIndices.forEach(function(ie){ae.getEdges(ie).forEach(function(O){var V=O.props,ve=O.indexB;if(Nr.isCovalent(V.flag)){var Pe=e.unitMap.get(ae.unitA),Me=e.unitMap.get(ae.unitB),Ge=Y(Pe,ie),$e=Y(Me,ve);if(Ge.length>0&&$e.length>0)for(var Ze=Ge.length,ht=$e.length,Ue=0,rt=Math.max(Ze,ht);Ue<rt;++Ue){var ut=Ge[Math.min(Ue,Ze-1)],Ee=$e[Math.min(Ue,ht-1)],Te=z7(Pe,ie);(Te.startsWith("O1")||Te.startsWith("C1"))&&u(ut,Ee),t.push({carbohydrateIndexA:ut,carbohydrateIndexB:Ee})}else if($e.length===0)for(var ye=0,Se=Ge;ye<Se.length;ye++){var ut=Se[ye],Te=z7(Pe,ie);(Te.startsWith("O1")||Te.startsWith("C1"))&&c(ut,ve,Me),r.push({carbohydrateIndex:ut,elementIndex:ve,elementUnit:Me,fromCarbohydrate:!0})}else if(Ge.length===0)for(var Le=0,Ve=$e;Le<Ve.length;Le++){var Ee=Ve[Le];r.push({carbohydrateIndex:Ee,elementIndex:ie,elementUnit:Pe,fromCarbohydrate:!1})}}})})})}return E({links:t,terminalLinks:r,elements:n,partialElements:a},y5e(n,t,r))}function y5e(e,t,r){function n(L,H){return Uf(L.id,H)}function a(L,H,B){var j=[],Q=L.get(n(H,B));if(Q!==void 0)for(var G=0,W=Q;G<W.length;G++){var q=W[G];Di(j,q)}return j}for(var i=new Map,o=0,s=e.length;o<s;++o)for(var u=e[o],l=u.unit,c=u.ringIndex,d=l.rings.all[c],f=0,h=d.length;f<h;++f){var v=n(l,l.elements[d[f]]),p=i.get(v);p===void 0?i.set(v,[o]):p.push(o)}function g(L,H){return a(i,L,H)}for(var m=new Map,o=0,s=t.length;o<s;++o)for(var y=t[o],b=e[y.carbohydrateIndexA],l=b.unit,c=b.ringIndex,d=l.rings.all[c],f=0,h=d.length;f<h;++f){var v=n(l,l.elements[d[f]]),p=m.get(v);p===void 0?m.set(v,[o]):p.push(o)}function S(L,H){return a(m,L,H)}for(var x=new Map,o=0,s=r.length;o<s;++o){var C=r[o],w=C.fromCarbohydrate,A=C.carbohydrateIndex,I=C.elementUnit,D=C.elementIndex;if(w)for(var k=e[A],l=k.unit,c=k.ringIndex,d=l.rings.all[c],f=0,h=d.length;f<h;++f){var v=n(l,l.elements[d[f]]),p=x.get(v);p===void 0?x.set(v,[o]):p.push(o)}else{var v=n(I,I.elements[D]),p=x.get(v);p===void 0?x.set(v,[o]):p.push(o)}}function R(L,H){return a(x,L,H)}return{getElementIndices:g,getLinkIndices:S,getTerminalLinkIndices:R}}var Y2=je(),b5e=new ls("14"),x5e=new ls("98");function S5e(e){return e>500?b5e:x5e}function C5e(e){var t=e.units,r=S5e(t.length);r.reset();for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.boundary,s=i.conformation.operator;s.isIdentity?r.includeSphere(o.sphere):(je.transform(Y2,o.sphere,s.matrix),r.includeSphere(Y2))}r.finishedIncludeStep();for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.boundary,s=i.conformation.operator;s.isIdentity?r.radiusSphere(o.sphere):(je.transform(Y2,o.sphere,s.matrix),r.radiusSphere(Y2))}return{box:r.getBox(),sphere:r.getSphere()}}var tt=function(){function e(t,r,n,a,i){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=a,this._child=i==null?void 0:i.child,this._target=i==null?void 0:i.target}return e.prototype.subsetBuilder=function(t){return new o5e(this,t)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this.state.elementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bondCount",{get:function(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount+Gt.getIntraUnitBondCount(this)),this.state.bondCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCustomProperties",{get:function(){return!!this.state.customProps&&this.state.customProps.all.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customPropertyDescriptors",{get:function(){return this.state.customProps||(this.state.customProps=new Nl),this.state.customProps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPropertyData",{get:function(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inheritedPropertyData",{get:function(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=M5e(this)),this.state.polymerResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerGapCount",{get:function(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=D5e(this)),this.state.polymerGapCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerUnitCount",{get:function(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=R5e(this)),this.state.polymerUnitCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementCount",{get:function(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=I5e(this)),this.state.uniqueElementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atomicResidueCount",{get:function(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=k5e(this)),this.state.atomicResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarseGrained",{get:function(){return this.models.some(function(t){return Xt.isCoarseGrained(t)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=Ui(this.units.map(function(t){return t.id})),this.state.transformHash)},enumerable:!1,configurable:!0}),e.prototype.computeHash=function(){for(var t=23,r=0,n=this.units.length;r<n;r++){var a=this.units[r];t=31*t+a.id|0,t=31*t+it.hashCode(a.elements)|0}return t=31*t+this.elementCount|0,t=SX(t),t===-1&&(t=0),this.state.hashCode=t,t},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"root",{get:function(){return this.state.parent||this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.state.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this.state.coordinateSystem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.state.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundary",{get:function(){return this.state.boundary?this.state.boundary:(this.state.boundary=C5e(this),this.state.boundary)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new xMe(this),this.state.lookup3d)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interUnitBonds",{get:function(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.state.interUnitBonds=VIe(this),this.state.interUnitBonds)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=xl.computeTransformGroups(this),this.state.unitSymmetryGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroupsIndexMap",{get:function(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=We.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=g5e(this),this.state.carbohydrates)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this.state.models?this.state.models:(this.state.models=w5e(this),this.state.models)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=E5e(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementSymbols",{get:function(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=A5e(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this.state.entityIndices||(this.state.entityIndices=P5e(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=T5e(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!We.isAtomic(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(We.isAtomic(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!We.isCoarse(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(We.isCoarse(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialMapping",{get:function(){return this.state.serialMapping||(this.state.serialMapping=O5e(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;var t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterModel",{get:function(){return this.state.masterModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"representativeModel",{get:function(){return this.state.representativeModel},enumerable:!1,configurable:!0}),e.prototype.hasElement=function(t){return this.unitMap.has(t.unit.id)?it.has(this.unitMap.get(t.unit.id).elements,t.element):!1},e.prototype.getModelIndex=function(t){return this.models.indexOf(t)},e.prototype.remapModel=function(t){for(var r=[],n=0,a=this.unitSymmetryGroups;n<a.length;n++){var i=a[n],o=i.units[0].remapModel(t);r.push(o);for(var s=1,u=i.units.length;s<u;++s){var l=i.units[s];r.push(l.remapModel(t,o.props))}}return e.create(r,{label:this.label,interUnitBonds:this.state.interUnitBonds})},e.prototype.asParent=function(){return this._proxy?this._proxy:(this._proxy=this.parent?new e(this.parent.units,this.parent.unitMap,this.parent.unitIndexMap,this.parent.state,{child:this,target:this.parent}):this,this._proxy)},Object.defineProperty(e.prototype,"child",{get:function(){return this._child},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;return(t=this._target)!==null&&t!==void 0?t:this},enumerable:!1,configurable:!0}),e}();function _5e(e,t,r){return e[t].id-e[r].id}function w5e(e){for(var t=e.units,r=Jr.create(),n=0,a=t;n<a.length;n++){var i=a[n];Jr.add(r,i.model.id,i.model)}return r.array}function E5e(e){for(var t=pt.residue.microheterogeneityCompIds,r=new Set,n=at.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var o=i[a],s=o.units[0];if(We.isAtomic(s)){var u=ar.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(n.unit=s;u.hasNext;){var l=u.move();n.element=s.elements[l.start];for(var c=t(n),d=0,f=c;d<f.length;d++){var h=f[d];r.add(h)}}}}return r}function A5e(e){for(var t=pt.atom.type_symbol,r=new Set,n=at.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var o=i[a],s=o.units[0];if(We.isAtomic(s)){n.unit=s;for(var u=0,l=s.elements.length;u<l;++u)n.element=s.elements[u],r.add(t(n))}}return r}function P5e(e){for(var t=e.units,r=at.create(e),n=Jr.create(),a=0,i=t;a<i.length;a++){var o=i[a],s=o.kind===0?pt.entity.key:pt.coarse.entityKey;r.unit=o;for(var u=o.elements,l=ar.transientSegments(o.model.atomicHierarchy.chainAtomSegments,u);l.hasNext;){var c=l.move();r.element=u[c.start];var d=s(r);Jr.add(n,d,d)}}return Pu(n.array),n.array}function T5e(e){for(var t=new Map,r=[],n=e.unitSymmetryGroups,a=0,i=n;a<i.length;a++){var o=i[a],s=o.units[0];if(We.isAtomic(s)){var u=void 0;t.has(s.model.id)?u=t.get(s.model.id):(u=Jr.create(),r.push(s.model.id),t.set(s.model.id,u));for(var l=ar.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);l.hasNext;){var c=l.move();Jr.add(u,c.index,c.index)}}}for(var d=new Map,f=0,h=r;f<h.length;f++){var v=h[f],p=t.get(v).array;Pu(p),d.set(v,p)}return d}function I5e(e){for(var t=e.unitSymmetryGroups,r=0,n=0,a=t.length;n<a;n++)r+=t[n].elements.length;return r}function M5e(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].polymerElements.length;return r}function D5e(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].gapElements.length/2;return r}function R5e(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)t[n].polymerElements.length>0&&(r+=1);return r}function k5e(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++){var i=t[n];if(We.isAtomic(i))for(var o=i.elements,s=i.residueIndex,u=-1,l=-1,c=0,d=o.length;c<d;++c)u=s[o[c]],u!==l&&(r+=1,l=u)}return r}function O5e(e){for(var t=e.units,r=e.elementCount,n=e.unitIndexMap,a=new Uint32Array(t.length),i=new Uint32Array(r),o=new Uint32Array(r),s=0,u=0,l=t.length;s<l;++s){a[s]=u;for(var c=t[s].elements,d=0,f=c.length;d<f;++d){var h=u+d;i[h]=s,o[h]=c[d]}u+=c.length}return{cumulativeUnitElementCount:a,unitIndices:i,elementIndices:o,getSerialIndex:function(v,p){return a[n.get(v.id)]+Fe.indexOf(v.elements,p)}}}(function(e){e.Empty=u([]);function t(U){return{kind:"structure-loci",structure:U}}e.Loci=t;function r(U){for(var z=[],ee=0,Y=U.units;ee<Y.length;ee++){var Z=Y[ee];z.push({unit:Z,indices:Re.ofBounds(0,Z.elements.length)})}return Oe(U,z)}e.toStructureElementLoci=r;function n(U,z){return yt.toLociWithSourceUnits(yt.Singletons(U,z))}e.toSubStructureElementLoci=n;function a(U){return!!U&&U.kind==="structure-loci"}e.isLoci=a;function i(U,z){return U.structure===z.structure}e.areLociEqual=i;function o(U){return U.structure.isEmpty}e.isLociEmpty=o;function s(U,z){return z===U.structure?U:t(z)}e.remapLoci=s;function u(U,z){z===void 0&&(z={});for(var ee=Gs.Mutable(),Y=Gs.Mutable(),Z=0,te=!0,ce=U.length>0?U[0].id:0,be=0,xe=U.length;be<xe;be++){var Ie=U[be];ee.set(Ie.id,Ie),Z+=Ie.elements.length,Ie.id<ce&&(te=!1),ce=Ie.id}te||xX(U,0,U.length,_5e,op);for(var be=0,xe=U.length;be<xe;be++)Y.set(U[be].id,be);var _e={hashCode:-1,transformHash:-1,elementCount:Z,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,coordinateSystem:gn.Default,label:""};return z.parent&&(_e.parent=z.parent.parent||z.parent),z.interUnitBonds&&(_e.interUnitBonds=z.interUnitBonds),z.coordinateSystem?_e.coordinateSystem=z.coordinateSystem:z.parent&&(_e.coordinateSystem=z.parent.coordinateSystem),z.label?_e.label=z.label:z.parent&&(_e.label=z.parent.label),z.masterModel?_e.masterModel=z.masterModel:z.parent&&(_e.masterModel=z.parent.masterModel),z.representativeModel?_e.representativeModel=z.representativeModel:z.parent&&(_e.representativeModel=z.parent.representativeModel),new e(U,ee,Y,_e)}e.create=u;function l(U,z){return de(this,void 0,void 0,function(){var ee,Y,Z,te,ce,be,xe,Ie,_e,ae,ie,O,V;return fe(this,function(ve){switch(ve.label){case 0:if(U.frameCount===0)return[2,e.Empty];ee=[],Y=void 0,Z=0,te=0,ce=U.frameCount,ve.label=1;case 1:return te<ce?[4,et.resolveInContext(U.getFrameAtIndex(te),z)]:[3,4];case 2:for(be=ve.sent(),Y||(Y=be),xe=c(be),Ie=0,_e=xe.units.length;Ie<_e;++Ie)ae=xe.units[Ie],ie=ae.invariantId+Z,O=ae.chainGroupId+Z,V=We.create(ee.length,ie,O,ae.traits,ae.kind,ae.model,ae.conformation.operator,ae.elements),ee.push(V);Z=ee.length,ve.label=3;case 3:return++te,[3,1];case 4:return[2,u(ee,{representativeModel:Y,label:Y.label})]}})})}e.ofTrajectory=l;function c(U){for(var z=U.atomicHierarchy.chainAtomSegments,ee=U.atomicHierarchy.index,Y=U.atomicHierarchy.chains.auth_asym_id,Z=U.atomicChainOperatorMappinng,te=new v({label:U.label}),ce=0;ce<z.count;ce++){var be=Z.get(ce)||gn.Default,xe=z.offsets[ce];Hp.chainResidueCount(U.atomicHierarchy,ce),z.offsets[ce+1]-z.offsets[ce];var Ie=!1;if(d(U,ce))for(;ce+1<z.count&&d(U,ce+1);){var _e=Z.get(ce),ae=Z.get(ce+1);if(_e!==ae)break;Ie=!0,ce++}else for(;ce+1<z.count&&z.offsets[ce+1]-z.offsets[ce]===1&&z.offsets[ce+2]-z.offsets[ce+1]===1;){var ie=ee.getEntityFromChain(ce),O=ee.getEntityFromChain(ce+1);if(ie!==O)break;var V=Y.value(ce),ve=Y.value(ce+1);if(V!==ve)break;var _e=Z.get(ce),ae=Z.get(ce+1);if(_e!==ae)break;Ie=!0,ce++}var Pe=it.ofBounds(xe,z.offsets[ce+1]);te.addUnit(0,U,be,Pe,Ie?1:0)}var Me=U.coarseHierarchy;return Me.isDefined&&(Me.spheres.count>0&&f(te,U,U.coarseHierarchy.spheres,1),Me.gaussians.count>0&&f(te,U,U.coarseHierarchy.gaussians,2)),te.getStructure()}e.ofModel=c;function d(U,z){var ee=U.atomicHierarchy.index.getEntityFromChain(z);return U.entities.data.type.value(ee)==="water"}function f(U,z,ee,Y){for(var Z=ee.chainElementSegments,te=0;te<Z.count;te++){var ce=it.ofBounds(Z.offsets[te],Z.offsets[te+1]);U.addUnit(Y,z,gn.Default,ce,0)}}function h(U,z){if(le.isIdentity(z))return U;if(!le.isRotationAndTranslation(z,gn.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");for(var ee=[],Y=0,Z=U.units;Y<Z.length;Y++){var te=Z[Y],ce=te.conformation.operator,be=gn.create(ce.name,z,ce);ee.push(te.applyOperator(te.id,be))}var xe=U.coordinateSystem,Ie=gn.compose(gn.create(xe.name,z,xe),xe);return u(ee,{parent:U,coordinateSystem:Ie})}e.transform=h;var v=function(){function U(z){z===void 0&&(z={}),this.props=z,this.units=[],this.invariantId=zi(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=_(),this.singleElementUnits=new Map}return U.prototype.beginChainGroup=function(){this.chainGroupId++,this.inChainGroup=!0},U.prototype.endChainGroup=function(){this.inChainGroup=!1},U.prototype.addUnit=function(z,ee,Y,Z,te,ce){ce===void 0&&(ce=this.invariantId());var be=this.inChainGroup?this.chainGroupId:++this.chainGroupId,xe=We.create(this.units.length,ce,be,te,z,ee,Y,Z);return this.add(xe)},U.prototype.add=function(z){if(z.elements.length===1){z.conformation.position(z.elements[0],this.p);var ee=[z.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(ee))return this.singleElementUnits.get(ee);this.singleElementUnits.set(ee,z)}return this.units.push(z),z},U.prototype.addWithOperator=function(z,ee,Y){return Y===void 0&&(Y=!1),this.add(z.applyOperator(this.units.length,ee,Y))},U.prototype.getStructure=function(){return u(this.units,this.props)},Object.defineProperty(U.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),U}();e.StructureBuilder=v;function p(U){return U===void 0&&(U={}),new v(U)}e.Builder=p;function g(U){return U.hashCode}e.hashCode=g;function m(U){return ik(U.units.map(function(z){return We.conformationId(z)}).join("|"))}e.conformationHash=m;function y(U,z){if(U===z)return!0;if(U.elementCount!==z.elementCount)return!1;var ee=U.units.length;if(ee!==z.units.length)return!1;for(var Y=0;Y<ee;Y++)if(U.units[Y].id!==z.units[Y].id)return!1;return!0}e.areUnitIdsEqual=y;function b(U,z){if(!y(U,z))return!1;for(var ee=0,Y=U.units.length;ee<Y;ee++)if(!it.areEqual(U.units[ee].elements,z.units[ee].elements))return!1;return!0}e.areUnitIdsAndIndicesEqual=b;function S(U,z){if(U.hashCode!==z.hashCode)return!1;var ee=U.models.length;if(ee!==z.models.length)return!1;for(var Y=0;Y<ee;Y++)if(!Xt.areHierarchiesEqual(U.models[Y],z.models[Y]))return!1;return!0}e.areHierarchiesEqual=S;function x(U,z){return U===z||U.hashCode===z.hashCode&&xl.areTransformGroupsEquivalent(U.unitSymmetryGroups,z.unitSymmetryGroups)}e.areEquivalent=x;function C(U,z){return x(U.root,z.root)}e.areRootsEquivalent=C;function w(U,z){return U.root===z.root}e.areRootsEqual=w;var A=function(){function U(z){this.structure=z,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=at.create(z),this.hasNext=z.elementCount>0,this.hasNext&&(this.elements=z.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=z.units[0])}return U.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},U.prototype.advance=function(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)},U}();e.ElementLocationIterator=A;var I=_();function D(U,z,ee){for(var Y=U.elements,Z=U.conformation,te=Z.position,ce=Z.r,be=I,xe=Number.MAX_VALUE,Ie=0,_e=Y.length;Ie<_e;Ie++){var ae=Y[Ie],ie=_.distance(z,te(ae,be))-ee-ce(ae);ie<xe&&(xe=ie)}return xe}function k(U,z,ee){for(var Y=U.units,Z=Number.MAX_VALUE,te=0,ce=Y.length;te<ce;te++){var be=Y[te],xe=D(be,z,ee);xe<Z&&(Z=xe)}return Z}e.minDistanceToPoint=k;var R=_();function L(U,z){if(U.elementCount===0||z.elementCount===0)return 0;for(var ee=U.units,Y=Number.MAX_VALUE,Z=0,te=ee.length;Z<te;Z++)for(var ce=ee[Z],be=ce.elements,xe=ce.conformation,Ie=xe.position,_e=xe.r,ae=0,ie=be.length;ae<ie;ae++){var O=be[ae],V=k(z,Ie(O,R),_e(O));V<Y&&(Y=V)}return Y}e.distance=L;function H(U){return U.elementCount===1?"1 element":U.elementCount+" elements"}e.elementDescription=H;function B(U,z,ee){return U.masterModel?z.model===ee.model||z.model===U.masterModel||ee.model===U.masterModel:z.model===ee.model}e.validUnitPair=B;function j(U,z,ee){var Y=ee.maxRadius,Z=ee.validUnit,te=ee.validUnitPair;if(U.units.some(function(ve){return Z(ve)}))for(var ce=U.lookup3d,be=_(),xe=0,Ie=U.units;xe<Ie.length;xe++){var _e=Ie[xe];if(Z(_e)){var ae=_e.boundary.sphere;_.transformMat4(be,ae.center,_e.conformation.operator.matrix);for(var ie=ce.findUnitIndices(be[0],be[1],be[2],ae.radius+Y),O=0;O<ie.count;O++){var V=U.units[ie.indices[O]];!Z(V)||_e.id>=V.id||!te(_e,V)||(V.elements.length>=_e.elements.length?z(_e,V):z(V,_e))}}}}e.eachUnitPair=j;function Q(U,z){for(var ee=z.chain,Y=z.residue,Z=z.atom,te=at.create(U),ce=0,be=U.units;ce<be.length;ce++){var xe=be[ce];if(xe.kind===0){te.unit=xe;for(var Ie=xe.elements,_e=ar.transientSegments(xe.model.atomicHierarchy.chainAtomSegments,Ie),ae=ar.transientSegments(xe.model.atomicHierarchy.residueAtomSegments,Ie);_e.hasNext;){var ie=_e.move();if(ee&&(te.element=Ie[ie.start],ee(te)),!(!Y&&!Z))for(ae.setSegment(ie);ae.hasNext;){var O=ae.move();if(Y&&(te.element=Ie[O.start],Y(te)),!!Z)for(var V=O.start,ve=O.end;V<ve;V++)te.element=Ie[V],Z(te)}}}}}e.eachAtomicHierarchyElement=Q,e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function G(U){return U.unitSymmetryGroups.filter(function(z){return z.units[0].polymerElements.length>0})}function W(U,z){var ee=G(U);return ee.length===1&&ee[0].units.length>2&&ee[0].units[0].polymerElements.length<z.fiberResidueCount}function q(U,z){var ee=G(U);return ee.length>=1&&ee[0].units.length>z.highSymmetryUnitCount}var J;(function(U){U[U.Small=0]="Small",U[U.Medium=1]="Medium",U[U.Large=2]="Large",U[U.Huge=3]="Huge",U[U.Gigantic=4]="Gigantic"})(J=e.Size||(e.Size={}));function he(U,z,ee){z===void 0&&(z={}),ee===void 0&&(ee=1);var Y=E(E({},e.DefaultSizeThresholds),z);return U.polymerResidueCount>=Y.largeResidueCount*ee?q(U,Y)?J.Huge:J.Gigantic:W(U,Y)||U.polymerResidueCount<Y.smallResidueCount*ee?J.Small:U.polymerResidueCount<Y.mediumResidueCount*ee?J.Medium:J.Large}e.getSize=he,e.Index=th.createSimple("index","root");var $="__PrincipalAxes__";function X(U){if(U.currentPropertyData[$])return U.currentPropertyData[$];var z=Oe.getPrincipalAxes(e.toStructureElementLoci(U));return U.currentPropertyData[$]=z,z}e.getPrincipalAxes=X})(tt||(tt={}));var L5e=Fe.size;function Oe(e,t){return{kind:"element-loci",structure:e,elements:t}}(function(e){function t(z){return!!z&&z.kind==="element-loci"}e.is=t;function r(z,ee){if(z.structure!==ee.structure||z.elements.length!==ee.elements.length)return!1;for(var Y=0,Z=z.elements.length;Y<Z;++Y){var te=z.elements[Y],ce=ee.elements[Y];if(te.unit.id!==ce.unit.id||!Fe.areEqual(te.indices,ce.indices))return!1}return!0}e.areEqual=r;function n(z){return i(z)===0}e.isEmpty=n;function a(z){return i(z)===z.structure.elementCount}e.isWholeStructure=a;function i(z){for(var ee=0,Y=0,Z=z.elements;Y<Z.length;Y++){var te=Z[Y];ee+=L5e(te.indices)}return ee}e.size=i;function o(z){return e(z,z.units.map(function(ee){return{unit:ee,indices:Fe.ofBounds(0,ee.elements.length)}}))}e.all=o;function s(z){return e(z,[])}e.none=s;function u(z,ee){if(!n(z)){var Y=z.elements[0].unit,Z=Y.elements[Fe.getAt(z.elements[0].indices,0)];return ee?(ee.structure=z.structure,ee.unit=z.elements[0].unit,ee.element=Z,ee):at.create(z.structure,Y,Z)}}e.getFirstLocation=u;function l(z){return n(z)?z:e(z.structure,[{unit:z.elements[0].unit,indices:Fe.ofSingleton(Fe.start(z.elements[0].indices))}])}e.firstElement=l;function c(z){return n(z)?z:b(l(z))}e.firstResidue=c;function d(z){return n(z)?z:I(l(z))}e.firstChain=d;function f(z){for(var ee=[],Y=function(be){var xe=be.unit,Ie=be.indices,_e=new Int32Array(Fe.size(Ie));Fe.forEach(Ie,function(ae,ie){return _e[ie]=xe.elements[ae]}),ee.push(xe.getChild(it.ofSortedArray(_e)))},Z=0,te=z.elements;Z<te.length;Z++){var ce=te[Z];Y(ce)}return tt.create(ee,{parent:z.structure.parent})}e.toStructure=f;function h(z,ee){if(ee===z.structure)return z;var Y=[];return z.elements.forEach(function(Z){if(ee.unitMap.has(Z.unit.id)){var te=ee.unitMap.get(Z.unit.id),ce=Fe.indexedIntersect(Z.indices,Z.unit.elements,te.elements);Fe.size(ce)>0&&Y.push({unit:te,indices:ce})}}),e(ee,Y)}e.remap=h;function v(z,ee){if(z.elements.length>ee.elements.length)return v(ee,z);if(e.isEmpty(z))return ee;for(var Y=new Map,Z=0,te=z.elements;Z<te.length;Z++){var ce=te[Z];Y.set(ce.unit.id,ce.indices)}for(var be=[],xe=0,Ie=ee.elements;xe<Ie.length;xe++){var ce=Ie[xe];Y.has(ce.unit.id)?(be[be.length]={unit:ce.unit,indices:Fe.union(Y.get(ce.unit.id),ce.indices)},Y.delete(ce.unit.id)):be[be.length]=ce}return Y.forEach(function(_e,ae){be[be.length]={unit:z.structure.unitMap.get(ae),indices:_e}}),e(z.structure,be)}e.union=v;function p(z,ee){for(var Y=new Map,Z=0,te=ee.elements;Z<te.length;Z++){var ce=te[Z];Y.set(ce.unit.id,ce.indices)}for(var be=[],xe=0,Ie=z.elements;xe<Ie.length;xe++){var ce=Ie[xe];if(Y.has(ce.unit.id)){var _e=Fe.subtract(ce.indices,Y.get(ce.unit.id));if(Fe.size(_e)===0)continue;be[be.length]={unit:ce.unit,indices:_e}}else be[be.length]=ce}return e(z.structure,be)}e.subtract=p;function g(z,ee){for(var Y=new Map,Z=0,te=z.elements;Z<te.length;Z++){var ce=te[Z];Y.set(ce.unit.id,ce.indices)}for(var be=[],xe=0,Ie=ee.elements;xe<Ie.length;xe++){var ce=Ie[xe];if(Y.has(ce.unit.id)){var _e=Fe.intersect(Y.get(ce.unit.id),ce.indices);Fe.size(_e)!==0&&(be[be.length]={unit:ce.unit,indices:_e})}}return e(z.structure,be)}e.intersect=g;function m(z,ee){if(z.elements.length>ee.elements.length)return m(ee,z);if(e.isEmpty(z))return e.isEmpty(ee);for(var Y=new Map,Z=0,te=z.elements;Z<te.length;Z++){var ce=te[Z];Y.set(ce.unit.id,ce.indices)}for(var be=0,xe=ee.elements;be<xe.length;be++){var ce=xe[be];if(Y.has(ce.unit.id)&&Fe.areIntersecting(Y.get(ce.unit.id),ce.indices))return!0}return!1}e.areIntersecting=m;function y(z,ee){if(e.isEmpty(z))return e.isEmpty(ee);for(var Y=new Map,Z=0,te=z.elements;Z<te.length;Z++){var ce=te[Z];Y.set(ce.unit.id,ce.indices)}for(var be=!1,xe=0,Ie=ee.elements;xe<Ie.length;xe++){var ce=Ie[xe];if(Y.has(ce.unit.id))if(Fe.isSubset(Y.get(ce.unit.id),ce.indices))be=!0;else return!1}return be}e.isSubset=y;function b(z,ee){for(var Y=[],Z=new Set,te=0,ce=z.elements;te<ce.length;te++){var be=ce[te];if(x(be)){Y[Y.length]=be;continue}if(be.unit.kind===0){for(var xe=be.unit.elements,Ie=be.unit.model.atomicHierarchy,_e=be.unit.model.atomicHierarchy.atoms.label_alt_id,ae=Ie.residueAtomSegments,ie=ae.index,O=ae.offsets,V=[],ve=be.indices,Pe=Fe.size(ve),Me=0;Me<Pe;){Z.clear();var Ge=xe[Fe.getAt(ve,Me)],$e=ie[Ge];for(Z.add(_e.value(Ge)),Me++;Me<Pe;){var Ze=xe[Fe.getAt(ve,Me)];if(ie[Ze]!==$e)break;Z.add(_e.value(Ze)),Me++}for(var ht=Z.has(""),Ue=O[$e],rt=O[$e+1];Ue<rt;Ue++){var ut=Fe.indexOf(xe,Ue);if(ut>=0){var Ee=_e.value(Ue);(!ee||ht||!Ee||Z.has(Ee))&&(V[V.length]=ut)}}}Y[Y.length]={unit:be.unit,indices:it.ofSortedArray(V)}}else Y[Y.length]=be}return e(z.structure,Y)}e.extendToWholeResidues=b;function S(z){switch(z.kind){case 0:return z.model.atomicHierarchy.chainAtomSegments;case 1:return z.model.coarseHierarchy.spheres.chainElementSegments;case 2:return z.model.coarseHierarchy.gaussians.chainElementSegments}}function x(z){return z.unit.elements.length===Fe.size(z.indices)}function C(z){return z.length>12&&z[z.length-1]-z[0]===z.length-1?Re.ofRange(z[0],z[z.length-1]):it.ofSortedArray(z)}function w(z,ee,Y){for(var Z=S(z).index,te=z.elements,ce=0,be=0,xe=te.length;be<xe;be++){var Ie=te[be],_e=Z[Ie];ee.has(_e)&&ce++}if(ce===z.elements.length){Y[Y.length]={unit:z,indices:Re.ofBounds(0,ce)};return}var ae=new Int32Array(ce);ce=0;for(var be=0,xe=te.length;be<xe;be++){var Ie=te[be],_e=Z[Ie];ee.has(_e)&&(ae[ce++]=be)}ae.length>0&&(Y[Y.length]={unit:z,indices:C(ae)})}function A(z,ee,Y,Z,te){for(var ce=S(z.elements[0].unit).index,be=new Set,xe=ee;xe<Y;xe++)for(var Ie=z.elements[xe],_e=Ie.indices,ae=Ie.unit.elements,ie=0,O=Fe.size(_e);ie<O;ie++)be.add(ce[ae[Fe.getAt(_e,ie)]]);if(Z)for(var V=z.elements[0].unit,ve=0,Pe=z.structure.units;ve<Pe.length;ve++){var Me=Pe[ve];We.areSameChainOperatorGroup(Me,V)&&w(Me,be,te)}else for(var xe=ee;xe<Y;xe++)w(z.elements[xe].unit,be,te)}function I(z){for(var ee=[],Y=0,Z=z.elements.length;Y<Z;Y++){var te=z.elements[Y];if(We.Traits.is(te.unit.traits,2)){for(var ce=Y;Y<Z&&We.areSameChainOperatorGroup(z.elements[Y].unit,te.unit);)Y++;var be=Y;Y--,A(z,ce,be,!0,ee)}else x(te)?ee[ee.length]=te:A(z,Y,Y+1,!1,ee)}return e(z.structure,ee)}e.extendToWholeChains=I;function D(z){return z.unit.model.id+"|"+pt.entity.id(z)}function k(z){for(var ee=[],Y=at.create(z.structure),Z=new Set,te=z.structure.units,ce=0,be=z.elements.length;ce<be;ce++){var xe=z.elements[ce];Y.unit=xe.unit,Y.element=xe.unit.elements[0],Z.add(D(Y))}for(var ce=0,Ie=te.length;ce<Ie;++ce){var _e=te[ce];if(Y.unit=_e,Y.element=_e.elements[0],Z.has(D(Y))){var ae=Fe.ofBounds(0,_e.elements.length);ee[ee.length]={unit:_e,indices:ae}}}return e(z.structure,ee)}e.extendToWholeEntities=k;function R(z){for(var ee=[],Y=new Set,Z=z.structure.units,te=0,ce=z.elements.length;te<ce;te++){var be=z.elements[te];Y.add(be.unit.model.id)}for(var te=0,xe=Z.length;te<xe;++te){var Ie=Z[te];if(Y.has(Ie.model.id)){var _e=Fe.ofBounds(0,Ie.elements.length);ee[ee.length]={unit:Ie,indices:_e}}}return e(z.structure,ee)}e.extendToWholeModels=R;function L(z,ee){for(var Y=[],Z=0,te=Fe.size(ee);Z<te;++Z)Y.push(z[Fe.getAt(ee,Z)]);return it.ofSortedArray(Y)}function H(z,ee){return it.indicesOf(z,ee)}function B(z){for(var ee=[],Y=new Map,Z=0,te=z.elements.length;Z<te;Z++){var ce=z.elements[Z],be=ce.unit.model,xe=L(ce.unit.elements,ce.indices);Y.has(be)?Y.set(be,it.union(xe,Y.get(be))):Y.set(be,xe)}for(var Z=0,Ie=z.structure.units.length;Z<Ie;++Z){var _e=z.structure.units[Z],xe=Y.get(_e.model);if(xe){var ae=H(_e.elements,xe);ee[ee.length]={unit:_e,indices:ae}}}return e(z.structure,ee)}e.extendToAllInstances=B;function j(z){for(var ee=[],Y=new Set,Z=z.structure.units,te=0,ce=z.elements.length;te<ce;te++){var be=z.elements[te];Y.add(be.unit.conformation.operator.name)}for(var te=0,xe=Z.length;te<xe;++te){var Ie=Z[te];if(Y.has(Ie.conformation.operator.name)){var _e=Fe.ofBounds(0,Ie.elements.length);ee[ee.length]={unit:Ie,indices:_e}}}return e(z.structure,ee)}e.extendToWholeOperators=j;var Q=new ls("98"),G=_();function W(z,ee){Q.reset();for(var Y=0,Z=z.elements;Y<Z.length;Y++)for(var te=Z[Y],ce=te.indices,be=te.unit.conformation.position,xe=te.unit.conformation.r,Ie=te.unit.elements,_e=0,ae=Fe.size(ce);_e<ae;_e++){var ie=Ie[Fe.getAt(ce,_e)];be(ie,G),ee&&_.transformMat4(G,G,ee),Q.includePositionRadius(G,xe(ie))}Q.finishedIncludeStep();for(var O=0,V=z.elements;O<V.length;O++)for(var te=V[O],ce=te.indices,be=te.unit.conformation.position,xe=te.unit.conformation.r,Ie=te.unit.elements,_e=0,ae=Fe.size(ce);_e<ae;_e++){var ie=Ie[Fe.getAt(ce,_e)];be(ie,G),ee&&_.transformMat4(G,G,ee),Q.radiusPositionRadius(G,xe(ie))}return{box:Q.getBox(),sphere:Q.getSphere()}}e.getBoundary=W;var q=_();function J(z,ee,Y){Y===void 0&&(Y=0);for(var Z=Y,te=0,ce=z.elements;te<ce.length;te++){for(var be=ce[te],xe=be.indices,Ie=be.unit.conformation.position,_e=be.unit.elements,ae=Fe.size(xe),ie=0;ie<ae;ie++){var O=_e[Fe.getAt(xe,ie)];Ie(O,q),_.toArray(q,ee,Z+ie*3)}Z+=ae*3}return ee}e.toPositionsArray=J;function he(z){var ee=i(z),Y=J(z,new Float32Array(3*ee));return Wp.ofPositions(Y)}e.getPrincipalAxes=he;function $(z,ee){return We.isAtomic(z)?z.model.atomicHierarchy.atomSourceIndex.value(ee):ee}function X(z){var ee;if(e.isEmpty(z))return ue.struct.generator.empty();for(var Y=z.structure.models,Z=new Map,te=0,ce=z.elements;te<ce.length;te++){var be=ce[te],xe=be.indices,Ie=be.unit.elements,_e=be.unit.conformation.operator.name,ae=void 0;Z.has(_e)?ae=Z.get(_e).xs:(ae=Jr.create(),Z.set(_e,{modelLabel:be.unit.model.label,modelIndex:be.unit.model.modelNum,xs:ae}));for(var ie=0,O=Fe.size(xe);ie<O;ie++){var V=$(be.unit,Ie[Fe.getAt(xe,ie)]);Jr.add(ae,V,V)}}for(var ve=[],Pe=Z.keys();;){var Me=Pe.next();if(Me.done)break;var be=Z.get(Me.value);ve.push(U(Me.value,be.xs.array,Y.length>1,be.modelLabel,be.modelIndex))}for(var Ge=new Map,ie=0,$e=ve.length;ie<$e;++ie){var Ze=ve[ie],ht=cv(Ui(Ze.atom.ranges),Ui(Ze.atom.set)),_e=ht+"|"+(Ze.entity?Ze.entity.modelLabel+Ze.entity.modelIndex:"");Ge.has(_e)?(ee=Ge.get(_e).chain.opName).push.apply(ee,Ze.chain.opName):Ge.set(_e,Ze)}var Ue=[];return Ge.forEach(function(rt){var ut=rt.atom,Ee=ut.ranges,Te=ut.set,ye=rt.chain.opName,Se=ue.struct.atomProperty.core.operatorName(),Le=ue.struct.atomProperty.core.sourceIndex(),Ve=[];Te.length>0&&(Ve[Ve.length]=ue.core.set.has([ue.core.type.set(Te),Le]));for(var nt=0,Xe=Ee.length/2;nt<Xe;nt++)Ve[Ve.length]=ue.core.rel.inRange([Le,Ee[2*nt],Ee[2*nt+1]]);if(rt.entity){var He=rt.entity,se=He.modelLabel,pe=He.modelIndex;Ue.push(ue.struct.generator.atomGroups({"atom-test":Ve.length>1?ue.core.logic.or(Ve):Ve[0],"chain-test":ye.length>1?ue.core.set.has([ue.core.type.set(ye),Se]):ue.core.rel.eq([Se,ye[0]]),"entity-test":ue.core.logic.and([ue.core.rel.eq([ue.struct.atomProperty.core.modelLabel(),se]),ue.core.rel.eq([ue.struct.atomProperty.core.modelIndex(),pe])])}))}else Ue.push(ue.struct.generator.atomGroups({"atom-test":Ve.length>1?ue.core.logic.or(Ve):Ve[0],"chain-test":ye.length>1?ue.core.set.has([ue.core.type.set(ye),Se]):ue.core.rel.eq([Se,ye[0]])}))}),ue.struct.modifier.union([Ue.length===1?Ue[0]:ue.struct.combinator.merge(Ue.map(function(rt){return ue.struct.modifier.union([rt])}))])}e.toExpression=X;function U(z,ee,Y,Z,te){Pu(ee);for(var ce=[],be=[],xe=0,Ie=ee.length;xe<Ie;){var _e=xe;for(xe++;xe<Ie&&ee[xe-1]+1===ee[xe];)xe++;var ae=xe;if(ae-_e>12)ce[ce.length]=ee[_e],ce[ce.length]=ee[ae-1];else for(var ie=_e;ie<ae;ie++)be[be.length]=ee[ie]}return Y?{atom:{set:be,ranges:ce},chain:{opName:[z]},entity:{modelLabel:Z,modelIndex:te}}:{atom:{set:be,ranges:ce},chain:{opName:[z]}}}})(Oe||(Oe={}));var Ef;(function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:at.create(void 0),firstConformationLoc:at.create(void 0),firstResidueLoc:at.create(void 0),firstChainLoc:at.create(void 0),firstUnitLoc:at.create(void 0),firstStructureLoc:at.create(void 0)}}e.create=t;function r(u,l,c){var d=u.get(l)||0;u.set(l,d+c)}function n(u,l,c){var d=c.indices,f=c.unit,h=f.elements,v=Fe.size(d),p=new Map,g=new Map;if(v>0&&at.set(u.firstElementLoc,l,f,h[Fe.start(d)]),v===h.length)u.unitCount+=1,u.unitCount===1&&at.set(u.firstUnitLoc,l,f,h[Fe.start(d)]);else if(v===1){if(We.Traits.is(f.traits,1))return;u.elementCount+=1,u.elementCount===1&&at.set(u.firstElementLoc,l,f,h[Fe.start(d)])}else if(We.isAtomic(f))for(var m=f.model.atomicHierarchy.residueAtomSegments,y=m.index,b=m.offsets,S=f.model.atomicHierarchy.atoms.label_alt_id,x=0,C=function(){p.clear();var w=0,A=h[Fe.getAt(d,x)],I=y[A];for(r(p,S.value(A),1),++x,++w;x<v;){var D=h[Fe.getAt(d,x)];if(y[D]!==I)break;r(p,S.value(D),1),++x,++w}if(b[I+1]-b[I]===w)u.residueCount+=1,u.residueCount===1&&at.set(u.firstResidueLoc,l,f,b[I]);else{g.clear();for(var k=b[I],R=b[I+1];k<R;++k)r(g,S.value(k),1);g.get("")===p.get("")&&p.forEach(function(L,H){if(g.get(H)===L){if(H!==""&&(u.conformationCount+=1,u.conformationCount===1)){for(var B=b[I],j=b[I+1];B<j;++B)if(H===S.value(B)){at.set(u.firstConformationLoc,l,f,B);break}}w-=L}}),u.elementCount+=w}};x<v;)C();else u.elementCount+=v,u.elementCount===1&&at.set(u.firstElementLoc,l,f,h[Fe.start(d)])}function a(u,l,c){var d=c.indices,f=c.unit,h=Fe.size(d);if(h!==0){var v=f.elements;if(!We.Traits.is(f.traits,1)){h===v.length&&(u.chainCount+=1,u.chainCount===1&&at.set(u.firstChainLoc,l,f,v[Fe.start(d)]));return}var p=We.isAtomic(f)?f.model.atomicHierarchy.chainAtomSegments:We.isSpheres(f)?f.model.coarseHierarchy.spheres.chainElementSegments:We.isGaussians(f)?f.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!p){console.warn("StructureElement loci stats: unknown unit type");return}for(var g=p.index,m=p.offsets,y=0;y<h;){var b=0,S=v[Fe.getAt(d,y)],x=g[S];for(++y,++b;y<h;){var C=v[Fe.getAt(d,y)];if(g[C]!==x)break;++y,++b}m[x+1]-m[x]===b&&(u.chainCount+=1,u.chainCount===1&&at.set(u.firstChainLoc,l,f,m[x]))}}}function i(u,l,c,d,f){var h=c[d],v=We.isAtomic(h.unit)?h.unit.model.atomicHierarchy.chainAtomSegments:We.isSpheres(h.unit)?h.unit.model.coarseHierarchy.spheres.chainElementSegments:We.isGaussians(h.unit)?h.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!v){console.warn("StructureElement loci stats: unknown unit type");return}for(var p=v.index,g=v.offsets,m=new Map,y=d;y<f;y++){h=c[y];var b=h.indices,S=h.unit,x=Fe.size(b);if(x!==0){var C=S.elements;if(!We.Traits.is(S.traits,1)){var w=C[Fe.start(b)];r(m,p[w],C.length);continue}for(var A=0;A<x;){var I=0,w=C[Fe.getAt(b,A)],D=p[w];for(++A,++I;A<x;){var k=C[Fe.getAt(b,A)];if(p[k]!==D)break;++A,++I}r(m,D,I)}}}var R=-1;if(m.forEach(function(L,H){g[H+1]-g[H]===L&&(u.chainCount+=1,u.chainCount===1&&(R=H))}),!(R<0))for(var y=d;y<f;y++){h=c[y];var b=h.indices,S=h.unit,x=Fe.size(b);if(x!==0)for(var C=S.elements,A=0;A<x;){var w=C[Fe.getAt(b,A)],D=p[w];if(D===R){at.set(u.firstChainLoc,l,S,w);return}}}}function o(u){var l=t();if(Oe.isEmpty(u))return l;var c=!1;if(Oe.isWholeStructure(u)){if(l.structureCount+=1,l.structureCount===1){var d=u.elements[0],f=d.unit,h=d.indices;at.set(l.firstStructureLoc,u.structure,f,f.elements[Fe.min(h)])}}else for(var v=0,p=u.elements;v<p.length;v++){var g=p[v];n(l,u.structure,g),We.Traits.is(g.unit.traits,2)?c=!0:a(l,u.structure,g)}if(c)for(var m=0,y=u.elements.length;m<y;m++){var g=u.elements[m];if(We.Traits.is(g.unit.traits,2)){for(var b=m;m<y&&We.areSameChainOperatorGroup(u.elements[m].unit,g.unit);)m++;var S=m;m--,S-b===1?a(l,u.structure,g):i(l,u.structure,u.elements,b,S)}}return l}e.ofLoci=o;function s(u,l,c){return l.elementCount===1&&c.elementCount===0?at.copy(u.firstElementLoc,l.firstElementLoc):l.elementCount===0&&c.elementCount===1&&at.copy(u.firstElementLoc,c.firstElementLoc),l.conformationCount===1&&c.conformationCount===0?at.copy(u.firstConformationLoc,l.firstConformationLoc):l.conformationCount===0&&c.conformationCount===1&&at.copy(u.firstConformationLoc,c.firstConformationLoc),l.residueCount===1&&c.residueCount===0?at.copy(u.firstResidueLoc,l.firstResidueLoc):l.residueCount===0&&c.residueCount===1&&at.copy(u.firstResidueLoc,c.firstResidueLoc),l.chainCount===1&&c.chainCount===0?at.copy(u.firstChainLoc,l.firstChainLoc):l.chainCount===0&&c.chainCount===1&&at.copy(u.firstChainLoc,c.firstChainLoc),l.unitCount===1&&c.unitCount===0?at.copy(u.firstUnitLoc,l.firstUnitLoc):l.unitCount===0&&c.unitCount===1&&at.copy(u.firstUnitLoc,c.firstUnitLoc),l.structureCount===1&&c.structureCount===0?at.copy(u.firstStructureLoc,l.firstStructureLoc):l.structureCount===0&&c.structureCount===1&&at.copy(u.firstStructureLoc,c.firstStructureLoc),u.elementCount=l.elementCount+c.elementCount,u.conformationCount=l.conformationCount+c.conformationCount,u.residueCount=l.residueCount+c.residueCount,u.chainCount=l.chainCount+c.chainCount,u.unitCount=l.unitCount+c.unitCount,u.structureCount=l.structureCount+c.structureCount,u}e.add=s})(Ef||(Ef={}));function N5e(e){return We.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function F5e(e){return We.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function B5e(e){return pt.entity.key(e)}Fa.Field;Fa.Encodings;Fa.Field;Fa.Category;Fa.Category;Fa.Category;var V7;(function(e){function t(r){var n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}e.create=t})(V7||(V7={}));var H7;(function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])})(H7||(H7={}));var U5e={molstar_atom_site_operator_mapping:{label_asym_id:me.Schema.Str(),auth_asym_id:me.Schema.Str(),operator_name:me.Schema.Str(),suffix:me.Schema.Str(),assembly_id:me.Schema.Str(),assembly_operator_id:me.Schema.Int(),symmetry_operator_index:me.Schema.Int(),symmetry_hkl:me.Schema.Vector(3),ncs_id:me.Schema.Int()}},G7=function(e,t){return typeof t[e].operator.assembly>"u"?1:0},xP=function(e,t){return t[e].operator.spgrOp===-1?1:0};Fa.fields().str("label_asym_id",function(e,t){return t[e].label_asym_id}).str("auth_asym_id",function(e,t){return t[e].auth_asym_id}).str("operator_name",function(e,t){return t[e].operator.name}).str("suffix",function(e,t){return t[e].operator.suffix}).str("assembly_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.id)||""},{valueKind:G7}).int("assembly_operator_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.operId)||0},{valueKind:G7}).int("symmetry_operator_index",function(e,t){return t[e].operator.spgrOp},{valueKind:xP}).vec("symmetry_hkl",[function(e,t){return t[e].operator.hkl[0]},function(e,t){return t[e].operator.hkl[1]},function(e,t){return t[e].operator.hkl[2]}],{valueKind:xP}).int("ncs_id",function(e,t){return t[e].operator.ncsId},{valueKind:xP}).getFields();function j5e(e){if(e._rowCount===0)return{residues:[],chains:[]};for(var t=0,r=e._rowCount,n=[t],a=[t],i=e.label_entity_id,o=e.label_asym_id,s=e.label_seq_id,u=e.auth_seq_id,l=e.pdbx_PDB_ins_code,c=t+1;c<r;c++){var d=!i.areValuesEqual(c-1,c)||!o.areValuesEqual(c-1,c),f=d||!s.areValuesEqual(c-1,c)||!u.areValuesEqual(c-1,c)||!l.areValuesEqual(c-1,c);f&&(n[n.length]=c),d&&(a[a.length]=c)}return{residues:n,chains:a}}function K2(e,t,r){e[t].isDefined||(e[t]=e[r]),e[r].isDefined||(e[r]=e[t])}function z5e(e,t,r){var n=Yr.ofColumns(GAe,{type_symbol:me.ofArray({array:me.mapToArray(e.type_symbol,Qg),schema:me.Schema.Aliased(me.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),a=Yr.view(e,qAe,r.residues),i=Yr.view(e,WAe,r.chains);if(!a.label_seq_id.isDefined){for(var o=new Int32Array(a.label_seq_id.rowCount),s=r.residues,u=r.chains,l=0,c=0,d=0,f=o.length;d<f;++d)s[d]>=u[l+1]&&(l+=1,c=0),o[d]=++c;a.label_seq_id=me.ofIntArray(o)}return Yr.columnToArray(a,"label_seq_id",Int32Array),Yr.columnToArray(a,"auth_seq_id",Int32Array),K2(n,"label_atom_id","auth_atom_id"),K2(n,"label_comp_id","auth_comp_id"),K2(a,"label_seq_id","auth_seq_id"),K2(i,"label_asym_id","auth_asym_id"),{atoms:n,residues:a,chains:i,atomSourceIndex:t}}function V5e(e){return{id:pn.create22(),atomId:e.id,occupancy:e.occupancy,B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function H5e(e,t){return Yr.areEqual(e.chains,t.chains)&&Yr.areEqual(e.residues,t.residues)&&Yr.areEqual(e.atoms,t.atoms)}function G5e(e,t){var r=new Map;if(!nn.is(t))return r;var n=uc(U5e,t.data.frame).molstar_atom_site_operator_mapping;if(n._rowCount===0)return r;for(var a=new Map,i=new Map,o=0;o<n._rowCount;o++){var s=n.assembly_operator_id.valueKind(o)===0?{id:n.assembly_id.value(o),operList:[],operId:n.assembly_operator_id.value(o)}:void 0,u=gn.create(n.operator_name.value(o),le.identity(),{assembly:s,spgrOp:n.symmetry_operator_index.valueKind(o)===0?n.symmetry_operator_index.value(o):void 0,hkl:_.ofArray(n.symmetry_hkl.value(o)),ncsId:n.ncs_id.value(o)}),l=n.suffix.value(o),c=n.label_asym_id.value(o);a.set(""+c+l,{name:c,operator:u});var d=n.auth_asym_id.value(o);i.set(""+d+l,d)}for(var f=e.chains,h=f.label_asym_id,v=f.auth_asym_id,p=new Array(h.rowCount),g=new Array(h.rowCount),o=0;o<h.rowCount;o++){var c=h.value(o),d=v.value(o);if(!a.has(c)){p[o]=c,g[o]=d;continue}var m=a.get(c),y=m.name,u=m.operator;r.set(o,u),p[o]=y,g[o]=i.get(d)||d}return e.chains.label_asym_id=me.ofArray({array:p,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=me.ofArray({array:g,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function q5e(e,t,r,n,a,i){var o=j5e(e),s=z5e(e,t,o),u=G5e(s,a);if(i&&H5e(i.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:i.atomicHierarchy,chainOperatorMapping:u};var l={residueAtomSegments:ar.ofOffsets(o.residues,Re.ofBounds(0,e._rowCount)),chainAtomSegments:ar.ofOffsets(o.chains,Re.ofBounds(0,e._rowCount))},c=aPe(s,r,l),d=TPe(s,l,c,n),f=E(E(E({},s),l),{index:c,derived:d});return{sameAsPrevious:!1,hierarchy:f,chainOperatorMapping:u}}function wK(e,t,r,n,a,i){var o=q5e(e,t,r,n,a,i),s=o.sameAsPrevious,u=o.hierarchy,l=o.chainOperatorMapping,c=V5e(e);return{sameAsPrevious:s,hierarchy:u,conformation:c,chainOperatorMapping:l}}var UM;(function(e){e.Empty={isDefined:!1}})(UM||(UM={}));function W5e(e,t,r){if(e.has(t))return e.get(t);var n=r.index++;return e.set(t,n),n}function $5e(e,t){if(e.has(t))return e.get(t);var r=new Map;return e.set(t,r),r}function X5e(e,t,r){var n=e.getEntityIndex,a=function(o,s){var u=n(o);if(u<0)return-1;var l=t.get(u);return l.has(s)?l.get(s):-1},i=function(o,s,u){var l=n(o);if(l<0)return-1;var c=t.get(l);if(c===void 0)return-1;var d=c.get(s);if(d===void 0)return-1;var f=r.get(d),h=f.elementIndices,v=f.seqRanges,p=Zr.firstIntersectionIndex(v,Fe.ofSingleton(u));return p!==-1?h[p]:-1};return{findChainKey:a,findSequenceKey:i}}function Y5e(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function q7(e,t){for(var r=e.entity_id,n=e.asym_id,a=e.seq_id_begin,i=e.seq_id_end,o=e.count,s=e.chainElementSegments,u=new Map,l=new Map,c={index:0},d=new Int32Array(o),f=new Int32Array(o),h=new Int32Array(s.count),v=0;v<o;v++)f[v]=t.getEntityIndex(r.value(v)),f[v]<0&&Y5e(r.value(v));for(var p=0;p<s.count;p++){var g=s.offsets[p],m=s.offsets[p+1],y=f[g];h[p]=y;for(var b=$5e(l,y),S=W5e(b,n.value(g),c),v=g;v<m;v++)d[v]=S;for(var x=[],C=[],v=g;v<m;v++){var w=a.value(v),A=i.value(v);x.push(v),C.push(w,A)}var I={elementIndices:x,seqRanges:Zr.ofSortedRanges(C)};u.set(S,I)}var D=X5e(t,l,u),k=D.findChainKey,R=D.findSequenceKey,L=function(H){return h[H]};return{chainKey:d,entityKey:f,findSequenceKey:R,findChainKey:k,getEntityFromChain:L}}function W7(e,t){for(var r=[],n=[],a=ar.transientSegments(e.chainElementSegments,Re.ofBounds(0,e.count)),i=e.seq_id_begin,o=e.seq_id_end;a.hasNext;)for(var s=a.move(),u=s.start,l=s.end,c=-1,d=-1,f=u;f<l;++f){var h=o.value(f);f===u?(c=f,d=o.value(f)):i.value(f)-d>1&&(r.push(c,f-1),n.push(f-1,f),c=f),f===l-1&&r.push(c,f),d=h}return{polymerRanges:Zr.ofSortedRanges(r),gapRanges:Zr.ofSortedRanges(n)}}mr.atom_site.label_comp_id,mr.atom_site.label_seq_id,mr.atom_site.pdbx_PDB_ins_code,mr.atom_site.label_asym_id,mr.atom_site.label_entity_id,mr.atom_site.auth_atom_id,mr.atom_site.auth_seq_id,mr.atom_site.auth_asym_id;E(E({},mr.chem_comp_bond),{molstar_protonation_variant:me.Schema.Str()});var K5e=E(E({},mr.chem_comp),{type:me.Schema.Aliased(me.Schema.str)}),Ji={entry:mr.entry,struct:mr.struct,struct_asym:mr.struct_asym,ihm_model_list:mr.ihm_model_list,ihm_model_group:mr.ihm_model_group,ihm_model_group_link:mr.ihm_model_group_link,entity:mr.entity,entity_poly:mr.entity_poly,entity_poly_seq:mr.entity_poly_seq,pdbx_entity_branch:mr.pdbx_entity_branch,chem_comp:K5e,pdbx_chem_comp_identifier:mr.pdbx_chem_comp_identifier,atom_site:mr.atom_site,ihm_sphere_obj_site:mr.ihm_sphere_obj_site,ihm_gaussian_obj_site:mr.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:mr.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:mr.pdbx_molecule};function vv(e){for(var t=Object.create(null),r=0,n=Object.keys(Ji);r<n.length;r++){var a=n[r];a in e?t[a]=e[a]:t[a]=Yr.ofUndefinedColumns(Ji[a],0)}return t}var EK={hierarchy:UM.Empty,conformation:void 0};function Q5e(e,t){var r=e.ihm_sphere_obj_site,n=e.ihm_gaussian_obj_site;if(r._rowCount===0&&n._rowCount===0)return EK;var a=$7(r),i=Z5e(r),o=q7(a,e.entities),s=W7(a,t.chemicalComponentMap),u=$7(n),l=J5e(n),c=q7(u,e.entities),d=W7(u,t.chemicalComponentMap);return{hierarchy:{isDefined:!0,spheres:E(E(E({},a),o),s),gaussians:E(E(E({},u),c),d)},conformation:{id:pn.create22(),spheres:i,gaussians:l}}}function Z5e(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function J5e(e){for(var t=Ji.ihm_gaussian_obj_site.covariance_matrix.space,r=[],n=e.covariance_matrix,a=0,i=n.rowCount;a<i;a++)r[a]=Pr.toMat3(qn(),t,n.value(a));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function eRe(e,t,r){for(var n=[0],a=1,i=e.rowCount;a<i;a++){var o=!e.areValuesEqual(a-1,a);o&&(n[n.length]=a)}return{chainElementSegments:ar.ofOffsets(n,Re.ofBounds(0,e.rowCount))}}function $7(e){var t=e.entity_id,r=e.seq_id_begin,n=e.seq_id_end,a=e.asym_id;return E({count:t.rowCount,entity_id:t,asym_id:a,seq_id_begin:r,seq_id_end:n},eRe(a))}var tRe={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},rRe={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},nRe={A:"A",C:"C",G:"G",T:"T",U:"U"};function X7(e){var t=tRe[e];return t||"X"}function Y7(e){var t=nRe[e];return t||"X"}function K7(e){var t=rRe[e];return t||"X"}var nb;(function(e){function t(u){var l=u.code.toArray();return(l instanceof Array?l:Array.from(l)).join("")}e.getSequenceString=t;function r(u){for(var l=0,c=Math.min(u.rowCount,10);l<c;l++){var d=u.value(l)||"";if(X7(d)!=="X")return"protein";if(Y7(d)!=="X")return"RNA";if(K7(d)!=="X")return"DNA"}return"generic"}function n(u,l){var c;switch(u){case"protein":c=X7;break;case"DNA":c=K7;break;case"RNA":c=Y7;break;case"generic":c=function(){return"X"};break;default:throw new Error("unknown kind '"+u+"'")}return l&&l.size>0?function(d){var f=c(d);return f!=="X"||!l.has(d)?f:c(l.get(d))}:c}function a(u,l){if(l.rowCount===0)throw new Error("cannot be empty");var c=r(u);return new i(c,u,l)}e.ofResidueNames=a;var i=function(){function u(l,c,d){this.kind=l,this.microHet=new Map;for(var f=n(l),h=[],v=[],p=[],g=new Map,m=0,y=new Map,b=0,S=d.rowCount;b<S;++b){var x=d.value(b);if(y.has(x))g.has(x)?g.get(x).push(c.value(b)):g.set(x,[v[y.get(x)],c.value(b)]);else{y.set(x,m);var C=c.value(b);v[m]=C,p[m]=x,h[m]=f(C),m+=1}}for(var w=[],b=0,S=m;b<S;++b){var A=g.get(p[b]);if(A){var I=A.map(function(R){var L=f(R);return L==="X"?R:L});w[b]="("+I.join("|")+")"}else w[b]=h[b]==="X"?v[b]:h[b]}this.length=m,this.code=me.ofStringArray(h),this.compId=me.ofStringArray(v),this.seqId=me.ofIntArray(p),this.label=me.ofStringArray(w),this.microHet=g,this.indexMap=y}return u.prototype.index=function(l){return this.indexMap.get(l)},u}();function o(u,l){var c="generic";return new s(c,u,l)}e.ofSequenceRanges=o;var s=function(){function u(l,c,d){this.kind=l,this.seqIdStart=c,this.seqIdEnd=d,this.microHet=new Map;for(var f=0,h=Number.MAX_SAFE_INTEGER,v=0,p=this.seqIdStart.rowCount;v<p;v++){var g=this.seqIdStart.value(v),m=this.seqIdEnd.value(v);g<h&&(h=g),f<m&&(f=m)}var y=f-h+1;this.code=me.ofConst("X",y,me.Schema.str),this.label=me.ofConst("",y,me.Schema.str),this.seqId=me.ofLambda({value:function(b){return b+h+1},rowCount:y,schema:me.Schema.int}),this.compId=me.ofConst("",y,me.Schema.str),this.length=y,this.minSeqId=h}return u.prototype.index=function(l){return l-this.minSeqId},u}()})(nb||(nb={}));var jM;(function(e){var t={byEntityKey:{},sequences:[]};function r(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];for(var l=[],c={},d=0,f=s.length;d<f;++d)l.push.apply(l,s[d].sequences),Object.assign(c,s[d].byEntityKey);return{sequences:l,byEntityKey:c}}function n(s,u,l){var c=a(s,u),d=l.isDefined?i(s,l):t;return r(c,d)}e.fromHierarchy=n;function a(s,u){var l=u.atoms.label_comp_id,c=u.residues.label_seq_id,d=u.chainAtomSegments,f=u.residueAtomSegments,h=d.count,v=d.offsets,p={},g=[];if(h===1&&v[0]===0&&v[1]===0)return{byEntityKey:p,sequences:g};for(var m=0,y=u.chains._rowCount;m<y;m++){var b=u.index.getEntityFromChain(m);if(!(p[b]!==void 0||s.data.type.value(b)!=="polymer")){var S=m;for(m++;m<y&&b===u.index.getEntityFromChain(m)&&s.data.type.value(b)!=="polymer";)m++;m--;for(var x=f.index[v[S]],C=f.index[v[m+1]-1]+1,w=me.window(c,x,C),A=[],I=x;I<C;++I)A.push(l.value(f.offsets[I]));var D=me.ofStringArray(A);p[b]={entityId:s.data.id.value(b),sequence:nb.ofResidueNames(D,w)},g.push(p[b])}}return{byEntityKey:p,sequences:g}}e.fromAtomicHierarchy=a;function i(s,u){var l=o(s,u.spheres),c=o(s,u.gaussians);return r(l,c)}e.fromCoarseHierarchy=i;function o(s,u){var l=u.chainElementSegments,c=u.seq_id_begin,d=u.seq_id_end,f=l.count,h=l.offsets,v={},p=[];if(f===1&&h[0]===0&&h[1]===0)return{byEntityKey:v,sequences:p};for(var g=0,m=f;g<m;g++){var y=u.getEntityFromChain(g);if(v[y]===void 0){var b=g;for(g++;g<m&&y===u.getEntityFromChain(g);)g++;g--;var S=h[b],x=h[g+1]-1,C=me.window(c,S,x),w=me.window(d,S,x);v[y]={entityId:s.data.id.value(y),sequence:nb.ofSequenceRanges(C,w)},p.push(v[y])}}return{byEntityKey:v,sequences:p}}e.fromCoarseElements=o})(jM||(jM={}));function AK(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return jM.fromHierarchy(t,r,n);for(var a=e.entity_poly_seq,i=a.entity_id,o=a.num,s=a.mon_id,u={},l=[],c=i.rowCount,d=0;d<c;){for(var f=d;d<c-1&&i.areValuesEqual(d,d+1);)d++;d++;var h=i.value(f),v=me.window(s,f,d),p=me.window(o,f,d),g=t.getEntityIndex(h);u[g]={entityId:h,sequence:nb.ofResidueNames(v,p)},l.push(u[g])}return{byEntityKey:u,sequences:l}}function PK(e,t,r,n){return de(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:return a=$I(r,n-1),i=t.label_entity_id,o=t.label_asym_id,s=t.label_seq_id,u=XA(a,i.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:p.sent(),p.label=2;case 2:l=0,c=u.length-1,p.label=3;case 3:if(!(l<c))return[3,10];d=XA(a,o.value,{start:u[l],end:u[l+1]}),f=0,h=d.length-1,p.label=4;case 4:return f<h?(v=d[f],s.valueKind(v)!==0?[3,6]:(XA(a,s.value,{sort:!0,start:v,end:d[f+1]}),e.shouldUpdate?[4,e.update()]:[3,6])):[3,7];case 5:p.sent(),p.label=6;case 6:return f++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:p.sent(),p.label=9;case 9:return l++,[3,3];case 10:return eEe(a)&&a.length===t._rowCount?[2,{atom_site:t,sourceIndex:me.ofIntArray(a)}]:[2,{atom_site:Yr.view(t,t._schema,a),sourceIndex:me.ofIntArray(a)}]}})})}function Q7(e,t,r,n,a){var i=a.residue,o=i.polymerType,s=i.traceElementIndex,u=i.directionFromElementIndex,l=i.directionToElementIndex,c=o[e],d=o[t];if(c===0||d===0||s[e]===-1||s[t]===-1)return!1;var f=n.findAtomsOnResidue(e,wf(c,"backboneStart")),h=n.findAtomsOnResidue(t,wf(d,"backboneEnd"));(f===-1||h===-1)&&(f=n.findAtomsOnResidue(e,wf(c,"coarseBackbone")),h=n.findAtomsOnResidue(t,wf(d,"coarseBackbone")));var v=r.x,p=r.y,g=r.z,m=_.create(v[f],p[f],g[f]),y=_.create(v[h],p[h],g[h]),b=u[e]===-1||l[e]===-1||u[t]===-1||l[t]===-1;return _.distance(m,y)<(b?10:3)}function TK(e,t,r,n){for(var a=[],i=[],o=new Map,s=ar.transientSegments(e.chainAtomSegments,Re.ofBounds(0,e.atoms._rowCount)),u=ar.transientSegments(e.residueAtomSegments,Re.ofBounds(0,e.atoms._rowCount)),l=e.index,c=e.derived,d=e.residues.label_seq_id,f=e.chains.label_entity_id,h=c.residue,v=h.moleculeType,p=h.traceElementIndex,g,m,y,b;s.hasNext;){var S=s.move();u.setSegment(S),g=-1,m=-1,y=-1,b=-1;var x=t.getEntityIndex(f.value(S.index)),C=n.byEntityKey[x],w=C?C.sequence.seqId.value(C.sequence.seqId.rowCount-1):-1,A=e.residueAtomSegments.index[S.start],I=e.residueAtomSegments.index[S.end-1],D=d.value(A),k=d.value(I);for(D===1&&k===w&&r.xyzDefined&&Q7(A,I,r,l,c)&&(o.set(A,I),o.set(I,A));u.hasNext;){var R=u.move(),L=R.index,H=d.value(L);if(Nk(v[L])&&p[L]!==-1)if(b!==-1)if(H!==g+1)a.push(b,y-1),i.push(m,R.end-1),b=R.start;else if(!u.hasNext)a.push(b,R.end-1);else{var B=e.residueAtomSegments.index[R.start],j=e.residueAtomSegments.index[y-1];r.xyzDefined&&!Q7(B,j,r,e.index,c)&&(a.push(b,y-1),i.push(m,R.end-1),b=R.start)}else b=R.start;else b!==-1&&(a.push(b,y-1),b=-1);m=R.start,y=R.end,g=H}}return{polymerRanges:Zr.ofSortedRanges(a),gapRanges:Zr.ofSortedRanges(i),cyclicPolymerMap:o}}function rh(e){var t=void 0,r=void 0;return function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];if(!t||t.length!==n.length)return t=n,r=e.apply(void 0,n),r;for(var i=0,o=n.length;i<o;i++)if(n[i]!==t[i])return t=n,r=e.apply(void 0,n),r;return r}}function T3(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var n=e(r);return t.set(r,n),n}}function aRe(e){for(var t=new Map,r=function(s,u,l){return s+"|"+u+"|"+l},n=e.pdbx_unobs_or_zero_occ_residues,a=0,i=n._rowCount;a<i;++a){var o=r(n.PDB_model_num.value(a),n.label_asym_id.value(a),n.label_seq_id.value(a));t.set(o,{polymer_flag:n.polymer_flag.value(a),occupancy_flag:n.occupancy_flag.value(a)})}return{has:function(s,u,l){return t.has(r(s,u,l))},get:function(s,u,l){return t.get(r(s,u,l))},size:t.size}}function iRe(e){var t=new Map;if(e.chem_comp._rowCount>0)for(var r=e.chem_comp.id,n=0,a=r.rowCount;n<a;++n)t.set(r.value(n),Yr.getRow(e.chem_comp,n));else{var i=IK(e);i.forEach(function(o){t.set(o,_Pe(o))})}return t}function oRe(e){var t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){for(var r=e.pdbx_chem_comp_identifier,n=r.comp_id,a=r.type,i=r.identifier,o=0,s=n.rowCount;o<s;++o)if(a.value(o)==="SNFG CARBOHYDRATE SYMBOL"||a.value(o)==="SNFG CARB SYMBOL"){var u=i.value(o),l=sPe.get(u);l?t.set(n.value(o),l):console.warn("Unknown SNFG name '"+u+"'")}}if(e.chem_comp._rowCount>0)for(var c=e.chem_comp,d=c.id,a=c.type,o=0,s=d.rowCount;o<s;++o){var f=d.value(o);if(!t.has(f)){var h=a.value(o);bp.has(f)?t.set(f,bp.get(f)):Zg(h,f)===9&&t.set(f,EY)}}else{var v=IK(e);bp.forEach(function(p,g){!t.has(g)&&v.has(g)&&t.set(g,p)})}return t}var IK=T3(function(e){for(var t=new Set,r=e.atom_site,n=r.label_comp_id,a=r.auth_comp_id,i=n.isDefined?n:a,o=0,s=i.rowCount;o<s;++o)t.add(i.value(o));return t});function sRe(e){for(var t=new Map,r=e.atom_site,n=r.label_asym_id,a=r.auth_asym_id,i=r.label_entity_id,o=0,s=n.rowCount;o<s;++o){var u=n.value(o);t.has(u)||t.set(u,{id:u,auth_id:a.value(o),entity_id:i.value(o)})}if(e.struct_asym._rowCount>0)for(var l=e.struct_asym,u=l.id,c=l.entity_id,o=0,s=u.rowCount;o<s;++o){var d=u.value(o);t.has(d)||t.set(d,{id:d,auth_id:"",entity_id:c.value(o)})}return t}function uRe(e){return{missingResidues:aRe(e),chemicalComponentMap:iRe(e),saccharideComponentMap:oRe(e),structAsymMap:sRe(e)}}var lRe=me.Schema.Aliased(me.Schema.Str(""));function MK(e,t){var r,n;if(e.entity.id.isDefined)n=e.entity;else{for(var a=new Set,i=[],o=[],s=e.atom_site,u=s.label_entity_id,l=s.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);a.has(f)||(i.push(f),o.push(wPe(l.value(c))),a.add(f))}for(var h=e.ihm_sphere_obj_site.entity_id,c=0,d=e.ihm_sphere_obj_site._rowCount;c<d;c++){var f=h.value(c);a.has(f)||(i.push(f),o.push("polymer"),a.add(f))}for(var v=e.ihm_gaussian_obj_site.entity_id,c=0,d=e.ihm_gaussian_obj_site._rowCount;c<d;c++){var f=v.value(c);a.has(f)||(i.push(f),o.push("polymer"),a.add(f))}n=Yr.ofPartialColumns(Ji.entity,{id:me.ofArray({array:i,schema:Ji.entity.id}),type:me.ofArray({array:o,schema:Ji.entity.type})},i.length)}var p=me.createIndexer(n.id),g=new Array(n._rowCount);g.fill("other");var m=new Set,y=!1;if(e.entity_poly&&e.entity_poly.type.isDefined)for(var b=e.entity_poly,S=b.entity_id,x=b.type,C=b._rowCount,c=0;c<C;++c){var f=S.value(c);g[p(f)]=x.value(c),m.add(f)}else y=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined)for(var w=e.pdbx_entity_branch,S=w.entity_id,x=w.type,C=w._rowCount,c=0;c<C;++c){var f=S.value(c);g[p(f)]=x.value(c),m.add(f)}else y=!0;if(m.size<g.length&&(y=!0),y){var A=new Map;if(e.chem_comp)for(var I=e.chem_comp,D=I.id,x=I.type,c=0,d=e.chem_comp._rowCount;c<d;c++)A.set(D.value(c),x.value(c));if(e.atom_site)for(var k=e.atom_site,u=k.label_entity_id,l=k.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);if(!m.has(f)){var R=l.value(c),L=A.get(R)||"";g[p(f)]=EPe(R,L),m.add(f)}}}var H=me.ofArray({array:g,schema:lRe}),B=new Array(n._rowCount);if(B.fill(""),e.pdbx_molecule&&e.pdbx_molecule.prd_id.isDefined)for(var j=e.pdbx_molecule,Q=j.asym_id,G=j.prd_id,C=j._rowCount,c=0;c<C;++c){var W=Q.value(c),f=(r=t.structAsymMap.get(W))===null||r===void 0?void 0:r.entity_id;f!==void 0&&(B[p(f)]=G.value(c))}var q=me.ofArray({array:B,schema:me.Schema.str});return{data:n,subtype:H,prd_id:q,getEntityIndex:p}}function cRe(e,t){var r=t.ihm_model_group,n=t.ihm_model_group_link,a=Yr.pickRow(n,function(o){return n.model_id.value(o)===e});if(a){var i=Yr.pickRow(r,function(o){return r.id.value(o)===a.group_id});if(i)return i.name}return""}var $p=function(){function e(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}return e.prototype.getFrameAtIndex=function(t){return this.frames[t]},e}();function fd(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o;return fe(this,function(s){switch(s.label){case 0:return n=uRe(e),e.ihm_model_list._rowCount>0?[4,pRe(r,e,n,t)]:[3,2];case 1:return i=s.sent(),[3,4];case 2:return[4,hRe(r,e,n,t)];case 3:i=s.sent(),s.label=4;case 4:for(a=i,o=0;o<a.length;o++)Xt.TrajectoryInfo.set(a[o],{index:o,size:a.length});return[2,new $p(a)]}})})}function dRe(e,t,r,n,a,i,o){var s=wK(t,r,n,a.chemicalComponentMap,i,o),u=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return E(E({},o),{id:pn.create22(),modelNum:u,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)});var l=EK,c=AK(e,n,s.hierarchy,l.hierarchy),d=TK(s.hierarchy,n,s.conformation,c),f=e.entry.id.valueKind(0)===0?e.entry.id.value(0):i.name,h=[];return f&&h.push(f),e.struct.title.valueKind(0)===0&&h.push(e.struct.title.value(0)),{id:pn.create22(),entryId:f,label:h.join(" | "),entry:f,sourceData:i,modelNum:u,parent:void 0,entities:n,sequence:c,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:l.hierarchy,coarseConformation:l.conformation,properties:a,customProperties:new Nl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function fRe(e,t,r,n){var a=wK(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),i=Q5e(t,r),o=AK(e,t.entities,a.hierarchy,i.hierarchy),s=TK(a.hierarchy,t.entities,a.conformation,o),u=e.entry.id.valueKind(0)===0?e.entry.id.value(0):n.name,l=[];return u&&l.push(u),e.struct.title.valueKind(0)===0&&l.push(e.struct.title.value(0)),t.model_name&&l.push(t.model_name),t.model_group_name&&l.push(t.model_group_name),{id:pn.create22(),entryId:u,label:l.join(" | "),entry:u,sourceData:n,modelNum:t.model_id,parent:void 0,entities:t.entities,sequence:o,atomicHierarchy:a.hierarchy,atomicConformation:a.conformation,atomicRanges:s,atomicChainOperatorMappinng:a.chainOperatorMapping,coarseHierarchy:i.hierarchy,coarseConformation:i.conformation,properties:r,customProperties:new Nl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function DK(e,t){var r=e.rowCount;if(!e.isDefined)return r;for(var n=t+1;n<r&&e.areValuesEqual(t,n);)n++;return n}function hRe(e,t,r,n){return de(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return fe(this,function(h){switch(h.label){case 0:if(a=[],!t.atom_site)return[3,3];i=t.atom_site.id.rowCount,o=MK(t,r),s=0,h.label=1;case 1:return s<i?(u=DK(t.atom_site.pdbx_PDB_model_num,s),[4,PK(e,t.atom_site,s,u)]):[3,3];case 2:return l=h.sent(),c=l.atom_site,d=l.sourceIndex,f=dRe(t,c,d,o,r,n,a.length>0?a[a.length-1]:void 0),a.push(f),s=u,[3,1];case 3:return[2,a]}})})}function SP(e,t){for(var r=new Map,n=e._rowCount,a=0;a<n;){var i=DK(t,a),o=t.value(a);r.set(o,{table:Yr.window(e,e._schema,a,i),start:a,end:i}),a=i}return r}function pRe(e,t,r,n){return de(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C;return fe(this,function(w){switch(w.label){case 0:if(a=MK(t,r),i=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,o=SP(t.atom_site,i),s=SP(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),u=SP(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),l=[],!t.ihm_model_list)return[3,6];c=t.ihm_model_list,d=c.model_id,f=c.model_name,h=0,w.label=1;case 1:return h<t.ihm_model_list._rowCount?(v=d.value(h),p=void 0,g=void 0,o.has(v)?(m=o.get(v),[4,PK(e,t.atom_site,m.start,m.end)]):[3,3]):[3,6];case 2:return y=w.sent(),b=y.atom_site,S=y.sourceIndex,p=b,g=S,[3,4];case 3:p=Yr.window(t.atom_site,t.atom_site._schema,0,0),g=me.ofIntArray([]),w.label=4;case 4:x={model_id:v,model_name:f.value(h),model_group_name:cRe(v,t),entities:a,atom_site:p,atom_site_sourceIndex:g,ihm_sphere_obj_site:s.has(v)?s.get(v).table:Yr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:u.has(v)?u.get(v).table:Yr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},C=fRe(t,x,r,n),l.push(C),w.label=5;case 5:return h++,[3,1];case 6:return[2,l]}})})}var Xp;(function(e){function t(n){var a=this,i=n.descriptor.name,o=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",s=function(l){return i in l[o]||(l[o][i]={props:E({},T.getDefaultValues(n.getParams(l))),data:Yf.create(void 0)}),l[o][i]},u=function(l,c,d){var f=s(l);l[o][i]={props:c,data:Yf.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=T.clone(n.getParams(l));return T.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),de(a,void 0,void 0,function(){var h,v,p,g,m;return fe(this,function(y){switch(y.label){case 0:return f&&c.customProperties.reference(n.descriptor,!0),h=s(c),v=T.merge(n.defaultParams,h.props,d),h.data.value&&T.areEqual(n.defaultParams,h.props,v)?[2]:[4,n.obtain(l,c,v)];case 1:return p=y.sent(),g=p.value,m=p.assets,c.customProperties.add(n.descriptor),c.customProperties.assets(n.descriptor,m),u(c,v,g),[2]}})})},ref:function(l,c){return l.customProperties.reference(n.descriptor,c)},get:function(l){var c;return(c=s(l))===null||c===void 0?void 0:c.data},set:function(l,c){c===void 0&&(c={});var d=s(l),f=T.merge(n.defaultParams,d.props,c);T.areEqual(n.defaultParams,d.props,f)||(u(l,f,void 0),l.customProperties.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,a,i){var o=this,s={value:T.Value(i,{isHidden:!0})};return t({label:Yo(n),descriptor:Po({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:T.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return de(o,void 0,void 0,function(){var d;return fe(this,function(f){return[2,{value:(d=c.value)!==null&&d!==void 0?d:i}]})})}})}e.createSimple=r})(Xp||(Xp={}));var Xt;(function(e){function t(B,j){for(var Q=[],G=j.frames,W=B.atomicHierarchy.atomSourceIndex,q=me.isIdentity(W),J=q?void 0:W.toArray({array:Int32Array}),he=0,$=G.length;he<$;++he){var X=G[he],U=E(E({},B),{id:pn.create22(),modelNum:he,atomicConformation:X1.getAtomicConformation(X,B.atomicConformation.atomId,J),customProperties:new Nl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)});if(X.cell){var z=ca.fromCell(X.cell.size,X.cell.anglesInRadians);ca.Provider.set(U,z)}e.TrajectoryInfo.set(U,{index:he,size:G.length}),Q.push(U)}return{trajectory:Q,srcIndexArray:J}}function r(B,j){return new $p(t(B,j).trajectory)}e.trajectoryFromModelAndCoordinates=r;function n(B,j){var Q=this;return et.create("Create Trajectory",function(G){return de(Q,void 0,void 0,function(){var W,q,J,he,$,X,U,z,ee;return fe(this,function(Y){switch(Y.label){case 0:return[4,fd(B.basic,B.sourceData,G)];case 1:if(W=Y.sent(),W.frameCount===0)throw new Error("found no model");for(q=W.representative,J=t(q,j).trajectory,he={pairs:B.bonds,count:q.atomicHierarchy.atoms._rowCount},$=gi.fromData(he),X=0,U=0,z=J;U<z.length;U++)ee=z[U],gi.Provider.set(ee,$),e.TrajectoryInfo.set(ee,{index:X++,size:J.length});return[2,new $p(J)]}})})})}e.trajectoryFromTopologyAndCoordinates=n;var a="__Center__";function i(B){if(B._dynamicPropertyData[a])return B._dynamicPropertyData[a];var j=jAe(B.atomicConformation,B.coarseConformation);return B._dynamicPropertyData[a]=j,j}e.getCenter=i;function o(B){for(var j=new Int32Array(B.rowCount),Q=!1,G=0,W=B.rowCount;G<W;G++){var q=B.value(G);q!==G&&(Q=!1),j[q]=G}return{isIdentity:Q,invertedIndex:j}}var s="__InvertedAtomSrcIndex__";function u(B){if(B._staticPropertyData[s])return B._staticPropertyData[s];var j=o(B.atomicHierarchy.atomSourceIndex);return B._staticPropertyData[s]=j,j}e.getInvertedAtomSourceIndex=u;var l="__TrajectoryInfo__";e.TrajectoryInfo={get:function(B){return B._dynamicPropertyData[l]||{index:0,size:1}},set:function(B,j){return B._dynamicPropertyData[l]=j}};var c="__AsymIdCount__";e.AsymIdCount={get:function(B){if(B._dynamicPropertyData[c])return B._dynamicPropertyData[c];var j=zAe(B);return B._dynamicPropertyData[c]=j,j}},e.AsymIdOffset=Xp.createSimple("asym_id_offset","static"),e.Index=Xp.createSimple("index","static");function d(B){return B.parent||B}e.getRoot=d;function f(B,j){return B.atomicHierarchy===j.atomicHierarchy&&B.coarseHierarchy===j.coarseHierarchy}e.areHierarchiesEqual=f;var h="__CoordinatesHistory__";e.CoordinatesHistory={get:function(B){return B._staticPropertyData[h]},set:function(B,j){return B._staticPropertyData[h]=j}};var v="__CoarseGrained__";function p(B){if(B._staticPropertyData[v]!==void 0)return B._staticPropertyData[v];for(var j=0,Q=B.atomicHierarchy.derived.residue.polymerType,G=0;G<Q.length;++G)Q[G]!==0&&(j+=1);for(var W=!1,q=!1,J=B.atomicHierarchy.atoms,he=J.label_atom_id,$=J._rowCount,G=0;G<$;++G){var X=he.value(G);if(!W&&X==="BB"&&(W=!0),!q&&X==="SC1"&&(q=!0),W&&q)break}var U=W&&q||(j&&$?$/j<3:!1);return B._staticPropertyData[v]=U,U}e.isCoarseGrained=p;function g(B){return B.properties.saccharideComponentMap.size>0}e.hasCarbohydrate=g;function m(B){for(var j=B.entities.subtype,Q=0,G=j.rowCount;Q<G;++Q)if(j.value(Q).startsWith("polypeptide"))return!0;return!1}e.hasProtein=m;function y(B){for(var j=B.entities.subtype,Q=0,G=j.rowCount;Q<G;++Q){var W=j.value(Q);if(W.endsWith("ribonucleotide hybrid")||W.endsWith("ribonucleotide"))return!0}return!1}e.hasNucleic=y;function b(B){if(!nn.is(B.sourceData))return!1;var j=B.sourceData.data.db;return j.database_2.database_id.isDefined||B.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||B.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null}e.isFromPdbArchive=b;function S(B){if(!nn.is(B.sourceData))return!1;var j=B.sourceData.data.db;return j.struct_conf.id.isDefined||j.struct_sheet_range.id.isDefined}e.hasSecondaryStructure=S;var x=_.create(1.5707963,1.5707963,1.5707963),C=_.create(1,1,1);function w(B){var j,Q=(j=ca.Provider.get(B))===null||j===void 0?void 0:j.spacegroup;return!!Q&&!(Q.num===1&&_.equals(Q.cell.anglesInRadians,x)&&_.equals(Q.cell.size,C))}e.hasCrystalSymmetry=w;function A(B){if(!nn.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Q=0;Q<j.exptl.method.rowCount;Q++){var G=j.exptl.method.value(Q).toUpperCase();if(G.indexOf("DIFFRACTION")>=0)return!0}return!1}e.isFromXray=A;function I(B){if(!nn.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Q=0;Q<j.exptl.method.rowCount;Q++){var G=j.exptl.method.value(Q).toUpperCase();if(G.indexOf("MICROSCOPY")>=0)return!0}return!1}e.isFromEm=I;function D(B){if(!nn.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Q=0;Q<j.exptl.method.rowCount;Q++){var G=j.exptl.method.value(Q).toUpperCase();if(G.indexOf("NMR")>=0)return!0}return!1}e.isFromNmr=D;function k(B){if(!nn.is(B.sourceData)||!A(B))return!1;var j=B.sourceData.data.db,Q=j.pdbx_database_status.status_code_sf;return Q.isDefined&&Q.value(0)==="REL"}e.hasXrayMap=k;function R(B){if(!nn.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Q=j.pdbx_database_related,G=Q.db_name,W=Q.content_type,q=0,J=j.pdbx_database_related._rowCount;q<J;++q)if(G.value(q).toUpperCase()==="EMDB"&&W.value(q)==="associated EM volume")return!0;return!1}e.hasEmMap=R;function L(B){return nn.is(B.sourceData)?k(B)||R(B):!1}e.hasDensityMap=L;function H(B){if(!nn.is(B.sourceData))return!1;var j=B.sourceData.data.db;return L(B)||b(B)&&(!j.exptl.method.isDefined||A(B)&&(!j.pdbx_database_status.status_code_sf.isDefined||j.pdbx_database_status.status_code_sf.valueKind(0)===2)||I(B)&&!j.pdbx_database_related.db_name.isDefined)}e.probablyHasDensityMap=H})(Xt||(Xt={}));var zM;(function(e){function t(d,f,h){if(!f)return{rowCount:0};if(h&&h[f.id])return h[f.id];var v=f.getElements(d),p={data:v,rowCount:v.elements.length};return h&&(h[f.id]=p),p}e.getCifDataSource=t;function r(d){return new Z7(d)}e.fromAtomMap=r;function n(d){return new Z7(CP(d))}e.fromAtomArray=n;var a=function(d){return d.atomicHierarchy.residueAtomSegments};function i(d){return new Q2("residue",d,a,0)}e.fromResidueMap=i;function o(d){return new Q2("residue",CP(d),a,0)}e.fromResidueArray=o;var s=function(d){return d.atomicHierarchy.chainAtomSegments};function u(d){return new Q2("chain",d,s,0)}e.fromChainMap=u;function l(d){return new Q2("chain",CP(d),s,0)}e.fromChainArray=l;function c(d){return new vRe(d)}e.fromEntityMap=c})(zM||(zM={}));function CP(e){for(var t=new Map,r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var Q2=function(){function e(t,r,n,a){this.level=t,this.map=r,this.segmentGetter=n,this.id=pn.create22(),this.kind=a}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=this.segmentGetter(r[0]),s=0,u=a;s<u.length;s++){var l=u[s],c=l.units[0];if(c.kind===this.kind)for(var d=ar.transientSegments(o,c.elements);d.hasNext;){var f=d.move();!this.has(f.index)||n.has(f.index)||(n.add(f.index),i[i.length]=at.create(t,c,c.elements[f.start]))}}return i.sort(function(h,v){return h.element-v.element}),i},e.prototype.getElements=function(t){var r=this,n=this.segmentGetter(t.model).index,a=this.getStructureElements(t);return{elements:a,property:function(i){return r.get(n[a[i].element])}}},e}(),Z7=function(){function e(t){this.map=t,this.id=pn.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=0,s=a;o<s.length;o++){var u=s[o],l=u.units[0];if(l.kind===this.kind)for(var c=l.elements,d=0,f=c.length;d<f;d++){var h=c[d];!this.has(h)||n.has(h)||(n.add(c[d]),i[i.length]=at.create(t,l,h))}}return i.sort(function(v,p){return v.element-p.element}),i},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t);return{elements:n,property:function(a){return r.get(n[a].element)}}},e}(),vRe=function(){function e(t){this.map=t,this.id=pn.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=r[0].atomicHierarchy.index,a=new Set,i=t.unitSymmetryGroups,o=[],s=r[0].atomicHierarchy.chainAtomSegments,u=0,l=i;u<l.length;u++){var c=l[u],d=c.units[0];if(d.kind===this.kind)for(var f=ar.transientSegments(s,d.elements);f.hasNext;){var h=f.move(),v=n.getEntityFromChain(h.index);!this.has(v)||a.has(v)||(a.add(v),o[o.length]=at.create(t,d,d.elements[h.start]))}}return o.sort(function(p,g){return p.element-g.element}),o},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t),a=t.model.atomicHierarchy.chainAtomSegments.index,i=t.model.atomicHierarchy.index;return{elements:n,property:function(o){return r.get(i.getEntityFromChain(a[n[o].element]))}}},e}(),mRe=function(){function e(){this.map=new Map}return e.prototype.removeSymbol=function(t){this.map.delete(t.symbol.id)},e.prototype.addSymbol=function(t){this.map.has(t.symbol.id)&&console.warn("Symbol '"+t.symbol.id+"' already added. Call removeSymbol/removeCustomProps re-adding the symbol."),this.map.set(t.symbol.id,t)},e.prototype.addCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var a=n[r];this.addSymbol(t.symbols[a])}},e.prototype.removeCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var a=n[r];this.removeSymbol(t.symbols[a])}},e.prototype.getRuntime=function(t){return this.map.get(t)},e}(),i_=new mRe,gRe=function(){function e(t){this.table=t,this.constQueryContext=new as(tt.Empty)}return e}(),J7;(function(e){function t(n){return{kind:"const",value:n}}e.Const=t;function r(n){return{kind:"dynamic",runtime:n}}e.Dynamic=r})(J7||(J7={}));var Sp;(function(e){function t(n){return{isConst:!0,fn:function(i){return n}}}e.Const=t;function r(n){return{isConst:!1,fn:n}}e.Dynamic=r})(Sp||(Sp={}));var Jy;(function(e){function t(r,n,a,i){if(typeof r.length=="number")for(var o=0,s=r.length;o<s;o++)a(r[o](n),o,i);else for(var o=0,u=0,l=Object.keys(r);u<l.length;u++){var c=l[u];a(r[c](n),o++,i)}return i}e.forEachEval=t})(Jy||(Jy={}));var Ig;(function(e){function t(n,a){return new eU(n,a,!0)}e.Const=t;function r(n,a){return new eU(n,a,!1)}e.Dynamic=r})(Ig||(Ig={}));var eU=function(){function e(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}return e.prototype.compile=function(t,r){var n,a=!1;if(!r)n=void 0,a=!0;else if(Ia.isArgumentsArray(r)){n=[],a=!1;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=VM(t,s);a=a&&u.isConst,n.push(u.fn)}}else{n=Object.create(null),a=!1;for(var l=0,c=Object.keys(r);l<c.length;l++){var d=c[l],u=VM(t,r[d]);a=a&&u.isConst,n[d]=u.fn}}return this.isConst?this.isConst&&a?Sp.Const(this.fn(t.constQueryContext,n)):Sp.Dynamic(tU(this.fn,n)):Sp.Dynamic(tU(this.fn,n))},e}();function tU(e,t){return function(n){return e(n,t)}}function VM(e,t){if(Ia.isLiteral(t))return Sp.Const(t);if(Ia.isSymbol(t)){var r=e.table.getRuntime(t.name);return r?r.compile(e):Sp.Const(t.name)}if(!Ia.isSymbol(t.head))throw new Error("Can only apply symbols.");var n=e.table.getRuntime(t.head.name);if(!n)throw new Error("Symbol '"+t.head.name+"' is not implemented.");return n.compile(e,t.args)}function Yp(e){var t=new gRe(i_);return VM(t,e).fn}var Zt=Ig.Const,zt=Ig.Dynamic,yRe=[Zt(we.core.type.bool,function(t,r){return!!r[0](t)}),Zt(we.core.type.num,function(t,r){return+r[0](t)}),Zt(we.core.type.str,function(t,r){return""+r[0](t)}),Zt(we.core.type.list,function(t,r){return Jy.forEachEval(r,t,function(n,a,i){return i[a]=n},[])}),Zt(we.core.type.set,function(t,r){return Jy.forEachEval(r,t,function(a,i,o){return o.add(a)},new Set)}),Zt(we.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),Zt(we.core.type.bitflags,function(t,r){return+r[0](t)}),Zt(we.core.type.compositeKey,function(t,r){return Jy.forEachEval(r,t,function(n,a,i){return i[a]=""+n},[]).join("-")}),Zt(we.core.logic.not,function(e,t){return!t[0](e)}),Zt(we.core.logic.and,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(var a=0,i=Object.keys(t);a<i.length;a++){var o=i[a];if(!t[o](e))return!1}return!0}),Zt(we.core.logic.or,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(var a=0,i=Object.keys(t);a<i.length;a++){var o=i[a];if(t[o](e))return!0}return!1}),Zt(we.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),Zt(we.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),Zt(we.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),Zt(we.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),Zt(we.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),Zt(we.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),Zt(we.core.rel.inRange,function(e,t){var r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),Zt(we.core.math.add,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r+=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r+=t[s](e)}return r}),Zt(we.core.math.sub,function(e,t){var r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(var n=1,a=t.length;n<a;n++)r-=t[n](e)}else{var i=Object.keys(t);if(i.length===1)return-t[i[0]](e);r=t[i[0]](e)||0;for(var n=1,a=i.length;n<a;n++)r-=t[i[n]](e)}return r}),Zt(we.core.math.mult,function(e,t){var r=1;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r*=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r*=t[s](e)}return r}),Zt(we.core.math.div,function(e,t){return t[0](e)/t[1](e)}),Zt(we.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),Zt(we.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),Zt(we.core.math.min,function(e,t){var r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=Math.min(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=Math.min(t[s](e),r)}return r}),Zt(we.core.math.max,function(e,t){var r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=Math.max(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=Math.max(t[s](e),r)}return r}),Zt(we.core.math.floor,function(e,t){return Math.floor(t[0](e))}),Zt(we.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),Zt(we.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),Zt(we.core.math.abs,function(e,t){return Math.abs(t[0](e))}),Zt(we.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),Zt(we.core.math.cbrt,function(e,t){return Math.cbrt(t[0](e))}),Zt(we.core.math.sin,function(e,t){return Math.sin(t[0](e))}),Zt(we.core.math.cos,function(e,t){return Math.cos(t[0](e))}),Zt(we.core.math.tan,function(e,t){return Math.tan(t[0](e))}),Zt(we.core.math.asin,function(e,t){return Math.asin(t[0](e))}),Zt(we.core.math.acos,function(e,t){return Math.acos(t[0](e))}),Zt(we.core.math.atan,function(e,t){return Math.atan(t[0](e))}),Zt(we.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),Zt(we.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),Zt(we.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),Zt(we.core.math.exp,function(e,t){return Math.exp(t[0](e))}),Zt(we.core.math.log,function(e,t){return Math.log(t[0](e))}),Zt(we.core.math.log10,function(e,t){return Math.log10(t[0](e))}),Zt(we.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),Zt(we.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),Zt(we.core.str.concat,function(e,t){var r=[];if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r.push(t[n](e).toString());else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r.push(t[s](e).toString())}return r.join("")}),Zt(we.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),Zt(we.core.list.equal,function(e,t){return gk(t[0](e),t[1](e))}),Zt(we.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),Zt(we.core.set.isSubset,function(t,r){return fa.isSuperset(r[1](t),r[0](t))}),Zt(we.core.flags.hasAny,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)!==0:!!n}),Zt(we.core.flags.hasAll,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),Zt(we.structureQuery.type.elementSymbol,function(e,t){return Qg(t[0](e))}),Zt(we.structureQuery.type.atomName,function(e,t){return xSe(t[0](e))}),Zt(we.structureQuery.type.bondFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=rU(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=rU(r,t[s](e))}return r}),Zt(we.structureQuery.type.ringFingerprint,function(e,t){return Ls.elementFingerprint(bRe(e,t))}),Zt(we.structureQuery.type.secondaryStructureFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=nU(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=nU(r,t[s](e))}return r}),zt(we.structureQuery.filter.pick,function(e,t){return rn.filters.pick(t[0],t.test)(e)}),zt(we.structureQuery.filter.first,function(e,t){return rn.filters.first(t[0])(e)}),zt(we.structureQuery.filter.withSameAtomProperties,function(e,t){return rn.filters.withSameAtomProperties(t[0],t.source,t.property)(e)}),zt(we.structureQuery.filter.intersectedBy,function(e,t){return rn.filters.areIntersectedBy(t[0],t.by)(e)}),zt(we.structureQuery.filter.within,function(e,t){return rn.filters.within({query:t[0],target:t.target,minRadius:t["min-radius"],maxRadius:t["max-radius"],elementRadius:t["atom-radius"],invert:t.invert})(e)}),zt(we.structureQuery.filter.isConnectedTo,function(e,t){return rn.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct,invert:t.invert,bondTest:t["bond-test"]})(e)}),zt(we.structureQuery.generator.atomGroups,function(t,r){return rn.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),zt(we.structureQuery.generator.all,function(t){return rn.generators.all(t)}),zt(we.structureQuery.generator.empty,function(t){return rn.generators.none(t)}),zt(we.structureQuery.generator.bondedAtomicPairs,function(t,r){return rn.generators.bondedAtomicPairs(r&&r[0])(t)}),zt(we.structureQuery.generator.rings,function(t,r){var n,a;return rn.generators.rings((n=r==null?void 0:r.fingerprint)===null||n===void 0?void 0:n.call(r,t),(a=r==null?void 0:r["only-aromatic"])===null||a===void 0?void 0:a.call(r,t))(t)}),zt(we.structureQuery.modifier.includeSurroundings,function(t,r){return rn.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),zt(we.structureQuery.modifier.surroundingLigands,function(t,r){return rn.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),zt(we.structureQuery.modifier.wholeResidues,function(t,r){return rn.modifiers.wholeResidues(r[0])(t)}),zt(we.structureQuery.modifier.union,function(t,r){return rn.modifiers.union(r[0])(t)}),zt(we.structureQuery.modifier.expandProperty,function(t,r){return rn.modifiers.expandProperty(r[0],r.property)(t)}),zt(we.structureQuery.modifier.exceptBy,function(t,r){return rn.modifiers.exceptBy(r[0],r.by)(t)}),zt(we.structureQuery.modifier.includeConnected,function(t,r){var n,a;return rn.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:(a=(n=r["fixed-point"])===null||n===void 0?void 0:n.call(r,t))!==null&&a!==void 0?a:!1})(t)}),zt(we.structureQuery.combinator.merge,function(e,t){return rn.combinators.merge(t)(e)}),zt(we.structureQuery.atomProperty.core.elementSymbol,un(pt.atom.type_symbol)),zt(we.structureQuery.atomProperty.core.vdw,function(e,t){return Mb(pt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),zt(we.structureQuery.atomProperty.core.mass,function(e,t){return ZAe(pt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),zt(we.structureQuery.atomProperty.core.atomicNumber,function(e,t){return Db(pt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),zt(we.structureQuery.atomProperty.core.x,un(pt.atom.x)),zt(we.structureQuery.atomProperty.core.y,un(pt.atom.y)),zt(we.structureQuery.atomProperty.core.z,un(pt.atom.z)),zt(we.structureQuery.atomProperty.core.sourceIndex,un(pt.atom.sourceIndex)),zt(we.structureQuery.atomProperty.core.operatorName,un(pt.unit.operator_name)),zt(we.structureQuery.atomProperty.core.modelIndex,un(pt.unit.model_index)),zt(we.structureQuery.atomProperty.core.modelLabel,un(pt.unit.model_label)),zt(we.structureQuery.atomProperty.core.atomKey,function(e,t){var r=t&&t[0]&&t[0](e)||e.element;return Uf(r.unit.id,r.element)}),zt(we.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return N5e(t&&t[0]&&t[0](e)||e.element)}),zt(we.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return F5e(t&&t[0]&&t[0](e)||e.element)}),zt(we.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return B5e(t&&t[0]&&t[0](e)||e.element)}),zt(we.structureQuery.atomProperty.macromolecular.id,un(pt.atom.id)),zt(we.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return pt.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"}),zt(we.structureQuery.atomProperty.macromolecular.label_atom_id,un(pt.atom.label_atom_id)),zt(we.structureQuery.atomProperty.macromolecular.label_alt_id,un(pt.atom.label_alt_id)),zt(we.structureQuery.atomProperty.macromolecular.label_comp_id,un(pt.atom.label_comp_id)),zt(we.structureQuery.atomProperty.macromolecular.label_seq_id,un(pt.residue.label_seq_id)),zt(we.structureQuery.atomProperty.macromolecular.label_asym_id,un(pt.chain.label_asym_id)),zt(we.structureQuery.atomProperty.macromolecular.label_entity_id,un(pt.entity.id)),zt(we.structureQuery.atomProperty.macromolecular.auth_atom_id,un(pt.atom.auth_atom_id)),zt(we.structureQuery.atomProperty.macromolecular.auth_comp_id,un(pt.atom.auth_comp_id)),zt(we.structureQuery.atomProperty.macromolecular.auth_seq_id,un(pt.residue.auth_seq_id)),zt(we.structureQuery.atomProperty.macromolecular.auth_asym_id,un(pt.chain.auth_asym_id)),zt(we.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,un(pt.residue.pdbx_PDB_ins_code)),zt(we.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,un(pt.atom.pdbx_formal_charge)),zt(we.structureQuery.atomProperty.macromolecular.occupancy,un(pt.atom.occupancy)),zt(we.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,un(pt.atom.B_iso_or_equiv)),zt(we.structureQuery.atomProperty.macromolecular.entityType,un(pt.entity.type)),zt(we.structureQuery.atomProperty.macromolecular.entitySubtype,un(pt.entity.subtype)),zt(we.structureQuery.atomProperty.macromolecular.entityPrdId,un(pt.entity.prd_id)),zt(we.structureQuery.atomProperty.macromolecular.entityDescription,un(pt.entity.pdbx_description)),zt(we.structureQuery.atomProperty.macromolecular.objectPrimitive,un(pt.unit.object_primitive)),zt(we.structureQuery.atomProperty.macromolecular.isNonStandard,un(pt.residue.isNonStandard)),zt(we.structureQuery.atomProperty.macromolecular.secondaryStructureKey,un(pt.residue.secondary_structure_key)),zt(we.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,un(pt.residue.secondary_structure_type)),zt(we.structureQuery.atomProperty.macromolecular.chemCompType,un(pt.residue.chem_comp_type)),zt(we.structureQuery.bondProperty.order,function(e,t){return e.atomicBond.order}),zt(we.structureQuery.bondProperty.flags,function(e,t){return e.atomicBond.type}),zt(we.structureQuery.bondProperty.atomA,function(e,t){return e.atomicBond.a}),zt(we.structureQuery.bondProperty.atomB,function(e,t){return e.atomicBond.b}),zt(we.structureQuery.bondProperty.length,function(e,t){return e.atomicBond.length}),zt(we.internal.generator.bundleElement,function(t,r){return mK(r.groupedUnits(t),r.ranges(t),r.set(t))}),zt(we.internal.generator.bundle,function(t,r){return gK(r.elements(t))(t)}),zt(we.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function un(e){return function(t,r){return e(r&&r[0]&&r[0](t)||t.element)}}function rU(e,t){return e|(Nr.isName(t)?Nr.fromName(t):0)}function nU(e,t){switch(t.toLowerCase()){case"helix":return e|2;case"alpha":return e|2|4096;case"pi":return e|2|32768;case"310":return e|2|2048;case"beta":return e|4;case"strand":return e|4|4194304;case"sheet":return e|4|8388608;case"turn":return e|16;case"bend":return e|8;case"coil":return e|536870912;default:return e}}function bRe(e,t){var r=[];if(!t)return r;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r.push(t[n](e));else for(var i=Object.keys(t),n=1,a=i.length;n<a;n++)r.push(t[i[n]](e));return r}(function(){for(var e=0,t=yRe;e<t.length;e++){var r=t[e];i_.addSymbol(r)}})();var Iu;(function(e){function t(s){var u=new DataView(s.buffer);return Object.assign(s.subarray(0),{readInt8:function(l){return u.getInt8(l)},readUInt8:function(l){return u.getUint8(l)},writeInt8:function(l,c){return u.setInt8(c,l)},writeUInt8:function(l,c){return u.setUint8(c,l)},readInt16LE:function(l){return u.getInt16(l,!0)},readInt32LE:function(l){return u.getInt32(l,!0)},readUInt16LE:function(l){return u.getUint16(l,!0)},readUInt32LE:function(l){return u.getUint32(l,!0)},readFloatLE:function(l){return u.getFloat32(l,!0)},readDoubleLE:function(l){return u.getFloat64(l,!0)},writeInt16LE:function(l,c){return u.setInt16(c,l,!0)},writeInt32LE:function(l,c){return u.setInt32(c,l,!0)},writeUInt16LE:function(l,c){return u.setUint16(c,l,!0)},writeUInt32LE:function(l,c){return u.setUint32(c,l,!0)},writeFloatLE:function(l,c){return u.setFloat32(c,l,!0)},writeDoubleLE:function(l,c){return u.setFloat64(c,l,!0)},readInt16BE:function(l){return u.getInt16(l,!1)},readInt32BE:function(l){return u.getInt32(l,!1)},readUInt16BE:function(l){return u.getUint16(l,!1)},readUInt32BE:function(l){return u.getUint32(l,!1)},readFloatBE:function(l){return u.getFloat32(l,!1)},readDoubleBE:function(l){return u.getFloat64(l,!1)},writeInt16BE:function(l,c){return u.setInt16(c,l,!1)},writeInt32BE:function(l,c){return u.setInt32(c,l,!1)},writeUInt16BE:function(l,c){return u.setUint16(c,l,!1)},writeUInt32BE:function(l,c){return u.setUint32(c,l,!1)},writeFloatBE:function(l,c){return u.setFloat32(c,l,!1)},writeDoubleBE:function(l,c){return u.setFloat64(c,l,!1)},copy:function(l,c,d,f){return c=Da(c,0),d=Da(d,0),f=Da(f,s.length),l.set(s.subarray(d,f),c),f-d}})}e.fromUint8Array=t;function r(s){return t(new Uint8Array(s))}e.fromArrayBuffer=r;function n(s){return s}e.fromBuffer=n,e.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function a(s,u,l,c,d){for(var f=0,h=l;f<h;f+=c)for(var v=0;v<c;v++)u[d+f+c-v-1]=s[d+f+v]}e.flipByteOrder=a;function i(s,u,l){u===void 0&&(u=0);for(var c=new Int16Array(s,u,l),d=0,f=c.length;d<f;++d){var h=c[d];c[d]=(h&255)<<8|h>>8&255}}e.flipByteOrderInPlace2=i;function o(s,u,l,c,d){e.IsNativeEndianLittle||!l||c<=1||a(s,u,l,c,d)}e.ensureLittleEndian=o})(Iu||(Iu={}));var o_;(function(e){function t(r,n){return{name:n,readBuffer:function(a,i,o,s){var u,l;if(typeof i=="number"){o=Da(o,i);var c=a,d=Math.min(r.length,c+o);u=d-c,l=Iu.fromUint8Array(new Uint8Array(r.buffer,c,d-c))}else{o=Da(o,i.length);var c=a,d=Math.min(r.length,c+o);i.set(r.subarray(c,d),s),u=d-c,l=i}return o!==u&&console.warn("byteCount "+o+" and bytesRead "+u+" differ"),Promise.resolve({bytesRead:u,buffer:l})},writeBuffer:function(a,i,o){return o=Da(o,i.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(a,i,o){return o=Da(o,i.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:cf}}e.fromBuffer=t})(o_||(o_={}));var hi;(function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16"})(hi||(hi={}));function RK(e){return e===hi.Float32?4:e===hi.Int16||e===hi.Uint16?2:1}function xRe(e,t,r,n){return r===void 0&&(r=0),e===hi.Float32?new Float32Array(t,r,n):e===hi.Int16?new Int16Array(t,r,n):e===hi.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function SRe(e,t){var r=RK(t),n=new ArrayBuffer(r*e),a=Iu.fromArrayBuffer(n),i=Iu.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:a,valuesBuffer:new Uint8Array(i),values:xRe(t,i)}}function CRe(e,t,r,n,a,i){return de(this,void 0,void 0,function(){return fe(this,function(o){switch(o.label){case 0:return[4,t.readBuffer(r,e.readBuffer,n,a)];case 1:return o.sent(),e.elementByteSize>1&&(i!==void 0&&i!==Iu.IsNativeEndianLittle||!Iu.IsNativeEndianLittle)&&Iu.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,a),[2,e.values]}})})}function _Re(e){return de(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l;return fe(this,function(c){switch(c.label){case 0:return t=1024,[4,e.readBuffer(0,t)];case 1:if(r=c.sent().buffer,n=String.fromCharCode(r.readUInt8(52*4),r.readUInt8(52*4+1),r.readUInt8(52*4+2),r.readUInt8(52*4+3)),n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');return a=[r.readUInt8(53*4),r.readUInt8(53*4+1)],i=!1,a[0]===68&&a[1]===65?i=!0:a[0]===17&&a[1]===17?i=!1:(o=r.readInt32LE(3*4),o<=16&&(i=!0)),s=i?function(d){return r.readInt32LE(d*4)}:function(d){return r.readInt32BE(d*4)},u=i?function(d){return r.readFloatLE(d*4)}:function(d){return r.readFloatBE(d*4)},l={NC:s(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:a,ARMS:u(54)},[2,{header:l,littleEndian:i}]}})})}function wRe(e,t,r,n,a,i){return de(this,void 0,void 0,function(){var o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:return OK(e)?(o=3*a,[4,r.readBuffer(n,t.readBuffer,a,o)]):[3,2];case 1:for(f.sent(),s=new Int8Array(t.valuesBuffer.buffer,o),u=(e.AMAX-e.AMIN)/255,l=.5*(e.AMIN+e.AMAX+u),c=0,d=a;c<d;++c)t.values[c]=u*s[c]+l;return[3,4];case 2:return[4,CRe(t,r,n,a,0,i)];case 3:f.sent(),f.label=4;case 4:return[2]}})})}function kK(e){switch(e){case 0:return hi.Int8;case 1:return hi.Int16;case 2:return hi.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:hi.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error("unknown mode '"+e+"'")}function OK(e){return e.userFlag1===-128&&e.userFlag2===127}function LK(e){return OK(e)?hi.Float32:kK(e.MODE)}function ERe(e){return 256*4+e.NSYMBT}function ARe(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h;return fe(this,function(v){switch(v.label){case 0:return[4,r.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return v.sent(),[4,_Re(e)];case 2:return n=v.sent(),a=n.header,i=n.littleEndian,o=ERe(a),s=kK(a.MODE),u=LK(a),l=a.NC*a.NR*a.NS,c=RK(s),d=l*c,f=SRe(l,u),wRe(a,f,e,o,d,i),h={header:a,values:f.values,name:e.name},[2,h]}})})}function PRe(e,t){var r=this;return et.create("Parse CCP4/MRC/MAP",function(n){return de(r,void 0,void 0,function(){var a,i,o;return fe(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=In).success,[4,ARe(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,In.error(o)];case 3:return[2]}})})})}function TRe(e,t){return PRe(o_.fromBuffer(Iu.fromUint8Array(e),t),e.length)}var HM=512;function IRe(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function MRe(e,t){var r=t?function(a){return e.readInt16LE(a*2)}:function(a){return e.readInt16BE(a*2)},n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function NK(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=Math.ceil(t/8),i=Math.ceil(r/8),o=Math.ceil(n/8);return{xBlocks:a,yBlocks:i,zBlocks:o}}function DRe(e){return de(this,void 0,void 0,function(){var t,r,n,a,i;return fe(this,function(o){switch(o.label){case 0:return[4,e.readBuffer(0,HM)];case 1:return t=o.sent().buffer,r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),a=n||t.readInt16LE(18*2)===100,i=n?IRe(r):MRe(t,a),[2,{header:i,littleEndian:a}]}})})}function RRe(e,t,r,n){return de(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C,w;return fe(this,function(A){for(n||Iu.flipByteOrderInPlace2(t.buffer),a=e.divisor,i=e.summand,o=e.xExtent,s=e.yExtent,u=e.zExtent,l=NK(e),c=l.xBlocks,d=l.yBlocks,f=l.zBlocks,h=0,v=0;v<f;++v)for(p=0;p<d;++p)for(g=0;g<c;++g)for(m=0;m<8;++m)for(y=8*v+m,b=0;b<8;++b)for(S=8*p+b,x=0;x<8;++x)if(C=8*g+x,C<o&&S<s&&y<u)w=(C*s+S)*u+y,r[w]=(t[h]-i)/a,++h;else{h+=8-x;break}return[2]})})}function kRe(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=NK(e),i=a.xBlocks,o=a.yBlocks,s=a.zBlocks,u=t*r*n,l=i*8*o*8*s*8,c=1,d=l*c;return{count:l,byteCount:d,valueCount:u}}function ORe(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return fe(this,function(c){switch(c.label){case 0:return[4,r.update({message:"Parsing DSN6/BRIX file..."})];case 1:return c.sent(),[4,DRe(e)];case 2:return n=c.sent(),a=n.header,i=n.littleEndian,[4,e.readBuffer(HM,t-HM)];case 3:return o=c.sent().buffer,s=kRe(a).valueCount,u=new Float32Array(s),[4,RRe(a,o,u,i)];case 4:return c.sent(),l={header:a,values:u,name:e.name},[2,l]}})})}function LRe(e,t){var r=this;return et.create("Parse DSN6/BRIX",function(n){return de(r,void 0,void 0,function(){var a,i,o;return fe(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=In).success,[4,ORe(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,In.error(o)];case 3:return[2]}})})})}function NRe(e,t){return LRe(o_.fromBuffer(Iu.fromUint8Array(e),t),e.length)}var FRe={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},BRe=new Set(Object.keys(FRe));function _P(e){if(!BRe.has(e))throw new Error("unknown ply type '"+e+"'");return e}function URe(e,t,r){for(var n=new Map,a=0,i=t.length;a<i;++a)n.set(t[a],e[a]);return{comments:r,elementNames:t,getElement:function(o){return n.get(o)}}}function jRe(e,t){var r=It(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function zRe(e){var t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,It.eatLine(e)}function VRe(e){var t=e.tokenizer,r=e.comments,n=e.elementSpecs;zRe(t);var a=It.getTokenString(t).split(/\r?\n/);if(a[0]!=="ply")throw new Error("data not starting with 'ply'");if(a[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");var i,o,s;function u(){if(i!==void 0&&o!==void 0&&s!==void 0){for(var h=!1,v=0,p=s.length;v<p;++v){var g=s[v];if(g.kind==="list"){h=!0;break}}h&&s.length,h?n.push({kind:"list",name:i,count:o,property:s[0]}):n.push({kind:"table",name:i,count:o,properties:s})}}for(var l=2,c=a.length;l<c;++l){var d=a[l],f=d.split(" ");if(d.startsWith("comment"))r.push(d.substr(8));else if(d.startsWith("element"))u(),s=[],i=f[1],o=parseInt(f[2]);else if(d.startsWith("property")){if(s===void 0)throw new Error("properties outside of element");f[1]==="list"?s.push({kind:"list",countType:_P(f[2]),dataType:_P(f[3]),name:f[4]}):s.push({kind:"column",type:_P(f[1]),name:f[2]})}else d.startsWith("end_header")?u():console.warn("unknown header line")}}function HRe(e){for(var t=e.elementSpecs,r=0,n=t.length;r<n;++r){var a=t[r];a.kind==="table"?GRe(e,a):a.kind==="list"&&qRe(e,a)}}function FK(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return me.Schema.int;case"float":case"double":case"float32":case"float64":return me.Schema.float}}function GRe(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.properties,o=i.length,s=[],u=[],l=[],c=new Map,d=0,f=o;d<f;++d){var h=mt.create(n.data,a*2);l.push(h)}for(var d=0,f=a;d<f;++d)for(var v=0,p=o;v<p;++v)It.skipWhitespace(n),It.markStart(n),It.eatValue(n),mt.addUnchecked(l[v],n.tokenStart,n.tokenEnd);for(var d=0,f=o;d<f;++d){var g=i[d],m=g.type,y=g.name,b=Bk(l[d],FK(m));s.push(y),u.push(m),c.set(y,b)}r.push({kind:"table",rowCount:a,propertyNames:s,propertyTypes:u,getProperty:function(S){return c.get(S)}})}function qRe(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.property,o=mt.create(n.data,a*2*3),s=new Uint32Array(a+1),u=0,l=0,c=a;l<c;++l){for(It.skipWhitespace(n),It.markStart(n);It.skipWhitespace(n)!==10;)++u,It.markStart(n),It.eatValue(n),mt.addToken(o,n);s[l+1]=u}var d={entries:[],count:0},f=Bk(o,FK(i.dataType));r.push({kind:"list",rowCount:a,name:i.name,type:i.dataType,value:function(h){for(var v=s[h]+1,p=f.value(v-1),g=v,m=v+p;g<m;++g)d.entries[g-v]=f.value(g);return d.count=p,d}})}function WRe(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o,s;return fe(this,function(u){return r=jRe(e,t),t.update({message:"Parsing...",current:0,max:e.length}),VRe(r),HRe(r),n=r.elements,a=r.elementSpecs,i=r.comments,o=a.map(function(l){return l.name}),s=URe(n,o,i),[2,In.success(s)]})})}function $Re(e){var t=this;return et.create("Parse PLY",function(r){return de(t,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return[4,WRe(e,r)];case 1:return[2,n.sent()]}})})})}var s_=It.readLine,BK=It.skipWhitespace,UK=It.eatValue,XRe=It.eatLine,GM=It.markStart,SS=/\s+/,YRe=/(^\*|REMARK)*/;function KRe(e,t){return{tokenizer:e,runtimeCtx:t}}function QRe(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,h,v,p,g;return fe(this,function(m){switch(m.label){case 0:return r=e.tokenizer,n=mt.create(r.data,t*2),a=mt.create(r.data,t*2),i=mt.create(r.data,t*2),o=mt.create(r.data,t*2),s=mt.create(r.data,t*2),u=mt.create(r.data,t*2),l=mt.create(r.data,t*2),c=mt.create(r.data,t*2),d=r.position,f=s_(r).trim(),r.position=d,h=f.split(SS).length===7,v=h?6:8,p=r.length,g=0,[4,qc(e.runtimeCtx,1e5,void 0,function(y){for(var b=Math.min(t-g,y),S=0;S<b;++S){for(var x=0;x<v;++x)if(BK(r),GM(r),UK(r),h)switch(x){case 0:mt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:mt.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:mt.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:mt.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 4:mt.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 5:mt.addUnchecked(c,r.tokenStart,r.tokenEnd);break}else switch(x){case 0:mt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:mt.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 2:mt.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:mt.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 4:mt.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:mt.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 6:mt.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 7:mt.addUnchecked(c,r.tokenStart,r.tokenEnd);break}XRe(r),GM(r)}return g+=b,b},function(y){return y.update({message:"Parsing...",current:r.position,max:p})})];case 1:return m.sent(),[2,{count:t,atomId:Wr(n)(me.Schema.int),segmentName:h?Wr(i)(me.Schema.str):Wr(a)(me.Schema.str),residueId:Wr(i)(me.Schema.int),residueName:h?Wr(i)(me.Schema.str):Wr(o)(me.Schema.str),atomName:Wr(s)(me.Schema.str),atomType:Wr(u)(me.Schema.str),charge:Wr(l)(me.Schema.float),mass:Wr(c)(me.Schema.float)}]}})})}function ZRe(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o;return fe(this,function(s){switch(s.label){case 0:return r=e.tokenizer,n=mt.create(r.data,t*2),a=mt.create(r.data,t*2),i=r.length,o=0,[4,qc(e.runtimeCtx,10,void 0,function(u){for(var l=Math.min(t-o,u),c=0;c<l;++c)for(var d=0;d<2;++d)switch(BK(r),GM(r),UK(r),d){case 0:mt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:mt.addUnchecked(a,r.tokenStart,r.tokenEnd);break}return o+=l,l},function(u){return u.update({message:"Parsing...",current:r.position,max:i})})];case 1:return s.sent(),[2,{count:t,atomIdA:Wr(n)(me.Schema.int),atomIdB:Wr(a)(me.Schema.int)}]}})})}function JRe(e,t){for(var r=[],n=0;n<t;++n){var a=s_(e.tokenizer);r.push(a.replace(YRe,"").trim())}return r}function eke(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f;return fe(this,function(h){switch(h.label){case 0:r=It(e),n=KRe(r,t),a=void 0,i=void 0,o=void 0,s=s_(n.tokenizer).trim(),h.label=1;case 1:return r.tokenEnd<r.length?(u=s_(n.tokenizer).trim(),u.includes("!NTITLE")?(l=parseInt(u.split(SS)[0]),a=JRe(n,l),[3,7]):[3,2]):[3,8];case 2:return u.includes("!NATOM")?(c=parseInt(u.split(SS)[0]),[4,QRe(n,c)]):[3,4];case 3:return i=h.sent(),[3,7];case 4:return u.includes("!NBOND")?(d=parseInt(u.split(SS)[0]),[4,ZRe(n,d)]):[3,6];case 5:return o=h.sent(),[3,8];case 6:u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM"),h.label=7;case 7:return[3,1];case 8:return a===void 0&&(a=[]),i===void 0?[2,In.error("no atoms data")]:o===void 0?[2,In.error("no bonds data")]:(f={id:s,title:a,atoms:i,bonds:o},[2,In.success(f)])}})})}function tke(e){var t=this;return et.create("Parse PSF",function(r){return de(t,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return[4,eke(e,r)];case 1:return[2,n.sent()]}})})})}var ge;(function(e){e.Create=On.factory();function t(s){return!!s&&s.type.typeClass==="Representation3D"}e.isRepresentation3D=t;function r(s){return!!s&&s.type.typeClass==="Behavior"}e.isBehavior=r;function n(s){return e.Create(E(E({},s),{typeClass:"Representation3D"}))}e.CreateRepresentation3D=n;function a(s){return e.Create(E(E({},s),{typeClass:"Behavior"}))}e.CreateBehavior=a;var i=function(s){Be(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Root",typeClass:"Root"}));e.Root=i;var o=function(s){Be(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Group",typeClass:"Group"}));e.Group=o,function(s){var u=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"String Data",typeClass:"Data"}));s.String=u;var l=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Binary Data",typeClass:"Data"}));s.Binary=l;var c=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Data Blob",typeClass:"Data"}));s.Blob=c}(e.Data||(e.Data={})),function(s){var u=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"JSON Data",typeClass:"Data"}));s.Json=u;var l=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"CIF File",typeClass:"Data"}));s.Cif=l;var c=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"Cube File",typeClass:"Data"}));s.Cube=c;var d=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"PSF File",typeClass:"Data"}));s.Psf=d;var f=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"PLY File",typeClass:"Data"}));s.Ply=f;var h=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));s.Ccp4=h;var v=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));s.Dsn6=v;var p=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"DX File",typeClass:"Data"}));s.Dx=p;var g=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"Format Blob",typeClass:"Data"}));s.Blob=g}(e.Format||(e.Format={})),function(s){var u=function(h){Be(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Coordinates",typeClass:"Object"}));s.Coordinates=u;var l=function(h){Be(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Topology",typeClass:"Object"}));s.Topology=l;var c=function(h){Be(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Model",typeClass:"Object"}));s.Model=c;var d=function(h){Be(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Trajectory",typeClass:"Object"}));s.Trajectory=d;var f=function(h){Be(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Structure",typeClass:"Object"}));s.Structure=f,function(h){var v=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(n({name:"Structure 3D"}));h.Representation3D=v;var p=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"Structure 3D State",typeClass:"Object"}));h.Representation3DState=p;var g=function(m){Be(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y}(e.Create({name:"Selections",typeClass:"Object"}));h.Selections=g}(f=s.Structure||(s.Structure={}))}(e.Molecule||(e.Molecule={})),function(s){var u=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Volume",typeClass:"Object"}));s.Data=u;var l=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Lazy Volume",typeClass:"Object"}));s.Lazy=l;var c=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(n({name:"Volume 3D"}));s.Representation3D=c}(e.Volume||(e.Volume={})),function(s){var u=function(c){Be(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(e.Create({name:"Shape Provider",typeClass:"Object"}));s.Provider=u;var l=function(c){Be(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(n({name:"Shape 3D"}));s.Representation3D=l}(e.Shape||(e.Shape={}))})(ge||(ge={}));var kt;(function(e){e.CreateBuiltIn=vt.factory("ms-plugin"),e.BuiltIn=vt.builderFactory("ms-plugin")})(kt||(kt={}));var aU=.529177210859;function rke(e){var t=It.readLines(e,6),r=function(D,k){var R=+t[D].trim().split(/\s+/g)[k];return Number.isNaN(R)?0:R},n=function(D){var k=r(D+2,0),R=aU;return[Math.abs(k),_.create(r(D+2,1)*R,r(D+2,2)*R,r(D+2,3)*R),k]},a=t[0].trim(),i=t[1].trim(),o=n(0),s=o[0],u=o[1],l=o[2],c=n(1),d=c[0],f=c[1],h=n(2),v=h[0],p=h[1],g=n(3),m=g[0],y=g[1],b=nke(e,s,aU),S=[];if(l>=0){var x=r(2,4);x===0&&(x=1);for(var C=0;C<x;C++)S.push(C)}else for(var w=It.readLine(e).trim().split(/\s+/g),C=0,A=+w[0];C<A;C++)S.push(+w[C+1]);var I={orbitals:l<0,comment1:a,comment2:i,atomCount:s,origin:u,dim:_.create(d,v,m),basisX:f,basisY:p,basisZ:y,dataSetIds:S};return{header:I,atoms:b}}function nke(e,t,r){for(var n=new Int32Array(t),a=new Float64Array(t),i=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t),u=0;u<t;u++){var l=It.readLine(e).trim().split(/\s+/g);n[u]=+l[0],a[u]=+l[1],i[u]=+l[2]*r,o[u]=+l[3]*r,s[u]=+l[4]*r}return{count:t,number:me.ofArray({array:n,schema:me.Schema.int}),nuclearCharge:me.ofArray({array:a,schema:me.Schema.float}),x:me.ofArray({array:i,schema:me.Schema.float}),y:me.ofArray({array:o,schema:me.Schema.float}),z:me.ofArray({array:s,schema:me.Schema.float})}}function ake(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,a=100*100*100,i=new Float64Array(n),o=0;return qc(e,a,i,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)It.skipWhitespace(t),t.tokenStart=t.position,It.eatValue(t),u[c]=Mc(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:a},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function ike(e,t){var r=this;return et.create("Parse Cube",function(n){return de(r,void 0,void 0,function(){var a,i,o,s,u;return fe(this,function(l){switch(l.label){case 0:return[4,n.update("Reading header...")];case 1:return l.sent(),a=It(e),i=rke(a),o=i.header,s=i.atoms,[4,ake(n,a,o)];case 2:return u=l.sent(),[2,In.success({header:o,atoms:s,values:u,name:t})]}})})})}function jK(e){for(var t={h:_()},r=0,n=0,a=/\s+/g;;){var i=It.readLine(e),o=void 0;if(i.startsWith("object 1"))o=i.split(a),t.dim=_.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(i.startsWith("origin"))o=i.split(a),t.min=_.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(i.startsWith("delta"))o=i.split(a),n===0?t.h[0]=parseFloat(o[1]):n===1?t.h[1]=parseFloat(o[2]):n===2&&(t.h[2]=parseFloat(o[3])),n+=1;else if(i.startsWith("object 3")){r+=i.length+1;break}r+=i.length+1}return{header:t,headerByteCount:r}}function oke(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2],a=100*100*100,i=new Float64Array(n),o=0;return qc(e,a,i,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)It.skipWhitespace(t),t.tokenStart=t.position,It.eatValue(t),u[c]=Mc(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:a},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function ske(e,t,r){return de(this,void 0,void 0,function(){var n,a,i;return fe(this,function(o){switch(o.label){case 0:return[4,e.update("Reading header...")];case 1:return o.sent(),n=It(t),a=jK(n).header,[4,e.update("Reading values...")];case 2:return o.sent(),[4,oke(e,n,a)];case 3:return i=o.sent(),[2,In.success({header:a,values:i,name:r})]}})})}function uke(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:return[4,e.update("Reading header...")];case 1:return f.sent(),n=mk(t,0,1e3),a=It(n),i=jK(a),o=i.header,s=i.headerByteCount,[4,e.update("Reading values...")];case 2:for(f.sent(),u=o.dim[0]*o.dim[1]*o.dim[2],l=new DataView(t.buffer,t.byteOffset+s),c=new Float64Array(u),d=0;d<u;d++)c[d]=l.getFloat64(d*8,!0);return[2,In.success({header:o,values:c,name:r})]}})})}function lke(e,t){return et.create("Parse Cube",function(r){return typeof e=="string"?ske(r,e,t):uke(r,e,t)})}var zK=kt.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[ge.Root],to:[ge.Data.String,ge.Data.Binary],params:{url:T.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:T.Optional(T.Text("")),isBinary:T.Optional(T.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return et.create("Download",function(i){return de(r,void 0,void 0,function(){var o,s;return fe(this,function(u){switch(u.label){case 0:return o=Pn.getUrlAsset(t.managers.asset,n.url),[4,t.managers.asset.resolve(o,n.isBinary?"binary":"string").runInContext(i)];case 1:return s=u.sent(),a.asset=s,[2,n.isBinary?new ge.Data.Binary(s.data,{label:n.label?n.label:o.url}):new ge.Data.String(s.data,{label:n.label?n.label:o.url})]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.url!==r.url||t.isBinary!==r.isBinary?vt.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||(typeof r.url=="string"?r.url:r.url.url),vt.UpdateResult.Updated):vt.UpdateResult.Unchanged}}),VK=kt.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:ge.Root,to:ge.Data.Blob,params:{sources:T.ObjectList({id:T.Text("",{label:"Unique ID"}),url:T.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:T.Optional(T.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:T.Optional(T.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},function(e){return e.id+": "+e.url}),maxConcurrency:T.Optional(T.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return et.create("Download Blob",function(i){return de(r,void 0,void 0,function(){var o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:return o=[],[4,Z3e(i,t.managers.asset,n.sources,n.maxConcurrency||4)];case 1:for(s=f.sent(),u=[],l=0;l<s.length;l++)c=s[l],d=n.sources[l],c.kind==="error"?t.log.warn("Download "+c.id+" ("+d.url+") failed: "+c.error):(u.push(c.result),o.push(d.isBinary?{id:c.id,kind:"binary",data:c.result.data}:{id:c.id,kind:"string",data:c.result.data}));return a.assets=u,[2,new ge.Data.Blob(o,{label:"Data Blob",description:o.length+" "+(o.length===1?"entry":"entries")})]}})})})},dispose:function(e,t){var r,n=e.cache,a=(r=n)===null||r===void 0?void 0:r.assets;if(a)for(var i=0,o=a;i<o.length;i++){var s=o[i];s.dispose()}}}),HK=kt.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[ge.Root],to:[ge.Data.String,ge.Data.Binary],params:{data:T.Value("",{isHidden:!0}),label:T.Optional(T.Text(""))}})({apply:function(e){var t=this,r=e.params;return et.create("Raw Data",function(){return de(t,void 0,void 0,function(){return fe(this,function(n){if(typeof r.data=="string")return[2,new ge.Data.String(r.data,{label:r.label?r.label:"String"})];if(Array.isArray(r.data))return[2,new ge.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof ArrayBuffer)return[2,new ge.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof Uint8Array)return[2,new ge.Data.Binary(r.data,{label:r.label?r.label:"Binary"})];throw new Error("Supplied binary data must be a plain array, ArrayBuffer, or Uint8Array.")})})})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?vt.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||n.label,vt.UpdateResult.Updated):vt.UpdateResult.Unchanged},customSerialization:{toJSON:function(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){for(var t=new Uint8Array(e.data),r=new Array(t.length),n=0,a=t.length;n<a;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){for(var r=new Array(e.data.length),n=0,a=e.data.length;n<a;n++)r[n]=e.data[n];return{data:r,label:e.label}}},fromJSON:function(e){return e}}}),GK=kt.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:ge.Root,to:[ge.Data.String,ge.Data.Binary],params:{file:T.File(),label:T.Optional(T.Text("")),isBinary:T.Optional(T.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return et.create("Open File",function(i){return de(r,void 0,void 0,function(){var o,s;return fe(this,function(u){switch(u.label){case 0:return n.file===null?(t.log.error("No file(s) selected"),[2,On.Null]):[4,t.managers.asset.resolve(n.file,n.isBinary?"binary":"string").runInContext(i)];case 1:return o=u.sent(),a.asset=o,s=n.isBinary?new ge.Data.Binary(o.data,{label:n.label?n.label:n.file.name}):new ge.Data.String(o.data,{label:n.label?n.label:n.file.name}),[2,s]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t,r=e.oldParams,n=e.newParams,a=e.b;return r.label!==n.label?(a.label=n.label||((t=r.file)===null||t===void 0?void 0:t.name)||"",vt.UpdateResult.Updated):vt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}}),cke=kt.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:ge.Data.Blob,to:ge.Format.Blob,params:{formats:T.ObjectList({id:T.Text("",{label:"Unique ID"}),format:T.Select("cif",[["cif","cif"]])},function(e){return e.id+": "+e.format})}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Parse Blob",function(i){return de(r,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:for(o=new Map,s=0,u=a.formats;s<u.length;s++)l=u[s],o.set(l.id,l.format);c=[],d=0,f=n.data,p.label=1;case 1:return d<f.length?(h=f[d],o.has(h.id)?[4,(h.kind==="string"?Xc.parse(h.data):Xc.parseBinary(h.data)).runInContext(i)]:[3,3]):[3,4];case 2:if(v=p.sent(),v.isError)throw new Error(h.id+": "+v.message);c.push({id:h.id,kind:"cif",data:v.result}),p.label=3;case 3:return d++,[3,1];case 4:return[2,new ge.Format.Blob(c,{label:"Format Blob",description:c.length+" "+(c.length===1?"entry":"entries")})]}})})})}}),dke=kt.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[ge.Data.String,ge.Data.Binary],to:ge.Format.Cif})({apply:function(e){var t=this,r=e.a;return et.create("Parse CIF",function(n){return de(t,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,(ge.Data.String.is(r)?Xc.parse(r.data):Xc.parseBinary(r.data)).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Cif(a.result)]}})})})}}),fke=kt.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:ge.Data.String,to:ge.Format.Cube})({apply:function(e){var t=this,r=e.a;return et.create("Parse Cube",function(n){return de(t,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,ike(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Cube(a.result)]}})})})}}),hke=kt.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[ge.Data.String],to:ge.Format.Psf})({apply:function(e){var t=this,r=e.a;return et.create("Parse PSF",function(n){return de(t,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,tke(r.data).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Psf(a.result)]}})})})}}),pke=kt.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[ge.Data.String],to:ge.Format.Ply})({apply:function(e){var t=this,r=e.a;return et.create("Parse PLY",function(n){return de(t,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,$Re(r.data).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Ply(a.result,{label:a.result.comments[0]||"PLY Data"})]}})})})}}),vke=kt.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[ge.Data.Binary],to:ge.Format.Ccp4})({apply:function(e){var t=this,r=e.a;return et.create("Parse CCP4/MRC/MAP",function(n){return de(t,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,TRe(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Ccp4(a.result)]}})})})}}),mke=kt.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[ge.Data.Binary],to:ge.Format.Dsn6})({apply:function(e){var t=this,r=e.a;return et.create("Parse DSN6/BRIX",function(n){return de(t,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,NRe(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Dsn6(a.result)]}})})})}}),gke=kt.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[ge.Data.Binary,ge.Data.String],to:ge.Format.Dx})({apply:function(e){var t=this,r=e.a;return et.create("Parse DX",function(n){return de(t,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,lke(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Dx(a.result)]}})})})}}),yke=kt.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:ge.Root,to:ge.Data.String,params:{data:T.Value(""),label:T.Optional(T.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new ge.Data.String(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?vt.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",vt.UpdateResult.Updated):vt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported strings."}}}),bke=kt.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:ge.Root,to:ge.Format.Json,params:{data:T.Value({}),label:T.Optional(T.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new ge.Format.Json(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?vt.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",vt.UpdateResult.Updated):vt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported JSON."}}}),xke=kt.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[ge.Data.String],to:ge.Format.Json})({apply:function(e){var t=this,r=e.a;return et.create("Parse JSON",function(n){return de(t,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,new Response(r.data).json()];case 1:return a=i.sent(),[2,new ge.Format.Json(a)]}})})})}}),Ske=kt.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:ge.Root,to:ge.Volume.Lazy,params:{url:T.Url(""),isBinary:T.Boolean(!1),format:T.Text("ccp4"),entryId:T.Value("",{isHidden:!0}),isovalues:T.ObjectList({type:T.Text("relative"),value:T.Numeric(0),color:T.Color(dr.black),alpha:T.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:T.Numeric(0)},function(e){return e.type+" "+e.value})}})({apply:function(e){var t=this;e.a;var r=e.params;return et.create("Lazy Volume",function(n){return de(t,void 0,void 0,function(){var a;return fe(this,function(i){return a=Array.isArray(r.entryId)?r.entryId.join(", "):r.entryId,[2,new ge.Volume.Lazy(r,{label:""+(a||r.url),description:"Lazy Volume"})]})})})}});const Cke=Object.freeze(Object.defineProperty({__proto__:null,Download:zK,DownloadBlob:VK,ImportJson:bke,ImportString:yke,LazyVolume:Ske,ParseBlob:cke,ParseCcp4:vke,ParseCif:dke,ParseCube:fke,ParseDsn6:mke,ParseDx:gke,ParseJson:xke,ParsePly:pke,ParsePsf:hke,RawData:HK,ReadFile:GK},Symbol.toStringTag,{value:"Module"}));var _ke=kt.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:ge.Group,params:{label:T.Text("Group"),description:T.Optional(T.Text(""))}})({apply:function(e){var t=e.params;return new ge.Group({},t)},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return Cg(t,r)?vt.UpdateResult.Unchanged:(n.label=r.label,n.description=r.description,vt.UpdateResult.Updated)}});const wke=Object.freeze(Object.defineProperty({__proto__:null,CreateGroup:_ke},Symbol.toStringTag,{value:"Module"}));function Eke(e){var t=new DataView(e.buffer),r=Object.create(null),n=[],a=0,i=new Int32Array(e.buffer,0,23),o=i[0]!==t.getInt32(0);if(i[0]!==84)for(var s=e.byteLength,u=0;u<s;u+=4)t.setFloat32(u,t.getFloat32(u),!0);if(i[0]!==84)throw new Error("dcd bad format, header block start");var l=String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7));if(l!=="CORD")throw new Error("dcd bad format, format string");var c=!1,d=!1,f=!1;if(i[22]!==0&&(c=!0,i[12]!==0&&(d=!0),i[13]===1&&(f=!0)),r.NSET=i[2],r.ISTART=i[3],r.NSAVC=i[4],r.NAMNF=i[10],c?r.DELTA=t.getFloat32(44,o):r.DELTA=t.getFloat64(44,o),i[22]!==84)throw new Error("dcd bad format, header block end");a=a+21*4+8;var h=t.getInt32(a,o),v=a+1;if((h-4)%80!==0)throw new Error("dcd bad format, title block start");if(r.TITLE=yTe(e.subarray(v,h)),t.getInt32(v+h+4-1,o)!==h)throw new Error("dcd bad format, title block end");if(a=a+h+8,t.getInt32(a,o)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(a+4,o),t.getInt32(a+8,o)!==4)throw new Error("dcd bad format, natom block end");if(a=a+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");for(var p=r.NATOM,g=p*4,u=0,s=r.NSET;u<s;++u){var m=Object.create(null);m.elementCount=p,d&&(a+=4,m.cell=[t.getFloat64(a,o),t.getFloat64(a+1,o),t.getFloat64(a+2*8,o),t.getFloat64(a+3*8,o),t.getFloat64(a+4*8,o),t.getFloat64(a+5*8,o)],a+=48,a+=4);for(var y=0;y<3;++y){if(t.getInt32(a,o)!==g)throw new Error("dcd bad format, coord block start: "+u+", "+y);a+=4;var b=new Float32Array(e.buffer,a,p);if(y===0?m.x=b:y===1?m.y=b:m.z=b,a+=g,t.getInt32(a,o)!==g)throw new Error("dcd bad format, coord block end: "+u+", "+y);a+=4}if(f){var S=t.getInt32(a,o);a+=4+S+4}n.push(m)}return{header:r,frames:n}}function Ake(e){var t=this;return et.create("Parse DCD",function(r){return de(t,void 0,void 0,function(){var n;return fe(this,function(a){try{return n=Eke(e),[2,In.success(n)]}catch(i){return[2,In.error(i)]}return[2]})})})}function Pke(e){return function(t,r,n){return Tke(e,t,r,n)}}function Tke(e,t,r,n){var a=e.data,i=e.indices,o=e.count,s=n.valueType,u=s==="str"?function(l){var c=i[2*l]+t,d=i[2*l+1];if(c>=d)return"";var f=c+r;return f>d&&(f=d),YPe(a,c,f)}:s==="int"?function(l){var c=i[2*l]+t;return c>i[2*l+1]?0:Xh(a,c,c+r)}:function(l){var c=i[2*l]+t;return c>i[2*l+1]?0:jSe(a,c,c+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:o,value:u,valueKind:function(l){return 0},toArray:function(l){return ti(o,u,l)},areValuesEqual:function(l,c){return u(l)===u(c)}}}function Ike(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function Mke(e,t){return{tokenizer:e,header:Ike(),numberOfAtoms:0,runtimeCtx:t}}function Dke(e){var t=e.tokenizer,r=e.header,n=It.readLine(t);n.trim().length===0&&(n=It.readLine(t));var a=n.lastIndexOf("t=");a>=0?(r.timeInPs=parseFloat(n.substring(a+2)),r.title=n.substring(0,a).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function Rke(e){var t=e.tokenizer;It.markLine(t);var r=It.getTokenString(t);e.numberOfAtoms=parseInt(r)}function kke(e){return de(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,h;return fe(this,function(v){switch(v.label){case 0:return t=e.tokenizer,r=e.numberOfAtoms,[4,It.readLinesAsync(t,r,e.runtimeCtx,1e5)];case 1:return n=v.sent(),a=t.data.substring(n.indices[0],n.indices[1]).substring(20),i=a.match(/\.\d+/g),o=i.length===6,e.header.hasVelocities=o,e.header.precision.position=i[0].length-1,e.header.precision.velocity=o?i[3].length-1:0,s=20,u=e.header.precision.position+5,l=s+3*u,c=e.header.precision.velocity+4,d=Pke(n),f=me.Undefined(e.numberOfAtoms,me.Schema.float),h={count:e.numberOfAtoms,residueNumber:d(0,5,me.Schema.int),residueName:d(5,5,me.Schema.str),atomName:d(10,5,me.Schema.str),atomNumber:d(15,5,me.Schema.int),x:d(s,u,me.Schema.float),y:d(s+u,u,me.Schema.float),z:d(s+2*u,u,me.Schema.float),vx:o?d(l,c,me.Schema.float):f,vy:o?d(l+c,c,me.Schema.float):f,vz:o?d(l+2*c,c,me.Schema.float):f},[2,h]}})})}function Oke(e){var t=e.tokenizer,r=It.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}function Lke(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o;return fe(this,function(s){switch(s.label){case 0:return r=It(e),[4,t.update({message:"Parsing...",current:0,max:e.length})];case 1:s.sent(),n=[],s.label=2;case 2:return r.position<e.length?(a=Mke(r,t),Dke(a),Rke(a),[4,kke(a)]):[3,4];case 3:return i=s.sent(),Oke(a),n.push({header:a.header,atoms:i}),[3,2];case 4:return o={structures:n},[2,In.success(o)]}})})}function Nke(e){var t=this;return et.create("Parse GRO",function(r){return de(t,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return[4,Lke(e,r)];case 1:return[2,n.sent()]}})})})}function Fke(e,t,r){var n=this;return r===void 0&&(r=!1),et.create("Parse PDB",function(a){return de(n,void 0,void 0,function(){var i,o,s;return fe(this,function(u){switch(u.label){case 0:return o=(i=In).success,s={},[4,It.readAllLinesAsync(e,a)];case 1:return[2,o.apply(i,[(s.lines=u.sent(),s.id=t,s.isPdbqt=r,s)])]}})})})}function Bke(e,t){for(var r=0,n=t*3;r<n;r+=3){var a=e[r],i=e[r+1],o=e[r+2],s=1/Math.sqrt(a*a+i*i+o*o);e[r]=a*s,e[r+1]=i*s,e[r+2]=o*s}return e}var bo=_();function Kp(e,t,r,n){for(var a=0,i=n*3;a<i;a+=3)_.fromArray(bo,t,r+a),_.transformMat4(bo,bo,e),_.toArray(bo,t,r+a)}function Uke(e,t,r,n){for(var a=0,i=n*3;a<i;a+=3)_.fromArray(bo,t,r+a),_.transformMat3(bo,bo,e),_.toArray(bo,t,r+a)}function jke(e,t){for(var r=0,n=e.length;r<n;r+=3)_.fromArray(bo,e,r),_.normalize(bo,bo),_.scale(bo,bo,t),_.toArray(bo,e,r)}var iU=_(),wP=_(),oU=_(),vs=_(),sU=_();function qK(e,t,r,n,a){for(var i=0,o=a*3;i<o;i+=3){var s=t[i]*3,u=t[i+1]*3,l=t[i+2]*3;_.fromArray(iU,e,s),_.fromArray(wP,e,u),_.fromArray(oU,e,l),_.sub(vs,oU,wP),_.sub(sU,iU,wP),_.cross(vs,vs,sU),r[s]+=vs[0],r[s+1]+=vs[1],r[s+2]+=vs[2],r[u]+=vs[0],r[u+1]+=vs[1],r[u+2]+=vs[2],r[l]+=vs[0],r[l+1]+=vs[1],r[l+2]+=vs[2]}return Bke(r,n)}function t0(e,t,r){r===void 0&&(r=1);for(var n=Ml(e),a=new Int32Array(n+2),i=new Int32Array(t),o=new Int32Array(t),s=0,u=t*r;s<u;s+=r)++o[e[s]];for(var l=0,s=0;s<t;s++)a[s]=l,l+=o[s];a[t]=l;for(var c=new Int32Array(l),s=0,u=t*r;s<u;s+=r){var d=e[s],f=a[d]+i[d];c[f]=s,++i[d]}return{indices:c,offsets:a}}function zke(e,t){e=Math.max(e,2);var r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;var a=n>0?Math.ceil(e/n):0;return{width:n,height:a,length:n*a*t}}function bi(e,t,r,n){var a=zke(e,t),i=a.length,o=a.width,s=a.height;return n=n&&n.length>=i?n:new r(i),{array:n,width:o,height:s}}var Ps=_(),Vke=new ls("14"),Hke=new ls("98");function WK(e){return e>1e5?Vke:Hke}function nh(e,t,r){var n=r*3,a=WK(t);a.reset();for(var i=0,o=t*3;i<o;i+=n)_.fromArray(Ps,e,i),a.includePosition(Ps);a.finishedIncludeStep();for(var i=0,o=t*3;i<o;i+=n)_.fromArray(Ps,e,i),a.radiusPosition(Ps);var s=a.getSphere();if(t<=98){for(var u=[],i=0,o=t*3;i<o;i+=n)u.push(_.fromArray(_(),e,i));je.setExtrema(s,u)}return s}var EP=le();function Xa(e,t,r){if(r===1){le.fromArray(EP,t,0);var n=je.clone(e);return le.isIdentity(EP)?n:je.transform(n,n,EP)}var a=WK(r);a.reset();var i=e.center,o=e.radius,s=e.extrema;if(s&&r<50){for(var u=0,l=r;u<l;++u)for(var c=0,d=s;c<d.length;c++){var f=d[c];_.transformMat4Offset(Ps,f,t,0,0,u*16),a.includePosition(Ps)}a.finishedIncludeStep();for(var u=0,l=r;u<l;++u)for(var h=0,v=s;h<v.length;h++){var f=v[h];_.transformMat4Offset(Ps,f,t,0,0,u*16),a.radiusPosition(Ps)}}else{for(var u=0,l=r;u<l;++u)_.transformMat4Offset(Ps,i,t,0,0,u*16),a.includePositionRadius(Ps,o);a.finishedIncludeStep();for(var u=0,l=r;u<l;++u)_.transformMat4Offset(Ps,i,t,0,0,u*16),a.radiusPositionRadius(Ps,o)}return a.getSphere()}function Js(e,t){var r=bi(Math.max(1,e),1,Uint8Array,t&&t.tMarker.ref.value.array);return t?(N.update(t.tMarker,r),N.update(t.uMarkerTexDim,Ke.create(r.width,r.height)),t):{tMarker:N.create(r),uMarkerTexDim:N.create(Ke.create(r.width,r.height))}}var $K=new ArrayBuffer(4),Gke=new Int32Array($K),qke=new Float32Array($K);function Wke(e){var t=e<-126?-126:e;return Gke[0]=(1<<23)*(t+126.94269504),qke[0]}function $ke(e){return Wke(1.44269504*e)}var XK=new ArrayBuffer(4),Xke=new Int32Array(XK),Yke=new Float32Array(XK);function Kke(e){Yke[0]=e;var t=Xke[0]*11920928955078125e-23;return t-126.94269504}function Qke(e){return .6931471805599453*Kke(e)}var Zke=1e4;Qke(Zke+1);function Ob(e,t,r){return e=ki(e,0,16777216-1)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function Yk(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var Z2=255/256,AP=_.create(256*256*256,256*256,256),Jke=wr.create(Z2/AP[0],Z2/AP[1],Z2/AP[2],Z2/1),uU=wr();function eOe(e,t,r,n){return wr.set(uU,e/255,t/255,r/255,n/255),wr.dot(uU,Jke)}function hd(e,t,r){switch(oi.getGranularity(e,t.granularity)){case"uniform":return aOe(e,t.size,r);case"group":return oOe(e,t.size,r);case"groupInstance":return sOe(e,t.size,r);case"instance":return iOe(e,t.size,r)}}var I3=100;function ab(e){var t=e.dSizeType.ref.value;switch(t){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var r=0,n=e.tSize.ref.value.array,a=0,i=n.length;a<i;a+=3){var o=Yk(n[a],n[a+1],n[a+2]);r<o&&(r=o)}return r/I3}}var tOe={array:new Uint8Array(3),width:1,height:1};function rOe(){return{tSize:N.create(tOe),uSizeTexDim:N.create(Ke.create(1,1))}}function nOe(e,t){return t?(N.update(t.uSize,e),N.updateIfChanged(t.dSizeType,"uniform"),t):E(E({uSize:N.create(e)},rOe()),{dSizeType:N.create("uniform")})}function aOe(e,t,r){return nOe(t(ns),r)}function Kk(e,t,r){return r?(N.update(r.tSize,e),N.update(r.uSizeTexDim,Ke.create(e.width,e.height)),N.updateIfChanged(r.dSizeType,t),r):{uSize:N.create(0),tSize:N.create(e),uSizeTexDim:N.create(Ke.create(e.width,e.height)),dSizeType:N.create(t)}}function iOe(e,t,r){var n=e.instanceCount,a=bi(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();Ob(t(i.location)*I3,a.array,i.instanceIndex*3),e.skipInstance()}return Kk(a,"instance",r)}function oOe(e,t,r){var n=e.groupCount,a=bi(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();Ob(t(i.location)*I3,a.array,i.groupIndex*3)}return Kk(a,"group",r)}function sOe(e,t,r){var n=e.groupCount,a=e.instanceCount,i=a*n,o=bi(Math.max(1,i),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){var s=e.move();Ob(t(s.location)*I3,o.array,s.index*3)}return Kk(o,"groupInstance",r)}function uOe(e,t,r,n){for(var a=t;a<r;++a)dt.toArray(n,e,a*4),e[a*4+3]=255;return!0}function lU(e,t,r){return e.fill(0,t*4,r*4),!0}function lOe(e,t){var r=bi(Math.max(1,e),4,Uint8Array,t&&t.tOverpaint.ref.value.array);return t?(N.update(t.tOverpaint,r),N.update(t.uOverpaintTexDim,Ke.create(r.width,r.height)),N.updateIfChanged(t.dOverpaint,e>0),t):{tOverpaint:N.create(r),uOverpaintTexDim:N.create(Ke.create(r.width,r.height)),dOverpaint:N.create(e>0)}}var cU={array:new Uint8Array(4),width:1,height:1};function pd(e){return e?(N.update(e.tOverpaint,cU),N.update(e.uOverpaintTexDim,Ke.create(1,1)),e):{tOverpaint:N.create(cU),uOverpaintTexDim:N.create(Ke.create(1,1)),dOverpaint:N.create(!1)}}function cOe(e,t,r,n){for(var a=t;a<r;++a)e[a]=n*255;return!0}function YK(e,t){for(var r=0,n=0;n<t;++n)r+=e[n];return r/(255*t)}function dOe(e,t,r){e.fill(0,t,r)}function fOe(e,t){var r=bi(Math.max(1,e),1,Uint8Array,t&&t.tTransparency.ref.value.array);return t?(N.update(t.tTransparency,r),N.update(t.uTransparencyTexDim,Ke.create(r.width,r.height)),N.updateIfChanged(t.dTransparency,e>0),N.updateIfChanged(t.transparencyAverage,YK(r.array,e)),t):{tTransparency:N.create(r),uTransparencyTexDim:N.create(Ke.create(r.width,r.height)),dTransparency:N.create(e>0),transparencyAverage:N.create(0)}}var dU={array:new Uint8Array(1),width:1,height:1};function vd(e){return e?(N.update(e.tTransparency,dU),N.update(e.uTransparencyTexDim,Ke.create(1,1)),e):{tTransparency:N.create(dU),uTransparencyTexDim:N.create(Ke.create(1,1)),dTransparency:N.create(!1),transparencyAverage:N.create(0)}}function hOe(e,t,r,n){for(var a=t;a<r;++a)e[a]=n;return!0}function pOe(e,t,r){e.fill(0,t,r)}function vOe(e,t){var r=bi(Math.max(1,e),1,Uint8Array,t&&t.tClipping.ref.value.array);return t?(N.update(t.tClipping,r),N.update(t.uClippingTexDim,Ke.create(r.width,r.height)),N.updateIfChanged(t.dClipping,e>0),t):{dClipObjectCount:N.create(0),dClipVariant:N.create("instance"),tClipping:N.create(r),uClippingTexDim:N.create(Ke.create(r.width,r.height)),dClipping:N.create(e>0)}}var fU={array:new Uint8Array(1),width:1,height:1};function md(e){return e?(N.update(e.tClipping,fU),N.update(e.uClippingTexDim,Ke.create(1,1)),e):{dClipObjectCount:N.create(0),dClipVariant:N.create("instance"),tClipping:N.create(fU),uClippingTexDim:N.create(Ke.create(1,1)),dClipping:N.create(!1)}}var Qp;(function(e){function t(v,p,g,m){return m?i(v,p,g,m):a(v,p,g)}e.create=t;function r(v){var p=v?v.centerBuffer.ref.value:new Float32Array(0),g=v?v.groupBuffer.ref.value:new Float32Array(0);return t(p,g,0,v)}e.createEmpty=r;function n(v){return Ui([v.pointCount,v.centerBuffer.ref.version,v.groupBuffer.ref.version])}function a(v,p,g){var m=je(),y,b=-1,S=-1,x={kind:"points",pointCount:g,centerBuffer:N.create(v),groupBuffer:N.create(p),get boundingSphere(){var C=n(x);if(C!==b){var w=nh(x.centerBuffer.ref.value,x.pointCount,1);je.copy(m,w),b=C}return m},get groupMapping(){return x.groupBuffer.ref.version!==S&&(y=t0(x.groupBuffer.ref.value,x.pointCount),S=x.groupBuffer.ref.version),y},setBoundingSphere:function(C){je.copy(m,C),b=n(x)}};return x}function i(v,p,g,m){return m.pointCount=g,N.update(m.centerBuffer,v),N.update(m.groupBuffer,p),m}function o(v,p){var g=v.centerBuffer.ref.value;Kp(p,g,0,v.pointCount),N.update(v.centerBuffer,g)}e.transform=o,e.Params=E(E({},At.Params),{sizeFactor:T.Numeric(1.5,{min:0,max:10,step:.1}),pointSizeAttenuation:T.Boolean(!1),pointFilledCircle:T.Boolean(!1),pointEdgeBleach:T.Numeric(.2,{min:0,max:1,step:.05})}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:h,createPositionIterator:s};function s(v,p){var g=v.pointCount,m=p.instanceCount.ref.value,y=pv(),b=y.position,S=v.centerBuffer.ref.value,x=p.aTransform.ref.value,C=function(w,A){return A<0?_.fromArray(b,S,w*3):_.transformMat4Offset(b,S,x,0,w*3,A*16),y};return bn(g,m,1,C)}function u(v,p,g,m,y){var b=g.instanceCount,S=g.groupCount,x=s(v,p),C=cs(g,x,m.color),w=hd(g,m.size),A=Js(b*S),I=pd(),D=vd(),k=md(),R={drawCount:v.pointCount,vertexCount:v.pointCount,groupCount:S,instanceCount:b},L=je.clone(v.boundingSphere),H=Xa(L,p.aTransform.ref.value,b);return E(E(E(E(E(E(E(E(E({aPosition:v.centerBuffer,aGroup:v.groupBuffer,boundingSphere:N.create(H),invariantBoundingSphere:N.create(L),uInvariantBoundingSphere:N.create(wr.ofSphere(L))},C),w),A),I),D),k),p),At.createValues(y,R)),{uSizeFactor:N.create(y.sizeFactor),dPointSizeAttenuation:N.create(y.pointSizeAttenuation),dPointFilledCircle:N.create(y.pointFilledCircle),uPointEdgeBleach:N.create(y.pointEdgeBleach)})}function l(v,p,g,m,y){var b=At.createSimple(g,m,y),S=E(E({},T.getDefaultValues(e.Params)),p);return u(v,b.transform,b.locationIterator,b.theme,S)}function c(v,p){At.updateValues(v,p),N.updateIfChanged(v.uSizeFactor,p.sizeFactor),N.updateIfChanged(v.dPointSizeAttenuation,p.pointSizeAttenuation),N.updateIfChanged(v.dPointFilledCircle,p.pointFilledCircle),N.updateIfChanged(v.uPointEdgeBleach,p.pointEdgeBleach)}function d(v,p){var g=je.clone(p.boundingSphere),m=Xa(g,v.aTransform.ref.value,v.instanceCount.ref.value);je.equals(m,v.boundingSphere.ref.value)||N.update(v.boundingSphere,m),je.equals(g,v.invariantBoundingSphere.ref.value)||(N.update(v.invariantBoundingSphere,g),N.update(v.uInvariantBoundingSphere,wr.fromSphere(v.uInvariantBoundingSphere.ref.value,g)))}function f(v){var p=At.createRenderableState(v);return h(p,v),p}function h(v,p){At.updateRenderableState(v,p),v.opaque=v.opaque&&(!p.pointFilledCircle||p.pointFilledCircle&&p.pointEdgeBleach===0),v.writeDepth=v.opaque}})(Qp||(Qp={}));function hU(e,t,r,n,a,i,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];pU(n,a,i,o,r);for(var u=0;u<r;u++)e[u*t+s]=a[u]}for(var u=0;u<r;u++){for(var s=0;s<t;s++)n[s]=e[u*t+s];pU(n,a,i,o,t);for(var s=0;s<t;s++)e[u*t+s]=Math.sqrt(a[s])}}function pU(e,t,r,n,a){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(var i=1,o=0;i<a;i++){for(var s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);s<=n[o];)o--,s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);o++,r[o]=i,n[o]=s,n[o+1]=Number.MAX_SAFE_INTEGER}for(var i=0,o=0;i<a;i++){for(;n[o+1]<i;)o++;t[i]=(i-r[o])*(i-r[o])+e[r[o]]}}var PP={};function mOe(e){var t=JSON.stringify(e);return PP[t]===void 0&&(PP[t]=new gOe(e)),PP[t]}var KK={fontFamily:T.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:T.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:T.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:T.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:T.Select("normal",[["normal","Normal"],["bold","Bold"]])},gOe=function(){function e(t){t===void 0&&(t={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var r=E(E({},T.getDefaultValues(KK)),t);this.props=r;var n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=bi(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.maxWidth,this.scratchCanvas.height=this.lineHeight,this.scratchContext=this.scratchCanvas.getContext("2d"),this.scratchContext.font=r.fontStyle+" "+r.fontVariant+" "+r.fontWeight+" "+n+"px "+r.fontFamily,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}return e.prototype.get=function(t){if(this.mapped[t]===void 0){this.draw(t);var r=this.texture,n=r.array,a=r.width,i=r.height,o=this.scratchData;if(this.currentX+this.scratchW>a&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>i)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var s=0;s<this.scratchH;++s)for(var u=0;u<this.scratchW;++u)n[a*(this.currentY+s)+this.currentX+u]=o[s*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[t]},e.prototype.draw=function(t){var r=this.lineHeight,n=this.scratchContext,a=this.scratchData,i=n.measureText(t),o=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),s=o*r;n.clearRect(0,0,o,r),n.fillText(t,this.buffer,this.middle);for(var u=n.getImageData(0,0,o,r),l=0;l<s;l++){var c=u.data[l*4+3]/255;this.gridOuter[l]=c===1?0:c===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-c),2),this.gridInner[l]=c===1?Number.MAX_SAFE_INTEGER:c===0?0:Math.pow(Math.max(0,c-.5),2)}hU(this.gridOuter,o,r,this.f,this.d,this.v,this.z),hU(this.gridInner,o,r,this.f,this.d,this.v,this.z);for(var l=0;l<s;l++){var d=this.gridOuter[l]-this.gridInner[l];a[l]=Math.max(0,Math.min(255,Math.round(255-255*(d/this.radius+this.cutoff))))}this.scratchW=o,this.scratchH=r},e}(),$s;(function(e){function t(h,v,p,g,m,y,b,S,x){return x?i(h,v,p,g,m,y,b,S,x):a(h,v,p,g,m,y,b,S)}e.create=t;function r(h){var v=h?h.fontTexture.ref.value:bi(0,1,Uint8Array),p=h?h.centerBuffer.ref.value:new Float32Array(0),g=h?h.mappingBuffer.ref.value:new Float32Array(0),m=h?h.depthBuffer.ref.value:new Float32Array(0),y=h?h.indexBuffer.ref.value:new Uint32Array(0),b=h?h.groupBuffer.ref.value:new Float32Array(0),S=h?h.tcoordBuffer.ref.value:new Float32Array(0);return t(v,p,g,m,y,b,S,0,h)}e.createEmpty=r;function n(h){return Ui([h.charCount,h.fontTexture.ref.version,h.centerBuffer.ref.version,h.mappingBuffer.ref.version,h.depthBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version,h.tcoordBuffer.ref.version])}function a(h,v,p,g,m,y,b,S){var x=je(),C,w=-1,A=-1,I={kind:"text",charCount:S,fontTexture:N.create(h),centerBuffer:N.create(v),mappingBuffer:N.create(p),depthBuffer:N.create(g),indexBuffer:N.create(m),groupBuffer:N.create(y),tcoordBuffer:N.create(b),get boundingSphere(){var D=n(I);if(D!==w){var k=nh(I.centerBuffer.ref.value,I.charCount*4,4);je.copy(x,k),w=D}return x},get groupMapping(){return I.groupBuffer.ref.version!==A&&(C=t0(I.groupBuffer.ref.value,I.charCount,4),A=I.groupBuffer.ref.version),C},setBoundingSphere:function(D){je.copy(x,D),w=n(I)}};return I}function i(h,v,p,g,m,y,b,S,x){return x.charCount=S,N.update(x.fontTexture,h),N.update(x.centerBuffer,v),N.update(x.mappingBuffer,p),N.update(x.depthBuffer,g),N.update(x.indexBuffer,m),N.update(x.groupBuffer,y),N.update(x.tcoordBuffer,b),x}e.Params=E(E(E({},At.Params),KK),{sizeFactor:T.Numeric(1,{min:0,max:10,step:.1}),borderWidth:T.Numeric(0,{min:0,max:.5,step:.01}),borderColor:T.Color(dr.grey),offsetX:T.Numeric(0,{min:0,max:10,step:.1}),offsetY:T.Numeric(0,{min:0,max:10,step:.1}),offsetZ:T.Numeric(0,{min:0,max:10,step:.1}),background:T.Boolean(!1),backgroundMargin:T.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:T.Color(dr.grey),backgroundOpacity:T.Numeric(1,{min:0,max:1,step:.01}),tether:T.Boolean(!1),tetherLength:T.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:T.Numeric(.3,{min:0,max:1,step:.01}),attachment:T.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(h,v){var p=h.charCount*4,g=v.instanceCount.ref.value,m=pv(),y=m.position,b=h.centerBuffer.ref.value,S=v.aTransform.ref.value,x=function(C,w){return w<0?_.fromArray(y,b,C*3):_.transformMat4Offset(y,b,S,0,C*3,w*16),m};return bn(p,g,4,x)}function s(h,v,p,g,m){var y=p.instanceCount,b=p.groupCount,S=o(h,v),x=cs(p,S,g.color),C=hd(p,g.size),w=Js(y*b),A=pd(),I=vd(),D=md(),k={drawCount:h.charCount*2*3,vertexCount:h.charCount*4,groupCount:b,instanceCount:y},R=vU(h.mappingBuffer.ref.value,h.depthBuffer.ref.value,h.charCount,ab(C)),L=je.expand(je(),h.boundingSphere,R),H=Xa(L,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E(E({aPosition:h.centerBuffer,aMapping:h.mappingBuffer,aDepth:h.depthBuffer,aGroup:h.groupBuffer,elements:h.indexBuffer,boundingSphere:N.create(H),invariantBoundingSphere:N.create(L),uInvariantBoundingSphere:N.create(wr.ofSphere(L))},x),C),w),A),I),D),v),{aTexCoord:h.tcoordBuffer,tFont:h.fontTexture,padding:N.create(R)}),At.createValues(m,k)),{uSizeFactor:N.create(m.sizeFactor),uBorderWidth:N.create(ki(m.borderWidth/2,0,.5)),uBorderColor:N.create(dt.toArrayNormalized(m.borderColor,_.zero(),0)),uOffsetX:N.create(m.offsetX),uOffsetY:N.create(m.offsetY),uOffsetZ:N.create(m.offsetZ),uBackgroundColor:N.create(dt.toArrayNormalized(m.backgroundColor,_.zero(),0)),uBackgroundOpacity:N.create(m.backgroundOpacity)})}function u(h,v,p,g,m){var y=At.createSimple(p,g,m),b=E(E({},T.getDefaultValues(e.Params)),v);return s(h,y.transform,y.locationIterator,y.theme,b)}function l(h,v){At.updateValues(h,v),N.updateIfChanged(h.uSizeFactor,v.sizeFactor),N.updateIfChanged(h.uBorderWidth,v.borderWidth),dt.fromNormalizedArray(h.uBorderColor.ref.value,0)!==v.borderColor&&(dt.toArrayNormalized(v.borderColor,h.uBorderColor.ref.value,0),N.update(h.uBorderColor,h.uBorderColor.ref.value)),N.updateIfChanged(h.uOffsetX,v.offsetX),N.updateIfChanged(h.uOffsetY,v.offsetY),N.updateIfChanged(h.uOffsetZ,v.offsetZ),dt.fromNormalizedArray(h.uBackgroundColor.ref.value,0)!==v.backgroundColor&&(dt.toArrayNormalized(v.backgroundColor,h.uBackgroundColor.ref.value,0),N.update(h.uBackgroundColor,h.uBackgroundColor.ref.value)),N.updateIfChanged(h.uBackgroundOpacity,v.backgroundOpacity)}function c(h,v){var p=vU(h.aMapping.ref.value,h.aDepth.ref.value,v.charCount,ab(h)),g=je.expand(je(),v.boundingSphere,p),m=Xa(g,h.aTransform.ref.value,h.instanceCount.ref.value);je.equals(m,h.boundingSphere.ref.value)||N.update(h.boundingSphere,m),je.equals(g,h.invariantBoundingSphere.ref.value)||(N.update(h.invariantBoundingSphere,g),N.update(h.uInvariantBoundingSphere,wr.fromSphere(h.uInvariantBoundingSphere.ref.value,g))),N.update(h.padding,p)}function d(h){var v=At.createRenderableState(h);return f(v,h),v}function f(h,v){At.updateRenderableState(h,v),h.pickable=!1,h.opaque=!1,h.writeDepth=!0}})($s||($s={}));function vU(e,t,r,n){for(var a=0,i=0,o=0,s=r*4;o<s;++o){var u=2*o,l=Math.abs(e[u]);l>a&&(a=l);var c=Math.abs(e[u+1]);c>a&&(a=c);var d=Math.abs(t[o]);d>i&&(i=d)}return Math.max(i,n+n*a)}var Qu=_(),Zu=_(),Eh=_(),mU=Je.add,J2=Je.add3,is;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Je.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=Je.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=Je.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=function(d,f,h,v,p,g,m){for(var y=0;y<4;++y)J2(o,d,f,h),J2(s,v,p,g),mU(i,m)},l=function(d,f,h){for(var v=0;v<4;++v)J2(o,d[0],d[1],d[2]),J2(s,f[0],f[1],f[2]),mU(i,h)},c=function(d,f,h,v){var p=_.distance(d,f),g=Math.floor(h/2),m=1/h;_.sub(Eh,f,d);for(var y=0;y<g;++y){var b=m*(y*2+1);_.setMagnitude(Eh,Eh,p*b),_.add(Qu,d,Eh),_.setMagnitude(Eh,Eh,p*m*((y+1)*2)),_.add(Zu,d,Eh),u(Qu[0],Qu[1],Qu[2],Zu[0],Zu[1],Zu[2],v)}};return{add:u,addVec:l,addFixedCountDashes:c,addFixedLengthDashes:function(d,f,h,v){var p=_.distance(d,f);c(d,f,p/h,v)},addCage:function(d,f,h){for(var v=f.vertices,p=f.edges,g=0,m=p.length;g<m;g+=2)_.fromArray(Qu,v,p[g]*3),_.fromArray(Zu,v,p[g+1]*3),_.transformMat4(Qu,Qu,d),_.transformMat4(Zu,Zu,d),u(Qu[0],Qu[1],Qu[2],Zu[0],Zu[1],Zu[2],h)},getLines:function(){var d=i.elementCount/4,f=Je.compact(i,!0),h=Je.compact(o,!0),v=Je.compact(s,!0),p=a&&d<=a.lineCount?a.mappingBuffer.ref.value:new Float32Array(d*8),g=a&&d<=a.lineCount?a.indexBuffer.ref.value:new Uint32Array(d*6);return(!a||d>a.lineCount)&&yOe(d,p,g),Cn.create(p,g,f,h,v,d,a)}}}e.create=t})(is||(is={}));function yOe(e,t,r){for(var n=0;n<e;++n){var a=n*8;t[a]=-1,t[a+1]=-1,t[a+2]=1,t[a+3]=-1,t[a+4]=-1,t[a+5]=1,t[a+6]=1,t[a+7]=1}for(var n=0;n<e;++n){var i=n*4,o=n*6;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+3,r[o+5]=i+2}}var Cn;(function(e){function t(h,v,p,g,m,y,b){return b?o(h,v,p,g,m,y,b):i(h,v,p,g,m,y)}e.create=t;function r(h){var v=h?h.mappingBuffer.ref.value:new Float32Array(0),p=h?h.indexBuffer.ref.value:new Uint32Array(0),g=h?h.groupBuffer.ref.value:new Float32Array(0),m=h?h.startBuffer.ref.value:new Float32Array(0),y=h?h.endBuffer.ref.value:new Float32Array(0);return t(v,p,g,m,y,0,h)}e.createEmpty=r;function n(h,v){for(var p=h.vertexBuffer.ref.value,g=h.indexBuffer.ref.value,m=h.groupBuffer.ref.value,y=is.create(h.triangleCount*3,h.triangleCount/10,v),b=0,S=h.triangleCount*3;b<S;b+=3){var x=g[b],C=g[b+1],w=g[b+2],A=p[x*3],I=p[x*3+1],D=p[x*3+2],k=p[C*3],R=p[C*3+1],L=p[C*3+2],H=p[w*3],B=p[w*3+1],j=p[w*3+2];y.add(A,I,D,k,R,L,m[x]),y.add(A,I,D,H,B,j,m[x]),y.add(k,R,L,H,B,j,m[C])}return y.getLines()}e.fromMesh=n;function a(h){return Ui([h.lineCount,h.mappingBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version,h.startBuffer.ref.version,h.endBuffer.ref.version])}function i(h,v,p,g,m,y){var b=je(),S,x=-1,C=-1,w={kind:"lines",lineCount:y,mappingBuffer:N.create(h),indexBuffer:N.create(v),groupBuffer:N.create(p),startBuffer:N.create(g),endBuffer:N.create(m),get boundingSphere(){var A=a(w);if(A!==x){var I=nh(w.startBuffer.ref.value,w.lineCount*4,4),D=nh(w.endBuffer.ref.value,w.lineCount*4,4);je.expandBySphere(b,I,D),x=A}return b},get groupMapping(){return w.groupBuffer.ref.version!==C&&(S=t0(w.groupBuffer.ref.value,w.lineCount,4),C=w.groupBuffer.ref.version),S},setBoundingSphere:function(A){je.copy(b,A),x=a(w)}};return w}function o(h,v,p,g,m,y,b){return y>b.lineCount&&(N.update(b.mappingBuffer,h),N.update(b.indexBuffer,v)),b.lineCount=y,N.update(b.groupBuffer,p),N.update(b.startBuffer,g),N.update(b.endBuffer,m),b}function s(h,v){var p=h.startBuffer.ref.value;Kp(v,p,0,h.lineCount*4),N.update(h.startBuffer,p);var g=h.endBuffer.ref.value;Kp(v,g,0,h.lineCount*4),N.update(h.endBuffer,g)}e.transform=s,e.Params=E(E({},At.Params),{sizeFactor:T.Numeric(1.5,{min:0,max:10,step:.1}),lineSizeAttenuation:T.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:r,createValues:l,createValuesSimple:c,updateValues:d,updateBoundingSphere:f,createRenderableState:At.createRenderableState,updateRenderableState:At.updateRenderableState,createPositionIterator:u};function u(h,v){var p=h.lineCount*4,g=v.instanceCount.ref.value,m=pv(),y=m.position,b=h.startBuffer.ref.value,S=h.endBuffer.ref.value,x=v.aTransform.ref.value,C=function(w,A){var I=w%4===0?b:S;return A<0?_.fromArray(y,I,w*3):_.transformMat4Offset(y,I,x,0,w*3,A*16),m};return bn(p,g,2,C)}function l(h,v,p,g,m){var y=p.instanceCount,b=p.groupCount,S=u(h,v),x=cs(p,S,g.color),C=hd(p,g.size),w=Js(y*b),A=pd(),I=vd(),D=md(),k={drawCount:h.lineCount*2*3,vertexCount:h.lineCount*4,groupCount:b,instanceCount:y},R=je.clone(h.boundingSphere),L=Xa(R,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E({aMapping:h.mappingBuffer,aGroup:h.groupBuffer,aStart:h.startBuffer,aEnd:h.endBuffer,elements:h.indexBuffer,boundingSphere:N.create(L),invariantBoundingSphere:N.create(R),uInvariantBoundingSphere:N.create(wr.ofSphere(R))},x),C),w),A),I),D),v),At.createValues(m,k)),{uSizeFactor:N.create(m.sizeFactor),dLineSizeAttenuation:N.create(m.lineSizeAttenuation),dDoubleSided:N.create(!0),dFlipSided:N.create(!1)})}function c(h,v,p,g,m){var y=At.createSimple(p,g,m),b=E(E({},T.getDefaultValues(e.Params)),v);return l(h,y.transform,y.locationIterator,y.theme,b)}function d(h,v){At.updateValues(h,v),N.updateIfChanged(h.uSizeFactor,v.sizeFactor),N.updateIfChanged(h.dLineSizeAttenuation,v.lineSizeAttenuation)}function f(h,v){var p=je.clone(v.boundingSphere),g=Xa(p,h.aTransform.ref.value,h.instanceCount.ref.value);je.equals(g,h.boundingSphere.ref.value)||N.update(h.boundingSphere,g),je.equals(p,h.invariantBoundingSphere.ref.value)||(N.update(h.invariantBoundingSphere,p),N.update(h.uInvariantBoundingSphere,wr.fromSphere(h.uInvariantBoundingSphere.ref.value,p)))}})(Cn||(Cn={}));var gU=_(),yU=_(),bU=_();function M3(e,t){for(var r=t.length,n=r0(r/3),a=0;a<r;a+=3)_.fromArray(gU,e,t[a]*3),_.fromArray(yU,e,t[a+1]*3),_.fromArray(bU,e,t[a+2]*3),n.add(gU,yU,bU);return n.getPrimitive()}var ex=_();function r0(e,t){t===void 0&&(t=e*3);var r=new Float32Array(t*3),n=new Float32Array(t*3),a=new Uint32Array(e*3),i=0,o=0;return{add:function(s,u,l){_.toArray(s,r,i),_.toArray(u,r,i+3),_.toArray(l,r,i+6),_.triangleNormal(ex,s,u,l);for(var c=0;c<3;++c)_.toArray(ex,n,i+3*c),a[o+c]=i/3+c;i+=9,o+=3},addQuad:function(s,u,l,c){_.toArray(s,r,i),_.toArray(u,r,i+3),_.toArray(l,r,i+6),_.toArray(c,r,i+9),_.triangleNormal(ex,s,u,l);for(var d=0;d<4;++d)_.toArray(ex,n,i+3*d);var f=i/3;a[o]=f,a[o+1]=f+1,a[o+2]=f+2,a[o+3]=f+2,a[o+4]=f+3,a[o+5]=f,i+=12,o+=6},getPrimitive:function(){return{vertices:r,normals:n,indices:a}}}}var Hv=_(),bOe=qn();function Qk(e,t){for(var r=e.vertices,n=e.normals,a=qn.directionTransform(bOe,t),i=0,o=r.length;i<o;i+=3)_.transformMat4(Hv,_.fromArray(Hv,r,i),t),_.toArray(Hv,r,i),_.transformMat3(Hv,_.fromArray(Hv,n,i),a),_.toArray(Hv,n,i);return e}function Bl(e,t,r){r===void 0&&(r=-1);for(var n=new Float32Array(e*3),a=r===-1?e<=4?Math.sqrt(2)/2:.6:r,i=t?1:0,o=0,s=e;o<s;++o){var u=(o*2+i)/e*Math.PI;n[o*3]=Math.cos(u)*a,n[o*3+1]=Math.sin(u)*a,n[o*3+2]=0}return n}function Zk(e,t){return{vertices:e,edges:t}}function QK(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var TP=_.zero();function ZK(e,t){for(var r=e.vertices,n=0,a=r.length;n<a;n+=3)_.transformMat4(TP,_.fromArray(TP,r,n),t),_.toArray(TP,r,n);return e}var Xl=_(),Yl=_(),Kl=_(),Gv=_(),Qn=Bl(4,!0);function JK(e){for(var t=12,r=e?12*3:6*4,n=r0(t,r),a=0;a<4;++a){var i=(a+1)%4;_.set(Xl,Qn[a*3],Qn[a*3+1],-.5),_.set(Yl,Qn[i*3],Qn[i*3+1],-.5),_.set(Kl,Qn[i*3],Qn[i*3+1],.5),_.set(Gv,Qn[a*3],Qn[a*3+1],.5),e?n.add(Xl,Yl,Kl):n.addQuad(Xl,Yl,Kl,Gv)}return _.set(Xl,Qn[0],Qn[1],-.5),_.set(Yl,Qn[3],Qn[4],-.5),_.set(Kl,Qn[6],Qn[7],-.5),_.set(Gv,Qn[9],Qn[10],-.5),e?n.add(Kl,Yl,Xl):n.addQuad(Gv,Kl,Yl,Xl),_.set(Xl,Qn[0],Qn[1],.5),_.set(Yl,Qn[3],Qn[4],.5),_.set(Kl,Qn[6],Qn[7],.5),_.set(Gv,Qn[9],Qn[10],.5),e?n.add(Xl,Yl,Kl):n.addQuad(Xl,Yl,Kl,Gv),n.getPrimitive()}var IP;function Jk(){return IP||(IP=JK(!1)),IP}var MP;function xOe(){return MP||(MP=JK(!0)),MP}var DP;function eQ(){return DP||(DP=Zk([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),DP}function xU(e){return e.map(function(t){return{x:t[0],alpha:t[1]}})}function SU(e,t,r){for(var n=Ut(Ut([{x:0,alpha:0},{x:0,alpha:0}],e),[{x:1,alpha:0},{x:1,alpha:0}]),a=Fu.create({domain:[0,1],listOrName:t}),i=256,o=r?r.ref.value.array:new Uint8Array(i*4),s=0,u,l,c,d,f,h,v=e.length+1,p=0;p<v;++p){u=n[p+1].x,l=n[p+2].x,c=n[p].alpha,d=n[p+1].alpha,f=n[p+2].alpha,h=n[p+3].alpha;for(var g=Math.round((l-u)*i),m=0;m<g;++m){var y=m/g;o[s*4+3]=Math.max(0,fS(c,d,f,h,y,.5)*255),a.colorToArray(s/255,o,s*4),++s}}var b={array:o,width:256,height:1};return r?(N.update(r,b),r):N.create(b)}function SOe(e,t,r){if(r)return CU(e,t,r.min,r.max);var n=Bo(e),a=n[0],i=n[1];return CU(e,t,a,i)}function CU(e,t,r,n){var a=(n-r)/t;a===0&&(a=1);for(var i=new Int32Array(t),o=0,s=e.length;o<s;o++){var u=Math.floor((e[o]-r)/a);u>=t?u=t-1:u<0&&(u=0),i[u]++}return{min:r,max:n,binWidth:a,counts:i}}var Pi;(function(e){e.One={transform:{kind:"matrix",matrix:le.identity()},cells:Pr.create(Pr.Space([1,1,1],[0,1,2]),Pr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};var t=le.zero(),r=le.zero();function n(u){if(u.transform.kind==="matrix")return le.copy(le(),u.transform.matrix);if(u.transform.kind==="spacegroup"){var l=u.cells.space,c=le.fromScaling(t,_.div(_.zero(),Yt.size(_.zero(),u.transform.fractionalBox),_.ofArray(l.dimensions))),d=le.fromTranslation(r,u.transform.fractionalBox.min);return le.mul3(le.zero(),u.transform.cell.fromFractional,d,c)}return le.identity()}e.getGridToCartesianTransform=n;function a(u,l){return u===l}e.areEquivalent=a;function i(u){return u.cells.data.length===0}e.isEmpty=i;function o(u,l){l||(l=je());var c=u.cells.space.dimensions,d=e.getGridToCartesianTransform(u);return je.fromDimensionsAndTransform(l,c,d)}e.getBoundingSphere=o;function s(u,l){var c=u._historams;return c||(c=u._historams={}),c[l]||(c[l]=SOe(u.cells.data,l,{min:u.stats.min,max:u.stats.max})),c[l]}e.getHistogram=s})(Pi||(Pi={}));function COe(e,t){var r=this;return et.create("Create Volume",function(){return de(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b;return fe(this,function(S){if(n=e.header,a=e.values,i=Pr.Space(n.dim,[0,1,2],Float64Array),n.dataSetIds.length===0)o=a;else for(s=n.dim,u=s[0],l=s[1],c=s[2],d=((t==null?void 0:t.dataIndex)||0)+1,f=0,h=0,o=new Float64Array(u*l*c),v=0;v<u;v++)for(p=0;p<l;p++)for(g=0;g<c;g++)o[f++]=a[h],h+=d;return m=Pr.create(i,Pr.Data1(o)),y=le.fromTranslation(le(),n.origin),b=le.fromBasis(le(),n.basisX,n.basisY,n.basisZ),le.mul(y,y,b),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:y},cells:m,stats:{min:d3(o),max:Ml(o),mean:f3(o),sigma:h3(o)}},sourceData:u_.create(e),customProperties:new Nl,_propertyData:Object.create(null)}]})})})}var u_;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.name,data:n}}e.create=r})(u_||(u_={}));var _t;(function(e){function t(f){var h,v,p,g;return((g=(p=(v=(h=f==null?void 0:f.grid)===null||h===void 0?void 0:h.cells)===null||v===void 0?void 0:v.space)===null||p===void 0?void 0:p.dimensions)===null||g===void 0?void 0:g.length)&&(f==null?void 0:f.sourceData)&&(f==null?void 0:f.customProperties)&&(f==null?void 0:f._propertyData)}e.is=t,function(f){function h(x,C,w){return mn(y(x,w).absoluteValue,y(C,w).absoluteValue,w.sigma/100)}f.areSame=h;function v(x){return{kind:"absolute",absoluteValue:x}}f.absolute=v;function p(x){return{kind:"relative",relativeValue:x}}f.relative=p;function g(x,C){return C*x.sigma+x.mean}f.calcAbsolute=g;function m(x,C){return x.sigma===0?0:(C-x.mean)/x.sigma}f.calcRelative=m;function y(x,C){return x.kind==="absolute"?x:{kind:"absolute",absoluteValue:f.calcAbsolute(C,x.relativeValue)}}f.toAbsolute=y;function b(x,C){return x.kind==="relative"?x:{kind:"relative",relativeValue:f.calcRelative(C,x.absoluteValue)}}f.toRelative=b;function S(x){return x.kind==="relative"?x.relativeValue.toFixed(2)+" σ":""+x.absoluteValue.toPrecision(4)}f.toString=S}(e.IsoValue||(e.IsoValue={}));var r={min:-1,max:1,mean:0,sigma:.1};function n(f,h){var v=h||r,p=v.min,g=v.max,m=v.mean,y=v.sigma,b=(p-m)/y,S=(g-m)/y,x=f;return f.kind==="absolute"?f.absoluteValue<p?x=e.IsoValue.absolute(p):f.absoluteValue>g&&(x=e.IsoValue.absolute(g)):f.relativeValue<b?x=e.IsoValue.relative(b):f.relativeValue>S&&(x=e.IsoValue.relative(S)),T.Conditioned(x,{absolute:T.Converted(function(C){return e.IsoValue.toAbsolute(C,Pi.One.stats).absoluteValue},function(C){return e.IsoValue.absolute(C)},T.Numeric(m,{min:p,max:g,step:PM(y/100,2)})),relative:T.Converted(function(C){return e.IsoValue.toRelative(C,Pi.One.stats).relativeValue},function(C){return e.IsoValue.relative(C)},T.Numeric(Math.min(1,S),{min:b,max:S,step:PM(Math.round((g-p)/y)/100,2)}))},function(C){return C.kind==="absolute"?"absolute":"relative"},function(C,w){return w==="absolute"?e.IsoValue.toAbsolute(C,v):e.IsoValue.toRelative(C,v)},{isEssential:!0})}e.createIsoValueParam=n,e.IsoValueParam=n(e.IsoValue.relative(2)),e.One={label:"",grid:Pi.One,sourceData:{kind:"",name:"",data:{}},customProperties:new Nl,_propertyData:Object.create(null)};function a(f,h){return Pi.areEquivalent(f.grid,h.grid)}e.areEquivalent=a;function i(f){return Pi.isEmpty(f.grid)}e.isEmpty=i;function o(f){return u_.is(f.sourceData)?f.sourceData.data.header.orbitals:!1}e.isOrbitals=o;function s(f){return{kind:"volume-loci",volume:f}}e.Loci=s;function u(f){return!!f&&f.kind==="volume-loci"}e.isLoci=u;function l(f,h){return f.volume===h.volume}e.areLociEqual=l;function c(f){return Pi.isEmpty(f.volume.grid)}e.isLociEmpty=c;function d(f,h){return Pi.getBoundingSphere(f.grid,h)}e.getBoundingSphere=d,function(f){function h(y,b){return{kind:"isosurface-loci",volume:y,isoValue:b}}f.Loci=h;function v(y){return!!y&&y.kind==="isosurface-loci"}f.isLoci=v;function p(y,b){return y.volume===b.volume&&e.IsoValue.areSame(y.isoValue,b.isoValue,y.volume.grid.stats)}f.areLociEqual=p;function g(y){return y.volume.grid.cells.data.length===0}f.isLociEmpty=g;function m(y,b,S){return e.getBoundingSphere(y,S)}f.getBoundingSphere=m}(e.Isosurface||(e.Isosurface={})),function(f){function h(S,x){return{kind:"cell-loci",volume:S,indices:x}}f.Loci=h;function v(S){return!!S&&S.kind==="cell-loci"}f.isLoci=v;function p(S,x){return S.volume===x.volume&&Fe.areEqual(S.indices,x.indices)}f.areLociEqual=p;function g(S){return Fe.size(S.indices)===0}f.isLociEmpty=g;var m=new ls("98"),y=_();function b(S,x,C){m.reset();for(var w=Pi.getGridToCartesianTransform(S.grid),A=S.grid.cells.space.getCoords,I=0,D=Fe.size(x);I<D;I++){var k=Fe.getAt(x,I);A(k,y),_.transformMat4(y,y,w),m.includePosition(y)}m.finishedIncludeStep();for(var I=0,D=Fe.size(x);I<D;I++){var k=Fe.getAt(x,I);A(k,y),_.transformMat4(y,y,w),m.radiusPosition(y)}var R=m.getSphere(C);return je.expand(R,R,le.getMaxScaleOnAxis(w)*10)}f.getBoundingSphere=b}(e.Cell||(e.Cell={}))})(_t||(_t={}));var RP=Jk(),ro;(function(e){function t(y,b,S,x,C,w,A,I,D){return D?a(y,b,S,x,C,w,A,I,D):n(y,b,S,x,C,w,A,I)}e.create=t;function r(y){return Ui([y.bboxSize.ref.version,y.gridDimension.ref.version,y.gridTexture.ref.version,y.transform.ref.version,y.gridStats.ref.version])}function n(y,b,S,x,C,w,A,I){var D=je(),k=-1,R=w.getWidth(),L=w.getHeight(),H=w.getDepth(),B={kind:"direct-volume",gridDimension:N.create(b),gridTexture:N.create(w),gridTextureDim:N.create(_.create(R,L,H)),gridStats:N.create(wr.create(A.min,A.max,A.mean,A.sigma)),bboxMin:N.create(y.min),bboxMax:N.create(y.max),bboxSize:N.create(_.sub(_(),y.max,y.min)),transform:N.create(S),cellDim:N.create(C),unitToCartn:N.create(x),cartnToUnit:N.create(le.invert(le(),x)),get boundingSphere(){var j=r(B);if(j!==k){var Q=_Oe(B.gridDimension.ref.value,B.transform.ref.value);je.copy(D,Q),k=j}return D},packedGroup:N.create(I),setBoundingSphere:function(j){je.copy(D,j),k=r(B)}};return B}function a(y,b,S,x,C,w,A,I,D){var k=w.getWidth(),R=w.getHeight(),L=w.getDepth();return N.update(D.gridDimension,b),N.update(D.gridTexture,w),N.update(D.gridTextureDim,_.set(D.gridTextureDim.ref.value,k,R,L)),N.update(D.gridStats,wr.set(D.gridStats.ref.value,A.min,A.max,A.mean,A.sigma)),N.update(D.bboxMin,y.min),N.update(D.bboxMax,y.max),N.update(D.bboxSize,_.sub(D.bboxSize.ref.value,y.max,y.min)),N.update(D.transform,S),N.update(D.cellDim,C),N.update(D.unitToCartn,x),N.update(D.cartnToUnit,le.invert(le(),x)),N.updateIfChanged(D.packedGroup,I),D}function i(y){return{}}e.createEmpty=i;function o(y){var b=y?_t.createIsoValueParam(_t.IsoValue.relative(2),y):_t.IsoValueParam;return T.MappedStatic("volume",{isosurface:T.Group({isoValue:b,singleLayer:T.Boolean(!1,{isEssential:!0})},{isFlat:!0}),volume:T.Group({controlPoints:T.LineGraph([Ke.create(.19,0),Ke.create(.2,.05),Ke.create(.25,.05),Ke.create(.26,0),Ke.create(.79,0),Ke.create(.8,.05),Ke.create(.85,.05),Ke.create(.86,0)]),list:T.ColorList({kind:"interpolate",colors:[[dr.white,0],[dr.red,.25],[dr.white,.5],[dr.blue,.75],[dr.white,1]]},{offsets:!0})},{isFlat:!0})},{isEssential:!0})}e.createRenderModeParam=o,e.Params=E(E({},At.Params),{doubleSided:T.Boolean(!1,At.CustomQualityParamInfo),flipSided:T.Boolean(!1,At.ShadingCategory),flatShaded:T.Boolean(!1,At.ShadingCategory),ignoreLight:T.Boolean(!1,At.ShadingCategory),xrayShaded:T.Boolean(!1,At.ShadingCategory),renderMode:o(),stepsPerCell:T.Numeric(5,{min:1,max:20,step:1}),jumpLength:T.Numeric(0,{min:0,max:20,step:.1})}),e.Utils={Params:e.Params,createEmpty:i,createValues:f,createValuesSimple:h,updateValues:v,updateBoundingSphere:p,createRenderableState:g,updateRenderableState:m,createPositionIterator:s};function s(y,b){var S=y.transform.ref.value,x=y.gridDimension.ref.value,C=x[0],w=x[1],A=x[2],I=C*w*A,D=b.instanceCount.ref.value,k=pv(),R=k.position,L=b.aTransform.ref.value,H=function(B,j){var Q=Math.floor(B/A);return R[0]=Math.floor(Q/w),R[1]=Q%w,R[2]=B%A,_.transformMat4(R,R,S),j>=0&&_.transformMat4Offset(R,R,L,0,0,j*16),k};return bn(I,D,1,H)}function u(y,b,S){var x=S[0],C=S[1],w=S[2],A=S[3],I=_t.IsoValue.toAbsolute(b,{min:x,max:C,mean:w,sigma:A}).absoluteValue;return Ke.set(y,(I-x)/(C-x),(0-x)/(C-x)),y}function l(y,b){return Math.ceil(_.magnitude(y)*b)}function c(y,b){return Math.min.apply(Math,y)*(1/b)}function d(y){return 1/y}function f(y,b,S,x,C){var w=y.gridTexture,A=y.gridTextureDim,I=y.gridStats,D=y.bboxSize,k=y.bboxMin,R=y.bboxMax,L=y.gridDimension,H=y.transform,B=S.instanceCount,j=S.groupCount,Q=e.Utils.createPositionIterator(y,b),G=cs(S,Q,x.color),W=Js(B*j),q=pd(),J=vd(),he=md(),$=L.ref.value,X=$[0],U=$[1],z=$[2],ee={drawCount:RP.indices.length,vertexCount:X*U*z,groupCount:j,instanceCount:B},Y=je.clone(y.boundingSphere),Z=Xa(Y,b.aTransform.ref.value,B),te=C.renderMode.name==="volume"?xU(C.renderMode.params.controlPoints):[],ce=SU(te,C.renderMode.name==="volume"?C.renderMode.params.list.colors:[]),be=C.renderMode.name==="isosurface"?C.renderMode.params.isoValue:_t.IsoValue.relative(2),xe=C.renderMode.name==="isosurface"?C.renderMode.params.singleLayer:!1;return E(E(E(E(E(E(E(E({},G),W),q),J),he),b),At.createValues(C,ee)),{aPosition:N.create(RP.vertices),elements:N.create(RP.indices),boundingSphere:N.create(Z),invariantBoundingSphere:N.create(Y),uInvariantBoundingSphere:N.create(wr.ofSphere(Y)),uIsoValue:N.create(u(Ke(),be,y.gridStats.ref.value)),uBboxMin:k,uBboxMax:R,uBboxSize:D,uMaxSteps:N.create(l(L.ref.value,C.stepsPerCell)),uStepScale:N.create(c(y.cellDim.ref.value,C.stepsPerCell)),uJumpLength:N.create(C.jumpLength),uTransform:H,uGridDim:L,dRenderMode:N.create(C.renderMode.name),tTransferTex:ce,uTransferScale:N.create(d(C.stepsPerCell)),dGridTexType:N.create(w.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:A,tGridTex:w,uGridStats:I,uCellDim:y.cellDim,uCartnToUnit:y.cartnToUnit,uUnitToCartn:y.unitToCartn,dPackedGroup:y.packedGroup,dSingleLayer:N.create(xe),dDoubleSided:N.create(C.doubleSided),dFlatShaded:N.create(C.flatShaded),dFlipSided:N.create(C.flipSided),dIgnoreLight:N.create(C.ignoreLight),dXrayShaded:N.create(C.xrayShaded)})}function h(y,b,S,x,C){var w=At.createSimple(S,x,C),A=E(E({},T.getDefaultValues(e.Params)),b);return f(y,w.transform,w.locationIterator,w.theme,A)}function v(y,b){if(N.updateIfChanged(y.alpha,b.alpha),N.updateIfChanged(y.uAlpha,b.alpha),N.updateIfChanged(y.dDoubleSided,b.doubleSided),N.updateIfChanged(y.dFlatShaded,b.flatShaded),N.updateIfChanged(y.dFlipSided,b.flipSided),N.updateIfChanged(y.dIgnoreLight,b.ignoreLight),N.updateIfChanged(y.dXrayShaded,b.xrayShaded),N.updateIfChanged(y.dRenderMode,b.renderMode.name),b.renderMode.name==="isosurface")N.updateIfChanged(y.uIsoValue,u(y.uIsoValue.ref.value,b.renderMode.params.isoValue,y.uGridStats.ref.value)),N.updateIfChanged(y.dSingleLayer,b.renderMode.params.singleLayer);else if(b.renderMode.name==="volume"){var S=xU(b.renderMode.params.controlPoints);SU(S,b.renderMode.params.list.colors,y.tTransferTex)}N.updateIfChanged(y.uMaxSteps,l(y.uGridDim.ref.value,b.stepsPerCell)),N.updateIfChanged(y.uStepScale,c(y.uCellDim.ref.value,b.stepsPerCell)),N.updateIfChanged(y.uTransferScale,d(b.stepsPerCell)),N.updateIfChanged(y.uJumpLength,b.jumpLength)}function p(y,b){var S=je.clone(b.boundingSphere),x=Xa(S,y.aTransform.ref.value,y.instanceCount.ref.value);je.equals(x,y.boundingSphere.ref.value)||N.update(y.boundingSphere,x),je.equals(S,y.invariantBoundingSphere.ref.value)||(N.update(y.invariantBoundingSphere,S),N.update(y.uInvariantBoundingSphere,wr.fromSphere(y.uInvariantBoundingSphere.ref.value,S)))}function g(y){var b=At.createRenderableState(y);return b.opaque=!1,b.writeDepth=y.renderMode.name==="isosurface",b}function m(y,b){At.updateRenderableState(y,b),y.opaque=!1,y.writeDepth=b.renderMode.name==="isosurface"}})(ro||(ro={}));function _Oe(e,t){return je.fromDimensionsAndTransform(je(),e,t)}var ah;(function(e){function t(h,v,p,g,m,y){return y?i(h,v,p,g,m,y):a(h,v,p,g,m)}e.create=t;function r(h){var v=h?h.centerBuffer.ref.value:new Float32Array(0),p=h?h.mappingBuffer.ref.value:new Float32Array(0),g=h?h.indexBuffer.ref.value:new Uint32Array(0),m=h?h.groupBuffer.ref.value:new Float32Array(0);return t(v,p,g,m,0,h)}e.createEmpty=r;function n(h){return Ui([h.sphereCount,h.centerBuffer.ref.version,h.mappingBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version])}function a(h,v,p,g,m){var y=je(),b,S=-1,x=-1,C={kind:"spheres",sphereCount:m,centerBuffer:N.create(h),mappingBuffer:N.create(v),indexBuffer:N.create(p),groupBuffer:N.create(g),get boundingSphere(){var w=n(C);if(w!==S){var A=nh(C.centerBuffer.ref.value,C.sphereCount*4,4);je.copy(y,A),S=w}return y},get groupMapping(){return C.groupBuffer.ref.version!==x&&(b=t0(C.groupBuffer.ref.value,C.sphereCount,4),x=C.groupBuffer.ref.version),b},setBoundingSphere:function(w){je.copy(y,w),S=n(C)}};return C}function i(h,v,p,g,m,y){return m>y.sphereCount&&(N.update(y.mappingBuffer,v),N.update(y.indexBuffer,p)),y.sphereCount=m,N.update(y.centerBuffer,h),N.update(y.groupBuffer,g),y}e.Params=E(E({},At.Params),{sizeFactor:T.Numeric(1,{min:0,max:10,step:.1}),doubleSided:T.Boolean(!1,At.CustomQualityParamInfo),ignoreLight:T.Boolean(!1,At.ShadingCategory),xrayShaded:T.Boolean(!1,At.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(h,v){var p=h.sphereCount*4,g=v.instanceCount.ref.value,m=pv(),y=m.position,b=h.centerBuffer.ref.value,S=v.aTransform.ref.value,x=function(C,w){return w<0?_.fromArray(y,b,C*3):_.transformMat4Offset(y,b,S,0,C*3,w*16),m};return bn(p,g,4,x)}function s(h,v,p,g,m){var y=p.instanceCount,b=p.groupCount,S=o(h,v),x=cs(p,S,g.color),C=hd(p,g.size),w=Js(y*b),A=pd(),I=vd(),D=md(),k={drawCount:h.sphereCount*2*3,vertexCount:h.sphereCount*4,groupCount:b,instanceCount:y},R=h.boundingSphere.radius?ab(C)*m.sizeFactor:0,L=je.expand(je(),h.boundingSphere,R),H=Xa(L,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E(E({aPosition:h.centerBuffer,aMapping:h.mappingBuffer,aGroup:h.groupBuffer,elements:h.indexBuffer,boundingSphere:N.create(H),invariantBoundingSphere:N.create(L),uInvariantBoundingSphere:N.create(wr.ofSphere(L))},x),C),w),A),I),D),v),{padding:N.create(R)}),At.createValues(m,k)),{uSizeFactor:N.create(m.sizeFactor),dDoubleSided:N.create(m.doubleSided),dIgnoreLight:N.create(m.ignoreLight),dXrayShaded:N.create(m.xrayShaded)})}function u(h,v,p,g,m){var y=At.createSimple(p,g,m),b=E(E({},T.getDefaultValues(e.Params)),v);return s(h,y.transform,y.locationIterator,y.theme,b)}function l(h,v){At.updateValues(h,v),N.updateIfChanged(h.uSizeFactor,v.sizeFactor),N.updateIfChanged(h.dDoubleSided,v.doubleSided),N.updateIfChanged(h.dIgnoreLight,v.ignoreLight),N.updateIfChanged(h.dXrayShaded,v.xrayShaded)}function c(h,v){var p=v.boundingSphere.radius?ab(h)*h.uSizeFactor.ref.value:0,g=je.expand(je(),v.boundingSphere,p),m=Xa(g,h.aTransform.ref.value,h.instanceCount.ref.value);je.equals(m,h.boundingSphere.ref.value)||N.update(h.boundingSphere,m),je.equals(g,h.invariantBoundingSphere.ref.value)||(N.update(h.invariantBoundingSphere,g),N.update(h.uInvariantBoundingSphere,wr.fromSphere(h.uInvariantBoundingSphere.ref.value,g))),N.update(h.padding,p)}function d(h){var v=At.createRenderableState(h);return f(v,h),v}function f(h,v){At.updateRenderableState(h,v),h.opaque=h.opaque&&!v.xrayShaded,h.writeDepth=h.opaque}})(ah||(ah={}));var Vu;(function(e){var t=function(){function u(){this.index=0,this.textures=[]}return u.prototype.get=function(){return this.textures[this.index]},u.prototype.set=function(l,c,d){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:l,group:c,normal:d}),this.index=(this.index+1)%2},u.prototype.destroy=function(){for(var l=0,c=this.textures;l<c.length;l++){var d=c[l];d.vertex.destroy(),d.group.destroy(),d.normal.destroy()}},u}();e.DoubleBuffer=t;function r(u,l,c,d,f,h,v){var p=c.getWidth(),g=c.getHeight();return v?(v.vertexCount=u,v.groupCount=l,N.update(v.geoTextureDim,Ke.set(v.geoTextureDim.ref.value,p,g)),N.update(v.vertexTexture,c),N.update(v.groupTexture,d),N.update(v.normalTexture,f),v.doubleBuffer.set(c,d,f),je.copy(v.boundingSphere,h),v):{kind:"texture-mesh",vertexCount:u,groupCount:l,geoTextureDim:N.create(Ke.create(p,g)),vertexTexture:N.create(c),groupTexture:N.create(d),normalTexture:N.create(f),doubleBuffer:new t,boundingSphere:je.clone(h)}}e.create=r;function n(u){return{}}e.createEmpty=n,e.Params=E(E({},At.Params),{doubleSided:T.Boolean(!1,At.CustomQualityParamInfo),flipSided:T.Boolean(!1,At.ShadingCategory),flatShaded:T.Boolean(!1,At.ShadingCategory),ignoreLight:T.Boolean(!1,At.ShadingCategory),xrayShaded:T.Boolean(!1,At.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:n,createValues:a,createValuesSimple:i,updateValues:o,updateBoundingSphere:s,createRenderableState:At.createRenderableState,updateRenderableState:At.updateRenderableState,createPositionIterator:function(){return bn(1,1,1,function(){return ns})}};function a(u,l,c,d,f){var h=c.instanceCount,v=c.groupCount,p=e.Utils.createPositionIterator(u,l),g=cs(c,p,d.color),m=Js(h*v),y=pd(),b=vd(),S=md(),x={drawCount:u.vertexCount,vertexCount:u.vertexCount,groupCount:v,instanceCount:h},C=je.clone(u.boundingSphere),w=Xa(C,l.aTransform.ref.value,h);return E(E(E(E(E(E(E(E({uGeoTexDim:u.geoTextureDim,tPosition:u.vertexTexture,tGroup:u.groupTexture,tNormal:u.normalTexture,boundingSphere:N.create(w),invariantBoundingSphere:N.create(C),uInvariantBoundingSphere:N.create(wr.ofSphere(C))},g),m),y),b),S),l),At.createValues(f,x)),{dDoubleSided:N.create(f.doubleSided),dFlatShaded:N.create(f.flatShaded),dFlipSided:N.create(f.flipSided),dIgnoreLight:N.create(f.ignoreLight),dXrayShaded:N.create(f.xrayShaded),dGeoTexture:N.create(!0)})}function i(u,l,c,d,f){var h=At.createSimple(c,d,f),v=E(E({},T.getDefaultValues(e.Params)),l);return a(u,h.transform,h.locationIterator,h.theme,v)}function o(u,l){At.updateValues(u,l),N.updateIfChanged(u.dDoubleSided,l.doubleSided),N.updateIfChanged(u.dFlatShaded,l.flatShaded),N.updateIfChanged(u.dFlipSided,l.flipSided),N.updateIfChanged(u.dIgnoreLight,l.ignoreLight),N.updateIfChanged(u.dXrayShaded,l.xrayShaded)}function s(u,l){var c=je.clone(l.boundingSphere),d=Xa(c,u.aTransform.ref.value,u.instanceCount.ref.value);je.equals(d,u.boundingSphere.ref.value)||N.update(u.boundingSphere,d),je.equals(c,u.invariantBoundingSphere.ref.value)||(N.update(u.invariantBoundingSphere,c),N.update(u.uInvariantBoundingSphere,wr.fromSphere(u.uInvariantBoundingSphere.ref.value,c)))}})(Vu||(Vu={}));function wOe(e,t){var r={},n={},a={},i={},o={},s={};return Object.keys(e).forEach(function(u){var l=e[u];l.type==="attribute"&&(r[u]=t[u]),l.type==="define"&&(n[u]=t[u]),l.type==="texture"&&t[u]!==void 0&&(a[u]=t[u]),l.type==="uniform"&&t[u]!==void 0&&(l.variant==="material"?o[u]=t[u]:l.variant==="buffered"?s[u]=t[u]:i[u]=t[u])}),{attributeValues:r,defineValues:n,textureValues:a,uniformValues:i,materialUniformValues:o,bufferedUniformValues:s}}function EOe(e){var t={};return Object.keys(e).forEach(function(r){t[r]=e[r].ref.version}),t}function Hr(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function Qe(e,t){return{type:"uniform",kind:e,variant:t}}function lr(e,t,r,n){return{type:"texture",kind:e,format:t,dataType:r,filter:n}}function mv(e){return{type:"elements",kind:e}}function Qt(e,t){return{type:"define",kind:e,options:t}}function Ca(e){return{type:"value",kind:e}}var gd={uModel:Qe("m4"),uView:Qe("m4"),uInvView:Qe("m4"),uModelView:Qe("m4"),uInvModelView:Qe("m4"),uProjection:Qe("m4"),uInvProjection:Qe("m4"),uModelViewProjection:Qe("m4"),uInvModelViewProjection:Qe("m4"),uIsOrtho:Qe("f"),uPixelRatio:Qe("f"),uViewportHeight:Qe("f"),uViewport:Qe("v4"),uViewOffset:Qe("v2"),uDrawingBufferSize:Qe("v2"),uCameraPosition:Qe("v3"),uCameraDir:Qe("v3"),uNear:Qe("f"),uFar:Qe("f"),uFogNear:Qe("f"),uFogFar:Qe("f"),uFogColor:Qe("v3"),uTransparentBackground:Qe("b"),uClipObjectType:Qe("i[]"),uClipObjectInvert:Qe("b[]"),uClipObjectPosition:Qe("v3[]"),uClipObjectRotation:Qe("v4[]"),uClipObjectScale:Qe("v3[]"),uLightIntensity:Qe("f"),uAmbientIntensity:Qe("f"),uMetalness:Qe("f"),uRoughness:Qe("f"),uReflectivity:Qe("f"),uPickingAlphaThreshold:Qe("f"),uInteriorDarkening:Qe("f"),uInteriorColorFlag:Qe("b"),uInteriorColor:Qe("v3"),uHighlightColor:Qe("v3"),uSelectColor:Qe("v3"),uXrayEdgeFalloff:Qe("f"),uRenderWboit:Qe("b")},yd={tDepth:lr("texture","depth","ushort","nearest")},bd={uObjectId:Qe("i")},AOe={uColor:Qe("v3","material"),uColorTexDim:Qe("v2"),uColorGridDim:Qe("v3"),uColorGridTransform:Qe("v4"),tColor:lr("image-uint8","rgb","ubyte","nearest"),tPalette:lr("image-uint8","rgb","ubyte","nearest"),tColorGrid:lr("texture","rgb","ubyte","linear"),dColorType:Qt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance"]),dUsePalette:Qt("boolean")},Lb={uSize:Qe("f","material"),uSizeTexDim:Qe("v2"),tSize:lr("image-uint8","rgb","ubyte","nearest"),dSizeType:Qt("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Qe("f")},POe={uMarkerTexDim:Qe("v2"),tMarker:lr("image-uint8","alpha","ubyte","nearest")},TOe={uOverpaintTexDim:Qe("v2"),tOverpaint:lr("image-uint8","rgba","ubyte","nearest"),dOverpaint:Qt("boolean")},IOe={uTransparencyTexDim:Qe("v2"),tTransparency:lr("image-uint8","alpha","ubyte","nearest"),dTransparency:Qt("boolean"),transparencyAverage:Ca("number")},MOe={dClipObjectCount:Qt("number"),dClipVariant:Qt("string",["instance","pixel"]),uClippingTexDim:Qe("v2"),tClipping:lr("image-uint8","alpha","ubyte","nearest"),dClipping:Qt("boolean")},xd=E(E(E(E(E(E({},AOe),POe),TOe),IOe),MOe),{aInstance:Hr("float32",1,1),aTransform:Hr("float32",16,1),uAlpha:Qe("f","material"),uVertexCount:Qe("i"),uInstanceCount:Qe("i"),uGroupCount:Qe("i"),uInvariantBoundingSphere:Qe("v4"),drawCount:Ca("number"),instanceCount:Ca("number"),alpha:Ca("number"),matrix:Ca("m4"),transform:Ca("float32"),extraTransform:Ca("float32"),hasReflection:Ca("boolean"),boundingSphere:Ca("sphere"),invariantBoundingSphere:Ca("sphere")}),tQ=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),xi={drawCount:Ca("number"),instanceCount:Ca("number"),aPosition:Hr("float32",2,0),uQuadScale:Qe("v2")},Si={drawCount:N.create(6),instanceCount:N.create(1),aPosition:N.create(tQ),uQuadScale:N.create(Ke.create(1,1))},_U=new Uint32Array([0,1,2,1,3,2]),DOe=new Float32Array([0,1,0,0,1,1,1,0]),rQ={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},ROe=Object.keys(rQ),Kc;(function(e){function t(f,h,v,p){return p?a(f,h,v,p):n(f,h,v)}e.create=t;function r(f){return Ui([f.cornerBuffer.ref.version])}function n(f,h,v){var p=je(),g=-1,m=f.width,y=f.height,b={kind:"image",imageTexture:N.create(f),imageTextureDim:N.create(Ke.create(m,y)),cornerBuffer:N.create(h),groupTexture:N.create(v),get boundingSphere(){var S=r(b);if(S!==g){var x=kOe(b.cornerBuffer.ref.value);je.copy(p,x),g=S}return p}};return b}function a(f,h,v,p){var g=f.width,m=f.height;return N.update(p.imageTexture,f),N.update(p.imageTextureDim,Ke.set(p.imageTextureDim.ref.value,g,m)),N.update(p.cornerBuffer,h),N.update(p.groupTexture,v),p}function i(f){return{}}e.createEmpty=i,e.Params=E(E({},At.Params),{interpolation:T.Select("bspline",T.objectToOptions(rQ))}),e.Utils={Params:e.Params,createEmpty:i,createValues:o,createValuesSimple:s,updateValues:u,updateBoundingSphere:l,createRenderableState:c,updateRenderableState:d,createPositionIterator:function(){return bn(1,1,1,function(){return ns})}};function o(f,h,v,p,g){var m=v.instanceCount,y=v.groupCount,b=e.Utils.createPositionIterator(f,h),S=cs(v,b,p.color),x=Js(m*y),C=pd(),w=vd(),A=md(),I={drawCount:_U.length,vertexCount:tQ.length/3,groupCount:y,instanceCount:m},D=je.clone(f.boundingSphere),k=Xa(D,h.aTransform.ref.value,m);return E(E(E(E(E(E(E(E({},S),x),C),w),A),h),At.createValues(g,I)),{aPosition:f.cornerBuffer,aUv:N.create(DOe),elements:N.create(_U),aGroup:N.create(Ws(new Float32Array(4))),boundingSphere:N.create(k),invariantBoundingSphere:N.create(D),uInvariantBoundingSphere:N.create(wr.ofSphere(D)),dInterpolation:N.create(g.interpolation),uImageTexDim:f.imageTextureDim,tImageTex:f.imageTexture,tGroupTex:f.groupTexture})}function s(f,h,v,p,g){var m=At.createSimple(v,p,g),y=E(E({},T.getDefaultValues(e.Params)),h);return o(f,m.transform,m.locationIterator,m.theme,y)}function u(f,h){At.updateValues(f,h),N.updateIfChanged(f.dInterpolation,h.interpolation)}function l(f,h){var v=je.clone(h.boundingSphere),p=Xa(v,f.aTransform.ref.value,f.instanceCount.ref.value);je.equals(p,f.boundingSphere.ref.value)||N.update(f.boundingSphere,p),je.equals(v,f.invariantBoundingSphere.ref.value)||(N.update(f.invariantBoundingSphere,v),N.update(f.uInvariantBoundingSphere,wr.fromSphere(f.uInvariantBoundingSphere.ref.value,v)))}function c(f){var h=At.createRenderableState(f);return h.opaque=!1,h}function d(f,h){At.updateRenderableState(f,h),f.opaque=!1}})(Kc||(Kc={}));function kOe(e){for(var t=_(),r=[],n=0,a=e.length;n<a;n+=3){var i=_.fromArray(_(),e,n);r.push(i),_.add(t,t,i)}_.scale(t,t,1/(e.length/3));for(var o=0,s=0,u=r;s<u.length;s++){var i=u[s],l=_.distance(t,i);l>o&&(o=l)}var c=je.create(t,o);return je.setExtrema(c,r),c}var Ko;(function(e){function t(v,p,g,m,y,b,S,x,C){return C?i(v,p,g,m,y,b,S,x,C):a(v,p,g,m,y,b,S,x)}e.create=t;function r(v){var p=v?v.mappingBuffer.ref.value:new Float32Array(0),g=v?v.indexBuffer.ref.value:new Uint32Array(0),m=v?v.groupBuffer.ref.value:new Float32Array(0),y=v?v.startBuffer.ref.value:new Float32Array(0),b=v?v.endBuffer.ref.value:new Float32Array(0),S=v?v.scaleBuffer.ref.value:new Float32Array(0),x=v?v.capBuffer.ref.value:new Float32Array(0);return t(p,g,m,y,b,S,x,0,v)}e.createEmpty=r;function n(v){return Ui([v.cylinderCount,v.mappingBuffer.ref.version,v.indexBuffer.ref.version,v.groupBuffer.ref.version,v.startBuffer.ref.version,v.endBuffer.ref.version,v.scaleBuffer.ref.version,v.capBuffer.ref.version])}function a(v,p,g,m,y,b,S,x){var C=je(),w,A=-1,I=-1,D={kind:"cylinders",cylinderCount:x,mappingBuffer:N.create(v),indexBuffer:N.create(p),groupBuffer:N.create(g),startBuffer:N.create(m),endBuffer:N.create(y),scaleBuffer:N.create(b),capBuffer:N.create(S),get boundingSphere(){var k=n(D);if(k!==A){var R=nh(D.startBuffer.ref.value,D.cylinderCount*6,6),L=nh(D.endBuffer.ref.value,D.cylinderCount*6,6);je.expandBySphere(C,R,L),A=k}return C},get groupMapping(){return D.groupBuffer.ref.version!==I&&(w=t0(D.groupBuffer.ref.value,D.cylinderCount,6),I=D.groupBuffer.ref.version),w},setBoundingSphere:function(k){je.copy(C,k),A=n(D)}};return D}function i(v,p,g,m,y,b,S,x,C){return x>C.cylinderCount&&(N.update(C.mappingBuffer,v),N.update(C.indexBuffer,p)),C.cylinderCount=x,N.update(C.groupBuffer,g),N.update(C.startBuffer,m),N.update(C.endBuffer,y),N.update(C.scaleBuffer,b),N.update(C.capBuffer,S),C}function o(v,p){var g=v.startBuffer.ref.value;Kp(p,g,0,v.cylinderCount*6),N.update(v.startBuffer,g);var m=v.endBuffer.ref.value;Kp(p,m,0,v.cylinderCount*6),N.update(v.endBuffer,m)}e.transform=o,e.Params=E(E({},At.Params),{sizeFactor:T.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:T.Numeric(1,{min:0,max:3,step:.01}),doubleSided:T.Boolean(!1,At.CustomQualityParamInfo),ignoreLight:T.Boolean(!1,At.ShadingCategory),xrayShaded:T.Boolean(!1,At.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:h,createPositionIterator:s};function s(v,p){var g=v.cylinderCount*6,m=p.instanceCount.ref.value,y=pv(),b=y.position,S=v.startBuffer.ref.value,x=v.endBuffer.ref.value,C=p.aTransform.ref.value,w=function(A,I){var D=A%6===0?S:x;return I<0?_.fromArray(b,D,A*3):_.transformMat4Offset(b,D,C,0,A*3,I*16),y};return bn(g,m,2,w)}function u(v,p,g,m,y){var b=g.instanceCount,S=g.groupCount,x=s(v,p),C=cs(g,x,m.color),w=hd(g,m.size),A=Js(b*S),I=pd(),D=vd(),k=md(),R={drawCount:v.cylinderCount*4*3,vertexCount:v.cylinderCount*6,groupCount:S,instanceCount:b},L=ab(w)*y.sizeFactor,H=je.clone(v.boundingSphere),B=Xa(H,p.aTransform.ref.value,b);return E(E(E(E(E(E(E(E(E(E({aMapping:v.mappingBuffer,aGroup:v.groupBuffer,aStart:v.startBuffer,aEnd:v.endBuffer,aScale:v.scaleBuffer,aCap:v.capBuffer,elements:v.indexBuffer,boundingSphere:N.create(B),invariantBoundingSphere:N.create(H),uInvariantBoundingSphere:N.create(wr.ofSphere(H))},C),w),A),I),D),k),p),{padding:N.create(L)}),At.createValues(y,R)),{uSizeFactor:N.create(y.sizeFactor*y.sizeAspectRatio),dDoubleSided:N.create(y.doubleSided),dIgnoreLight:N.create(y.ignoreLight),dXrayShaded:N.create(y.xrayShaded)})}function l(v,p,g,m,y){var b=At.createSimple(g,m,y),S=E(E({},T.getDefaultValues(e.Params)),p);return u(v,b.transform,b.locationIterator,b.theme,S)}function c(v,p){At.updateValues(v,p),N.updateIfChanged(v.uSizeFactor,p.sizeFactor*p.sizeAspectRatio),N.updateIfChanged(v.dDoubleSided,p.doubleSided),N.updateIfChanged(v.dIgnoreLight,p.ignoreLight),N.updateIfChanged(v.dXrayShaded,p.xrayShaded)}function d(v,p){var g=je.clone(p.boundingSphere),m=Xa(g,v.aTransform.ref.value,v.instanceCount.ref.value);je.equals(m,v.boundingSphere.ref.value)||N.update(v.boundingSphere,m),je.equals(g,v.invariantBoundingSphere.ref.value)||(N.update(v.invariantBoundingSphere,g),N.update(v.uInvariantBoundingSphere,wr.fromSphere(v.uInvariantBoundingSphere.ref.value,g)))}function f(v){var p=At.createRenderableState(v);return h(p,v),p}function h(v,p){At.updateRenderableState(v,p),v.opaque=v.opaque&&!p.xrayShaded,v.writeDepth=v.opaque}})(Ko||(Ko={}));var oi;(function(e){function t(o){switch(o.kind){case"mesh":return o.triangleCount*3;case"points":return o.pointCount;case"spheres":return o.sphereCount*2*3;case"cylinders":return o.cylinderCount*4*3;case"text":return o.charCount*2*3;case"lines":return o.lineCount*2*3;case"direct-volume":return 12*3;case"image":return 2*3;case"texture-mesh":return o.vertexCount}}e.getDrawCount=t;function r(o){switch(o.kind){case"mesh":return o.vertexCount;case"points":return o.pointCount;case"spheres":return o.sphereCount*4;case"cylinders":return o.cylinderCount*6;case"text":return o.charCount*4;case"lines":return o.lineCount*4;case"direct-volume":var s=o.gridDimension.ref.value,u=s[0],l=s[1],c=s[2];return u*l*c;case"image":return 4;case"texture-mesh":return o.vertexCount}}e.getVertexCount=r;function n(o){switch(o.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return t(o)===0?0:Ml(o.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return Ml(o.groupTexture.ref.value.array)+1;case"texture-mesh":return o.groupCount}}e.getGroupCount=n;function a(o){switch(o.kind){case"mesh":return Ft.Utils;case"points":return Qp.Utils;case"spheres":return ah.Utils;case"cylinders":return Ko.Utils;case"text":return $s.Utils;case"lines":return Cn.Utils;case"direct-volume":return ro.Utils;case"image":return Kc.Utils;case"texture-mesh":return Vu.Utils}}e.getUtils=a;function i(o,s){return s==="instance"&&o.nonInstanceable?"group":s}e.getGranularity=i})(oi||(oi={}));var nQ=zi();function OOe(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(Er(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function eO(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){var r=OOe(e,t);throw new Error("Framebuffer status: "+r)}}function wU(e){var t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function LOe(e){var t=wU(e),r=!1;return{id:nQ(),bind:function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)},reset:function(){t=wU(e)},destroy:function(){r||(e.deleteFramebuffer(t),r=!0)}}}function NOe(){return{id:nQ(),bind:function(){},reset:function(){},destroy:function(){}}}function EU(e){var t=GNe(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');var r=WNe(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');var n=qNe(e);Mr&&n===null&&console.log('Could not find support for "standard_derivatives"');var a=XNe(e);Mr&&a===null&&console.log('Could not find support for "texture_float"');var i=YNe(e);Mr&&i===null&&console.log('Could not find support for "texture_float_linear"');var o=KNe(e);Mr&&o===null&&console.log('Could not find support for "texture_half_float"');var s=QNe(e);Mr&&s===null&&console.log('Could not find support for "texture_half_float_linear"');var u=aFe(e);Mr&&u===null&&console.log('Could not find support for "depth_texture"');var l=ZNe(e);Mr&&l===null&&console.log('Could not find support for "blend_minmax"');var c=$Ne(e);Mr&&c===null&&console.log('Could not find support for "vertex_array_object"');var d=JNe(e);Mr&&d===null&&console.log('Could not find support for "frag_depth"');var f=eFe(e);Mr&&f===null&&console.log('Could not find support for "color_buffer_float"');var h=tFe(e);Mr&&h===null&&console.log('Could not find support for "color_buffer_half_float"');var v=rFe(e);Mr&&v===null&&console.log('Could not find support for "draw_buffers"');var p=nFe(e);Mr&&p===null&&console.log('Could not find support for "shader_texture_lod"');var g=iFe(e);return Mr&&g===null&&console.log('Could not find support for "sRGB"'),{instancedArrays:t,standardDerivatives:n,textureFloat:a,textureFloatLinear:i,textureHalfFloat:o,textureHalfFloatLinear:s,elementIndexUint:r,depthTexture:u,blendMinMax:l,vertexArrayObject:c,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:h,drawBuffers:v,shaderTextureLod:p,sRGB:g}}function FOe(e){var t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),i=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA);return{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:function(h){t[h]!==!0&&(e.enable(h),t[h]=!0)},disable:function(h){t[h]!==!1&&(e.disable(h),t[h]=!1)},frontFace:function(h){h!==r&&(e.frontFace(h),r=h)},cullFace:function(h){h!==n&&(e.cullFace(h),n=h)},depthMask:function(h){h!==a&&(e.depthMask(h),a=h)},colorMask:function(h,v,p,g){(h!==i[0]||v!==i[1]||p!==i[2]||g!==i[3])&&(e.colorMask(h,v,p,g),i[0]=h,i[1]=v,i[2]=p,i[3]=g)},clearColor:function(h,v,p,g){(h!==o[0]||v!==o[1]||p!==o[2]||g!==o[3])&&(e.clearColor(h,v,p,g),o[0]=h,o[1]=v,o[2]=p,o[3]=g)},blendFunc:function(h,v){(h!==s||v!==u||h!==l||v!==c)&&(e.blendFunc(h,v),s=h,u=v,l=h,c=v)},blendFuncSeparate:function(h,v,p,g){(h!==s||v!==u||p!==l||g!==c)&&(e.blendFuncSeparate(h,v,p,g),s=h,u=v,l=p,c=g)},blendEquation:function(h){(h!==d||h!==f)&&(e.blendEquation(h),d=h,f=h)},blendEquationSeparate:function(h,v){(h!==d||v!==f)&&(e.blendEquationSeparate(h,v),d=h,f=v)},reset:function(){t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),i=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA)}}}var Cp;(function(e){function t(a,i,o){return{array:a,width:i,height:o}}e.create=t;function r(a){for(var i=a.array,o=a.width,s=a.height,u=o*4,l=0,c=s/2;l<c;++l)for(var d=0,f=u;d<f;++d){var h=l*u+d,v=(s-l-1)*u+d,p=i[h];i[h]=i[v],i[v]=p}return a}e.flipY=r;function n(a){for(var i=a.array,o=0,s=i.length;o<s;o+=4){var u=i[o+3]/255;i[o]/=u,i[o+1]/=u,i[o+2]/=u}return a}e.divideByAlpha=n})(Cp||(Cp={}));var BOe=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
float preFogAlpha = gl_FragColor.a;
if (!uTransparentBackground) {
    if (gl_FragColor.a < 1.0) {
        // transparent objects are blended with background color
        gl_FragColor.a = fogAlpha;
    } else {
        // mix opaque objects with background color
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
    }
} else {
    // pre-multiplied alpha expected for transparent background
    gl_FragColor.rgb *= fogAlpha;
    gl_FragColor.a = fogAlpha;
}
`,UOe=`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }
}
`,jOe=`
// inputs
// - vec4 material
// - vec3 vViewPosition
// - vec3 normal
// - float uMetalness
// - float uRoughness
// - float uReflectivity
// - float uLightIntensity
// - float uAmbientIntensity

// outputs
// - sets gl_FragColor

vec4 color = material;

ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0));

PhysicalMaterial physicalMaterial;
physicalMaterial.diffuseColor = color.rgb * (1.0 - uMetalness);
physicalMaterial.specularRoughness = clamp(uRoughness, 0.04, 1.0);
physicalMaterial.specularColor = mix(vec3(0.16 * pow2(uReflectivity)), color.rgb, uMetalness);

GeometricContext geometry;
geometry.position = -vViewPosition;
geometry.normal = normal;
geometry.viewDir = normalize(vViewPosition);

IncidentLight directLight;
directLight.direction = vec3(0.0, 0.0, -1.0);
directLight.color = vec3(uLightIntensity);

RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);

vec3 irradiance = vec3(uAmbientIntensity) * PI;
RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;

gl_FragColor = vec4(outgoingLight, color.a);

#ifdef dXrayShaded
    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0, 0, 1))), uXrayEdgeFalloff);
#endif
`,zOe=`
float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
if (marker > 0.1) {
    if (intMod(marker, 2.0) > 0.1) {
        gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);
        gl_FragColor.a = max(0.02, gl_FragColor.a); // for direct-volume rendering
    } else {
        gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);
    }
}
`,VOe=`
#if dClipObjectCount != 0 && defined(dClipping)
    vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
#endif
`,HOe=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 gridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 gridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;
    #endif

    #ifdef dOverpaint
        vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
    #endif
#elif defined(dRenderVariant_pick)
    #if defined(dRenderVariant_pickObject)
        vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
    #elif defined(dRenderVariant_pickInstance)
        vColor = vec4(encodeFloatRGB(aInstance), 1.0);
    #elif defined(dRenderVariant_pickGroup)
        vColor = vec4(encodeFloatRGB(group), 1.0);
    #endif
#endif

#ifdef dTransparency
    vGroup = group;
    vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
#endif
`,GOe=`
#ifdef dGeoTexture
    float group = decodeFloatRGB(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`,qOe=`
vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
`,WOe=`
#if defined(dRenderVariant_color)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif
#elif defined(dRenderVariant_pick)
    vec4 material = vColor;
#elif defined(dRenderVariant_depth)
    #ifdef enabledFragDepth
        vec4 material = packDepthToRGBA(gl_FragDepthEXT);
    #else
        vec4 material = packDepthToRGBA(gl_FragCoord.z);
    #endif
#endif

// apply screendoor transparency
#if defined(dTransparency)
    float ta = 1.0 - vTransparency;

    #if defined(dRenderVariant_pick)
        if (ta < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #else
        #if defined(dRenderVariant_colorBlended)
            float at = 0.0;

            // shift by view-offset during multi-sample rendering to allow for blending
            vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

            const mat4 thresholdMatrix = mat4(
                1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
                13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
                4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
                16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
            );
            int ci = int(intMod(coord.x, 4.0));
            int ri = int(intMod(coord.y, 4.0));
            #if __VERSION__ == 100
                vec4 i = vec4(float(ci * 4 + ri));
                vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                    thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                    thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                    thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
                at = v.x + v.y + v.z + v.w;
            #else
                at = thresholdMatrix[ci][ri];
            #endif

            if (ta < 0.99 && (ta < 0.01 || ta < at)) {
                discard;
            }
        #elif defined(dRenderVariant_colorWboit)
            material.a *= ta;
        #endif
    #endif
#endif
`,$Oe=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeoTexture
    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`,XOe=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = decodeFloatRGB(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`,YOe=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float alpha = (1.0 - fogFactor) * uAlpha;
if (uAlpha < uPickingAlphaThreshold || alpha < 0.1)
    discard; // ignore so the element below can be picked
`,KOe=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    int flag = 0;
    #if defined(dClipping)
        flag = int(floor(vClipping * 255.0 + 0.5));
    #endif

    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);
    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w), flag))
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
#endif
`,QOe=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    #if defined(dClipping)
        int clippingFlag = int(floor(vClipping * 255.0 + 0.5));
    #else
        int clippingFlag = 0;
    #endif

    if (clipTest(vec4(vModelPosition, 0.0), clippingFlag))
        discard;
#endif
`,ZOe=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat in vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
#endif

#ifdef dUsePalette
    uniform sampler2D tPalette;
    varying float vPaletteV;
#endif
`,JOe=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat out vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
    uniform vec2 uTransparencyTexDim;
    uniform sampler2D tTransparency;
#endif

#ifdef dUsePalette
    varying float vPaletteV;
#endif
`,eLe=`
#if dClipObjectCount != 0
    vec3 quaternionTransform(vec4 q, vec3 v) {
        vec3 t = 2.0 * cross(q.xyz, v);
        return v + q.w * t + cross(q.xyz, t);
    }

    vec4 computePlane(vec3 normal, vec3 inPoint) {
        return vec4(normalize(normal), -dot(normal, inPoint));
    }

    float planeSD(vec4 plane, vec3 center) {
        return -dot(plane.xyz, center - plane.xyz * -plane.w);
    }

    float sphereSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        return (
            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
        ) * min(min(size.x, size.y), size.z);
    }

    float cubeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
    }

    float cylinderSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
    }

    float infiniteConeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        float q = length(t.xy);
        return dot(size.xy, vec2(q, t.z));
    }

    float getSignedDistance(vec3 center, int type, vec3 position, vec4 rotation, vec3 scale) {
        if (type == 1) {
            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
            vec4 plane = computePlane(normal, position);
            return planeSD(plane, center);
        } else if (type == 2) {
            return sphereSD(position, rotation, scale * 0.5, center);
        } else if (type == 3) {
            return cubeSD(position, rotation, scale * 0.5, center);
        } else if (type == 4) {
            return cylinderSD(position, rotation, scale * 0.5, center);
        } else if (type == 5) {
            return infiniteConeSD(position, rotation, scale * 0.5, center);
        } else {
            return 0.1;
        }
    }

    #if __VERSION__ == 100
        // 8-bit
        int bitwiseAnd(int a, int b) {
            int d = 128;
            int result = 0;
            for (int i = 0; i < 8; ++i) {
                if (d <= 0) break;
                if (a >= d && b >= d) result += d;
                if (a >= d) a -= d;
                if (b >= d) b -= d;
                d /= 2;
            }
            return result;
        }

        bool hasBit(int mask, int bit) {
            return bitwiseAnd(mask, bit) == 0;
        }
    #else
        bool hasBit(int mask, int bit) {
            return (mask & bit) == 0;
        }
    #endif

    // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
    bool clipTest(vec4 sphere, int flag) {
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, i + 1)) {
                // TODO take sphere radius into account?
                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        return false;
    }
#endif
`,tLe=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat in float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;

uniform mat4 uProjection;
`,rLe=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat out float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

#if __VERSION__ == 100
    attribute float aVertex;
    #define VertexID int(aVertex)
#else
    // not using gl_VertexID but aVertex to ensure there is an active attribute with divisor 0
    // since FF 85 this is not needed anymore but lets keep it for backwards compatibility
    // https://bugzilla.mozilla.org/show_bug.cgi?id=1679693
    // see also note in src/mol-gl/webgl/render-item.ts
    attribute float aVertex;
    #define VertexID int(aVertex)
    // #define VertexID gl_VertexID
#endif
`,nLe=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit)
    #define dRenderVariant_color
#endif

#if defined(dRenderVariant_pickObject) || defined(dRenderVariant_pickInstance) || defined(dRenderVariant_pickGroup)
    #define dRenderVariant_pick
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6

#define saturate(a) clamp(a, 0.0, 1.0)

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

const float maxFloat = 10000.0; // NOTE constant also set in TypeScript
const float floatLogFactor = 9.210440366976517; // log(maxFloat + 1.0);
float encodeFloatLog(const in float value) { return log(value + 1.0) / floatLogFactor; }
float decodeFloatLog(const in float value) { return exp(value * floatLogFactor) - 1.0; }

vec3 encodeFloatRGB(in float value) {
    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float decodeFloatRGB(const in vec3 rgb) {
    return (rgb.r * 256.0 * 256.0 * 255.0 + rgb.g * 256.0 * 255.0 + rgb.b * 255.0) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)
#endif
`,aLe=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`,iLe=`
uniform float uLightIntensity;
uniform float uAmbientIntensity;
uniform float uReflectivity;
uniform float uMetalness;
uniform float uRoughness;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float specularRoughness;
    vec3 specularColor;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotLH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotLH - 6.98316) * dotLH);
    return (1.0 - specularColor) * fresnel + specularColor;
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    // dotNL and dotNV are explicitly swapped. This is not a mistake.
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney’s reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

vec3 BRDF_Diffuse_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility
vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize(incidentLight.direction + geometry.viewDir);

    float dotNL = saturate(dot(geometry.normal, incidentLight.direction));
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    float dotNH = saturate(dot(geometry.normal, halfDir));
    float dotLH = saturate(dot(incidentLight.direction, halfDir));

    vec3 F = F_Schlick(specularColor, dotLH);
    float G = G_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (G * D);
}

// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile
vec3 BRDF_Specular_GGX_Environment(const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;
    return specularColor * AB.x + AB.y;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    irradiance *= PI; // punctual light

    reflectedLight.directSpecular += irradiance * BRDF_Specular_GGX(directLight, geometry, material.specularColor, material.specularRoughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}
`,oLe=`
float matrixScale(in mat4 m){
    vec4 r = m[0];
    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);
}
`,sLe=`
varying vec3 vNormal;
`,uLe=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`,lLe=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`,cLe=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`,dLe=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`,fLe=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`,hLe=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`,pLe=`
#if defined(dRenderVariant_colorWboit)
    #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
        uniform sampler2D tDepth;
        uniform vec2 uDrawingBufferSize;

        float getDepth(const in vec2 coords) {
            // always packed due to merged depth from primitives and volumes
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #endif
#endif

uniform bool uRenderWboit;

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
`,vLe=`
#if defined(dRenderVariant_colorWboit)
    if (!uRenderWboit) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderWboit) {
        // the 'fragmentDepth > 0.99' check is to handle precision issues with packed depth
        if (preFogAlpha != 1.0 && !interior && (fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize) || fragmentDepth > 0.99)) {
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`,mLe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,gLe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

#ifdef dPointFilledCircle
    uniform float uPointEdgeBleach;
#endif

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #ifdef dPointFilledCircle
            float dist = distance(gl_PointCoord, center);
            float alpha = 1.0 - smoothstep(radius - uPointEdgeBleach, radius, dist);
            if (alpha < 0.0001) discard;
            gl_FragColor.a *= alpha;
        #endif

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,yLe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#include matrix_scale

const mat4 D = mat4(
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, -1.0
);

/**
 * Compute point size and center using the technique described in:
 * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396
 * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.
 */
void quadraticProjection(const in float radius, const in vec3 position){
    vec2 xbc, ybc;

    mat4 T = mat4(
        radius, 0.0, 0.0, 0.0,
        0.0, radius, 0.0, 0.0,
        0.0, 0.0, radius, 0.0,
        position.x, position.y, position.z, 1.0
    );

    mat4 R = transpose4(uProjection * uModelView * aTransform * T);
    float A = dot(R[3], D * R[3]);
    float B = -2.0 * dot(R[0], D * R[3]);
    float C = dot(R[0], D * R[0]);
    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sx = abs(xbc[0] - xbc[1]) * 0.5;

    A = dot(R[3], D * R[3]);
    B = -2.0 * dot(R[1], D * R[3]);
    C = dot(R[1], D * R[1]);
    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sy = abs(ybc[0] - ybc[1]) * 0.5;

    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));
    gl_Position.xy -= aMapping * vec2(sx, sy);
    gl_Position.xy *= gl_Position.w;
}


void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * matrixScale(uModelView);

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;
    mvPosition.z -= vRadius; // avoid clipping, added again in fragment shader

    gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
    quadraticProjection(size, aPosition);

    vRadiusSq = vRadius * vRadius;
    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    #include clip_instance
}
`,bLe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

vec3 cameraPos;
vec3 cameraNormal;

bool Impostor(out vec3 cameraPos, out vec3 cameraNormal){
    vec3 cameraSpherePos = -vPointViewPosition;
    cameraSpherePos.z += vRadius;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadiusSq - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0){
        discard;
        return false;
    }

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B + sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, sqrtDet - B, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;


    if (calcDepth(cameraPos) <= 0.0) {
        cameraPos = rayDirection * posT + rayOrigin;
        interior = true;
    } else {
        interior = false;
    }

    cameraNormal = normalize(cameraPos - cameraSpherePos);
    cameraNormal *= float(!interior) * 2.0 - 1.0;

    return !interior;
}

void main(void){
    #include clip_pixel

    bool flag = Impostor(cameraPos, cameraNormal);
    #ifndef dDoubleSided
        if (interior)
            discard;
    #endif

    vec3 vViewPosition = cameraPos;
    gl_FragDepthEXT = calcDepth(vViewPosition);
    if (!flag && gl_FragDepthEXT >= 0.0) {
        gl_FragDepthEXT = 0.0 + (0.0000001 / vRadius);
    }

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            vec3 normal = -cameraNormal;
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,xLe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = aTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) dir = -dir;

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,SLe=`
precision highp float;
precision highp int;

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec4 intersection, out bool interior
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard*bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
        return true;
    }

    if (topCap && y < 0.0) {
        // top cap
        t = -baoc / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    } else if(bottomCap && y >= 0.0) {
        // bottom cap
        t = (baba - baoc) / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    }

    #ifdef dDoubleSided
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
            return true;
        }

        // TODO: handle inside caps???
    #endif

    return false;
}

void main() {
    #include clip_pixel

    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec4 intersection;
    bool interior;
    bool hit = CylinderImpostor(vModelPosition, rayDir, vStart, vEnd, vSize, intersection, interior);
    if (!hit) discard;

    vec3 vViewPosition = vModelPosition + intersection.x * rayDir;
    vViewPosition = (uView * vec4(vViewPosition, 1.0)).xyz;
    gl_FragDepthEXT = calcDepth(vViewPosition);

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            mat3 normalMatrix = transpose3(inverse3(mat3(uView)));
            vec3 normal = normalize(normalMatrix * -normalize(intersection.yzw));
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,CLe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

// uniform bool ortho;
uniform float uPixelRatio;
uniform float uViewportHeight;

varying vec2 vTexCoord;

#include matrix_scale

void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = matrixScale(uModelView);

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    mvCorner.xy += aMapping * size * scale;
    mvCorner.x += offsetX;
    mvCorner.y += offsetY;

    // TODO
    // if(ortho){
    //     mvCorner.xyz += normalize(-uCameraPosition) * offsetZ;
    // } else {
    //     mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
    // }
    mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`,_Le=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

const float smoothness = 32.0;
const float gamma = 2.2;

void main2(){
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        gl_FragColor = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        // perform adaptive anti-aliasing of the edges
        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);
        float a = smoothstep(0.5 - w, 0.5 + w, sdf);

        // gamma correction for linear attenuation
        a = pow(a, 1.0 / gamma);

        if (a < 0.5) discard;
        material.a *= a;

        // add border
        float t = 0.5 + uBorderWidth;
        if (uBorderWidth > 0.0 && sdf < t) {
            material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));
        }

        gl_FragColor = material;
    }

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,wLe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= uPixelRatio;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= uPixelRatio;
    offset.x /= uPixelRatio;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewportHeight / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewportHeight;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`,ELe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

void main(){
    #include clip_pixel

    bool interior = false;
    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,ALe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip

#if defined(dColorType_grid)
    #include texture3d_from_2d_linear
#endif

#ifdef dGeoTexture
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeoTexture
        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided) && !defined(dDoubleSided) // TODO checking dDoubleSided should not be required, ASR
        transformedNormal = -transformedNormal;
    #endif
    vNormal = transformedNormal;
}
`,PLe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip
#include wboit_params

void main() {
    #include clip_pixel

    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)
    #if defined(enabledStandardDerivatives)
        vec3 fdx = dFdx(vViewPosition);
        vec3 fdy = dFdy(vViewPosition);
        vec3 faceNormal = normalize(cross(fdx,fdy));
        bool frontFacing = dot(vNormal, faceNormal) > 0.0;
    #else
        bool frontFacing = dot(vNormal, vViewPosition) < 0.0;
    #endif

    #if defined(dFlipSided)
        interior = frontFacing;
    #else
        interior = !frontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            #if defined(dFlatShaded) && defined(enabledStandardDerivatives)
                vec3 normal = -faceNormal;
            #else
                vec3 normal = -normalize(vNormal);
                #ifdef dDoubleSided
                    normal = normal * (float(frontFacing) * 2.0 - 1.0);
                #endif
            #endif
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,TLe=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`,ILe=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec2 uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_texture)
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

#include wboit_params

vec4 transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0));
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        if (!uRenderWboit) {
            // in case of opaque volumes (and depth texture support)
            return texture2D(tDepth, coords).r;
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    #if defined(dRenderVariant_color) && !defined(dIgnoreLight)
        mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));
    #endif
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    bool hit = false;
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;
    vec3 isoPos;

    vec3 nextPos;
    float nextValue;

    vec3 color = vec3(0.45, 0.55, 0.8);
    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            if (hit) break;
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        #if defined(dRenderMode_isosurface)
            if (prevValue > 0.0 && ( // there was a prev Value
                (prevValue < uIsoValue.x && value > uIsoValue.x) || // entering isosurface
                (prevValue > uIsoValue.x && value < uIsoValue.x) // leaving isosurface
            )) {
                isoPos = v3m4(mix(pos - step, pos, ((prevValue - uIsoValue.x) / ((prevValue - uIsoValue.x) - (value - uIsoValue.x)))), cartnToUnit);

                vec4 mvPosition = modelViewTransform * vec4(isoPos * uGridDim, 1.0);

                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    vec3 vModelPosition = v3m4(isoPos * uGridDim, modelTransform);
                    if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                        prevValue = value;
                        pos += step;
                        continue;
                    }
                #endif

                float depth = calcDepth(mvPosition.xyz);
                if (depth > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                    break;

                #ifdef enabledFragDepth
                    if (!hit) {
                        gl_FragDepthEXT = depth;
                    }
                #endif

                #if defined(dRenderVariant_pickObject)
                    return vec4(encodeFloatRGB(float(uObjectId)), 1.0);
                #elif defined(dRenderVariant_pickInstance)
                    return vec4(encodeFloatRGB(vInstance), 1.0);
                #elif defined(dRenderVariant_pickGroup)
                    #ifdef dPackedGroup
                        return vec4(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb, 1.0);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        return vec4(encodeFloatRGB(g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y), 1.0);
                    #endif
                #elif defined(dRenderVariant_depth)
                    #ifdef enabledFragDepth
                        return packDepthToRGBA(gl_FragDepthEXT);
                    #else
                        return packDepthToRGBA(depth);
                    #endif
                #elif defined(dRenderVariant_color)
                    #ifdef dPackedGroup
                        float group = decodeFloatRGB(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                    #endif

                    #if defined(dColorType_uniform)
                        color = uColor;
                    #elif defined(dColorType_instance)
                        color = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
                    #elif defined(dColorType_group)
                        color = readFromTexture(tColor, group, uColorTexDim).rgb;
                    #elif defined(dColorType_groupInstance)
                        color = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
                    #elif defined(dColorType_vertex)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, 0.0).rgb;
                    #elif defined(dColorType_vertexInstance)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
                    #endif

                    // handle flipping and negative isosurfaces
                    #ifdef dFlipSided
                        bool flipped = value < uIsoValue.y; // flipped
                    #else
                        bool flipped = value > uIsoValue.y;
                    #endif
                    interior = value < uIsoValue.x && flipped;
                    #ifndef dDoubleSided
                        if (interior) {
                            prevValue = value;
                            pos += step;
                            continue;
                        }
                    #endif
                    vec3 vViewPosition = mvPosition.xyz;
                    vec4 material = vec4(color, uAlpha);

                    #ifdef dIgnoreLight
                        gl_FragColor = material;
                    #else
                        #if defined(dFlatShaded)
                            // nearest grid point
                            isoPos = floor(isoPos * uGridDim + 0.5) / uGridDim;
                        #endif
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(isoPos - dx).a - textureVal(isoPos + dx).a;
                            gradient.y = textureVal(isoPos - dy).a - textureVal(isoPos + dy).a;
                            gradient.z = textureVal(isoPos - dz).a - textureVal(isoPos + dz).a;
                        #else
                            gradient = textureVal(isoPos).xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        normal = normal * (float(flipped) * 2.0 - 1.0);
                        normal = normal * -(float(interior) * 2.0 - 1.0);
                        #include apply_light_color
                    #endif

                    float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                    #include apply_interior_color
                    #include apply_marker_color

                    preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                    fragmentDepth = depth;
                    #include apply_fog

                    src = gl_FragColor;

                    if (!uTransparentBackground) {
                        // done in 'apply_fog' otherwise
                        src.rgb *= src.a;
                    }
                    dst = (1.0 - dst.a) * src + dst; // standard blending
                #endif

                #ifdef dSingleLayer
                    break;
                #endif

                hit = true;
            }
            prevValue = value;
        #elif defined(dRenderMode_volume)
            vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
            if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                break;

            #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);
                if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                    prevValue = value;
                    pos += step;
                    continue;
                }
            #endif

            #if defined(dRenderVariant_color)
                vec3 vViewPosition = mvPosition.xyz;
                vec4 material = transferFunction(value);

                #ifdef dIgnoreLight
                    gl_FragColor.rgb = material.rgb;
                #else
                    if (material.a >= 0.01) {
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                            gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                            gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                        #else
                            gradient = cell.xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        #include apply_light_color
                    } else {
                        gl_FragColor.rgb = material.rgb;
                    }
                #endif

                gl_FragColor.a = material.a * uAlpha * uTransferScale;

                #ifdef dPackedGroup
                    float group = decodeFloatRGB(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
                #else
                    vec3 g = floor(unitPos * uGridDim + 0.5);
                    float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                #endif

                float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                #include apply_marker_color

                preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                fragmentDepth = calcDepth(mvPosition.xyz);
                #include apply_fog

                src = gl_FragColor;

                if (!uTransparentBackground) {
                    // done in 'apply_fog' otherwise
                    src.rgb *= src.a;
                }
                dst = (1.0 - dst.a) * src + dst; // standard blending
            #endif
        #endif

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
        // ensure depth is written everywhere
        if (!hit)
            gl_FragDepthEXT = 1.0;
    #endif

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    if (gl_FrontFacing)
        discard;

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        #if defined(dRenderMode_volume)
            // always ignore pick & depth for volume
            discard;
        #elif defined(dRenderMode_isosurface)
            if (uAlpha < uPickingAlphaThreshold)
                discard; // ignore so the element below can be picked
        #endif
    #endif

    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 step = rayDir * uStepScale;

    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);
    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);
    gl_FragColor = raymarch(start, step, rayDir);

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        // discard when nothing was hit
        if (gl_FragColor == vec4(0.0))
            discard;
    #endif

    #if defined(dRenderVariant_color)
        #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
            float fragmentDepth = gl_FragDepthEXT;
        #else
            float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);
        #endif
        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
        interior = false;
        #include wboit_write
    #endif
}
`,MLe=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`,DLe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip
#include wboit_params

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        vec4 imageData = biCubic(tImageTex, vUv);
    #else
        vec4 imageData = texture2D(tImageTex, vUv);
    #endif
    imageData.a = clamp(imageData.a, 0.0, 1.0);
    if (imageData.a > 0.9) imageData.a = 1.0;

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;

    #if defined(dRenderVariant_pick)
        if (imageData.a < 0.3)
            discard;

        #if defined(dRenderVariant_pickObject)
            gl_FragColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
        #elif defined(dRenderVariant_pickInstance)
            gl_FragColor = vec4(encodeFloatRGB(vInstance), 1.0);
        #elif defined(dRenderVariant_pickGroup)
            gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);
        #endif
    #elif defined(dRenderVariant_depth)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
    #elif defined(dRenderVariant_color)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = imageData;
        gl_FragColor.a *= uAlpha;

        float group = decodeFloatRGB(texture2D(tGroupTex, vUv).rgb);
        float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,aQ=zi(),RLe={apply_fog:BOe,apply_interior_color:UOe,apply_light_color:jOe,apply_marker_color:zOe,assign_clipping_varying:VOe,assign_color_varying:HOe,assign_group:GOe,assign_marker_varying:qOe,assign_material_color:WOe,assign_position:$Oe,assign_size:XOe,check_picking_alpha:YOe,clip_instance:KOe,clip_pixel:QOe,color_frag_params:ZOe,color_vert_params:JOe,common_clip:eLe,common_frag_params:tLe,common_vert_params:rLe,common:nLe,float_to_rgba:aLe,light_frag_params:iLe,matrix_scale:oLe,normal_frag_params:sLe,read_from_texture:uLe,rgba_to_float:lLe,size_vert_params:cLe,texture3d_from_1d_trilinear:dLe,texture3d_from_2d_linear:fLe,texture3d_from_2d_nearest:hLe,wboit_params:pLe,wboit_write:vLe},kLe=/^(?!\/\/)\s*#include\s+(\S+)/gmi,OLe=/[ \t]*\/\/.*\n/g,LLe=/[ \t]*\/\*[\s\S]*?\*\//g,NLe=/\n{2,}/g;function AU(e){return e.replace(kLe,function(t,r){var n=RLe[r];if(!n)throw new Error("empty chunk, '"+r+"'");return n}).trim().replace(OLe,`
`).replace(LLe,`
`).replace(NLe,`
`)}function Ln(e,t,r,n,a){return n===void 0&&(n={}),a===void 0&&(a={}),{id:aQ(),name:e,vert:AU(t),frag:AU(r),extensions:n,outTypes:a}}var FLe=Ln("points",mLe,gLe,{drawBuffers:"optional"}),BLe=Ln("spheres",yLe,bLe,{fragDepth:"required",drawBuffers:"optional"}),ULe=Ln("cylinders",xLe,SLe,{fragDepth:"required",drawBuffers:"optional"}),jLe=Ln("text",CLe,_Le,{standardDerivatives:"required",drawBuffers:"optional"}),zLe=Ln("lines",wLe,ELe,{drawBuffers:"optional"}),iQ=Ln("mesh",ALe,PLe,{standardDerivatives:"optional",drawBuffers:"optional"}),VLe=Ln("direct-volume",TLe,ILe,{fragDepth:"optional",drawBuffers:"optional"}),HLe=Ln("image",MLe,DLe,{drawBuffers:"optional"});function GLe(e){if(e===void 0)return"";var t=[];for(var r in e){var n=e[r],a=n.ref.value;if(a!==void 0)if(typeof a=="string")t.push("#define "+r+"_"+a);else if(typeof a=="number")t.push("#define "+r+" "+a);else if(typeof a=="boolean")a&&t.push("#define "+r);else throw new Error("unknown define type")}return t.join(`
`)+`
`}function qLe(e,t){var r=[];if(t.standardDerivatives&&(r.push("#extension GL_OES_standard_derivatives : enable"),r.push("#define enabledStandardDerivatives")),t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var WLe=`#version 300 es
#define attribute in
#define varying out
#define texture2D texture
`,$Le=`
#define varying in
#define texture2D texture
#define texture2DLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth

#define depthTextureSupport
`;function XLe(e,t,r,n){var a=["#version 300 es","layout(location = 0) out highp "+(n[0]||"vec4")+" out_FragData0;"];if(r.standardDerivatives&&a.push("#define enabledStandardDerivatives"),r.fragDepth&&a.push("#define enabledFragDepth"),r.drawBuffers){a.push("#define requiredDrawBuffers");for(var i=e.getParameter(e.MAX_DRAW_BUFFERS),o=1,s=i;o<s;++o)a.push("layout(location = "+o+") out highp "+(n[o]||"vec4")+" out_FragData"+o+";")}return r.shaderTextureLod&&a.push("#define enabledShaderTextureLod"),a.push($Le),a.join(`
`)+`
`}function YLe(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function KLe(e,t,r,n){var a=GLe(r),i=Er(e)?WLe:"",o=Er(e)?XLe(e,t,n.extensions,n.outTypes):qLe(t,n.extensions),s=Er(e)?YLe(n.frag):n.frag;return{id:aQ(),name:n.name,vert:""+i+a+n.vert,frag:""+o+a+s,extensions:n.extensions,outTypes:n.outTypes}}function QLe(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error("unknown uniform kind '"+t+"'")}}function ZLe(e,t,r){e.uniform1f(t,r)}function JLe(e,t,r){e.uniform1fv(t,r)}function eNe(e,t,r){e.uniform1i(t,r)}function tNe(e,t,r){e.uniform1iv(t,r)}function rNe(e,t,r){e.uniform2fv(t,r)}function nNe(e,t,r){e.uniform3fv(t,r)}function aNe(e,t,r){e.uniform4fv(t,r)}function iNe(e,t,r){e.uniformMatrix3fv(t,!1,r)}function oNe(e,t,r){e.uniformMatrix4fv(t,!1,r)}function PU(e){switch(e){case"f":return ZLe;case"f[]":return JLe;case"i":case"t":case"b":return eNe;case"i[]":case"t[]":case"b[]":return tNe;case"v2":case"v2[]":return rNe;case"v3":case"v3[]":return nNe;case"v4":case"v4[]":return aNe;case"m3":case"m3[]":return iNe;case"m4":case"m4[]":return oNe}}function sNe(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];n.type==="uniform"?t[r]=PU(n.kind):n.type==="texture"&&(t[r]=PU("t"))}),t}function uNe(e){var t={};return Object.keys(e).forEach(function(r){t[r]=N.create(Qf(e[r].ref.value))}),t}var lNe=zi();function cNe(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}function dNe(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;throw new Error("Should nevver happen")}function fNe(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":return e.UNIFORM_BUFFER}}function TU(e){var t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function oQ(e,t,r,n){var a=TU(e),i=cNe(e,r),o=fNe(e,n),s=dNe(e,t),u=t.BYTES_PER_ELEMENT,l=t.length;function c(f){e.bindBuffer(o,a),e.bufferData(o,f,i)}c(t);var d=!1;return{id:lNe(),_usageHint:i,_bufferType:o,_dataType:s,_bpe:u,length:l,getBuffer:function(){return a},updateData:c,updateSubData:function(f,h,v){e.bindBuffer(o,a),v-h===f.length?e.bufferSubData(o,0,f):e.bufferSubData(o,h*u,f.subarray(h,h+v))},reset:function(){a=TU(e),c(t)},destroy:function(){d||(e.deleteBuffer(a),d=!0)}}}function hNe(e,t,r){switch(t){case"int32":switch(r){case 1:return e.INT;case 2:return e.INT_VEC2;case 3:return e.INT_VEC3;case 4:return e.INT_VEC4}break;case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}break}throw new Error("unknown attribute type for kind '"+t+"' and itemSize '"+r+"'")}function pNe(e,t,r,n,a,i){i===void 0&&(i="dynamic");var o=t.instancedArrays,s=oQ(e,r,i,"attribute"),u=s._bufferType,l=s._dataType,c=s._bpe;return E(E({},s),{bind:function(d){if(e.bindBuffer(u,s.getBuffer()),n===16)for(var f=0;f<4;++f)e.enableVertexAttribArray(d+f),e.vertexAttribPointer(d+f,4,l,!1,4*4*c,f*4*c),o.vertexAttribDivisor(d+f,a);else e.enableVertexAttribArray(d),e.vertexAttribPointer(d,n,l,!1,0,0),o.vertexAttribDivisor(d,a)}})}function vNe(e,t,r){var n=[];return Object.keys(t).forEach(function(a){var i=t[a];i.type==="attribute"&&(n[n.length]=[a,e.resources.attribute(r[a].ref.value,i.itemSize,i.divisor)])}),n}function mNe(e,t,r){r===void 0&&(r="static");var n=oQ(e,t,r,"elements");return E(E({},n),{bind:function(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}})}var gNe=zi();function yNe(e,t,r){var n={};return Object.keys(r).forEach(function(a){var i=r[a];if(i.type==="attribute"){var o=e.getAttribLocation(t,a);n[a]=o}else if(i.type==="uniform"||i.type==="texture"){var o=e.getUniformLocation(t,a);n[a]=o}}),n}function bNe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<n;++a){var i=e.getActiveAttrib(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeAttribute")||o==="gl_InstanceID"||o==="gl_VertexID")continue;var u=r[o];if(u===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(u.type!=="attribute")throw new Error("'"+o+"' must be of type 'attribute' but is '"+u.type+"'");var l=hNe(e,u.kind,u.itemSize);if(l!==s)throw new Error("unexpected attribute type for "+o)}}}function xNe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<n;++a){var i=e.getActiveUniform(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeUniform"))continue;var u=o.replace(/[[0-9]+\]$/,""),l=r[u];if(l===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(l.type==="uniform"){var c=QLe(e,l.kind);if(c!==s)throw new Error("unexpected uniform type for "+o)}else if(l.type==="texture"){if(l.kind==="image-float32"||l.kind==="image-uint8"){if(s!==e.SAMPLER_2D)throw new Error("unexpected sampler type for '"+o+"'")}else if((l.kind==="volume-float32"||l.kind==="volume-uint8")&&s!==e.SAMPLER_3D)throw new Error("unexpected sampler type for '"+o+"'")}else throw new Error("'"+o+"' must be of type 'uniform' or 'texture' but is '"+l.type+"'")}}}function SNe(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

`+e.getProgramInfoLog(t))}function qM(e){var t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function CNe(e,t,r,n,a){var i=a.defineValues,o=a.shaderCode,s=a.schema,u=qM(e),l=gNe(),c=KLe(e,r,i,o),d=n("vert",c.vert),f=n("frag",c.frag),h,v;function p(){d.attach(u),f.attach(u),e.linkProgram(u),Mr&&SNe(e,u),h=yNe(e,u,s),v=sNe(s),Mr&&(bNe(e,u,s),xNe(e,u,s))}p();var g=!1;return{id:l,use:function(){t.currentProgramId=l,e.useProgram(u)},setUniforms:function(m){for(var y=0,b=m.length;y<b;++y){var S=m[y],x=S[0],C=S[1];if(C){var w=h[x];w!==null&&v[x](e,w,C.ref.value)}}},bindAttributes:function(m){for(var y=0,b=m.length;y<b;++y){var S=m[y],x=S[0],C=S[1],w=h[x];w!==-1&&C.bind(w)}},bindTextures:function(m,y){for(var b=0,S=m.length;b<S;++b){var x=m[b],C=x[0],w=x[1],A=h[C];A!=null&&(w.bind(b+y),v[C](e,A,b+y))}},reset:function(){u=qM(e),p()},destroy:function(){g||(d.destroy(),f.destroy(),e.deleteProgram(u),g=!0)}}}var _Ne=zi();function wNe(e){for(var t=e.split(`
`),r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join(`
`)}function l_(e,t){var r=t.type,n=t.source,a=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(a===null)throw new Error("Error creating "+r+" shader");if(e.shaderSource(a,n),e.compileShader(a),Mr&&e.getShaderParameter(a,e.COMPILE_STATUS)===!1)throw console.warn("'"+r+"' shader info log '"+e.getShaderInfoLog(a)+`'
`+wNe(n)),new Error("Error compiling "+r+" shader");return a}function ENe(e,t){var r=l_(e,t);return{id:_Ne(),attach:function(n){e.attachShader(n,r)},reset:function(){r=l_(e,t)},destroy:function(){e.deleteShader(r)}}}function ANe(e,t){return t===void 0&&(t=0),{value:e,usageCount:t}}function PNe(e){return{free:function(){e.usageCount-=1},value:e.value}}function IU(e,t,r){var n=new Map;return{get:function(a){var i=e(a),o=n.get(i);return o||(o=ANe(t(a)),n.set(i,o)),o.usageCount+=1,PNe(o)},clear:function(){n.forEach(function(a,i){a.usageCount<=0&&(a.usageCount<0&&console.warn("Reference usageCount below zero."),r(a.value),n.delete(i))})},get count(){return n.size},dispose:function(){n.forEach(function(a){return r(a.value)}),n.clear()}}}var TNe=zi();function INe(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth32f":if(Er(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format")}}function MNe(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function MU(e){var t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function DNe(e,t,r,n,a){var i=MU(e),o=function(){return e.bindRenderbuffer(e.RENDERBUFFER,i)},s=INe(e,t),u=MNe(e,r);function l(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,n,a)}l();var c=!1;return{id:TNe(),bind:o,attachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,i),Mr&&eO(e)},setSize:function(d,f){n=d,a=f,l()},reset:function(){i=MU(e),l()},destroy:function(){c||(e.deleteRenderbuffer(i),c=!0)}}}var RNe=zi();function DU(e){var t=e.vertexArrayObject;if(!t)throw new Error("VertexArrayObject not supported");var r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function RU(e){var t=e.vertexArrayObject;if(t===null)throw new Error("VertexArrayObject not supported");return t}function kNe(e,t,r,n){var a=RNe(),i=DU(e),o=RU(e);function s(){o.bindVertexArray(i),n&&n.bind(),t.bindAttributes(r),o.bindVertexArray(null)}s();var u=!1;return{id:a,bind:function(){o.bindVertexArray(i)},update:s,reset:function(){i=DU(e),o=RU(e),s()},destroy:function(){u||(o.deleteVertexArray(i),u=!0)}}}function ONe(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:ik(e)}function kU(e){var t=E(E({},e.value),{destroy:function(){e.free()}});return t}function LNe(e,t,r,n){var a={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,vertexArray:new Set};function i(l,c){return a[l].add(c),r.resourceCounts[l]+=1,E(E({},c),{destroy:function(){c.destroy(),a[l].delete(c),r.resourceCounts[l]-=1}})}var o=IU(function(l){return JSON.stringify(l)},function(l){return i("shader",ENe(e,l))},function(l){l.destroy()});function s(l,c){return kU(o.get({type:l,source:c}))}var u=IU(function(l){var c=[l.shaderCode.id];return Object.keys(l.defineValues).forEach(function(d){return c.push(ik(d),ONe(l.defineValues[d].ref.value))}),Ui(c).toString()},function(l){return i("program",CNe(e,t,n,s,l))},function(l){l.destroy()});return{attribute:function(l,c,d,f){return i("attribute",pNe(e,n,l,c,d,f))},elements:function(l,c){return i("elements",mNe(e,l,c))},framebuffer:function(){return i("framebuffer",LOe(e))},program:function(l,c,d){return kU(u.get({defineValues:l,shaderCode:c,schema:d}))},renderbuffer:function(l,c,d,f){return i("renderbuffer",DNe(e,l,c,d,f))},shader:s,texture:function(l,c,d,f){return i("texture",$M(e,n,l,c,d,f))},vertexArray:function(l,c,d){return i("vertexArray",kNe(n,l,c,d))},getByteCounts:function(){var l=0;a.texture.forEach(function(f){l+=f.getByteCount()});var c=0;a.attribute.forEach(function(f){c+=f.length*4});var d=0;return a.elements.forEach(function(f){d+=f.length*4}),{texture:l,attribute:c,elements:d}},reset:function(){a.attribute.forEach(function(l){return l.reset()}),a.elements.forEach(function(l){return l.reset()}),a.framebuffer.forEach(function(l){return l.reset()}),a.renderbuffer.forEach(function(l){return l.reset()}),a.shader.forEach(function(l){return l.reset()}),a.program.forEach(function(l){return l.reset()}),a.vertexArray.forEach(function(l){return l.reset()}),a.texture.forEach(function(l){return l.reset()})},destroy:function(){a.attribute.forEach(function(l){return l.destroy()}),a.elements.forEach(function(l){return l.destroy()}),a.framebuffer.forEach(function(l){return l.destroy()}),a.renderbuffer.forEach(function(l){return l.destroy()}),a.shader.forEach(function(l){return l.destroy()}),a.program.forEach(function(l){return l.destroy()}),a.vertexArray.forEach(function(l){return l.destroy()}),a.texture.forEach(function(l){return l.destroy()}),o.clear(),u.clear()}}}var sQ=zi();function NNe(e,t,r,n,a,i,o){a===void 0&&(a=!0),i===void 0&&(i="uint8"),o===void 0&&(o="nearest");var s=t.framebuffer(),u=i==="fp16"?t.texture("image-float16","rgba","fp16",o):i==="float32"?t.texture("image-float32","rgba","float",o):t.texture("image-uint8","rgba","ubyte",o),l=a?Er(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function c(){u.define(r,n),u.attachFramebuffer(s,"color0"),l&&l.attachFramebuffer(s)}c();var d=!1;return{id:sQ(),texture:u,framebuffer:s,getWidth:function(){return r},getHeight:function(){return n},bind:function(){s.bind()},setSize:function(f,h){r===f&&n===h||(r=f,n=h,u.define(r,n),l&&l.setSize(r,n))},reset:function(){c()},destroy:function(){d||(u.destroy(),s.destroy(),l&&l.destroy(),d=!0)}}}function FNe(e){return{id:sQ(),texture:D3(e),framebuffer:NOe(),getWidth:function(){return 0},getHeight:function(){return 0},bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:function(){},reset:function(){},destroy:function(){}}}function BNe(e,t){function r(a){try{return e.getContext(a,t)}catch{return null}}var n=r("webgl2")||r("webgl")||r("experimental-webgl");return Mr&&console.log("isWebgl2: "+Er(n)),n}function uQ(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function lQ(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL error: '"+uQ(e,t)+"'")}function UNe(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),Er(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var a=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=0;r<a;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),c_(e)}function c_(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var cQ=new Uint8Array(1*4);function dQ(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):hk.setImmediate(dQ,e,t,r)}function fQ(e,t){var r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?hk.setImmediate(dQ,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,cQ),t())}var OU=!1;function jNe(e){return new Promise(function(t){Er(e)?fQ(e,t):(OU||(console.info("Sync object not supported in WebGL"),OU=!0),hQ(e),t())})}function hQ(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,cQ)}function WM(e,t,r,n,a,i){if(Mr&&eO(e),i instanceof Uint8Array)e.readPixels(t,r,n,a,e.RGBA,e.UNSIGNED_BYTE,i);else if(i instanceof Float32Array)e.readPixels(t,r,n,a,e.RGBA,e.FLOAT,i);else if(i instanceof Int32Array&&Er(e))e.readPixels(t,r,n,a,e.RGBA_INTEGER,e.INT,i);else throw new Error("unsupported readPixels buffer type");Mr&&lQ(e)}function zNe(e){var t=e.drawingBufferWidth,r=e.drawingBufferHeight,n=new Uint8Array(t*r*4);return c_(e),e.viewport(0,0,t,r),WM(e,0,0,t,r,n),Cp.flipY(Cp.create(n,t,r))}function VNe(){return{resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0}}function HNe(e,t){var r=this;t===void 0&&(t={});var n=EU(e),a=FOe(e),i=VNe(),o=LNe(e,a,i,n),s={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:Er(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(s.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');var u=!1,l=new _f(0),c;if(Er(e)){var d=e.createBuffer(),f=void 0,h=void 0,v=!1,p=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,f),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),v=!1,h(),h=void 0,f=void 0};c=function(m,y,b,S,x){return new Promise(function(C,w){if(v){w("Can not call multiple readPixelsAsync at the same time");return}v=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.bufferData(e.PIXEL_PACK_BUFFER,b*S*4,e.STREAM_READ),e.readPixels(m,y,b,S,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),h=C,f=x,fQ(e,p)})}}else c=function(m,y,b,S,x){return de(r,void 0,void 0,function(){return fe(this,function(C){return WM(e,m,y,b,S,x),[2]})})};var g=new Set;return{gl:e,isWebGL2:Er(e),get pixelRatio(){var m=typeof window<"u"?window.devicePixelRatio:1;return m*(t.pixelScale||1)},extensions:n,state:a,stats:i,resources:o,get maxTextureSize(){return s.maxTextureSize},get max3dTextureSize(){return s.max3dTextureSize},get maxRenderbufferSize(){return s.maxRenderbufferSize},get maxDrawBuffers(){return s.maxDrawBuffers},get maxTextureImageUnits(){return s.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return u||e.isContextLost()},contextRestored:l,setContextLost:function(){u=!0},handleContextRestored:function(m){Object.assign(n,EU(e)),a.reset(),a.currentMaterialId=-1,a.currentProgramId=-1,a.currentRenderItemId=-1,o.reset(),g.forEach(function(y){return y.reset()}),m==null||m(),u=!1,l.next(kn())},createRenderTarget:function(m,y,b,S,x){var C=NNe(e,o,m,y,b,S,x);return g.add(C),E(E({},C),{destroy:function(){C.destroy(),g.delete(C)}})},unbindFramebuffer:function(){return c_(e)},readPixels:function(m,y,b,S,x){WM(e,m,y,b,S,x)},readPixelsAsync:c,waitForGpuCommandsComplete:function(){return jNe(e)},waitForGpuCommandsCompleteSync:function(){return hQ(e)},getDrawingBufferPixelData:function(){return zNe(e)},clear:function(m,y,b,S){c_(e),a.enable(e.SCISSOR_TEST),a.depthMask(!0),a.colorMask(!0,!0,!0,!0),a.clearColor(m,y,b,S),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:function(m){var y;o.destroy(),UNe(e),m!=null&&m.doNotForceWebGLContextLoss||(y=e.getExtension("WEBGL_lose_context"))===null||y===void 0||y.loseContext()}}}function Er(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}function GNe(e){if(Er(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}function qNe(e){if(Er(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}function WNe(e){return Er(e)?{}:e.getExtension("OES_element_index_uint")}function $Ne(e){if(Er(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}function XNe(e){return Er(e)?{}:e.getExtension("OES_texture_float")}function YNe(e){return e.getExtension("OES_texture_float_linear")}function KNe(e){if(Er(e))return{HALF_FLOAT:e.HALF_FLOAT};var t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}function QNe(e){return e.getExtension("OES_texture_half_float_linear")}function ZNe(e){if(Er(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}function JNe(e){return Er(e)?{}:e.getExtension("EXT_frag_depth")}function eFe(e){if(Er(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});var t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),pQ(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}function tFe(e){if(Er(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});var t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),pQ(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}function rFe(e){if(Er(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};var t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}function nFe(e){return Er(e)?{}:e.getExtension("EXT_shader_texture_lod")}function aFe(e){if(Er(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};var t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}function iFe(e){if(Er(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};var t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}var oFe=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,sFe=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,uFe=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function pQ(e,t){var r=l_(e,{type:"vert",source:oFe}),n=l_(e,{type:"frag",source:sFe});if(!r||!n)return!1;var a=qM(e);e.attachShader(a,r),e.attachShader(a,n),e.linkProgram(a),e.useProgram(a);var i=e.getAttribLocation(a,"aPosition"),o=e.getUniformLocation(a,"uColor");if(!o)return Mr&&console.log("error getting 'uColor' uniform location"),!1;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,uFe,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var u=e.createTexture(),l=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,l);var c=e.createTexture();e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var d=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,c,0);var f=e.checkFramebufferStatus(e.FRAMEBUFFER);if(f!==e.FRAMEBUFFER_COMPLETE)return Mr&&console.log("error creating framebuffer for '"+t+"'"),!1;e.bindTexture(e.TEXTURE_2D,u),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,c),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);var h=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,h),h[0]!==0||h[1]<248||h[2]<248||h[3]<254)return Mr&&console.log("not able to actually render to '"+t+"' texture"),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);var v=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,v);var p=e.getError();if(p)return Mr&&console.log("error reading float pixels: '"+uQ(e,p)+"'"),!1}return!0}var vQ=zi();function lFe(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(Er(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error("unknown texture kind '"+t+"'")}function mQ(e,t,r){switch(t){case"alpha":return Er(e)&&r==="float"?e.RED:Er(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return Er(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rgba":return Er(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function cFe(e,t,r){if(Er(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return mQ(e,t,r)}function dFe(e,t,r,n,a){var i=fFe(e)*hFe(t);return i*r*n*(a||1)}function fFe(e){switch(e){case"alpha":return 1;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function hFe(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function pFe(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(Er(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function LU(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function tx(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function vFe(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function mFe(e,t,r){return t===r.TEXTURE_2D}function gFe(e,t,r){return t===r.TEXTURE_3D}function NU(e){var t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function $M(e,t,r,n,a,i){var o=vQ(),s=NU(e);if(r.endsWith("float32")&&a!=="float"||r.endsWith("float16")&&a!=="fp16"||r.endsWith("uint8")&&a!=="ubyte"||r.endsWith("int32")&&a!=="int"||r.endsWith("depth")&&a!=="ushort"&&a!=="float")throw new Error("texture kind '"+r+"' and type '"+a+"' are incompatible");var u=lFe(e,r),l=LU(e,i),c=mQ(e,n,a),d=cFe(e,n,a),f=pFe(e,t,a);function h(){e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MAG_FILTER,l),e.texParameteri(u,e.TEXTURE_MIN_FILTER,l),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(u,null)}h();var v=0,p=0,g=0,m,y=!1;function b(C,w,A){if(!(v===C&&p===w&&g===(A||0)))if(v=C,p=w,g=A||0,e.bindTexture(u,s),u===e.TEXTURE_2D)e.texImage2D(u,0,d,v,p,0,c,f,null);else if(Er(e)&&u===e.TEXTURE_3D&&g!==void 0)e.texImage3D(u,0,d,v,p,g,0,c,f,null);else throw new Error("unknown texture target")}function S(C,w){if(w===void 0&&(w=!1),e.bindTexture(u,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),vFe(C))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,d,c,f,C);else if(mFe(C,u,e)){var A=C.filter?LU(e,C.filter):l;e.texParameteri(u,e.TEXTURE_MAG_FILTER,A),e.texParameteri(u,e.TEXTURE_MIN_FILTER,A),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!C.flipY),w?e.texSubImage2D(u,0,0,0,C.width,C.height,c,f,C.array):(v=C.width,p=C.height,e.texImage2D(u,0,d,v,p,0,c,f,C.array))}else if(Er(e)&&gFe(C,u,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),w?e.texSubImage3D(u,0,0,0,0,C.width,C.height,C.depth,c,f,C.array):(v=C.width,p=C.height,g=C.depth,e.texImage3D(u,0,d,v,p,g,0,c,f,C.array));else throw new Error("unknown texture target");e.bindTexture(u,null),m=C}function x(C,w,A){if(C.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,tx(e,t,w),e.TEXTURE_2D,s,0);else if(Er(e)&&u===e.TEXTURE_3D){if(A===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,tx(e,t,w),s,0,A)}else throw new Error("unknown/unsupported texture target")}return{id:o,target:u,format:c,internalFormat:d,type:f,filter:l,getWidth:function(){return v},getHeight:function(){return p},getDepth:function(){return g},getByteCount:function(){return dFe(n,a,v,p,g)},define:b,load:S,bind:function(C){e.activeTexture(e.TEXTURE0+C),e.bindTexture(u,s)},unbind:function(C){e.activeTexture(e.TEXTURE0+C),e.bindTexture(u,null)},attachFramebuffer:x,detachFramebuffer:function(C,w){if(C.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,tx(e,t,w),e.TEXTURE_2D,null,0);else if(Er(e)&&u===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,tx(e,t,w),null,0,0);else throw new Error("unknown texture target")},reset:function(){s=NU(e),h();var C=[v,p,g],w=C[0],A=C[1],I=C[2];v=0,p=0,g=0,b(w,A,I),m&&S(m)},destroy:function(){y||(e.deleteTexture(s),y=!0)}}}function yFe(e,t,r){var n=e.resources,a=[];return Object.keys(t).forEach(function(i){var o=t[i];if(o.type==="texture"){var s=r[i];if(s)if(o.kind==="texture")a[a.length]=[i,s.ref.value];else{var u=n.texture(o.kind,o.format,o.dataType,o.filter);u.load(s.ref.value),a[a.length]=[i,u]}}}),a}function FU(e,t,r){var n=new Image;n.onload=function(){r.load(n),N.update(t,r)},n.src=e}function D3(e){var t,r=(t=e==null?void 0:e.TEXTURE_2D)!==null&&t!==void 0?t:3553;return{id:vQ(),target:r,format:0,internalFormat:0,type:0,filter:0,getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getByteCount:function(){return 0},define:function(){},load:function(){},bind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:function(){},detachFramebuffer:function(){},reset:function(){},destroy:function(){}}}function cs(e,t,r,n){var a=bFe(e,t,r,n);return r.palette?(N.updateIfChanged(a.dUsePalette,!0),xFe(r.palette,a.tPalette)):N.updateIfChanged(a.dUsePalette,!1),a}function bFe(e,t,r,n){switch(oi.getGranularity(e,r.granularity)){case"uniform":return CFe(e,r.color,n);case"instance":return _Fe(e,r.color,n);case"group":return wFe(e,r.color,n);case"groupInstance":return EFe(e,r.color,n);case"vertex":return AFe(t,r.color,n);case"vertexInstance":return PFe(t,r.color,n);case"volume":return BU(r.grid,"volume",n);case"volumeInstance":return BU(r.grid,"volumeInstance",n)}}function xFe(e,t){var r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else for(var a=n.array,i=0,o=0,s=e.colors;o<s.length;o++){var u=s[o],l=dt.toRgb(u),c=l[0],d=l[1],f=l[2];if(a[i++]!==c||a[i++]!==d||a[i++]!==f){r=!1;break}}if(!r){for(var h=new Uint8Array(e.colors.length*3),v=0,p=0,g=e.colors;p<g.length;p++){var u=g[p],m=dt.toRgb(u),c=m[0],d=m[1],f=m[2];h[v++]=c,h[v++]=d,h[v++]=f}N.update(t,{array:h,height:1,width:e.colors.length,filter:e.filter})}}function SFe(e,t){return t?(N.update(t.uColor,dt.toVec3Normalized(t.uColor.ref.value,e)),N.updateIfChanged(t.dColorType,"uniform"),t):{uColor:N.create(dt.toVec3Normalized(_(),e)),tColor:N.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:N.create(D3()),tPalette:N.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:N.create(Ke.create(1,1)),uColorGridDim:N.create(_.create(1,1,1)),uColorGridTransform:N.create(wr.create(0,0,0,1)),dColorType:N.create("uniform"),dUsePalette:N.create(!1)}}function CFe(e,t,r){return SFe(t(ns,!1),r)}function Nb(e,t,r){return r?(N.update(r.tColor,e),N.update(r.uColorTexDim,Ke.create(e.width,e.height)),N.updateIfChanged(r.dColorType,t),r):{uColor:N.create(_()),tColor:N.create(e),tColorGrid:N.create(D3()),tPalette:N.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:N.create(Ke.create(e.width,e.height)),uColorGridDim:N.create(_.create(1,1,1)),uColorGridTransform:N.create(wr.create(0,0,0,1)),dColorType:N.create(t),dUsePalette:N.create(!1)}}function _Fe(e,t,r){var n=e.instanceCount,a=bi(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var i=e.move(),o=i.location,s=i.isSecondary,u=i.instanceIndex;dt.toArray(t(o,s),a.array,u*3),e.skipInstance()}return Nb(a,"instance",r)}function wFe(e,t,r){var n=e.groupCount,a=bi(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move(),o=i.location,s=i.isSecondary,u=i.groupIndex;dt.toArray(t(o,s),a.array,u*3)}return Nb(a,"group",r)}function EFe(e,t,r){var n=e.groupCount,a=e.instanceCount,i=a*n,o=bi(Math.max(1,i),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var s=e.move(),u=s.location,l=s.isSecondary,c=s.index;dt.toArray(t(u,l),o.array,c*3)}return Nb(o,"groupInstance",r)}function AFe(e,t,r){var n=e.groupCount,a=e.stride,i=bi(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;)for(var o=e.move(),s=o.location,u=o.isSecondary,l=o.groupIndex,c=t(s,u),d=0;d<a;++d)dt.toArray(c,i.array,(l+d)*3);return Nb(i,"vertex",r)}function PFe(e,t,r){var n=e.groupCount,a=e.instanceCount,i=e.stride,o=a*n,s=bi(Math.max(1,o),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;)for(var u=e.move(),l=u.location,c=u.isSecondary,d=u.index,f=t(l,c),h=0;h<i;++h)dt.toArray(f,s.array,(d+h)*3);return Nb(s,"vertexInstance",r)}function BU(e,t,r){var n=e.colors,a=e.dimension,i=e.transform,o=n.getWidth(),s=n.getHeight();return r?(N.update(r.tColorGrid,n),N.update(r.uColorTexDim,Ke.create(o,s)),N.update(r.uColorGridDim,_.clone(a)),N.update(r.uColorGridTransform,wr.clone(i)),N.updateIfChanged(r.dColorType,t),r):{uColor:N.create(_()),tColor:N.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:N.create(n),tPalette:N.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:N.create(Ke.create(o,s)),uColorGridDim:N.create(_.clone(a)),uColorGridTransform:N.create(wr.clone(i)),dColorType:N.create(t),dUsePalette:N.create(!1)}}var Ft;(function(e){function t(b,S,x,C,w,A,I){return I?i(b,S,x,C,w,A,I):a(b,S,x,C,w,A)}e.create=t;function r(b){var S=b?b.vertexBuffer.ref.value:new Float32Array(0),x=b?b.indexBuffer.ref.value:new Uint32Array(0),C=b?b.normalBuffer.ref.value:new Float32Array(0),w=b?b.groupBuffer.ref.value:new Float32Array(0);return t(S,x,C,w,0,0,b)}e.createEmpty=r;function n(b){return Ui([b.vertexCount,b.triangleCount,b.vertexBuffer.ref.version,b.indexBuffer.ref.version,b.normalBuffer.ref.version,b.groupBuffer.ref.version])}function a(b,S,x,C,w,A){var I=je(),D,k=-1,R=-1,L={kind:"mesh",vertexCount:w,triangleCount:A,vertexBuffer:N.create(b),indexBuffer:N.create(S),normalBuffer:N.create(x),groupBuffer:N.create(C),get boundingSphere(){var H=n(L);if(H!==k){var B=nh(L.vertexBuffer.ref.value,L.vertexCount,1);je.copy(I,B),k=H}return I},get groupMapping(){return L.groupBuffer.ref.version!==R&&(D=t0(L.groupBuffer.ref.value,L.vertexCount),R=L.groupBuffer.ref.version),D},setBoundingSphere:function(H){je.copy(I,H),k=n(L)},meta:{}};return L}function i(b,S,x,C,w,A,I){return I.vertexCount=w,I.triangleCount=A,N.update(I.vertexBuffer,b),N.update(I.indexBuffer,S),N.update(I.normalBuffer,x),N.update(I.groupBuffer,C),I}function o(b){var S=b.vertexCount,x=b.triangleCount,C=b.vertexBuffer.ref.value,w=b.indexBuffer.ref.value,A=b.normalBuffer.ref.value.length>=S*3?b.normalBuffer.ref.value:new Float32Array(S*3);A===b.normalBuffer.ref.value&&A.fill(0,0,S*3),qK(C,w,A,S,x),N.update(b.normalBuffer,A)}e.computeNormals=o;function s(b,S){S===void 0&&(S=3);for(var x=b.vertexBuffer.ref.value,C=new Map,w=function(H,B){return H[0].toFixed(B)+"|"+H[1].toFixed(B)+"|"+H[2].toFixed(B)},A=0,I=_(),D=0,k=b.vertexCount;D<k;++D){_.fromArray(I,x,D*3);var R=w(I,S),L=C.get(R);L!==void 0?(A+=1,C.set(R,L+1)):C.set(R,1)}return A}e.checkForDuplicateVertices=s;var u=qn();function l(b,S){var x=b.vertexBuffer.ref.value;if(Kp(S,x,0,b.vertexCount),!le.isTranslationAndUniformScaling(S)){var C=qn.directionTransform(u,S);Uke(C,b.normalBuffer.ref.value,0,b.vertexCount)}N.update(b.vertexBuffer,x)}e.transform=l;function c(b){var S=("kind"in b?b.meta:b.meta.ref.value).originalData;return S}e.getOriginalData=c;function d(b,S){S===void 0&&(S=!0);var x=b.indexBuffer,C=b.vertexBuffer,w=b.groupBuffer,A=b.normalBuffer,I=b.triangleCount,D=b.vertexCount,k=x.ref.value,R=C.ref.value,L=w.ref.value,H=A.ref.value,B=Je.create(Uint32Array,3,1024,I),j=Je.create(Float32Array,3,1024,R);j.currentIndex=D*3,j.elementCount=D;var Q=Je.create(Float32Array,3,1024,H);Q.currentIndex=D*3,Q.elementCount=D;var G=Je.create(Float32Array,1,1024,L);G.currentIndex=D,G.elementCount=D;var W=_(),q=_(),J=_(),he=_(),$=_(),X=_();function U(Ze){_.fromArray(W,R,Ze*3),_.fromArray(he,H,Ze*3),Je.add3(j,W[0],W[1],W[2]),Je.add3(Q,he[0],he[1],he[2])}function z(Ze,ht){_.fromArray(W,R,Ze*3),_.fromArray(q,R,ht*3),_.scale(W,_.add(W,W,q),.5),_.fromArray(he,H,Ze*3),_.fromArray($,H,ht*3),_.scale(he,_.add(he,he,$),.5),Je.add3(j,W[0],W[1],W[2]),Je.add3(Q,he[0],he[1],he[2])}function ee(Ze,ht,Ue){_.fromArray(W,R,Ze*3),_.fromArray(q,R,ht*3),_.fromArray(J,R,Ue*3),_.scale(W,_.add(W,_.add(W,W,q),J),1/3),_.fromArray(he,H,Ze*3),_.fromArray($,H,ht*3),_.fromArray(X,H,Ue*3),_.scale(he,_.add(he,_.add(he,he,$),X),1/3),Je.add3(j,W[0],W[1],W[2]),Je.add3(Q,he[0],he[1],he[2])}function Y(Ze,ht,Ue,rt,ut){++te,U(Ze),z(Ze,ht),z(Ze,Ue),Je.add3(B,Z,Z+1,Z+2);for(var Ee=0;Ee<3;++Ee)Je.add(G,rt);Z+=3,te+=2,U(ht),U(Ue),z(Ze,ht),z(Ze,Ue),Je.add3(B,Z,Z+1,Z+3),Je.add3(B,Z,Z+3,Z+2);for(var Ee=0;Ee<4;++Ee)Je.add(G,ut);Z+=4}var Z=D,te=0;if(S)for(var ce=0,be=I;ce<be;++ce){var xe=k[ce*3],Ie=k[ce*3+1],_e=k[ce*3+2],ae=L[xe],ie=L[Ie],O=L[_e];if(ae===ie&&ae===O)++te,Je.add3(B,xe,Ie,_e);else if(ae===ie)Y(_e,xe,Ie,O,ae);else if(ae===O)Y(Ie,_e,xe,ie,O);else if(ie===O)Y(xe,Ie,_e,ae,ie);else{te+=2,U(xe),z(xe,Ie),z(xe,_e),ee(xe,Ie,_e),Je.add3(B,Z,Z+1,Z+3),Je.add3(B,Z,Z+3,Z+2);for(var V=0;V<4;++V)Je.add(G,ae);Z+=4,te+=2,U(Ie),z(Ie,_e),z(Ie,xe),ee(xe,Ie,_e),Je.add3(B,Z,Z+1,Z+3),Je.add3(B,Z,Z+3,Z+2);for(var V=0;V<4;++V)Je.add(G,ie);Z+=4,te+=2,U(_e),z(_e,Ie),z(_e,xe),ee(xe,Ie,_e),Je.add3(B,Z+3,Z+1,Z),Je.add3(B,Z+2,Z+3,Z);for(var V=0;V<4;++V)Je.add(G,O);Z+=4}}else for(var ce=0,be=I;ce<be;++ce){var xe=k[ce*3],Ie=k[ce*3+1],_e=k[ce*3+2],ae=L[xe],ie=L[Ie],O=L[_e];if(ae!==ie||ae!==O){++te,U(xe),U(Ie),U(_e),Je.add3(B,Z,Z+1,Z+2);for(var ve=ie===O?ie:ae,V=0;V<3;++V)Je.add(G,ve);Z+=3}else++te,Je.add3(B,xe,Ie,_e)}var Pe=Je.compact(B),Me=Je.compact(j),Ge=Je.compact(Q),$e=Je.compact(G);return b.vertexCount=Z,b.triangleCount=te,N.update(C,Me),N.update(w,$e),N.update(x,Pe),N.update(A,Ge),b.meta.originalData={indexBuffer:k,vertexCount:D,triangleCount:I},b}e.uniformTriangleGroup=d,e.Params=E(E({},At.Params),{doubleSided:T.Boolean(!1,At.CustomQualityParamInfo),flipSided:T.Boolean(!1,At.ShadingCategory),flatShaded:T.Boolean(!1,At.ShadingCategory),ignoreLight:T.Boolean(!1,At.ShadingCategory),xrayShaded:T.Boolean(!1,At.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:h,createValuesSimple:v,updateValues:p,updateBoundingSphere:g,createRenderableState:m,updateRenderableState:y,createPositionIterator:f};function f(b,S){var x=b.vertexCount,C=S.instanceCount.ref.value,w=pv(),A=w.position,I=b.vertexBuffer.ref.value,D=S.aTransform.ref.value,k=function(R,L){return L<0?_.fromArray(A,I,R*3):_.transformMat4Offset(A,I,D,0,R*3,L*16),w};return bn(x,C,1,k)}function h(b,S,x,C,w){var A=x.instanceCount,I=x.groupCount,D=f(b,S),k=cs(x,D,C.color),R=Js(A*I),L=pd(),H=vd(),B=md(),j={drawCount:b.triangleCount*3,vertexCount:b.vertexCount,groupCount:I,instanceCount:A},Q=je.clone(b.boundingSphere),G=Xa(Q,S.aTransform.ref.value,A);return E(E(E(E(E(E(E(E({aPosition:b.vertexBuffer,aNormal:b.normalBuffer,aGroup:b.groupBuffer,elements:b.indexBuffer,boundingSphere:N.create(G),invariantBoundingSphere:N.create(Q),uInvariantBoundingSphere:N.create(wr.ofSphere(Q))},k),R),L),H),B),S),At.createValues(w,j)),{dDoubleSided:N.create(w.doubleSided),dFlatShaded:N.create(w.flatShaded),dFlipSided:N.create(w.flipSided),dIgnoreLight:N.create(w.ignoreLight),dXrayShaded:N.create(w.xrayShaded),meta:N.create(b.meta)})}function v(b,S,x,C,w){var A=At.createSimple(x,C,w),I=E(E({},T.getDefaultValues(e.Params)),S);return h(b,A.transform,A.locationIterator,A.theme,I)}function p(b,S){At.updateValues(b,S),N.updateIfChanged(b.dDoubleSided,S.doubleSided),N.updateIfChanged(b.dFlatShaded,S.flatShaded),N.updateIfChanged(b.dFlipSided,S.flipSided),N.updateIfChanged(b.dIgnoreLight,S.ignoreLight),N.updateIfChanged(b.dXrayShaded,S.xrayShaded)}function g(b,S){var x=je.clone(S.boundingSphere),C=Xa(x,b.aTransform.ref.value,b.instanceCount.ref.value);je.equals(C,b.boundingSphere.ref.value)||N.update(b.boundingSphere,C),je.equals(x,b.invariantBoundingSphere.ref.value)||(N.update(b.invariantBoundingSphere,x),N.update(b.uInvariantBoundingSphere,wr.fromSphere(b.uInvariantBoundingSphere.ref.value,x)))}function m(b){var S=At.createRenderableState(b);return y(S,b),S}function y(b,S){At.updateRenderableState(b,S),b.opaque=b.opaque&&!S.xrayShaded,b.writeDepth=b.opaque}})(Ft||(Ft={}));var TFe={radius:1,detail:0};function IFe(e,t,r){var n=E(E({},TFe),r),a=n.radius,i=n.detail,o=MFe(),s=o.vertices,u=o.indices;c(i),jke(s,a);var l=new Float32Array(s.length);return qK(s,u,l,s.length/3,u.length/3),{vertices:new Float32Array(s),normals:new Float32Array(l),indices:new Uint32Array(u)};function c(f){for(var h=_(),v=_(),p=_(),g=0;g<t.length;g+=3)_.fromArray(h,e,t[g+0]*3),_.fromArray(v,e,t[g+1]*3),_.fromArray(p,e,t[g+2]*3),d(h,v,p,f)}function d(f,h,v,p){for(var g=Math.pow(2,p),m=[],y=0;y<=g;++y){m[y]=[];var b=_();_.lerp(b,f,v,y/g);var S=_();_.lerp(S,h,v,y/g);for(var x=g-y,C=0;C<=x;++C)if(C===0&&y===g)m[y][C]=b;else{var w=_();_.lerp(w,b,S,C/x),m[y][C]=w}}for(var y=0;y<g;++y)for(var C=0;C<2*(g-y)-1;++C){var A=Math.floor(C/2);C%2===0?o.add(m[y][A+1],m[y+1][A],m[y][A]):o.add(m[y][A+1],m[y+1][A+1],m[y+1][A])}}}function MFe(){var e=[],t=[],r=new Map;function n(a){var i=a[0].toFixed(5)+"|"+a[1].toFixed(5)+"|"+a[2].toFixed(5),o=r.get(i);return o===void 0&&(o=e.length/3,r.set(i,o),e.push.apply(e,a)),o}return{vertices:e,indices:t,add:function(a,i,o){t.push(n(a),n(i),n(o))}}}var ms=(1+Math.sqrt(5))/2,DFe=[-1,ms,0,1,ms,0,-1,-ms,0,1,-ms,0,0,-1,ms,0,1,ms,0,-1,-ms,0,1,-ms,ms,0,-1,ms,0,1,-ms,0,-1,-ms,0,1],RFe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],kP;function kFe(){return kP||(kP=M3(DFe,RFe)),kP}var gQ=kFe(),OFe=gQ.vertices,LFe=gQ.indices;function R3(e){return 10*Math.pow(Math.pow(2,e),2)+2}function NFe(e){return IFe(OFe,LFe,{detail:e,radius:1})}var UU=new Map,FFe=le.identity();function BFe(e,t,r){return le.scaleUniformly(e,le.fromTranslation(e,t),r)}function yQ(e){var t=UU.get(e);return t===void 0&&(t=NFe(e),UU.set(e,t)),t}function Na(e,t,r,n){Et.addPrimitive(e,BFe(FFe,t,r),yQ(n))}var il={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function UFe(e){var t=E(E({},il),e),r=t.radiusTop,n=t.radiusBottom,a=t.height,i=t.radialSegments,o=t.heightSegments,s=t.topCap,u=t.bottomCap,l=t.thetaStart,c=t.thetaLength,d=[],f=[],h=[],v=0,p=[],g=a/2;return m(),s&&r>0&&y(!0),u&&n>0&&y(!1),{vertices:new Float32Array(f),normals:new Float32Array(h),indices:new Uint32Array(d)};function m(){for(var b=_.zero(),S=(n-r)/a,x=0;x<=o;++x){for(var C=[],w=x/o,A=w*(n-r)+r,I=0;I<=i;++I){var D=I/i,k=D*c+l,R=Math.sin(k),L=Math.cos(k);f.push(A*R,-w*a+g,A*L),_.normalize(b,_.set(b,R,S,L)),h.push.apply(h,b),C.push(v++)}p.push(C)}for(var I=0;I<i;++I)for(var x=0;x<o;++x){var H=p[x][I],B=p[x+1][I],j=p[x+1][I+1],Q=p[x][I+1];d.push(H,B,Q),d.push(B,j,Q)}}function y(b){for(var S=b===!0?r:n,x=b===!0?1:-1,C=v,w=1;w<=i;++w)f.push(0,g*x,0),h.push(0,x,0),++v;for(var A=v,w=0;w<=i;++w){var I=w/i,D=I*c+l,k=Math.cos(D),R=Math.sin(D);f.push(S*R,g*x,S*k),h.push(0,x,0),++v}for(var w=0;w<i;++w){var L=C+w,H=A+w;b===!0?d.push(H,H+1,L):d.push(H+1,H,L)}}}var jU=_(),zU=_(),co=_(),fo=_(),Ju=_(),qv=_(),jFe={height:1,topCap:!0,bottomCap:!0};function n0(e,t){var r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");var n=E(E({},jFe),t),a=n.height,i=n.topCap,o=n.bottomCap,s=r*2,u=r*4,l=(i?1:0)+(o?1:0);r===3?(s+=l,u+=l*3):r===4?(s+=l*2,u+=l*4):(s+=l*r,u+=l*r*3);var c=r0(s,u),d=a*.5;_.set(jU,0,0,-d),_.set(zU,0,0,d);for(var f=0;f<r;++f){var h=(f+1)%r;_.set(co,e[f*3],e[f*3+1],-d),_.set(fo,e[h*3],e[h*3+1],-d),_.set(Ju,e[h*3],e[h*3+1],d),_.set(qv,e[f*3],e[f*3+1],d),c.addQuad(co,fo,Ju,qv)}if(r===3)i&&(_.set(co,e[0],e[1],-d),_.set(fo,e[3],e[4],-d),_.set(Ju,e[6],e[7],-d),c.add(Ju,fo,co)),o&&(_.set(co,e[0],e[1],d),_.set(fo,e[3],e[4],d),_.set(Ju,e[6],e[7],d),c.add(co,fo,Ju));else if(r===4)i&&(_.set(co,e[0],e[1],-d),_.set(fo,e[3],e[4],-d),_.set(Ju,e[6],e[7],-d),_.set(qv,e[9],e[10],-d),c.addQuad(qv,Ju,fo,co)),o&&(_.set(co,e[0],e[1],d),_.set(fo,e[3],e[4],d),_.set(Ju,e[6],e[7],d),_.set(qv,e[9],e[10],d),c.addQuad(co,fo,Ju,qv));else for(var f=0;f<r;++f){var h=(f+1)%r;i&&(_.set(co,e[f*3],e[f*3+1],-d),_.set(fo,e[h*3],e[h*3+1],-d),c.add(jU,fo,co)),o&&(_.set(co,e[f*3],e[f*3+1],d),_.set(fo,e[h*3],e[h*3+1],d),c.add(co,fo,zU))}return c.getPrimitive()}var OP;function zFe(){return OP||(OP=n0(Bl(4,!1))),OP}var LP;function VFe(){return LP||(LP=n0(Bl(5,!1))),LP}var NP;function HFe(){return NP||(NP=n0(Bl(6,!1))),NP}var FP;function GFe(){return FP||(FP=n0(Bl(6,!0))),FP}var BP;function qFe(){return BP||(BP=n0(Bl(7,!1))),BP}var VU=new Map,HU=_.create(0,1,0),ml=_(),rx=_(),GU=_(),Af=le(),qU=le(),WFe=_(),WU=le(),Tm=_(),UP=_();function d_(e,t,r,n,a){return _.setMagnitude(rx,r,n/2),_.add(GU,t,rx),a?_.matchDirection(UP,HU,rx):_.copy(UP,HU),le.fromScaling(WU,_.set(WFe,1,n,1)),_.makeRotation(qU,UP,rx),le.mul(e,qU,WU),le.setTranslation(e,GU)}var el=new Int32Array(9);function $Fe(e){var t,r,n,a,i,o,s,u,l;return el[0]=Math.round(1e3*((t=e.radiusTop)!==null&&t!==void 0?t:il.radiusTop)),el[1]=Math.round(1e3*((r=e.radiusBottom)!==null&&r!==void 0?r:il.radiusBottom)),el[2]=Math.round(1e3*((n=e.height)!==null&&n!==void 0?n:il.height)),el[3]=(a=e.radialSegments)!==null&&a!==void 0?a:il.radialSegments,el[4]=(i=e.heightSegments)!==null&&i!==void 0?i:il.heightSegments,el[5]=((o=e.topCap)!==null&&o!==void 0?o:il.topCap)?1:0,el[6]=((s=e.bottomCap)!==null&&s!==void 0?s:il.bottomCap)?1:0,el[7]=Math.round(1e3*((u=e.thetaStart)!==null&&u!==void 0?u:il.thetaStart)),el[8]=Math.round(1e3*((l=e.thetaLength)!==null&&l!==void 0?l:il.thetaLength)),Ui(el)}function tO(e){var t=$Fe(e),r=VU.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){var n=Math.max(3,e.radialSegments),a=n0(Bl(n,!0,e.radiusTop),e);r=Qk(a,le.rotX90)}else r=UFe(e);VU.set(t,r)}return r}function Oi(e,t,r,n,a){var i=_.distance(t,r)*n;_.sub(ml,r,t),d_(Af,t,ml,i,!0),Et.addPrimitive(e,Af,tO(a))}function XFe(e,t,r,n,a,i){var o=_.distance(t,r)*n,s=tO(i);_.sub(ml,r,t),_.add(Tm,t,a),d_(Af,Tm,ml,o,!0),Et.addPrimitive(e,Af,s),_.sub(Tm,t,a),d_(Af,Tm,ml,o,!0),Et.addPrimitive(e,Af,s)}function e1(e,t,r,n,a,i){var o=Math.floor(a/2),s=1/a;if(n<1){var u=n/2/a;n+=a%2===1?u:-u}var l=_.distance(t,r)*n,c=tO(i);_.sub(ml,r,t);for(var d=0;d<o;++d){var f=s*(d*2+1);_.setMagnitude(ml,ml,l*f),_.add(Tm,t,ml),d_(Af,Tm,ml,l*s,!1),Et.addPrimitive(e,Af,c)}}var Zn=_(),$U=qn(),Ql=_(),tl=_(),Ah=_(),nx=_(),No=_.fromArray,YFe=_.triangleNormal,XU=_.copy,ax=_.transformMat4,YU=_.transformMat3,KU=qn.directionTransform,iu=Je.add3,jP=Je.add,Et;(function(e){function t(c,d,f){return c===void 0&&(c=2048),d===void 0&&(d=1024),{currentGroup:-1,vertices:Je.create(Float32Array,3,d,f?f.vertexBuffer.ref.value:c),normals:Je.create(Float32Array,3,d,f?f.normalBuffer.ref.value:c),indices:Je.create(Uint32Array,3,d*3,f?f.indexBuffer.ref.value:c*3),groups:Je.create(Float32Array,1,d,f?f.groupBuffer.ref.value:c),mesh:f}}e.createState=t;function r(c,d,f,h){var v=c.vertices,p=c.normals,g=c.indices,m=c.groups,y=c.currentGroup,b=v.elementCount;iu(v,d[0],d[1],d[2]),iu(v,f[0],f[1],f[2]),iu(v,h[0],h[1],h[2]),YFe(Zn,d,f,h);for(var S=0;S<3;++S)iu(p,Zn[0],Zn[1],Zn[2]),jP(m,y);iu(g,b,b+1,b+2)}e.addTriangle=r;function n(c,d,f){No(Ah,d,f[0]*3),No(nx,d,f[1]*3);for(var h=2,v=f.length;h<v;h+=2)XU(Ql,Ah),XU(tl,nx),No(Ah,d,f[h]*3),No(nx,d,f[h+1]*3),r(c,Ql,tl,Ah),r(c,tl,nx,Ah)}e.addTriangleStrip=n;function a(c,d,f){No(Ql,d,f[0]*3);for(var h=2,v=f.length;h<v;++h)No(tl,d,f[h-1]*3),No(Ah,d,f[h]*3),r(c,Ql,Ah,tl)}e.addTriangleFan=a;function i(c,d,f){for(var h=f.vertices,v=f.normals,p=f.indices,g=c.vertices,m=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,x=g.elementCount,C=KU($U,d),w=0,A=h.length;w<A;w+=3)ax(Zn,No(Zn,h,w),d),iu(g,Zn[0],Zn[1],Zn[2]),YU(Zn,No(Zn,v,w),C),iu(m,Zn[0],Zn[1],Zn[2]),jP(b,S);for(var w=0,A=p.length;w<A;w+=3)iu(y,p[w]+x,p[w+1]+x,p[w+2]+x)}e.addPrimitive=i;function o(c,d,f){for(var h=f.vertices,v=f.normals,p=f.indices,g=c.vertices,m=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,x=g.elementCount,C=KU($U,d),w=0,A=h.length;w<A;w+=3)ax(Zn,No(Zn,h,w),d),iu(g,Zn[0],Zn[1],Zn[2]),YU(Zn,No(Zn,v,w),C),iu(m,-Zn[0],-Zn[1],-Zn[2]),jP(b,S);for(var w=0,A=p.length;w<A;w+=3)iu(y,p[w+2]+x,p[w+1]+x,p[w]+x)}e.addPrimitiveFlipped=o;function s(c,d,f,h,v,p){for(var g=f.vertices,m=f.edges,y={radiusTop:h,radiusBottom:h,radialSegments:p},b=0,S=m.length;b<S;b+=2)No(Ql,g,m[b]*3),No(tl,g,m[b+1]*3),ax(Ql,Ql,d),ax(tl,tl,d),Na(c,Ql,h,v),Na(c,tl,h,v),Oi(c,Ql,tl,1,y)}e.addCage=s;function u(c,d,f){i(c,d,{vertices:f.vertexBuffer.ref.value.subarray(0,f.vertexCount*3),normals:f.normalBuffer.ref.value.subarray(0,f.vertexCount*3),indices:f.indexBuffer.ref.value.subarray(0,f.triangleCount*3)})}e.addMesh=u;function l(c){var d=c.vertices,f=c.normals,h=c.indices,v=c.groups,p=c.mesh,g=Je.compact(d,!0),m=Je.compact(h,!0),y=Je.compact(f,!0),b=Je.compact(v,!0);return Ft.create(g,m,y,b,c.vertices.elementCount,c.indices.elementCount,p)}e.getMesh=l})(Et||(Et={}));var KFe=1,QFe="Assigns sizes as defined by the shape object.",bQ={};function ZFe(e){return bQ}function rO(e,t){return{factory:rO,granularity:"groupInstance",size:function(r){return Ki.isLocation(r)?r.shape.getSize(r.group,r.instance):KFe},props:t,description:QFe}}var JFe={name:"shape-group",label:"Shape Group",category:"",factory:rO,getParams:ZFe,defaultValues:T.getDefaultValues(bQ),isApplicable:function(e){return!!e.shape}},e6e=dt(13421772),t6e="Assigns colors as defined by the shape object.",xQ={};function r6e(e){return xQ}function nO(e,t){return{factory:nO,granularity:"groupInstance",color:function(r){return Ki.isLocation(r)?r.shape.getColor(r.group,r.instance):e6e},props:t,description:t6e}}var n6e={name:"shape-group",label:"Shape Group",category:"Miscellaneous",factory:nO,getParams:r6e,defaultValues:T.getDefaultValues(xQ),isApplicable:function(e){return!!e.shape}},SQ=zi();function Sd(e,t,r){return{id:SQ(),materialId:e.materialId,values:t,state:r,render:function(n,a){t.uAlpha&&t.alpha&&N.updateIfChanged(t.uAlpha,ki(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(n,a)},getProgram:function(n){return e.getProgram(n)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}function Qa(e,t){return{id:SQ(),values:t,render:function(){return e.render("compute")},update:function(){return e.update()},dispose:function(){return e.destroy()}}}var a6e=zi();function i6e(e,t){var r=e.gl;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var o6e={colorBlended:"",colorWboit:"",pickObject:"",pickInstance:"",pickGroup:"",depth:""},s6e=Object.keys(o6e),u6e={compute:""},l6e=Object.keys(u6e);function QU(e,t,r,n,a){return r=E(E({},r),{dRenderVariant:N.create(t)}),a.dRenderVariant===void 0&&Object.defineProperty(a,"dRenderVariant",{value:Qt("string")}),e.resources.program(r,n,a)}function c6e(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function d6e(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function Cd(e,t,r,n,a,i){return CQ(e,t,r,n,a,i,s6e)}function Za(e,t,r,n,a,i){return i===void 0&&(i=-1),CQ(e,t,r,n,a,i,l6e)}function CQ(e,t,r,n,a,i,o){var s=a6e(),u=e.stats,l=e.state,c=e.resources,d=e.extensions,f=d.instancedArrays,h=d.vertexArrayObject;if(a.uVertexCount){var v=a.uVertexCount.ref.value;a.aVertex=N.create(Ws(new Float32Array(v))),n.aVertex=Hr("float32",1,0)}for(var p=wOe(n,a),g=p.attributeValues,m=p.defineValues,y=p.textureValues,b=p.uniformValues,S=p.materialUniformValues,x=p.bufferedUniformValues,C=Object.entries(b),w=Object.entries(S),A=Object.entries(x),I=Object.entries(uNe(x)),D=Object.entries(m),k=EOe(a),R=i6e(e,t),L={},H=0,B=o;H<B.length;H++){var j=B[H];L[j]=QU(e,j,m,r,n)}var Q=yFe(e,n,y),G=vNe(e,n,g),W,q=a.elements;q&&q.ref.value&&(W=c.elements(q.ref.value));for(var J={},he=0,$=o;he<$.length;he++){var j=$[he];J[j]=h?c.vertexArray(L[j],G,W):null}var X=a.drawCount.ref.value,U=a.instanceCount.ref.value;u.drawCount+=X,u.instanceCount+=U,u.instancedDrawCount+=U*X;var z=c6e(),ee=!1,Y=-1;return{id:s,materialId:i,getProgram:function(Z){return L[Z]},render:function(Z,te){if(!(X===0||U===0||e.isContextLost)){var ce=L[Z];if(ce.id===Y&&l.currentRenderItemId===s)ce.setUniforms(C),te&&te.length>0?(ce.bindTextures(te,0),ce.bindTextures(Q,te.length)):ce.bindTextures(Q,0);else{var be=J[Z];(ce.id!==l.currentProgramId||ce.id!==Y||i===-1||i!==l.currentMaterialId)&&(ce.id!==l.currentProgramId&&ce.use(),ce.setUniforms(w),l.currentMaterialId=i,Y=ce.id),ce.setUniforms(C),ce.setUniforms(I),te&&te.length>0?(ce.bindTextures(te,0),ce.bindTextures(Q,te.length)):ce.bindTextures(Q,0),be?(be.bind(),W&&W.bind()):(W&&W.bind(),ce.bindAttributes(G)),l.currentRenderItemId=s}if(Mr)try{eO(e.gl)}catch(xe){throw new Error("Framebuffer error rendering item id "+s+": '"+xe+"'")}if(W?f.drawElementsInstanced(R,X,W._dataType,0,U):f.drawArraysInstanced(R,0,X,U),Mr)try{lQ(e.gl)}catch(xe){throw new Error("Draw error rendering item id "+s+": '"+xe+"'")}}},update:function(){if(d6e(z),a.aVertex){var Z=a.uVertexCount.ref.value;a.aVertex.ref.value.length<Z&&N.update(a.aVertex,Ws(new Float32Array(Z)))}for(var te=0,ce=D.length;te<ce;++te){var be=D[te],xe=be[0],Ie=be[1];Ie.ref.version!==k[xe]&&(z.defines=!0,k[xe]=Ie.ref.version)}if(z.defines)for(var _e=0,ae=o;_e<ae.length;_e++){var xe=ae[_e];L[xe].destroy(),L[xe]=QU(e,xe,m,r,n)}a.drawCount.ref.version!==k.drawCount&&(u.drawCount+=a.drawCount.ref.value-X,u.instancedDrawCount+=U*a.drawCount.ref.value-U*X,X=a.drawCount.ref.value,k.drawCount=a.drawCount.ref.version),a.instanceCount.ref.version!==k.instanceCount&&(u.instanceCount+=a.instanceCount.ref.value-U,u.instancedDrawCount+=a.instanceCount.ref.value*X-U*X,U=a.instanceCount.ref.value,k.instanceCount=a.instanceCount.ref.version);for(var te=0,ce=G.length;te<ce;++te){var ie=G[te],xe=ie[0],O=ie[1],Ie=g[xe];if(Ie.ref.version!==k[xe]){if(O.length>=Ie.ref.value.length)O.updateSubData(Ie.ref.value,0,O.length);else{O.destroy();var V=n[xe],ve=V.itemSize,Pe=V.divisor;G[te][1]=c.attribute(Ie.ref.value,ve,Pe),z.attributes=!0}k[xe]=Ie.ref.version}}if(W&&a.elements.ref.version!==k.elements&&(W.length>=a.elements.ref.value.length?W.updateSubData(a.elements.ref.value,0,W.length):(W.destroy(),W=c.elements(a.elements.ref.value),z.elements=!0),k.elements=a.elements.ref.version),z.attributes||z.defines||z.elements)for(var Me=0,Ge=o;Me<Ge.length;Me++){var xe=Ge[Me],$e=J[xe];$e&&$e.destroy(),J[xe]=h?c.vertexArray(L[xe],G,W):null}for(var te=0,ce=Q.length;te<ce;++te){var Ze=Q[te],xe=Ze[0],ht=Ze[1],Ie=y[xe];Ie.ref.version!==k[xe]&&(n[xe].kind!=="texture"?(ht.load(Ie.ref.value),z.textures=!0):Q[te][1]=Ie.ref.value,k[xe]=Ie.ref.version)}for(var te=0,ce=A.length;te<ce;++te){var Ue=A[te],xe=Ue[0],rt=Ue[1];rt.ref.version!==k[xe]&&(N.update(I[te][1],Qf(rt.ref.value)),k[xe]=rt.ref.version)}return z},destroy:function(){if(!ee){for(var Z=0,te=o;Z<te.length;Z++){var ce=te[Z];L[ce].destroy();var be=J[ce];be&&be.destroy()}Q.forEach(function(xe){var Ie=xe[0],_e=xe[1];n[Ie].kind!=="texture"&&_e.destroy()}),G.forEach(function(xe){xe[0];var Ie=xe[1];return Ie.destroy()}),W&&W.destroy(),u.drawCount-=X,u.instanceCount-=U,u.instancedDrawCount-=U*X,ee=!0}}}}var f6e=E(E({},xd),{aPosition:Hr("float32",3,0),elements:mv("uint32"),uColor:Qe("v3"),uColorTexDim:Qe("v2"),tColor:lr("image-uint8","rgb","ubyte","nearest"),dColorType:Qt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance"]),uIsoValue:Qe("v2"),uBboxMin:Qe("v3"),uBboxMax:Qe("v3"),uBboxSize:Qe("v3"),uMaxSteps:Qe("i"),uStepScale:Qe("f"),uJumpLength:Qe("f"),uTransform:Qe("m4"),uGridDim:Qe("v3"),dRenderMode:Qt("string",["isosurface","volume"]),dSingleLayer:Qt("boolean"),tTransferTex:lr("image-uint8","rgba","ubyte","linear"),uTransferScale:Qe("f"),dGridTexType:Qt("string",["2d","3d"]),uGridTexDim:Qe("v3"),tGridTex:lr("texture","rgba","ubyte","linear"),uGridStats:Qe("v4"),uCellDim:Qe("v3"),uCartnToUnit:Qe("m4"),uUnitToCartn:Qe("m4"),dPackedGroup:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean"),dFlatShaded:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean")});function h6e(e,t,r,n,a){var i=E(E(E(E({},gd),yd),bd),f6e);e.isWebGL2||(i.uMaxSteps=Qt("number"));var o={uObjectId:N.create(t)},s=VLe,u=Cd(e,"triangles",s,i,E(E({},r),o),a);return Sd(u,r,n)}var p6e=E(E({},xd),{aGroup:Hr("float32",1,0),aPosition:Hr("float32",3,0),aNormal:Hr("float32",3,0),elements:mv("uint32"),dFlatShaded:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean"),meta:Ca("unknown")});function v6e(e,t,r,n,a){var i=E(E(E(E({},gd),yd),bd),p6e),o={uObjectId:N.create(t)},s=iQ,u=Cd(e,"triangles",s,i,E(E({},r),o),a);return Sd(u,r,n)}var m6e=E(E(E({},xd),Lb),{aGroup:Hr("float32",1,0),aPosition:Hr("float32",3,0),dPointSizeAttenuation:Qt("boolean"),dPointFilledCircle:Qt("boolean"),uPointEdgeBleach:Qe("f")});function g6e(e,t,r,n,a){var i=E(E(E(E({},gd),yd),bd),m6e),o={uObjectId:N.create(t)},s=FLe,u=Cd(e,"points",s,i,E(E({},r),o),a);return Sd(u,r,n)}var y6e=E(E(E({},xd),Lb),{aGroup:Hr("float32",1,0),aMapping:Hr("float32",2,0),aStart:Hr("float32",3,0),aEnd:Hr("float32",3,0),elements:mv("uint32"),dLineSizeAttenuation:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean")});function b6e(e,t,r,n,a){var i=E(E(E(E({},gd),yd),bd),y6e),o={uObjectId:N.create(t)},s=zLe,u=Cd(e,"triangles",s,i,E(E({},r),o),a);return Sd(u,r,n)}var x6e=E(E(E({},xd),Lb),{aGroup:Hr("float32",1,0),aPosition:Hr("float32",3,0),aMapping:Hr("float32",2,0),elements:mv("uint32"),padding:Ca("number"),dDoubleSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean")});function S6e(e,t,r,n,a){var i=E(E(E(E({},gd),yd),bd),x6e),o={uObjectId:N.create(t)},s=BLe,u=Cd(e,"triangles",s,i,E(E({},r),o),a);return Sd(u,r,n)}var C6e=E(E(E({},xd),Lb),{aGroup:Hr("float32",1,0),aPosition:Hr("float32",3,0),aMapping:Hr("float32",2,0),aDepth:Hr("float32",1,0),elements:mv("uint32"),aTexCoord:Hr("float32",2,0),tFont:lr("image-uint8","alpha","ubyte","linear"),padding:Ca("number"),uBorderWidth:Qe("f"),uBorderColor:Qe("v3"),uOffsetX:Qe("f"),uOffsetY:Qe("f"),uOffsetZ:Qe("f"),uBackgroundColor:Qe("v3"),uBackgroundOpacity:Qe("f")});function _6e(e,t,r,n,a){var i=E(E(E(E({},gd),yd),bd),C6e),o={uObjectId:N.create(t)},s=jLe,u=Cd(e,"triangles",s,i,E(E({},r),o),a);return Sd(u,r,n)}var w6e=E(E({},xd),{uGeoTexDim:Qe("v2","buffered"),tPosition:lr("texture","rgb","float","nearest"),tGroup:lr("texture","alpha","float","nearest"),tNormal:lr("texture","rgb","float","nearest"),dFlatShaded:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean"),dGeoTexture:Qt("boolean")});function E6e(e,t,r,n,a){var i=E(E(E(E({},gd),yd),bd),w6e),o={uObjectId:N.create(t)},s=iQ,u=Cd(e,"triangles",s,i,E(E({},r),o),a);return Sd(u,r,n)}var A6e=E(E({},xd),{aGroup:Hr("float32",1,0),aPosition:Hr("float32",3,0),aUv:Hr("float32",2,0),elements:mv("uint32"),uImageTexDim:Qe("v2"),tImageTex:lr("image-uint8","rgba","ubyte","nearest"),tGroupTex:lr("image-uint8","rgba","ubyte","nearest"),dInterpolation:Qt("string",ROe)});function P6e(e,t,r,n,a){var i=E(E(E(E({},gd),yd),bd),A6e),o={uObjectId:N.create(t)},s=HLe,u=Cd(e,"triangles",s,i,E(E({},r),o),a);return Sd(u,r,n)}var T6e=E(E(E({},xd),Lb),{aGroup:Hr("float32",1,0),aStart:Hr("float32",3,0),aEnd:Hr("float32",3,0),aMapping:Hr("float32",3,0),aScale:Hr("float32",1,0),aCap:Hr("float32",1,0),elements:mv("uint32"),padding:Ca("number"),dDoubleSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean")});function I6e(e,t,r,n,a){var i=E(E(E(E({},gd),yd),bd),T6e),o={uObjectId:N.create(t)},s=ULe,u=Cd(e,"triangles",s,i,E(E({},r),o),a);return Sd(u,r,n)}var M6e=zi(0,2147483647),_d=zi(0,2147483647);function a0(e,t,r,n){return{id:M6e(),type:e,values:t,state:r,materialId:n}}function D6e(e,t){switch(t.type){case"mesh":return v6e(e,t.id,t.values,t.state,t.materialId);case"points":return g6e(e,t.id,t.values,t.state,t.materialId);case"spheres":return S6e(e,t.id,t.values,t.state,t.materialId);case"cylinders":return I6e(e,t.id,t.values,t.state,t.materialId);case"text":return _6e(e,t.id,t.values,t.state,t.materialId);case"lines":return b6e(e,t.id,t.values,t.state,t.materialId);case"direct-volume":return h6e(e,t.id,t.values,t.state,t.materialId);case"image":return P6e(e,t.id,t.values,t.state,t.materialId);case"texture-mesh":return E6e(e,t.id,t.values,t.state,t.materialId)}throw new Error("unsupported type")}var kr;(function(e){function t(c,d,f,h,v,p,g){return{id:pn.create22(),name:c,sourceData:d,geometry:f,transforms:g||[le.identity()],get groupCount(){return oi.getGroupCount(f)},getColor:h,getSize:v,getLabel:p}}e.create=t;function r(c){return{color:nO({shape:c},{}),size:rO({shape:c},{})}}e.getTheme=r;function n(c){var d=c.transforms.length,f=Ki.Location(c),h=function(v,p){return f.group=v,f.instance=p,f};return bn(c.groupCount,d,1,h)}e.groupIterator=n;function a(c,d){for(var f=d&&d.aTransform.ref.value.length>=c.length*16?d.aTransform.ref.value:new Float32Array(c.length*16),h=0,v=c.length;h<v;++h)le.toArray(c[h],f,h*16);return Tk(f,c.length,d)}e.createTransform=a;function i(c,d){var f=e.getTheme(c),h=oi.getUtils(c.geometry),v=_d(),p=n(c),g=e.createTransform(c.transforms),m=h.createValues(c.geometry,g,p,f,d),y=h.createRenderableState(d);return a0(c.geometry.kind,m,y,v)}e.createRenderObject=i;function o(c){return{kind:"shape-loci",shape:c}}e.Loci=o;function s(c){return!!c&&c.kind==="shape-loci"}e.isLoci=s;function u(c,d){return c.shape===d.shape}e.areLociEqual=u;function l(c){return c.shape.groupCount===0}e.isLociEmpty=l})(kr||(kr={}));var Ki;(function(e){function t(h,v,p){return v===void 0&&(v=0),p===void 0&&(p=0),{kind:"group-location",shape:h,group:v,instance:p}}e.Location=t;function r(h){return!!h&&h.kind==="group-location"}e.isLocation=r;function n(h,v){return{kind:"group-loci",shape:h,groups:v}}e.Loci=n;function a(h){return!!h&&h.kind==="group-loci"}e.isLoci=a;function i(h,v){if(h.shape!==v.shape||h.groups.length!==v.groups.length)return!1;for(var p=0,g=h.groups.length;p<g;++p){var m=h.groups[p],y=m.ids,b=m.instance,S=v.groups[p],x=S.ids,C=S.instance;if(b!==C||!Fe.areEqual(y,x))return!1}return!0}e.areLociEqual=i;function o(h){return s(h)===0}e.isLociEmpty=o;function s(h){for(var v=0,p=0,g=h.groups;p<g.length;p++){var m=g[p];v+=Fe.size(m.ids)}return v}e.size=s;var u=new Yc,l=_.zero();function c(h,v,p,g){for(var m=v.indices,y=v.offsets,b=function(I,D){Fe.forEach(I,function(k){for(var R=y[k],L=y[k+1];R<L;++R)_.fromArray(l,p,m[R]*3),_.transformMat4(l,l,g[D]),u.includeStep(l)})},S=0,x=h;S<x.length;S++){var C=x[S],w=C.ids,A=C.instance;b(w,A)}}function d(h,v,p,g){for(var m=v.indices,y=v.offsets,b=function(I,D){Fe.forEach(I,function(k){for(var R=y[k],L=y[k+1];R<L;++R)_.fromArray(l,p,m[R]*3),_.transformMat4(l,l,g[D]),u.radiusStep(l)})},S=0,x=h;S<x.length;S++){var C=x[S],w=C.ids,A=C.instance;b(w,A)}}function f(h,v){v||(v=je()),u.reset();var p=0,g=h.shape,m=g.geometry,y=g.transforms;if(m.kind==="mesh"||m.kind==="points"){var b=m.kind==="mesh"?m.vertexBuffer.ref.value:m.centerBuffer.ref.value;c(h.groups,m.groupMapping,b,y),u.finishedIncludeStep(),d(h.groups,m.groupMapping,b,y)}else if(m.kind==="lines"){var S=m.startBuffer.ref.value,x=m.endBuffer.ref.value;c(h.groups,m.groupMapping,S,y),c(h.groups,m.groupMapping,x,y),u.finishedIncludeStep(),d(h.groups,m.groupMapping,S,y),d(h.groups,m.groupMapping,x,y)}else if(m.kind==="spheres"||m.kind==="text"){var b=m.centerBuffer.ref.value;c(h.groups,m.groupMapping,b,y),u.finishedIncludeStep(),d(h.groups,m.groupMapping,b,y);for(var C=function(L,H){Fe.forEach(L,function(B){var j=h.shape.getSize(B,H);p<j&&(p=j)})},w=0,A=h.groups;w<A.length;w++){var I=A[w],D=I.ids,k=I.instance;C(D,k)}}else return je.copy(v,m.boundingSphere);return _.copy(v.center,u.center),v.radius=Math.sqrt(u.radiusSq),je.expand(v,v,p),v}e.getBoundingSphere=f})(Ki||(Ki={}));function _Q(e){var t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},a=[["",""]],i=[["",""]];if(t){for(var o=0,s=t.propertyNames.length;o<s;++o){var u=t.propertyNames[o],l=t.propertyTypes[o];(l==="uchar"||l==="uint8"||l==="ushort"||l==="uint16"||l==="uint"||l==="uint32"||l==="int")&&a.push([u,u]),(l==="uchar"||l==="uint8")&&i.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}var c=[["",""]];if(r){for(var o=0,s=r.propertyNames.length;o<s;++o){var d=r.propertyNames[o],l=r.propertyTypes[o];(l==="uchar"||l==="uint8")&&c.push([d,d])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}var f=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return E(E({},Ft.Params),{coloring:T.MappedStatic(f,{vertex:T.Group({red:T.Select(n.vRed,i,{label:"Red Property"}),green:T.Select(n.vGreen,i,{label:"Green Property"}),blue:T.Select(n.vBlue,i,{label:"Blue Property"})},{isFlat:!0}),material:T.Group({red:T.Select(n.mRed,c,{label:"Red Property"}),green:T.Select(n.mGreen,c,{label:"Green Property"}),blue:T.Select(n.mBlue,c,{label:"Blue Property"})},{isFlat:!0}),uniform:T.Group({color:T.Color(dr.grey)},{isFlat:!0})}),grouping:T.MappedStatic(n.group?"vertex":"none",{vertex:T.Group({group:T.Select(n.group,a,{label:"Group Property"})},{isFlat:!0}),none:T.Group({})})})}var ZU=_Q();function R6e(e,t,r,n,a){var i=r.vertices,o=r.normals,s=r.groups,u=n.getProperty("x"),l=n.getProperty("y"),c=n.getProperty("z");if(!u||!l||!c)throw new Error("missing coordinate properties");for(var d=n.getProperty("nx"),f=n.getProperty("ny"),h=n.getProperty("nz"),v=!!d&&!!f&&!!h,p=e;p<t;++p)Je.add3(i,u.value(p),l.value(p),c.value(p)),v&&Je.add3(o,d.value(p),f.value(p),h.value(p)),Je.add(s,a[p])}function k6e(e,t,r,n){for(var a=r.indices,i=e;i<t;++i){var o=n.value(i),s=o.entries,u=o.count;u===3?Je.add3(a,s[0],s[1],s[2]):u===4&&(Je.add3(a,s[2],s[1],s[0]),Je.add3(a,s[2],s[0],s[3]))}}function O6e(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,h,v,p,v,p,g;return fe(this,function(m){switch(m.label){case 0:if(i=Et.createState(t.rowCount,t.rowCount/4,a),o=t.getProperty("x"),s=t.getProperty("y"),u=t.getProperty("z"),!o||!s||!u)throw new Error("missing coordinate properties");l=t.getProperty("nx"),c=t.getProperty("ny"),d=t.getProperty("nz"),f=!!l&&!!c&&!!d,h=1e5,v=0,p=t.rowCount,m.label=1;case 1:return v<p?(R6e(v,Math.min(v+h,p),i,t,n),e.shouldUpdate?[4,e.update({message:"adding ply mesh vertices",current:v,max:p})]:[3,3]):[3,4];case 2:m.sent(),m.label=3;case 3:return v+=h,[3,1];case 4:v=0,p=r.rowCount,m.label=5;case 5:return v<p?(k6e(v,Math.min(v+h,p),i,r),e.shouldUpdate?[4,e.update({message:"adding ply mesh faces",current:v,max:p})]:[3,7]):[3,8];case 6:m.sent(),m.label=7;case 7:return v+=h,[3,5];case 8:return g=Et.getMesh(i),f||Ft.computeNormals(g),[2,g]}})})}var Zl=me.Schema.int;function L6e(e,t){for(var r=t.grouping,n=e.rowCount,a=r.name==="vertex"?e.getProperty(r.params.group):void 0,i=r.name==="vertex"?Yo(r.params.group):"Vertex",o=a?a.toArray({array:Uint32Array}):Ws(new Uint32Array(n)),s=a?Ml(o):n-1,u=new Uint32Array(s+1),l=0,c=o.length;l<c;++l)u[o[l]]=l;return{ids:o,map:u,label:i}}function JU(e,t,r){var n=r.coloring,a=e.rowCount,i,o,s;if(n.name==="vertex")i=e.getProperty(n.params.red)||me.ofConst(127,a,Zl),o=e.getProperty(n.params.green)||me.ofConst(127,a,Zl),s=e.getProperty(n.params.blue)||me.ofConst(127,a,Zl);else if(n.name==="material")i=t&&t.getProperty(n.params.red)||me.ofConst(127,a,Zl),o=t&&t.getProperty(n.params.green)||me.ofConst(127,a,Zl),s=t&&t.getProperty(n.params.blue)||me.ofConst(127,a,Zl);else{var u=dt.toRgb(n.params.color),l=u[0],c=u[1],d=u[2];i=me.ofConst(l,a,Zl),o=me.ofConst(c,a,Zl),s=me.ofConst(d,a,Zl)}return{kind:n.name,red:i,green:o,blue:s}}function e9(e,t,r,n){var a=r.kind,i=r.red,o=r.green,s=r.blue,u=n.ids,l=n.map,c=n.label;return kr.create("ply-mesh",e,t,function(d){var f=a==="material"?d:l[d];return dt.fromRgb(i.value(f),o.value(f),s.value(f))},function(){return 1},function(d){return c+" "+u[d]})}function N6e(){var e=this,t,r,n,a,i,o,s=function(u,l,c,d){return de(e,void 0,void 0,function(){var f,h,v,p,g;return fe(this,function(m){switch(m.label){case 0:if(f=l.getElement("vertex"),!f)throw new Error("missing vertex element");if(h=l.getElement("face"),!h)throw new Error("missing face element");return v=l.getElement("material"),p=!1,g=!1,(!t||t!==l)&&(p=!0),(!r||!T.isParamEqual(ZU.grouping,r.grouping,c.grouping))&&(p=!0),(!r||!T.isParamEqual(ZU.coloring,r.coloring,c.coloring))&&(g=!0),p?(i=JU(f,v,c),o=L6e(f,c),[4,O6e(u,f,h,o.ids,d&&d.geometry)]):[3,2];case 1:return a=m.sent(),n=e9(l,a,i,o),[3,3];case 2:g&&(i=JU(f,v,c),n=e9(l,a,i,o)),m.label=3;case 3:return t=l,r=Qf(c),[2,n]}})})};return s}function F6e(e,t){var r=this;return et.create("Shape Provider",function(n){return de(r,void 0,void 0,function(){return fe(this,function(a){return[2,{label:"Mesh",data:e,params:_Q(e),getShape:N6e(),geometryUtils:Ft.Utils}]})})})}function _p(){return _p.empty()}(function(e){function t(a,i){return{size:a,anglesInRadians:i}}e.create=t;function r(){return t(_(),_())}e.empty=r;function n(a,i,o){var s=_.magnitude(a),u=_.magnitude(i),l=_.magnitude(o),c=Math.acos(_.dot(i,o)/(u*l)),d=Math.acos(_.dot(a,o)/(s*l)),f=Math.acos(_.dot(a,i)/(s*u));return s<=0||u<=0||l<=0||c>=Math.PI||d>=Math.PI||f>=Math.PI?r():t(_.create(s,u,l),_.create(c,d,f))}e.fromBasis=n})(_p||(_p={}));var B6e=20.45482949774598;function U6e(e){var t=this;return et.create("Parse DCD",function(r){return de(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=e.header,a=n.DELTA?ff(n.DELTA*B6e,"ps"):ff(1,"step"),i=n.ISTART>=1?ff((n.ISTART-1)*a.value,a.unit):ff(0,a.unit),o=[],s=0,u=e.frames.length;s<u;++s)l=e.frames[s],c={elementCount:l.elementCount,time:ff(i.value+a.value*s,a.unit),x:l.x,y:l.y,z:l.z,xyzOrdering:{isIdentity:!0}},l.cell&&(d=l.cell,d[1]>=-1&&d[1]<=1&&d[3]>=-1&&d[3]<=1&&d[4]>=-1&&d[4]<=1?c.cell=_p.create(_.create(d[0],d[2],d[5]),_.create(Xr(90-Math.asin(d[1])*90/qy),Xr(90-Math.asin(d[3])*90/qy),Xr(90-Math.asin(d[4])*90/qy))):d[0]<0||d[1]<0||d[2]<0||d[3]<0||d[4]<0||d[5]<0||d[3]>180||d[4]>180||d[5]>180?c.cell=_p.fromBasis(_.create(d[0],d[1],d[3]),_.create(d[1],d[2],d[4]),_.create(d[3],d[4],d[5])):c.cell=_p.create(_.create(d[0],d[2],d[5]),_.create(Xr(mn(d[1],0,yn)?90:d[1]),Xr(mn(d[3],0,yn)?90:d[3]),Xr(mn(d[4],0,yn)?90:d[4])))),o.push(c);return[2,X1.create(o,a,i)]}})})})}function f_(e,t,r,n){for(var a=r,i=n-1,o=t.charCodeAt(a);(o===32||o>=48&&o<=57)&&a<=i;)o=t.charCodeAt(++a);for(o=t.charCodeAt(i);(o===32||o>=48&&o<=57)&&i>=a;)o=t.charCodeAt(--i);if(++i,a===i||a+1===i)return mt.add(e,a,i);if(o=t.charCodeAt(a),a+2===i){var s=t.charCodeAt(a+1);if((o===78||o===110)&&(s===65||s===97)||(o===67||o===99)&&(s===76||s===108)||(o===70||o===102)&&(s===69||s===101)||(o===83||o===115)&&(s===73||s===105)||(o===66||o===98)&&(s===82||s===114)||(o===65||o===97)&&(s===83||s===115))return mt.add(e,a,a+2)}if(o===67||o===99||o===72||o===104||o===78||o===110||o===79||o===111||o===80||o===112||o===83||o===115)return mt.add(e,a,a+1);mt.add(e,a,a)}var j6e=/^[\s\d]+|[\s\d]+$/g;function k3(e){e=e.replace(j6e,"").toUpperCase();var t=e.length;if(t===0||t===1||t===2&&(e==="NA"||e==="CL"||e==="FE"||e==="SI"||e==="BR"||e==="AS"))return e;if(t===3){if(e==="SOD")return"NA";if(e==="POT")return"K";if(e==="CES")return"CS";if(e==="CAL")return"CA";if(e==="CLA")return"CL"}var r=e[0];return r==="C"||r==="H"||r==="N"||r==="O"||r==="P"||r==="S"?r:""}var z6e=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],V6e=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],H6e=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],G6e=new Set(["FMN","NCN","FNS","FMA"]),t9=function(){var e=new Map,t=[{id:"HIS",name:"HISTIDINE",type:"L-peptide linking"},{id:"ARG",name:"ARGININE",type:"L-peptide linking"},{id:"LYS",name:"LYSINE",type:"L-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"L-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"L-peptide linking"},{id:"LEU",name:"LEUCINE",type:"L-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"L-peptide linking"},{id:"ALA",name:"ALANINE",type:"L-peptide linking"},{id:"MET",name:"METHIONINE",type:"L-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"L-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"L-peptide linking"},{id:"VAL",name:"VALINE",type:"L-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"L-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"L-peptide linking"},{id:"TYR",name:"TYROSINE",type:"L-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"L-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"L-peptide linking"},{id:"THR",name:"THREONINE",type:"L-peptide linking"},{id:"PRO",name:"PROLINE",type:"L-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"L-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"L-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"L-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"L-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"L-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"L-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"L-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"I",name:"INOSINIC ACID",type:"RNA linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"DNA linking"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),r9=function(){var e=new Map,t=[{id:"ZN2",name:"ZINC ION",type:"Ion"},{id:"SOD",name:"SODIUM ION",type:"Ion"},{id:"CES",name:"CESIUM ION",type:"Ion"},{id:"CLA",name:"CHLORIDE ION",type:"Ion"},{id:"CAL",name:"CALCIUM ION",type:"Ion"},{id:"POT",name:"POTASSIUM ION",type:"Ion"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),gh=function(){function e(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}return e.prototype.set=function(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(Rb.has(t.id)?"y":"n")},e.prototype.getAtomIds=function(t){for(var r=new Set,n=this.seqId.value(t);t<this.seqId.rowCount;){var a=this.seqId.value(t);if(a!==n)break;r.add(this.atomId.value(t)),t+=1}return r},e.prototype.hasAtomIds=function(t,r){for(var n=0,a=r.length;n<a;++n)if(!fa.areIntersecting(t,r[n]))return!1;return!0},e.prototype.getType=function(t){return this.hasAtomIds(t,z6e)?"peptide linking":this.hasAtomIds(t,V6e)?"RNA linking":this.hasAtomIds(t,H6e)?"DNA linking":"other"},e.prototype.has=function(t){return this.comps.has(t)},e.prototype.get=function(t){return this.comps.get(t)},e.prototype.add=function(t,r){if(!this.has(t))if(t9.has(t))this.set(t9.get(t));else if(y3.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(G6e.has(t))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else{var n=this.getAtomIds(r);if(n.size===1&&r9.has(t))this.set(r9.get(t));else{var a=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:a})}}return this.get(t)},e.prototype.getChemCompTable=function(){return Yr.ofPartialColumns(Ji.chem_comp,{id:me.ofStringArray(this.ids),name:me.ofStringArray(this.names),type:me.ofStringAliasArray(this.types),mon_nstd_flag:me.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}(),zP="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function q6e(e){for(var t=zP.length,r=e,n=0,a=zP[r%t];r>=t;)r=Math.floor(r/t),a+=zP[r%t],n+=1;return n>=5&&console.warn("getChainId overflow"),a}var XM=T3(q6e),yh=function(){function e(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}return e.prototype.set=function(t,r){this.count+=1,this.ids.push(""+this.count),this.types.push(t),this.descriptions.push([r])},e.prototype.getEntityId=function(t,r,n,a){return r===2?(this.waterId===void 0&&(this.set("water",(a==null?void 0:a.customName)||"Water"),this.waterId=""+this.count),this.waterId):Nk(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",(a==null?void 0:a.customName)||"Polymer "+(this.chainMap.size+1)),this.chainMap.set(n,""+this.count)),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",(a==null?void 0:a.customName)||this.namesMap.get(t)||t),this.heteroMap.set(t,""+this.count)),this.heteroMap.get(t))},e.prototype.getEntityTable=function(){return Yr.ofPartialColumns(Ji.entity,{id:me.ofStringArray(this.ids),type:me.ofStringAliasArray(this.types),pdbx_description:me.ofStringListArray(this.descriptions)},this.count)},e.prototype.setCompounds=function(t){for(var r=0,n=t.length;r<n;++r){var a=t[r],i=a.chains,o=a.description;this.set("polymer",o);for(var s=0,u=i.length;s<u;++s)this.compoundsMap.set(i[s],""+this.count)}},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function W6e(e,t){for(var r=e.atomName,n=e.residueName,a=new Array(e.count),i=new Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),u=new yh,l=new gh(e.residueNumber,e.atomName),c="",d=0,f="",h=0,v=0,p=-1,g=0,m=e.count;g<m;++g){var y=e.residueNumber.value(g);if(y!==p){var b=e.residueName.value(g),S=Zg(l.add(b,g).type,b);(S!==v||y!==p+1&&!(p===99999&&y===0))&&(f=XM(d),d+=1,h=0),c=u.getEntityId(b,S,f),h+=1,p=y,v=S}a[g]=c,i[g]=f,o[g]=h,s[g]=g}var x=me.ofStringArray(i),C=Yr.ofPartialColumns(Ji.atom_site,{auth_asym_id:x,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:me.ofFloatArray(me.mapToArray(e.x,function(w){return w*10},Float32Array)),Cartn_y:me.ofFloatArray(me.mapToArray(e.y,function(w){return w*10},Float32Array)),Cartn_z:me.ofFloatArray(me.mapToArray(e.z,function(w){return w*10},Float32Array)),id:me.ofIntArray(s),label_asym_id:x,label_atom_id:r,label_comp_id:n,label_seq_id:me.ofIntArray(o),label_entity_id:me.ofStringArray(a),occupancy:me.ofConst(1,e.count,me.Schema.float),type_symbol:me.ofStringArray(me.mapToArray(e.atomName,function(w){return k3(w)})),pdbx_PDB_model_num:me.ofConst(t,e.count,me.Schema.int)},e.count);return vv({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:C})}var YM;(function(e){function t(n){return(n==null?void 0:n.kind)==="gro"}e.is=t;function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}e.fromGro=r})(YM||(YM={}));function $6e(e){var t=this;return et.create("Parse GRO",function(r){return de(t,void 0,void 0,function(){var n,a,i,o,s,u;return fe(this,function(l){switch(l.label){case 0:n=YM.fromGro(e),a=[],i=0,o=e.structures.length,l.label=1;case 1:return i<o?(s=W6e(e.structures[i].atoms,i+1),[4,fd(s,n,r)]):[3,4];case 2:u=l.sent(),u.frameCount===1&&a.push(u.representative),l.label=3;case 3:return++i,[3,1];case 4:return[2,new $p(a)]}})})})}function X6e(e,t){var r=function(i,o){return(t.substr(i,o)||"").trim()},n={entry_id:Ct.ofString(e),length_a:Ct.ofString(r(6,9)),length_b:Ct.ofString(r(15,9)),length_c:Ct.ofString(r(24,9)),angle_alpha:Ct.ofString(r(33,7)),angle_beta:Ct.ofString(r(40,7)),angle_gamma:Ct.ofString(r(47,7)),Z_PDB:Ct.ofString(r(66,4)),pdbx_unique_axis:Ct.ofString("?")},a={entry_id:Ct.ofString(e),"space_group_name_H-M":Ct.ofString(r(55,11)),Int_Tables_number:Ct.ofString("?"),cell_setting:Ct.ofString("?"),space_group_name_Hall:Ct.ofString("?")};return[fi.ofFields("cell",n),fi.ofFields("symmetry",a)]}function n9(e,t){return{id:e,details:t,groups:[]}}function Y6e(e,t,r){for(var n=[],a,i,o,s=1,u=1,l=function(X){return e.data.substring(e.indices[2*X],e.indices[2*X+1])},c=t;c<r;c++){var d=l(c);if(d.substr(11,12)==="BIOMOLECULE:"){var f=d.substr(23).trim(),h="Biomolecule "+f;d=l(c+1),d.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(c++,h=d.substr(11).trim()),a=n9(f,h),n.push(a)}else if(d.substr(13,5)==="BIOMT"){var v=d.split(/\s+/),p=parseInt(d[18])-1;p===0&&(o=le.identity(),i.operators.push({id:s++,matrix:o})),le.setValue(o,p,0,parseFloat(v[4])),le.setValue(o,p,1,parseFloat(v[5])),le.setValue(o,p,2,parseFloat(v[6])),le.setValue(o,p,3,parseFloat(v[7]))}else if(d.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||d.substr(11,30)==="                   AND CHAINS:"){d.substr(11,5)==="APPLY"&&(i={chains:[],operators:[]},a.groups.push(i));for(var g=d.substr(41,30).split(","),m=0,y=g.length;m<y;++m){var b=g[m].trim();b&&i.chains.push(b)}}else if(d.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){a=n9(""+u,"Biomolecule "+u),n.push(a),u+=1,i={chains:[],operators:[]},a.groups.push(i),c++,d=l(c);for(var g=d.substr(11,69).split(","),m=0,y=g.length;m<y;++m){var b=g[m].trim();b&&i.chains.push(b)}}}if(n.length===0)return[];for(var S={id:Ct.ofStrings(n.map(function(X){return X.id})),details:Ct.ofStrings(n.map(function(X){return X.details}))},x=[],C=0,w=n;C<w.length;C++)for(var A=w[C],I=0,D=A.groups;I<D.length;I++){var k=D[I];x.push({assembly_id:A.id,oper_expression:k.operators.map(function(X){return X.id}).join(","),asym_id_list:k.chains.join(",")})}for(var R={assembly_id:Ct.ofStrings(x.map(function(X){return X.assembly_id})),oper_expression:Ct.ofStrings(x.map(function(X){return X.oper_expression})),asym_id_list:Ct.ofStrings(x.map(function(X){return X.asym_id_list}))},L=[],H=0,B=n;H<B.length;H++)for(var A=B[H],j=0,Q=A.groups;j<Q.length;j++)for(var G=Q[j],W=0,q=G.operators;W<q.length;W++){for(var J=q[W],p={id:""+J.id,type:"?",name:"?",symmetry_operation:"?"},c=0;c<3;c++){for(var m=0;m<3;m++)p["matrix["+(c+1)+"]["+(m+1)+"]"]=""+le.getValue(J.matrix,c,m);p["vector["+(c+1)+"]"]=""+le.getValue(J.matrix,c,3)}L.push(p)}for(var he={id:Ct.ofStrings(L.map(function(X){return X.id})),type:Ct.ofStrings(L.map(function(X){return X.type})),name:Ct.ofStrings(L.map(function(X){return X.name})),symmetry_operation:Ct.ofStrings(L.map(function(X){return X.symmetry_operation}))},$=function(X){for(var U=function(Y){var Z="matrix["+(X+1)+"]["+(Y+1)+"]";he[Z]=Ct.ofStrings(L.map(function(te){return te[Z]}))},z=0;z<3;z++)U(z);var ee="vector["+(X+1)+"]";he[ee]=Ct.ofStrings(L.map(function(Y){return Y[ee]}))},c=0;c<3;c++)$(c);return[fi.ofFields("pdbx_struct_assembly",S),fi.ofFields("pdbx_struct_assembly_gen",R),fi.ofFields("pdbx_struct_oper_list",he)]}function K6e(e,t,r){for(var n=[],a,i=function(y){return e.data.substring(e.indices[2*y],e.indices[2*y+1])},o=t;o<r;o++){var s=i(o),u=s.split(/\s+/),l=parseInt(s[5])-1;l===0&&(a=le.identity(),n.push(a)),le.setValue(a,l,0,parseFloat(u[2])),le.setValue(a,l,1,parseFloat(u[3])),le.setValue(a,l,2,parseFloat(u[4])),le.setValue(a,l,3,parseFloat(u[5]))}if(n.length===0)return[];for(var c=[],d=1,f=0,h=n;f<h.length;f++){for(var v=h[f],l={id:"ncsop"+d++,code:".",details:"."},o=0;o<3;o++){for(var p=0;p<3;p++)l["matrix["+(o+1)+"]["+(p+1)+"]"]=""+le.getValue(v,o,p);l["vector["+(o+1)+"]"]=""+le.getValue(v,o,3)}c.push(l)}for(var g={id:Ct.ofStrings(c.map(function(y){return y.id})),code:Ct.ofStrings(c.map(function(y){return y.code})),details:Ct.ofStrings(c.map(function(y){return y.details}))},m=function(y){for(var b=function(C){var w="matrix["+(y+1)+"]["+(C+1)+"]";g[w]=Ct.ofStrings(c.map(function(A){return A[w]}))},S=0;S<3;S++)b(S);var x="vector["+(y+1)+"]";g[x]=Ct.ofStrings(c.map(function(C){return C[x]}))},o=0;o<3;o++)m(o);return[fi.ofFields("struct_ncs_oper",g)]}var Q6e={1:"HELX_RH_AL_P",2:"HELX_RH_OM_P",3:"HELX_RH_PI_P",4:"HELX_RH_GA_P",5:"HELX_RH_3T_P",6:"HELX_LH_AL_P",7:"HELX_LH_OM_P",8:"HELX_LH_GA_P",9:"HELX_RH_27_P",10:"HELX_RH_PP_P"};function Z6e(e){return Q6e[e]||"HELX_P"}function J6e(e,t,r){for(var n=[],a=function(f){return e.data.substring(e.indices[2*f],e.indices[2*f+1])},i=t;i<r;i++){var o=a(i);n.push({serNum:o.substr(7,3).trim(),helixID:o.substr(11,3).trim(),initResName:o.substr(15,3).trim(),initChainID:o.substr(19,1).trim(),initSeqNum:o.substr(21,4).trim(),initICode:o.substr(25,1).trim(),endResName:o.substr(27,3).trim(),endChainID:o.substr(31,3).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),helixClass:o.substr(38,2).trim(),comment:o.substr(40,30).trim(),length:o.substr(71,5).trim()})}var s=Ct.ofStrings(n.map(function(f){return f.initChainID})),u=Ct.ofStrings(n.map(function(f){return f.initResName})),l=Ct.ofStrings(n.map(function(f){return f.endChainID})),c=Ct.ofStrings(n.map(function(f){return f.endResName})),d={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:Ct.ofUndefined(n.length,me.Schema.int),beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:Ct.ofStrings(n.map(function(f){return f.initSeqNum})),conf_type_id:Ct.ofStrings(n.map(function(f){return Z6e(f.helixClass)})),details:Ct.ofStrings(n.map(function(f){return f.comment})),end_label_asym_id:l,end_label_comp_id:c,end_label_seq_id:Ct.ofUndefined(n.length,me.Schema.int),end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:Ct.ofStrings(n.map(function(f){return f.endSeqNum})),id:Ct.ofStrings(n.map(function(f){return f.serNum})),pdbx_beg_PDB_ins_code:Ct.ofStrings(n.map(function(f){return f.initICode})),pdbx_end_PDB_ins_code:Ct.ofStrings(n.map(function(f){return f.endICode})),pdbx_PDB_helix_class:Ct.ofStrings(n.map(function(f){return f.helixClass})),pdbx_PDB_helix_length:Ct.ofStrings(n.map(function(f){return f.length})),pdbx_PDB_helix_id:Ct.ofStrings(n.map(function(f){return f.helixID}))};return fi.ofFields("struct_conf",d)}function eBe(e,t,r){for(var n=[],a=function(v){return e.data.substring(e.indices[2*v],e.indices[2*v+1])},i=t;i<r;i++){var o=a(i);n.push({strand:o.substr(7,3).trim(),sheetID:o.substr(11,3).trim(),numStrands:o.substr(14,2).trim(),initResName:o.substr(17,3).trim(),initChainID:o.substr(21,1).trim(),initSeqNum:o.substr(22,4).trim(),initICode:o.substr(26,1).trim(),endResName:o.substr(28,3).trim(),endChainID:o.substr(32,1).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),sense:o.substr(38,2).trim(),curAtom:o.substr(41,4).trim(),curResName:o.substr(45,3).trim(),curChainId:o.substr(49,1).trim(),curResSeq:o.substr(50,4).trim(),curICode:o.substr(54,1).trim(),prevAtom:o.substr(56,4).trim(),prevResName:o.substr(60,3).trim(),prevChainId:o.substr(64,1).trim(),prevResSeq:o.substr(65,4).trim(),prevICode:o.substr(69,1).trim()})}var s=Ct.ofStrings(n.map(function(v){return v.initChainID})),u=Ct.ofStrings(n.map(function(v){return v.initResName})),l=Ct.ofStrings(n.map(function(v){return v.initSeqNum})),c=Ct.ofStrings(n.map(function(v){return v.endChainID})),d=Ct.ofStrings(n.map(function(v){return v.endResName})),f=Ct.ofStrings(n.map(function(v){return v.endSeqNum})),h={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:l,beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:l,end_label_asym_id:c,end_label_comp_id:c,end_label_seq_id:f,end_auth_asym_id:c,end_auth_comp_id:d,end_auth_seq_id:f,id:Ct.ofStrings(n.map(function(v){return v.strand})),sheet_id:Ct.ofStrings(n.map(function(v){return v.sheetID})),pdbx_beg_PDB_ins_code:Ct.ofStrings(n.map(function(v){return v.initICode})),pdbx_end_PDB_ins_code:Ct.ofStrings(n.map(function(v){return v.endICode}))};return fi.ofFields("struct_sheet_range",h)}var tBe={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function rBe(e,t,r){for(var n=function(h){return e.data.substring(e.indices[2*h],e.indices[2*h+1])},a,i={chains:[],description:""},o=[],s=t;s<r;s++){var u=n(s),l=u.substr(10,70).trim(),c=l.indexOf(":"),d=l.substring(0,c),f=void 0;d in tBe?(a=d,f=l.substring(c+2)):f=l,f=f.replace(/;$/,""),a==="MOL_ID"?(i={chains:[],description:""},o.push(i)):a==="MOLECULE"?(i.description&&(i.description+=" "),i.description+=f):a==="CHAIN"&&Array.prototype.push.apply(i.chains,f.split(/\s*,\s*/))}return o}function nBe(e,t,r){for(var n=function(l){return e.data.substring(e.indices[2*l],e.indices[2*l+1])},a=new Map,i=t;i<r;i++){var o=n(i),s=o.substr(11,3).trim(),u=o.substr(15).trim();a.has(s)?a.set(s,a.get(s)+" "+u):a.set(s,u)}return a}function aBe(e,t){var r=function(){return[]},n=function(){return mt.create(e,2*t)};return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}function iBe(e){var t=Ct.ofTokens(e.auth_asym_id),r=Ct.ofTokens(e.auth_atom_id),n=Ct.ofTokens(e.auth_comp_id);return{auth_asym_id:t,auth_atom_id:r,auth_comp_id:n,auth_seq_id:Ct.ofTokens(e.auth_seq_id),B_iso_or_equiv:Ct.ofTokens(e.B_iso_or_equiv),Cartn_x:Ct.ofTokens(e.Cartn_x),Cartn_y:Ct.ofTokens(e.Cartn_y),Cartn_z:Ct.ofTokens(e.Cartn_z),group_PDB:Ct.ofTokens(e.group_PDB),id:Ct.ofStrings(e.id),label_alt_id:Ct.ofTokens(e.label_alt_id),label_asym_id:t,label_atom_id:r,label_comp_id:n,label_seq_id:Ct.ofUndefined(e.index,me.Schema.int),label_entity_id:Ct.ofStrings(e.label_entity_id),occupancy:Ct.ofTokens(e.occupancy),type_symbol:Ct.ofTokens(e.type_symbol),pdbx_PDB_ins_code:Ct.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:Ct.ofStrings(e.pdbx_PDB_model_num),partial_charge:Ct.ofTokens(e.partial_charge)}}function a9(e,t,r,n,a,i){var o=r.data,s=a-n;mt.addToken(e.group_PDB,It.trim(r,n,n+6)),It.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),mt.addToken(e.auth_atom_id,It.trim(r,n+12,n+16)),o.charCodeAt(n+16)===32?mt.add(e.label_alt_id,0,0):mt.add(e.label_alt_id,n+16,n+17),mt.addToken(e.auth_comp_id,It.trim(r,n+17,n+20)),mt.add(e.auth_asym_id,n+21,n+22),mt.addToken(e.auth_seq_id,It.trim(r,n+22,n+26)),o.charCodeAt(n+26)===32?mt.add(e.pdbx_PDB_ins_code,0,0):mt.add(e.pdbx_PDB_ins_code,n+26,n+27),mt.addToken(e.Cartn_x,It.trim(r,n+30,n+38)),mt.addToken(e.Cartn_y,It.trim(r,n+38,n+46)),mt.addToken(e.Cartn_z,It.trim(r,n+46,n+54)),mt.addToken(e.occupancy,It.trim(r,n+54,n+60)),s>=66?mt.addToken(e.B_iso_or_equiv,It.trim(r,n+60,n+66)):mt.add(e.B_iso_or_equiv,0,0),i&&mt.addToken(e.partial_charge,It.trim(r,n+70,n+76)),s>=78&&!i?(It.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?mt.addToken(e.type_symbol,r):f_(e.type_symbol,o,n+12,n+16)):f_(e.type_symbol,o,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function oBe(e,t){var r=function(){return[]},n=function(){return new Float32Array(t)},a=function(){return mt.create(e,2*t)};return{index:0,count:t,id:r(),type_symbol:a(),pdbx_label_atom_id:a(),pdbx_label_alt_id:a(),pdbx_label_comp_id:a(),pdbx_label_asym_id:a(),pdbx_label_seq_id:a(),pdbx_PDB_ins_code:a(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:a(),pdbx_auth_comp_id:a(),pdbx_auth_asym_id:a(),pdbx_auth_atom_id:a()}}function sBe(e){var t=Ct.ofTokens(e.pdbx_auth_seq_id),r=Ct.ofTokens(e.pdbx_auth_comp_id),n=Ct.ofTokens(e.pdbx_auth_asym_id),a=Ct.ofTokens(e.pdbx_auth_atom_id),i={id:Ct.ofStrings(e.id),type_symbol:Ct.ofTokens(e.type_symbol),pdbx_label_atom_id:a,pdbx_label_alt_id:Ct.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:Ct.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:a};return i["U[1][1]"]=Ct.ofNumbers(e["U[1][1]"]),i["U[2][2]"]=Ct.ofNumbers(e["U[2][2]"]),i["U[3][3]"]=Ct.ofNumbers(e["U[3][3]"]),i["U[1][2]"]=Ct.ofNumbers(e["U[1][2]"]),i["U[1][3]"]=Ct.ofNumbers(e["U[1][3]"]),i["U[2][3]"]=Ct.ofNumbers(e["U[2][3]"]),i}function uBe(e,t,r,n,a){var i=r.data,o=a-n;It.trim(r,n+6,n+11),e.id[e.index]=i.substring(r.tokenStart,r.tokenEnd),mt.addToken(e.pdbx_auth_atom_id,It.trim(r,n+12,n+16)),i.charCodeAt(n+16)===32?mt.add(e.pdbx_label_alt_id,0,0):mt.add(e.pdbx_label_alt_id,n+16,n+17),mt.addToken(e.pdbx_auth_comp_id,It.trim(r,n+17,n+20)),mt.add(e.pdbx_auth_asym_id,n+21,n+22),mt.addToken(e.pdbx_auth_seq_id,It.trim(r,n+22,n+26)),i.charCodeAt(n+26)===32?mt.add(e.pdbx_PDB_ins_code,0,0):mt.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=Xh(i,n+28,n+35)/1e4,e["U[2][2]"][e.index]=Xh(i,n+35,n+42)/1e4,e["U[3][3]"][e.index]=Xh(i,n+42,n+49)/1e4,e["U[1][2]"][e.index]=Xh(i,n+49,n+56)/1e4,e["U[1][3]"][e.index]=Xh(i,n+56,n+63)/1e4,e["U[2][3]"][e.index]=Xh(i,n+63,n+70)/1e4,o>=78?(It.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?mt.addToken(e.type_symbol,r):f_(e.type_symbol,i,n+12,n+16)):f_(e.type_symbol,i,n+12,n+16),e.index++}function lBe(e,t,r,n){for(var a={},i=0,o=n.id.rowCount;i<o;++i)a[n.id.str(i)]=i;for(var s=function(k){return e.data.substring(e.indices[2*k],e.indices[2*k+1])},u=[],l=[],c=[],d=[],f=[],h=[],v=[],p=[],g=[],m=[],y=[11,16,21,26],b=1,i=t;i<r;i++){var S=s(i),x=a[parseInt(S.substr(6,5))],C={};if(x!==void 0)for(var w=0;w<4;++w){var A=parseInt(S.substr(y[w],5));if(!Number.isNaN(A)){var I=a[A];I!==void 0&&(x>I||C[I]===void 0&&(u.push("covale"+b),l.push("covale"),c.push(n.label_asym_id.str(x)),f.push(n.auth_seq_id.int(x)),d.push(n.label_seq_id.int(x)),h.push(n.label_atom_id.str(x)),v.push(n.label_asym_id.str(I)),g.push(n.auth_seq_id.int(I)),p.push(n.label_seq_id.int(I)),m.push(n.label_atom_id.str(I)),b+=1))}}}var D={id:Ct.ofStrings(u),conn_type_id:Ct.ofStrings(l),ptnr1_label_asym_id:Ct.ofStrings(c),ptnr1_auth_seq_id:Ct.ofNumbers(f),ptnr1_label_seq_id:Ct.ofNumbers(d),ptnr1_label_atom_id:Ct.ofStrings(h),ptnr2_label_asym_id:Ct.ofStrings(v),ptnr2_label_seq_id:Ct.ofNumbers(p),ptnr2_auth_seq_id:Ct.ofNumbers(g),ptnr2_label_atom_id:Ct.ofStrings(m)};return fi.ofFields("struct_conn",D)}function cBe(e){return de(this,void 0,void 0,function(){var t,r,n,a,i,o,s,I,g,m,y,u,l,c,d,f,h,v,p,I,g,m,y,b,b,b,b,b,b,b,S,x,C,w,A,I,D,k,R,L,H,B,j,Q;return fe(this,function(G){for(t=e.lines,r=t.data,n=t.indices,a=It(r),i=!!e.isPdbqt,o=0,s=0,I=0,g=t.count;I<g;I++)switch(m=n[2*I],y=n[2*I+1],r[m]){case"A":va(r,m,y,"ATOM  ")?o++:va(r,m,y,"ANISOU")&&s++;break;case"H":va(r,m,y,"HETATM")&&o++;break}for(u=aBe(r,o),l=oBe(r,s),c=new yh,d=[],f=[],h=0,v="",p=void 0,I=0,g=t.count;I<g;I++)switch(m=n[2*I],y=n[2*I+1],r[m]){case"A":va(r,m,y,"ATOM  ")?(h||(h++,v=""+h),a9(u,v,a,m,y,i)):va(r,m,y,"ANISOU")&&uBe(l,v,a,m,y);break;case"C":if(va(r,m,y,"CRYST1"))d.push.apply(d,X6e(e.id||"?",r.substring(m,y)));else if(va(r,m,y,"CONECT")){for(b=I+1;m=n[2*b],y=n[2*b+1],!!va(r,m,y,"CONECT");)b++;p?Mr&&console.log("only single CONECT block allowed, ignoring others"):p=[I,b],I=b-1}else if(va(r,m,y,"COMPND")){for(b=I+1;m=n[2*b],y=n[2*b+1],!!va(r,m,y,"COMPND");)b++;c.setCompounds(rBe(t,I,b)),I=b-1}break;case"H":if(va(r,m,y,"HETATM"))h||(h++,v=""+h),a9(u,v,a,m,y,i);else if(va(r,m,y,"HELIX")){for(b=I+1;m=n[2*b],y=n[2*b+1],!!va(r,m,y,"HELIX");)b++;d.push(J6e(t,I,b)),I=b-1}else if(va(r,m,y,"HETNAM")){for(b=I+1;m=n[2*b],y=n[2*b+1],!!va(r,m,y,"HETNAM");)b++;f.push.apply(f,Array.from(nBe(t,I,b).entries())),I=b-1}break;case"M":if(va(r,m,y,"MODEL ")&&(h++,v=""+h),va(r,m,y,"MTRIX")){for(b=I+1;m=n[2*b],y=n[2*b+1],!!va(r,m,y,"MTRIX");)b++;d.push.apply(d,K6e(t,I,b)),I=b-1}break;case"O":break;case"R":if(va(r,m,y,"REMARK 350")){for(b=I+1;m=n[2*b],y=n[2*b+1],!!va(r,m,y,"REMARK 350");)b++;d.push.apply(d,Y6e(t,I,b)),I=b-1}break;case"S":if(va(r,m,y,"SHEET")){for(b=I+1;m=n[2*b],y=n[2*b+1],!!va(r,m,y,"SHEET");)b++;d.push(eBe(t,I,b)),I=b-1}break}for(S=me.ofIntTokens(u.auth_seq_id),x=me.ofStringTokens(u.auth_atom_id),C=me.ofStringTokens(u.auth_comp_id),w=me.ofStringTokens(u.auth_asym_id),A=new gh(S,x),A.setNames(f),c.setNames(f),I=0,D=C.rowCount;I<D;++I)k=C.value(I),R=Zg(A.add(k,I).type,k),u.label_entity_id[I]=c.getEntityId(k,R,w.value(I));for(L=iBe(u),i||delete L.partial_charge,p&&d.push(lBe(t,p[0],p[1],L)),H={entity:fi.ofTable("entity",c.getEntityTable()),chem_comp:fi.ofTable("chem_comp",A.getChemCompTable()),atom_site:fi.ofFields("atom_site",L),atom_site_anisotrop:fi.ofFields("atom_site_anisotrop",sBe(l))},B=0,j=d;B<j.length;B++)Q=j[B],H[Q.name]=Q;return[2,{header:e.id||"PDB",categoryNames:Object.keys(H),categories:H}]})})}var Mg;(function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=ju.create(e.Descriptor)})(Mg||(Mg={}));var KM;(function(e){function t(n){return(n==null?void 0:n.kind)==="pdb"}e.is=t;function r(n){return{kind:"pdb",name:n.id||"",data:n}}e.create=r})(KM||(KM={}));function dBe(e){var t=this;return et.create("Parse PDB",function(r){return de(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h;return fe(this,function(v){switch(v.label){case 0:return[4,r.update("Converting to mmCIF")];case 1:return v.sent(),[4,cBe(e)];case 2:return n=v.sent(),a=nn.fromFrame(n,void 0,KM.create(e)),[4,fd(a.data.db,a,r)];case 3:return i=v.sent(),o=(h=n.categories.atom_site)===null||h===void 0?void 0:h.getField("partial_charge"),o&&i.frameCount===1&&(s=i.representative,u=s.atomicHierarchy.atomSourceIndex,l=me.isIdentity(u),c=l?void 0:u.toArray({array:Int32Array}),d=o.toFloatArray(),f=c?me.ofFloatArray(me.mapToArray(u,function(p){return d[p]},Float32Array)):me.ofFloatArray(d),Mg.Provider.set(s,{data:f,type:"GASTEIGER"})),[2,i]}})})})}function fBe(e){for(var t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),a=new Uint32Array(e.count),i=new yh,o=new gh(e.residueId,e.atomName),s="",u=0,l="",c=0,d=e.segmentName.value(0),f=!1,h=0,v=-1,p=0,g=e.count;p<g;++p){var m=e.residueId.value(p),y=e.segmentName.value(p);if(d!==y?(l=XM(u),u+=1,c=0,f=!0,d=y):f=!1,f||m!==v){var b=e.residueName.value(p),S=Zg(o.add(b,p).type,b);!f&&(S!==h||m!==v+1)&&(l=XM(u),u+=1,c=0),s=i.getEntityId(b,S,l),c+=1,v=m,h=S}t[p]=s,r[p]=l,n[p]=c,a[p]=p}var x=Yr.ofPartialColumns(Ji.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:me.ofIntArray(a),label_asym_id:me.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:me.ofIntArray(n),label_entity_id:me.ofStringArray(t),occupancy:me.ofConst(1,e.count,me.Schema.float),type_symbol:me.ofStringArray(me.mapToArray(e.atomName,function(C){return k3(C)})),pdbx_PDB_model_num:me.ofConst(1,e.count,me.Schema.int)},e.count);return vv({entity:i.getEntityTable(),chem_comp:o.getChemCompTable(),atom_site:x})}var QM;(function(e){function t(n){return(n==null?void 0:n.kind)==="psf"}e.is=t;function r(n){return{kind:"psf",name:n.id,data:n}}e.fromPsf=r})(QM||(QM={}));function hBe(e){var t=this;return et.create("Parse PSF",function(r){return de(t,void 0,void 0,function(){var n,a,i,o,s,u;return fe(this,function(l){return n=QM.fromPsf(e),a=fBe(e.atoms),i=e.bonds,o=i.atomIdA,s=i.atomIdB,u={indexA:me.ofLambda({value:function(c){return o.value(c)-1},rowCount:o.rowCount,schema:o.schema}),indexB:me.ofLambda({value:function(c){return s.value(c)-1},rowCount:s.rowCount,schema:s.schema}),order:me.ofConst(1,e.bonds.count,me.Schema.int)},[2,CM.create(e.id,a,u,n)]})})})}function pBe(e){return Object.keys(e).filter(function(t){return!isNaN(t)}).map(function(t){return+t}).sort(function(t,r){return t-r}).map(function(t){return e[t]})}function VP(e,t,r){return e&&e[t]!==void 0?e[t]:r}function lt(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return{kind:"alias",aliases:t,symbol:e}}function ix(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return e.info.namespace="molscript-macro",e.id="molscript-macro."+e.info.name,{kind:"macro",symbol:e,translate:t,aliases:Ut([e.info.name],r)}}function vBe(e){return e.kind==="alias"||e.kind==="macro"}var mBe=[["Core symbols",lt(we.core.type.bool,"bool"),lt(we.core.type.num,"num"),lt(we.core.type.str,"str"),lt(we.core.type.regex,"regex"),lt(we.core.type.list,"list"),lt(we.core.type.set,"set"),lt(we.core.type.compositeKey,"composite-key"),lt(we.core.logic.not,"not"),lt(we.core.logic.and,"and"),lt(we.core.logic.or,"or"),lt(we.core.ctrl.if,"if"),lt(we.core.ctrl.fn,"fn"),lt(we.core.ctrl.eval,"eval"),lt(we.core.math.add,"add","+"),lt(we.core.math.sub,"sub","-"),lt(we.core.math.mult,"mult","*"),lt(we.core.math.div,"div","/"),lt(we.core.math.pow,"pow","**"),lt(we.core.math.mod,"mod"),lt(we.core.math.min,"min"),lt(we.core.math.max,"max"),lt(we.core.math.floor,"floor"),lt(we.core.math.ceil,"ceil"),lt(we.core.math.roundInt,"round"),lt(we.core.math.abs,"abs"),lt(we.core.math.sqrt,"sqrt"),lt(we.core.math.cbrt,"cbrt"),lt(we.core.math.sin,"sin"),lt(we.core.math.cos,"cos"),lt(we.core.math.tan,"tan"),lt(we.core.math.asin,"asin"),lt(we.core.math.acos,"acos"),lt(we.core.math.atan,"atan"),lt(we.core.math.sinh,"sinh"),lt(we.core.math.cosh,"cosh"),lt(we.core.math.tanh,"tanh"),lt(we.core.math.exp,"exp"),lt(we.core.math.log,"log"),lt(we.core.math.log10,"log10"),lt(we.core.math.atan2,"atan2"),lt(we.core.rel.eq,"eq","="),lt(we.core.rel.neq,"neq","!="),lt(we.core.rel.lt,"lt","<"),lt(we.core.rel.lte,"lte","<="),lt(we.core.rel.gr,"gr",">"),lt(we.core.rel.gre,"gre",">="),lt(we.core.rel.inRange,"in-range"),lt(we.core.str.concat,"concat"),lt(we.core.str.match,"regex.match"),lt(we.core.list.getAt,"list.get"),lt(we.core.set.has,"set.has"),lt(we.core.set.isSubset,"set.subset")],["Structure",["Types",lt(we.structureQuery.type.entityType,"ent-type"),lt(we.structureQuery.type.authResidueId,"auth-resid"),lt(we.structureQuery.type.labelResidueId,"label-resid"),lt(we.structureQuery.type.ringFingerprint,"ringfp"),lt(we.structureQuery.type.bondFlags,"bond-flags")],["Slots",lt(we.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",lt(we.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),lt(we.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),lt(we.structureQuery.generator.rings,"sel.atom.rings"),lt(we.structureQuery.generator.empty,"sel.atom.empty"),lt(we.structureQuery.generator.all,"sel.atom.all"),lt(we.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),ix(Sy("sel.atom.atoms",Rt.Dictionary({0:gt(ke.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),Pt.ElementSelection,"A selection of singleton atom sets."),function(e){return ue.struct.generator.atomGroups({"atom-test":VP(e,0,!0)})}),ix(Sy("sel.atom.res",Rt.Dictionary({0:gt(ke.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),Pt.ElementSelection,"A selection of atom sets grouped by residue."),function(e){return ue.struct.generator.atomGroups({"residue-test":VP(e,0,!0),"group-by":ue.ammp("residueKey")})}),ix(Sy("sel.atom.chains",Rt.Dictionary({0:gt(ke.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),Pt.ElementSelection,"A selection of atom sets grouped by chain."),function(e){return ue.struct.generator.atomGroups({"chain-test":VP(e,0,!0),"group-by":ue.ammp("chainKey")})})],["Modifiers",lt(we.structureQuery.modifier.queryEach,"sel.atom.query-each"),lt(we.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),lt(we.structureQuery.modifier.exceptBy,"sel.atom.except-by"),lt(we.structureQuery.modifier.unionBy,"sel.atom.union-by"),lt(we.structureQuery.modifier.union,"sel.atom.union"),lt(we.structureQuery.modifier.cluster,"sel.atom.cluster"),lt(we.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),lt(we.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),lt(we.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),lt(we.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",lt(we.structureQuery.filter.pick,"sel.atom.pick"),lt(we.structureQuery.filter.first,"sel.atom.first"),lt(we.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),lt(we.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),lt(we.structureQuery.filter.within,"sel.atom.within"),lt(we.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",lt(we.structureQuery.combinator.intersect,"sel.atom.intersect"),lt(we.structureQuery.combinator.merge,"sel.atom.merge"),lt(we.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",lt(we.structureQuery.atomSet.atomCount,"atom.set.atom-count"),lt(we.structureQuery.atomSet.countQuery,"atom.set.count-query"),lt(we.structureQuery.atomSet.reduce,"atom.set.reduce"),lt(we.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",lt(we.structureQuery.atomProperty.core.elementSymbol,"atom.el"),lt(we.structureQuery.atomProperty.core.vdw,"atom.vdw"),lt(we.structureQuery.atomProperty.core.mass,"atom.mass"),lt(we.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),lt(we.structureQuery.atomProperty.core.x,"atom.x"),lt(we.structureQuery.atomProperty.core.y,"atom.y"),lt(we.structureQuery.atomProperty.core.z,"atom.z"),lt(we.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),lt(we.structureQuery.atomProperty.core.operatorName,"atom.op-name"),lt(we.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),lt(we.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),lt(we.structureQuery.atomProperty.core.atomKey,"atom.key"),lt(we.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),lt(we.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),lt(we.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),lt(we.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),lt(we.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),lt(we.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),lt(we.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),lt(we.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),lt(we.structureQuery.atomProperty.macromolecular.id,"atom.id"),lt(we.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),lt(we.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),lt(we.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),lt(we.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),lt(we.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),lt(we.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),lt(we.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),lt(we.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),lt(we.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),lt(we.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),lt(we.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),lt(we.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),lt(we.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),lt(we.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),lt(we.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),lt(we.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),lt(we.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),lt(we.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),lt(we.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),lt(we.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),lt(we.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),lt(we.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),lt(we.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",lt(we.structureQuery.bondProperty.order,"bond.order"),lt(we.structureQuery.bondProperty.length,"bond.length"),lt(we.structureQuery.bondProperty.atomA,"bond.atom-a"),lt(we.structureQuery.bondProperty.atomB,"bond.atom-b"),ix(Sy("bond.is",Rt.List(Pt.BondFlag),ke.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: "+ke.oneOfValues(Pt.BondFlag).join(", ")),function(e){return ue.core.flags.hasAny([ue.struct.bondProperty.flags(),ue.struct.type.bondFlags(pBe(e))])})]]],wQ=[];function EQ(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];vBe(n)?wQ.push(n):n instanceof Array&&EQ(n)}}EQ(mBe);var gBe=function(){for(var e=[],t=Object.create(null),r=Jr.create(),n=Jr.create(),a=0,i=wQ;a<i.length;a++){for(var o=i[a],s=0,u=o.aliases;s<u.length;s++){var l=u[s];if(e.push([l,o]),t[l])throw new Error("Alias '"+l+"' already in use.");t[l]=o}var c=o.symbol.args;if(c.kind!=="dictionary"){c.type.kind==="oneof"&&ke.oneOfValues(c.type).forEach(function(v){return Jr.add(n,v,v)});continue}for(var d=0,f=Object.keys(c.map);d<f.length;d++){var l=f[d];isNaN(l)&&Jr.add(r,l,l);var h=c.map[l];h.type.kind==="oneof"&&ke.oneOfValues(h.type).forEach(function(p){return Jr.add(n,p,p)})}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}(),Wv=gBe.symbolMap;function Ey(e){if(Ia.isLiteral(e))return e;if(Ia.isSymbol(e)){if(!Wv[e.name])return e;var t=Wv[e.name];if(t.kind==="alias")return Ia.Symbol(Wv[e.name].symbol.id);throw t.translate([])}var r=Ia.isSymbol(e.head)&&!!Wv[e.head.name]&&Wv[e.head.name].kind==="macro",n=r?e.head:Ey(e.head),a=n!==e.head;if(!e.args)return r?Ey(e.head):a?Ia.Apply(n):e;var i=!1,o;if(Ia.isArgumentsArray(e.args)){o=[];for(var s=0,u=e.args.length;s<u;s++){var l=e.args[s],c=Ey(l);l!==c&&(i=!0),o[o.length]=c}if(i||(o=e.args),!r&&!a&&!i)return e}else{o={};for(var d=0,f=Object.keys(e.args);d<f.length;d++){var h=f[d],l=e.args[h],c=Ey(l);l!==c&&(i=!0),o[h]=c}if(!r&&!a&&!i)return e;i||(o=e.args)}if(r){var v=Wv[e.head.name];if(v.kind!=="macro")return Ia.Apply(n,o);var p=v.translate(o);return p}return Ia.Apply(n,o)}function yBe(e){return Ey(e)}var hu=function(){function e(t){this._=t}return e.prototype.parse=function(t){var r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:AQ(t,r.furthest),expected:r.expected}},e.prototype.tryParse=function(t){var r=this.parse(t);if(r.success)return r.value;var n=SBe(t,r),a=new Error(n);throw a},e.prototype.or=function(t){return e.alt(this,t)},e.prototype.trim=function(t){return this.wrap(t,t)},e.prototype.wrap=function(t,r){return HP(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)},e.prototype.thru=function(t){return t(this)},e.prototype.then=function(t){return HP(1,this,t)},e.prototype.many=function(){var t=this;return new e(function(r,n){for(var a=[],i=void 0;;)if(i=Is(t._(r,n),i),i.status){if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,a.push(i.value)}else return Is(Ei(n,a),i)})},e.prototype.times=function(t,r){var n=this,a=typeof r>"u"?t:r;return new e(function(i,o){var s=[],u=void 0,l=void 0,c;for(c=0;c<t;c++)if(u=n._(i,o),l=Is(u,l),u.status)o=u.index,s.push(u.value);else return l;for(;c<a&&(u=n._(i,o),l=Is(u,l),u.status);c+=1)o=u.index,s.push(u.value);return Is(Ei(o,s),l)})},e.prototype.result=function(t){return this.map(function(){return t})},e.prototype.atMost=function(t){return this.times(0,t)},e.prototype.atLeast=function(t){return e.seq(this.times(t),this.many()).map(function(r){return Ut(Ut([],r[0]),r[1])})},e.prototype.map=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status?Is(Ei(i.index,t(i.value)),i):i})},e.prototype.skip=function(t){return HP(0,this,t)},e.prototype.mark=function(){return e.seq(e.index,this,e.index).map(function(t){return{start:t[0],value:t[1],end:t[2]}})},e.prototype.node=function(t){return e.seq(e.index,this,e.index).map(function(r){return{name:t,start:r[0],value:r[1],end:r[2]}})},e.prototype.sepBy=function(t){return e.sepBy(this,t)},e.prototype.sepBy1=function(t){return e.sepBy1(this,t)},e.prototype.lookahead=function(t){return this.skip(e.lookahead(t))},e.prototype.notFollowedBy=function(t){return this.skip(e.notFollowedBy(t))},e.prototype.desc=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status||(i.expected=[t]),i})},e.prototype.fallback=function(t){return this.or(e.succeed(t))},e.prototype.ap=function(t){return e.seq(t,this).map(function(r){var n=r[0],a=r[1];return n(a)})},e.prototype.chain=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);if(!i.status)return i;var o=t(i.value);return Is(o._(n,i.index),i)})},e}();(function(e){function t(){for(var S=[],x=0;x<arguments.length;x++)S[x]=arguments[x];var C=S.length;return new e(function(w,A){for(var I,D=new Array(C),k=A,R=0;R<C;R++){if(I=Is(S[R]._(w,k),I),!I.status)return I;D[R]=I.value,k=I.index}return Is(Ei(k,D),I)})}e.seq=t;function r(){for(var S=[],x=0;x<arguments.length;x++)S[x]=arguments[x];var C=S.length;return C===0?c("zero alternates"):new e(function(w,A){for(var I,D=0;D<S.length;D++)if(I=Is(S[D]._(w,A),I),I.status)return I;return I})}e.alt=r;function n(S,x){return a(S,x).or(l([]))}e.sepBy=n;function a(S,x){var C=x.then(S).many();return t(S,C).map(function(w){return Ut([w[0]],w[1])})}e.sepBy1=a;function i(S){var x="'"+S+"'";if(S.length===1){var C=S.charCodeAt(0);return new e(function(w,A){return w.charCodeAt(A)===C?Ei(A+1,S):Jl(A,x)})}return new e(function(w,A){var I=A+S.length;return w.slice(A,I)===S?Ei(I,S):Jl(A,x)})}e.string=i;function o(S){var x=""+S;return x.slice(x.lastIndexOf("/")+1)}function s(S){return RegExp("^(?:"+S.source+")",o(S))}function u(S,x){x===void 0&&(x=0);var C=s(S),w=""+S;return new e(function(A,I){var D=C.exec(A.slice(I));if(D){if(0<=x&&x<=D.length){var k=D[0],R=D[x];return Ei(I+k.length,R)}var L="invalid match group (0 to "+D.length+") in "+w;return Jl(I,L)}return Jl(I,w)})}e.regexp=u;function l(S){return new e(function(x,C){return Ei(C,S)})}e.succeed=l;function c(S){return new e(function(x,C){return Jl(C,S)})}e.fail=c;function d(S){if(_Be(S))return new e(function(x,C){var w=S._(x,C);return w.status&&(w.index=C,w.value=null),w});if(typeof S=="string")return d(i(S));if(S instanceof RegExp)return d(u(S));throw new Error("not a string, regexp, or parser: "+S)}e.lookahead=d;function f(S){return new e(function(x,C){var w=S._(x,C);return w.status?Jl(C,'not "'+x.slice(C,w.index)+'"'):Ei(C,null)})}e.notFollowedBy=f;function h(S){return new e(function(x,C){var w=x.charAt(C);return C<x.length&&S(w)?Ei(C+1,w):Jl(C,"a character "+S)})}e.test=h;function v(S){return h(function(x){return S.indexOf(x)>=0})}e.oneOf=v;function p(S){return h(function(x){return S.indexOf(x)<0})}e.noneOf=p;function g(S,x){return h(function(C){return S<=C&&C<=x}).desc(S+"-"+x)}e.range=g;function m(S){return new e(function(x,C){for(var w=C;w<x.length&&S(x.charAt(w));)w++;return Ei(w,x.slice(C,w))})}e.takeWhile=m;function y(S){var x=new e(function(C,w){var A=S()._;return x._=A,A(C,w)});return x}e.lazy=y;function b(){return c("empty")}e.empty=b,e.index=new e(function(S,x){return Ei(x,AQ(S,x))}),e.anyChar=new e(function(S,x){return x>=S.length?Jl(x,"any character"):Ei(x+1,S.charAt(x))}),e.all=new e(function(S,x){return Ei(S.length,S.slice(x))}),e.eof=new e(function(S,x){return x<S.length?Jl(x,"EOF"):Ei(x,null)}),e.digit=u(/[0-9]/).desc("a digit"),e.digits=u(/[0-9]*/).desc("optional digits"),e.letter=u(/[a-z]/i).desc("a letter"),e.letters=u(/[a-z]*/i).desc("optional letters"),e.optWhitespace=u(/\s*/).desc("optional whitespace"),e.whitespace=u(/\s+/).desc("whitespace"),e.cr=i("\r"),e.lf=i(`
`),e.crlf=i(`\r
`),e.newline=r(e.crlf,e.lf,e.cr).desc("newline"),e.end=r(e.newline,e.eof)})(hu||(hu={}));function HP(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.length;return new hu(function(a,i){for(var o,s,u=i,l=0;l<n;l++){if(o=Is(t[l]._(a,u),o),!o.status)return o;e===l&&(s=o.value),u=o.index}return Is(Ei(u,s),o)})}function Ei(e,t){return{status:!0,index:e,value:t}}function Jl(e,t){return{status:!1,furthest:e,expected:[t]}}function Is(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?CBe(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function AQ(e,t){var r=e.slice(0,t).split(`
`),n=r.length,a=r[r.length-1].length+1;return{offset:t,line:n,column:a}}function bBe(e){return e.length===1?e[0]:"one of "+e.join(", ")}function xBe(e,t){var r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";var a=n>0?"'...":"'",i=e.length-n>12?"...'":"'";return" at line "+r.line+" column "+r.column+", got "+a+e.slice(n,n+12)+i}function SBe(e,t){return"expected "+bBe(t.expected)+xBe(e,t)}function CBe(e,t){var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;for(var a=new Set,i=[],o=0;o<r;o++)a.has(e[o])||(i[i.length]=e[o],a.add(e[o]));for(var o=0;o<n;o++)a.has(t[o])||(i[i.length]=t[o],a.add(t[o]));return i.sort(),i}function _Be(e){return e instanceof hu}function wBe(e){return ZM.parse(e)}var ZM;(function(e){var t;(function(S){function x(I){return{kind:"string",value:I}}S.str=x;function C(I){return{kind:"symbol",value:I}}S.symb=C;function w(I,D){return{kind:"list",bracket:I,nodes:D}}S.list=w;function A(I){return{kind:"comment",value:I}}S.comment=A})(t||(t={}));var r=hu.regexp(/[\n\r\s]*/),n=hu.lazy(function(){return hu.alt(a,d,i,o).trim(r)}),a=hu.takeWhile(function(S){return S!=="`"}).trim("`").map(t.str),i=hu.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=hu.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=n.many(),u=s.wrap("(",")").map(function(S){return t.list("(",S)}),l=s.wrap("[","]").map(function(S){return t.list("[",S)}),c=s.wrap("{","}").map(function(S){return t.list("{",S)}),d=hu.alt(u,l,c),f=n.many();function h(S){return f.tryParse(S)}function v(S){switch(S.kind){case"string":return S.value;case"symbol":{var x=S.value;if(x.length>1){var C=x.charAt(0);switch(C){case".":return ue.atomName(x.substr(1));case"_":return ue.struct.type.elementSymbol([x.substr(1)])}}return x==="true"?!0:x==="false"?!1:y(x)?+x:Ia.Symbol(x)}case"list":{switch(S.bracket){case"[":return ue.core.type.list(m(S.nodes).map(v));case"{":return ue.core.type.set(m(S.nodes).map(v));case"(":{var w=v(S.nodes[0]);return Ia.Apply(w,p(S.nodes))}}return 0}default:throw new Error("should not happen")}}function p(S){if(!(S.length<=1)){if(!g(S)){for(var x=[],C=1,w=S.length;C<w;C++){var A=S[C];A.kind!=="comment"&&(x[x.length]=v(A))}return x}for(var I={},D=!0,k=0,C=1,w=S.length;C<w;C++){var A=S[C];if(A.kind!=="comment")if(A.kind==="symbol"&&A.value.length>1&&A.value.charAt(0)===":"){var R=A.value.substr(1);for(++C;C<w&&S[C].kind==="comment";)C++;if(C>=w)throw new Error("There must be a value foolowed a named arg ':"+R+"'.");I[R]=v(S[C]),isNaN(+R)&&(D=!1)}else I[k++]=v(A)}if(D){for(var L=Object.keys(I).map(function(j){return+j}).sort(function(j,Q){return j-Q}),H=!0,C=0,w=L.length;C<w;C++)if(L[C]!==C){H=!1;break}if(H){for(var B=[],C=0,w=L.length;C<w;C++)B[C]=I[C];return B}}return I}}function g(S){for(var x=1,C=S.length;x<C;x++){var w=S[x];if(w.kind==="symbol"&&w.value.length>1&&w.value.charAt(0)===":")return!0}return!1}function m(S){for(var x=!1,C=0,w=S.length;C<w;C++)if(S[C].kind==="comment"){x=!0;break}return x?S.filter(function(A){return A.kind!=="comment"}):S}function y(S){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(S)&&!isNaN(+S)}function b(S){for(var x=h(S),C=[],w=0,A=x;w<A.length;w++){var I=A[w];I.kind!=="comment"&&(C[C.length]=v(I))}return C}e.parse=b})(ZM||(ZM={}));function Va(e,t){return{expression:e,language:t}}(function(e){function t(s){return!!s&&typeof s.expression=="string"&&!!s.language}e.is=t;function r(s,u){return s.language===u.language&&s.expression===u.expression}e.areEqual=r;function n(s){switch(s.language){case"mol-script":var u=wBe(s.expression);if(u.length===0)throw new Error("No query");return yBe(u[0])}throw new Error("unsupported script language")}e.toExpression=n;function a(s){var u=n(s);return Yp(u)}e.toQuery=a;function i(s,u){var l=a(s),c=l(new as(u));return yt.toLociWithSourceUnits(c)}e.toLoci=i;function o(s,u,l){var c=typeof s=="function"?s(ue):s,d=Yp(c);return d(new as(u,l))}e.getStructureSelection=o})(Va||(Va={}));var wp;(function(e){function t(u,l){var c=u&&ca.Provider.get(u),d=c?c.assemblies.map(function(S){return[S.id,S.id+": "+Yo(S.details)]}):[],f=c?!Io.isZero(c.spacegroup.cell):!0,h=[];if(c)for(var v=c.spacegroup.operators,p=0,g=v.length;p<g;p++)h.push([p,p+1+": "+zu.getOperatorXyz(v[p])]);var m=[];u&&u.properties.structAsymMap.forEach(function(S){var x=S.id===S.auth_id?S.id:S.id+" [auth "+S.auth_id+"]";m.push([S.id,x])});var y={auto:T.EmptyGroup(),model:T.EmptyGroup(),assembly:T.Group({id:T.Optional(u?T.Select(d.length?d[0][0]:"",d,{label:"Asm Id",description:"Assembly Id"}):T.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"}))},{isFlat:!0}),"symmetry-mates":T.Group({radius:T.Numeric(5,{min:0,max:50,step:1})},{isFlat:!0}),symmetry:T.Group({ijkMin:T.Vec3(_.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:T.Vec3(_.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},{isFlat:!0}),"symmetry-assembly":T.Group({generators:T.ObjectList({operators:T.ObjectList({index:T.Select(0,h),shift:T.Vec3(_(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},function(S){return S.index+1+"_"+S.shift.map(function(x){return x+5}).join("")},{defaultValue:[]}),asymIds:T.MultiSelect([],m)},function(S){return S.asymIds.length+" asym ids, "+S.operators.length+" operators"},{defaultValue:[]})},{isFlat:!0})},b=[];return l==="auto"&&b.push(["auto","Auto"]),b.push(["model","Model"]),d.length>0&&b.push(["assembly","Assembly"]),f&&(b.push(["symmetry-mates","Symmetry Mates"]),b.push(["symmetry","Symmetry (indices)"]),b.push(["symmetry-assembly","Symmetry (assembly)"])),{type:T.MappedStatic(l||"model",y,{options:b})}}e.getParams=t;function r(u,l){return!(l.name==="symmetry-assembly"||l.name==="symmetry"&&u.name==="symmetry")}e.canAutoUpdate=r;function n(u,l,c,d){return de(this,void 0,void 0,function(){var f,h,v,p,g,m;return fe(this,function(y){switch(y.label){case 0:return f=void 0,h=ca.Provider.get(c),!d&&h&&h.assemblies.length!==0&&(d=h.assemblies[0].id),!h||h.assemblies.length===0?u.log.warn("Model '"+c.entryId+"' has no assembly, returning model structure."):(f=Q1.findAssembly(c,d||""),f||u.log.warn("Model '"+c.entryId+"' has no assembly called '"+d+"', returning model structure.")),v=tt.ofModel(c),f?(d=f.id,[4,xl.buildAssembly(v,d).runInContext(l)]):(p={label:"Model",description:tt.elementDescription(v)},[2,new ge.Molecule.Structure(v,p)]);case 1:return g=y.sent(),m={label:"Assembly "+d,description:tt.elementDescription(g)},[2,new ge.Molecule.Structure(g,m)]}})})}function a(u,l,c,d){return de(this,void 0,void 0,function(){var f,h,v;return fe(this,function(p){switch(p.label){case 0:return f=tt.ofModel(l),[4,xl.buildSymmetryRange(f,c,d).runInContext(u)];case 1:return h=p.sent(),v={label:"Symmetry ["+c+"] to ["+d+"]",description:tt.elementDescription(h)},[2,new ge.Molecule.Structure(h,v)]}})})}function i(u,l,c){return de(this,void 0,void 0,function(){var d,f,h;return fe(this,function(v){switch(v.label){case 0:return d=tt.ofModel(l),[4,xl.builderSymmetryMates(d,c).runInContext(u)];case 1:return f=v.sent(),h={label:"Symmetry Mates",description:tt.elementDescription(f)},[2,new ge.Molecule.Structure(f,h)]}})})}function o(u,l,c,d){return de(this,void 0,void 0,function(){var f,h,v;return fe(this,function(p){switch(p.label){case 0:return f=tt.ofModel(l),[4,xl.buildSymmetryAssembly(f,c,d).runInContext(u)];case 1:return h=p.sent(),v={label:"Symmetry Assembly",description:tt.elementDescription(h)},[2,new ge.Molecule.Structure(h,v)]}})})}function s(u,l,c,d){return de(this,void 0,void 0,function(){var f,h,h;return fe(this,function(v){if(f=ca.Provider.get(c),!f||!d||d.name==="model")return h=tt.ofModel(c),[2,new ge.Molecule.Structure(h,{label:"Model",description:tt.elementDescription(h)})];if(d.name==="auto")return f.assemblies.length===0?(h=tt.ofModel(c),[2,new ge.Molecule.Structure(h,{label:"Model",description:tt.elementDescription(h)})]):[2,n(u,l,c)];if(d.name==="assembly")return[2,n(u,l,c,d.params.id)];if(d.name==="symmetry")return[2,a(l,c,d.params.ijkMin,d.params.ijkMax)];if(d.name==="symmetry-mates")return[2,i(l,c,d.params.radius)];if(d.name==="symmetry-assembly")return[2,o(l,c,d.params.generators,f)];throw new Error("Unknown represetation type: "+d.name)})})}e.create=s})(wp||(wp={}));var Ri;(function(e){function t(s,u,l){return s.currentStructure!==l?!1:Va.is(u)?!!s.script&&Va.areEqual(s.script,u):s.expression===u}e.isUnchanged=t;function r(s,u){var l=Va.is(u)?u:void 0,c=Va.is(u)?Va.toExpression(u):u,d=Yp(c);return{script:l,expression:c,compiled:d,originalStructure:s,currentStructure:s}}e.create=r;function n(s,u){return s.compiled(new as(u))}e.run=n;function a(s,u){var l=r(s,u);return{entry:l,selection:n(l,s)}}e.createAndRun=a;function i(s,u){return s.currentStructure=u,s.compiled(new as(u))}e.updateStructure=i;function o(s,u,l){var c=yt.unionStructure(u);s.label=""+(l||"Selection"),s.description=tt.elementDescription(c),s.data=c}e.updateStructureObject=o})(Ri||(Ri={}));var EBe=function(){return{type:T.MappedStatic("static",{static:T.Text("polymer"),expression:T.Value(ue.struct.generator.all),bundle:T.Value(en.Empty),script:T.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:T.Optional(T.Boolean(!0,{isHidden:!0})),label:T.Text("",{isHidden:!0})}};function ABe(e,t,r){r.source=e;var n=tt.Empty,a=void 0;switch(t.type.name){case"static":{var i=void 0;switch(t.type.params){case"all":i=ma.all.query,a="All";break;case"polymer":i=ma.polymer.query,a="Polymer";break;case"protein":i=ma.protein.query,a="Protein";break;case"nucleic":i=ma.nucleic.query,a="Nucleic";break;case"water":i=rn.internal.water(),a="Water";break;case"ion":i=ma.ion.query,a="Ion";break;case"lipid":i=ma.lipid.query,a="Lipid";break;case"branched":i=ma.branchedPlusConnected.query,a="Branched";break;case"ligand":i=ma.ligandPlusConnected.query,a="Ligand";break;case"non-standard":i=ma.nonStandardPolymer.query,a="Non-standard";break;case"coarse":i=ma.coarse.query,a="Coarse";break;default:throw new Error(t.type+" is a not valid complex element.")}var o=i(new as(e));n=yt.unionStructure(o);break}case"script":case"expression":{var s=Ri.createAndRun(e,t.type.params),u=s.selection,l=s.entry;r.entry=l,n=yt.unionStructure(u);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=en.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return On.Null;var c={label:""+(t.label||a||"Component"),description:tt.elementDescription(n)};return new ge.Molecule.Structure(n,c)}function PBe(e,t,r,n,a){if(r.type.name!==n.type.name)return vt.UpdateResult.Recreate;var i=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params||!tt.areEquivalent(e,a.source)?vt.UpdateResult.Recreate:t.data.model===e.model?vt.UpdateResult.Unchanged:Xt.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),vt.UpdateResult.Updated):vt.UpdateResult.Recreate;case"script":if(!Va.areEqual(r.type.params,n.type.params))return vt.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return vt.UpdateResult.Recreate;if(e===a.source)break;var o=a.entry,s=Ri.updateStructure(o,e);a.source=e,t.data=yt.unionStructure(s),Ri.updateStructureObject(t,s,n.label),i=!0;break}case"bundle":{if(e===a.source&&en.areEqual(r.type.params,n.type.params))break;a.source=e,n.type.params.hash!==e.hashCode?(i=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:tt.Empty):(i=!0,t.data=en.toStructure(n.type.params,e));break}}if(i){if(n.nullIfEmpty&&t.data.elementCount===0)return vt.UpdateResult.Null;t.description=tt.elementDescription(t.data)}return r.label!==n.label&&(i=!0,t.label=""+(n.label||t.label)),i?vt.UpdateResult.Updated:vt.UpdateResult.Unchanged}function PQ(e,t){for(var r=mt.create(e.data,t*2),n=mt.create(e.data,t*2),a=mt.create(e.data,t*2),i=mt.create(e.data,t*2),o=0;o<t;++o){It.markLine(e);var s=e.tokenStart,u=e.position;It.trim(e,s,s+10),mt.addUnchecked(r,e.tokenStart,e.tokenEnd),It.trim(e,s+10,s+20),mt.addUnchecked(n,e.tokenStart,e.tokenEnd),It.trim(e,s+20,s+30),mt.addUnchecked(a,e.tokenStart,e.tokenEnd),It.trim(e,s+31,s+34),mt.addUnchecked(i,e.tokenStart,e.tokenEnd),e.position=u}return{count:t,x:Wr(r)(me.Schema.float),y:Wr(n)(me.Schema.float),z:Wr(a)(me.Schema.float),type_symbol:Wr(i)(me.Schema.str)}}function TQ(e,t){for(var r=mt.create(e.data,t*2),n=mt.create(e.data,t*2),a=mt.create(e.data,t*2),i=0;i<t;++i){It.markLine(e);var o=e.tokenStart,s=e.position;It.trim(e,o,o+3),mt.addUnchecked(r,e.tokenStart,e.tokenEnd),It.trim(e,o+3,o+6),mt.addUnchecked(n,e.tokenStart,e.tokenEnd),It.trim(e,o+6,o+9),mt.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:Wr(r)(me.Schema.int),atomIdxB:Wr(n)(me.Schema.int),order:Wr(a)(me.Schema.int)}}function TBe(e){var t=It(e),r=It.readLine(t).trim(),n=It.readLine(t).trim(),a=It.readLine(t).trim(),i=It.readLine(t),o=+i.substr(0,3),s=+i.substr(3,3),u=PQ(t,o),l=TQ(t,s),c={title:r,program:n,comment:a,atoms:u,bonds:l};return In.success(c)}function IBe(e){var t=this;return et.create("Parse Mol",function(){return de(t,void 0,void 0,function(){return fe(this,function(r){return[2,TBe(e)]})})})}function IQ(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v,p,g,m;return fe(this,function(y){switch(y.label){case 0:return n=e.atoms,a=e.bonds,i=me.ofConst("MOL",e.atoms.count,me.Schema.str),o=me.ofConst("A",e.atoms.count,me.Schema.str),s=me.asArrayColumn(n.type_symbol),u=me.ofConst(1,n.count,me.Schema.int),l=Yr.ofPartialColumns(Ji.atom_site,{auth_asym_id:o,auth_atom_id:s,auth_comp_id:i,auth_seq_id:u,Cartn_x:me.asArrayColumn(n.x,Float32Array),Cartn_y:me.asArrayColumn(n.y,Float32Array),Cartn_z:me.asArrayColumn(n.z,Float32Array),id:me.range(0,n.count-1),label_asym_id:o,label_atom_id:s,label_comp_id:i,label_seq_id:u,label_entity_id:me.ofConst("1",n.count,me.Schema.str),occupancy:me.ofConst(1,n.count,me.Schema.float),type_symbol:s,pdbx_PDB_model_num:me.ofConst(1,n.count,me.Schema.int)},n.count),c=new yh,c.setNames([["MOL","Unknown Entity"]]),c.getEntityId("MOL",0,"A"),d=new gh(u,s),d.setNames([["MOL","Unknown Molecule"]]),d.add("MOL",0),f=vv({entity:c.getEntityTable(),chem_comp:d.getChemCompTable(),atom_site:l}),[4,fd(f,t??JM.create(e),r)];case 1:return h=y.sent(),h.frameCount>0&&(v=me.ofIntArray(me.mapToArray(a.atomIdxA,function(b){return b-1},Int32Array)),p=me.ofIntArray(me.mapToArray(a.atomIdxB,function(b){return b-1},Int32Array)),g=me.asArrayColumn(a.order,Int32Array),m=gi.fromData({pairs:{indexA:v,indexB:p,order:g},count:n.count}),gi.Provider.set(h.representative,m)),[2,h]}})})}var JM;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol"}e.is=t;function r(n){return{kind:"mol",name:n.title,data:n}}e.create=r})(JM||(JM={}));function MBe(e){return et.create("Parse MOL",function(t){return IQ(e,void 0,t)})}function DBe(e){var t=e.IT_number.value(0),r=e["name_H-M_full"].value(0);return e.IT_number.isDefined?(e["name_H-M_full"].isDefined,t):r}function RBe(e){var t=e.cell,r=e.space_group,n=DBe(r),a=Io.create(n,_.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),_.scale(_(),_.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:zu.create(a),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}function kBe(e,t,r){var n;return de(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,h,v,p,g,m,_e,y,b,S,x,C,D,w,_e,A,I,D,_e,k,R,L,H,B,j,Q,G,W,q,_e,J,he,$,X,U,z,ee,Y,Z,te,ce,be,xe,Ie,_e,ae,ie,O,V;return fe(this,function(ve){switch(ve.label){case 0:for(a=e.atom_site._rowCount,i=me.ofConst("MOL",a,me.Schema.str),o=me.ofConst("A",a,me.Schema.str),s=me.ofConst(1,a,me.Schema.int),u=RBe(e),l=u.spacegroup.cell.fromFractional,c=e.atom_site,d=c.fract_x,f=c.fract_y,h=c.fract_z,v=new Float32Array(a),p=new Float32Array(a),g=new Float32Array(a),m=_(),_e=0;_e<a;++_e)_.set(m,d.value(_e),f.value(_e),h.value(_e)),_.transformMat4(m,m,l),v[_e]=m[0],p[_e]=m[1],g[_e]=m[2];if(y=e.atom_site,b=y.type_symbol,S=y.label,b.isDefined){for(D=new Array(a),w=new Int8Array(a),_e=0;_e<a;++_e)A=b.value(_e),I=A.length,A[I-1]==="+"?(D[_e]=A.substring(0,I-2),w[_e]=parseInt(A[I-2])):A[I-2]==="+"?(D[_e]=A.substring(0,I-2),w[_e]=parseInt(A[I-1])):A[I-1]==="-"?(D[_e]=A.substring(0,I-2),w[_e]=-parseInt(A[I-2])):A[I-2]==="-"?(D[_e]=A.substring(0,I-2),w[_e]=-parseInt(A[I-1])):(D[_e]=A,w[_e]=0);x=me.ofStringArray(D),C=me.ofIntArray(w)}else{for(D=new Array(a),_e=0;_e<a;++_e)D[_e]=k3(S.value(_e));x=me.ofStringArray(D),C=me.Undefined(a,me.Schema.int)}return k=Yr.ofPartialColumns(Ji.atom_site,{auth_asym_id:o,auth_atom_id:S,auth_comp_id:i,auth_seq_id:s,Cartn_x:me.ofFloatArray(v),Cartn_y:me.ofFloatArray(p),Cartn_z:me.ofFloatArray(g),id:me.range(0,a-1),label_asym_id:o,label_atom_id:S,label_comp_id:i,label_seq_id:s,label_entity_id:me.ofConst("1",a,me.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:me.ofConst(1,a,me.Schema.float),type_symbol:x,pdbx_formal_charge:C,pdbx_PDB_model_num:me.ofConst(1,a,me.Schema.int),B_iso_or_equiv:e.atom_site.U_iso_or_equiv},a),R=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),L=new yh,L.setNames([["MOL",R||"Unknown Entity"]]),L.getEntityId("MOL",0,"A"),H=new gh(s,e.atom_site.type_symbol),H.setNames([["MOL",R||"Unknown Molecule"]]),H.add("MOL",0),B=vv({entity:L.getEntityTable(),chem_comp:H.getChemCompTable(),atom_site:k}),[4,fd(B,t,r)];case 1:if(j=ve.sent(),j.frameCount>0&&(Q=j.representative,ca.Provider.set(Q,u),G=e.geom_bond._rowCount,G>0)){for(W={},q=e.atom_site.label,_e=0,J=q.rowCount;_e<J;++_e)W[q.value(_e)]=_e;for(he=(n=t.data.frame.categories.ccdc_geom_bond_type)===null||n===void 0?void 0:n.getField(""),$=[],X=[],U=[],z=[],ee=[],Y=new Set,Z=0,te=e.geom_bond,ce=te.atom_site_label_1,be=te.atom_site_label_2,xe=te.valence,Ie=te.distance,_e=0;_e<G;++_e)ae=W[ce.value(_e)],ie=W[be.value(_e)],O=ae<ie?Uf(ae,ie):Uf(ie,ae),!Y.has(O)&&(Y.add(O),$[Z]=ae,X[Z]=ie,z[Z]=Ie.value(_e)||-1,he?(V=he.str(_e),V==="D"?(U[Z]=2,ee[Z]=1):V==="A"?(U[Z]=1,ee[Z]=17):(U[Z]=1,ee[Z]=1)):(ee[Z]=1,U[Z]=xe.isDefined?xe.value(_e):1),Z+=1);gi.Provider.set(Q,gi.fromData({pairs:{indexA:me.ofIntArray($),indexB:me.ofIntArray(X),order:me.ofIntArray(U),distance:me.ofFloatArray(z),flag:me.ofIntArray(ee)},count:a}))}return[2,j]}})})}function OBe(e){if(ib.is(e.sourceData)){var t=e.sourceData.data.db,r=t.atom_site,n=t.atom_site_aniso,a=Yr.ofPartialColumns(Rl.Schema,{U:n.U,U_esd:n.U_su},n._rowCount),i=Rl.getElementToAnsiotropFromLabel(r.label,n.label);return{data:a,elementToAnsiotrop:i}}}function LBe(e){return ib.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.U.isDefined:!1}Rl.Provider.formatRegistry.add("cifCore",OBe,LBe);var ib;(function(e){function t(n){return(n==null?void 0:n.kind)==="cifCore"}e.is=t;function r(n,a){a||(a=Xc.schema.cifCore(n));var i=a.database_code.depnum_ccdc_archive.value(0)||a.database_code.depnum_ccdc_fiz.value(0)||a.database_code.ICSD.value(0)||a.database_code.MDF.value(0)||a.database_code.NBS.value(0)||a.database_code.CSD.value(0)||a.database_code.COD.value(0)||a._name;return{kind:"cifCore",name:i,data:{db:a,frame:n}}}e.fromFrame=r})(ib||(ib={}));function NBe(e){var t=ib.fromFrame(e);return et.create("Parse CIF Core",function(r){return kBe(t.data.db,t,r)})}function FBe(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c;return fe(this,function(d){switch(d.label){case 0:return r=e.atoms,n=me.ofConst("MOL",e.atoms.count,me.Schema.str),a=me.ofConst("A",e.atoms.count,me.Schema.str),i=me.ofArray({array:me.mapToArray(r.number,function(f){return dPe(f)}),schema:me.Schema.Aliased(me.Schema.str)}),o=me.ofConst(1,r.count,me.Schema.int),s=Yr.ofPartialColumns(Ji.atom_site,{auth_asym_id:a,auth_atom_id:i,auth_comp_id:n,auth_seq_id:o,Cartn_x:me.asArrayColumn(r.x,Float32Array),Cartn_y:me.asArrayColumn(r.y,Float32Array),Cartn_z:me.asArrayColumn(r.z,Float32Array),id:me.range(0,r.count-1),label_asym_id:a,label_atom_id:i,label_comp_id:n,label_seq_id:o,label_entity_id:me.ofConst("1",r.count,me.Schema.str),occupancy:me.ofConst(1,r.count,me.Schema.float),type_symbol:i,pdbx_PDB_model_num:me.ofConst(1,r.count,me.Schema.int)},r.count),u=new yh,u.setNames([["MOL","Unknown Entity"]]),u.getEntityId("MOL",0,"A"),l=new gh(o,i),l.setNames([["MOL","Unknown Molecule"]]),l.add("MOL",0),c=vv({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:s}),[4,fd(c,eD.create(e),t)];case 1:return[2,d.sent()]}})})}var eD;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.header.comment1,data:n}}e.create=r})(eD||(eD={}));function BBe(e){return et.create("Parse Cube",function(t){return FBe(e,t)})}var aO=It.skipWhitespace,MQ=It.eatValue,ul=It.markLine,ll=It.getTokenString,DQ=It.readLine;function UBe(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function jBe(e,t){return{tokenizer:e,molecule:UBe(),runtimeCtx:t}}var zBe=/\s+/g;function VBe(e){for(var t=e.tokenizer,r=e.molecule;ll(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)ul(t);ul(t),r.mol_name=ll(t),ul(t);var n=ll(t).trim().split(zBe);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),ul(t);var a=ll(t);if(!a.startsWith("@<TRIPOS>")){r.mol_type=a,ul(t);var i=ll(t);if(!i.startsWith("@<TRIPOS>")){r.charge_type=i,ul(t);var o=ll(t);if(!o.startsWith("@<TRIPOS>")){r.status_bits=o,ul(t);var s=ll(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}}}}function HBe(e){return de(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C,w;return fe(this,function(A){switch(A.label){case 0:for(t=e.tokenizer,r=e.molecule;ll(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)ul(t);return n=t.position,a=t.lineNumber,i=DQ(t),o=i.trim().split(/\s+/g),s=o.length,u=mt.create(t.data,r.num_atoms*2),l=mt.create(t.data,r.num_atoms*2),c=mt.create(t.data,r.num_atoms*2),d=mt.create(t.data,r.num_atoms*2),f=mt.create(t.data,r.num_atoms*2),h=mt.create(t.data,r.num_atoms*2),v=mt.create(t.data,r.num_atoms*2),p=mt.create(t.data,r.num_atoms*2),g=mt.create(t.data,r.num_atoms*2),m=mt.create(t.data,r.num_atoms*2),y=me.Undefined(r.num_atoms,me.Schema.float),b=me.Undefined(r.num_atoms,me.Schema.int),S=me.Undefined(r.num_atoms,me.Schema.str),t.position=n,t.lineNumber=a,x=t.length,C=0,[4,qc(e.runtimeCtx,1e5,void 0,function(I){for(var D=Math.min(r.num_atoms-C,I),k=0;k<D;k++)for(var R=0;R<s;R++)switch(aO(t),t.tokenStart=t.position,MQ(t),R){case 0:mt.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:mt.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:mt.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:mt.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:mt.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 5:mt.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 6:mt.addUnchecked(v,t.tokenStart,t.tokenEnd);break;case 7:mt.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 8:mt.addUnchecked(g,t.tokenStart,t.tokenEnd);break;case 9:mt.addUnchecked(m,t.tokenStart,t.tokenEnd);break}return C+=D,D},function(I){return I.update({message:"Parsing...",current:t.position,max:x})})];case 1:return A.sent(),w={count:r.num_atoms,atom_id:Wr(u)(me.Schema.int),atom_name:Wr(l)(me.Schema.str),x:Wr(c)(me.Schema.float),y:Wr(d)(me.Schema.float),z:Wr(f)(me.Schema.float),atom_type:s>5?Wr(h)(me.Schema.str):S,subst_id:s>6?Wr(v)(me.Schema.int):b,subst_name:s>7?Wr(p)(me.Schema.str):S,charge:s>8?Wr(g)(me.Schema.float):y,status_bit:s>9?Wr(m)(me.Schema.str):S},[2,w]}})})}function GBe(e){return de(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,h,v,p;return fe(this,function(g){switch(g.label){case 0:for(t=e.tokenizer,r=e.molecule;ll(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)ul(t);return n=t.position,a=t.lineNumber,i=DQ(t),o=i.trim().split(/\s+/g),s=o.length,u=mt.create(t.data,r.num_bonds*2),l=mt.create(t.data,r.num_bonds*2),c=mt.create(t.data,r.num_bonds*2),d=mt.create(t.data,r.num_bonds*2),f=mt.create(t.data,r.num_bonds*2),t.position=n,t.lineNumber=a,h=t.length,v=0,[4,qc(e.runtimeCtx,1e5,void 0,function(m){for(var y=Math.min(r.num_bonds-v,m),b=0;b<y;b++)for(var S=0;S<s;S++)switch(aO(t),t.tokenStart=t.position,MQ(t),S){case 0:mt.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:mt.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:mt.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:mt.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:mt.addUnchecked(f,t.tokenStart,t.tokenEnd);break}return v+=y,y},function(m){return m.update({message:"Parsing...",current:t.position,max:h})})];case 1:return g.sent(),p={count:r.num_bonds,bond_id:Wr(u)(me.Schema.int),origin_atom_id:Wr(l)(me.Schema.int),target_atom_id:Wr(c)(me.Schema.int),bond_type:Wr(d)(me.Schema.str),status_bits:s>4?Wr(f)(me.Schema.str):me.Undefined(r.num_bonds,me.Schema.str)},[2,p]}})})}function qBe(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u;return fe(this,function(l){switch(l.label){case 0:n=It(t),e.update({message:"Parsing...",current:0,max:t.length}),a=[],l.label=1;case 1:return n.position<t.length?(i=jBe(n,e),VBe(i),[4,HBe(i)]):[3,4];case 2:return o=l.sent(),[4,GBe(i)];case 3:for(s=l.sent(),a.push({molecule:i.molecule,atoms:o,bonds:s}),aO(n);ll(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)ul(n);return[3,1];case 4:return u={name:r,structures:a},[2,In.success(u)]}})})}function WBe(e,t){var r=this;return et.create("Parse MOL2",function(n){return de(r,void 0,void 0,function(){return fe(this,function(a){switch(a.label){case 0:return[4,qBe(n,e,t)];case 1:return[2,a.sent()]}})})})}function $Be(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C,w,A;return fe(this,function(I){switch(I.label){case 0:r=[],n=0,a=e.structures.length,I.label=1;case 1:if(!(n<a))return[3,4];for(i=e.structures[n],o=i.atoms,s=i.bonds,u=i.molecule,l=me.ofConst("A",o.count,me.Schema.str),c=new Array(o.count),d=0;d<o.count;++d)c[d]=k3(o.atom_name.value(d));for(f=Yr.ofPartialColumns(Ji.atom_site,{auth_asym_id:l,auth_atom_id:me.asArrayColumn(o.atom_name),auth_comp_id:o.subst_name,auth_seq_id:o.subst_id,Cartn_x:me.asArrayColumn(o.x,Float32Array),Cartn_y:me.asArrayColumn(o.y,Float32Array),Cartn_z:me.asArrayColumn(o.z,Float32Array),id:me.asArrayColumn(o.atom_id),label_asym_id:l,label_atom_id:me.asArrayColumn(o.atom_name),label_comp_id:o.subst_name,label_seq_id:o.subst_id,label_entity_id:me.ofConst("1",o.count,me.Schema.str),occupancy:me.ofConst(1,o.count,me.Schema.float),type_symbol:me.ofStringArray(c),pdbx_PDB_model_num:me.ofConst(n,o.count,me.Schema.int)},o.count),h=new yh,h.setNames([["MOL",u.mol_name||"Unknown Entity"]]),h.getEntityId("MOL",0,"A"),v=new gh(o.subst_id,o.atom_name),p=0,g=o.subst_name.rowCount;p<g;++p)v.add(o.subst_name.value(p),p);return m=vv({entity:h.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:f}),[4,fd(m,tD.create(e),t)];case 2:y=I.sent(),y.frameCount>0&&(b=me.ofIntArray(me.mapToArray(s.origin_atom_id,function(D){return D-1},Int32Array)),S=me.ofIntArray(me.mapToArray(s.target_atom_id,function(D){return D-1},Int32Array)),x=me.ofIntArray(me.mapToArray(s.bond_type,function(D){switch(D){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(D)}},Int8Array)),C=me.ofIntArray(me.mapToArray(s.bond_type,function(D){switch(D){case"ar":return 17;case"du":case"nc":return 0;case"am":case"un":default:return 1}},Int8Array)),w=gi.fromData({pairs:{indexA:b,indexB:S,order:x,flag:C},count:o.count}),A=y.representative,gi.Provider.set(A,w),Mg.Provider.set(A,{data:o.charge,type:u.charge_type}),r.push(A)),I.label=3;case 3:return++n,[3,1];case 4:return[2,new $p(r)]}})})}var tD;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol2"}e.is=t;function r(n){return{kind:"mol2",name:n.name,data:n}}e.create=r})(tD||(tD={}));function XBe(e){return et.create("Parse MOL2",function(t){return $Be(e,t)})}var $v=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),GP=9,go;(function(e){function t(c){for(var d=1,f=0;c>=d&&f<32;)f++,d<<=1;return f}e.sizeOfInt=t;var r=new Uint8Array(32);function n(c,d){var f=1,h=0;r[0]=1;for(var v=0;v<c;v++){var p=void 0,g=0;for(p=0;p<f;p++)g+=r[p]*d[v],r[p]=g&255,g>>=8;for(;g!==0;)r[p++]=g&255,g>>=8;f=p}var m=1;for(f--;r[f]>=m;)h++,m*=2;return h+f*8}e.sizeOfInts=n;var a=new ArrayBuffer(8*3);e.buf=new Int32Array(a);var i=new Uint32Array(a);function o(c,d,f){for(var h=f,v=(1<<h)-1,p=i[1],g=i[2],m=e.buf[0],y=0;h>=8;)g=g<<8|c[d+m++],y|=g>>p<<h-8,h-=8;return h>0&&(p<h&&(p+=8,g=g<<8|c[d+m++]),p-=h,y|=g>>p&(1<<h)-1),y&=v,e.buf[0]=m,e.buf[1]=p,e.buf[2]=g,y}e.decodeBits=o;function s(c,d){var f=i[2],h=e.buf[0];return f=f<<8|c[d+h],e.buf[0]=h+1,e.buf[2]=f,f>>i[1]&255}var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(c,d,f,h,v){var p=f,g=0;for(u[0]=0,u[1]=0,u[2]=0,u[3]=0;p>8;)u[g++]=s(c,d),p-=8;p>0&&(u[g++]=o(c,d,p));for(var m=2;m>0;m--){for(var y=0,b=h[m],S=g-1;S>=0;S--){y=y<<8|u[S];var x=y/b|0;u[S]=x,y=y-x*b}v[m]=y}v[0]=u[0]|u[1]<<8|u[2]<<16|u[3]<<24}e.decodeInts=l})(go||(go={}));function YBe(){throw new Error("(xdrfile error) Undefined error.")}function KBe(e,t){return de(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,h,v,p,g,m,L,L,y,b,S,x,C,w,A,I,D,k,R,L,H,B,j,Q,G;return fe(this,function(W){switch(W.label){case 0:r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},a=n.frames,i=n.boxes,o=n.times,s=[0,0,0,0,0,0],u=[0,0,0],l=[0,0,0],c=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1],h=0,v=go.buf,W.label=1;case 1:for(p=void 0,g=r.getInt32(h+4),h+=12,o.push(r.getFloat32(h)),h+=4,m=new Float32Array(9),L=0;L<9;++L)m[L]=r.getFloat32(h)*10,h+=4;if(i.push(m),g<=9)for(p={count:g/3,x:new Float32Array(g/3),y:new Float32Array(g/3),z:new Float32Array(g/3)},L=0;L<g/3;++L)p.x[L]=r.getFloat32(h),p.y[L]=r.getFloat32(h),p.z[L]=r.getFloat32(h),h+=4;else{for(v[0]=v[1]=v[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,p={count:g,x:new Float32Array(g),y:new Float32Array(g),z:new Float32Array(g)},y=0,b=r.getInt32(h),h+=4,S=r.getFloat32(h),h+=4,s[0]=r.getInt32(h),s[1]=r.getInt32(h+4),s[2]=r.getInt32(h+8),s[3]=r.getInt32(h+12),s[4]=r.getInt32(h+16),s[5]=r.getInt32(h+20),u[0]=s[3]-s[0]+1,u[1]=s[4]-s[1]+1,u[2]=s[5]-s[2]+1,h+=24,x=void 0,(u[0]|u[1]|u[2])>16777215?(l[0]=go.sizeOfInt(u[0]),l[1]=go.sizeOfInt(u[1]),l[2]=go.sizeOfInt(u[2]),x=0):x=go.sizeOfInts(3,u),C=r.getInt32(h),h+=4,w=C-1,w=GP>w?GP:w,A=$v[w]/2|0,I=$v[C]/2|0,c[0]=c[1]=c[2]=$v[C],D=Math.ceil(r.getInt32(h)/4)*4,h+=4,k=1/S,R=0,L=0,d[0]=d[1]=d[2]=0;L<b;){if(x===0?(d[0]=go.decodeBits(t,h,l[0]),d[1]=go.decodeBits(t,h,l[1]),d[2]=go.decodeBits(t,h,l[2])):go.decodeInts(t,h,x,u,d),L++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],f[0]=d[0],f[1]=d[1],f[2]=d[2],H=go.decodeBits(t,h,1),B=0,H===1&&(R=go.decodeBits(t,h,5),B=R%3,R-=B,B--),R>0)for(d[0]=d[1]=d[2]=0,j=0;j<R;j+=3)go.decodeInts(t,h,C,c,d),L++,d[0]+=f[0]-I,d[1]+=f[1]-I,d[2]+=f[2]-I,j===0?(Q=d[0],d[0]=f[0],f[0]=Q,Q=d[1],d[1]=f[1],f[1]=Q,Q=d[2],d[2]=f[2],f[2]=Q,p.x[y]=f[0]*k,p.y[y]=f[1]*k,p.z[y]=f[2]*k,y++):(f[0]=d[0],f[1]=d[1],f[2]=d[2]),p.x[y]=d[0]*k,p.y[y]=d[1]*k,p.z[y]=d[2]*k,y++;else p.x[y]=d[0]*k,p.y[y]=d[1]*k,p.z[y]=d[2]*k,y++;C+=B,B<0?(I=A,C>GP?A=$v[C-1]/2|0:A=0):B>0&&(A=I,I=$v[C]/2|0),c[0]=c[1]=c[2]=$v[C],(c[0]===0||c[1]===0||c[2]===0)&&YBe()}h+=D}for(G=0;G<g;G++)p.x[G]*=10,p.y[G]*=10,p.z[G]*=10;return a.push(p),e.shouldUpdate?[4,e.update({current:h,max:t.length})]:[3,3];case 2:W.sent(),W.label=3;case 3:return h>=t.length?[3,4]:[3,1];case 4:return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),[2,n]}})})}function QBe(e){var t=this;return et.create("Parse XTC",function(r){return de(t,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,KBe(r,e)];case 1:return n=i.sent(),[2,In.success(n)];case 2:return a=i.sent(),[2,In.error(""+a)];case 3:return[2]}})})})}function ZBe(e){var t=this;return et.create("Parse XTC",function(r){return de(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=ff(e.deltaTime,"step"),a=ff(e.timeOffset,n.unit),i=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],l=_.fromArray(_(),u,0),c=_.fromArray(_(),u,3),d=_.fromArray(_(),u,6),i.push({elementCount:e.frames[o].count,cell:_p.fromBasis(l,c,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:ff(a.value+n.value*o,n.unit)});return[2,X1.create(i,n,a)]}})})})}function JBe(e){var t=e.position>=e.data.length-1?0:+It.readLine(e);isNaN(t)&&(t=0);for(var r=It.readLine(e),n=new Float64Array(t),a=new Float64Array(t),i=new Float64Array(t),o=new Array(t),s=0;s<t;++s){var u=It.readLineTrim(e),l=u.split(/\s+/g);o[s]=l[0],n[s]=+l[1],a[s]=+l[2],i[s]=+l[3]}return{count:t,comment:r,x:me.ofFloatArray(n),y:me.ofFloatArray(a),z:me.ofFloatArray(i),type_symbol:me.ofStringArray(o)}}function e8e(e){for(var t=It(e),r=[];;){var n=JBe(t);if(n.count===0)break;r.push(n)}var a={molecules:r};return In.success(a)}function t8e(e){var t=this;return et.create("Parse Mol",function(){return de(t,void 0,void 0,function(){return fe(this,function(r){return[2,e8e(e)]})})})}function r8e(e,t){for(var r=e.molecules,n=0,a=0,i=r;a<i.length;a++){var o=i[a];n+=o.count}for(var s=new Array(n),u=new Int32Array(n),l=new Float32Array(n),c=new Float32Array(n),d=new Float32Array(n),f=new Int32Array(n),h=0,v=0;v<r.length;v++)for(var o=r[v],p=0;p<o.count;p++)s[h]=o.type_symbol.value(p),l[h]=o.x.value(p),c[h]=o.y.value(p),d[h]=o.z.value(p),u[h]=p,f[h]=v,h++;var g=me.ofConst("MOL",n,me.Schema.str),m=me.ofConst("A",n,me.Schema.str),y=me.ofConst(1,n,me.Schema.int),b=me.ofStringArray(s),S=Yr.ofPartialColumns(Ji.atom_site,{auth_asym_id:m,auth_atom_id:b,auth_comp_id:g,auth_seq_id:y,Cartn_x:me.ofFloatArray(l),Cartn_y:me.ofFloatArray(c),Cartn_z:me.ofFloatArray(d),id:me.ofIntArray(u),label_asym_id:m,label_atom_id:b,label_comp_id:g,label_seq_id:y,label_entity_id:me.ofConst("1",n,me.Schema.str),occupancy:me.ofConst(1,n,me.Schema.float),type_symbol:b,pdbx_PDB_model_num:me.ofIntArray(f)},n),x=new yh;x.setNames([["MOL","Unknown Entity"]]),x.getEntityId("MOL",0,"A");var C=new gh(y,b);C.setNames([["MOL","Unknown Molecule"]]),C.add("MOL",0);var w=vv({entity:x.getEntityTable(),chem_comp:C.getChemCompTable(),atom_site:S});return fd(w,rD.create(e),t)}var rD;(function(e){function t(n){return(n==null?void 0:n.kind)==="xyz"}e.is=t;function r(n){return{kind:"xyz",name:"xyz",data:n}}e.create=r})(rD||(rD={}));function n8e(e){return et.create("Parse XYZ",function(t){return r8e(e,t)})}var nD="$$$$";function a8e(e){for(var t=mt.create(e.data,32),r=mt.create(e.data,32);e.position<e.length;){var n=It.readLine(e);if(n.startsWith(nD))break;if(n&&n.startsWith("> ")){mt.add(t,e.tokenStart+2,e.tokenEnd),It.markLine(e);for(var a=e.tokenStart,i=e.tokenEnd,o=!1;e.position<e.length;){var s=It.readLine(e);if(!s||s.startsWith(nD)||s.startsWith("> ")){mt.add(r,a,i),o=!0;break}i=e.tokenEnd}o||mt.add(r,a,i)}}return{dataHeader:Wr(t)(me.Schema.str),data:Wr(r)(me.Schema.str)}}function i8e(e){var t=It.readLine(e).trim(),r=It.readLine(e).trim(),n=It.readLine(e).trim(),a=It.readLine(e),i=+a.substr(0,3),o=+a.substr(3,3);if(Number.isNaN(i)||Number.isNaN(o)){for(;e.position<e.length;){var s=It.readLine(e);if(s.startsWith(nD))break}return}var u=PQ(e,i),l=TQ(e,o),c=a8e(e);return{molFile:{title:t,program:r,comment:n,atoms:u,bonds:l},dataItems:c}}function o8e(e){for(var t=It(e),r=[];t.position<t.length;){var n=i8e(t);n&&r.push(n)}return In.success({compounds:r})}function s8e(e){var t=this;return et.create("Parse Sdf",function(){return de(t,void 0,void 0,function(){return fe(this,function(r){return[2,o8e(e)]})})})}var aD;(function(e){function t(n){return(n==null?void 0:n.kind)==="sdf"}e.is=t;function r(n){return{kind:"sdf",name:n.molFile.title,data:n}}e.create=r})(aD||(aD={}));function u8e(e){return et.create("Parse SDF",function(t){return IQ(e.molFile,aD.create(e),t)})}var l8e=kt.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[ge.Data.Binary],to:ge.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return et.create("Parse DCD",function(n){return de(t,void 0,void 0,function(){var a,i;return fe(this,function(o){switch(o.label){case 0:return[4,Ake(r.data).runInContext(n)];case 1:if(a=o.sent(),a.isError)throw new Error(a.message);return[4,U6e(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ge.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),c8e=kt.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[ge.Data.Binary],to:ge.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return et.create("Parse XTC",function(n){return de(t,void 0,void 0,function(){var a,i;return fe(this,function(o){switch(o.label){case 0:return[4,QBe(r.data).runInContext(n)];case 1:if(a=o.sent(),a.isError)throw new Error(a.message);return[4,ZBe(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ge.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),d8e=kt.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Parse PSF string data."},from:[ge.Format.Psf],to:ge.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return et.create("Create Topology",function(n){return de(t,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,hBe(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new ge.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}});function f8e(e,t,r){return de(this,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return t.type!==ge.Molecule.Topology.type?[3,2]:(n=t.data,[4,Xt.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)]);case 1:return[2,i.sent()];case 2:if(t.type===ge.Molecule.Model.type)return a=t.data,[2,Xt.trajectoryFromModelAndCoordinates(a,r)];i.label=3;case 3:throw new Error("no model/topology found")}})})}var RQ=kt.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:ge.Root,to:ge.Molecule.Trajectory,params:{modelRef:T.Text("",{isHidden:!0}),coordinatesRef:T.Text("",{isHidden:!0})}})({apply:function(e){var t=this,r=e.params,n=e.dependencies;return et.create("Create trajectory from model/topology and coordinates",function(a){return de(t,void 0,void 0,function(){var i,o,s;return fe(this,function(u){switch(u.label){case 0:return i=n[r.coordinatesRef].data,[4,f8e(a,n[r.modelRef],i)];case 1:return o=u.sent(),s={label:"Trajectory",description:o.frameCount+" model"+(o.frameCount===1?"":"s")},[2,new ge.Molecule.Trajectory(o,s)]}})})})}}),h8e=kt.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:ge.Format.Blob,to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return et.create("Parse Format Blob",function(n){return de(t,void 0,void 0,function(){var a,i,o,s,u,l,d,c,d,f;return fe(this,function(h){switch(h.label){case 0:a=[],i=0,o=r.data,h.label=1;case 1:return i<o.length?(s=o[i],s.kind!=="cif"?[3,6]:(u=s.data.blocks[0],[4,iK(u).runInContext(n)])):[3,7];case 2:if(l=h.sent(),l.frameCount===0)throw new Error("No models found.");d=0,h.label=3;case 3:return d<l.frameCount?[4,et.resolveInContext(l.getFrameAtIndex(d),n)]:[3,6];case 4:c=h.sent(),a.push(c),h.label=5;case 5:return d++,[3,3];case 6:return i++,[3,1];case 7:for(d=0;d<a.length;d++)Xt.TrajectoryInfo.set(a[d],{index:d,size:a.length});return f={label:"Trajectory",description:a.length+" model"+(a.length===1?"":"s")},[2,new ge.Molecule.Trajectory(new $p(a),f)]}})})})}});function wd(e){var t=e.representative;return{label:""+t.entry,description:e.frameCount+" model"+(e.frameCount===1?"":"s")}}var p8e=kt.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:T.Optional(T.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:T.Optional(T.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return et.create("Parse mmCIF",function(a){return de(t,void 0,void 0,function(){var i,o,s,u;return fe(this,function(l){switch(l.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===i}),!o)throw new Error("Data block '"+[i]+"' not found.");return[4,iK(o).runInContext(a)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=wd(s),[2,new ge.Molecule.Trajectory(s,u)]}})})})}}),v8e=kt.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory,params:{isPdbqt:T.Boolean(!1)}})({apply:function(e){var t=this,r=e.a,n=e.params;return et.create("Parse PDB",function(a){return de(t,void 0,void 0,function(){var i,o,s;return fe(this,function(u){switch(u.label){case 0:return[4,Fke(r.data,r.label,n.isPdbqt).runInContext(a)];case 1:if(i=u.sent(),i.isError)throw new Error(i.message);return[4,dBe(i.result).runInContext(a)];case 2:return o=u.sent(),s=wd(o),[2,new ge.Molecule.Trajectory(o,s)]}})})})}}),m8e=kt.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return et.create("Parse GRO",function(n){return de(t,void 0,void 0,function(){var a,i,o;return fe(this,function(s){switch(s.label){case 0:return[4,Nke(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,$6e(a.result).runInContext(n)];case 2:return i=s.sent(),o=wd(i),[2,new ge.Molecule.Trajectory(i,o)]}})})})}}),g8e=kt.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return et.create("Parse XYZ",function(n){return de(t,void 0,void 0,function(){var a,i,o;return fe(this,function(s){switch(s.label){case 0:return[4,t8e(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,n8e(a.result).runInContext(n)];case 2:return i=s.sent(),o=wd(i),[2,new ge.Molecule.Trajectory(i,o)]}})})})}}),y8e=kt.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return et.create("Parse MOL",function(n){return de(t,void 0,void 0,function(){var a,i,o;return fe(this,function(s){switch(s.label){case 0:return[4,IBe(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,MBe(a.result).runInContext(n)];case 2:return i=s.sent(),o=wd(i),[2,new ge.Molecule.Trajectory(i,o)]}})})})}}),b8e=kt.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return et.create("Parse SDF",function(n){return de(t,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:return[4,s8e(r.data).runInContext(n)];case 1:if(a=p.sent(),a.isError)throw new Error(a.message);i=[],o=0,s=a.result.compounds,p.label=2;case 2:return o<s.length?(u=s[o],[4,u8e(u).runInContext(n)]):[3,8];case 3:l=p.sent(),c=0,p.label=4;case 4:return c<l.frameCount?(f=(d=i).push,[4,et.resolveInContext(l.getFrameAtIndex(c),n)]):[3,7];case 5:f.apply(d,[p.sent()]),p.label=6;case 6:return c++,[3,4];case 7:return o++,[3,2];case 8:return h=new $p(i),v=wd(h),[2,new ge.Molecule.Trajectory(h,v)]}})})})}}),x8e=kt.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return et.create("Parse MOL2",function(n){return de(t,void 0,void 0,function(){var a,i,o;return fe(this,function(s){switch(s.label){case 0:return[4,WBe(r.data,r.label).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,XBe(a.result).runInContext(n)];case 2:return i=s.sent(),o=wd(i),[2,new ge.Molecule.Trajectory(i,o)]}})})})}}),S8e=kt.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:ge.Format.Cube,to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return et.create("Parse MOL",function(n){return de(t,void 0,void 0,function(){var a,i;return fe(this,function(o){switch(o.label){case 0:return[4,BBe(r.data).runInContext(n)];case 1:return a=o.sent(),i=wd(a),[2,new ge.Molecule.Trajectory(a,i)]}})})})}}),C8e=kt.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:T.Optional(T.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:T.Optional(T.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return et.create("Parse CIF Core",function(a){return de(t,void 0,void 0,function(){var i,o,s,u;return fe(this,function(l){switch(l.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===i}),!o)throw new Error("Data block '"+[i]+"' not found.");return[4,NBe(o).runInContext(a)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=wd(s),[2,new ge.Molecule.Trajectory(s,u)]}})})})}}),_8e=function(e){return e+1},w8e=function(e){return e-1},E8e=kt.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:ge.Molecule.Trajectory,to:ge.Molecule.Model,params:function(e){return e?{modelIndex:T.Converted(_8e,w8e,T.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:T.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}}})({isApplicable:function(e){return e.data.frameCount>0},apply:function(e){var t=this,r=e.a,n=e.params;return et.create("Model from Trajectory",function(a){return de(t,void 0,void 0,function(){var i,o,s,u;return fe(this,function(l){switch(l.label){case 0:return i=n.modelIndex%r.data.frameCount,i<0&&(i+=r.data.frameCount),[4,et.resolveInContext(r.data.getFrameAtIndex(i),a)];case 1:return o=l.sent(),s="Model "+(i+1),u=r.data.frameCount===1?void 0:"of "+r.data.frameCount,[2,new ge.Molecule.Model(o,{label:s,description:u})]}})})})},interpolate:function(e,t,r){var n=r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r);return{modelIndex:n}},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),A8e=kt.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:ge.Molecule.Trajectory,to:ge.Molecule.Structure})({apply:function(e){var t=this,r=e.a;return et.create("Build Structure",function(n){return de(t,void 0,void 0,function(){var a,i;return fe(this,function(o){switch(o.label){case 0:return[4,tt.ofTrajectory(r.data,n)];case 1:return a=o.sent(),i={label:"Ensemble",description:tt.elementDescription(a)},[2,new ge.Molecule.Structure(a,i)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),P8e=kt.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:ge.Molecule.Model,to:ge.Molecule.Structure,params:function(e){return wp.getParams(e&&e.data)}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return wp.canAutoUpdate(t.type,r.type)},apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Build Structure",function(i){return de(r,void 0,void 0,function(){return fe(this,function(o){return[2,wp.create(t,i,n.data,a&&a.type)]})})})},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams;return zc(n,a)?r.data.model===t.data?vt.UpdateResult.Unchanged:Xt.areHierarchiesEqual(t.data,r.data.model)?(r.data=r.data.remapModel(t.data),vt.UpdateResult.Updated):vt.UpdateResult.Recreate:vt.UpdateResult.Recreate},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),i9=_(),o9=le(),s9=le(),T8e=kt.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:{transform:T.MappedStatic("components",{components:T.Group({axis:T.Vec3(_.create(1,0,0)),angle:T.Numeric(0,{min:-180,max:180,step:.1}),translation:T.Vec3(_.create(0,0,0))},{isFlat:!0}),matrix:T.Group({data:T.Mat4(le.identity()),transpose:T.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:function(e){var t=e.newParams;return t.transform.name!=="matrix"},apply:function(e){var t=e.a,r=e.params,n=le();if(r.transform.name==="components"){var a=r.transform.params,i=a.axis,o=a.angle,s=a.translation,u=t.data.boundary.sphere.center;le.fromTranslation(o9,_.negate(i9,u)),le.fromTranslation(s9,_.add(i9,u,s));var l=le.fromRotation(le(),Math.PI/180*o,_.normalize(_(),i));le.mul3(n,s9,l,o9)}else r.transform.name==="matrix"&&(le.copy(n,r.transform.params.data),r.transform.params.transpose&&le.transpose(n,n));var c=tt.transform(t.data,n);return new ge.Molecule.Structure(c,{label:t.label,description:t.description+" [Transformed]"})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),I8e=kt.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{expression:T.Value(ue.struct.generator.all,{isHidden:!0}),label:T.Optional(T.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,a=Ri.createAndRun(t.data,r.expression),i=a.selection,o=a.entry;if(n.entry=o,yt.isEmpty(i))return On.Null;var s=yt.unionStructure(i),u={label:""+(r.label||"Selection"),description:tt.elementDescription(s)};return new ge.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(n.expression!==a.expression)return vt.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return vt.UpdateResult.Unchanged;var s=Ri.updateStructure(o,t.data);return yt.isEmpty(s)?vt.UpdateResult.Null:(Ri.updateStructureObject(r,s,a.label),vt.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),M8e=kt.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:ge.Root,to:ge.Molecule.Structure.Selections,params:function(){return{selections:T.ObjectList({key:T.Text(void 0,{description:"A unique key."}),ref:T.Text(),groupId:T.Optional(T.Text()),expression:T.Value(ue.struct.generator.empty)},function(e){return e.ref},{isHidden:!0}),isTransitive:T.Optional(T.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:T.Optional(T.Text("",{isHidden:!0}))}}})({apply:function(e){for(var t=e.params,r=e.cache,n=e.dependencies,a=new Map,i=[],o=0,s=0,u=t.selections;s<u.length;s++){var l=u[s],c=Ri.createAndRun(n[l.ref].data,l.expression),d=c.selection,f=c.entry;a.set(l.key,f);var h=yt.toLociWithSourceUnits(d);i.push({key:l.key,loci:h,groupId:l.groupId}),o+=Oe.size(h)}r.entries=a;var v={label:""+(t.label||"Multi-selection"),description:t.selections.length+" source(s), "+o+" element(s) total"};return new ge.Molecule.Structure.Selections(i,v)},update:function(e){var t=e.b,r=e.oldParams,n=e.newParams,a=e.cache,i=e.dependencies;if(!!r.isTransitive!=!!n.isTransitive)return vt.UpdateResult.Recreate;for(var o=a.entries,s=new Map,u=new Map,l=0,c=t.data;l<c.length;l++){var d=c[l];u.set(d.key,d)}for(var f=!1,h=0,v=[],p=0,g=n.selections;p<g.length;p++){var m=g[p],y=i[m.ref].data,b=!1;if(o.has(m.key)){var S=o.get(m.key);if(Ri.isUnchanged(S,m.expression,y)&&u.has(m.key)){var x=u.get(m.key);x.groupId!==m.groupId&&(x.groupId=m.groupId,f=!0),s.set(m.key,S),v.push(x),h+=Oe.size(x.loci);continue}if(S.expression!==m.expression)b=!0;else{var C=!1;if(n.isTransitive)if(tt.areUnitIdsAndIndicesEqual(S.originalStructure,y)){var w=Ri.run(S,S.originalStructure);S.currentStructure=y,s.set(m.key,S);var x=Oe.remap(yt.toLociWithSourceUnits(w),y);v.push({key:m.key,loci:x,groupId:m.groupId}),h+=Oe.size(x),f=!0}else C=!0;else C=!0;if(C){f=!0;var w=Ri.updateStructure(S,y);s.set(m.key,S);var x=yt.toLociWithSourceUnits(w);v.push({key:m.key,loci:x,groupId:m.groupId}),h+=Oe.size(x)}}}else b=!0;if(b){f=!0;var A=Ri.createAndRun(y,m.expression),w=A.selection,S=A.entry;s.set(m.key,S);var x=yt.toLociWithSourceUnits(w);v.push({key:m.key,loci:x}),h+=Oe.size(x)}}return f?(a.entries=s,t.data=v,t.label=""+(n.label||"Multi-selection"),t.description=v.length+" source(s), "+h+" element(s) total",vt.UpdateResult.Updated):vt.UpdateResult.Unchanged}}),D8e=kt.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{script:T.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:T.Optional(T.Text(""))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,a=Ri.createAndRun(t.data,r.script),i=a.selection,o=a.entry;n.entry=o;var s=yt.unionStructure(i),u={label:""+(r.label||"Selection"),description:tt.elementDescription(s)};return new ge.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(!Va.areEqual(n.script,a.script))return vt.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return vt.UpdateResult.Unchanged;var s=Ri.updateStructure(o,t.data);return Ri.updateStructureObject(r,s,a.label),vt.UpdateResult.Updated},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),R8e=kt.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{bundle:T.Value(en.Empty,{isHidden:!0}),label:T.Optional(T.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache;if(r.bundle.hash!==t.data.hashCode)return On.Null;n.source=t.data;var a=en.toStructure(r.bundle,t.data);if(a.elementCount===0)return On.Null;var i={label:""+(r.label||"Selection"),description:tt.elementDescription(a)};return new ge.Molecule.Structure(a,i)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(!en.areEqual(n.bundle,a.bundle))return vt.UpdateResult.Recreate;if(a.bundle.hash!==t.data.hashCode)return vt.UpdateResult.Null;if(i.source===t.data)return vt.UpdateResult.Unchanged;i.source=t.data;var o=en.toStructure(a.bundle,t.data);return o.elementCount===0?vt.UpdateResult.Null:(r.label=""+(a.label||"Selection"),r.description=tt.elementDescription(o),r.data=o,vt.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),kQ={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},k8e=T.objectToOptions(kQ),O8e=kt.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:{type:T.Select("atomic-sequence",k8e,{isHidden:!0})}})({apply:function(e){var t=e.a,r=e.params,n,a;switch(r.type){case"polymer":n=ma.polymer.query,a="Polymer";break;case"protein":n=ma.protein.query,a="Protein";break;case"nucleic":n=ma.nucleic.query,a="Nucleic";break;case"water":n=rn.internal.water(),a="Water";break;case"branched":n=ma.branchedPlusConnected.query,a="Branched";break;case"ligand":n=ma.ligandPlusConnected.query,a="Ligand";break;case"non-standard":n=ma.nonStandardPolymer.query,a="Non-standard";break;case"coarse":n=ma.coarse.query,a="Coarse";break;case"atomic-sequence":n=rn.internal.atomicSequence(),a="Sequence";break;case"atomic-het":n=rn.internal.atomicHet(),a="HET Groups/Ligands";break;case"spheres":n=rn.internal.spheres(),a="Coarse Spheres";break;default:throw new Error(r.type+" is a not valid complex element.")}var i=n(new as(t.data)),o=yt.unionStructure(i);return o.elementCount===0?On.Null:new ge.Molecule.Structure(o,{label:a,description:tt.elementDescription(o)})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),L8e=kt.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:EBe})({apply:function(e){var t=e.a,r=e.params,n=e.cache;return ABe(t.data,r,n)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;return PBe(t.data,r,n,a,i)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),OQ=kt.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:ge.Molecule.Model,to:ge.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Custom Props",function(i){return de(r,void 0,void 0,function(){return fe(this,function(o){switch(o.label){case 0:return[4,u9(n.data,t,i,a)];case 1:return o.sent(),[2,new ge.Molecule.Model(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return et.create("Custom Props",function(s){return de(r,void 0,void 0,function(){var u,l,c,d;return fe(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,l=i.autoAttach;u<l.length;u++)c=l[u],d=t.customModelProperties.get(c),d&&n.data.customProperties.reference(d.descriptor,!1);return[4,u9(n.data,t,s,o)];case 1:return f.sent(),[2,vt.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}});function u9(e,t,r,n){return de(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return fe(this,function(h){switch(h.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),h.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customModelProperties.get(l),d=o[l],!(i.includes(l)||c.isHidden))return[3,6];h.label=2;case 2:return h.trys.push([2,4,,5]),[4,c.attach(a,e,d,!0)];case 3:return h.sent(),[3,5];case 4:return f=h.sent(),t.log.warn("Error attaching model prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),h.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var LQ=kt.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data.root)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Custom Props",function(i){return de(r,void 0,void 0,function(){return fe(this,function(o){switch(o.label){case 0:return[4,l9(n.data.root,t,i,a)];case 1:return o.sent(),[2,new ge.Molecule.Structure(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return n.data!==a.data?vt.UpdateResult.Recreate:et.create("Custom Props",function(s){return de(r,void 0,void 0,function(){var u,l,c,d;return fe(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,l=i.autoAttach;u<l.length;u++)c=l[u],d=t.customStructureProperties.get(c),d&&n.data.customPropertyDescriptors.reference(d.descriptor,!1);return[4,l9(n.data.root,t,s,o)];case 1:return f.sent(),[2,vt.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}});function l9(e,t,r,n){return de(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return fe(this,function(h){switch(h.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),h.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customStructureProperties.get(l),d=o[l],!(i.includes(l)||c.isHidden))return[3,6];h.label=2;case 2:return h.trys.push([2,4,,5]),[4,c.attach(a,e,d,!0)];case 3:return h.sent(),[3,5];case 4:return f=h.sent(),t.log.warn("Error attaching structure prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),h.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var N8e=kt.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:ge.Format.Ply,to:ge.Shape.Provider,params:function(e){return{}}})({apply:function(e){var t=this,r=e.a;return e.params,et.create("Create shape from PLY",function(n){return de(t,void 0,void 0,function(){var a,i;return fe(this,function(o){switch(o.label){case 0:return[4,F6e(r.data).runInContext(n)];case 1:return a=o.sent(),i={label:"Shape"},[2,new ge.Shape.Provider(a,i)]}})})})}});const F8e=Object.freeze(Object.defineProperty({__proto__:null,CoordinatesFromDcd:l8e,CoordinatesFromXtc:c8e,CustomModelProperties:OQ,CustomStructureProperties:LQ,ModelFromTrajectory:E8e,MultiStructureSelectionFromExpression:M8e,ShapeFromPly:N8e,StructureComplexElement:O8e,StructureComplexElementTypes:kQ,StructureComponent:L8e,StructureFromModel:P8e,StructureFromTrajectory:A8e,StructureSelectionFromBundle:R8e,StructureSelectionFromExpression:I8e,StructureSelectionFromScript:D8e,TopologyFromPsf:d8e,TrajectoryFromBlob:h8e,TrajectoryFromCifCore:C8e,TrajectoryFromCube:S8e,TrajectoryFromGRO:m8e,TrajectoryFromMOL:y8e,TrajectoryFromMOL2:x8e,TrajectoryFromMmCif:p8e,TrajectoryFromModelAndCoordinates:RQ,TrajectoryFromPDB:v8e,TrajectoryFromSDF:b8e,TrajectoryFromXYZ:g8e,TransformStructureConformation:T8e},Symbol.toStringTag,{value:"Module"}));function B8e(e){return e.originX===0&&e.originY===0&&e.originZ===0?_.create(e.NCSTART,e.NRSTART,e.NSSTART):_.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function U8e(e){var t=LK(e);switch(t){case hi.Float32:return Float32Array;case hi.Int8:return Int8Array;case hi.Int16:return Int16Array;case hi.Uint16:return Uint16Array}throw Error(t+" is not a supported value format.")}function j8e(e,t){var r=this;return et.create("Create Volume",function(n){return de(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b,S;return fe(this,function(x){return a=e.header,i=e.values,o=_.create(a.xLength,a.yLength,a.zLength),t&&t.voxelSize&&_.mul(o,o,t.voxelSize),s=_.create(Xr(a.alpha),Xr(a.beta),Xr(a.gamma)),u=a.ISPG>65536?0:a.ISPG,l=Io.create(u||"P 1",o,s),c=_.create(a.MAPC-1,a.MAPR-1,a.MAPS-1),d=Pr.convertToCanonicalAxisIndicesFastToSlow(c),f=[a.NX,a.NY,a.NZ],h=d([a.NC,a.NR,a.NS]),v=B8e(a),t!=null&&t.offset&&_.add(v,v,t.offset),p=d(v),g=_.create(p[0]/f[0],p[1]/f[1],p[2]/f[2]),m=_.create(h[0]/f[0],h[1]/f[1],h[2]/f[2]),y=Pr.Space(h,Pr.invertAxisOrder(c),U8e(a)),b=Pr.create(y,Pr.Data1(i)),S=a.AMIN===0&&a.AMAX===0&&a.AMEAN===0&&a.ARMS===0,[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:l,fractionalBox:Yt.create(g,_.add(_.zero(),g,m))},cells:b,stats:{min:isNaN(a.AMIN)||S?d3(i):a.AMIN,max:isNaN(a.AMAX)||S?Ml(i):a.AMAX,mean:isNaN(a.AMEAN)||S?f3(i):a.AMEAN,sigma:isNaN(a.ARMS)||a.ARMS===0?h3(i):a.ARMS}},sourceData:iD.create(e),customProperties:new Nl,_propertyData:Object.create(null)}]})})})}var iD;(function(e){function t(n){return(n==null?void 0:n.kind)==="ccp4"}e.is=t;function r(n){return{kind:"ccp4",name:n.name,data:n}}e.create=r})(iD||(iD={}));function NQ(e,t){var r=this;return et.create("Create Volume",function(n){return de(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,h;return fe(this,function(v){return a=e.volume_data_3d_info,i=e.volume_data_3d,o=Io.create(a.spacegroup_number.value(0),_.ofArray(a.spacegroup_cell_size.value(0)),_.scale(_.zero(),_.ofArray(a.spacegroup_cell_angles.value(0)),Math.PI/180)),s=a.axis_order.value(0),u=Pr.convertToCanonicalAxisIndicesFastToSlow(s),l=u(a.sample_count.value(0)),c=Pr.Space(l,Pr.invertAxisOrder(s),Float32Array),d=Pr.create(c,Pr.Data1(i.values.toArray({array:Float32Array}))),f=_.ofArray(u(a.origin.value(0))),h=_.ofArray(u(a.dimensions.value(0))),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Yt.create(f,_.add(_.zero(),f,h))},cells:d,stats:{min:a.min_sampled.value(0),max:a.max_sampled.value(0),mean:a.mean_sampled.value(0),sigma:a.sigma_sampled.value(0)}},sourceData:h_.create(e),customProperties:new Nl,_propertyData:Object.create(null)}]})})})}var h_;(function(e){function t(n){return(n==null?void 0:n.kind)==="dscif"}e.is=t;function r(n){return{kind:"dscif",name:n._name,data:n}}e.create=r})(h_||(h_={}));function z8e(e,t){var r=this;return et.create("Create Volume",function(n){return de(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,h,v,p;return fe(this,function(g){return a=e.header,i=e.values,o=_.create(a.xlen,a.ylen,a.zlen),t&&t.voxelSize&&_.mul(o,o,t.voxelSize),s=_.create(Xr(a.alpha),Xr(a.beta),Xr(a.gamma)),u=Io.create("P 1",o,s),l=[a.xRate,a.yRate,a.zRate],c=[a.xExtent,a.yExtent,a.zExtent],d=[a.xStart,a.yStart,a.zStart],f=_.create(d[0]/l[0],d[1]/l[1],d[2]/l[2]),h=_.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),v=Pr.Space(c,[0,1,2],Float32Array),p=Pr.create(v,Pr.Data1(i)),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:u,fractionalBox:Yt.create(f,_.add(_.zero(),f,h))},cells:p,stats:{min:d3(i),max:Ml(i),mean:f3(i),sigma:a.sigma!==void 0?a.sigma:h3(i)}},sourceData:oD.create(e),customProperties:new Nl,_propertyData:Object.create(null)}]})})})}var oD;(function(e){function t(n){return(n==null?void 0:n.kind)==="dsn6"}e.is=t;function r(n){return{kind:"dsn6",name:n.name,data:n}}e.create=r})(oD||(oD={}));function V8e(e,t){var r=this;return et.create("Create Volume",function(){return de(r,void 0,void 0,function(){var n,a,i,o,s,u;return fe(this,function(l){return n=e.header,a=e.values,i=Pr.Space(n.dim,[0,1,2],Float64Array),o=Pr.create(i,Pr.Data1(a)),s=le.fromTranslation(le(),n.min),u=le.fromScaling(le(),n.h),le.mul(s,s,u),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:d3(a),max:Ml(a),mean:f3(a),sigma:h3(a)}},sourceData:sD.create(e),customProperties:new Nl,_propertyData:Object.create(null)}]})})})}var sD;(function(e){function t(n){return(n==null?void 0:n.kind)==="dx"}e.is=t;function r(n){return{kind:"dx",name:n.name,data:n}}e.create=r})(sD||(sD={}));var H8e=kt.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:ge.Format.Ccp4,to:ge.Volume.Data,params:function(e){return{voxelSize:T.Vec3(_.create(1,1,1)),offset:T.Vec3(_.create(0,0,0)),entryId:T.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return et.create("Create volume from CCP4/MRC/MAP",function(a){return de(t,void 0,void 0,function(){var i,o;return fe(this,function(s){switch(s.label){case 0:return[4,j8e(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume "+r.data.header.NX+"×"+r.data.header.NX+"×"+r.data.header.NX},[2,new ge.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),G8e=kt.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:ge.Format.Dsn6,to:ge.Volume.Data,params:function(e){return{voxelSize:T.Vec3(_.create(1,1,1)),entryId:T.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return et.create("Create volume from DSN6/BRIX",function(a){return de(t,void 0,void 0,function(){var i,o;return fe(this,function(s){switch(s.label){case 0:return[4,z8e(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume "+r.data.header.xExtent+"×"+r.data.header.yExtent+"×"+r.data.header.zExtent},[2,new ge.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),q8e=kt.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:ge.Format.Cube,to:ge.Volume.Data,params:function(e){var t=e?T.Select(0,e.data.header.dataSetIds.map(function(r,n){return[n,""+r]})):T.Numeric(0);return{dataIndex:t,entryId:T.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return et.create("Create volume from Cube",function(a){return de(t,void 0,void 0,function(){var i,o;return fe(this,function(s){switch(s.label){case 0:return[4,COe(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume "+r.data.header.dim[0]+"×"+r.data.header.dim[1]+"×"+r.data.header.dim[2]},[2,new ge.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),W8e=kt.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:ge.Format.Dx,to:ge.Volume.Data})({apply:function(e){var t=this,r=e.a;return et.create("Parse DX",function(n){return de(t,void 0,void 0,function(){var a,i;return fe(this,function(o){switch(o.label){case 0:return[4,V8e(r.data,{label:r.data.name||r.label}).runInContext(n)];case 1:return a=o.sent(),i={label:a.label||"Volume",description:"Volume "+r.data.header.dim[0]+"×"+r.data.header.dim[1]+"×"+r.data.header.dim[2]},[2,new ge.Volume.Data(a,i)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),$8e=kt.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Volume.Data,params:function(e){if(!e)return{blockHeader:T.Optional(T.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:T.Text("")};var t=e.data.blocks.slice(1);return{blockHeader:T.Optional(T.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"})),entryId:T.Text("")}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return et.create("Parse density-server CIF",function(a){return de(t,void 0,void 0,function(){var i,o,s,u,l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:if(i=n.blockHeader||r.data.blocks[1].header,o=r.data.blocks.find(function(g){return g.header===i}),!o)throw new Error("Data block '"+[i]+"' not found.");return s=Xc.schema.densityServer(o),[4,NQ(s,{entryId:n.entryId}).runInContext(a)];case 1:return u=p.sent(),l=u.grid.cells.space.dimensions,c=l[0],d=l[1],f=l[2],h={label:(v=n.entryId)!==null&&v!==void 0?v:s.volume_data_3d_info.name.value(0),description:"Volume "+c+"×"+d+"×"+f},[2,new ge.Volume.Data(u,h)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),X8e=kt.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:ge.Volume.Data,to:ge.Volume.Data,isDecorator:!0,params:function(e,t){if(!e)return{ref:T.Text()};var r=t.state.data.select(ir.Generators.root.subtree().ofType(ge.Volume.Data).filter(function(n){var a;return!!n.obj&&!(!((a=n.obj)===null||a===void 0)&&a.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:T.Text("",{isHidden:!0})}:{ref:T.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}))}}})({apply:function(e){var t=this,r=e.a,n=e.params,a=e.dependencies;return et.create("Assign Color Volume",function(i){return de(t,void 0,void 0,function(){var o,s,u;return fe(this,function(l){if(!a||!a[n.ref])throw new Error("Dependency not available.");return o=a[n.ref].data,s=E(E({},r.data),{colorVolume:o}),u={label:r.label,description:"Volume + Colors"},[2,new ge.Volume.Data(s,u)]})})})}});const Y8e=Object.freeze(Object.defineProperty({__proto__:null,AssignColorVolume:X8e,VolumeFromCcp4:H8e,VolumeFromCube:q8e,VolumeFromDensityServerCif:$8e,VolumeFromDsn6:G8e,VolumeFromDx:W8e},Symbol.toStringTag,{value:"Module"}));var ox=dt(13421772),K8e="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",FQ={};function Q8e(e){return FQ}function BQ(e,t){var r;if(e.structure){var n=e.structure.carbohydrates,a=n.elements,i=n.getElementIndices,o=function(s,u){if(!We.isAtomic(s))return ox;var l=i(s,u);return l.length>0?a[l[0]].component.color:ox};r=function(s,u){return u?Dt.Secondary:at.is(s)?o(s.unit,s.element):Gt.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):ox}}else r=function(){return ox};return{factory:BQ,granularity:"group",color:r,props:t,description:K8e,legend:vh(uPe)}}var Z8e={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:"Residue Property",factory:BQ,getParams:Q8e,defaultValues:T.getDefaultValues(FQ),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return Xt.hasCarbohydrate(t)})}},UQ={hue:T.Interval([1,360],{min:0,max:360,step:1}),chroma:T.Interval([40,70],{min:0,max:100,step:1}),luminance:T.Interval([15,85],{min:0,max:100,step:1}),clusteringStepCount:T.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:T.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0})};function jQ(e,t){return Math.sqrt(Math.pow(Math.abs(e[0]-t[0]),2)+Math.pow(Math.abs(e[1]-t[1]),2)+Math.pow(Math.abs(e[2]-t[2]),2))}var Xv=2,Ph=[0,0,0],Th=[0,0,0];function J8e(e,t){return ai.toHcl(Ph,e),ai.fromColor(Th,ai.toColor(e)),Ph[0]>=t.hue[0]&&Ph[0]<=t.hue[1]&&Ph[1]>=t.chroma[0]&&Ph[1]<=t.chroma[1]&&Ph[2]>=t.luminance[0]&&Ph[2]<=t.luminance[1]&&Th[0]>=e[0]-Xv&&Th[0]<=e[0]+Xv&&Th[1]>=e[1]-Xv&&Th[1]<=e[1]+Xv&&Th[2]>=e[2]-Xv&&Th[2]<=e[2]+Xv}function e7e(e){for(var t=e.slice(0),r=[t.shift()];t.length>0;){for(var n=r[r.length-1],a=0,i=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var s=jQ(n,t[o]);s>i&&(i=s,a=o)}r.push(t.splice(a,1)[0])}return r}function t7e(e,t){for(var r=new Map,n=Math.cbrt(e)*1.001,a=(t.hue[1]-t.hue[0])/n,i=(t.chroma[1]-t.chroma[0])/n,o=(t.luminance[1]-t.luminance[0])/n,s=t.hue[0];s<=t.hue[1];s+=a)for(var u=t.chroma[0];u<=t.chroma[1];u+=i)for(var l=t.luminance[0];l<=t.luminance[1];l+=o){var c=ai.fromHcl(ai(),Al.create(s,u,l));J8e(c,t)&&r.set(c.toString(),c)}return Array.from(r.values())}function r7e(e,t){t===void 0&&(t={});var r=E(E({},T.getDefaultValues(UQ)),t);if(e<=0)return[];var n=t7e(Math.max(r.minSampleCount,e*5),r);if(n.length<e)throw new Error("Not enough samples to generate distinct colors, increase sample count.");for(var a=[],i=[],o=Math.floor(n.length/e),s=0;s<n.length&&(a.push(n[s]),i.push([]),!(a.length>=e));s+=o);for(var u=1;u<=r.clusteringStepCount;++u){for(var l=Qf(i),s=0;s<n.length;++s){for(var c=Number.MAX_SAFE_INTEGER,d=0,f=0;f<a.length;f++){var h=jQ(n[s],a[f]);h<c&&(c=h,d=f)}l[d].push(n[s])}for(var v=Qf(a),s=0;s<l.length;++s){for(var p=l[s],g=p.length,m=[],y=[],b=[],S=0,x=p;S<x.length;S++){var C=x[S];m.push(C[0]),y.push(C[1]),b.push(C[2])}var w=Yy(m)/g,A=Yy(y)/g,I=Yy(b)/g;a[s]=[w,A,I]}if(zc(v,a))break}return e7e(a).map(function(D){return ai.toColor(D)})}var zQ={type:"generate",colorList:"red-yellow-blue"};function ds(e){e===void 0&&(e={});var t=E(E({},zQ),e);return{palette:T.MappedStatic(t.type,{colors:T.Group({list:T.ColorList(t.colorList)},{isFlat:!0}),generate:T.Group(E(E({},UQ),{maxCount:T.Numeric(75,{min:1,max:250,step:1})}),{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}T.getDefaultValues(ds());var c9={valueLabel:function(e){return""+(e+1)},minLabel:"Start",maxLabel:"End"};function eu(e,t,r){var n;r===void 0&&(r={});var a,i;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){var o=t.palette.params.list,s=[0,e-1],u=E(E({},c9),r),l=u.minLabel,c=u.maxLabel,d=o.colors;d.length===0&&(d=Hs(zQ.colorList).list);var f=Fu.create({listOrName:d,domain:s,minLabel:l,maxLabel:c});i=f.legend,a=f.color}else{var h;t.palette.name==="colors"?(h=t.palette.params.list.colors.map(function(b){return Array.isArray(b)?b[0]:b}),h.length===0&&(h=Hs("dark-2").list.map(function(b){return Array.isArray(b)?b[0]:b}))):(e=Math.min(e,t.palette.params.maxCount),h=r7e(e,t.palette.params));for(var v=(n=r.valueLabel)!==null&&n!==void 0?n:c9.valueLabel,p=h.length,g=[],m=0;m<e;++m){var y=m%p;g[y]===void 0?g[y]=[v(m),h[y]]:g[y][0]+=", "+v(m)}i=vh(g),a=function(b){return h[b%p]}}return{color:a,legend:i}}var n7e="many-distinct",d9=dt(16448250),a7e="Gives every chain a color based on its `asym_id` value.",O3=E({asymId:T.Select("auth",T.arrayToOptions(["auth","label"]))},ds({type:"colors",colorList:n7e}));function i7e(e){var t,r=T.clone(O3);return!((t=e.structure)===null||t===void 0)&&t.models.some(function(n){return n.coarseHierarchy.isDefined})&&(r.asymId.defaultValue="label"),r}function o7e(e,t){switch(e.kind){case 0:return t==="auth"?pt.chain.auth_asym_id:pt.chain.label_asym_id;case 1:case 2:return pt.coarse.asym_id}}function f9(e,t){var r=o7e(e.unit,t)(e);return e.structure.root.models.length>1?VQ(e.unit.model,r):r}function VQ(e,t){return t+"|"+((Xt.Index.get(e).value||0)+1)}function s7e(e,t){for(var r=new Map,n=function(s){var u=Xt.AsymIdOffset.get(s).value,l=(t==="auth"?u==null?void 0:u.auth:u==null?void 0:u.label)||0,c=0;s.properties.structAsymMap.forEach(function(d,f){var h=d.auth_id,v=t==="auth"?h:f,p=e.models.length>1?VQ(s,v):v;r.has(p)||(r.set(p,c+l),++c)})},a=0,i=e.models;a<i.length;a++){var o=i[a];n(o)}return r}function L3(e,t){var r,n;if(e.structure){var a=at.create(e.structure.root),i=s7e(e.structure.root,t.asymId),o=Array.from(i.keys()),s=function(l){return o[l]},u=eu(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(at.is(l)){var d=f9(l,t.asymId);c=i.get(d)}else if(Gt.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=f9(a,t.asymId);c=i.get(d)}return c===void 0?d9:u.color(c)}}else r=function(){return d9};return{factory:L3,granularity:"group",color:r,props:t,description:a7e,legend:n}}var HQ={name:"chain-id",label:"Chain Id",category:"Chain Property",factory:L3,getParams:i7e,defaultValues:T.getDefaultValues(O3),isApplicable:function(e){return!!e.structure}},h9=dt(13421772),u7e="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",GQ=E({},ds({type:"colors",colorList:"red-yellow-blue"}));function l7e(e){return GQ}function qQ(e,t){var r,n;if(e.structure){for(var a=e.structure.root.units,i=a.length,o=new Map,s=new Map,u=0,l=0;l<i;++l)o.set(l,u),u+=a[l].elements.length,s.set(a[l].id,l);var c=eu(u,t);n=c.legend,r=function(d){if(at.is(d)){var f=s.get(d.unit.id),h=Fe.findPredecessorIndex(a[f].elements,d.element);return c.color(o.get(f)+h)}else if(Gt.isLocation(d)){var f=s.get(d.aUnit.id),h=Fe.findPredecessorIndex(a[f].elements,d.aUnit.elements[d.aIndex]);return c.color(o.get(f)+h)}return h9}}else r=function(){return h9};return{factory:qQ,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:u7e,legend:n}}var c7e={name:"element-index",label:"Element Index",category:"Atom Property",factory:qQ,getParams:l7e,defaultValues:T.getDefaultValues(GQ),isApplicable:function(e){return!!e.structure}},d7e="many-distinct",p9=dt(13421772),f7e="Assigns a color based on the operator name of a transformed chain.",iO=E({},ds({type:"colors",colorList:d7e}));function h7e(e){var t=T.clone(iO);return t}function p7e(e){for(var t=new Map,r=0,n=e.units.length;r<n;++r){var a=e.units[r].conformation.operator.name;t.has(a)||t.set(a,t.size)}return t}function oO(e,t){var r,n;if(e.structure){var a=p7e(e.structure.root),i=Array.from(a.keys()),o=function(u){return i[u]},s=eu(a.size,t,{valueLabel:o});n=s.legend,r=function(u){var l=void 0;if(at.is(u)){var c=u.unit.conformation.operator.name;l=a.get(c)}else if(Gt.isLocation(u)){var d=u.aUnit.conformation.operator.name;l=a.get(d)}return l===void 0?p9:s.color(l)}}else r=function(){return p9};return{factory:oO,granularity:"instance",color:r,props:t,description:f7e,legend:n}}var sO={name:"operator-name",label:"Operator Name",category:"Symmetry",factory:oO,getParams:h7e,defaultValues:T.getDefaultValues(iO),isApplicable:function(e){return!!e.structure}},qP={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},WQ=dt(16777215),v7e="Assigns a color to every atom according to its chemical element.",$Q={carbonColor:T.MappedStatic("chain-id",{"chain-id":T.Group(E({},O3)),"operator-name":T.Group(E({},iO)),"element-symbol":T.Group({})},{description:"Use chain-id coloring for carbon atoms."}),saturation:T.Numeric(0,{min:-6,max:6,step:.1}),lightness:T.Numeric(.2,{min:-6,max:6,step:.1})};function m7e(e){return $Q}function g7e(e,t){var r=e[t];return r===void 0?WQ:r}function XQ(e,t){var r=n3(qP,t.saturation,t.lightness),n=t.carbonColor.name==="chain-id"?L3(e,t.carbonColor.params).color:t.carbonColor.name==="operator-name"?oO(e,t.carbonColor.params).color:void 0;function a(s,u){return n&&s==="C"?n(u,!1):g7e(r,s)}function i(s){if(at.is(s)){if(We.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol;return a(u.value(s.element),s)}}else if(Gt.isLocation(s)&&We.isAtomic(s.aUnit)){var u=s.aUnit.model.atomicHierarchy.atoms.type_symbol,l=u.value(s.aUnit.elements[s.aIndex]);return a(l,s)}return WQ}var o=t.carbonColor.name==="operator-name"?"groupInstance":"group";return{factory:XQ,granularity:o,preferSmoothing:!0,color:i,props:t,description:v7e,legend:vh(Object.keys(qP).map(function(s){return[s,qP[s]]}))}}var y7e={name:"element-symbol",label:"Element Symbol",category:"Atom Property",factory:XQ,getParams:m7e,defaultValues:T.getDefaultValues($Q),isApplicable:function(e){return!!e.structure}},WP={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},uD=dt(16777113),b7e="Assigns a color based on the molecule type of a residue.",YQ={saturation:T.Numeric(0,{min:-6,max:6,step:.1}),lightness:T.Numeric(0,{min:-6,max:6,step:.1})};function x7e(e){return YQ}function v9(e,t,r){var n=Fk(t,r);switch(n){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return uD}function KQ(e,t){var r=n3(WP,t.saturation,t.lightness);function n(a){return at.is(a)?v9(r,a.unit,a.element):Gt.isLocation(a)?v9(r,a.aUnit,a.aUnit.elements[a.aIndex]):uD}return{factory:KQ,granularity:"group",color:n,props:t,description:b7e,legend:vh(Object.keys(WP).map(function(a){return[a,WP[a]]}).concat([["Other/unknown",uD]]))}}var S7e={name:"molecule-type",label:"Molecule Type",category:"Residue Property",factory:KQ,getParams:x7e,defaultValues:T.getDefaultValues(YQ),isApplicable:function(e){return!!e.structure}},lD="dark-2",m9=dt(16448250),C7e="Gives every polymer chain a color based on its `asym_id` value.",QQ=E({},ds({type:"colors",colorList:lD}));function _7e(e){var t=T.clone(QQ);return e.structure&&ZQ(e.structure.root).size>wo[lD].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Hs(lD).list}})),t}function g9(e){switch(e.kind){case 0:return pt.chain.label_asym_id;case 1:case 2:return pt.coarse.asym_id}}function ZQ(e){for(var t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r){var a=e.unitSymmetryGroups[r].units[0],i=a.model;if(We.isAtomic(a))for(var o=i.atomicHierarchy,s=o.chainAtomSegments,u=o.chains,l=ar.transientSegments(s,a.elements);l.hasNext;){var c=l.move().index,d=u.label_entity_id.value(c),f=i.entities.getEntityIndex(d);if(i.entities.data.type.value(f)==="polymer"){var h=u.label_asym_id.value(c);t.has(h)||t.set(h,t.size)}}else if(We.isCoarse(a))for(var v=We.isSpheres(a)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,p=v.chainElementSegments,g=v.asym_id,m=v.entity_id,l=ar.transientSegments(p,a.elements);l.hasNext;){var c=l.move().index,y=p.offsets[c],d=m.value(y),f=i.entities.getEntityIndex(d);if(i.entities.data.type.value(f)==="polymer"){var h=g.value(y);t.has(h)||t.set(h,t.size)}}}return t}function JQ(e,t){var r,n;if(e.structure){var a=at.create(e.structure),i=ZQ(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=eu(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(at.is(l)){var d=g9(l.unit);c=i.get(d(l))}else if(Gt.isLocation(l)){var d=g9(l.aUnit);a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex],c=i.get(d(a))}return c===void 0?m9:u.color(c)}}else r=function(){return m9};return{factory:JQ,granularity:"group",color:r,props:t,description:C7e,legend:n}}var w7e={name:"polymer-id",label:"Polymer Chain Id",category:"Chain Property",factory:JQ,getParams:_7e,defaultValues:T.getDefaultValues(QQ),isApplicable:function(e){return!!e.structure}},cD="dark-2",y9=dt(13421772),E7e="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",eZ=E({},ds({type:"colors",colorList:cD}));function A7e(e){var t=T.clone(eZ);return e.structure&&tZ(e.structure.root)>wo[cD].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Hs(cD).list}})),t}function tZ(e){for(var t=0,r=e.units,n=0,a=r.length;n<a;++n)r[n].polymerElements.length>0&&++t;return t}function rZ(e,t){var r,n;if(e.structure){var a=eu(tZ(e.structure.root),t);n=a.legend;for(var i=e.structure.root.units,o=new Map,s=0,u=0,l=i.length;s<l;++s)i[s].polymerElements.length>0&&(o.set(i[s].id,a.color(u)),++u);r=function(c){var d;return at.is(c)?d=o.get(c.unit.id):Gt.isLocation(c)&&(d=o.get(c.aUnit.id)),d!==void 0?d:y9}}else r=function(){return y9};return{factory:rZ,granularity:"instance",color:r,props:t,description:E7e,legend:n}}var P7e={name:"polymer-index",label:"Polymer Chain Instance",category:"Chain Property",factory:rZ,getParams:A7e,defaultValues:T.getDefaultValues(eZ),isApplicable:function(e){return!!e.structure}},$P={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},dD=dt(16711935),T7e="Assigns a color to every residue according to its name.",nZ={saturation:T.Numeric(0,{min:-6,max:6,step:.1}),lightness:T.Numeric(1,{min:-6,max:6,step:.1})};function I7e(e){return nZ}function b9(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function x9(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var a=e.coarseElements.entityKey[t],i=e.model.sequence.byEntityKey[a].sequence;return i.compId.value(r-1)}}function sx(e,t){var r=e[t];return r===void 0?dD:r}function aZ(e,t){var r=n3($P,t.saturation,t.lightness);function n(a){if(at.is(a))if(We.isAtomic(a.unit)){var i=b9(a.unit,a.element);return sx(r,i)}else{var i=x9(a.unit,a.element);if(i)return sx(r,i)}else if(Gt.isLocation(a))if(We.isAtomic(a.aUnit)){var i=b9(a.aUnit,a.aUnit.elements[a.aIndex]);return sx(r,i)}else{var i=x9(a.aUnit,a.aUnit.elements[a.aIndex]);if(i)return sx(r,i)}return dD}return{factory:aZ,granularity:"group",preferSmoothing:!0,color:n,props:t,description:T7e,legend:vh(Object.keys($P).map(function(a){return[a,$P[a]]}).concat([["Unknown",dD]]))}}var M7e={name:"residue-name",label:"Residue Name",category:"Residue Property",factory:aZ,getParams:I7e,defaultValues:T.getDefaultValues(nZ),isApplicable:function(e){return!!e.structure}},XP={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},fD=dt(8421504),D7e="Assigns a color based on the type of secondary structure and basic molecule type.",iZ={saturation:T.Numeric(-1,{min:-6,max:6,step:.1}),lightness:T.Numeric(0,{min:-6,max:6,step:.1})};function R7e(e){return iZ}function S9(e,t,r,n){var a=Lr.create(0);if(n&&We.isAtomic(t)){var i=n.get(t.invariantId);i&&(a=i.type[i.getIndex(t.residueIndex[r])])}if(Lr.is(a,2))return Lr.is(a,2048)?e.threeTenHelix:Lr.is(a,32768)?e.piHelix:e.alphaHelix;if(Lr.is(a,4))return e.betaStrand;if(Lr.is(a,8))return e.bend;if(Lr.is(a,16))return e.turn;var o=Fk(t,r);return o===7?e.dna:o===6?e.rna:o===9?e.carbohydrate:o===5?e.coil:fD}function oZ(e,t){var r=e.structure&&Ol.get(e.structure),n=r?cv(r.id,r.version):-1,a=n3(XP,t.saturation,t.lightness);function i(o){return at.is(o)?S9(a,o.unit,o.element,r==null?void 0:r.value):Gt.isLocation(o)?S9(a,o.aUnit,o.aUnit.elements[o.aIndex],r==null?void 0:r.value):fD}return{factory:oZ,granularity:"group",preferSmoothing:!0,color:i,props:t,contextHash:n,description:D7e,legend:vh(Object.keys(XP).map(function(o){return[o,XP[o]]}).concat([["Other",fD]]))}}var k7e={name:"secondary-structure",label:"Secondary Structure",category:"Residue Property",factory:oZ,getParams:R7e,defaultValues:T.getDefaultValues(iZ),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Ol.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Ol.ref(e.structure,!1)}}},O7e=dt(13421772),L7e="Gives every polymer residue a color based on its `seq_id` value.",sZ={list:T.ColorList("turbo",{presetKind:"scale"})};function N7e(e){return sZ}function C9(e,t){var r=e.model;switch(e.kind){case 0:var n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function _9(e,t){var r=e.model,n="";switch(e.kind){case 0:var a=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(a);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;var i=r.entities.getEntityIndex(n);if(i===-1)return 0;var o=r.sequence.byEntityKey[i];return o===void 0?0:o.sequence.length}function uZ(e,t){var r=Fu.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"}),n=function(a){if(at.is(a)){var i=a.unit,o=a.element,s=C9(i,o);if(s>0){var u=_9(i,o);if(u)return r.setDomain(0,u-1),r.color(s)}}else if(Gt.isLocation(a)){var l=a.aUnit,c=a.aIndex,s=C9(l,l.elements[c]);if(s>0){var u=_9(l,l.elements[c]);if(u)return r.setDomain(0,u-1),r.color(s)}}return O7e};return{factory:uZ,granularity:"group",preferSmoothing:!0,color:n,props:t,description:L7e,legend:r?r.legend:void 0}}var F7e={name:"sequence-id",label:"Sequence Id",category:"Residue Property",factory:uZ,getParams:N7e,defaultValues:T.getDefaultValues(sZ),isApplicable:function(e){return!!e.structure}},hD="dark-2",w9=dt(13421772),B7e="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",lZ=E({},ds({type:"colors",colorList:hD}));function U7e(e){var t=T.clone(lZ);return e.structure&&e.structure.root.units.length>wo[hD].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Hs(hD).list}})),t}function cZ(e,t){var r,n;if(e.structure){var a=e.structure.root.units,i=eu(a.length,t);n=i.legend;for(var o=new Map,s=0,u=a.length;s<u;++s)o.set(a[s].id,i.color(s));r=function(l){return at.is(l)?o.get(l.unit.id):Gt.isLocation(l)?o.get(l.aUnit.id):w9}}else r=function(){return w9};return{factory:cZ,granularity:"instance",color:r,props:t,description:B7e,legend:n}}var j7e={name:"unit-index",label:"Chain Instance",category:"Chain Property",factory:cZ,getParams:U7e,defaultValues:T.getDefaultValues(lZ),isApplicable:function(e){return!!e.structure}},z7e=dt(16777113),V7e="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",dZ={domain:T.Interval([0,100]),list:T.ColorList("red-white-blue",{presetKind:"scale"})};function H7e(e){return dZ}function E9(e,t){return We.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):We.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function fZ(e,t){var r=Fu.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(a){return at.is(a)?r.color(E9(a.unit,a.element)):Gt.isLocation(a)?r.color(E9(a.aUnit,a.aUnit.elements[a.aIndex])):z7e}return{factory:fZ,granularity:"group",preferSmoothing:!0,color:n,props:t,description:V7e,legend:r?r.legend:void 0}}var G7e={name:"uncertainty",label:"Uncertainty/Disorder",category:"Atom Property",factory:fZ,getParams:H7e,defaultValues:T.getDefaultValues(dZ),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},pD="dark-2",ux=dt(16448250),q7e="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",hZ=E({},ds({type:"colors",colorList:pD}));function W7e(e){var t=T.clone(hZ);return e.structure&&vZ(e.structure.root.models).srcKeySerialMap.size>wo[pD].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Hs(pD).list}})),t}function pZ(e,t){return e+"|"+t}function $7e(e,t,r,n,a,i){return e+"|"+t+"|"+r+"|"+(i||a||n)}function YP(e,t,r,n,a,i,o,s){for(var u=a.entity_id,l=a.pdbx_src_id,c=a.pdbx_beg_seq_num,d=a.pdbx_end_seq_num,f=0,h=a._rowCount;f<h;++f){var v=u.value(f),p=pZ(r,v),g=void 0;if(e.has(p))g=e.get(p);else{var m=n.entities.getEntityIndex(v),y=n.sequence.sequences[m].sequence;g=new Int16Array(y.length),e.set(p,g)}var b=o?o.value(f):"",S=s?s.value(f)[0]:"",x=$7e(r,v,i.value(f),l.value(f),b,S),C=c.valueKind(f)===0?c.value(f):1,w=d.valueKind(f)===0?d.value(f):g.length,A=void 0;t.has(x)?A=t.get(x):(A=t.size+1,t.set(x,A));for(var I=C,D=w;I<=D;++I)g[I-1]=A}}function vZ(e){for(var t=new Map,r=new Map,n=0,a=e.length;n<a;++n){var i=e[n];if(nn.is(i.sourceData)){var o=i.sourceData.data.db,s=o.entity_src_gen,u=o.entity_src_nat,l=o.pdbx_entity_src_syn;YP(t,r,n,i,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),YP(t,r,n,i,u,u.pdbx_organism_scientific,u.pdbx_plasmid_name),YP(t,r,n,i,l,l.organism_scientific)}}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function X7e(e){var t=0;return Array.from(e.keys()).map(function(r){var n=r.split("|"),a=n[2],i=UTe(n[3])?"Unnamed "+ ++t:n[3];return""+i+(a?" ("+a+")":"")})}function mZ(e,t){var r,n;if(e.structure){var a=at.create(e.structure),i=e.structure.root.models,o=vZ(i),s=o.seqToSrcByModelEntity,u=o.srcKeySerialMap,l=X7e(u),c=function(h){return l[h]},d=eu(u.size,t,{valueLabel:c});n=d.legend;var f=function(h){var v=i.indexOf(h.unit.model),p=pt.entity.id(h),g=pZ(v,p),m=s.get(g);if(m){var y=m[pt.residue.label_seq_id(h)-1]-1;return y===-1?ux:d.color(y)}else return ux};r=function(h){return at.is(h)?f(h):Gt.isLocation(h)?(a.unit=h.aUnit,a.element=h.aUnit.elements[h.aIndex],f(a)):ux}}else r=function(){return ux};return{factory:mZ,granularity:"group",color:r,props:t,description:q7e,legend:n}}var Y7e={name:"entity-source",label:"Entity Source",category:"Chain Property",factory:mZ,getParams:W7e,defaultValues:T.getDefaultValues(hZ),isApplicable:function(e){return!!e.structure}},K7e=dt(15658734),Q7e="Assigns an illustrative color that gives every chain a unique color with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",gZ=E({},O3);function Z7e(e){return gZ}function yZ(e,t){var r=L3(e,t),n=r.color,a=r.legend;function i(s,u){var l=n(s,!1);return u==="C"?dt.lighten(l,.8):l}function o(s){if(at.is(s)&&We.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return i(s,u)}else if(Gt.isLocation(s)&&We.isAtomic(s.aUnit)){var l=s.aUnit.elements[s.aIndex],u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(l);return i(s,u)}return K7e}return{factory:yZ,granularity:"group",preferSmoothing:!0,color:o,props:t,description:Q7e,legend:a}}var J7e={name:"illustrative",label:"Illustrative",category:"Miscellaneous",factory:yZ,getParams:Z7e,defaultValues:T.getDefaultValues(gZ),isApplicable:function(e){return!!e.structure}},eUe='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',bZ={list:T.ColorList("red-yellow-green",{presetKind:"scale"}),scale:T.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function tUe(e){return bZ}var rUe={DGwif:0,DGwoct:1,"Oct-IF":2};function nUe(e,t){var r=wM[e];return r===void 0?0:r[t]}function A9(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function P9(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var a=e.coarseElements.entityKey[t],i=e.model.sequence.byEntityKey[a].sequence;return i.compId.value(r-1)}}function xZ(e,t){var r=rUe[t.scale],n=1/0,a=-1/0;for(var i in wM){var o=wM[i][r];n=Math.min(n,o),a=Math.max(a,o)}var s=Fu.create({listOrName:t.list.colors,domain:[a,n],minLabel:"Hydrophobic",maxLabel:"Hydrophilic"});function u(l){var c;return at.is(l)?We.isAtomic(l.unit)?c=A9(l.unit,l.element):c=P9(l.unit,l.element):Gt.isLocation(l)&&(We.isAtomic(l.aUnit)?c=A9(l.aUnit,l.aUnit.elements[l.aIndex]):c=P9(l.aUnit,l.aUnit.elements[l.aIndex])),s.color(c?nUe(c,r):0)}return{factory:xZ,granularity:"group",preferSmoothing:!0,color:u,props:t,description:eUe,legend:s?s.legend:void 0}}var aUe={name:"hydrophobicity",label:"Hydrophobicity",category:"Residue Property",factory:xZ,getParams:tUe,defaultValues:T.getDefaultValues(bZ),isApplicable:function(e){return!!e.structure}},T9=dt(13421772),iUe="Gives every model a unique color based on the position (index) of the model in the list of models in the structure.",SZ=E({},ds({type:"colors",colorList:"purples"}));function oUe(e){return SZ}function CZ(e,t){var r,n,a,i;if(e.structure){for(var o=e.structure.root.models,s=0,u=0,l=o;u<l.length;u++){var c=l[u];s=Math.max(s,((r=Xt.TrajectoryInfo.get(c))===null||r===void 0?void 0:r.size)||0)}var d=eu(s,t);i=d.legend;for(var f=new Map,h=0,v=o.length;h<v;++h){var p=((n=Xt.TrajectoryInfo.get(o[h]))===null||n===void 0?void 0:n.index)||0;f.set(p,d.color(p))}a=function(g){return at.is(g)?f.get(Xt.TrajectoryInfo.get(g.unit.model).index):Gt.isLocation(g)?f.get(Xt.TrajectoryInfo.get(g.aUnit.model).index):T9}}else a=function(){return T9};return{factory:CZ,granularity:"instance",color:a,props:t,description:iUe,legend:i}}var sUe={name:"model-index",label:"Model Index",category:"Chain Property",factory:CZ,getParams:oUe,defaultValues:T.getDefaultValues(SZ),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0&&Xt.TrajectoryInfo.get(e.structure.models[0]).size>1}},uUe=dt(13421772),lUe="Assigns a color based on the occupancy of an atom.",_Z={domain:T.Interval([0,1]),list:T.ColorList("purples",{presetKind:"scale"})};function cUe(e){return _Z}function I9(e,t){return We.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function wZ(e,t){var r=Fu.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(a){return at.is(a)?r.color(I9(a.unit,a.element)):Gt.isLocation(a)?r.color(I9(a.aUnit,a.aUnit.elements[a.aIndex])):uUe}return{factory:wZ,granularity:"group",preferSmoothing:!0,color:n,props:t,description:lUe,legend:r?r.legend:void 0}}var dUe={name:"occupancy",label:"Occupancy",category:"Atom Property",factory:wZ,getParams:cUe,defaultValues:T.getDefaultValues(_Z),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.occupancy.isDefined})}},vD="dark-2",M9=dt(13421772),fUe="Assigns a color based on the operator HKL value of a transformed chain.",EZ=E({},ds({type:"colors",colorList:vD}));function hUe(e){var t=T.clone(EZ);return e.structure&&AZ(e.structure.root).map.size>wo[vD].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Hs(vD).list}})),t}var Ay=1e4;function mD(e){return e.map(function(t){return(""+(t+Ay)).padStart(5,"0")}).join("")}function gD(e){var t=FTe(Ay,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),a=parseInt(e.substr(t+t,t));return[r-Ay,n-Ay,a-Ay]}function KP(e){return e.map(function(t){return t+5}).join("")}function AZ(e){for(var t=new Map,r=new Set,n=0,a=e.units.length;n<a;++n){var i=mD(e.units[n].conformation.operator.hkl);r.add(i)}var o=Array.from(r.values()).sort();o.forEach(function(l){return t.set(l,t.size)});var s=gD(o[0]),u=gD(o[o.length-1]);return{min:s,max:u,map:t}}function PZ(e,t){var r,n;if(e.structure){var a=AZ(e.structure.root),i=a.min,o=a.max,s=a.map,u=[];s.forEach(function(d,f){var h=d%s.size,v=KP(gD(f));u[h]===void 0?u[h]=v:u[h]+=", "+v});var l={minLabel:KP(i),maxLabel:KP(o),valueLabel:function(d){return u[d]}},c=eu(s.size,t,l);n=c.legend,r=function(d){var f=void 0;if(at.is(d)){var h=mD(d.unit.conformation.operator.hkl);f=s.get(h)}else if(Gt.isLocation(d)){var h=mD(d.aUnit.conformation.operator.hkl);f=s.get(h)}return f===void 0?M9:c.color(f)}}else r=function(){return M9};return{factory:PZ,granularity:"instance",color:r,props:t,description:fUe,legend:n}}var pUe={name:"operator-hkl",label:"Operator HKL",category:"Symmetry",factory:PZ,getParams:hUe,defaultValues:T.getDefaultValues(EZ),isApplicable:function(e){return!!e.structure}},QP=dt(16777113),vUe="Assigns a color based on the partial charge of an atom.",TZ={domain:T.Interval([-1,1]),list:T.ColorList("red-white-blue",{presetKind:"scale"})};function mUe(e){return TZ}function D9(e,t){var r;return(r=Mg.Provider.get(e.model))===null||r===void 0?void 0:r.data.value(t)}function IZ(e,t){var r=Fu.create({domain:t.domain,listOrName:t.list.colors});function n(a){if(at.is(a)){var i=D9(a.unit,a.element);return i!==void 0?r.color(i):QP}else if(Gt.isLocation(a)){var i=D9(a.aUnit,a.aUnit.elements[a.aIndex]);return i!==void 0?r.color(i):QP}return QP}return{factory:IZ,granularity:"group",preferSmoothing:!0,color:n,props:t,description:vUe,legend:r?r.legend:void 0}}var gUe={name:"partial-charge",label:"Partial Charge",category:"Atom Property",factory:IZ,getParams:mUe,defaultValues:T.getDefaultValues(TZ),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return Mg.Provider.get(t)!==void 0})}},yUe="many-distinct",R9=dt(16448250),bUe="Gives every atom a color based on its `label_atom_id` value.",MZ=E({},ds({type:"colors",colorList:yUe}));function xUe(e){var t=T.clone(MZ);return t}function SUe(e){for(var t=new Map,r=0,n=e.models;r<n.length;r++)for(var a=n[r],i=a.atomicHierarchy.atoms.label_atom_id,o=0,s=i.rowCount;o<s;++o){var u=i.value(o);t.has(u)||t.set(u,t.size)}return t}function DZ(e,t){var r,n;if(e.structure){var a=at.create(e.structure.root),i=SUe(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=eu(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(at.is(l)){var d=pt.atom.label_atom_id(l);c=i.get(d)}else if(Gt.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=pt.atom.label_atom_id(a);c=i.get(d)}return c===void 0?R9:u.color(c)}}else r=function(){return R9};return{factory:DZ,granularity:"group",preferSmoothing:!0,color:r,props:t,description:bUe,legend:n}}var CUe={name:"atom-id",label:"Atom Id",category:"Atom Property",factory:DZ,getParams:xUe,defaultValues:T.getDefaultValues(MZ),isApplicable:function(e){return!!e.structure}},_Ue="many-distinct",k9=dt(16448250),wUe="Gives every chain a color based on its `label_entity_id` value.",RZ=E({},ds({type:"colors",colorList:_Ue}));function EUe(e){var t=T.clone(RZ);return t}function yD(e,t){return e+"|"+t}function AUe(e){for(var t=new Map,r=0,n=e.models.length;r<n;++r)for(var a=e.models[r].atomicHierarchy.chains.label_entity_id,i=0,o=a.rowCount;i<o;++i){var s=yD(a.value(i),r);t.has(s)||t.set(s,t.size)}return t}function kZ(e,t){var r,n;if(e.structure){var a=at.create(e.structure.root),i=AUe(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=eu(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(at.is(l)){var d=pt.chain.label_entity_id(l),f=l.structure.models.indexOf(l.unit.model),h=yD(d,f);c=i.get(h)}else if(Gt.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=pt.chain.label_entity_id(a),f=a.structure.models.indexOf(a.unit.model),h=yD(d,f);c=i.get(h)}return c===void 0?k9:u.color(c)}}else r=function(){return k9};return{factory:kZ,granularity:"group",color:r,props:t,description:wUe,legend:n}}var PUe={name:"entity-id",label:"Entity Id",category:"Chain Property",factory:kZ,getParams:EUe,defaultValues:T.getDefaultValues(RZ),isApplicable:function(e){return!!e.structure}},Qc;(function(e){e.PaletteScale=(1<<24)-1,e.EmptyFactory=function(){return e.Empty};var t=dt(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return t},props:{}};function r(a,i){return a.contextHash===i.contextHash&&a.factory===i.factory&&zc(a.props,i.props)}e.areEqual=r,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function n(){return new FZ(e.BuiltIn,e.EmptyProvider)}e.createRegistry=n,e.BuiltIn={"atom-id":CUe,"carbohydrate-symbol":Z8e,"chain-id":HQ,"element-index":c7e,"element-symbol":y7e,"entity-id":PUe,"entity-source":Y7e,hydrophobicity:aUe,illustrative:J7e,"model-index":sUe,"molecule-type":S7e,occupancy:dUe,"operator-hkl":pUe,"operator-name":sO,"partial-charge":gUe,"polymer-id":w7e,"polymer-index":P7e,"residue-name":M7e,"secondary-structure":k7e,"sequence-id":F7e,"shape-group":n6e,uncertainty:G7e,"unit-index":j7e,uniform:OAe}})(Qc||(Qc={}));var TUe=1,IUe="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",OZ={scale:T.Numeric(1,{min:.1,max:5,step:.1})};function MUe(e){return OZ}function ZP(e,t){return We.isAtomic(e)?Mb(e.model.atomicHierarchy.atoms.type_symbol.value(t)):We.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function Fb(e,t){var r=t.scale===void 0?1:t.scale;function n(a){var i;return at.is(a)?i=r*ZP(a.unit,a.element):Gt.isLocation(a)?i=r*Math.min(ZP(a.aUnit,a.aUnit.elements[a.aIndex]),ZP(a.bUnit,a.bUnit.elements[a.bIndex])):i=r*TUe,i}return{factory:Fb,granularity:"group",size:n,props:t,description:IUe}}var DUe={name:"physical",label:"Physical",category:"",factory:Fb,getParams:MUe,defaultValues:T.getDefaultValues(OZ),isApplicable:function(e){return!!e.structure}},RUe="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",LZ={bfactorFactor:T.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:T.Numeric(.05,{min:0,max:1,step:.01}),baseSize:T.Numeric(.2,{min:0,max:2,step:.1})};function kUe(e){return LZ}function O9(e,t,r){return We.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:We.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function NZ(e,t){function r(n){var a=t.baseSize;return at.is(n)?a+=O9(n.unit,n.element,t):Gt.isLocation(n)&&(a+=O9(n.aUnit,n.aUnit.elements[n.aIndex],t)),a}return{factory:NZ,granularity:"group",size:r,props:t,description:RUe}}var OUe={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:NZ,getParams:kUe,defaultValues:T.getDefaultValues(LZ),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},Ya;(function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}};function t(n,a){return n.factory===a.factory&&zc(n.props,a.props)}e.areEqual=t,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function r(){return new FZ(e.BuiltIn,e.EmptyProvider)}e.createRegistry=r,e.BuiltIn={physical:DUe,"shape-group":JFe,uncertainty:OUe,uniform:FAe}})(Ya||(Ya={}));var ya;(function(e){function t(i,o,s,u){u=u||r();var l=s.colorTheme,c=s.sizeTheme;return u.color=i.colorThemeRegistry.create(l.name,o,l.params),u.size=i.sizeThemeRegistry.create(c.name,o,c.params),u}e.create=t;function r(){return{color:Qc.Empty,size:Ya.Empty}}e.createEmpty=r;function n(i,o,s,u){var l,c;return de(this,void 0,void 0,function(){return fe(this,function(d){switch(d.label){case 0:return[4,(l=o.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)===null||l===void 0?void 0:l.attach(i,s)];case 1:return d.sent(),[4,(c=o.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)===null||c===void 0?void 0:c.attach(i,s)];case 2:return d.sent(),[2]}})})}e.ensureDependencies=n;function a(i,o,s){var u,l;(u=i.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties)===null||u===void 0||u.detach(o),(l=i.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties)===null||l===void 0||l.detach(o)}e.releaseDependencies=a})(ya||(ya={}));function L9(e){return e.map(function(t){return[t.name,t.provider.label,t.provider.category]})}var FZ=function(){function e(t,r){var n=this;this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,Uu(t,function(a,i){if(a.name!==i)throw new Error("Fix build in themes to have matching names. "+a.name+" "+i);n.add(a)})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return L9(this._list)},enumerable:!1,configurable:!0}),e.prototype.sort=function(){this._list.sort(function(t,r){return t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1})},e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");var r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()},e.prototype.remove=function(t){this._list.splice(this._list.findIndex(function(n){return n.name===t.name}),1);var r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))},e.prototype.has=function(t){return this._map.has(t.name)},e.prototype.get=function(t){return this._map.get(t)||this.emptyProvider},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered theme provider.");return this._name.get(t)},e.prototype.create=function(t,r,n){n===void 0&&(n={});var a=this.get(t);return a.factory(r,E(E({},T.getDefaultValues(a.getParams(r))),n))},e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return L9(this.getApplicableList(t))},e}();function N3(e){return Object.keys(e)}function bD(e){throw new Error("unreachable")}function uO(e){return typeof(e==null?void 0:e.then)=="function"}var tr;(function(e){e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear"})(tr||(tr={}));var Mo;(function(e){e.is=mi.has,e.All=tr.Highlight|tr.RemoveHighlight|tr.Select|tr.Deselect|tr.Toggle|tr.Clear,e.Highlighting=tr.Highlight|tr.RemoveHighlight|tr.Clear,e.Selecting=tr.Select|tr.Deselect|tr.Toggle|tr.Clear})(Mo||(Mo={}));function p_(e,t,r){switch(r){case tr.Highlight:e[t]|=1;break;case tr.RemoveHighlight:e[t]&=-2;break;case tr.Select:e[t]|=2;break;case tr.Deselect:e[t]&=-3;break;case tr.Toggle:e[t]^=2;break;case tr.Clear:e[t]=0;break}}function Hu(e,t,r){if(r===tr.None)return!1;if(Re.is(t)){var n=Re.start(t),a=Re.end(t),i=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),o=n+3>>2,s=o+(a-4*o>>2),u=n,l=Math.min(4*o,a),c=Math.max(n,4*s),d=a;switch(r){case tr.Highlight:for(var f=o;f<s;++f)i[f]|=16843009;break;case tr.RemoveHighlight:for(var f=o;f<s;++f)i[f]&=-16843010;break;case tr.Select:for(var f=o;f<s;++f)i[f]|=33686018;break;case tr.Deselect:for(var f=o;f<s;++f)i[f]&=-33686019;break;case tr.Toggle:for(var f=o;f<s;++f)i[f]^=33686018;break;case tr.Clear:for(var f=o;f<s;++f)i[f]=0;break;default:bD()}for(var f=u;f<l;++f)p_(e,f,r);for(var f=c;f<d;++f)p_(e,f,r)}else switch(r){case tr.Highlight:for(var f=0,h=t.length;f<h;++f)e[t[f]]|=1;break;case tr.RemoveHighlight:for(var f=0,h=t.length;f<h;++f)e[t[f]]&=-2;break;case tr.Select:for(var f=0,h=t.length;f<h;++f)e[t[f]]|=2;break;case tr.Deselect:for(var f=0,h=t.length;f<h;++f)e[t[f]]&=-3;break;case tr.Toggle:for(var f=0,h=t.length;f<h;++f)e[t[f]]^=2;break;case tr.Clear:for(var f=0,h=t.length;f<h;++f)e[t[f]]=0;break;default:bD()}return!0}var LUe={kind:"every-loci"};function js(e){return!!e&&e.kind==="every-loci"}var Or={kind:"empty-loci"};function Mu(e){return!!e&&e.kind==="empty-loci"}function t1(e){return!!e&&e.kind==="data-loci"}function NUe(e,t){if(!MC(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(var r=0,n=e.elements.length;r<n;++r)if(!MC(e.elements[r],t.elements[r]))return!1;return!0}function FUe(e){return e.elements.length===0}function F3(e,t,r,n,a){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:a}}var or;(function(e){var t=new ls("98");function r(p){var g=p.loci.map(function(C){return s(C)}).filter(function(C){return!!C});t.reset();for(var m=0,y=g;m<y.length;m++){var b=y[m];t.includePositionRadius(b.center,b.radius)}t.finishedIncludeStep();for(var S=0,x=g;S<x.length;S++){var b=x[S];t.radiusPositionRadius(b.center,b.radius)}return t.getSphere()}e.getBundleBoundingSphere=r;function n(p,g){return js(p)&&js(g)||Mu(p)&&Mu(g)?!0:t1(p)&&t1(g)?NUe(p,g):tt.isLoci(p)&&tt.isLoci(g)?tt.areLociEqual(p,g):Oe.is(p)&&Oe.is(g)?Oe.areEqual(p,g):Gt.isLoci(p)&&Gt.isLoci(g)?Gt.areLociEqual(p,g):kr.isLoci(p)&&kr.isLoci(g)?kr.areLociEqual(p,g):Ki.isLoci(p)&&Ki.isLoci(g)?Ki.areLociEqual(p,g):_t.isLoci(p)&&_t.isLoci(g)?_t.areLociEqual(p,g):_t.Isosurface.isLoci(p)&&_t.Isosurface.isLoci(g)?_t.Isosurface.areLociEqual(p,g):_t.Cell.isLoci(p)&&_t.Cell.isLoci(g)?_t.Cell.areLociEqual(p,g):!1}e.areEqual=n;function a(p){return!!p&&p.kind==="every-loci"}e.isEvery=a;function i(p){return js(p)?!1:Mu(p)?!0:t1(p)?FUe(p):tt.isLoci(p)?tt.isLociEmpty(p):Oe.is(p)?Oe.isEmpty(p):Gt.isLoci(p)?Gt.isLociEmpty(p):kr.isLoci(p)?kr.isLociEmpty(p):Ki.isLoci(p)?Ki.isLociEmpty(p):_t.isLoci(p)?_t.isLociEmpty(p):_t.Isosurface.isLoci(p)?_t.Isosurface.isLociEmpty(p):_t.Cell.isLoci(p)?_t.Cell.isLociEmpty(p):!1}e.isEmpty=i;function o(p,g){return g instanceof tt&&(Oe.is(p)?p=Oe.remap(p,g):tt.isLoci(p)?p=tt.remapLoci(p,g):Gt.isLoci(p)&&(p=Gt.remapLoci(p,g))),p}e.remap=o;function s(p,g){var m;if(!(p.kind==="every-loci"||p.kind==="empty-loci")){if(g||(g=je()),p.kind==="structure-loci")return je.copy(g,p.structure.boundary.sphere);if(p.kind==="element-loci")return je.copy(g,Oe.getBoundary(p).sphere);if(p.kind==="bond-loci")return Gt.getBoundingSphere(p,g);if(p.kind==="shape-loci")return je.copy(g,p.shape.geometry.boundingSphere);if(p.kind==="group-loci")return Ki.getBoundingSphere(p,g);if(p.kind==="data-loci")return(m=p.getBoundingSphere)===null||m===void 0?void 0:m.call(p,g);if(p.kind==="volume-loci")return _t.getBoundingSphere(p.volume,g);if(p.kind==="isosurface-loci")return _t.Isosurface.getBoundingSphere(p.volume,p.isoValue,g);if(p.kind==="cell-loci")return _t.Cell.getBoundingSphere(p.volume,p.indices,g)}}e.getBoundingSphere=s;var u=je.zero();function l(p,g){var m=s(p,u);return m?_.copy(g||_(),m.center):void 0}e.getCenter=l;function c(p){if(!(p.kind==="every-loci"||p.kind==="empty-loci")){if(p.kind==="structure-loci")return Oe.getPrincipalAxes(tt.toStructureElementLoci(p.structure));if(p.kind==="element-loci")return Oe.getPrincipalAxes(p);if(p.kind==="bond-loci")return;if(p.kind==="shape-loci")return;if(p.kind==="group-loci")return;if(p.kind==="data-loci")return;if(p.kind==="volume-loci")return;if(p.kind==="isosurface-loci")return;if(p.kind==="cell-loci")return}}e.getPrincipalAxes=c;var d={element:function(p){return p},residue:function(p){return Oe.is(p)?Oe.extendToWholeResidues(p,!0):p},chain:function(p){return Oe.is(p)?Oe.extendToWholeChains(p):p},entity:function(p){return Oe.is(p)?Oe.extendToWholeEntities(p):p},model:function(p){return Oe.is(p)?Oe.extendToWholeModels(p):p},operator:function(p){return Oe.is(p)?Oe.extendToWholeOperators(p):p},structure:function(p){return Oe.is(p)?tt.toStructureElementLoci(p.structure):Ki.isLoci(p)?kr.Loci(p.shape):p},elementInstances:function(p){return Oe.is(p)?Oe.extendToAllInstances(p):p},residueInstances:function(p){return Oe.is(p)?Oe.extendToAllInstances(Oe.extendToWholeResidues(p,!0)):p},chainInstances:function(p){return Oe.is(p)?Oe.extendToAllInstances(Oe.extendToWholeChains(p)):p}};e.GranularityOptions=T.objectToOptions(d,function(p){switch(p){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return p.indexOf("Instances")?[Yo(p),"With Symmetry"]:Yo(p)}});function f(p){return p.replace("Instances","")}e.simpleGranularity=f;function h(p,g){return d[g](p)}e.applyGranularity=h;function v(p,g){return g!=="element"&&Gt.isLoci(p)&&(p=Gt.toStructureElementLoci(p)),tt.isLoci(p)&&(p=tt.toStructureElementLoci(p.structure)),Oe.is(p)&&(p=Oe.remap(p,p.structure.root)),g&&(p=h(p,g)),p}e.normalize=v})(or||(or={}));function qa(e){return{layers:e}}(function(e){e.Empty={layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].clear!==c.layers[d].clear||l.layers[d].color!==c.layers[d].color||!or.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,h=l.layers;f<h.length;f++){var v=h[f],p=v.loci,g=v.color,m=v.clear;p=Oe.remap(p,c),Oe.isEmpty(p)||d.push({loci:p,color:g,clear:m})}return{layers:d}}e.remap=n;function a(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=Oe.none(c),h=0,v=l.layers.length;h<v;++h){var p=l.layers[v-h-1],g=p.loci,m=p.color,y=p.clear;if(g=Oe.subtract(g,f),f=Oe.union(g,f),!Oe.isEmpty(g)){var b=y?-1:m;d.has(b)&&(g=Oe.union(g,d.get(b))),d.set(b,g)}}var S=[];return d.forEach(function(x,C){var w=C===-1,A=C===-1?dt(0):C;S.push({loci:x,color:A,clear:w})}),{layers:S}}e.merge=a;function i(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],h=0,v=l.layers;h<v.length;h++){var p=v[h],g=p.loci,m=p.color,y=p.clear,b=Oe.remap(g,c);g=Oe.remap(b,d),Oe.isEmpty(g)||f.push({loci:g,color:m,clear:y})}return{layers:f}}e.filter=i;function o(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.script,g=v.color,m=v.clear,y=Va.toLoci(p,c);Oe.isEmpty(y)||d.push({loci:y,color:g,clear:m})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.bundle,g=v.color,m=v.clear,y=en.toLoci(p,c.root);d.push({loci:y,color:g,clear:m})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var h=l.layers[d],v=h.loci,p=h.color,g=h.clear,m=en.fromLoci(v);c.push({bundle:m,color:p,clear:g})}return{layers:c}}e.toBundle=u})(qa||(qa={}));function Wa(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].value!==c.layers[d].value||!or.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){if(l.kind==="element-loci"){for(var d=[],f=0,h=l.layers;f<h.length;f++){var v=h[f],p=Oe.remap(v.loci,c);Oe.isEmpty(p)||d.push({loci:p,value:v.value})}return{kind:"element-loci",layers:d}}else return l}e.remap=n;function a(l){if(r(l))return l;if(l.kind==="element-loci"){for(var c=l.layers[0].loci.structure,d=new Map,f=Oe.none(c),h=0,v=l.layers.length;h<v;++h){var p=l.layers[v-h-1],g=p.loci,m=p.value;g=Oe.subtract(g,f),f=Oe.union(g,f),Oe.isEmpty(g)||(d.has(m)&&(g=Oe.union(g,d.get(m))),d.set(m,g))}var y=[];return d.forEach(function(b,S){y.push({loci:b,value:S})}),{kind:"element-loci",layers:y}}else return l}e.merge=a;function i(l,c){if(r(l))return l;if(l.kind==="element-loci"){for(var d=l.layers[0].loci.structure,f=[],h=0,v=l.layers;h<v.length;h++){var p=v[h],g=p.loci,m=p.value,y=Oe.remap(g,c);g=Oe.remap(y,d),Oe.isEmpty(g)||f.push({loci:g,value:m})}return{kind:"element-loci",layers:f}}else return l}e.filter=i;function o(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.script,g=v.value,m=Va.toLoci(p,c);Oe.isEmpty(m)||d.push({loci:m,value:g})}return{kind:"element-loci",layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.bundle,g=v.value,m=en.toLoci(p,c.root);d.push({loci:m,value:g})}return{kind:"element-loci",layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var h=l.layers[d],v=h.loci,p=h.value,g=en.fromLoci(v);c.push({bundle:g,value:p})}return{kind:"element-loci",layers:c}}e.toBundle=u})(Wa||(Wa={}));var Ll;(function(e){function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}e.create=t;function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}e.reset=r})(Ll||(Ll={}));var BUe={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function BZ(e,t){t===void 0&&(t={});var r=E(E({},BUe),t),n=e.elementCount*r.elementCountFactor;return e.isCoarseGrained&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function UUe(e){if(e.root.models.length===1){var t=ca.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!Io.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return Yt.volume(e.root.boundary.box)}function xD(e,t){var r=Da(e.quality,"auto"),n=Da(e.detail,1),a=Da(e.radialSegments,12),i=Da(e.linearSegments,8),o=Da(e.resolution,2),s=Da(e.probePositions,12),u=Da(e.doubleSided,!0),l=0;if(r==="auto"){if(t instanceof tt)r=BZ(t.root),l=UUe(t);else if(_t.is(t)){var c=t.grid.cells.space.dimensions,d=c[0],f=c[1],h=c[2];l=d*f*h,r=l<1e7?"medium":"low"}}switch(r){case"highest":n=3,a=36,i=18,o=.1,s=72,u=!0;break;case"higher":n=3,a=28,i=14,o=.3,s=48,u=!0;break;case"high":n=2,a=20,i=10,o=.5,s=36,u=!0;break;case"medium":n=1,a=12,i=8,o=.8,s=24,u=!0;break;case"low":n=0,a=8,i=3,o=1.3,s=24,u=!1;break;case"lower":n=0,a=4,i=2,o=3,s=12,u=!1;break;case"lowest":n=0,a=2,i=1,o=8,s=12,u=!1;break}return o=Math.max(o,l/5e8),o=Math.min(o,20),(e.alpha!==void 0&&e.alpha<1||e.xrayShaded)&&(u=!1),{detail:n,radialSegments:a,linearSegments:i,resolution:o,probePositions:s,doubleSided:u}}var Cr;(function(e){function t(c,d){c&&(c.state.visible=d)}e.setVisibility=t;function r(c,d){c&&(c.state.alphaFactor=d)}e.setAlphaFactor=r;function n(c,d){c&&(c.state.pickable=d)}e.setPickable=n;function a(c,d){c&&(c.state.colorOnly=d)}e.setColorOnly=a;function i(c,d,f,h){if(!c)return!1;var v=c.values,p=v.tMarker,g=v.uGroupCount,m=v.instanceCount,y=g.ref.value*m.ref.value,b=p.ref.value.array,S=!1;return js(d)?S=Hu(b,Re.ofLength(y),f):Mu(d)||(S=h(d,function(x){return Hu(b,x,f)},!0)),S&&N.update(p,p.ref.value),S}e.mark=i;function o(c,d,f,h){if(c){var v=c.values,p=v.tOverpaint,g=v.uGroupCount,m=v.instanceCount,y=g.ref.value*m.ref.value;lOe(d.layers.length?y:0,c.values);var b=p.ref.value.array;h&&lU(b,0,y);for(var S=function(w,A){var I=d.layers[w],D=I.loci,k=I.color,R=I.clear,L=function(H){var B=Re.start(H),j=Re.end(H);return R?lU(b,B,j):uOe(b,B,j,k)};f(D,L,!1)},x=0,C=d.layers.length;x<C;++x)S(x);N.update(p,p.ref.value)}}e.setOverpaint=o;function s(c,d,f,h){if(c){var v=c.values,p=v.tTransparency,g=v.transparencyAverage,m=v.uGroupCount,y=v.instanceCount,b=m.ref.value*y.ref.value;fOe(d.layers.length?b:0,c.values);var S=p.ref.value.array;h&&dOe(S,0,b);for(var x=function(A,I){var D=d.layers[A],k=D.loci,R=D.value,L=function(H){var B=Re.start(H),j=Re.end(H);return cOe(S,B,j,R)};f(k,L,!1)},C=0,w=d.layers.length;C<w;++C)x(C);N.update(p,p.ref.value),N.updateIfChanged(g,YK(S,b))}}e.setTransparency=s;function u(c,d,f,h){if(c){var v=c.values,p=v.tClipping,g=v.uGroupCount,m=v.instanceCount,y=g.ref.value*m.ref.value;vOe(d.layers.length?y:0,c.values);var b=p.ref.value.array;h&&pOe(b,0,y);for(var S=function(w,A){var I=d.layers[w],D=I.loci,k=I.groups,R=function(L){var H=Re.start(L),B=Re.end(L);return hOe(b,H,B,k)};f(D,R,!1)},x=0,C=d.layers.length;x<C;++x)S(x);N.update(p,p.ref.value)}}e.setClipping=u;function l(c,d,f){if(!(!c||!d&&!f)){var h=c.values;d&&(le.copy(h.matrix.ref.value,d),N.update(h.matrix,h.matrix.ref.value)),f?(h.extraTransform.ref.value.set(f),N.update(h.extraTransform,h.extraTransform.ref.value)):f===null&&($C(h.extraTransform.ref.value,h.instanceCount.ref.value),N.update(h.extraTransform,h.extraTransform.ref.value)),xY(h);var v=Xa(h.invariantBoundingSphere.ref.value,h.aTransform.ref.value,h.instanceCount.ref.value);N.update(h.boundingSphere,v)}}e.setTransform=l})(Cr||(Cr={}));function an(e){return{layers:e}}(function(e){e.Empty={layers:[]},function(l){l.is=mi.has;function c(p){return mi.create(p)}l.create=c,l.Names={one:1,two:2,three:4,four:8,five:16,six:32};function d(p){return p in l.Names}l.isName=d;function f(p){switch(p){case"one":return 1;case"two":return 2;case"three":return 4;case"four":return 8;case"five":return 16;case"six":return 32}}l.fromName=f;function h(p){for(var g=0,m=0,y=p.length;m<y;++m)g|=f(p[m]);return g}l.fromNames=h;function v(p){var g=[];return l.is(p,1)&&g.push("one"),l.is(p,2)&&g.push("two"),l.is(p,4)&&g.push("three"),l.is(p,8)&&g.push("four"),l.is(p,16)&&g.push("five"),l.is(p,32)&&g.push("six"),g}l.toNames=v}(e.Groups||(e.Groups={})),e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].groups!==c.layers[d].groups||!or.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,h=l.layers;f<h.length;f++){var v=h[f],p=v.loci,g=v.groups;p=Oe.remap(p,c),Oe.isEmpty(p)||d.push({loci:p,groups:g})}return{layers:d}}e.remap=n;function a(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=Oe.none(c),h=0,v=l.layers.length;h<v;++h){var p=l.layers[v-h-1],g=p.loci,m=p.groups;g=Oe.subtract(g,f),f=Oe.union(g,f),Oe.isEmpty(g)||(d.has(m)&&(g=Oe.union(g,d.get(m))),d.set(m,g))}var y=[];return d.forEach(function(b,S){y.push({loci:b,groups:S})}),{layers:y}}e.merge=a;function i(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],h=0,v=l.layers;h<v.length;h++){var p=v[h],g=p.loci,m=p.groups,y=Oe.remap(g,c);g=Oe.remap(y,d),Oe.isEmpty(g)||f.push({loci:g,groups:m})}return{layers:f}}e.filter=i;function o(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.script,g=v.groups,m=Va.toLoci(p,c);Oe.isEmpty(m)||d.push({loci:m,groups:g})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.bundle,g=v.groups,m=en.toLoci(p,c.root);d.push({loci:m,groups:g})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var h=l.layers[d],v=h.loci,p=h.groups,g=en.fromLoci(v);c.push({bundle:g,groups:p})}return{layers:c}}e.toBundle=u})(an||(an={}));var N9;(function(e){function t(r,n,a){return T.getDefaultValues(r.getParams(n,a))}e.getDetaultParams=t})(N9||(N9={}));var jUe={label:"",description:"",factory:function(){return sr.Empty},getParams:function(){return{}},defaultValues:{}};function F9(e){return e.map(function(t){return[t.name,t.provider.label]})}var UZ=function(){function e(){this._list=[],this._map=new Map,this._name=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return F9(this._list)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered represenatation provider.");return this._name.get(t)},e.prototype.remove=function(t){var r=t.name;this._list.splice(this._list.findIndex(function(a){return a.name===r}),1);var n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))},e.prototype.get=function(t){return this._map.get(t)||jUe},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return F9(this.getApplicableList(t))},e}(),sr;(function(e){(function(i){function o(u,l){return u.repr===l.repr&&or.areEqual(u.loci,l.loci)}i.areEqual=o;function s(u){return or.isEmpty(u.loci)}i.isEmpty=s,i.Empty={loci:Or}})(e.Loci||(e.Loci={}));function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:le.identity(),overpaint:qa.Empty,transparency:Wa.Empty,clipping:an.Empty,markerActions:Mo.All}}e.createState=t;function r(i,o){o.visible!==void 0&&(i.visible=o.visible),o.alphaFactor!==void 0&&(i.alphaFactor=o.alphaFactor),o.pickable!==void 0&&(i.pickable=o.pickable),o.colorOnly!==void 0&&(i.colorOnly=o.colorOnly),o.overpaint!==void 0&&(i.overpaint=o.overpaint),o.transparency!==void 0&&(i.transparency=o.transparency),o.clipping!==void 0&&(i.clipping=o.clipping),o.syncManually!==void 0&&(i.syncManually=o.syncManually),o.transform!==void 0&&le.copy(i.transform,o.transform),o.markerActions!==void 0&&(i.markerActions=o.markerActions)}e.updateState=r,e.StateBuilder={create:t,update:r},e.Empty={label:"",groupCount:0,renderObjects:[],props:{},params:{},updated:new ta,state:t(),theme:ya.createEmpty(),createOrUpdate:function(){return et.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return Or},mark:function(){return!1},destroy:function(){}};function n(i,o,s,u,l){var c=this,d=0,f=new ta,h=u.create(),v=ya.createEmpty(),p,g,m,y={},b=Object.keys(l).map(function(S,x){y[x]=S;var C=l[S](o,s);return C.setState(h),C});return{label:i,updated:f,get groupCount(){var S=0;if(g)for(var x=g.visuals,C=0,w=b.length;C<w;++C)(!x||x.includes(y[C]))&&(S+=b[C].groupCount);return S},get renderObjects(){var S=[];if(g)for(var x=g.visuals,C=0,w=b.length;C<w;++C)(!x||x.includes(y[C]))&&S.push.apply(S,b[C].renderObjects);return S},get props(){return g},get params(){return p},createOrUpdate:function(S,x){S===void 0&&(S={}),x&&x!==m&&(p=s(o,x),m=x,g||(g=T.getDefaultValues(p)));var C=xD(Object.assign({},g,S),m);Object.assign(g,S,C);var w=g.visuals;return et.create("Creating or updating '"+i+"' representation",function(A){return de(c,void 0,void 0,function(){var I,D;return fe(this,function(k){switch(k.label){case 0:I=0,D=b.length,k.label=1;case 1:return I<D?!w||w.includes(y[I])?[4,b[I].createOrUpdate(g,m).runInContext(A)]:[3,3]:[3,4];case 2:k.sent(),k.label=3;case 3:return++I,[3,1];case 4:return f.next(d++),[2]}})})})},get state(){return h},get theme(){return v},getLoci:function(S){for(var x=g.visuals,C=0,w=b.length;C<w;++C)if(!x||x.includes(y[C])){var A=b[C].getLoci(S);if(!Mu(A))return A}return Or},mark:function(S,x){for(var C=!1,w=0,A=b.length;w<A;++w)C=b[w].mark(S,x)||C;return C},setState:function(S){u.update(h,S);for(var x=0,C=b.length;x<C;++x)b[x].setState(h)},setTheme:function(S){for(var x=0,C=b.length;x<C;++x)b[x].setTheme(S)},destroy:function(){for(var S=0,x=b.length;S<x;++S)b[S].destroy()}}}e.createMulti=n;function a(i,o){var s=this,u=0,l=new ta,c=e.createState(),d=ya.createEmpty(),f=T.clone(At.Params),h=T.getDefaultValues(At.Params);return{label:i,updated:l,get groupCount(){return o.values.uGroupCount.ref.value},get renderObjects(){return[o]},get props(){return h},get params(){return f},createOrUpdate:function(v){v===void 0&&(v={});var p=xD(Object.assign({},h,v));return Object.assign(h,v,p),et.create("Updating '"+i+"' representation",function(g){return de(s,void 0,void 0,function(){return fe(this,function(m){return l.next(u++),[2]})})})},get state(){return c},get theme(){return d},getLoci:function(){return Or},mark:function(v,p){return!1},setState:function(v){v.visible!==void 0&&Cr.setVisibility(o,v.visible),v.alphaFactor!==void 0&&Cr.setAlphaFactor(o,v.alphaFactor),v.pickable!==void 0&&Cr.setPickable(o,v.pickable),v.colorOnly!==void 0&&Cr.setColorOnly(o,v.colorOnly),v.overpaint,v.transparency,v.transform!==void 0&&Cr.setTransform(o,v.transform),e.updateState(c,v)},setTheme:function(){},destroy:function(){}}}e.fromRenderObject=a})(sr||(sr={}));function ka(e,t,r){r===void 0&&(r={});var n=0,a=new ta,i=sr.createState(),o=_d(),s=[],u,l,c=ya.createEmpty(),d=T.getDefaultValues(t.Params),f,h,v;r.modifyState&&sr.updateState(i,r.modifyState(i));var p=Ll.create();function g(b,S){Ll.reset(p),!(!S&&!l)&&(S&&!l?p.createNew=!0:S&&l&&S.id===l.id||(S&&l&&S.id!==l.id?(p.updateTransform=!0,p.createGeometry=!0):S&&console.warn("unexpected state")),p.updateTransform&&(p.updateColor=!0,p.updateSize=!0),p.createGeometry&&(p.updateColor=!0,p.updateSize=!0))}function m(b,S){var x=this;return b===void 0&&(b={}),r.modifyProps&&(b=r.modifyProps(b)),et.create("ShapeRepresentation.create",function(C){return de(x,void 0,void 0,function(){var w,A,I,D,k,R,L,H;return fe(this,function(B){switch(B.label){case 0:return w=Object.assign(d,b),S?[4,e(C,S,w,l)]:[3,2];case 1:return I=B.sent(),[3,3];case 2:I=void 0,B.label=3;case 3:if(A=I,g(b,A),A&&(l=A,Object.assign(c,kr.getTheme(l))),p.createNew)s.length=0,h=kr.groupIterator(l),D=kr.createTransform(l.transforms),k=t.createValues(l.geometry,D,h,c,w),R=t.createRenderableState(w),r.modifyState&&Object.assign(R,r.modifyState(R)),sr.updateState(i,R),u=a0(l.geometry.kind,k,R,o),u&&s.push(u),v=t.createPositionIterator(l.geometry,u.values);else{if(!u)throw new Error("expected renderObject to be available");p.updateTransform&&(kr.createTransform(l.transforms,u.values),h=kr.groupIterator(l),L=h.instanceCount,H=h.groupCount,Js(L*H,u.values)),p.createGeometry&&(N.updateIfChanged(u.values.drawCount,oi.getDrawCount(l.geometry)),N.updateIfChanged(u.values.uVertexCount,oi.getVertexCount(l.geometry))),(p.updateTransform||p.createGeometry)&&(t.updateBoundingSphere(u.values,l.geometry),v=t.createPositionIterator(l.geometry,u.values)),p.updateColor&&cs(h,v,c.color,u.values),p.updateSize&&"uSize"in u.values&&hd(h,c.size,u.values),t.updateValues(u.values,w),t.updateRenderableState(u.state,w)}return d=w,a.next(n++),[2]}})})})}function y(b,S){return js(b)||kr.isLoci(b)&&b.shape===l?S(Re.ofBounds(0,l.groupCount*l.transforms.length)):zUe(b,l,S)}return{label:"Shape geometry",get groupCount(){return h?h.count:0},get props(){return d},get params(){return f},get state(){return i},get theme(){return c},renderObjects:s,updated:a,createOrUpdate:m,getLoci:function(b){if(b===void 0)return kr.Loci(l);var S=b.objectId,x=b.groupId,C=b.instanceId;return u&&u.id===S?Ki.Loci(l,[{ids:Fe.ofSingleton(x),instance:C}]):Or},mark:function(b,S){if(!Mo.is(i.markerActions,S))return!1;if(Ki.isLoci(b)||kr.isLoci(b)){if(b.shape!==l)return!1}else if(!js(b))return!1;return Cr.mark(u,b,S,y)},setState:function(b){r.modifyState&&(b=r.modifyState(b)),u&&(b.visible!==void 0&&Cr.setVisibility(u,b.visible),b.alphaFactor!==void 0&&Cr.setAlphaFactor(u,b.alphaFactor),b.pickable!==void 0&&Cr.setPickable(u,b.pickable),b.colorOnly!==void 0&&Cr.setColorOnly(u,b.colorOnly),b.overpaint!==void 0&&Cr.setOverpaint(u,b.overpaint,y,!0),b.transparency!==void 0&&Cr.setTransparency(u,b.transparency,y,!0),b.transform!==void 0&&Cr.setTransform(u,b.transform)),sr.updateState(i,b)},setTheme:function(b){Mr&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){s.length=0,u&&(u.state.disposed=!0,u=void 0)}}}function zUe(e,t,r){if(!Ki.isLoci(e)||e.shape!==t)return!1;for(var n=!1,a=t.groupCount,i=e.groups,o=0,s=i;o<s.length;o++){var u=s[o],l=u.ids,c=u.instance;if(Re.is(l)){var d=c*a+Re.start(l),f=c*a+Re.end(l);r(Re.ofBounds(d,f))&&(n=!0)}else for(var h=0,v=l.length;h<v;h++){var p=c*a+l[h];r(Re.ofSingleton(p))&&(n=!0)}}return n}var B9=le(),Dg=function(){function e(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=Gs.Mutable(),this.groupIndexMap=Gs.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();for(var r=0,n=0,a=t.unitSymmetryGroups.length;n<a;++n){var i=t.unitSymmetryGroups[n];this.groupIndexMap.set(i.hashCode,n);var o=this.unitTransforms.subarray(r,r+i.units.length*16);this.groupUnitTransforms.push(o);for(var s=0,u=i.units.length;s<u;++s)this.unitOffsetMap.set(i.units[s].id,r+s*16);r+=i.units.length*16}}return e.prototype.reset=function(){this.version=0,$C(this.unitTransforms,this.size),this._isIdentity=!0},Object.defineProperty(e.prototype,"isIdentity",{get:function(){if(this._isIdentity===void 0){this._isIdentity=!0;for(var t=0,r=this.size*16;t<r;t+=16)if(le.fromArray(B9,this.unitTransforms,t),!le.isIdentity(B9)){this._isIdentity=!1;break}}return this._isIdentity},enumerable:!1,configurable:!0}),e.prototype.setTransform=function(t,r){this.version=(this.version+1)%2147483647,le.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0},e.prototype.getTransform=function(t,r){return le.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))},e.prototype.getSymmetryGroupTransforms=function(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]},e}(),U9=le.zero();function j9(e,t,r){for(var n=0,a=e.units.length;n<a;n++){var i=e.units[n];gn.lerpFromIdentity(U9,i.conformation.operator,r),t.setTransform(U9,i)}}var z9=_.zero(),Im=_.zero(),v_=le.zero();function V9(e,t,r){for(var n=e.boundary.sphere,a=n.radius*r,i=0,o=e.units.length;i<o;i++){var s=e.units[i];_.transformMat4(z9,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),_.sub(Im,z9,n.center),_.setMagnitude(Im,Im,a),le.fromTranslation(v_,Im),t.setTransform(v_,s)}}var VUe={axis:T.MappedStatic("custom",{structure:T.Group({principalAxis:T.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:T.Group({vector:T.Vec3(_.create(0,0,1))})}),origin:T.MappedStatic("structure",{structure:T.Group({}),custom:T.Group({vector:T.Vec3(_.create(0,0,0))})})};function H9(e,t){var r,n;if(t.axis.name==="custom")r=t.axis.params.vector;else{var a=tt.getPrincipalAxes(e);r=a.momentsAxes[t.axis.params.principalAxis]}if(t.origin.name==="custom")n=t.origin.params.vector;else{var a=tt.getPrincipalAxes(e);n=a.momentsAxes.origin}return{axis:r,origin:n}}var G9=le(),q9=le(),lx=le();function W9(e,t,r,n,a){for(var i=0,o=e.units.length;i<o;i++){var s=e.units[i];_.negate(Im,a),le.fromTranslation(v_,Im),le.fromRotation(G9,Math.PI*r*2,n),le.fromTranslation(q9,a),le.mul(lx,G9,v_),le.mul(lx,q9,lx),t.setTransform(lx,s)}}var HUe=le.fromTranslation(le(),_.create(.5,.5,.5)),GUe=ZK(QK(eQ()),HUe),ou=_(),$9=le(),qUe={origin:"Origin",model:"Model"},WUe={corner:"Corner",center:"Center"},$Ue=E(E({},Ft.Params),{cellColor:T.Color(dr.orange),cellScale:T.Numeric(2,{min:.1,max:5,step:.1}),ref:T.Select("model",T.objectToOptions(qUe),{isEssential:!0}),attachment:T.Select("corner",T.objectToOptions(WUe),{isEssential:!0})}),XUe={mesh:function(e,t){return ka(KUe,Ft.Utils)}},X9=E({},$Ue);function YUe(e,t,r){var n=Et.createState(256,128,r),a=e.symmetry.spacegroup.cell.fromFractional;_.copy(ou,e.ref),t.attachment==="center"?(_.trunc(ou,ou),_.subScalar(ou,ou,.5)):_.floor(ou,ou),le.fromTranslation($9,ou);var i=ZK(QK(GUe),$9),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,Et.addCage(n,a,i,o,2,20);var s=je.fromDimensionsAndTransform(je(),_.unit,a);_.transformMat4(ou,ou,a),je.translate(s,s,ou),je.expand(s,s,o);var u=Et.getMesh(n);return u.setBoundingSphere(s),u}function KUe(e,t,r,n){var a=YUe(t,r,n&&n.geometry),i=Q1.getUnitcellLabel(t.symmetry);return kr.create(i,t,a,function(){return r.cellColor},function(){return 1},function(){return i})}function Y9(e,t,r){var n=_();return r.ref==="model"&&_.transformMat4(n,Xt.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function QUe(e,t){return sr.createMulti("Unit Cell",e,t,sr.StateBuilder,XUe)}var gs=new Uint16Array([0,1,2,1,3,2]),Ih=Je.add3,Ja=Je.add2,K9=Je.add,Zc;(function(e){function t(r,n,a,i){r===void 0&&(r={}),n===void 0&&(n=2048),a===void 0&&(a=1024),n*=2,a*=2;var o=Je.create(Float32Array,3,a,i?i.centerBuffer.ref.value:n),s=Je.create(Float32Array,2,a,i?i.mappingBuffer.ref.value:n),u=Je.create(Float32Array,1,a,i?i.depthBuffer.ref.value:n),l=Je.create(Uint32Array,3,a,i?i.indexBuffer.ref.value:n),c=Je.create(Float32Array,1,a,i?i.groupBuffer.ref.value:n),d=Je.create(Float32Array,2,a,i?i.tcoordBuffer.ref.value:n),f=E(E({},T.getDefaultValues($s.Params)),r),h=f.attachment,v=f.background,p=f.backgroundMargin,g=f.tether,m=f.tetherLength,y=f.tetherBaseWidth,b=mOe(f),S=1/2.5*p,x=b.buffer/b.lineHeight,C=function(w,A,I,D,k){Ih(o,w,A,I),K9(u,D),K9(c,k)};return{add:function(w,A,I,D,k,R,L){for(var H=0,B=w.length,j=0;j<B;++j){var Q=b.get(w[j]);H+=Q.nw-2*x}var G=1/1.25,W,q;if(h.startsWith("top")?W=G:h.startsWith("middle")?W=G/2:W=0,h.endsWith("right")?q=H:h.endsWith("center")?q=H/2:q=0,g)switch(h){case"bottom-left":q-=m/2+S+.1,W-=m/2+S;break;case"bottom-center":W-=m+S;break;case"bottom-right":q+=m/2+S+.1,W-=m/2+S;break;case"middle-left":q-=m+S+.1;break;case"middle-center":break;case"middle-right":q+=m+S+.1;break;case"top-left":q-=m/2+S+.1,W+=m/2+S;break;case"top-center":W+=m+S;break;case"top-right":q+=m/2+S+.1,W+=m/2+S;break}var J=(-q-S-.1)*R,he=(H-q+S+.1)*R,$=(G-W+S)*R,X=(-W-S)*R;if(v){Ja(s,J,$),Ja(s,J,X),Ja(s,he,$),Ja(s,he,X);for(var U=o.elementCount,z=0;z<4;++z)Ja(d,10,10),C(A,I,D,k,L);Ih(l,U+gs[0],U+gs[1],U+gs[2]),Ih(l,U+gs[3],U+gs[4],U+gs[5])}if(g){var ee=void 0,Y=void 0,Z=void 0,te=void 0,ce=void 0,be=void 0,xe=void 0,Ie=void 0,_e=m*R,ae=y*R;switch(h){case"bottom-left":ee=J-_e/2,Z=J+ae/2,ce=J,xe=J,Y=X-_e/2,te=X,be=X+ae/2,Ie=X;break;case"bottom-center":ee=0,Z=ae/2,ce=-ae/2,xe=0,Y=X-_e,te=X,be=X,Ie=X;break;case"bottom-right":ee=he+_e/2,Z=he,ce=he-ae/2,xe=he,Y=X-_e/2,te=X+ae/2,be=X,Ie=X;break;case"middle-left":ee=J-_e,Z=J,ce=J,xe=J,Y=0,te=-ae/2,be=ae/2,Ie=0;break;case"middle-center":ee=0,Z=0,ce=0,xe=0,Y=0,te=0,be=0,Ie=0;break;case"middle-right":ee=he+_e,Z=he,ce=he,xe=he,Y=0,te=ae/2,be=-ae/2,Ie=0;break;case"top-left":ee=J-_e/2,Z=J+ae/2,ce=J,xe=J,Y=$+_e/2,te=$,be=$-ae/2,Ie=$;break;case"top-center":ee=0,Z=ae/2,ce=-ae/2,xe=0,Y=$+_e,te=$,be=$,Ie=$;break;case"top-right":ee=he+_e/2,Z=he,ce=he-ae/2,xe=he,Y=$+_e/2,te=$-ae/2,be=$,Ie=$;break;default:throw new Error("unsupported attachment")}Ja(s,ee,Y),Ja(s,Z,te),Ja(s,ce,be),Ja(s,xe,Ie);for(var U=o.elementCount,z=0;z<4;++z)Ja(d,10,10),C(A,I,D,k,L);Ih(l,U,U+1,U+3),Ih(l,U,U+3,U+2)}q+=x,W+=x;for(var ie=0,j=0;j<B;++j){var Q=b.get(w[j]),O=(ie-q)*R,V=(ie+Q.nw-q)*R,ve=(Q.nh-W)*R,Pe=-W*R;Ja(s,O,ve),Ja(s,O,Pe),Ja(s,V,ve),Ja(s,V,Pe);var Me=b.texture.width,Ge=b.texture.height;Ja(d,Q.x/Me,Q.y/Ge),Ja(d,Q.x/Me,(Q.y+Q.h)/Ge),Ja(d,(Q.x+Q.w)/Me,Q.y/Ge),Ja(d,(Q.x+Q.w)/Me,(Q.y+Q.h)/Ge),ie+=Q.nw-2*x;for(var U=o.elementCount,z=0;z<4;++z)C(A,I,D,k,L);Ih(l,U+gs[0],U+gs[1],U+gs[2]),Ih(l,U+gs[3],U+gs[4],U+gs[5])}},getText:function(){var w=b.texture,A=Je.compact(o,!0),I=Je.compact(s,!0),D=Je.compact(u,!0),k=Je.compact(l,!0),R=Je.compact(c,!0),L=Je.compact(d,!0);return $s.create(w,A,I,D,k,R,L,l.elementCount/2,i)}}}e.create=t})(Zc||(Zc={}));var i0={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function ih(e,t){switch(t===void 0&&(t={}),e.kind){case"structure-loci":return e.structure.models.map(function(l){return l.entry}).filter(function(l){return!!l}).join(", ");case"element-loci":return m_(Ef.ofLoci(e),t);case"bond-loci":var r=e.bonds[0];return r?lO(r):"";case"shape-loci":return e.shape.name;case"group-loci":var n=e.groups[0];return n?e.shape.getLabel(Fe.start(n.ids),n.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return[""+(e.volume.label||"Volume"),"Isosurface at "+_t.IsoValue.toString(e.isoValue)].join(" | ");case"cell-loci":var a=Fe.size(e.indices),i=Fe.start(e.indices),o=_t.IsoValue.absolute(e.volume.grid.cells.data[i]),s=_t.IsoValue.toRelative(o,e.volume.grid.stats),u=[""+(e.volume.label||"Volume"),a===1?"Cell #"+i:a+" Cells"];return a===1&&u.push(_t.IsoValue.toString(o)+" ("+_t.IsoValue.toString(s)+")"),u.join(" | ")}}function sm(e,t){return e===1?"1 "+t:e+" "+t+"s"}function z0(e,t,r,n,a,i){return du(t,{granularity:r,hidePrefix:n,reverse:a,condensed:i})+" <small>[+ "+sm(e-1,"other "+qg(r))+"]</small>"}function ZUe(e){var t=e.elements,r=e.model,n=r.atomicHierarchy,a=n.chainAtomSegments,i=n.residueAtomSegments,o=a.offsets[a.index[t[0]]],s=a.offsets[a.index[t[t.length-1]]+1]-1;return i.index[s]-i.index[o]+1}function m_(e,t){t===void 0&&(t={});var r=E(E({},i0),t),n=JUe(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:xf(n)}function JUe(e,t,r,n,a){t===void 0&&(t=!1),r===void 0&&(r=!1),n===void 0&&(n=!1),a===void 0&&(a=!1);var i=e.structureCount,o=e.chainCount,s=e.residueCount,u=e.conformationCount,l=e.elementCount;if(!t&&l===1&&s===0&&o===0)return du(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:a});if(!t&&l===0&&s===1&&o===0)return du(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:a});if(!t&&l===0&&s===0&&o===1){var c=e.firstChainLoc.unit,d=We.isAtomic(c)&&ZUe(c)===1||We.Traits.is(c.traits,1)?"residue":"chain";return du(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:d,reverse:a})}else if(t){var f=[];return i>0&&f.push(sm(i,"Structure")),o>0&&f.push(sm(o,"Chain")),s>0&&f.push(sm(s,"Residue")),u>0&&f.push(sm(u,"Conformation")),l>0&&f.push(sm(l,"Element")),f.join("<small> + </small>")}else{var f=[];return i>0&&f.push(i===1?du(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:a}):z0(i,e.firstStructureLoc,"structure",r,a,n)),o>0&&(f.push(o===1?du(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:a}):z0(o,e.firstChainLoc,"chain",r,a,n)),r=!0),s>0&&(f.push(s===1?du(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:a}):z0(s,e.firstResidueLoc,"residue",r,a,n)),r=!0),u>0&&(f.push(u===1?du(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:a}):z0(u,e.firstConformationLoc,"conformation",r,a,n)),r=!0),l>0&&f.push(l===1?du(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:a}):z0(l,e.firstElementLoc,"element",r,a,n)),f.join("<small> + </small>")}}function lO(e,t){return t===void 0&&(t={}),B3({loci:[Oe(e.aStructure,[{unit:e.aUnit,indices:Fe.ofSingleton(e.aIndex)}]),Oe(e.bStructure,[{unit:e.bUnit,indices:Fe.ofSingleton(e.bIndex)}])]},t)}function B3(e,t){t===void 0&&(t={});var r=E(E({},i0),t),n=e9e(e,r);return r.htmlStyling?n:xf(n)}function e9e(e,t){for(var r=t.granularity,n=t.hidePrefix,a=t.reverse,i=t.condensed,o=!0,s=0,u=e.loci;s<u.length;s++){var l=u[s];if(!Oe.is(l)||Oe.size(l)!==1){o=!1;break}}if(o){var c=e.loci.map(function(b){var S=b.elements[0],x=S.unit,C=S.indices;return at.create(b.structure,x,x.elements[Fe.start(C)])}),d=c.map(function(b){return jZ(b,r,n,a||i)});if(i)return d.map(function(b){return b[0].replace(/\[.*\]/g,"").trim()}).filter(function(b){return!!b}).join(" — ");for(var f=0,h=0,v=Math.min.apply(Math,d.map(function(b){return b.length}))-1;h<v;++h){for(var p=!0,g=1,m=d.length;g<m;++g)if(d[0][h]!==d[g][h]){p=!1;break}if(p)f+=1;else break}if(f>0){for(var y=[d[0].join(" | ")],g=1,m=d.length;g<m;++g)y.push(d[g].slice(f).filter(function(x){return!!x}).join(" | "));return y.join(" — ")}else return d.map(function(b){return b.filter(function(S){return!!S}).join(" | ")}).filter(function(b){return!!b}).join("</br>")}else{var d=e.loci.map(function(S){return ih(S,t)});return d.filter(function(S){return!!S}).join(i?" — ":"</br>")}}function du(e,t){var r,n;t===void 0&&(t={});var a=E(E({},i0),t),i=jZ(e,a.granularity,a.hidePrefix,a.reverse||a.condensed),o=a.condensed?(n=(r=i[0])===null||r===void 0?void 0:r.replace(/\[.*\]/g,"").trim())!==null&&n!==void 0?n:"":i.filter(function(s){return!!s}).join(" | ");return a.htmlStyling?o:xf(o)}function jZ(e,t,r,n){t===void 0&&(t="element"),r===void 0&&(r=!1),n===void 0&&(n=!1);var a=[];if(!r){var i=e.unit.model.entry;i.length>30&&(i=i.substr(0,27)+"…"),a.push("<small>"+i+"</small>"),t!=="structure"&&(a.push("<small>Model "+e.unit.model.modelNum+"</small>"),a.push("<small>Instance "+e.unit.conformation.operator.name+"</small>"))}return We.isAtomic(e.unit)?a.push.apply(a,t9e(e,t,n)):We.isCoarse(e.unit)?a.push.apply(a,r9e(e,t)):a.push("Unknown"),n?a.reverse():a}function t9e(e,t,r){r===void 0&&(r=!1);var n=at.residueIndex(e),a=pt.chain.label_asym_id(e),i=pt.chain.auth_asym_id(e),o=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===0,s=pt.residue.label_seq_id(e),u=pt.residue.auth_seq_id(e),l=pt.residue.pdbx_PDB_ins_code(e),c=pt.atom.label_comp_id(e),d=pt.atom.label_atom_id(e),f=pt.atom.label_alt_id(e),h=pt.atom.occupancy(e),v=pt.residue.microheterogeneityCompIds(e),p=t==="residue"&&v.length>1?"("+v.join("|")+")":c,g=[];switch(t){case"element":g.push("<b>"+d+"</b>"+(f?"%"+f:""));case"conformation":t==="conformation"&&f&&g.push("<small>Conformation</small> <b>"+f+"</b>");case"residue":var m=s===u||!o?u:s;g.push("<b>"+p+" "+m+"</b>"+(m!==u?" <small>[auth</small> <b>"+u+"</b><small>]</small>":"")+"<b>"+(l||"")+"</b>");case"chain":a===i?g.push("<b>"+a+"</b>"):t==="chain"&&We.Traits.is(e.unit.traits,1)?g.push("<small>[auth</small> <b>"+i+"</b><small>]</small>"):g.push("<b>"+a+"</b> <small>[auth</small> <b>"+i+"</b><small>]</small>")}return g.length>0&&h!==1&&!r&&(g[0]=g[0]+" <small>[occupancy</small> <b>"+Math.round(100*h)/100+"</b><small>]</small>"),g.reverse()}function r9e(e,t){var r=pt.coarse.asym_id(e),n=pt.coarse.seq_id_begin(e),a=pt.coarse.seq_id_end(e),i=[];switch(t){case"element":case"conformation":case"residue":if(n===a){var o=pt.coarse.entityKey(e),s=e.unit.model.sequence.byEntityKey[o],u=s.sequence.compId.value(n-1);i.push("<b>"+u+" "+n+"</b>")}else i.push("<b>"+n+"-"+a+"</b>");case"chain":i.push("<b>"+r+"</b>")}return i.reverse()}function U3(e,t){t===void 0&&(t={});var r=E(E(E({},i0),{measureOnly:!1,unitLabel:"Å"}),t),n=e.loci.map(function(u){return or.getCenter(u)}),a=n[0],i=n[1],o=_.distance(a,i).toFixed(2)+" "+r.unitLabel;if(r.measureOnly)return o;var s=B3(e,r);return r.condensed?o+" | "+s:"Distance "+o+"</br>"+s}function j3(e,t){t===void 0&&(t={});var r=E(E(E({},i0),{measureOnly:!1}),t),n=e.loci.map(function(d){return or.getCenter(d)}),a=n[0],i=n[1],o=n[2],s=_.sub(_(),a,i),u=_.sub(_(),o,i),l=Au(_.angle(s,u)).toFixed(2)+"°";if(r.measureOnly)return l;var c=B3(e,r);return r.condensed?l+" | "+c:"Angle "+l+"</br>"+c}function z3(e,t){t===void 0&&(t={});var r=E(E(E({},i0),{measureOnly:!1}),t),n=e.loci.map(function(c){return or.getCenter(c)}),a=n[0],i=n[1],o=n[2],s=n[3],u=Au(_.dihedralAngle(a,i,o,s)).toFixed(2)+"°";if(r.measureOnly)return u;var l=B3(e,r);return r.condensed?u+" | "+l:"Dihedral "+u+"</br>"+l}var zZ={customText:T.Text("",{label:"Text",description:"Override the label with custom value."}),textColor:T.Color(dr.black,{isEssential:!0}),textSize:T.Numeric(.5,{min:.1,max:5,step:.1},{isEssential:!0})},V3=E(E(E({},$s.Params),zZ),{borderWidth:T.Numeric(.2,{min:0,max:.5,step:.01})}),VZ={unitLabel:T.Text("Å",{isEssential:!0})},n9e=E(E(E({},Cn.Params),VZ),{lineSizeAttenuation:T.Boolean(!0),linesColor:T.Color(dr.lightgreen,{isEssential:!0}),linesSize:T.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:T.Numeric(.2,{min:.01,max:.2,step:.01})}),a9e=E(E({},V3),VZ),HZ={lines:function(e,t){return ka(s9e,Cn.Utils,{modifyState:function(r){return E(E({},r),{markerActions:Mo.Highlighting})}})},text:function(e,t){return ka(l9e,$s.Utils,{modifyState:function(r){return E(E({},r),{markerActions:tr.None})}})}},Q9=E(E(E({},n9e),a9e),{visuals:T.MultiSelect(["lines","text"],T.objectToOptions(HZ))});function i9e(){return{sphereA:je(),sphereB:je(),center:_(),distance:0}}function GZ(e,t){var r=t.sphereA,n=t.sphereB,a=t.center,i=e.loci,o=i[0],s=i[1];return or.getBoundingSphere(o,r),or.getBoundingSphere(s,n),_.add(a,r.center,n.center),_.scale(a,a,.5),t.distance=_.distance(r.center,n.center),t}var vf=i9e();function qZ(e,t){return e.pairs.length===1?"Distance "+U3(e.pairs[0],{unitLabel:t,measureOnly:!0}):e.pairs.length+" Distances"}function o9e(e,t,r){for(var n=is.create(128,64,r),a=0,i=e.pairs.length;a<i;++a)GZ(e.pairs[a],vf),n.addFixedLengthDashes(vf.sphereA.center,vf.sphereB.center,t.dashLength,a);return n.getLines()}function s9e(e,t,r,n){var a=o9e(t,r,n&&n.geometry),i=qZ(t,r.unitLabel),o=function(s){return U3(t.pairs[s],r)};return kr.create(i,t,a,function(){return r.linesColor},function(){return r.linesSize},o)}function u9e(e,t,r){for(var n=Zc.create(t,128,64,r),a=0,i=e.pairs.length;a<i;++a){GZ(e.pairs[a],vf);var o=vf.center,s=vf.distance,u=vf.sphereA,l=vf.sphereB,c=t.customText||s.toFixed(2)+" "+t.unitLabel,d=Math.max(2,u.radius,l.radius),f=d/2;n.add(c,o[0],o[1],o[2],1,f,a)}return n.getText()}function l9e(e,t,r,n){var a=u9e(t,r,n&&n.geometry),i=qZ(t,r.unitLabel),o=function(s){return U3(t.pairs[s],r)};return kr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function c9e(e,t){return sr.createMulti("Distance",e,t,sr.StateBuilder,HZ)}function Z9(e){var t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function J9(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function ej(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci,a=e[3].loci;return{quads:[{loci:[t,r,n,a]}]}}function tj(e){var t=e[0].loci;return{infos:[{loci:t}]}}function rj(e){var t=e[0].loci;return{locis:[t]}}var d9e=E(E({},V3),{offsetZ:T.Numeric(2,{min:0,max:10,step:.1})}),WZ={text:function(e,t){return ka(v9e,$s.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})}},nj=E(E({},d9e),{scaleByRadius:T.Boolean(!0),visuals:T.MultiSelect(["text"],T.objectToOptions(WZ))}),f9e=je();function cO(e,t){return t===void 0&&(t=!1),e.label||ih(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function h9e(e){return e.infos.length===1?cO(e.infos[0]):e.infos.length+" Labels"}function p9e(e,t,r){for(var n=Zc.create(t,128,64,r),a=t.customText.trim(),i=0,o=e.infos.length;i<o;++i){var s=e.infos[i],u=or.getBoundingSphere(s.loci,f9e);if(u){var l=u.center,c=u.radius,d=a||cO(s,!0);n.add(d,l[0],l[1],l[2],t.scaleByRadius?c/.9:0,t.scaleByRadius?Math.max(1,c):1,i)}}return n.getText()}function v9e(e,t,r,n){var a=p9e(t,r,n&&n.geometry),i=h9e(t),o=r.customText.trim(),s=o?function(u){return o}:function(u){return cO(t.infos[u])};return kr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},s)}function m9e(e,t){return sr.createMulti("Label",e,t,sr.StateBuilder,WZ)}var Mh=_(),g9e=le.identity(),Dh=new Float32Array(6*3),y9e=new Uint8Array([0,1,2,3,4,5]);function b9e(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC;_.add(Mh,i,o),_.toArray(_.add(Mh,i,o),Dh,0),_.toArray(_.sub(Mh,i,o),Dh,3),_.toArray(_.add(Mh,i,s),Dh,6),_.toArray(_.sub(Mh,i,s),Dh,9),_.toArray(_.add(Mh,i,u),Dh,12),_.toArray(_.sub(Mh,i,u),Dh,15);var l=Zk(Dh,y9e),c=Su.volume(t),d=Math.cbrt(c)/300*r;Et.addCage(e,g9e,l,d,n,a)}_.zero();_.zero();var Od=_(),x9e=_(),S9e=_(),C9e=_(),_9e=le.identity(),aj=new Float32Array(8*3),w9e=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function E9e(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC,l=_.negate(x9e,o),c=_.negate(S9e,s),d=_.negate(C9e,u),f=0,h=function(m,y,b){_.copy(Od,i),_.add(Od,Od,m),_.add(Od,Od,y),_.add(Od,Od,b),_.toArray(Od,aj,f),f+=3};h(o,s,u),h(o,s,d),h(o,c,d),h(o,c,u),h(l,c,d),h(l,c,u),h(l,s,u),h(l,s,d);var v=Zk(aj,w9e),p=Su.volume(t),g=Math.cbrt(p)/300*r;Et.addCage(e,_9e,v,g,n,a)}var A9e=le.identity(),ij=_();function P9e(e,t,r,n,a){return _.add(ij,t,r),le.targetTo(e,t,ij,n),le.setTranslation(e,t),le.scale(e,e,a)}function dO(e,t,r,n,a,i){Et.addPrimitive(e,P9e(A9e,t,r,n,a),yQ(i))}var fO={color:T.Color(dr.orange),scale:T.Numeric(2,{min:.1,max:10,step:.1})},T9e=E(E({},Ft.Params),fO),I9e=E(E({},Ft.Params),fO);E(E({},Ft.Params),fO);var $Z={axes:function(e,t){return ka(D9e,Ft.Utils)},box:function(e,t){return ka(k9e,Ft.Utils)},ellipsoid:function(e,t){return ka(L9e,Ft.Utils)}},oj=E(E(E({},T9e),I9e),{visuals:T.MultiSelect(["box"],T.objectToOptions($Z)),color:T.Color(dr.orange),scale:T.Numeric(2,{min:.1,max:5,step:.1})});function H3(e){var t=ih(e,{countsOnly:!0});return"Principal Axes of "+t}function hO(e){return e.locis.length===1?H3(e.locis[0]):e.locis.length+" Orientations"}function M9e(e,t,r){for(var n=Et.createState(256,128,r),a=0,i=e.locis.length;a<i;++a){var o=or.getPrincipalAxes(e.locis[a]);o&&(n.currentGroup=a,b9e(n,o.momentsAxes,t.scale,2,20))}return Et.getMesh(n)}function D9e(e,t,r,n){var a=M9e(t,r,n&&n.geometry),i=hO(t),o=function(s){return H3(t.locis[s])};return kr.create(i,t,a,function(){return r.color},function(){return 1},o)}function R9e(e,t,r){for(var n=Et.createState(256,128,r),a=0,i=e.locis.length;a<i;++a){var o=or.getPrincipalAxes(e.locis[a]);o&&(n.currentGroup=a,E9e(n,o.boxAxes,t.scale,2,20))}return Et.getMesh(n)}function k9e(e,t,r,n){var a=R9e(t,r,n&&n.geometry),i=hO(t),o=function(s){return H3(t.locis[s])};return kr.create(i,t,a,function(){return r.color},function(){return 1},o)}function O9e(e,t,r){for(var n=Et.createState(256,128,r),a=0,i=e.locis.length;a<i;++a){var o=or.getPrincipalAxes(e.locis[a]);if(o){var s=o.boxAxes,u=s.origin,l=s.dirA,c=s.dirB,d=Su.size(_(),s);_.scale(d,d,.5);var f=_.create(d[2],d[1],d[0]);n.currentGroup=a,dO(n,u,l,c,f,2)}}return Et.getMesh(n)}function L9e(e,t,r,n){var a=O9e(t,r,n&&n.geometry),i=hO(t),o=function(s){return H3(t.locis[s])};return kr.create(i,t,a,function(){return r.color},function(){return 1},o)}function N9e(e,t){var r=sr.createMulti("Orientation",e,t,sr.StateBuilder,$Z);return r.setState({markerActions:Mo.Highlighting}),r}var F9e={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function XZ(e){var t=E(E({},F9e),e),r=t.radius,n=t.segments,a=t.thetaStart,i=t.thetaLength,o=i===Math.PI*2,s=o?n+1:n+2,u=new Float32Array(s*3),l=new Float32Array(s*3),c=new Uint32Array(n*3);u[0]=0,u[1]=0,u[2]=0,l[0]=0,l[1]=1,l[2]=0;for(var d=0,f=3;d<n;++d,f+=3){var h=a+d/n*i;u[f]=r*Math.sin(h),u[f+1]=0,u[f+2]=r*Math.cos(h),l[f]=0,l[f+1]=1,l[f+2]=0}for(var d=1,f=0;d<n;++d,f+=3)c[f]=d,c[f+1]=d+1,c[f+2]=0;if(o){var v=(n-1)*3;c[v]=n,c[v+1]=1,c[v+2]=0}else{var h=a+i,f=(n+1)*3;u[f]=r*Math.sin(h),u[f+1]=0,u[f+2]=r*Math.cos(h),l[f]=0,l[f+1]=1,l[f+2]=0;var v=(n-1)*3;c[v]=n,c[v+1]=n+1,c[v+2]=0}return{vertices:u,normals:l,indices:c}}var YZ={color:T.Color(dr.lightgreen),arcScale:T.Numeric(.7,{min:.01,max:1,step:.01})},KZ=E(E(E({},Cn.Params),YZ),{lineSizeAttenuation:T.Boolean(!0),linesSize:T.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:T.Numeric(.04,{min:.01,max:.2,step:.01})}),B9e=E({},KZ),U9e=E({},KZ),j9e=E(E(E({},Ft.Params),YZ),{ignoreLight:T.Boolean(!0),sectorOpacity:T.Numeric(.75,{min:0,max:1,step:.01})}),QZ={vectors:function(e,t){return ka(H9e,Cn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arc:function(e,t){return ka(q9e,Cn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},sector:function(e,t){return ka($9e,Ft.Utils,{modifyProps:function(r){return E(E({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return E(E({},r),{markerActions:Mo.Highlighting})}})},text:function(e,t){return ka(Y9e,$s.Utils,{modifyState:function(r){return E(E({},r),{markerActions:tr.None})}})}},sj=E(E(E(E(E({},B9e),U9e),j9e),V3),{visuals:T.MultiSelect(["vectors","sector","text"],T.objectToOptions(QZ))});function z9e(){return{sphereA:je(),sphereB:je(),sphereC:je(),arcDirA:_(),arcDirC:_(),arcNormal:_(),radius:0,angle:0}}var Ld=_(),V0=le();function G3(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.arcDirA,s=t.arcDirC,u=t.arcNormal,l=e.loci,c=l[0],d=l[1],f=l[2];or.getBoundingSphere(c,n),or.getBoundingSphere(d,a),or.getBoundingSphere(f,i),_.sub(o,n.center,a.center),_.sub(s,i.center,a.center),_.cross(u,o,s);var h=Math.min(_.magnitude(o),_.magnitude(s)),v=h*r;return t.radius=v,t.angle=_.angle(o,s),t}function ZZ(e,t){var r=e.radius,n=e.angle,a=t?mX(n,r)/t:32;le.targetTo(V0,e.sphereB.center,e.sphereA.center,e.arcNormal),le.setTranslation(V0,e.sphereB.center),le.mul(V0,V0,le.rotY180);var i=XZ({radius:r,thetaLength:n,segments:a});return Qk(i,V0)}var ri=z9e();function q3(e){return e.triples.length===1?"Angle "+j3(e.triples[0],{measureOnly:!0}):e.triples.length+" Angles"}function V9e(e,t,r){for(var n=is.create(128,64,r),a=0,i=e.triples.length;a<i;++a)G3(e.triples[a],ri,t.arcScale),n.addFixedLengthDashes(ri.sphereB.center,ri.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(ri.sphereB.center,ri.sphereC.center,t.dashLength,a);return n.getLines()}function H9e(e,t,r,n){var a=V9e(t,r,n&&n.geometry),i=q3(t);return kr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function G9e(e,t,r){for(var n=is.create(128,64,r),a=0,i=e.triples.length;a<i;++a){G3(e.triples[a],ri,t.arcScale);for(var o=ZZ(ri,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,h=u[d],v=u[d+1],p=u[d+2],g=u[f],m=u[f+1],y=u[f+2];n.add(h,v,p,g,m,y,a)}}return n.getLines()}function q9e(e,t,r,n){var a=G9e(t,r,n&&n.geometry),i=q3(t);return kr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function W9e(e,t,r){for(var n=Et.createState(128,64,r),a=0,i=e.triples.length;a<i;++a){G3(e.triples[a],ri,t.arcScale);var o=ZZ(ri);n.currentGroup=a,Et.addPrimitive(n,le.id,o),Et.addPrimitiveFlipped(n,le.id,o)}return Et.getMesh(n)}function $9e(e,t,r,n){var a=W9e(t,r,n&&n.geometry),i=q3(t),o=function(s){return j3(t.triples[s])};return kr.create(i,t,a,function(){return r.color},function(){return 1},o)}function X9e(e,t,r){for(var n=Zc.create(t,128,64,r),a=0,i=e.triples.length;a<i;++a){G3(e.triples[a],ri,t.arcScale),_.add(Ld,ri.arcDirA,ri.arcDirC),_.setMagnitude(Ld,Ld,ri.radius),_.add(Ld,ri.sphereB.center,Ld);var o=Au(ri.angle).toFixed(2),s=t.customText||o+"°",u=Math.max(2,ri.sphereA.radius,ri.sphereB.radius,ri.sphereC.radius),l=u/2;n.add(s,Ld[0],Ld[1],Ld[2],.1,l,a)}return n.getText()}function Y9e(e,t,r,n){var a=X9e(t,r,n&&n.geometry),i=q3(t),o=function(s){return j3(t.triples[s])};return kr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function K9e(e,t){return sr.createMulti("Angle",e,t,sr.StateBuilder,QZ)}var JZ={color:T.Color(dr.lightgreen),arcScale:T.Numeric(.7,{min:.01,max:1,step:.01})},W3=E(E(E({},Cn.Params),JZ),{lineSizeAttenuation:T.Boolean(!0),linesSize:T.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:T.Numeric(.04,{min:.01,max:.2,step:.01})}),Q9e=E({},W3),Z9e=E({},W3),J9e=E({},W3),eje=E({},W3),tje=E(E(E({},Ft.Params),JZ),{ignoreLight:T.Boolean(!0),sectorOpacity:T.Numeric(.75,{min:0,max:1,step:.01})}),eJ={vectors:function(e,t){return ka(aje,Cn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},extenders:function(e,t){return ka(cje,Cn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},connector:function(e,t){return ka(oje,Cn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arms:function(e,t){return ka(uje,Cn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arc:function(e,t){return ka(fje,Cn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},sector:function(e,t){return ka(pje,Ft.Utils,{modifyProps:function(r){return E(E({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return E(E({},r),{markerActions:Mo.Highlighting})}})},text:function(e,t){return ka(mje,$s.Utils,{modifyState:function(r){return E(E({},r),{markerActions:tr.None})}})}},uj=E(E(E(E(E(E(E({},Q9e),Z9e),J9e),eje),tje),V3),{visuals:T.MultiSelect(["extenders","arms","sector","text"],T.objectToOptions(eJ))});function rje(){return{sphereA:je(),sphereB:je(),sphereC:je(),sphereD:je(),dirBA:_(),dirCD:_(),projA:_(),projD:_(),arcPointA:_(),arcPointD:_(),arcDirA:_(),arcDirD:_(),arcCenter:_(),arcNormal:_(),radius:0,angle:0}}var Ti=_(),H0=le();function gv(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.sphereD,s=t.dirBA,u=t.dirCD,l=t.projA,c=t.projD,d=t.arcPointA,f=t.arcPointD,h=t.arcDirA,v=t.arcDirD,p=t.arcCenter,g=t.arcNormal,m=e.loci,y=m[0],b=m[1],S=m[2],x=m[3];or.getBoundingSphere(y,n),or.getBoundingSphere(b,a),or.getBoundingSphere(S,i),or.getBoundingSphere(x,o),_.add(p,a.center,i.center),_.scale(p,p,.5),_.sub(s,n.center,a.center),_.sub(u,o.center,i.center),_.add(d,p,s),_.add(f,p,u),_.sub(g,i.center,a.center),_.orthogonalize(h,g,s),_.orthogonalize(v,g,u),_.projectPointOnVector(l,d,h,p),_.projectPointOnVector(c,f,v,p);var C=Math.min(_.distance(l,p),_.distance(c,p)),w=C*r;_.setMagnitude(h,h,w),_.setMagnitude(v,v,w),_.add(d,p,h),_.add(f,p,v),t.radius=w,t.angle=_.dihedralAngle(n.center,a.center,i.center,o.center),_.matchDirection(Ti,g,_.sub(Ti,d,n.center));var A=_.angle(s,Ti),I=w/Math.cos(A-qy);_.add(l,a.center,_.setMagnitude(Ti,s,I)),_.matchDirection(Ti,g,_.sub(Ti,f,o.center));var D=_.angle(u,Ti),k=w/Math.cos(D-qy);return _.add(c,i.center,_.setMagnitude(Ti,u,k)),t}function tJ(e,t){var r=e.radius,n=e.angle,a=t?mX(n,r)/t:32;le.targetTo(H0,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),le.setTranslation(H0,e.arcCenter),le.mul(H0,H0,le.rotY180);var i=XZ({radius:r,thetaLength:Math.abs(n),segments:a});return Qk(i,H0)}var cn=rje();function yv(e){return e.quads.length===1?"Dihedral "+z3(e.quads[0],{measureOnly:!0}):e.quads.length+" Dihedrals"}function nje(e,t,r){for(var n=is.create(128,64,r),a=0,i=e.quads.length;a<i;++a)gv(e.quads[a],cn,t.arcScale),n.addFixedLengthDashes(cn.arcCenter,cn.arcPointA,t.dashLength,a),n.addFixedLengthDashes(cn.arcCenter,cn.arcPointD,t.dashLength,a);return n.getLines()}function aje(e,t,r,n){var a=nje(t,r,n&&n.geometry),i=yv(t);return kr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function ije(e,t,r){for(var n=is.create(128,64,r),a=0,i=e.quads.length;a<i;++a)gv(e.quads[a],cn,t.arcScale),n.addFixedLengthDashes(cn.sphereB.center,cn.sphereC.center,t.dashLength,a);return n.getLines()}function oje(e,t,r,n){var a=ije(t,r,n&&n.geometry),i=yv(t);return kr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function sje(e,t,r){for(var n=is.create(128,64,r),a=0,i=e.quads.length;a<i;++a)gv(e.quads[a],cn,t.arcScale),n.addFixedLengthDashes(cn.sphereB.center,cn.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(cn.sphereC.center,cn.sphereD.center,t.dashLength,a);return n.getLines()}function uje(e,t,r,n){var a=sje(t,r,n&&n.geometry),i=yv(t);return kr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function lje(e,t,r){for(var n=is.create(128,64,r),a=0,i=e.quads.length;a<i;++a)gv(e.quads[a],cn,t.arcScale),n.addFixedLengthDashes(cn.arcPointA,cn.projA,t.dashLength,a),n.addFixedLengthDashes(cn.arcPointD,cn.projD,t.dashLength,a);return n.getLines()}function cje(e,t,r,n){var a=lje(t,r,n&&n.geometry),i=yv(t);return kr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function dje(e,t,r){for(var n=is.create(128,64,r),a=0,i=e.quads.length;a<i;++a){gv(e.quads[a],cn,t.arcScale);for(var o=tJ(cn,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,h=u[d],v=u[d+1],p=u[d+2],g=u[f],m=u[f+1],y=u[f+2];n.add(h,v,p,g,m,y,a)}}return n.getLines()}function fje(e,t,r,n){var a=dje(t,r,n&&n.geometry),i=yv(t);return kr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function hje(e,t,r){for(var n=Et.createState(128,64,r),a=0,i=e.quads.length;a<i;++a){gv(e.quads[a],cn,t.arcScale);var o=tJ(cn);n.currentGroup=a,Et.addPrimitive(n,le.id,o),Et.addPrimitiveFlipped(n,le.id,o)}return Et.getMesh(n)}function pje(e,t,r,n){var a=hje(t,r,n&&n.geometry),i=yv(t),o=function(s){return z3(t.quads[s])};return kr.create(i,t,a,function(){return r.color},function(){return 1},o)}function vje(e,t,r){for(var n=Zc.create(t,128,64,r),a=0,i=e.quads.length;a<i;++a){gv(e.quads[a],cn,t.arcScale),_.add(Ti,cn.arcDirA,cn.arcDirD),_.setMagnitude(Ti,Ti,cn.radius),_.add(Ti,cn.arcCenter,Ti);var o=Au(cn.angle).toFixed(2);o==="-0.00"&&(o="0.00");var s=t.customText||o+"°",u=Math.max(2,cn.sphereA.radius,cn.sphereB.radius,cn.sphereC.radius,cn.sphereD.radius),l=u/2;n.add(s,Ti[0],Ti[1],Ti[2],.1,l,a)}return n.getText()}function mje(e,t,r,n){var a=vje(t,r,n&&n.geometry),i=yv(t),o=function(s){return z3(t.quads[s])};return kr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function gje(e,t){return sr.createMulti("Dihedral",e,t,sr.StateBuilder,eJ)}var yje=kt.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:ge.Root,to:ge.Shape.Provider,params:{bottomLeft:T.Vec3(_()),topRight:T.Vec3(_.create(1,1,1)),radius:T.Numeric(.15,{min:.01,max:4,step:.01}),color:T.Color(dr.red)}})({canAutoUpdate:function(){return!0},apply:function(e){var t=this,r=e.params;return et.create("Shape Representation",function(n){return de(t,void 0,void 0,function(){return fe(this,function(a){return[2,new ge.Shape.Provider({label:"Box",data:r,params:Ft.Params,getShape:function(i,o){var s=pO(Yt.create(r.bottomLeft,r.topRight),r.radius);return kr.create("Box",o,s,function(){return o.color},function(){return 1},function(){return"Box"})},geometryUtils:Ft.Utils},{label:"Box"})]})})})}});function pO(e,t,r){var n=_.sub(_(),e.max,e.min),a=le.fromTranslation(le(),_.create(.5,.5,.5)),i=le.fromScaling(le(),n),o=le.fromTranslation(le(),e.min),s=le.mul3(le(),o,i,a),u=Et.createState(256,128,r);u.currentGroup=1,Et.addCage(u,s,eQ(),t,2,20);var l=Et.getMesh(u),c=_.scaleAndAdd(_(),e.min,n,.5),d=_.distance(e.min,c);return l.setBoundingSphere(je.create(c,d)),l}const bje=Object.freeze(Object.defineProperty({__proto__:null,BoxShape3D:yje,getBoxMesh:pO},Symbol.toStringTag,{value:"Module"}));var g_=kt.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:ge.Molecule.Structure,to:ge.Molecule.Structure.Representation3D,params:function(e,t){var r=t.representation.structure,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e){var o={help:function(l){var c=l.name,d=l.params,f=a.colorThemeRegistry.get(c),h=f.factory({},d);return{description:h.description,legend:h.legend}}};return{type:T.Mapped(n.default.name,n.types,function(l){return T.Group(n.get(l).getParams(a,tt.Empty))}),colorTheme:T.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(l){return T.Group(a.colorThemeRegistry.get(l).getParams({structure:tt.Empty}))},o),sizeTheme:T.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(l){return T.Group(a.sizeThemeRegistry.get(l).getParams({structure:tt.Empty}))})}}var s={structure:e.data},u={help:function(l){var c=l.name,d=l.params,f=a.colorThemeRegistry.get(c),h=f.factory(s,d);return{description:h.description,legend:h.legend}}};return{type:T.Mapped(n.default.name,n.getApplicableTypes(e.data),function(l){return T.Group(n.get(l).getParams(a,e.data))}),colorTheme:T.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(s),function(l){return T.Group(a.colorThemeRegistry.get(l).getParams(s))},u),sizeTheme:T.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(l){return T.Group(a.sizeThemeRegistry.get(l).getParams(s))})}}})({canAutoUpdate:function(e){var t=e.a,r=e.oldParams,n=e.newParams;return t.data.elementCount<1e4||r.type.name===n.type.name&&n.type.params.quality!=="custom"},apply:function(e,t){var r=this,n=e.a,a=e.params;return e.cache,et.create("Structure Representation",function(i){return de(r,void 0,void 0,function(){var o,s,u,l,c,d,f;return fe(this,function(h){switch(h.label){case 0:return o={runtime:i,assetManager:t.managers.asset},s=t.representation.structure.registry.get(a.type.name),u=((d=s.getData)===null||d===void 0?void 0:d.call(s,n.data,a.type.params))||n.data,s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,u)]:[3,2];case 1:h.sent(),h.label=2;case 2:return l=s.factory(E({webgl:(f=t.canvas3d)===null||f===void 0?void 0:f.webgl},t.representation.structure.themes),s.getParams),[4,ya.ensureDependencies(o,t.representation.structure.themes,{structure:u},a)];case 3:return h.sent(),l.setTheme(ya.create(t.representation.structure.themes,{structure:u},a)),c=a.type.params||{},[4,l.createOrUpdate(c,u).runInContext(i)];case 4:return h.sent(),[2,new ge.Molecule.Structure.Representation3D({repr:l,sourceData:n.data},{label:s.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return e.cache,et.create("Structure Representation",function(s){return de(r,void 0,void 0,function(){var u,l,c,d,f,h;return fe(this,function(v){switch(v.label){case 0:return o.type.name!==i.type.name?[2,vt.UpdateResult.Recreate]:(u=t.representation.structure.registry.get(o.type.name),!((f=u.mustRecreate)===null||f===void 0)&&f.call(u,i.type.params,o.type.params)?[2,vt.UpdateResult.Recreate]:(l=((h=u.getData)===null||h===void 0?void 0:h.call(u,n.data,o.type.params))||n.data,c={runtime:s,assetManager:t.managers.asset},u.ensureCustomProperties?[4,u.ensureCustomProperties.attach(c,l)]:[3,2]));case 1:v.sent(),v.label=2;case 2:return ya.releaseDependencies(t.representation.structure.themes,{structure:a.data.sourceData},i),[4,ya.ensureDependencies(c,t.representation.structure.themes,{structure:l},o)];case 3:return v.sent(),a.data.repr.setTheme(ya.create(t.representation.structure.themes,{structure:l},o)),d=E(E({},a.data.repr.props),o.type.params),[4,a.data.repr.createOrUpdate(d,l).runInContext(s)];case 4:return v.sent(),a.data.sourceData=n.data,[2,vt.UpdateResult.Updated]}})})})},dispose:function(e,t){var r=e.b,n=e.params;if(!(!r||!n)){var a=r.data.sourceData,i=t.representation.structure.registry.get(n.type.name);i.ensureCustomProperties&&i.ensureCustomProperties.detach(a),ya.releaseDependencies(t.representation.structure.themes,{structure:a},n)}},interpolate:function(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;var n=e.colorTheme.params.value,a=t.colorTheme.params.value,i=dt.interpolate(n,a,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:i}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),xje=kt.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:{t:T.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new Dg(n);return j9(n,a,r.t),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new Dg(n)},info:n,repr:t.data.repr},{label:"Unwind T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return vt.UpdateResult.Recreate;if(a.t===n.t)return vt.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return j9(i,o,n.t),r.label="Unwind T = "+n.t.toFixed(2),r.data.repr=t.data.repr,vt.UpdateResult.Updated}}),Sje=kt.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:{t:T.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new Dg(n.root);return V9(n,a,r.t),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new Dg(n.root)},info:n.root,repr:t.data.repr},{label:"Explode T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i.root||t.data.repr!==r.data.repr)return vt.UpdateResult.Recreate;if(a.t===n.t)return vt.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return V9(i.root,o,n.t),r.label="Explode T = "+n.t.toFixed(2),r.data.repr=t.data.repr,vt.UpdateResult.Updated}}),Cje=kt.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:E({t:T.Numeric(0,{min:0,max:1,step:.01})},VUe)})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new Dg(n.root),i=H9(n.root,r),o=i.axis,s=i.origin;return W9(n,a,r.t,o,s),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new Dg(n.root)},info:n.root,repr:t.data.repr},{label:"Spin T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i.root||t.data.repr!==r.data.repr)return vt.UpdateResult.Recreate;if(a.t===n.t&&a.axis===n.axis&&a.origin===n.origin)return vt.UpdateResult.Unchanged;var o=r.data.state.unitTransforms,s=H9(i.root,n),u=s.axis,l=s.origin;return W9(i.root,o,n.t,u,l),r.label="Spin T = "+n.t.toFixed(2),r.data.repr=t.data.repr,vt.UpdateResult.Updated}}),_je=kt.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({script:T.Script(Va("(sel.atom.all)","mol-script")),color:T.Color(dr.blueviolet),clear:T.Boolean(!1)},function(e){return""+(e.clear?"Clear":dt.toRgbString(e.color))},{defaultValue:[{script:Va("(sel.atom.all)","mol-script"),color:dr.blueviolet,clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=qa.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{overpaint:a},initialState:{overpaint:qa.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a||t.data.repr!==r.data.repr)return vt.UpdateResult.Recreate;var o=r.data.state.overpaint,s=qa.ofScript(n.layers,i);return qa.areEqual(o,s)?vt.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",vt.UpdateResult.Updated)}}),wje=kt.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({bundle:T.Value(en.Empty),color:T.Color(dr.blueviolet),clear:T.Boolean(!1)},function(e){return""+(e.clear?"Clear":dt.toRgbString(e.color))},{defaultValue:[{bundle:en.Empty,color:dr.blueviolet,clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=qa.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{overpaint:a},initialState:{overpaint:qa.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a||t.data.repr!==r.data.repr)return vt.UpdateResult.Recreate;var o=r.data.state.overpaint,s=qa.ofBundle(n.layers,i);return qa.areEqual(o,s)?vt.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",vt.UpdateResult.Updated)}}),Eje=kt.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({script:T.Script(Va("(sel.atom.all)","mol-script")),value:T.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{script:Va("(sel.atom.all)","mol-script"),value:.5}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=Wa.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{transparency:a},initialState:{transparency:Wa.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return vt.UpdateResult.Recreate;var i=r.data.state.transparency,o=Wa.ofScript(n.layers,a);return Wa.areEqual(i,o)?vt.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",vt.UpdateResult.Updated)}}),Aje=kt.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({bundle:T.Value(en.Empty),value:T.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{bundle:en.Empty,value:.5}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=Wa.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{transparency:a},initialState:{transparency:Wa.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return vt.UpdateResult.Recreate;var i=r.data.state.transparency,o=Wa.ofBundle(n.layers,a);return Wa.areEqual(i,o)?vt.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",vt.UpdateResult.Updated)}}),Pje=kt.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({script:T.Script(Va("(sel.atom.all)","mol-script")),groups:T.Converted(function(e){return an.Groups.toNames(e)},function(e){return an.Groups.fromNames(e)},T.MultiSelect(N3(an.Groups.Names),T.objectToOptions(an.Groups.Names)))},function(e){return an.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{script:Va("(sel.atom.all)","mol-script"),groups:0}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=an.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:an.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return vt.UpdateResult.Recreate;var i=r.data.state.clipping,o=an.ofScript(n.layers,a);return an.areEqual(i,o)?vt.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",vt.UpdateResult.Updated)}}),Tje=kt.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({bundle:T.Value(en.Empty),groups:T.Converted(function(e){return an.Groups.toNames(e)},function(e){return an.Groups.fromNames(e)},T.MultiSelect(N3(an.Groups.Names),T.objectToOptions(an.Groups.Names)))},function(e){return an.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{bundle:en.Empty,groups:0}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=an.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:an.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return vt.UpdateResult.Recreate;var i=r.data.state.clipping,o=an.ofBundle(n.layers,a);return an.areEqual(i,o)?vt.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",vt.UpdateResult.Updated)}}),kc;(function(e){function t(a,i,o,s){var u=a.representation.volume.registry.get(i),l={volume:o},c=a.representation.volume.themes.colorThemeRegistry.get(u.defaultColorTheme.name).getParams(l),d=a.representation.volume.themes.sizeThemeRegistry.get(u.defaultSizeTheme.name).getParams(l),f=T.getDefaultValues(u.getParams(a.representation.volume.themes,o));return{type:{name:i,params:s?E(E({},f),s):f},colorTheme:{name:u.defaultColorTheme.name,params:T.getDefaultValues(c)},sizeTheme:{name:u.defaultSizeTheme.name,params:T.getDefaultValues(d)}}}e.getDefaultParams=t;function r(a,i,o,s,u,l,c){var d=a.representation.volume.registry.get(i),f=a.representation.volume.themes.colorThemeRegistry.get(s||d.defaultColorTheme.name),h=a.representation.volume.themes.sizeThemeRegistry.get(l||d.defaultSizeTheme.name);return{type:{name:i,params:o?E(E({},d.defaultValues),o):d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:u?E(E({},f.defaultValues),u):f.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:c?E(E({},h.defaultValues),c):h.defaultValues}}}e.getDefaultParamsStatic=r;function n(a){var i,o,s,u;if(a.isoValue)return _t.IsoValue.toString(a.isoValue);if(!((o=(i=a.renderMode)===null||i===void 0?void 0:i.params)===null||o===void 0)&&o.isoValue)return _t.IsoValue.toString((u=(s=a.renderMode)===null||s===void 0?void 0:s.params)===null||u===void 0?void 0:u.isoValue)}e.getDescription=n})(kc||(kc={}));var Ije=kt.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:ge.Volume.Data,to:ge.Volume.Representation3D,params:function(e,t){var r=t.representation.volume,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e)return{type:T.Mapped(n.default.name,n.types,function(s){return T.Group(n.get(s).getParams(a,_t.One))}),colorTheme:T.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(s){return T.Group(a.colorThemeRegistry.get(s).getParams({volume:_t.One}))}),sizeTheme:T.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(s){return T.Group(a.sizeThemeRegistry.get(s).getParams({volume:_t.One}))})};var o={volume:e.data};return{type:T.Mapped(n.default.name,n.types,function(s){return T.Group(n.get(s).getParams(a,e.data))}),colorTheme:T.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(o),function(s){return T.Group(a.colorThemeRegistry.get(s).getParams(o))}),sizeTheme:T.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(s){return T.Group(a.sizeThemeRegistry.get(s).getParams(o))})}}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.type.name===r.type.name},apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Volume Representation",function(i){return de(r,void 0,void 0,function(){var o,s,u,l,c;return fe(this,function(d){switch(d.label){case 0:return o={runtime:i,assetManager:t.managers.asset},s=t.representation.volume.registry.get(a.type.name),s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,n.data)]:[3,2];case 1:d.sent(),d.label=2;case 2:return u=s.factory(E({webgl:(c=t.canvas3d)===null||c===void 0?void 0:c.webgl},t.representation.volume.themes),s.getParams),u.setTheme(ya.create(t.representation.volume.themes,{volume:n.data},a)),l=a.type.params||{},[4,u.createOrUpdate(l,n.data).runInContext(i)];case 3:return d.sent(),[2,new ge.Volume.Representation3D({repr:u,sourceData:n.data},{label:s.label,description:kc.getDescription(l)})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return et.create("Volume Representation",function(s){return de(r,void 0,void 0,function(){var u,l,c;return fe(this,function(d){switch(d.label){case 0:return o.type.name!==i.type.name?(u=t.representation.volume.registry.get(i.type.name),(c=u.ensureCustomProperties)===null||c===void 0||c.detach(n.data),[2,vt.UpdateResult.Recreate]):(l=E(E({},a.data.repr.props),o.type.params),a.data.repr.setTheme(ya.create(t.representation.volume.themes,{volume:n.data},o)),[4,a.data.repr.createOrUpdate(l,n.data).runInContext(s)]);case 1:return d.sent(),a.data.sourceData=n.data,a.description=kc.getDescription(l),[2,vt.UpdateResult.Updated]}})})})}}),Mje=kt.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:ge.Shape.Provider,to:ge.Shape.Representation3D,params:function(e,t){return e?e.data.params:At.Params}})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Shape Representation",function(i){return de(r,void 0,void 0,function(){var o,s;return fe(this,function(u){switch(u.label){case 0:return o=E(E({},T.getDefaultValues(n.data.params)),a),s=ka(n.data.getShape,n.data.geometryUtils),[4,s.createOrUpdate(o,n.data.data).runInContext(i)];case 1:return u.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:n.data},{label:n.data.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return et.create("Shape Representation",function(o){return de(r,void 0,void 0,function(){var s;return fe(this,function(u){switch(u.label){case 0:return s=E(E({},a.data.repr.props),i),[4,a.data.repr.createOrUpdate(s,n.data.data).runInContext(o)];case 1:return u.sent(),a.data.sourceData=n.data,[2,vt.UpdateResult.Updated]}})})})}}),Dje=kt.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:ge.Molecule.Model,to:ge.Shape.Representation3D,params:function(){return E({},X9)}})({isApplicable:function(e){return!!ca.Provider.get(e.data)},canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Model Unit Cell",function(i){return de(r,void 0,void 0,function(){var o,s,u,l;return fe(this,function(c){switch(c.label){case 0:return o=ca.Provider.get(n.data),o?(s=Y9(n.data,o,a),u=QUe(E({webgl:(l=t.canvas3d)===null||l===void 0?void 0:l.webgl},t.representation.structure.themes),function(){return X9}),[4,u.createOrUpdate(a,s).runInContext(i)]):[2,On.Null];case 1:return c.sent(),[2,new ge.Shape.Representation3D({repr:u,sourceData:s},{label:"Unit Cell",description:o.spacegroup.name})]}})})})},update:function(e){var t=this,r=e.a,n=e.b,a=e.newParams;return et.create("Model Unit Cell",function(i){return de(t,void 0,void 0,function(){var o,s,u;return fe(this,function(l){switch(l.label){case 0:return o=ca.Provider.get(r.data),o?(s=E(E({},n.data.repr.props),a),u=Y9(r.data,o,s),[4,n.data.repr.createOrUpdate(s,u).runInContext(i)]):[2,vt.UpdateResult.Null];case 1:return l.sent(),n.data.sourceData=u,[2,vt.UpdateResult.Updated]}})})})}}),Rje=kt.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:ge.Molecule.Structure,to:ge.Shape.Representation3D,params:E({radius:T.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:T.Color(dr.red,{isEssential:!0})},Ft.Params)})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Bounding Box",function(i){return de(r,void 0,void 0,function(){var o;return fe(this,function(s){switch(s.label){case 0:return o=ka(function(u,l,c,d){var f=pO(l.box,l.radius,d==null?void 0:d.geometry);return kr.create("Bouding Box",l,f,function(){return l.color},function(){return 1},function(){return"Bounding Box"})},Ft.Utils),[4,o.createOrUpdate(a,{box:n.data.boundary.box,radius:a.radius,color:a.color}).runInContext(i)];case 1:return s.sent(),[2,new ge.Shape.Representation3D({repr:o,sourceData:n.data},{label:"Bounding Box"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return et.create("Bounding Box",function(o){return de(r,void 0,void 0,function(){return fe(this,function(s){switch(s.label){case 0:return[4,a.data.repr.createOrUpdate(i,{box:n.data.boundary.box,radius:i.radius,color:i.color}).runInContext(o)];case 1:return s.sent(),a.data.sourceData=n.data,[2,vt.UpdateResult.Updated]}})})})}}),kje=kt.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},Q9)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Structure Distance",function(i){return de(r,void 0,void 0,function(){var o,s,u;return fe(this,function(l){switch(l.label){case 0:return o=Z9(n.data),s=c9e(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return Q9}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Distance"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return et.create("Structure Distance",function(o){return de(r,void 0,void 0,function(){var s,u;return fe(this,function(l){switch(l.label){case 0:return s=E(E({},a.data.repr.props),i),u=Z9(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,vt.UpdateResult.Updated]}})})})}}),Oje=kt.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},sj)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Structure Angle",function(i){return de(r,void 0,void 0,function(){var o,s,u;return fe(this,function(l){switch(l.label){case 0:return o=J9(n.data),s=K9e(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return sj}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Angle"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return et.create("Structure Angle",function(o){return de(r,void 0,void 0,function(){var s,u;return fe(this,function(l){switch(l.label){case 0:return s=E(E({},a.data.repr.props),i),u=J9(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,vt.UpdateResult.Updated]}})})})}}),Lje=kt.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},uj)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Structure Dihedral",function(i){return de(r,void 0,void 0,function(){var o,s,u;return fe(this,function(l){switch(l.label){case 0:return o=ej(n.data),s=gje(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return uj}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Dihedral"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return et.create("Structure Dihedral",function(o){return de(r,void 0,void 0,function(){var s,u;return fe(this,function(l){switch(l.label){case 0:return s=E(E({},a.data.repr.props),i),u=ej(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,vt.UpdateResult.Updated]}})})})}}),Nje=kt.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},nj)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Structure Label",function(i){return de(r,void 0,void 0,function(){var o,s,u;return fe(this,function(l){switch(l.label){case 0:return o=tj(n.data),s=m9e(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return nj}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Label"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return et.create("Structure Label",function(o){return de(r,void 0,void 0,function(){var s,u;return fe(this,function(l){switch(l.label){case 0:return s=E(E({},a.data.repr.props),i),u=tj(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,vt.UpdateResult.Updated]}})})})}}),Fje=kt.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},oj)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return et.create("Structure Orientation",function(i){return de(r,void 0,void 0,function(){var o,s,u;return fe(this,function(l){switch(l.label){case 0:return o=rj(n.data),s=N9e(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return oj}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Orientation"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return et.create("Structure Orientation",function(o){return de(r,void 0,void 0,function(){var s,u;return fe(this,function(l){switch(l.label){case 0:return s=E(E({},a.data.repr.props),i),u=rj(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,vt.UpdateResult.Updated]}})})})}});const Bje=Object.freeze(Object.defineProperty({__proto__:null,ClippingStructureRepresentation3DFromBundle:Tje,ClippingStructureRepresentation3DFromScript:Pje,ExplodeStructureRepresentation3D:Sje,ModelUnitcell3D:Dje,OverpaintStructureRepresentation3DFromBundle:wje,OverpaintStructureRepresentation3DFromScript:_je,ShapeRepresentation3D:Mje,SpinStructureRepresentation3D:Cje,StructureBoundingBox3D:Rje,StructureRepresentation3D:g_,StructureSelectionsAngle3D:Oje,StructureSelectionsDihedral3D:Lje,StructureSelectionsDistance3D:kje,StructureSelectionsLabel3D:Nje,StructureSelectionsOrientation3D:Fje,TransparencyStructureRepresentation3DFromBundle:Aje,TransparencyStructureRepresentation3DFromScript:Eje,UnwindStructureAssemblyRepresentation3D:xje,VolumeRepresentation3D:Ije,get VolumeRepresentation3DHelpers(){return kc}},Symbol.toStringTag,{value:"Module"}));var st={Data:Cke,Misc:wke,Model:F8e,Volume:Y8e,Representation:Bje,Shape:bje},Uje={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},jje=new Set(["LI","NA","K","RB","CS","FR"]);function zje(e){return jje.has(e)}var Vje=new Set(["BE","MG","CA","SR","BA","RA"]);function Hje(e){return Vje.has(e)}var Gje=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function qje(e){return Gje.has(e)}var Wje=new Set(["F","CL","BR","I","AT"]);function $je(e){return Wje.has(e)}function rJ(e){var t=Db(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function Xje(e){var t=Db(e);return t>=57&&t<=71}function Yje(e){var t=Db(e);return t>=89&&t<=103}function Kje(e){return zje(e)||Hje(e)||Xje(e)||Yje(e)||rJ(e)||qje(e)}var Ur;(function(e){e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal"})(Ur||(Ur={}));function jr(e,t,r){var n;r===void 0&&(r={});var a;return{label:e,expression:t,description:r.description||"",category:(n=r.category)!==null&&n!==void 0?n:Ur.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return a||(a=Yp(t)),a},ensureCustomProperties:r.ensureCustomProperties,getSelection:function(i,o,s){return de(this,void 0,void 0,function(){var u,l;return fe(this,function(c){switch(c.label){case 0:return u=i.managers.structure.selection.getStructure(s),l=u?yt.Sequence(s,[u]):yt.Empty(s),r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:i.managers.asset},s)]:[3,2];case 1:c.sent(),c.label=2;case 2:return a||(a=Yp(t)),[2,a(new as(s,{currentSelection:l}))]}})})}}}var Qje=jr("All",ue.struct.generator.all(),{category:"",priority:1e3}),Zje=jr("Current Selection",ue.internal.generator.current(),{category:"",referencesCurrent:!0}),Jje=jr("Polymer",ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.logic.and([ue.core.rel.eq([ue.ammp("entityType"),"polymer"]),ue.core.str.match([ue.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),ue.ammp("entitySubtype")])])})]),{category:Ur.Type}),eze=jr("Trace",ue.struct.modifier.union([ue.struct.combinator.merge([ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.rel.eq([ue.ammp("entityType"),"polymer"]),"chain-test":ue.core.set.has([ue.set("sphere","gaussian"),ue.ammp("objectPrimitive")])})]),ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.rel.eq([ue.ammp("entityType"),"polymer"]),"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"atom-test":ue.core.set.has([ue.set("CA","P"),ue.ammp("label_atom_id")])})])])]),{category:Ur.Structure}),o0=ue.core.logic.and([ue.core.rel.eq([ue.ammp("entityType"),"polymer"]),ue.core.str.match([ue.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),ue.ammp("entitySubtype")])]),$3=ue.core.logic.and([ue.core.rel.eq([ue.ammp("entityType"),"polymer"]),ue.core.str.match([ue.re("(nucleotide|peptide nucleic acid)","i"),ue.ammp("entitySubtype")])]),Zp=ue.core.str.match([ue.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),ue.ammp("chemCompType")]),tze=jr("Backbone",ue.struct.modifier.union([ue.struct.combinator.merge([ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":o0,"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":ue.core.logic.not([Zp]),"atom-test":ue.core.set.has([ue.set.apply(ue,fa.toArray($c)),ue.ammp("label_atom_id")])})]),ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":$3,"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":ue.core.logic.not([Zp]),"atom-test":ue.core.set.has([ue.set.apply(ue,fa.toArray(g3)),ue.ammp("label_atom_id")])})])])]),{category:Ur.Structure}),rze=jr("Sidechain",ue.struct.modifier.union([ue.struct.combinator.merge([ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":o0,"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":ue.core.logic.not([Zp]),"atom-test":ue.core.logic.or([ue.core.logic.not([ue.core.set.has([ue.set.apply(ue,fa.toArray($c)),ue.ammp("label_atom_id")])])])})]),ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":$3,"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":ue.core.logic.not([Zp]),"atom-test":ue.core.logic.or([ue.core.logic.not([ue.core.set.has([ue.set.apply(ue,fa.toArray(g3)),ue.ammp("label_atom_id")])])])})])])]),{category:Ur.Structure}),nze=jr("Sidechain with Trace",ue.struct.modifier.union([ue.struct.combinator.merge([ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":o0,"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":ue.core.logic.not([Zp]),"atom-test":ue.core.logic.or([ue.core.logic.not([ue.core.set.has([ue.set.apply(ue,fa.toArray($c)),ue.ammp("label_atom_id")])]),ue.core.rel.eq([ue.ammp("label_atom_id"),"CA"]),ue.core.logic.and([ue.core.rel.eq([ue.ammp("auth_comp_id"),"PRO"]),ue.core.rel.eq([ue.ammp("label_atom_id"),"N"])])])})]),ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":$3,"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":ue.core.logic.not([Zp]),"atom-test":ue.core.logic.or([ue.core.logic.not([ue.core.set.has([ue.set.apply(ue,fa.toArray(g3)),ue.ammp("label_atom_id")])]),ue.core.rel.eq([ue.ammp("label_atom_id"),"P"])])})])])]),{category:Ur.Structure}),aze=jr("Protein",ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":o0})]),{category:Ur.Type}),ize=jr("Nucleic",ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":$3})]),{category:Ur.Type}),oze=jr("Helix",ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":o0,"residue-test":ue.core.flags.hasAny([ue.ammp("secondaryStructureFlags"),ue.core.type.bitflags([2])])})]),{category:Ur.Structure}),sze=jr("Beta Strand/Sheet",ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":o0,"residue-test":ue.core.flags.hasAny([ue.ammp("secondaryStructureFlags"),ue.core.type.bitflags([4])])})]),{category:Ur.Structure}),uze=jr("Water",ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.rel.eq([ue.ammp("entityType"),"water"])})]),{category:Ur.Type}),lze=jr("Ion",ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.rel.eq([ue.ammp("entitySubtype"),"ion"])})]),{category:Ur.Type}),cze=jr("Lipid",ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.rel.eq([ue.ammp("entitySubtype"),"lipid"])})]),{category:Ur.Type}),X3=jr("Carbohydrate",ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.logic.or([ue.core.rel.eq([ue.ammp("entityType"),"branched"]),ue.core.logic.and([ue.core.rel.eq([ue.ammp("entityType"),"non-polymer"]),ue.core.str.match([ue.re("oligosaccharide","i"),ue.ammp("entitySubtype")])])])})]),{category:Ur.Type}),nJ=jr("Carbohydrate with Connected",ue.struct.modifier.union([ue.struct.modifier.includeConnected({0:X3.expression,"layer-count":1,"as-whole-residues":!0})]),{category:Ur.Internal,isHidden:!0}),aJ=jr("Connected to Carbohydrate",ue.struct.modifier.union([ue.struct.modifier.exceptBy({0:nJ.expression,by:X3.expression})]),{category:Ur.Internal,isHidden:!0}),vO=jr("Ligand",ue.struct.modifier.union([ue.struct.combinator.merge([ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.logic.and([ue.core.logic.or([ue.core.rel.eq([ue.ammp("entityType"),"non-polymer"]),ue.core.rel.neq([ue.ammp("entityPrdId"),""])]),ue.core.logic.not([ue.core.str.match([ue.re("(oligosaccharide|lipid|ion)","i"),ue.ammp("entitySubtype")])])]),"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":ue.core.logic.not([ue.core.str.match([ue.re("saccharide","i"),ue.ammp("chemCompType")])])})]),ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.rel.eq([ue.ammp("entityType"),"polymer"]),"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":Zp})])])]),{category:Ur.Type}),iJ=jr("Ligand with Connected",ue.struct.modifier.union([ue.struct.modifier.exceptBy({0:ue.struct.modifier.union([ue.struct.modifier.includeConnected({0:vO.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":ue.core.flags.hasAny([ue.struct.bondProperty.flags(),ue.core.type.bitflags([3])])})]),by:X3.expression})]),{category:Ur.Internal,isHidden:!0}),oJ=jr("Connected to Ligand",ue.struct.modifier.union([ue.struct.modifier.exceptBy({0:iJ.expression,by:vO.expression})]),{category:Ur.Internal,isHidden:!0}),dze=jr("Connected to Ligand or Carbohydrate",ue.struct.modifier.union([ue.struct.combinator.merge([aJ.expression,oJ.expression])]),{category:Ur.Internal,isHidden:!0}),fze=jr("Disulfide Bridges",ue.struct.modifier.union([ue.struct.combinator.merge([ue.struct.modifier.union([ue.struct.modifier.wholeResidues([ue.struct.filter.isConnectedTo({0:ue.struct.generator.atomGroups({"residue-test":ue.core.set.has([ue.set("CYS"),ue.ammp("auth_comp_id")]),"atom-test":ue.core.set.has([ue.set("SG"),ue.ammp("label_atom_id")])}),target:ue.struct.generator.atomGroups({"residue-test":ue.core.set.has([ue.set("CYS"),ue.ammp("auth_comp_id")]),"atom-test":ue.core.set.has([ue.set("SG"),ue.ammp("label_atom_id")])}),"bond-test":!0})])]),ue.struct.modifier.union([ue.struct.modifier.wholeResidues([ue.struct.modifier.union([ue.struct.generator.bondedAtomicPairs({0:ue.core.flags.hasAny([ue.struct.bondProperty.flags(),ue.core.type.bitflags([8])])})])])])])]),{category:Ur.Bond}),hze=jr("NOS Bridges",ue.struct.modifier.union([ue.struct.modifier.wholeResidues([ue.struct.filter.isConnectedTo({0:ue.struct.generator.atomGroups({"residue-test":ue.core.set.has([ue.set("CSO","LYS"),ue.ammp("auth_comp_id")]),"atom-test":ue.core.set.has([ue.set("OD","NZ"),ue.ammp("label_atom_id")])}),target:ue.struct.generator.atomGroups({"residue-test":ue.core.set.has([ue.set("CSO","LYS"),ue.ammp("auth_comp_id")]),"atom-test":ue.core.set.has([ue.set("OD","NZ"),ue.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:Ur.Bond}),pze=jr("Non-standard Residues in Polymers",ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.rel.eq([ue.ammp("entityType"),"polymer"]),"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":ue.ammp("isNonStandard")})]),{category:Ur.Residue}),vze=jr("Coarse Elements",ue.struct.modifier.union([ue.struct.generator.atomGroups({"chain-test":ue.core.set.has([ue.set("sphere","gaussian"),ue.ammp("objectPrimitive")])})]),{category:Ur.Type}),mze=jr("Rings in Residues",ue.struct.modifier.union([ue.struct.generator.rings()]),{category:Ur.Residue}),gze=jr("Aromatic Rings in Residues",ue.struct.modifier.union([ue.struct.generator.rings({"only-aromatic":!0})]),{category:Ur.Residue}),yze=jr("Surrounding Residues (5 Å) of Selection",ue.struct.modifier.union([ue.struct.modifier.exceptBy({0:ue.struct.modifier.includeSurroundings({0:ue.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:ue.internal.generator.current()})]),{description:"Select residues within 5 Å of the current selection.",category:Ur.Manipulate,referencesCurrent:!0}),bze=jr("Surrounding Ligands (5 Å) of Selection",ue.struct.modifier.union([ue.struct.modifier.surroundingLigands({0:ue.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 Å of the current selection.",category:Ur.Manipulate,referencesCurrent:!0}),xze=jr("Inverse / Complement of Selection",ue.struct.modifier.union([ue.struct.modifier.exceptBy({0:ue.struct.generator.all(),by:ue.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:Ur.Manipulate,referencesCurrent:!0}),Sze=jr("Residues Covalently Bonded to Selection",ue.struct.modifier.union([ue.struct.modifier.includeConnected({0:ue.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:Ur.Manipulate,referencesCurrent:!0}),Cze=jr("Covalently Bonded Component",ue.struct.modifier.union([ue.struct.modifier.includeConnected({0:ue.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:Ur.Manipulate,referencesCurrent:!0}),_ze=jr("Residues with Cov. or Metallic Bond to Selection",ue.struct.modifier.union([ue.struct.modifier.includeConnected({0:ue.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":ue.core.flags.hasAny([ue.struct.bondProperty.flags(),ue.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:Ur.Manipulate,referencesCurrent:!0}),wze=jr("Whole Residues of Selection",ue.struct.modifier.union([ue.struct.modifier.wholeResidues({0:ue.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:Ur.Manipulate,referencesCurrent:!0}),Eze=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),Aze=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0});function SD(e,t,r){var n=e[0],a=e[1];r===void 0&&(r=0);var i=n.length===1&&!sJ.has(n[0])?"["+n[0]+"] "+a:a+" ("+n.join(", ")+")";return jr(i,ue.struct.modifier.union([ue.struct.generator.atomGroups({"residue-test":ue.core.set.has([ue.set.apply(ue,n),ue.ammp("auth_comp_id")])})]),{category:t,priority:r,description:i})}function Pze(e,t,r){var n=e[0],a=e[1],i=a+" ("+n.join(", ")+")";return jr(i,ue.struct.modifier.union([ue.struct.generator.atomGroups({"atom-test":ue.core.set.has([ue.set.apply(ue,n),ue.acp("elementSymbol")])})]),{category:t,priority:r,description:i})}function Tze(e,t,r){var n=e[0],a=e[1],i=""+a;return jr(""+a,ue.struct.modifier.union([ue.struct.generator.atomGroups({"entity-test":ue.core.list.equal([ue.list.apply(ue,n),ue.ammp("entityDescription")])})]),{category:t,priority:r,description:i})}var sJ=fa.unionMany(Ok,x3,S3,y3);function Ize(e){for(var t=new Set,r=0,n=e;r<n.length;r++){var a=n[r];a.uniqueElementSymbols.forEach(function(o){return t.add(o)})}var i=[];return t.forEach(function(o){var s=Uje[o]||o;i.push(Pze([[o],s],"Element Symbol",0))}),i}function Mze(e){for(var t=new Map,r=new Set,n=0,a=e;n<a.length;n++){var i=a[n];i.uniqueResidueNames.forEach(function(d){return r.add(d)});for(var o=function(d){i.uniqueResidueNames.forEach(function(f){var h=d.properties.chemicalComponentMap.get(f);h&&t.set(f,h.name)})},s=0,u=i.models;s<u.length;s++){var l=u[s];o(l)}}var c=[];return fa.difference(r,sJ).forEach(function(d){var f=t.get(d)||d;c.push(SD([[d],f],"Ligand/Non-standard Residue",200))}),c}function Dze(e){for(var t=new Map,r=at.create(),n=0,a=e;n<a.length;n++){var i=a[n];r.structure=i;for(var o=0,s=i.unitSymmetryGroups;o<s.length;o++){var u=s[o];r.unit=u.units[0],r.element=u.elements[0];var l=pt.entity.type(r);if(l==="polymer"||l==="branched"){var c=pt.entity.pdbx_description(r);t.set(c.join(", "),c)}}}var d=[];return t.forEach(function(f,h){d.push(Tze([f,h],"Polymer/Carbohydrate Entities",300))}),d}var ma={all:Qje,current:Zje,polymer:Jje,trace:eze,backbone:tze,sidechain:rze,sidechainWithTrace:nze,protein:aze,nucleic:ize,helix:oze,beta:sze,water:uze,ion:lze,lipid:cze,branched:X3,branchedPlusConnected:nJ,branchedConnectedOnly:aJ,ligand:vO,ligandPlusConnected:iJ,ligandConnectedOnly:oJ,connectedOnly:dze,disulfideBridges:fze,nosBridges:hze,nonStandardPolymer:pze,coarse:vze,ring:mze,aromaticRing:gze,surroundings:yze,surroundingLigands:bze,complement:xze,covalentlyBonded:Sze,covalentlyOrMetallicBonded:_ze,covalentlyBondedComponent:Cze,wholeResidues:wze},Rze=function(){function e(){var t,r;this.list=[],this.options=[],this.version=1,(t=this.list).push.apply(t,Ut(Ut(Ut([],Object.values(ma)),Eze.map(function(n){return SD(n,Ur.AminoAcid)})),Aze.map(function(n){return SD(n,Ur.NucleicBase)}))),(r=this.options).push.apply(r,this.list.map(function(n){return[n,n.label,n.category]}))}return e.prototype.add=function(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1},e.prototype.remove=function(t){var r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)},e}(),kze=function(){function e(t,r){this.key=t,this.defaultValue=r}return e.prototype.toString=function(){return this.key},e.prototype.valueOf=function(){return this.key},e}();function aa(e,t){return new kze(e,t)}var $r={item:aa,General:{IsBusyTimeoutMs:aa("plugin-config.is-busy-timeout",750),DisableAntialiasing:aa("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:aa("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:aa("plugin-config.pixel-scale",1),PickScale:aa("plugin-config.pick-scale",.25),EnableWboit:aa("plugin-config.enable-wboit",!0)},State:{DefaultServer:aa("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:aa("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:aa("history-capacity.server",5)},VolumeStreaming:{Enabled:aa("volume-streaming.enabled",!0),DefaultServer:aa("volume-streaming.server","https://ds.litemol.org"),CanStream:aa("volume-streaming.can-stream",function(e,t){return e.models.length===1&&Xt.probablyHasDensityMap(e.models[0])}),EmdbHeaderServer:aa("volume-streaming.emdb-header-server","https://ftp.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:aa("viewer.show-expand-button",!0),ShowControls:aa("viewer.show-controls-button",!0),ShowSettings:aa("viewer.show-settings-button",!0),ShowSelectionMode:aa("viewer.show-selection-model-button",!0),ShowAnimation:aa("viewer.show-animation-button",!0)},Download:{DefaultPdbProvider:aa("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:aa("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:aa("structure.size-thresholds",tt.DefaultSizeThresholds),DefaultRepresentationPresetParams:aa("structure.default-representation-preset-params",{})}},Oze=function(){function e(t){var r=this;this._config=new Map,t&&t.forEach(function(n){var a=n[0],i=n[1];return r._config.set(a,i)})}return e.prototype.get=function(t){return this._config.has(t)?this._config.get(t):t.defaultValue},e.prototype.set=function(t,r){this._config.set(t,r)},e.prototype.delete=function(t){this._config.delete(t)},e}();function Du(e,t,r,n){var a=0,i=t.webgl,o=new ta,s=_d(),u=[],l=Ba.create(),c,d,f,h,v=ya.createEmpty();function p(x,C){var w=this;return x===void 0&&(x={}),C&&C!==d&&(f=r(t,C),d=C,h||(h=T.getDefaultValues(f))),h=Object.assign({},h,x),et.create("Creating or updating ComplexRepresentation",function(A){return de(w,void 0,void 0,function(){var I,D,k;return fe(this,function(R){switch(R.label){case 0:return I=!1,c?!((k=c.mustRecreate)===null||k===void 0)&&k.call(c,d,h,i)&&(c.destroy(),c=n(s,d,h,i),I=!0):(c=n(s,d,h,i),I=!0),D=c.createOrUpdate({webgl:i,runtime:A},v,h,C),D?[4,D]:[3,2];case 1:R.sent(),R.label=2;case 2:return I&&y(l),u.length=0,c&&c.renderObject&&u.push(c.renderObject),o.next(a++),[2]}})})})}function g(x){return x===void 0?tt.Loci(d.target):c?c.getLoci(x):Or}function m(x,C){if(!d||!Mo.is(l.markerActions,C))return!1;if(tt.isLoci(x)||Oe.is(x)||Gt.isLoci(x)){if(!tt.areRootsEquivalent(x.structure,d))return!1;x=or.remap(x,d)}else if(!js(x)&&!t1(x))return!1;return or.isEmpty(x)?!1:c?c.mark(x,C):!1}function y(x){if(Ba.update(l,x),x.visible!==void 0&&c&&c.setVisibility(x.visible&&(l.unitTransforms===null||l.unitTransforms.isIdentity)),x.alphaFactor!==void 0&&c&&c.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&c&&c.setPickable(x.pickable),x.overpaint!==void 0&&c){var C=qa.remap(x.overpaint,d);c.setOverpaint(C)}if(x.transparency!==void 0&&c){var w=Wa.remap(x.transparency,d);c.setTransparency(w)}if(x.clipping!==void 0&&c){var A=an.remap(x.clipping,d);c.setClipping(A)}x.transform!==void 0&&c&&c.setTransform(x.transform),x.unitTransforms!==void 0&&c&&c.setVisibility(l.visible&&(x.unitTransforms===null||x.unitTransforms.isIdentity))}function b(x){v=x}function S(){c&&c.destroy()}return{label:e,get groupCount(){return c?c.groupCount:0},get props(){return h},get params(){return f},get state(){return l},get theme(){return v},renderObjects:u,updated:o,createOrUpdate:p,setState:y,setTheme:b,getLoci:g,mark:m,destroy:S}}function uJ(e,t,r){var n=t.elements,a=t.model;if(Fe.indexOf(n,r)!==-1){for(var i=a.atomicHierarchy.residueAtomSegments,o=i.index,s=i.offsets,u=o[r],l=[],c=s[u],d=s[u+1];c<d;++c){var f=Fe.indexOf(n,c);f!==-1&&l.push(f)}var h=Fe.ofSortedArray(it.ofSortedArray(l));return Oe(e,[{unit:t,indices:h}])}return Or}function Lze(e,t,r){var n=t.elements,a=t.model,i=a.atomicHierarchy.atoms.label_alt_id,o=i.value(r);if(Fe.indexOf(n,r)!==-1){var s=a.atomicHierarchy.residueAtomSegments.index,u=s[r];return ob(e,t,u,o)}return Oe(e,[])}function ob(e,t,r,n){for(var a=t.elements,i=t.model,o=i.atomicHierarchy.atoms.label_alt_id,s=i.atomicHierarchy.residueAtomSegments.offsets,u=[],l=s[r],c=s[r+1];l<c;++l){var d=Fe.indexOf(a,l);if(d!==-1){var f=o.value(l);(n===f||f==="")&&u.push(d)}}var h=Fe.ofSortedArray(it.ofSortedArray(u));return Oe(e,[{unit:t,indices:h}])}function lJ(e,t,r){for(var n=e.structure.child,a=t&&n?e.group.units.filter(function(l){return n.unitMap.has(l.id)}):e.group.units,i=a.length,o=i*16,s=r&&r.aTransform.ref.value.length>=o?r.aTransform.ref.value:new Float32Array(o),u=0;u<i;u++)le.toArray(a[u].conformation.operator.matrix,s,u*16);return Tk(s,i,r)}var Nze={atomic:{},spheres:{},gaussians:{}},Fze=T.objectToOptions(Nze);function Bze(e,t){for(var r=0,n=e.length;r<n;++r)if(We.isAtomic(t)&&e[r]==="atomic"||We.isSpheres(t)&&e[r]==="spheres"||We.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var cJ=5e8;function dJ(e,t,r){r===void 0&&(r=cJ);var n=Yt.size(_(),e);_.ceil(n,n),n.sort(function(s,u){return u-s});var a=Math.floor(Math.cbrt(r)*Math.cbrt(r)),i=n[0]*n[1],o=Math.ceil(i/(t*t));return{area:i,areaCells:o,maxAreaCells:a}}function bv(e,t,r){r===void 0&&(r=cJ);var n=dJ(e,t.resolution,r),a=n.area,i=n.areaCells,o=n.maxAreaCells,s=i>o?Math.sqrt(a/o):t.resolution;return E(E({},t),{resolution:s})}function Uze(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}var Y3={ignoreHydrogens:T.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),traceOnly:T.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:T.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})};T.getDefaultValues(Y3);var jze=_();function zze(e,t,r,n){return _.squaredDistance(_.set(jze,e,t,r),n)}function Vze(e,t,r){for(var n=0,a=t.length,i=0,o=r.length;i<o;++i){var s=it.indexOfInRange(t,r[i],n,a);s===-1?e[i]=-2:(e[i]=s,n=s)}}function K3(e,t,r){var n=r.ignoreHydrogens,a=r.traceOnly,i=r.includeParent,o=i?e.root.unitMap.get(t.id):t,s=Uze(o),u=s.x,l=s.y,c=s.z,d=o.elements,f=t.boundary.sphere,h=f.center,v=f.radius,p=(2+1.5)*2,g=(v+p)*(v+p),m,y;if(n||a||i&&o!==t){for(var b=[],S=[],x=0,C=d.length;x<C;++x){var w=d[x];n&&y_(o,w)||a&&!gO(o,w)||i&&zze(u[w],l[w],c[w],h)>g||(b.push(w),S.push(x))}m=it.ofSortedArray(b),y=S}else m=d,y=Ws(new Int32Array(m.length));i&&o!==t&&Vze(y,t.elements,m);var A={indices:m,x:u,y:l,z:c,id:y},I=t===o?t.boundary:Pg(A),D=at.create(e,o),k=Fb({},{scale:1}),R=function(L){return D.element=L,k.size(D)};return{position:A,boundary:I,radius:R}}function mO(e,t,r){var n=at.create(e),a=Fb({},{scale:1}),i,o,s,u,l;if(t||r){for(var c=[],d=[],f=[],h=[],v=[],p=0,g=0,m=e.units.length;p<m;++p){var y=e.units[p],b=y.elements,S=y.conformation,x=S.x,C=S.y,w=S.z;n.unit=y;for(var A=0,I=b.length;A<I;++A){var D=b[A];t&&y_(y,D)||r&&!gO(y,D)||(c.push(x(D)),d.push(C(D)),f.push(w(D)),n.element=D,h.push(a.size(n)),v.push(g+A))}g+=b.length}i=c,o=d,s=f,u=h,l=v}else{for(var k=e.elementCount,c=new Float32Array(k),d=new Float32Array(k),f=new Float32Array(k),h=new Float32Array(k),p=0,g=0,m=e.units.length;p<m;++p){var y=e.units[p],b=y.elements,R=y.conformation,x=R.x,C=R.y,w=R.z;n.unit=y;for(var A=0,I=b.length;A<I;++A){var D=b[A],L=g+A;c[L]=x(D),d[L]=C(D),f[L]=w(D),n.element=D,h[L]=a.size(n)}g+=b.length}i=c,o=d,s=f,u=h,l=Ws(new Uint32Array(k))}var H={indices:Fe.ofRange(0,l.length),x:i,y:o,z:s,id:l},B=function(j){return u[j]};return{position:H,radius:B}}var fJ=m3.H;function y_(e,t){return We.isCoarse(e)?!1:e.model.atomicHierarchy.derived.atom.atomicNumber[t]===fJ}function b_(e,t){return e[t]===fJ}function gO(e,t){if(We.isCoarse(e))return!0;var r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function s0(e){if(We.isAtomic(e))return 4;for(var t=0,r=e.elements,n=e.conformation.r,a=0,i=r.length;a<i;a++){var o=n(r[a]);o>t&&(t=o)}return t+1}function Q3(e){for(var t=0,r=0,n=e.unitSymmetryGroups;r<n.length;r++){var a=n[r],i=s0(a.units[0]);i>t&&(t=i)}return t}function Bb(e){return T.MultiSelect(e,Fze,{description:"For which kinds of units/chains to show the representation visuals."})}var Do={unitKinds:Bb(["atomic","spheres"]),includeParent:T.Boolean(!1,{isHidden:!0})},hJ=E({},Ft.Params),Hze=E({},ah.Params),pJ=E({},Ko.Params),Gze=E({},Qp.Params),vJ=E({},Cn.Params),mJ=E({},$s.Params),gJ=E({},ro.Params),yJ=E({},Vu.Params);function qze(e,t,r,n,a,i){var o=oi.getUtils(t),s=o.createValues,u=o.createRenderableState,l=Mk(),c=s(t,l,r,n,a),d=u(a);return a0(t.kind,c,d,i)}function u0(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.updateValues,h=d.updateBoundingSphere,v=d.updateRenderableState,p=d.createPositionIterator,g=Ll.create(),m,y,b,S,x=Object.assign({},r),C=ya.createEmpty(),w,A,I,D;function k(j,Q,G){if(!G&&!w)throw new Error("missing structure");if(y=Object.assign({},x,Q),b=j,S=G,Ll.reset(g),!m||!w){g.createNew=!0,g.createGeometry=!0;return}s(g,y,x,b,C,S,w),tt.areEquivalent(S,w)||(g.createGeometry=!0),tt.areHierarchiesEqual(S,w)||(g.updateTransform=!0,g.createGeometry=!0),Qc.areEqual(j.color,C.color)||(g.updateColor=!0),zc(y.unitKinds,x.unitKinds)||(g.createGeometry=!0),w.child!==S.child&&(g.createGeometry=!0),g.updateSize&&!("uSize"in m.values)&&(g.createGeometry=!0),g.createGeometry&&(g.updateColor=!0,g.updateSize=!0)}function R(j){if(g.createNew)if(I=a(S),j)m=qze(S,j,I,b,y,t),D=p(j,m.values);else throw new Error("expected geometry to be given");else{if(!m)throw new Error("expected renderObject to be available");if(g.updateTransform){I=a(S);var Q=I.instanceCount,G=I.groupCount;Js(Q*G,m.values)}if(g.createGeometry)if(j)N.updateIfChanged(m.values.drawCount,oi.getDrawCount(j)),N.updateIfChanged(m.values.uVertexCount,oi.getVertexCount(j));else throw new Error("expected geometry to be given");(g.updateTransform||g.createGeometry)&&(h(m.values,j||A),D=p(A,m.values)),g.updateSize&&"uSize"in m.values&&hd(I,b.size,m.values),g.updateColor&&cs(I,D,b.color,m.values),f(m.values,y),v(m.state,y)}x=y,C=b,w=S,j&&(A=j)}function L(j){return!!(js(j)||tt.isLoci(j)&&tt.areRootsEquivalent(j.structure,w)||Oe.is(j)&&tt.areRootsEquivalent(j.structure,w)&&Oe.isWholeStructure(j))}function H(j,Q,G){return L(j)?Q(Re.ofBounds(0,I.groupCount*I.instanceCount)):o(j,w,Q,G)}function B(j){m&&(l==null||l(m.values,A,x,C,j.webgl))}return{get groupCount(){return I?I.count:0},get renderObject(){return I&&I.count?m:void 0},createOrUpdate:function(j,Q,G,W){if(G===void 0&&(G={}),k(Q,G,W||w),g.createGeometry){var q=n(j,S,b,y,A);if(uO(q))return q.then(function(J){R(J),B(j)});R(q)}else R();B(j)},getLoci:function(j){return m?i(j,w,m.id):Or},mark:function(j,Q){return Cr.mark(m,j,Q,H)},setVisibility:function(j){Cr.setVisibility(m,j)},setAlphaFactor:function(j){Cr.setAlphaFactor(m,j)},setPickable:function(j){Cr.setPickable(m,j)},setColorOnly:function(j){Cr.setColorOnly(m,j)},setTransform:function(j,Q){Cr.setTransform(m,j,Q)},setOverpaint:function(j){Cr.setOverpaint(m,j,H,!0)},setTransparency:function(j){Cr.setTransparency(m,j,H,!0)},setClipping:function(j){Cr.setClipping(m,j,H,!0)},destroy:function(){c==null||c(A),m&&(m.state.disposed=!0,m=void 0)},mustRecreate:u}}var Ub=E(E({},hJ),Do);function xv(e,t){return u0(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Ft.Utils}),t)}var Wze=E(E({},pJ),Do);function $ze(e,t){return u0(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Ko.Utils}),t)}var Xze=E(E({},vJ),Do);function Yze(e,t){return u0(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Cn.Utils}),t)}var Kze=E(E({},mJ),Do);function Qze(e,t){return u0(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.updateSize=!0),n.background!==a.background&&(r.createGeometry=!0),n.backgroundMargin!==a.backgroundMargin&&(r.createGeometry=!0),n.tether!==a.tether&&(r.createGeometry=!0),n.tetherLength!==a.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==a.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==a.attachment&&(r.createGeometry=!0),n.fontFamily!==a.fontFamily&&(r.createGeometry=!0),n.fontQuality!==a.fontQuality&&(r.createGeometry=!0),n.fontStyle!==a.fontStyle&&(r.createGeometry=!0),n.fontVariant!==a.fontVariant&&(r.createGeometry=!0),n.fontWeight!==a.fontWeight&&(r.createGeometry=!0)},geometryUtils:$s.Utils}),t)}var Zze=E(E({},gJ),Do);function Jze(e,t){return u0(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ro.Utils}),t)}var eVe=E(E({},yJ),Do);function tVe(e,t){return u0(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Vu.Utils}),t)}function na(e,t,r,n){var a=0,i=t.webgl,o=new ta,s=_d(),u=[],l=Ba.create(),c=new Map,d,f,h,v,p=ya.createEmpty();function g(w,A){var I=this;return w===void 0&&(w={}),A&&A!==d&&(h=r(t,A),v||(v=T.getDefaultValues(h))),v=Object.assign({},v,w),et.create("Creating or updating UnitsRepresentation",function(D){return de(I,void 0,void 0,function(){var B,W,G,q,k,B,W,L,G,q,q,R,G,q,B,W,L,G,q,q,H,B,j,Q,G,W,q,q,J,he,$;return fe(this,function(X){switch(X.label){case 0:if(!(!d&&!A))return[3,1];throw new Error("missing structure");case 1:if(!(A&&!d))return[3,8];f=A.unitSymmetryGroups,B=0,X.label=2;case 2:return B<f.length?(W=f[B],G=n(s,A,v,i),q=G.createOrUpdate({webgl:i,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,4]):[3,7];case 3:X.sent(),X.label=4;case 4:return b(G,W,l),c.set(W.hashCode,{visual:G,group:W}),D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,6];case 5:X.sent(),X.label=6;case 6:return B++,[3,2];case 7:return[3,43];case 8:if(!(A&&(!tt.areUnitIdsAndIndicesEqual(A,d)||A.child!==d.child)))return[3,22];f=A.unitSymmetryGroups,k=c,c=new Map,B=0,X.label=9;case 9:return B<f.length?(W=f[B],L=k.get(W.hashCode),L?(G=L.visual,!((J=G.mustRecreate)===null||J===void 0)&&J.call(G,{group:W,structure:A},v,i)?(G.destroy(),G=n(s,A,v,i),q=G.createOrUpdate({webgl:i,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,11]):[3,12]):[3,15]):[3,21];case 10:X.sent(),X.label=11;case 11:return b(G,W,l),[3,14];case 12:return q=G.createOrUpdate({webgl:i,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,14];case 13:X.sent(),X.label=14;case 14:return c.set(W.hashCode,{visual:G,group:W}),k.delete(W.hashCode),G.renderObject&&(R=G.renderObject.values.tMarker.ref.value.array,Hu(R,Re.ofBounds(0,R.length),tr.RemoveHighlight)),[3,18];case 15:return G=n(s,A,v,i),q=G.createOrUpdate({webgl:i,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,17];case 16:X.sent(),X.label=17;case 17:b(G,W,l),c.set(W.hashCode,{visual:G,group:W}),X.label=18;case 18:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,20];case 19:X.sent(),X.label=20;case 20:return B++,[3,9];case 21:return k.forEach(function(U){var z=U.visual;z.destroy()}),[3,43];case 22:if(!(A&&A!==d&&tt.areUnitIdsAndIndicesEqual(A,d)))return[3,34];f=A.unitSymmetryGroups,B=0,X.label=23;case 23:return B<f.length?(W=f[B],L=c.get(W.hashCode),L?(G=L.visual,!((he=G.mustRecreate)===null||he===void 0)&&he.call(G,{group:W,structure:A},v,t.webgl)?(G.destroy(),G=n(s,A,v,t.webgl),L.visual=G,q=G.createOrUpdate({webgl:i,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,25]):[3,26]):[3,29]):[3,33];case 24:X.sent(),X.label=25;case 25:return b(G,W,l),[3,28];case 26:return q=G.createOrUpdate({webgl:i,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,28];case 27:X.sent(),X.label=28;case 28:return L.group=W,[3,30];case 29:throw new Error("expected to find visual for hashCode "+W.hashCode);case 30:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,32];case 31:X.sent(),X.label=32;case 32:return B++,[3,23];case 33:return[3,43];case 34:H=[],c.forEach(function(U){return H.push(U)}),B=0,j=H.length,X.label=35;case 35:return B<j?(Q=H[B],G=Q.visual,W=Q.group,!(($=G.mustRecreate)===null||$===void 0)&&$.call(G,{group:W,structure:d},v,t.webgl)?(G.destroy(),G=n(s,d,v,i),H[B].visual=G,q=G.createOrUpdate({webgl:i,runtime:D},p,v,{group:W,structure:d}),q?[4,q]:[3,37]):[3,38]):[3,43];case 36:X.sent(),X.label=37;case 37:return b(G,W,l),[3,40];case 38:return q=G.createOrUpdate({webgl:i,runtime:D},p,v),q?[4,q]:[3,40];case 39:X.sent(),X.label=40;case 40:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:j})]:[3,42];case 41:X.sent(),X.label=42;case 42:return++B,[3,35];case 43:return u.length=0,c.forEach(function(U){var z=U.visual;z.renderObject&&u.push(z.renderObject)}),A&&(d=A),o.next(a++),[2]}})})})}function m(w){if(w===void 0)return tt.Loci(d.target);var A=Or;return c.forEach(function(I){var D=I.visual,k=D.getLoci(w);Mu(k)||(A=k)}),A}function y(w,A){if(!d||!Mo.is(l.markerActions,A))return!1;if(tt.isLoci(w)||Oe.is(w)||Gt.isLoci(w)){if(!tt.areRootsEquivalent(w.structure,d))return!1;w=or.remap(w,d)}else if(!js(w)&&!t1(w))return!1;if(or.isEmpty(w))return!1;var I=!1;return c.forEach(function(D){var k=D.visual;I=k.mark(w,A)||I}),I}function b(w,A,I){var D=I.visible,k=I.alphaFactor,R=I.pickable,L=I.overpaint,H=I.transparency,B=I.clipping,j=I.transform,Q=I.unitTransforms;D!==void 0&&w.setVisibility(D),k!==void 0&&w.setAlphaFactor(k),R!==void 0&&w.setPickable(R),L!==void 0&&w.setOverpaint(L),H!==void 0&&w.setTransparency(H),B!==void 0&&w.setClipping(B),j!==void 0&&w.setTransform(j),Q!==void 0&&(Q?w.setTransform(void 0,Q.getSymmetryGroupTransforms(A)):w.setTransform(void 0,null))}function S(w){var A=w.visible,I=w.alphaFactor,D=w.pickable,k=w.overpaint,R=w.transparency,L=w.clipping,H=w.transform,B=w.unitTransforms,j=w.syncManually,Q=w.markerActions,G={};A!==l.visible&&(G.visible=A),I!==l.alphaFactor&&(G.alphaFactor=I),D!==l.pickable&&(G.pickable=D),k!==void 0&&!qa.areEqual(k,l.overpaint)&&d&&(G.overpaint=qa.remap(k,d)),R!==void 0&&!Wa.areEqual(R,l.transparency)&&d&&(G.transparency=Wa.remap(R,d)),L!==void 0&&!an.areEqual(L,l.clipping)&&d&&(G.clipping=an.remap(L,d)),H!==void 0&&!le.areEqual(H,l.transform,yn)&&(G.transform=H),(B!==l.unitTransforms||(B==null?void 0:B.version)!==w.unitTransformsVersion)&&(G.unitTransforms=B,l.unitTransformsVersion=B?B==null?void 0:B.version:-1),j!==l.syncManually&&(G.syncManually=j),Q!==l.markerActions&&(G.markerActions=Q),c.forEach(function(W){var q=W.visual,J=W.group;return b(q,J,G)}),Ba.update(l,G)}function x(w){p=w}function C(){c.forEach(function(w){var A=w.visual;return A.destroy()}),c.clear()}return{label:e,get groupCount(){var w=0;return c.forEach(function(A){var I=A.visual;I.renderObject&&(w+=I.groupCount)}),w},get props(){return v},get params(){return h},get state(){return l},get theme(){return p},renderObjects:u,updated:o,createOrUpdate:g,setState:S,setTheme:x,getLoci:m,mark:y,destroy:C}}function rVe(e,t,r,n,a,i){var o=oi.getUtils(t),s=o.createValues,u=o.createRenderableState,l=lJ(e,a.includeParent),c=s(t,l,r,n,a),d=u(a);return a0(t.kind,c,d,i)}function Sv(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.createEmpty,h=d.updateValues,v=d.updateBoundingSphere,p=d.updateRenderableState,g=d.createPositionIterator,m=Ll.create(),y,b=Object.assign({},r),S=ya.createEmpty(),x,C,w,A,I,D,k;function R(G,W,q){if(!q&&!A)throw new Error("missing structureGroup");if(b=W,S=G,x=q,Ll.reset(m),!y||!A){m.createNew=!0,m.createGeometry=!0;return}s(m,b,C,S,w,x,A),tt.areHierarchiesEqual(A.structure,x.structure)||(m.updateTransform=!0,m.updateColor=!0,m.updateSize=!0),Qc.areEqual(S.color,w.color)||(m.updateColor=!0),A.structure.child!==x.structure.child&&(m.createGeometry=!0),zc(b.unitKinds,C.unitKinds)||(m.createGeometry=!0),x.group.transformHash!==A.group.transformHash&&(x.group.units.length!==A.group.units.length||m.updateColor?m.updateTransform=!0:m.updateMatrix=!0);var J=x.group.units[0],he=A.group.units[0];We.areOperatorsEqual(J,he)||(m.updateTransform=!0),We.areConformationsEqual(J,he)||(m.createGeometry=!0),m.updateTransform&&(m.updateMatrix=!0),m.updateSize&&!("uSize"in y.values)&&(m.createGeometry=!0),(m.createGeometry||m.updateTransform)&&(A.structure.hashCode!==x.structure.hashCode&&(m.updateColor=!0,m.updateSize=!0),(S.color.granularity.startsWith("vertex")||y.values.dColorType.ref.value.startsWith("vertex")||S.color.granularity.startsWith("volume")||y.values.dColorType.ref.value.startsWith("volume"))&&(m.updateColor=!0))}function L(G){if(m.createNew)if(D=a(x),G)y=rVe(x,G,D,S,b,t),k=g(G,y.values);else throw new Error("expected geometry to be given");else{if(!y)throw new Error("expected renderObject to be available");if(m.updateTransform){D=a(x);var W=D.instanceCount,q=D.groupCount;Js(W*q,y.values)}if(m.updateMatrix&&lJ(x,b.includeParent,y.values),m.createGeometry)if(G)N.updateIfChanged(y.values.drawCount,oi.getDrawCount(G)),N.updateIfChanged(y.values.uVertexCount,oi.getVertexCount(G));else throw new Error("expected geometry to be given");(m.updateTransform||m.createGeometry)&&(v(y.values,G||I),k=g(G||I,y.values)),m.updateSize&&"uSize"in y.values&&hd(D,S.size,y.values),m.updateColor&&cs(D,k,S.color,y.values),h(y.values,b),p(y.state,b)}C=b,w=S,A=x,G&&(I=G)}function H(G,W,q,J,he,$){return Bze(he.unitKinds,W)?n(G,W,q,J,he,$):f($)}function B(G){return!!(js(G)||tt.isLoci(G)&&tt.areRootsEquivalent(G.structure,A.structure)||Oe.is(G)&&tt.areRootsEquivalent(G.structure,A.structure)&&Oe.isWholeStructure(G))}function j(G,W,q){return B(G)?W(Re.ofBounds(0,D.groupCount*D.instanceCount)):o(G,A,W,q)}function Q(G){y&&(l==null||l(y.values,I,C,w,G.webgl))}return{get groupCount(){return D?D.count:0},get renderObject(){return D&&D.count?y:void 0},createOrUpdate:function(G,W,q,J){if(R(W,q,J||A),m.createGeometry){var he=H(G,x.group.units[0],x.structure,S,b,I);if(uO(he))return he.then(function($){L($),Q(G)});L(he)}else L();Q(G)},getLoci:function(G){return y?i(G,A,y.id):Or},mark:function(G,W){return Cr.mark(y,G,W,j)},setVisibility:function(G){Cr.setVisibility(y,G)},setAlphaFactor:function(G){Cr.setAlphaFactor(y,G)},setPickable:function(G){Cr.setPickable(y,G)},setColorOnly:function(G){Cr.setColorOnly(y,G)},setTransform:function(G,W){Cr.setTransform(y,G,W)},setOverpaint:function(G){Cr.setOverpaint(y,G,j,!0)},setTransparency:function(G){Cr.setTransparency(y,G,j,!0)},setClipping:function(G){Cr.setClipping(y,G,j,!0)},destroy:function(){c==null||c(I),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:u}}var Ci=E(E({},hJ),Do);function oo(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Ft.Utils}),t)}var bJ=E(E({},Hze),Do);function xJ(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:ah.Utils}),t)}var SJ=E(E({},pJ),Do);function CJ(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Ko.Utils}),t)}var nVe=E(E({},Gze),Do);function aVe(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Qp.Utils}),t)}var yO=E(E({},vJ),Do);function bO(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Cn.Utils}),t)}E(E({},mJ),Do);var iVe=E(E({},gJ),Do);function oVe(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ro.Utils}),t)}var sVe=E(E({},yJ),Do);function uVe(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ya.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Vu.Utils}),t)}var Ba={create:function(){return E(E({},sr.createState()),{unitTransforms:null,unitTransformsVersion:-1})},update:function(e,t){sr.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};function Fr(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function _J(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function sb(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function x_(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function xO(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function lVe(e,t,r){for(var n=0,a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]];Nr.isCovalent(s.props.flag)&&(n+=1)}return n}function cVe(e,t){for(var r=0,n=e.bonds,a=n.offset,i=n.edgeProps.flags,o=a[t],s=a[t+1];o<s;++o)Nr.isCovalent(i[o])&&(r+=1);return r}function Jc(e,t,r){return lVe(e,t,r)+cVe(t,r)}function eo(e,t,r,n){var a=0;return Xs(e,t,r,function(i,o){Fr(i,o)===n&&(a+=1)}),a}function dVe(e,t,r){var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags;Nr.is;for(var s=a[t],u=a[t+1];s<u;++s)if(i[s]===r&&Nr.isCovalent(o[s]))return!0;return!1}function fVe(e,t,r,n,a){var i=e.interUnitBonds.getEdge(r,t.id,a,n.id);return i&&Nr.isCovalent(i.props.flag)}function hVe(e,t,r,n,a){return t===n?dVe(t,r,a):fVe(e,t,r,n,a)}function pVe(e,t,r,n){for(var a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]],u=e.unitMap.get(s.unitB);Nr.isCovalent(s.props.flag)&&n(u,s.indexB)}}function vVe(e,t,r){for(var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags,s=a[t],u=a[t+1];s<u;++s)Nr.isCovalent(o[s])&&r(e,i[s])}function Xs(e,t,r,n){pVe(e,t,r,n),vVe(t,r,n)}function mVe(e){switch(e){case 0:return"Spherical";case 1:return"Terminal";case 2:return"Linear";case 3:return"Trigonal";case 4:return"Tetrahedral";case 5:return"Trigonal Bi-Pyramidal";case 6:return"Octahedral";case 7:return"Square Planar";case 8:return"Unknown"}}function Yv(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var lj=new Map([[2,Xr(180)],[3,Xr(120)],[4,Xr(109.4721)],[6,Xr(90)]]),S_=_(),C_=_(),up=_(),__=_(),Mm=_();function w_(e,t,r,n,a){var i=[];return t.conformation.position(t.elements[r],up),n.conformation.position(n.elements[a],__),_.sub(S_,__,up),Xs(e,t,r,function(o,s){Fr(o,s)!=="H"&&(o.conformation.position(o.elements[s],Mm),_.sub(C_,Mm,up),i.push(_.angle(S_,C_)))}),i}function cj(e,t,r,n,a){t.conformation.position(t.elements[r],up),n.conformation.position(n.elements[a],__),_.sub(S_,__,up);var i=[_(),_()],o=0,s,u;if(Xs(e,t,r,function(l,c){o>1||Fr(l,c)!=="H"&&(s=l,u=c,l.conformation.position(l.elements[c],Mm),_.sub(i[o++],Mm,up))}),o===1&&s&&u&&Xs(e,s,u,function(l,c){o>1||l===t&&c===r||Fr(l,c)!=="H"&&(l.conformation.position(l.elements[c],Mm),_.sub(i[o++],Mm,up))}),o===2)return _.cross(C_,i[0],i[1]),Math.abs(Math.PI/2-_.angle(C_,S_))}var JP=new Gt.ElementBondIterator,eT=new Gt.ElementBondIterator;function gVe(e,t,r){var n=Fr(t,r),a=n==="O"||n==="N";if(a&&Jc(e,t,r)===4)return!1;for(JP.setElement(e,t,r);JP.hasNext;){var i=JP.move();if(i.order>1)return!0;if(a){var o=Fr(i.otherUnit,i.otherIndex);for(eT.setElement(e,i.otherUnit,i.otherIndex);eT.hasNext;){var s=eT.move();if(s.order>1){if((o==="P"||o==="S")&&Fr(s.otherUnit,s.otherIndex)==="O")continue;return!0}}}}return!1}function yVe(e,t,r){for(var n=0,a=t.bonds,i=a.offset,o=a.edgeProps,s=o.flags,u=o.order,l=i[r],c=i[r+1];l<c;++l)Nr.isCovalent(s[l])&&(n+=u[l]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(function(d){var f=e.interUnitBonds.edges[d];Nr.isCovalent(f.props.flag)&&(n+=f.props.order)}),n}var Kv=new Gt.ElementBondIterator,tT=new Gt.ElementBondIterator;function bVe(e,t,r,n){var a=eo(e,t,r,"H"),i=Fr(t,r),o=_J(t,r),s=n.assignCharge==="always"||n.assignCharge==="auto"&&o===0,u=n.assignH==="always"||n.assignH==="auto"&&a===0,l=Jc(e,t,r),c=yVe(e,t,r),d=gVe(e,t,r),f=c-l>0,h=0,v=8;switch(i){case"H":s&&(l===0?(o=1,v=0):l===1&&(o=0,v=1));break;case"C":s&&(o=0),u&&(h=Math.max(0,4-c-Math.abs(o))),v=Yv(l+h+Math.max(0,-o));break;case"N":if(s)if(!u)o=c-3;else if(d&&c<4)l-a===1&&c-a===2?o=1:o=0;else for(Kv.setElement(e,t,r);Kv.hasNext;){var p=Kv.move(),g=Fr(p.otherUnit,p.otherIndex);if(g==="S"||Kje(g)){o=0;break}else o=1}u&&(h=Math.max(0,3-c+o)),d&&!f?v=Yv(l+h-o):v=Yv(l+h+1-o);break;case"O":if(s&&(u||(o=c-2),c===1)){Kv.setElement(e,t,r);e:for(;Kv.hasNext;){var m=Kv.move();for(tT.setElement(e,m.otherUnit,m.otherIndex);tT.hasNext;){var y=tT.move();if(!(y.otherUnit===t&&y.otherIndex===r)&&Fr(y.otherUnit,y.otherIndex)==="O"&&y.order===2){o=-1;break e}}}}u&&(h=Math.max(0,2-c+o)),d&&!f?v=Yv(l+h-o+1):v=Yv(l+h-o+2);break;case"S":s&&(u||(c<=3&&eo(e,t,r,"O")===0?o=c-2:o=0)),u&&c<2&&(h=Math.max(0,2-c+o)),c<=3&&(v=Yv(l+h-o+2));break;case"F":case"CL":case"BR":case"I":case"AT":s&&(o=c-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":s&&(o=1-c);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":s&&(o=2-c);break;default:Mr&&console.warn("Requested charge, protonation for an unhandled element",i)}return[o,h,h+a,v]}function xVe(e,t,r){var n=t.elements.length,a=new Int8Array(n),i=new Int8Array(n),o=new Int8Array(n),s=new Int8Array(n),u=!!e.parent,l;if(u){var c=e.root.unitMap.get(t.id);if(l=it.indicesOf(c.elements,t.elements),l.length!==t.elements.length)throw new Error("expected to find an index for every element");t=c,e=e.root}for(var d=0;d<n;++d){var f=u?l[d]:d,h=bVe(e,t,f,r),v=h[0],p=h[1],g=h[2],m=h[3];a[d]=v,i[d]=p,o[d]=g,s[d]=m}return{charge:a,implicitH:i,totalH:o,idealGeometry:s}}var wJ={assignCharge:T.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:T.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function SVe(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u;return fe(this,function(l){for(n=E(E({},T.getDefaultValues(wJ)),r),a=new Map,i=0,o=t.units.length;i<o;++i)s=t.units[i],We.isAtomic(s)&&(u=xVe(t,s,n),a.set(s.id,u));return[2,a]})})}var rT=E({},wJ),jb=th.createProvider({label:"Valence Model",descriptor:Po({name:"molstar_computed_valence_model"}),type:"local",defaultParams:rT,getParams:function(e){return rT},isApplicable:function(e){return!0},obtain:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return n=E(E({},T.getDefaultValues(rT)),r),a={},[4,SVe(e.runtime,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),Tn;(function(e){function t(d,f,h,v){return _.set(d,v.x[h],v.y[h],v.z[h]),_.transformMat4(d,d,f.conformation.operator.matrix),d}e.setPosition=t;function r(d,f){for(var h=new Int32Array(f+1),v=new Int32Array(f),p=new Int32Array(f),g=d.members,m=d.count,y=d.offsets,b=0,S=y[m];b<S;++b)++p[g[b]];for(var x=0,b=0;b<f;b++)h[b]=x,x+=p[b];h[f]=x;for(var C=new Int32Array(x),b=0;b<m;++b)for(var w=y[b],A=y[b+1];w<A;++w){var I=g[w],D=h[I]+v[I];C[D]=b,++v[I]}return{indices:C,offsets:h}}e.createElementsIndex=r;function n(d,f){var h,v;return E(E({},f),{get lookup3d(){if(!h){var p={x:f.x,y:f.y,z:f.z,indices:Fe.ofBounds(0,f.count)};h=Gp(p,Pg(p))}return h},get elementsIndex(){return v||(v=r(f,d))},subset:function(p){return a(f,p)}})}e.create=n;function a(d,f){for(var h,v=d.count,p=d.types,g=[],m=0;m<v;++m)f.has(p[m])&&g.push(m);var y=it.ofSortedArray(g);return{indices:y,get lookup3d(){if(!h){var b={x:d.x,y:d.y,z:d.z,indices:y};h=Gp(b,Pg(b))}return h}}}e.createSubset=a;function i(d,f,h){var v=jb.get(d).value;if(!v||!v.has(f.id))throw new Error("valence model required");return{unit:f,types:h.types,feature:-1,x:h.x,y:h.y,z:h.z,members:h.members,offsets:h.offsets,idealGeometry:v.get(f.id).idealGeometry}}e.Info=i;function o(d,f){return _.set(d,f.x[f.feature],f.y[f.feature],f.z[f.feature]),_.transformMat4(d,d,f.unit.conformation.operator.matrix),d}e.position=o;var s=_(),u=_();function l(d,f){var h=d.members[d.offsets[d.feature]],v=f.members[f.offsets[f.feature]];return d.unit.conformation.position(d.unit.elements[h],s),f.unit.conformation.position(f.unit.elements[v],u),_.distance(s,u)}e.distance=l;function c(d,f){return{types:new Set(d),add:f}}e.Provider=c})(Tn||(Tn={}));var CD;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Je.create(Float32Array,1,n,a?a.x:r),o=Je.create(Float32Array,1,n,a?a.y:r),s=Je.create(Float32Array,1,n,a?a.z:r),u=Je.create(Uint8Array,1,n,a?a.types:r),l=Je.create(Uint8Array,1,n,a?a.groups:r),c=Je.create(Uint32Array,1,n,a?a.offsets:r),d=Je.create(Uint32Array,1,n,a?a.members:r),f={x:0,y:0,z:0,offset:0,count:0};return{startState:function(){f.x=0,f.y=0,f.z=0,f.offset=d.elementCount,f.count=0},pushMember:function(h,v,p,g){Je.add(d,g),f.x+=h,f.y+=v,f.z+=p,f.count+=1},finishState:function(h,v){var p=f.count;p!==0&&(Je.add(u,h),Je.add(l,v),Je.add(i,f.x/p),Je.add(o,f.y/p),Je.add(s,f.z/p),Je.add(c,f.offset))},add:function(h,v,p,g,m,y){Je.add(u,h),Je.add(l,v),Je.add(i,p),Je.add(o,g),Je.add(s,m),Je.add(c,d.elementCount),Je.add(d,y)},getFeatures:function(h){Je.add(c,d.elementCount);var v=Je.compact(i,!0),p=Je.compact(o,!0),g=Je.compact(s,!0),m=i.elementCount;return Tn.create(h,{x:v,y:p,z:g,count:m,types:Je.compact(u,!0),groups:Je.compact(l,!0),offsets:Je.compact(c,!0),members:Je.compact(d,!0)})}}}e.create=t})(CD||(CD={}));var _D;(function(e){function t(r,n,a){for(var i=new Int32Array(a+1),o=new Int32Array(a),s=new Int32Array(a),u=n.members,l=n.offsets,c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],h=r.b[c];if(!(f>h)){for(var v=l[f],p=l[f+1];v<p;++v)++s[u[v]];for(var v=l[h],p=l[h+1];v<p;++v)++s[u[v]]}}for(var g=0,c=0;c<a;c++)i[c]=g,g+=s[c];i[a]=g;for(var m=new Int32Array(g),c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],h=r.b[c];if(!(f>h)){for(var v=l[f],p=l[f+1];v<p;++v){var y=u[v],b=i[y]+o[y];m[b]=c,++o[y]}for(var v=l[h],p=l[h+1];v<p;++v){var y=u[v],b=i[y]+o[y];m[b]=c,++o[y]}}}return{indices:m,offsets:i}}e.createElementsIndex=t})(_D||(_D={}));var CVe=function(e){Be(t,e);function t(r,n){var a=e.call(this,r)||this,i=0,o=new Map,s=function(u,l){var c=a.getElementKey(u,l),d=o.get(c);d===void 0?o.set(c,[i]):d.push(i)};return a.map.forEach(function(u){u.forEach(function(l){var c=l.unitA,d=l.connectedIndices;d.forEach(function(f){for(var h=n.get(c),v=h.offsets,p=h.members,g=v[f],m=v[f+1];g<m;++g)s(p[g],c);i+=1})})}),a.elementKeyIndex=o,a}return t.prototype.getContactIndicesForElement=function(r,n){return this.elementKeyIndex.get(this.getElementKey(r,n.id))||[]},t.prototype.getElementKey=function(r,n){return r+"|"+n},t}(qp);function dj(e){switch(e){case 4:return"Hydrogen Bond";case 6:return"Hydrophobic Contact";case 5:return"Halogen Bond";case 1:return"Ionic Interaction";case 7:return"Metal Coordination";case 2:return"Cation-Pi Interaction";case 3:return"Pi Stacking";case 8:return"Weak Hydrogen Bond";case 0:return"Unknown Interaction"}}function _Ve(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}function wVe(e){switch(e){case 0:return"None";case 1:return"Quaternary Amine";case 2:return"Tertiary Amine";case 3:return"Sulfonium";case 4:return"Sulfonic Acid";case 5:return"Sulfate";case 6:return"Phosphate";case 7:return"Halocarbon";case 8:return"Guanidine";case 9:return"Acetamidine";case 10:return"Carboxylate"}}var wD;(function(e){function t(r,n){var a=[],i=[],o=[];return{add:function(s,u,l){a[a.length]=s,i[i.length]=u,o[o.length]=l},getContacts:function(){for(var s=new To.EdgeBuilder(r.count,a,i),u=new Int8Array(s.slotCount),l=new Int8Array(s.slotCount),c=0,d=s.edgeCount;c<d;c++)s.addNextEdge(),s.assignProperty(u,o[c]);var f=s.createGraph({type:u,flag:l}),h,v=Object.defineProperty(f,"elementsIndex",{get:function(){return h||(h=_D.createElementsIndex(f,r,n))}});return v}}}e.create=t})(wD||(wD={}));var ED;(function(e){function t(){var r=new qp.Builder;return{startUnitPair:function(n,a){r.startUnitPair(n.id,a.id)},finishUnitPair:function(){r.finishUnitPair()},add:function(n,a,i){r.add(n,a,{type:i,flag:0})},getContacts:function(n){return new CVe(r.getMap(),n)}}}e.create=t})(ED||(ED={}));var EVe={lineOfSightDistFactor:T.Numeric(1,{min:0,max:3,step:.1})},AVe=3;function EJ(e,t,r){var n=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(n===a&&t.unit===r.unit)return!1;var i=x_(t.unit,n),o=x_(r.unit,a);return!(i&&o&&i!==o||t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[a]]&&t.unit===r.unit||hVe(e,t.unit,n,r.unit,a))}function fj(e,t,r,n){var a=x_(e,t),i=x_(r,n);return a&&i&&a!==i}function hj(e,t){for(var r=t.feature,n=t.offsets,a=t.members,i=n[r],o=n[r+1];i<o;++i)if(a[i]===e)return!0;return!1}var Nd=_(),nT=_(),aT=_(),PVe=pK();function AJ(e,t,r,n){var a=t.feature,i=r.feature,o=t.members[t.offsets[a]],s=r.members[r.offsets[i]];Tn.position(nT,t),Tn.position(aT,r),_.scale(Nd,_.add(Nd,nT,aT),.5);var u=n*AVe,l=e.lookup3d.find(Nd[0],Nd[1],Nd[2],u,PVe),c=l.count,d=l.indices,f=l.units,h=l.squaredDistances;if(c===0)return!0;for(var v=0;v<c;++v){var p=d[v],g=f[v];if(We.isAtomic(g)){var m=Fr(g,p);if(m!=="H"){var y=Mb(m);if(!(y*y*n*n<=h[v])&&!(fj(g,p,t.unit,o)||fj(g,p,r.unit,s))&&!(t.unit===g&&hj(p,t)||r.unit===g&&hj(p,r))&&(g.conformation.position(g.elements[p],Nd),!(_.squaredDistance(Nd,nT)<1||_.squaredDistance(Nd,aT)<1)))return!1}}}return!0}function TVe(e,t,r,n,a,i){for(var o=0,s=a;o<s.length;o++){var u=s[o];IVe(e,t,r,n,u,i)}}function IVe(e,t,r,n,a,i){for(var o=r.x,s=r.y,u=r.z,l=r.subset(a.requiredFeatures),c=l.lookup3d,d=l.indices,f=Tn.Info(e,t,r),h=E({},f),v=i.lineOfSightDistFactor,p=0,g=Fe.size(d);p<g;++p){var m=Fe.getAt(d,p),y=c.find(o[m],s[m],u[m],a.maxDistance),b=y.count,S=y.indices,x=y.squaredDistances;if(b!==0){f.feature=m;for(var C=0;C<b;++C){var w=Fe.getAt(d,S[C]);if(!(w<=m)&&(h.feature=w,!!EJ(e,f,h))){var A=a.getType(e,f,h,x[C]);A&&AJ(e,f,h,v)&&n.add(m,w,A)}}}}}var MVe=le();function DVe(e,t,r,n,a,i,o,s){var u=r.count,l=r.x,c=r.y,d=r.z,f=a.lookup3d,h=le.mul(MVe,n.conformation.operator.inverse,t.conformation.operator.matrix),v=!le.isIdentity(h),p=_(),g=Math.max.apply(Math,o.map(function(q){return q.maxDistance})),m=f.boundary.sphere,y=m.center,b=m.radius,S=(b+g)*(b+g),x=s.lineOfSightDistFactor,C=Tn.Info(e,t,r),w=Tn.Info(e,n,a);i.startUnitPair(t,n);for(var A=0;A<u;++A)if(_.set(p,l[A],c[A],d[A]),v&&_.transformMat4(p,p,h),!(_.squaredDistance(p,y)>S)){var I=f.find(p[0],p[1],p[2],g),D=I.indices,k=I.count,R=I.squaredDistances;if(k!==0){C.feature=A;for(var L=0;L<k;++L){var H=D[L];if(w.feature=H,!!EJ(e,C,w))for(var B=R[L],j=0,Q=o;j<Q.length;j++){var G=Q[j];if(B<G.maxDistance*G.maxDistance){var W=G.getType(e,C,w,B);if(W&&AJ(e,C,w,x)){i.add(A,H,W);break}}}}}}i.finishUnitPair()}var RVe={distanceMax:T.Numeric(4,{min:1,max:5,step:.1}),angleMax:T.Numeric(30,{min:0,max:60,step:1})},kVe=["CL","BR","I","AT"];function OVe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Fr(t,u);kVe.includes(c)&&r.add(6,0,i[n[u]],o[n[u]],s[n[u]],u)}}var LVe=["N","O","S"],NVe=["C","N","P","S"];function FVe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var h=Fr(t,d);if(LVe.includes(h)){var v=!1;Xs(e,t,d,function(p,g){NVe.includes(Fr(p,g))&&(v=!0)}),v&&r.add(7,0,i[n[d]],o[n[d]],s[n[d]],d)}},l=0,c=n.length;l<c;++l)u(l)}function BVe(e,t){return e===7&&t===6||e===6&&t===7}var UVe=Xr(180),jVe=Xr(120);function zVe(e){return{angleMax:Xr(e.angleMax)}}function VVe(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(BVe(a,i)){var o=a===6?[t,r]:[r,t],s=o[0],u=o[1],l=s.members[s.offsets[s.feature]],c=u.members[u.offsets[u.feature]],d=w_(e,s.unit,l,u.unit,c);if(d.length===1&&!(UVe-d[0]>n.angleMax)){var f=w_(e,u.unit,c,s.unit,l);if(f.length!==0&&!f.some(function(h){return jVe-h>n.angleMax}))return 5}}}var HVe=Tn.Provider([6],OVe),GVe=Tn.Provider([7],FVe),qVe={name:"halogen-bonds",params:RVe,createTester:function(e){var t=zVe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:function(r,n,a){return VVe(r,n,a,t)}}}},PJ={distanceMax:T.Numeric(3.5,{min:1,max:5,step:.1}),backbone:T.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:T.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:T.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:T.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:T.Numeric(45,{min:0,max:180,step:1})},WVe=E(E({},PJ),{water:T.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:T.Numeric(4.1,{min:1,max:5,step:.1})}),$Ve=E({},PJ);function SO(e,t){var r=jb.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function XVe(e,t,r){for(var n=SO(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=t.rings.elementAromaticRingIndices,c=0,d=a.length;c<d;++c)if(!l.has(c)){var f=Fr(t,c);(TJ(t,c)||n[c]>0&&(f==="N"||f==="O"||f==="S"))&&r.add(4,0,o[a[c]],s[a[c]],u[a[c]],c)}}function YVe(e,t,r){for(var n=SO(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=0,c=a.length;l<c;++l)Fr(t,l)==="C"&&n[l]>0&&(eo(e,t,l,"N")>0||eo(e,t,l,"O")>0||KVe(t,l))&&r.add(9,0,o[a[l]],s[a[l]],u[a[l]],l)}function KVe(e,t){var r=e.rings,n=r.elementAromaticRingIndices,a=r.all,i=n.get(t);if(i===void 0)return!1;for(var o=0,s=i.length;o<s;++o)for(var u=a[i[o]],l=0,c=u.length;l<c;++l){var d=Fr(e,u[l]);if(d==="N"||d==="O")return!0}return!1}function QVe(e,t,r){for(var n=SO(e,t),a=n.charge,i=n.implicitH,o=n.idealGeometry,s=t.elements,u=t.model.atomicConformation,l=u.x,c=u.y,d=u.z,f=t.rings.elementAromaticRingIndices,h=function(S){r.add(5,0,l[s[S]],c[s[S]],d[s[S]],S)},v=0,p=s.length;v<p;++v)if(!f.has(v)){var g=Fr(t,v);if(g==="O")h(v);else if(g==="N"){if(TJ(t,v))h(v);else if(a[v]<1){var m=Jc(e,t,v)+i[v],y=o[v];(y===4&&m<4||y===3&&m<3||y===2&&m<2)&&h(v)}}else if(g==="S"){var b=xO(t,v);(b==="CYS"||b==="MET"||_J(t,v)===-1)&&h(v)}}}function pj(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function vj(e,t){return $c.has(sb(e,t))}function ZVe(e,t){return e.rings.elementRingIndices.has(t)}function TJ(e,t){return xO(e,t)==="HIS"&&Fr(e,t)==="N"&&ZVe(e,t)}function JVe(e,t,r,n){return vj(e,t)&&vj(r,n)}function eHe(e,t,r,n){return pj(e,t)&&pj(r,n)}function tHe(e,t){return e===5&&t===4||e===4&&t===5}function rHe(e,t){return e===9&&t===5||e===5&&t===9}function IJ(e){return{includeBackbone:e.backbone,maxAccAngleDev:Xr(e.accAngleDevMax),maxDonAngleDev:Xr(e.donAngleDevMax),maxAccOutOfPlaneAngle:Xr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:Xr(e.donOutOfPlaneAngleMax)}}function nHe(e){return E(E({},IJ(e)),{includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax})}var mj=Xr(120);function MJ(e,t,r,n){var a=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(!(!n.includeBackbone&&JVe(t.unit,a,r.unit,i))){var o=w_(e,t.unit,a,r.unit,i),s=lj.get(t.idealGeometry[a])||mj;if(!o.some(function(d){return Math.abs(s-d)>n.maxDonAngleDev})){if(t.idealGeometry[a]===3){var u=cj(e,t.unit,a,r.unit,i);if(u!==void 0&&u>n.maxDonOutOfPlaneAngle)return}var l=w_(e,r.unit,i,t.unit,a),c=lj.get(r.idealGeometry[i])||mj;if(!l.some(function(d){return c-d>n.maxAccAngleDev})){if(r.idealGeometry[i]===3){var u=cj(e,r.unit,i,t.unit,a);if(u!==void 0&&u>n.maxAccOutOfPlaneAngle)return}return!0}}}}function aHe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(tHe(i,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1],c=u.members[u.offsets[u.feature]],d=l.members[l.offsets[l.feature]],f=Fr(u.unit,c)==="S"||Fr(l.unit,d)==="S"?a.maxSulfurDistSq:a.maxDistSq;if(!(n>f)&&!(!a.includeWater&&eHe(u.unit,c,l.unit,d))&&MJ(e,u,l,a))return 4}}function iHe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(rHe(i,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1];if(MJ(e,u,l,a))return 8}}var oHe=Tn.Provider([4],XVe),sHe=Tn.Provider([9],YVe),uHe=Tn.Provider([5],QVe),lHe={name:"hydrogen-bonds",params:WVe,createTester:function(e){var t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=nHe(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:function(n,a,i,o){return aHe(n,a,i,o,r)}}}},cHe={name:"weak-hydrogen-bonds",params:$Ve,createTester:function(e){var t=IJ(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:function(r,n,a,i){return iHe(r,n,a,i,t)}}}};function dHe(e,t,r){return Fr(t,r)==="S"&&eo(e,t,r,"O")===3}function fHe(e,t,r){return Fr(t,r)==="S"&&eo(e,t,r,"O")===4}function gj(e,t,r){return Fr(t,r)==="P"&&eo(e,t,r,"O")===Jc(e,t,r)}function hHe(e,t,r){var n=0;return Fr(t,r)==="C"&&eo(e,t,r,"O")===2&&eo(e,t,r,"C")===1&&Xs(e,t,r,function(a,i){Fr(a,i)==="O"&&Jc(e,a,i)-eo(e,a,i,"H")===1&&(n+=1)}),n===2}function pHe(e,t,r){var n=0;return Fr(t,r)==="C"&&Jc(e,t,r)===3&&eo(e,t,r,"N")===3&&Xs(e,t,r,function(a,i){Jc(e,a,i)-eo(e,a,i,"H")===1&&(n+=1)}),n===2}function vHe(e,t,r){var n=0;return Fr(t,r)==="C"&&Jc(e,t,r)===3&&eo(e,t,r,"N")===2&&eo(e,t,r,"C")===1&&Xs(e,t,r,function(a,i){Jc(e,a,i)-eo(e,a,i,"H")===1&&(n+=1)}),n===2}var mHe={distanceMax:T.Numeric(5,{min:0,max:8,step:.1})},gHe={distanceMax:T.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:T.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:T.Numeric(30,{min:0,max:180,step:1})},yHe={distanceMax:T.Numeric(6,{min:1,max:8,step:.1}),offsetMax:T.Numeric(2,{min:0,max:4,step:.1})},bHe=["ARG","HIS","LYS"],xHe=["GLU","ASP"];function DJ(e,t){var r=jb.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function SHe(e,t,r){for(var n=DJ(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=ar.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),h=f.index,v=f.start,p=f.end,g=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[h]);if(bHe.includes(g)){r.startState();for(var m=v;m<p;++m)Fr(t,m)==="N"&&!$c.has(sb(t,m))&&r.pushMember(o[a[m]],s[a[m]],u[a[m]],m);r.finishState(1,0)}else if(!Rb.has(g)){l.clear();for(var m=v;m<p;++m){var y=0;pHe(e,t,m)?y=8:vHe(e,t,m)&&(y=9),y&&(r.startState(),Xs(e,t,m,function(S,x){Fr(t,x)==="N"&&(l.add(x),r.pushMember(o[a[x]],s[a[x]],u[a[x]],x))}),r.finishState(1,y))}for(var m=v;m<p;++m)n[m]>0&&!l.has(m)&&r.add(1,0,o[a[m]],s[a[m]],u[a[m]],m)}}}function CHe(e,t,r){for(var n=DJ(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=ar.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),h=f.index,v=f.start,p=f.end,g=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[h]);if(xHe.includes(g)){r.startState();for(var m=v;m<p;++m)Fr(t,m)==="O"&&!$c.has(sb(t,m))&&r.pushMember(o[a[m]],s[a[m]],u[a[m]],m);r.finishState(2,0)}else if(C3.has(g))for(var m=v;m<p;++m)gj(e,t,m)&&(r.startState(),Xs(e,t,m,function(S,x){Fr(t,x)==="O"&&r.pushMember(o[a[x]],s[a[x]],u[a[x]],x)}),r.finishState(2,6));else if(!Rb.has(g)){for(var m=v;m<p;++m){r.startState(),Fr(t,m)==="N"&&!$c.has(sb(t,m))&&r.pushMember(o[a[m]],s[a[m]],u[a[m]],m),r.finishState(2,0);var y=0;dHe(e,t,m)?y=4:gj(e,t,m)?y=6:fHe(e,t,m)?y=5:hHe(e,t,m)&&(y=10),y&&(r.startState(),Xs(e,t,m,function(S,x){Fr(t,x)==="O"&&(l.add(x),r.pushMember(o[a[x]],s[a[x]],u[a[x]],x))}),r.finishState(2,y))}for(var m=v;m<p;++m)n[m]<0&&!l.has(m)&&r.add(2,0,o[a[m]],s[a[m]],u[a[m]],m)}}}function _He(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=t.rings.aromaticRings;u<l.length;u++){var c=l[u],d=t.rings.all[c];r.startState();for(var f=0,h=d.length;f<h;++f){var v=d[f];r.pushMember(i[n[v]],o[n[v]],s[n[v]],v)}r.finishState(3,0)}}function wHe(e,t){return e===2&&t===1||e===1&&t===2}function EHe(e,t){return e===3&&t===3}function AHe(e,t){return e===3&&t===1||e===1&&t===3}var yj=_(),bj=_();function PHe(e,t,r){for(var n=e.feature,a=e.offsets,i=e.members,o=t.feature,s=t.offsets,u=t.members,l=a[n],c=a[n+1];l<c;++l){var d=i[l];e.unit.conformation.position(e.unit.elements[d],yj);for(var f=s[o],h=s[o+1];f<h;++f){var v=u[f];if(t.unit.conformation.position(t.unit.elements[v],bj),_.squaredDistance(yj,bj)<r)return!0}}return!1}var E_=_(),Dm=_(),A_=_(),cx=_();function AD(e,t){var r=t.unit,n=t.feature,a=t.offsets,i=t.members,o=r.elements,s=a[n];return t.unit.conformation.position(o[i[s]],E_),t.unit.conformation.position(o[i[s+1]],Dm),t.unit.conformation.position(o[i[s+2]],A_),_.triangleNormal(e,E_,Dm,A_)}var PD=function(e,t,r){return Tn.position(E_,e),Tn.position(Dm,t),_.sub(A_,E_,Dm),_.projectOnPlane(cx,A_,r),_.add(cx,cx,Dm),_.distance(cx,Dm)};function THe(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function IHe(e){return{offsetMax:e.offsetMax,angleDevMax:Xr(e.angleDevMax)}}function MHe(e){return{offsetMax:e.offsetMax}}var DHe=Xr(180),xj=Xr(90),r1=_(),iT=_();function RHe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(wHe(i,o)&&PHe(t,r,a.distanceMaxSq))return 1}function kHe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(EHe(i,o)){AD(r1,t),AD(iT,r);var s=_.angle(r1,iT),u=Math.min(PD(t,r,iT),PD(r,t,r1));if(u<=a.offsetMax){if(s<=a.angleDevMax||s>=DHe-a.angleDevMax)return 3;if(s<=a.angleDevMax+xj&&s>=xj-a.angleDevMax)return 3}}}function OHe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(AHe(i,o)){var s=i===3?[t,r]:[r,t],u=s[0],l=s[1];AD(r1,u);var c=PD(l,u,r1);if(c<=a.offsetMax)return 2}}var LHe=Tn.Provider([2],CHe),NHe=Tn.Provider([1],SHe),FHe=Tn.Provider([3],_He),BHe={name:"ionic",params:mHe,createTester:function(e){var t=THe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:function(r,n,a,i){return RHe(r,n,a,i,t)}}}},UHe={name:"pi-stacking",params:gHe,createTester:function(e){var t=IHe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:function(r,n,a,i){return kHe(r,n,a,i,t)}}}},jHe={name:"cation-pi",params:yHe,createTester:function(e){var t=MHe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:function(r,n,a,i){return OHe(r,n,a,i,t)}}}},zHe={distanceMax:T.Numeric(4,{min:1,max:5,step:.1})};function VHe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var h=Fr(t,d),v=!1;h==="C"?(v=!0,Xs(e,t,d,function(p,g){var m=Fr(p,g);m!=="C"&&m!=="H"&&(v=!1)})):h==="F"&&(v=!0),v&&r.add(8,0,i[n[d]],o[n[d]],s[n[d]],d)},l=0,c=n.length;l<c;++l)u(l)}function HHe(e,t){return e===8&&t===8}function GHe(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(HHe(a,i)){var o=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];if(!(Fr(t.unit,o)==="F"&&Fr(r.unit,s)==="F"))return 6}}var qHe=Tn.Provider([8],VHe),WHe={name:"hydrophobic",params:zHe,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:function(t,r,n,a){return GHe(t,r,n)}}}},$He={distanceMax:T.Numeric(3,{min:1,max:5,step:.1})},XHe=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function YHe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Fr(t,u),d=0;XHe.includes(c)?d=13:(rJ(c)||c==="ZN"||c==="CD")&&(d=12),d&&r.add(d,0,i[n[u]],o[n[u]],s[n[u]],u)}}function Sj(e){return!$c.has(e)}function KHe(e){return $c.has(e)}function QHe(e){return g3.has(e)}function ZHe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Fr(t,u),d=xO(t,u),f=sb(t,u),h=!1,v=!1,p=b3.has(d),g=C3.has(d);!p&&!g?$je(c)||c==="O"||c==="S"?(h=!0,v=!0):c==="N"&&(h=!0):p?c==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(d)&&Sj(f)||KHe(f))&&(h=!0,v=!0):c==="S"&&(d==="CYS"||d==="MET")?(h=!0,v=!0):c==="N"&&d==="HIS"&&Sj(f)&&(h=!0):g&&(c==="O"&&QHe(f)?(h=!0,v=!0):["N3","N4","N7"].includes(f)?h=!0:["O2","O4","O6"].includes(f)&&(h=!0,v=!0)),h&&r.add(11,0,i[n[u]],o[n[u]],s[n[u]],u),v&&r.add(10,0,i[n[u]],o[n[u]],s[n[u]],u)}}function Cj(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function JHe(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!(!Cj(a,i)&&!Cj(i,a)))return 7}var eGe=Tn.Provider([13,12],YHe),tGe=Tn.Provider([10,11],ZHe),rGe={name:"metal-coordination",params:$He,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:function(t,r,n,a){return JHe(t,r,n)}}}};function nGe(e,t){for(var r=t.contacts,n=t.unitsContacts,a=t.unitsFeatures,i=[aGe(e,t),iGe(e,t),oGe(e,t),sGe(e,t),uGe(e,t)],o=0,s=r.edgeCount;o<s;++o){var u=r.edges[o],l=e.unitMap.get(u.unitA),c=e.unitMap.get(u.unitB),d=Tn.Info(e,l,a.get(u.unitA));d.feature=u.indexA;var f=Tn.Info(e,c,a.get(u.unitB));f.feature=u.indexB;for(var h=0,v=i;h<v.length;h++){var p=v[h];p.isApplicable(u.props.type)&&p.handleInterContact(o,d,f)}}for(var g=n.keys();;){var m=g.next(),y=m.done,b=m.value;if(y)break;var S=n.get(b),x=a.get(b),C=e.unitMap.get(b);if(We.isAtomic(C)){for(var d=Tn.Info(e,C,x),f=Tn.Info(e,C,x),w=0,A=i;w<A.length;w++){var p=A[w];p.startUnit(C,S,x)}for(var o=0,s=S.edgeCount*2;o<s;++o){d.feature=S.a[o],f.feature=S.b[o];for(var I=0,D=i;I<D.length;I++){var p=D[I];p.isApplicable(S.edgeProps.type[o])&&p.handleIntraContact(o,d,f)}}}}}function aGe(e,t){var r=t.contacts,n=function(l,c,d,f,h){var v=f.get(d)||[1/0,-1],p=v[0],g=v[1];l<p?(g!==-1&&h(g),f.set(d,[l,c])):h(c)};function a(l,c,d,f,h){var v=c.members[c.offsets[c.feature]],p=d.members[d.offsets[d.feature]],g=c.unit.getResidueIndex(v),m=d.unit.getResidueIndex(p),y=v+"|"+c.unit.id+"|"+m+"|"+d.unit.id+"|A",b=p+"|"+d.unit.id+"|"+g+"|"+c.unit.id+"|B",S=Tn.distance(c,d);n(S,l,y,f,h),n(S,l,b,f,h)}var i=new Map,o=function(l){return r.edges[l].props.flag=1},s,u;return{isApplicable:function(l){return l===6},handleInterContact:function(l,c,d){a(l,c,d,i,o)},startUnit:function(l,c,d){s=new Map,u=function(f){return c.edgeProps.flag[f]=1}},handleIntraContact:function(l,c,d){a(l,c,d,s,u)}}}function iGe(e,t){var r=t.contacts,n=function(a,i){for(var o=a.types[a.feature]===9?i:a,s=o.members[o.offsets[o.feature]],u=t.unitsContacts.get(o.unit.id),l=u.edgeProps.type,c=u.elementsIndex,d=c.offsets,f=c.indices,h=d[s],v=d[s+1];h<v;++h)if(l[f[h]]===4)return!0;for(var p=r.getEdgeIndices(o.feature,o.unit.id),h=0,v=p.length;h<v;++h)if(r.edges[p[h]].props.type===4)return!0;return!1};return{isApplicable:function(a){return a===8},handleInterContact:function(a,i,o){n(i,o)&&(r.edges[a].props.flag=1)},startUnit:function(){},handleIntraContact:function(a,i,o){if(n(i,o)){var s=t.unitsContacts.get(i.unit.id).edgeProps.flag;s[a]=1}}}}function CO(e,t,r,n,a){for(var i=r.offsets,o=r.feature,s=n.offsets,u=n.feature,l=i[o],c=i[o+1];l<c;++l)for(var d=r.members[l],f=a.getContactIndicesForElement(d,r.unit),h=0,v=f.length;h<v;++h){var p=f[h];if(e.includes(a.edges[p].props.type))for(var g=s[u],m=s[u+1];g<m;++g){var y=n.members[g];if(a.getContactIndicesForElement(y,n.unit).includes(p)){a.edges[t].props.flag=1;return}}}}function _O(e,t,r,n,a){for(var i=a.edgeProps,o=i.type,s=i.flag,u=a.elementsIndex,l=u.offsets,c=u.indices,d=r.offsets,f=r.feature,h=n.offsets,v=n.feature,p=d[f],g=d[f+1];p<g;++p)for(var m=r.members[p],y=l[m],b=l[m+1];y<b;++y){var S=c[y];if(e.includes(o[S])){for(var x=h[v],C=h[v+1];x<C;++x)for(var w=n.members[x],A=l[w],I=l[w+1];A<I;++A)if(S===c[A]){s[t]=1;return}}}}function oGe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,a,i){CO([4,8],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){_O([4,8],n,a,i,t.unitsContacts.get(a.unit.id))}}}function sGe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===6||n===2},handleInterContact:function(n,a,i){CO([3],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){_O([3],n,a,i,t.unitsContacts.get(a.unit.id))}}}function uGe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,a,i){CO([7],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){_O([7],n,a,i,t.unitsContacts.get(a.unit.id))}}}var ed;(function(e){function t(c,d,f,h,v,p){return bY("interactions",{structure:d,interactions:c},{unitA:f,indexA:h,unitB:v,indexB:p})}e.Location=t;function r(c){return!!c&&c.kind==="data-location"&&c.tag==="interactions"}e.isLocation=r;function n(c,d){return c.data.structure===d.data.structure&&c.data.interactions===d.data.interactions&&c.element.indexA===d.element.indexA&&c.element.indexB===d.element.indexB&&c.element.unitA===d.element.unitA&&c.element.unitB===d.element.unitB}e.areLocationsEqual=n;function a(c,d){var f=d.unitA,h=d.indexA,v=d.unitB,p=d.indexB,g=c.contacts,m=c.unitsContacts;if(f===v){var y=m.get(f.id),b=y.getDirectedEdgeIndex(h,p);return dj(y.edgeProps.type[b])}else{var b=g.getEdgeIndex(h,f.id,p,v.id);return dj(g.edges[b].props.type)}}function i(c){return a(c.data.interactions,c.element)}e.locationLabel=i;function o(c,d,f){return F3("interactions",{structure:c,interactions:d},f,function(h){return u(d,f,h)},function(){return l(c,d,f)})}e.Loci=o;function s(c){return!!c&&c.kind==="data-loci"&&c.tag==="interactions"}e.isLoci=s;function u(c,d,f){var h=c.unitsFeatures;return Yc.fromPairProvider(d.length,function(v,p,g){var m=d[v];Tn.setPosition(p,m.unitA,m.indexA,h.get(m.unitA.id)),Tn.setPosition(g,m.unitB,m.indexB,h.get(m.unitB.id))},f)}e.getBoundingSphere=u;function l(c,d,f){var h=f[0];if(h===void 0)return"";var v=h.unitA,p=h.indexA,g=h.unitB,m=h.indexB,y=d.unitsFeatures,b=y.get(v.id),S=b.members,x=b.offsets,C=y.get(g.id),w=C.members,A=C.offsets,I={granularity:"element"};return(x[p+1]-x[p]>1||A[m+1]-A[m]>1)&&(I.granularity="residue"),[a(d,h),lO(Gt.Location(c,v,S[x[p]],c,g,w[A[m]]),I)].join("</br>")}e.getLabel=l})(ed||(ed={}));var lGe=[oHe,sHe,uHe,LHe,NHe,FHe,HVe,GVe,qHe,eGe,tGe],P_={ionic:BHe,"pi-stacking":UHe,"cation-pi":jHe,"halogen-bonds":qVe,"hydrogen-bonds":lHe,"weak-hydrogen-bonds":cHe,hydrophobic:WHe,"metal-coordination":rGe};function cGe(e){e===void 0&&(e=[]);var t=Object.create(null);return Object.keys(P_).forEach(function(r){t[r]=T.MappedStatic(e.includes(r)?"on":"off",{on:T.Group(P_[r].params),off:T.Group({})},{cycle:!0})}),t}var dGe=cGe(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),RJ={providers:T.Group(dGe,{isFlat:!0}),contacts:T.Group(EVe,{label:"Advanced Options"})};function fGe(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v,p,g,m,y;return fe(this,function(b){switch(b.label){case 0:return n=E(E({},T.getDefaultValues(RJ)),r),[4,jb.attach(e,t)];case 1:b.sent(),a=[],N3(P_).forEach(function(S){var x=n.providers[S],C=x.name,w=x.params;C==="on"&&a.push(P_[S].createTester(w))}),i=new Set,a.forEach(function(S){return fa.add(i,S.requiredFeatures)}),o=lGe.filter(function(S){return fa.areIntersecting(i,S.types)}),s=Gs.Mutable(),u=Gs.Mutable(),l=0,c=t.unitSymmetryGroups.length,b.label=2;case 2:return l<c?(d=t.unitSymmetryGroups[l],e.runtime.shouldUpdate?[4,e.runtime.update({message:"computing interactions",current:l,max:c})]:[3,4]):[3,6];case 3:b.sent(),b.label=4;case 4:for(f=hGe(t,d.units[0],o),h=pGe(t,d.units[0],f,a,n.contacts),v=0,p=d.units.length;v<p;++v)g=d.units[v],s.set(g.id,f),u.set(g.id,h);b.label=5;case 5:return++l,[3,2];case 6:return m=vGe(t,s,a,n.contacts),y={unitsFeatures:s,unitsContacts:u,contacts:m},nGe(t,y),[2,y]}})})}function hGe(e,t,r){var n=t.elements.length,a=CD.create(n,n/2);if(We.isAtomic(t))for(var i=0,o=r;i<o.length;i++){var s=o[i];s.add(e,t,a)}return a.getFeatures(n)}function pGe(e,t,r,n,a){var i=wD.create(r,t.elements.length);return We.isAtomic(t)&&TVe(e,t,r,i,n,a),i.getContacts()}function vGe(e,t,r,n){var a=ED.create();return tt.eachUnitPair(e,function(i,o){var s=t.get(i.id),u=t.get(o.id);DVe(e,i,s,o,u,a,r,n)},{maxRadius:Math.max.apply(Math,r.map(function(i){return i.maxDistance})),validUnit:function(i){return We.isAtomic(i)},validUnitPair:function(i,o){return tt.validUnitPair(e,i,o)}}),a.getContacts(t)}var oT=E({},RJ),Wn=th.createProvider({label:"Interactions",descriptor:Po({name:"molstar_computed_interactions"}),type:"local",defaultParams:oT,getParams:function(e){return oT},isApplicable:function(e){return!e.isCoarseGrained},obtain:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return n=E(E({},T.getDefaultValues(oT)),r),a={},[4,fGe(e,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),dx=_(),fx=_(),Rh=_(),sT=Je.add,_j=Je.add3,T_;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Je.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=Je.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=Je.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=Je.create(Float32Array,1,n,a?a.scaleBuffer.ref.value:r),l=Je.create(Float32Array,1,n,a?a.capBuffer.ref.value:r),c=function(f,h,v,p,g,m,y,b,S,x){for(var C=0;C<6;++C)_j(o,f,h,v),_j(s,p,g,m),sT(i,x),sT(u,y),sT(l,(b?1:0)+(S?2:0))},d=function(f,h,v,p,g,m,y){var b=_.distance(f,h),S=Math.floor(v/2),x=1/v;_.sub(Rh,h,f);for(var C=0;C<S;++C){var w=x*(C*2+1);_.setMagnitude(Rh,Rh,b*w),_.add(dx,f,Rh),_.setMagnitude(Rh,Rh,b*x*((C+1)*2)),_.add(fx,f,Rh),c(dx[0],dx[1],dx[2],fx[0],fx[1],fx[2],p,g,m,y)}};return{add:c,addFixedCountDashes:d,addFixedLengthDashes:function(f,h,v,p,g,m,y){var b=_.distance(f,h);d(f,h,b/v,p,g,m,y)},getCylinders:function(){var f=i.elementCount/6,h=Je.compact(i,!0),v=Je.compact(o,!0),p=Je.compact(s,!0),g=Je.compact(u,!0),m=Je.compact(l,!0),y=a&&f<=a.cylinderCount?a.mappingBuffer.ref.value:new Float32Array(f*18),b=a&&f<=a.cylinderCount?a.indexBuffer.ref.value:new Uint32Array(f*12);return(!a||f>a.cylinderCount)&&mGe(f,y,b),Ko.create(y,b,h,v,p,g,m,f,a)}}}e.create=t})(T_||(T_={}));function mGe(e,t,r){for(var n=0;n<e;++n){var a=n*18;t[a]=-1,t[a+1]=1,t[a+2]=-1,t[a+3]=-1,t[a+4]=-1,t[a+5]=-1,t[a+6]=1,t[a+7]=1,t[a+8]=-1,t[a+9]=1,t[a+10]=1,t[a+11]=1,t[a+12]=1,t[a+13]=-1,t[a+14]=-1,t[a+15]=1,t[a+16]=-1,t[a+17]=1}for(var n=0;n<e;++n){var i=n*6,o=n*12;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+4,r[o+5]=i+2,r[o+6]=i+2,r[o+7]=i+4,r[o+8]=i+3,r[o+9]=i+4,r[o+10]=i+5,r[o+11]=i+3}}var Cv={linkScale:T.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:T.Numeric(1,{min:0,max:2,step:.01}),linkCap:T.Boolean(!1),dashCount:T.Numeric(4,{min:2,max:10,step:2}),dashScale:T.Numeric(.8,{min:0,max:2,step:.1}),dashCap:T.Boolean(!0),stubCap:T.Boolean(!0),radialSegments:T.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo)};T.getDefaultValues(Cv);var kJ={linkScale:T.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:T.Numeric(.1,{min:0,max:2,step:.01}),dashCount:T.Numeric(4,{min:2,max:10,step:2})};T.getDefaultValues(kJ);var Fn=_(),Fd=_(),ys=_(),gGe=_.create(0,1,0);function wO(e,t,r,n){_.normalize(Fd,_.sub(Fd,t,r)),n!==null?_.sub(ys,t,n):_.copy(ys,t),_.normalize(ys,ys);var a=_.dot(Fd,ys);return 1-Math.abs(a)<1e-5&&(_.set(ys,1,0,0),a=_.dot(Fd,ys),1-Math.abs(a)<1e-5&&(_.set(ys,0,1,0),a=_.dot(Fd,ys))),_.setMagnitude(Fd,Fd,a),_.sub(ys,ys,Fd),_.normalize(e,ys)}var xu=_.scale,Ho=_.add,Ma=_.sub,Oc=_.setMagnitude,yGe=_.dot;function _v(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!a)return Ft.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,h=r.radialSegments,v=r.linkCap,p=r.dashCount,g=r.dashScale,m=r.dashCap,y=r.stubCap,b=h*2*a*2,S=Et.createState(b,b/4,n),x=_(),C=_(),w=_(),A={radiusTop:1,radiusBottom:1,radialSegments:h,topCap:v,bottomCap:v},I=p+1,D=0,k=a;D<k;++D)if(!(l&&l(D))){o(x,C,D),Ma(Fn,C,x);var R=u(D),L=s?s(D):0,H=y&&(c?c(D):!1),B=yGe(Fn,gGe)>0?[H,v]:[v,H],j=B[0],Q=B[1];S.currentGroup=D;var G=4.5;if(L===0)A.radiusTop=A.radiusBottom=R,A.topCap=j,A.bottomCap=Q,Oi(S,x,C,.5,A);else if(L===1)A.radiusTop=A.radiusBottom=R*g,A.topCap=A.bottomCap=m,e1(S,x,C,.5,I,A);else if(L===2||L===3||L===5||L===6){var W=L===2?2:L===3?3:1.5,q=R*(d/(.5*W)),J=(R-q)*f;wO(w,x,C,i?i(D):null),A.topCap=j,A.bottomCap=Q,L===5||L===6?(A.radiusTop=A.radiusBottom=R,Oi(S,x,C,.5,A),A.radiusTop=A.radiusBottom=R*d,A.topCap=A.bottomCap=m,Oc(w,w,J*G),Ma(x,x,w),Ma(C,C,w),e1(S,x,C,.5,3,A),L===6&&(Oc(w,w,J*G*2),Ho(x,x,w),Ho(C,C,w),e1(S,x,C,.5,3,A))):(Oc(w,w,J),A.radiusTop=A.radiusBottom=q,W===3&&Oi(S,x,C,.5,A),XFe(S,x,C,.5,w,A))}else L===4&&(xu(Fn,Fn,.475),Ho(x,x,Fn),Ma(C,C,Fn),A.radiusTop=A.radiusBottom=R,A.topCap=j,A.bottomCap=Q,Oi(S,x,C,.5,A))}return Et.getMesh(S)}function OJ(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!a)return Ko.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,h=r.linkCap,v=r.dashCount,p=r.dashScale,g=r.dashCap,m=r.stubCap,y=a*2,b=T_.create(y,y/4,n),S=_(),x=_(),C=_(),w=_(),A=v%2===1?v:v+1,I=.5-.5/2/A,D=3,k=.5-.5/2/D,R=4.5,L=0,H=a;L<H;++L)if(!(l&&l(L))){o(S,x,L);var B=u(L),j=s?s(L):0,Q=m&&(c?c(L):!1);if(j===0)xu(C,Ho(C,S,x),.5),b.add(S[0],S[1],S[2],C[0],C[1],C[2],1,h,Q,L);else if(j===1)xu(Fn,Ma(Fn,x,S),I),Ma(x,x,Fn),b.addFixedCountDashes(S,x,A,p,g,g,L);else if(j===2||j===3||j===5||j===6){var G=j===2?2:j===3?3:1.5,W=d/(.5*G),q=(B-W*B)*f;xu(C,Ho(C,S,x),.5),wO(w,S,x,i?i(L):null),j===5||j===6?(b.add(S[0],S[1],S[2],C[0],C[1],C[2],1,h,Q,L),xu(Fn,Ma(Fn,x,S),k),Ma(x,x,Fn),Oc(w,w,q*R),Ma(S,S,w),Ma(x,x,w),b.addFixedCountDashes(S,x,D,d,g,g,L),j===6&&(Oc(w,w,q*R*2),Ho(S,S,w),Ho(x,x,w),b.addFixedCountDashes(S,x,D,d,g,g,L))):(Oc(w,w,q),G===3&&b.add(S[0],S[1],S[2],C[0],C[1],C[2],W,h,!1,L),b.add(S[0]+w[0],S[1]+w[1],S[2]+w[2],C[0]+w[0],C[1]+w[1],C[2]+w[2],W,h,Q,L),b.add(S[0]-w[0],S[1]-w[1],S[2]-w[2],C[0]-w[0],C[1]-w[1],C[2]-w[2],W,h,Q,L))}else j===4&&(xu(Fn,Ma(Fn,x,S),.475),Ho(S,S,Fn),Ma(x,x,Fn),b.add(S[0],S[1],S[2],x[0],x[1],x[2],1,h,Q,L))}return b.getCylinders()}function LJ(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.ignore;if(!a)return Cn.createEmpty(n);for(var l=r.linkScale,c=r.linkSpacing,d=r.dashCount,f=a*2,h=is.create(f,f/4,n),v=_(),p=_(),g=_(),m=_(),y=d%2===1?d:d+1,b=.5-.5/2/y,S=3,x=.5-.5/2/S,C=4.5,w=0,A=a;w<A;++w)if(!(u&&u(w))){o(v,p,w);var I=s?s(w):0;if(I===0)xu(g,Ho(g,v,p),.5),h.add(v[0],v[1],v[2],g[0],g[1],g[2],w);else if(I===1)xu(Fn,Ma(Fn,p,v),b),Ma(p,p,Fn),h.addFixedCountDashes(v,p,y,w);else if(I===2||I===3||I===5||I===6){var D=I===2?2:I===3?3:1.5,k=1*(l/(.5*D)),R=(1-k)*c;xu(g,Ho(g,v,p),.5),wO(m,v,p,i?i(w):null),I===5||I===6?(h.add(v[0],v[1],v[2],g[0],g[1],g[2],w),xu(Fn,Ma(Fn,p,v),x),Ma(p,p,Fn),Oc(m,m,R*C),Ma(v,v,m),Ma(p,p,m),h.addFixedCountDashes(v,p,S,w),I===6&&(Oc(m,m,R*C*2),Ho(v,v,m),Ho(p,p,m),h.addFixedCountDashes(v,p,S,w))):(Oc(m,m,R),D===3&&h.add(v[0],v[1],v[2],g[0],g[1],g[2],w),h.add(v[0]+m[0],v[1]+m[1],v[2]+m[2],g[0]+m[0],g[1]+m[1],g[2]+m[2],w),h.add(v[0]-m[0],v[1]-m[1],v[2]-m[2],g[0]-m[0],g[1]-m[1],g[2]-m[2],w))}else I===4&&(xu(Fn,Ma(Fn,p,v),.475),Ho(v,v,Fn),Ma(p,p,Fn),h.add(v[0],v[1],v[2],p[0],p[1],p[2],w))}return h.getLines()}function bGe(e,t,r,n,a,i){return de(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C,w,A;return fe(this,function(I){return We.isAtomic(t)?(o=r.child,s=o==null?void 0:o.unitMap.get(t.id),o&&!s?[2,Ft.createEmpty(i)]:(u=at.create(r,t),l=Wn.get(r).value,c=l.unitsFeatures.get(t.id),d=l.unitsContacts.get(t.id),f=c.x,h=c.y,v=c.z,p=c.members,g=c.offsets,m=d.edgeCount,y=d.a,b=d.b,S=d.edgeProps.flag,x=a.sizeFactor,m?(C={linkCount:m*2,position:function(D,k,R){_.set(D,f[y[R]],h[y[R]],v[y[R]]),_.set(k,f[b[R]],h[b[R]],v[b[R]])},style:function(D){return 1},radius:function(D){u.element=t.elements[p[g[y[D]]]];var k=n.size.size(u);u.element=t.elements[p[g[b[D]]]];var R=n.size.size(u);return Math.min(k,R)*x},ignore:function(D){return S[D]===1||!!s&&!it.has(s.elements,t.elements[p[g[y[D]]]])}},w=_v(e,C,a,i),A=je.expand(je(),(s??t).boundary.sphere,1*x),w.setBoundingSphere(A),[2,w]):[2,Ft.createEmpty(i)])):[2,Ft.createEmpty(i)]})})}var NJ=E(E(E({},Ci),Cv),{sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),dashCount:T.Numeric(6,{min:2,max:10,step:2}),dashScale:T.Numeric(.4,{min:0,max:2,step:.1}),includeParent:T.Boolean(!1)});function xGe(e){return oo({defaultProps:T.getDefaultValues(NJ),createGeometry:bGe,createLocationIterator:_Ge,getLoci:SGe,eachLocation:CGe,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=Wn.get(o.structure).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function SGe(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=o.unitMap.get(s.units[a].id),l=Wn.get(o).value,c=l.unitsContacts.get(u.id),d=c.a,f=c.b;return ed.Loci(o,l,[{unitA:u,indexA:d[i],unitB:u,indexB:f[i]},{unitA:u,indexA:f[i],unitB:u,indexB:d[i]}])}return Or}function CGe(e,t,r,n){var a=!1;if(ed.isLoci(e)){var i=t.structure,o=t.group;if(!tt.areEquivalent(e.data.structure,i))return!1;var s=Wn.get(i).value;if(e.data.interactions!==s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),c=l.edgeCount*2,d=0,f=e.elements;d<f.length;d++){var h=f[d];if(h.unitA===h.unitB){var v=o.unitIndexMap.get(h.unitA.id);if(v!==void 0){var p=l.getDirectedEdgeIndex(h.indexA,h.indexB);p!==-1&&r(Re.ofSingleton(v*c+p))&&(a=!0)}}}}else if(Oe.is(e)){var i=t.structure,o=t.group;if(!tt.areEquivalent(e.structure,i))return!1;var s=Wn.get(i).value;if(!s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),g=s.unitsFeatures.get(u.id),m=l.edgeCount*2,y=l.offset,b=g.elementsIndex,S=b.offsets,x=b.indices,C=function(H){var B=o.unitIndexMap.get(H.unit.id);if(B!==void 0||n&&Fe.size(H.indices)===1)return"continue";Fe.forEach(H.indices,function(j){for(var Q=S[j],G=S[j+1];Q<G;++Q)for(var W=x[Q],q=y[W],J=y[W+1];q<J;++q)r(Re.ofSingleton(B*m+q))&&(a=!0)})},w=0,A=e.elements;w<A.length;w++){var h=A[w];C(h)}}return a}function _Ge(e){var t=e.structure,r=e.group,n=r.units[0],a=Wn.get(t).value,i=a.unitsContacts.get(n.id),o=i.edgeCount*2,s=r.units.length,u=ed.Location(a,t),l=u.element,c=function(d,f){var h=r.units[f];return l.unitA=h,l.indexA=i.a[d],l.unitB=h,l.indexB=i.b[d],u};return bn(o,s,1,c)}function wGe(e,t,r,n,a){if(!t.hasAtomic)return Ft.createEmpty(a);var i=at.create(t),o=Wn.get(t).value,s=o.contacts,u=o.unitsFeatures,l=s.edgeCount,c=s.edges,d=n.sizeFactor;if(!l)return Ft.createEmpty(a);var f=t.child,h={linkCount:l,position:function(g,m,y){var b=c[y],S=b.unitA,x=b.indexA,C=b.unitB,w=b.indexB,A=u.get(S),I=u.get(C),D=t.unitMap.get(S),k=t.unitMap.get(C);_.set(g,A.x[x],A.y[x],A.z[x]),_.transformMat4(g,g,D.conformation.operator.matrix),_.set(m,I.x[w],I.y[w],I.z[w]),_.transformMat4(m,m,k.conformation.operator.matrix)},style:function(g){return 1},radius:function(g){var m=c[g],y=u.get(m.unitA);i.unit=t.unitMap.get(m.unitA),i.element=i.unit.elements[y.members[y.offsets[m.indexA]]];var b=r.size.size(i),S=u.get(m.unitB);i.unit=t.unitMap.get(m.unitB),i.element=i.unit.elements[S.members[S.offsets[m.indexB]]];var x=r.size.size(i);return Math.min(b,x)*d},ignore:function(g){if(c[g].props.flag===1)return!0;if(f){var m=c[g],y=f.unitMap.get(m.unitA);if(!y)return!0;var b=t.unitMap.get(m.unitA),S=u.get(m.unitA),x=b.elements[S.members[S.offsets[m.indexA]]];if(!it.has(y.elements,x))return!0}return!1}},v=_v(e,h,n,a),p=je.expand(je(),(f??t).boundary.sphere,1*d);return v.setBoundingSphere(p),v}var FJ=E(E(E({},Ub),Cv),{sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),dashCount:T.Numeric(6,{min:2,max:10,step:2}),dashScale:T.Numeric(.4,{min:0,max:2,step:.1}),includeParent:T.Boolean(!1)});function EGe(e){return xv({defaultProps:T.getDefaultValues(FJ),createGeometry:wGe,createLocationIterator:TGe,getLoci:AGe,eachLocation:PGe,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=Wn.get(o).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function AGe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=Wn.get(t).value,o=i.contacts.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return ed.Loci(t,i,[{unitA:s,indexA:o.indexA,unitB:u,indexB:o.indexB},{unitA:u,indexA:o.indexB,unitB:s,indexB:o.indexA}])}return Or}function PGe(e,t,r,n){var a,i=!1;if(ed.isLoci(e)){if(!tt.areEquivalent(e.data.structure,t))return!1;var o=Wn.get(t).value;if(e.data.interactions!==o)return!1;for(var s=o.contacts,u=0,l=e.elements;u<l.length;u++){var c=l[u],d=s.getEdgeIndex(c.indexA,c.unitA.id,c.indexB,c.unitB.id);d!==-1&&r(Re.ofSingleton(d))&&(i=!0)}}else if(Oe.is(e)){if(!tt.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;var f=(a=Wn.get(t).value)===null||a===void 0?void 0:a.contacts;if(!f)return!1;for(var h=function(m){var y=m.unit;if(!We.isAtomic(y)||n&&Fe.size(m.indices)===1)return"continue";Fe.forEach(m.indices,function(b){for(var S=0,x=f.getContactIndicesForElement(b,y);S<x.length;S++){var C=x[S];r(Re.ofSingleton(C))&&(i=!0)}})},v=0,p=e.elements;v<p.length;v++){var g=p[v];h(g)}}return i}function TGe(e){var t=Wn.get(e).value,r=t.contacts,n=r.edgeCount,a=1,i=ed.Location(t,e),o=i.element,s=function(u){var l=r.edges[u];return o.unitA=e.unitMap.get(l.unitA),o.indexA=l.indexA,o.unitB=e.unitMap.get(l.unitB),o.indexB=l.indexB,i};return bn(n,a,1,s,!0)}var BJ={"intra-unit":function(e,t){return na("Intra-unit interactions cylinder",e,t,xGe)},"inter-unit":function(e,t){return Du("Inter-unit interactions cylinder",e,t,EGe)}},UJ=E(E(E({},NJ),FJ),{unitKinds:Bb(["atomic"]),sizeFactor:T.Numeric(.2,{min:.01,max:1,step:.01}),visuals:T.MultiSelect(["intra-unit","inter-unit"],T.objectToOptions(BJ))});function IGe(e,t){return T.clone(UJ)}function MGe(e,t){return sr.createMulti("Interactions",e,t,Ba,BJ)}var I_={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:MGe,getParams:IGe,defaultValues:T.getDefaultValues(UJ),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&Wn.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return Wn.attach(e,t,void 0,!0)},detach:function(e){return Wn.ref(e,!1)}},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},TD=dt(13421772),DGe="Assigns colors according the interaction type of a link.",Ii={HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404},RGe=[["Hydrogen Bond",Ii.HydrogenBond],["Hydrophobic",Ii.Hydrophobic],["Halogen Bond",Ii.HalogenBond],["Ionic",Ii.Ionic],["Metal Coordination",Ii.MetalCoordination],["Cation Pi",Ii.CationPi],["Pi Stacking",Ii.PiStacking],["Weak HydrogenBond",Ii.WeakHydrogenBond]];function wj(e){switch(e){case 4:return Ii.HydrogenBond;case 6:return Ii.Hydrophobic;case 5:return Ii.HalogenBond;case 1:return Ii.Ionic;case 7:return Ii.MetalCoordination;case 2:return Ii.CationPi;case 3:return Ii.PiStacking;case 8:return Ii.WeakHydrogenBond;case 0:return TD}}var jJ={};function kGe(e){return jJ}function zJ(e,t){var r,n=e.structure?Wn.get(e.structure):void 0,a=n?cv(n.id,n.version):-1;return n&&n.value?r=function(i){if(ed.isLocation(i)){var o=i.data.interactions,s=o.unitsContacts,u=o.contacts,l=i.element,c=l.unitA,d=l.unitB,f=l.indexA,h=l.indexB;if(c===d){var v=s.get(c.id),p=v.getDirectedEdgeIndex(f,h);return wj(v.edgeProps.type[p])}else{var p=u.getEdgeIndex(f,c.id,h,d.id);return wj(u.edges[p].props.type)}}return TD}:r=function(){return TD},{factory:zJ,granularity:"group",color:r,props:t,contextHash:a,description:DGe,legend:vh(RGe)}}var ID={name:"interaction-type",label:"Interaction Type",category:"Miscellaneous",factory:zJ,getParams:kGe,defaultValues:T.getDefaultValues(jJ),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Wn.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Wn.ref(e.structure,!1)}}};function CS(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?LGe(e,t||tt.Empty,r):VJ(e,t||tt.Empty,r)}function OGe(e,t){var r=e.representation.structure.themes;return t?r.colorThemeRegistry.getApplicableTypes({structure:t}):r.colorThemeRegistry.types}function MD(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),l=s.colorThemeRegistry.get(n||u.defaultColorTheme.name),c=T.getDefaultValues(l.getParams({structure:t||tt.Empty}));return l.name===u.defaultColorTheme.name&&Object.assign(c,u.defaultColorTheme.props),{name:l.name,params:Object.assign(c,a)}}function Ej(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),l=s.sizeThemeRegistry.get(n||u.defaultSizeTheme.name),c=T.getDefaultValues(l.getParams({structure:t||tt.Empty}));return l.name===u.defaultSizeTheme.name&&Object.assign(c,u.defaultSizeTheme.props),{name:l.name,params:Object.assign(c,a)}}function LGe(e,t,r){var n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,a=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return VJ(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function VJ(e,t,r){r===void 0&&(r={});var n=e.representation.structure.themes,a={structure:t},i=r.type||e.representation.structure.registry.default.provider,o=T.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),l=T.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(l,i.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=T.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var h=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:h}}}var Dr;(function(e){var t=function(c){Be(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.Create({name:"Root",typeClass:"Root"}));e.Root=t;var r=function(c){Be(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.Create({name:"Category",typeClass:"Object"}));e.Category=r;var n=function(c){Be(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.CreateBehavior({name:"Behavior"}));e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=kt.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:T.Text("",{isHidden:!0})}})({apply:function(c){var d=c.params;return new r({},{label:d.label})}});var a=new Map;function i(c){return a.get(c.id)}e.getCategoryId=i;function o(c){var d=kt.CreateBuiltIn({name:c.name,display:c.display,from:[t],to:[n],params:c.params,apply:function(f,h){var v=f.params,p=c.label?c.label(v):{label:c.display.name,description:c.display.description};return new n(new c.ctor(h,v),p)},update:function(f){var h=this,v=f.b,p=f.newParams;return et.create("Update Behavior",function(){return de(h,void 0,void 0,function(){var g;return fe(this,function(m){switch(m.label){case 0:return v.data.update?[4,v.data.update(p)]:[2,vt.UpdateResult.Unchanged];case 1:return g=m.sent(),[2,g?vt.UpdateResult.Updated:vt.UpdateResult.Unchanged]}})})})},canAutoUpdate:c.canAutoUpdate});return a.set(d.id,c.category),d}e.create=o;function s(c,d){return function(){function f(h){this.ctx=h,this.sub=void 0}return f.prototype.register=function(){var h=this;this.sub=c.subscribe(this.ctx,function(v){return d(v,h.ctx)})},f.prototype.unregister=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},f}()}e.simpleCommandHandler=s;var u=function(){function c(d,f){this.ctx=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.ctx,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.track=function(d){this.subs.push(d)},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var h=f[d];h.unsubscribe()}this.subs=[]},c.prototype.update=function(d){return Cg(d,this.params)?!1:(this.params=d,!0)},c}();e.Handler=u;var l=function(){function c(d,f){this.plugin=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.plugin,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var h=f[d];h.unsubscribe()}this.subs=[]},c}();e.WithSubscribers=l})(Dr||(Dr={}));var zb=function(){function e(){this.subs=void 0}return e.prototype.subscribe=function(t,r){var n=this;typeof this.subs>"u"&&(this.subs=[]);var a=t.subscribe(r);return this.subs.push(a),{unsubscribe:function(){a&&n.subs&&yp(n.subs,a)&&(a.unsubscribe(),a=void 0)}}},Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=Wc.create())},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._ev&&this._ev.dispose(),this.subs){for(var t=0,r=this.subs;t<r.length;t++){var n=r[t];n.unsubscribe()}this.subs=void 0}},e}(),Ed=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n._state=r,n}return t.prototype.updateState=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a=this.state,i=s3e(a,r);return i!==a?(this._state=i,!0):!1},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(zb),DD="2.2.0",NGe=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__<"u"?__MOLSTAR_DEBUG_TIMESTAMP__:1627737258743),M_=function(e){Be(t,e);function t(r){var n=e.call(this,{current:void 0,entries:ia.List(),isPlaying:!1,nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs})||this;return n.plugin=r,n.entryMap=new Map,n.events={changed:n.ev()},n.timeoutHandle=void 0,n.next=function(){return de(n,void 0,void 0,function(){var a,i,o;return fe(this,function(s){switch(s.label){case 0:return this.timeoutHandle=void 0,a=this.getNextId(this.state.current,1),!a||a===this.state.current?(this.stop(),[2]):(i=this.setCurrent(a),[4,this.plugin.state.setSnapshot(i)]);case 1:return s.sent(),o=typeof i.durationInMs<"u"?i.durationInMs:this.state.nextSnapshotDelayInMs,this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o)),[2]}})})},n}return t.prototype.getIndex=function(r){return this.state.entries.indexOf(r)},t.prototype.getEntry=function(r){if(r)return this.entryMap.get(r)},t.prototype.remove=function(r){var n=this.entryMap.get(r);n&&(this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next())},t.prototype.add=function(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next()},t.prototype.replace=function(r,n){var a=this.getEntry(r);if(a){var i=this.getIndex(a),o=t.Entry(n,{name:a.name,description:a.description});this.entryMap.set(n.id,o),this.updateState({current:o.snapshot.id,entries:this.state.entries.set(i,o)}),this.events.changed.next()}},t.prototype.move=function(r,n){var a=this.state.entries.size;if(!(a<2)){var i=this.getEntry(r);if(i){var o=this.getIndex(i),s=(o+n)%a;s<0&&(s+=a);var u=this.state.entries.get(s),l=this.state.entries.asMutable();l.set(s,i),l.set(o,u),this.updateState({current:i.snapshot.id,entries:l.asImmutable()}),this.events.changed.next()}}},t.prototype.clear=function(){this.state.entries.size!==0&&(this.entryMap.clear(),this.updateState({current:void 0,entries:ia.List()}),this.events.changed.next())},t.prototype.setCurrent=function(r){var n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next()),n&&n.snapshot},t.prototype.getNextId=function(r,n){var a=this.state.entries.size;if(!r){if(a===0)return;var i=n===-1?a-1:0;return this.state.entries.get(i).snapshot.id}var o=this.getEntry(r);if(o){var s=this.getIndex(o);if(!(s<0))return s=(s+n)%a,s<0&&(s+=a),this.state.entries.get(s).snapshot.id}},t.prototype.setStateSnapshot=function(r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return fe(this,function(c){switch(c.label){case 0:for(r.version,this.clear(),n=ia.List().asMutable(),a=0,i=r.entries;a<i.length;a++)o=i[a],this.entryMap.set(o.snapshot.id,o),n.push(o);return s=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0,this.updateState({current:s,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs}),this.events.changed.next(),s?(u=this.getEntry(s),l=u&&u.snapshot,l?[4,this.plugin.state.setSnapshot(l)]:[2]):[2];case 1:return c.sent(),r.playback&&r.playback.isPlaying&&this.play(!0),[2,l]}})})},t.prototype.syncCurrent=function(r){var n=this.plugin.state.getSnapshot(r==null?void 0:r.params);this.state.entries.size===0||!this.state.current?this.add(t.Entry(n,{name:r==null?void 0:r.name,description:r==null?void 0:r.description})):this.replace(this.state.current,n)},t.prototype.getStateSnapshot=function(r){return this.syncCurrent(r),{timestamp:+new Date,version:DD,name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!!(r&&r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}},t.prototype.serialize=function(r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v,p,g,m;return fe(this,function(y){switch(y.label){case 0:return n=JSON.stringify(this.getStateSnapshot({params:r==null?void 0:r.params}),null,2),!(r!=null&&r.type)||r.type==="json"||r.type==="molj"?[2,new Blob([n],{type:"application/json;charset=utf-8"})]:[3,1];case 1:a=new Uint8Array(UC(n)),Am(a,0,n),i={"state.json":a},o=[],s=0,u=this.plugin.managers.asset.assets,y.label=2;case 2:return s<u.length?(l=u[s],c=l.asset,d=l.file,o.push([c.id,c]),f=i,h="assets/"+c.id,v=Uint8Array.bind,[4,d.arrayBuffer()]):[3,5];case 3:f[h]=new(v.apply(Uint8Array,[void 0,y.sent()])),y.label=4;case 4:return s++,[3,2];case 5:return o.length>0&&(p=JSON.stringify(o,null,2),g=new Uint8Array(UC(p)),Am(g,0,p),i["assets.json"]=g),[4,this.plugin.runTask(U3e(i))];case 6:return m=y.sent(),[2,new Blob([m],{type:"application/zip"})]}})})},t.prototype.open=function(r){return de(this,void 0,void 0,function(){var n,a,m,a,i,o,s,u,l,c,d,f,h,v,p,g,m,y;return fe(this,function(b){switch(b.label){case 0:return b.trys.push([0,8,,9]),n=r.name.toLowerCase(),n.endsWith("json")||n.endsWith("molj")?[4,this.plugin.runTask(Cf(r,"string"))]:[3,2];case 1:return a=b.sent(),m=JSON.parse(a),t.isStateSnapshot(m)?[2,this.setStateSnapshot(m)]:t.isStateSnapshot(m.data)?[2,this.setStateSnapshot(m.data)]:(this.plugin.state.setSnapshot(m),[3,7]);case 2:return[4,this.plugin.runTask(Cf(r,"zip"))];case 3:return a=b.sent(),i=Object.create(null),Uu(a,function(S,x){if(!(x==="state.json"||x==="assets.json")){var C=x.substring(x.indexOf("/")+1);i[C]=new File([S],C)}}),o=new File([a["state.json"]],"state.json"),[4,this.plugin.runTask(Cf(o,"string"))];case 4:return s=b.sent(),a["assets.json"]?(u=new File([a["assets.json"]],"assets.json"),d=(c=JSON).parse,[4,this.plugin.runTask(Cf(u,"string"))]):[3,6];case 5:for(l=d.apply(c,[b.sent()]),f=0,h=l;f<h.length;f++)v=h[f],p=v[0],g=v[1],this.plugin.managers.asset.set(g,i[p]);b.label=6;case 6:return m=JSON.parse(s),[2,this.setStateSnapshot(m)];case 7:return[3,9];case 8:return y=b.sent(),this.plugin.log.error("Reading state: "+y),[3,9];case 9:return[2]}})})},t.prototype.play=function(r){if(r===void 0&&(r=!1),this.updateState({isPlaying:!0}),r){var n=this.getEntry(this.state.current);if(!n){this.next();return}this.events.changed.next();var a=n.snapshot,i=typeof a.durationInMs<"u"?a.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,i)}else this.next()},t.prototype.stop=function(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next()},t.prototype.togglePlay=function(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()},t.DefaultNextSnapshotDelayInMs=1500,t}(Ed);(function(e){function t(n,a){return E({timestamp:+new Date,snapshot:n},a)}e.Entry=t;function r(n){var a=n;return!!a&&!!a.timestamp&&!!a.entries}e.isStateSnapshot=r})(M_||(M_={}));function FGe(e){return e.toISOString().replace(/T/," ").replace(/\..+/,"")}function BGe(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),a=e.getHours(),i=e.getMinutes(),o=e.getSeconds();return t+"-"+r+"-"+n+"-"+a+"-"+i+"-"+o}function UGe(e){var t=window.open(e,"_blank");t||(window.location.href=e)}function Aj(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function HJ(e,t){if(t===void 0&&(t="download"),!!e)if("download"in HTMLAnchorElement.prototype){var r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,Aj(r)):(r.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(r.href)},4e4),setTimeout(function(){return Aj(r)}))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{var n=window.navigator.userAgent,a=/Safari/i.test(n),i=/CriOS\/[\d]+/.test(n),o=function(l){UGe(i?l:l.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((a||i)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){return o(s.result)},s.readAsDataURL(e)}else o(e);else{var u=URL.createObjectURL(e);location.href=u,setTimeout(function(){return URL.revokeObjectURL(u)},4e4)}}}function Z3(e,t){return""+e+(e[e.length-1]==="/"||t[0]==="/"?"":"/")+t}function Sn(){var e=function(t,r){return t.commands.dispatch(e,r||{})};return e.subscribe=function(t,r){return t.commands.subscribe(e,r)},e.id=pn.create22(),e}var jGe=function(){function e(){this.subs=new Map,this.disposing=!1}return e.prototype.subscribe=function(t,r){var n=this,a=this.subs.get(t.id);return a||(a=[],this.subs.set(t.id,a)),a.push(r),{unsubscribe:function(){var i=n.subs.get(t.id);if(i){var o=i.indexOf(r);if(!(o<0)){for(var s=o+1;s<i.length;s++)i[s-1]=i[s];i.pop()}}}}},e.prototype.dispatch=function(t,r){var n=this;return new Promise(function(a,i){if(n.disposing){i("disposed");return}var o=n.subs.get(t.id);if(!o){a();return}n.resolve({cmd:t,params:r,resolve:a,reject:i})})},e.prototype.dispose=function(){this.subs.clear()},e.prototype.resolve=function(t){return de(this,void 0,void 0,function(){var r,n,a,i,o;return fe(this,function(s){switch(s.label){case 0:if(r=this.subs.get(t.cmd.id),!r)return t.resolve(),[2];s.label=1;case 1:s.trys.push([1,6,,7]),n=0,a=r,s.label=2;case 2:return n<a.length?(i=a[n],[4,i(t.params)]):[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return t.resolve(),[3,7];case 6:return o=s.sent(),t.reject(o),[3,7];case 7:return[2]}})})},e}(),wt={State:{SetCurrentObject:Sn(),ApplyAction:Sn(),Update:Sn(),RemoveObject:Sn(),ToggleExpanded:Sn(),ToggleVisibility:Sn(),Snapshots:{Add:Sn(),Replace:Sn(),Move:Sn(),Remove:Sn(),Apply:Sn(),Clear:Sn(),Upload:Sn(),Fetch:Sn(),DownloadToFile:Sn(),OpenFile:Sn(),OpenUrl:Sn()}},Interactivity:{Object:{Highlight:Sn()},Structure:{Highlight:Sn(),Select:Sn()},ClearHighlights:Sn()},Layout:{Update:Sn()},Toast:{Show:Sn(),Hide:Sn()},Camera:{Reset:Sn(),SetSnapshot:Sn(),Focus:Sn()},Canvas3D:{SetSettings:Sn(),ResetSettings:Sn()}};function zGe(e){GJ(e),qJ(e),WJ(e),$J(e),XJ(e),YJ(e),KJ(e),QJ(e),ZJ(e),JJ(e)}function GJ(e){e.state.events.object.created.subscribe(function(t){ge.isBehavior(t.obj)&&t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(function(t){ge.isBehavior(t.obj)&&t.obj.data.unregister()}),e.state.events.object.updated.subscribe(function(t){t.action==="recreate"&&(t.oldObj&&ge.isBehavior(t.oldObj)&&t.oldObj.data.unregister(),t.obj&&ge.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function qJ(e){wt.State.SetCurrentObject.subscribe(e,function(t){var r=t.state,n=t.ref;return r.setCurrent(n)})}function WJ(e){wt.State.Update.subscribe(e,function(t){var r=t.state,n=t.tree,a=t.options;return e.runTask(r.updateTree(n,a))})}function $J(e){wt.State.ApplyAction.subscribe(e,function(t){var r=t.state,n=t.action,a=t.ref;return e.runTask(r.applyAction(n.action,n.params,a))})}function XJ(e){function t(r,n){var a=r.build().delete(n);return e.runTask(r.updateTree(a))}wt.State.RemoveObject.subscribe(e,function(r){var n=r.state,a=r.ref,i=r.removeParentGhosts;if(i){var o=n.tree,s=o.transforms.get(a);if(s.parent===a)return t(n,a);for(;;){var u=o.children.get(s.parent);if(s.parent===s.ref||u.size>1)return t(n,s.ref);var l=o.transforms.get(s.parent);if(!l.state.isGhost)return t(n,s.ref);s=l}}else return t(n,a)})}function YJ(e){wt.State.ToggleExpanded.subscribe(e,function(t){var r=t.state,n=t.ref;return r.updateCellState(n,function(a){var i=a.isCollapsed;return{isCollapsed:!i}})})}function KJ(e){wt.State.ToggleVisibility.subscribe(e,function(t){var r=t.state,n=t.ref;return Jp(r,n,!r.cells.get(n).state.isHidden)})}function Jp(e,t,r){sa.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},VGe)}function VGe(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function QJ(e){wt.Interactivity.Object.Highlight.subscribe(e,function(t){var r=t.state,n=t.ref;if(!(!e.canvas3d||e.isBusy)){e.managers.interactivity.lociHighlights.clearHighlights();for(var a=typeof n=="string"?[n]:n,i=0,o=a;i<o.length;i++){var s=o[i],u=r.cells.get(s);if(u){if(ge.Molecule.Structure.is(u.obj))e.managers.interactivity.lociHighlights.highlight({loci:tt.Loci(u.obj.data)},!1);else if(u&&ge.isRepresentation3D(u.obj)){var l=u.obj.data.repr;e.managers.interactivity.lociHighlights.highlight({loci:l.getLoci(),repr:l},!1)}else if(ge.Molecule.Structure.Selections.is(u.obj))for(var c=0,d=u.obj.data;c<d.length;c++){var f=d[c];e.managers.interactivity.lociHighlights.highlight({loci:f.loci},!1)}}}}})}function ZJ(e){wt.Interactivity.ClearHighlights.subscribe(e,function(){e.managers.interactivity.lociHighlights.clearHighlights()})}function JJ(e){var t=this;e.config.set($r.State.CurrentServer,e.config.get($r.State.DefaultServer)),wt.State.Snapshots.Clear.subscribe(e,function(){e.managers.snapshot.clear()}),wt.State.Snapshots.Remove.subscribe(e,function(r){var n=r.id;e.managers.snapshot.remove(n)}),wt.State.Snapshots.Add.subscribe(e,function(r){var n=r.name,a=r.description,i=r.params,o=M_.Entry(e.state.getSnapshot(i),{name:n,description:a});e.managers.snapshot.add(o)}),wt.State.Snapshots.Replace.subscribe(e,function(r){var n=r.id,a=r.params;e.managers.snapshot.replace(n,e.state.getSnapshot(a))}),wt.State.Snapshots.Move.subscribe(e,function(r){var n=r.id,a=r.dir;e.managers.snapshot.move(n,a)}),wt.State.Snapshots.Apply.subscribe(e,function(r){var n=r.id,a=e.managers.snapshot.setCurrent(n);if(a)return e.state.setSnapshot(a)}),wt.State.Snapshots.Upload.subscribe(e,function(r){var n=r.name,a=r.description,i=r.playOnLoad,o=r.serverUrl;return r.params,fetch(Z3(o,"set?name="+encodeURIComponent(n||"")+"&description="+encodeURIComponent(a||"")),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e.managers.snapshot.getStateSnapshot({name:n,description:a,playOnLoad:i}))})}),wt.State.Snapshots.Fetch.subscribe(e,function(r){var n=r.url;return de(t,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"json"}))];case 1:return a=i.sent(),[4,e.managers.snapshot.setStateSnapshot(a.data)];case 2:return i.sent(),[2]}})})}),wt.State.Snapshots.DownloadToFile.subscribe(e,function(r){var n=r.name,a=r.type,i=r.params;return de(t,void 0,void 0,function(){var o,s;return fe(this,function(u){switch(u.label){case 0:return o="mol-star_state_"+(n||BGe())+"."+(a==="json"?"molj":"molx"),[4,e.managers.snapshot.serialize({type:a,params:i})];case 1:return s=u.sent(),HJ(s,""+o),[2]}})})}),wt.State.Snapshots.OpenFile.subscribe(e,function(r){var n=r.file;return e.managers.snapshot.open(n)}),wt.State.Snapshots.OpenUrl.subscribe(e,function(r){var n=r.url,a=r.type;return de(t,void 0,void 0,function(){var i;return fe(this,function(o){switch(o.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"binary"}))];case 1:return i=o.sent(),[2,e.managers.snapshot.open(new File([i],"state."+a))]}})})})}const HGe=Object.freeze(Object.defineProperty({__proto__:null,ApplyAction:$J,ClearHighlights:ZJ,Highlight:QJ,RemoveObject:XJ,SetCurrentObject:qJ,Snapshots:JJ,SyncBehaviors:GJ,ToggleExpanded:YJ,ToggleVisibility:KJ,Update:WJ,registerDefault:zGe,setSubtreeVisibility:Jp},Symbol.toStringTag,{value:"Module"}));function GGe(e){eee(e),tee(e),ree(e)}function eee(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;ge.isRepresentation3D(r.obj)&&(RD(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),(n=e.canvas3d)===null||n===void 0||n.add(r.obj.data.repr))}),t.object.updated.subscribe(function(r){var n,a;r.oldObj&&ge.isRepresentation3D(r.oldObj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),ge.isRepresentation3D(r.obj)&&(RD(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),(a=e.canvas3d)===null||a===void 0||a.add(r.obj.data.repr))}),t.object.removed.subscribe(function(r){var n;ge.isRepresentation3D(r.obj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function tee(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}}),t.object.updated.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}}),t.object.removed.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.initialState),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}})}function ree(e){e.state.data.events.cell.stateUpdated.subscribe(function(t){var r,n=t.state.cells.get(t.ref);ge.isRepresentation3D(n.obj)&&RD(n,n.obj.data.repr)&&((r=e.canvas3d)===null||r===void 0||r.syncVisibility())})}function RD(e,t){return t.state.visible===e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}const qGe=Object.freeze(Object.defineProperty({__proto__:null,SyncRepresentationToCanvas:eee,SyncStructureRepresentation3DState:tee,UpdateRepresentationVisibility:ree,registerDefault:GGe},Symbol.toStringTag,{value:"Module"}));function WGe(e){nee(e),iee(e),aee(e)}function nee(e){wt.Camera.Reset.subscribe(e,function(t){e.managers.camera.reset(t==null?void 0:t.snapshot,t==null?void 0:t.durationMs)})}function aee(e){wt.Camera.SetSnapshot.subscribe(e,function(t){var r=t.snapshot,n=t.durationMs;e.managers.camera.setSnapshot(r,n)})}function iee(e){wt.Camera.Focus.subscribe(e,function(t){var r=t.center,n=t.radius,a=t.durationMs;e.managers.camera.focusSphere({center:r,radius:n},{durationMs:a}),e.events.canvas3d.settingsUpdated.next()})}const $Ge=Object.freeze(Object.defineProperty({__proto__:null,Focus:iee,Reset:nee,SetSnapshot:aee,registerDefault:WGe},Symbol.toStringTag,{value:"Module"}));function lp(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function Rm(e){if(typeof e=="object"&&"button"in e){var t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function hx(e){return{alt:"altKey"in e?e.altKey:!1,shift:"shiftKey"in e?e.shiftKey:!1,control:"ctrlKey"in e?e.ctrlKey:!1,meta:"metaKey"in e?e.metaKey:!1}}var Pj={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,mask:function(e,t){return!0},pixelScale:1},Ru;(function(e){e.None=n();function t(a,i){return a.shift===i.shift&&a.alt===i.alt&&a.control===i.control&&a.meta===i.meta}e.areEqual=t;function r(a){if(!a)return 0;var i=0;return a.shift&&i++,a.alt&&i++,a.control&&i++,a.meta&&i++,i}e.size=r;function n(a){return a===void 0&&(a={}),{shift:!!a.shift,alt:!!a.alt,control:!!a.control,meta:!!a.meta}}e.create=n})(Ru||(Ru={}));var ev;(function(e){e.has=mi.has,e.create=mi.create})(ev||(ev={}));function Tj(){return{drag:new ta,interactionEnd:new ta,click:new ta,move:new ta,wheel:new ta,pinch:new ta,resize:new ta,leave:new ta,enter:new ta,modifiers:new ta,key:new ta}}var XGe=["Backspace","Delete"],kD;(function(e){function t(n){n===void 0&&(n={});var a=E(E({},Pj),n),i=a.noScroll,o=a.noContextMenu;return E(E({noScroll:i,noContextMenu:o,width:0,height:0,pixelRatio:1},Tj()),{dispose:cf})}e.create=t;function r(n,a){a===void 0&&(a={});var i=E(E({},Pj),a),o=i.noScroll,s=i.noMiddleClickScroll,u=i.noContextMenu,l=i.noPinchZoom,c=i.noTextSelect,d=i.mask,f=i.pixelScale,h=n.clientWidth*C(),v=n.clientHeight*C(),p=0,g=Ke(),m=Ke(),y=Ke(),b=Ke(),S=Ke(),x={shift:!1,alt:!1,control:!1,meta:!1};function C(){return window.devicePixelRatio*f}function w(){return E({},x)}var A=0,I=!1,D=ev.create(0),k=0,R=!1,L=Tj(),H=L.drag,B=L.interactionEnd,j=L.wheel,Q=L.pinch,G=L.click,W=L.move,q=L.leave,J=L.enter,he=L.resize,$=L.modifiers,X=L.key;return U(),E(E({get noScroll(){return o},set noScroll(ye){o=ye},get noContextMenu(){return u},set noContextMenu(ye){u=ye},get width(){return h},get height(){return v},get pixelRatio(){return C()}},L),{dispose:z});function U(){n.addEventListener("contextmenu",ee,!1),n.addEventListener("wheel",Ze,!1),n.addEventListener("mousedown",O,!1),window.addEventListener("mousemove",V,!1),window.addEventListener("mouseup",ve,!1),n.addEventListener("mouseenter",ht,!1),n.addEventListener("mouseleave",Ue,!1),n.addEventListener("touchstart",_e,!1),n.addEventListener("touchmove",ie,!1),n.addEventListener("touchend",ae,!1),window.addEventListener("blur",Z),window.addEventListener("keyup",ce,!1),window.addEventListener("keydown",te,!1),window.addEventListener("keypress",be,!1),window.addEventListener("resize",rt,!1)}function z(){I||(I=!0,n.removeEventListener("contextmenu",ee,!1),n.removeEventListener("wheel",Ze,!1),n.removeEventListener("mousedown",O,!1),window.removeEventListener("mousemove",V,!1),window.removeEventListener("mouseup",ve,!1),n.removeEventListener("mouseenter",ht,!1),n.removeEventListener("mouseleave",Ue,!1),n.removeEventListener("touchstart",_e,!1),n.removeEventListener("touchmove",ie,!1),n.removeEventListener("touchend",ae,!1),window.removeEventListener("blur",Z),window.removeEventListener("keyup",ce,!1),window.removeEventListener("keydown",te,!1),window.removeEventListener("keypress",be,!1),window.removeEventListener("resize",rt,!1))}function ee(ye){d(ye.clientX,ye.clientY)&&u&&ye.preventDefault()}function Y(ye){x.alt=ye.altKey,x.shift=ye.shiftKey,x.control=ye.ctrlKey,x.meta=ye.metaKey}function Z(){(D||x.shift||x.alt||x.meta||x.control)&&(D=0,x.shift=x.alt=x.control=x.meta=!1)}function te(ye){var Se=!1;!x.alt&&ye.altKey&&(Se=!0,x.alt=!0),!x.shift&&ye.shiftKey&&(Se=!0,x.shift=!0),!x.control&&ye.ctrlKey&&(Se=!0,x.control=!0),!x.meta&&ye.metaKey&&(Se=!0,x.meta=!0),Se&&R&&$.next(w())}function ce(ye){var Se=!1;x.alt&&!ye.altKey&&(Se=!0,x.alt=!1),x.shift&&!ye.shiftKey&&(Se=!0,x.shift=!1),x.control&&!ye.ctrlKey&&(Se=!0,x.control=!1),x.meta&&!ye.metaKey&&(Se=!0,x.meta=!1),Se&&R&&$.next(w()),XGe.includes(ye.key)&&be(ye)}function be(ye){X.next({key:ye.key,modifiers:w()})}function xe(ye){var Se=ye.touches[0],Le=ye.touches[1];return{clientX:(Se.clientX+Le.clientX)/2,clientY:(Se.clientY+Le.clientY)/2,pageX:(Se.pageX+Le.pageX)/2,pageY:(Se.pageY+Le.pageY)/2}}function Ie(ye){var Se=ye.touches[0].pageX-ye.touches[1].pageX,Le=ye.touches[0].pageY-ye.touches[1].pageY;return Math.sqrt(Se*Se+Le*Le)}function _e(ye){if(ye.touches.length===1)D=k=1,Me(ye.touches[0]);else if(ye.touches.length===2){D=0,k=2,Me(xe(ye));var Se=Ie(ye);p=Se,Q.next({distance:Se,fraction:1,delta:0,isStart:!0,buttons:D,button:k,modifiers:w()})}else ye.touches.length===3&&(D=k=8,Me(xe(ye)))}function ae(ye){Pe()}function ie(ye){if(k=0,l&&(ye.preventDefault(),ye.stopPropagation(),ye.originalEvent&&(ye.originalEvent.preventDefault(),ye.originalEvent.stopPropagation())),ye.touches.length===1)D=1,$e(ye.touches[0]);else if(ye.touches.length===2){var Se=Ie(ye),Le=p-Se;Math.abs(Le)<4?(D=2,$e(xe(ye))):(D=4,Y(ye),Q.next({delta:Le,fraction:p/Se,distance:Se,isStart:!1,buttons:D,button:k,modifiers:w()})),p=Se}else ye.touches.length===3&&(D=8,$e(xe(ye)))}function O(ye){Y(ye),D=lp(ye),k=Rm(ye),s&&D===4&&ye.preventDefault,Me(ye)}function V(ye){Y(ye),D=lp(ye),k=0,$e(ye)}function ve(ye){Y(ye),D=lp(ye),k=Rm(ye),Ge(ye),Pe()}function Pe(){B.next()}function Me(ye){d(ye.clientX,ye.clientY)&&(Te(m,ye),Ke.copy(g,m),ut(m)&&(A=1))}function Ge(ye){if(A=0,!!d(ye.clientX,ye.clientY)&&(Te(y,ye),Ke.distance(y,g)<4)){var Se=ye.pageX,Le=ye.pageY,Ve=y[0],nt=y[1];G.next({x:Ve,y:nt,pageX:Se,pageY:Le,buttons:D,button:k,modifiers:w()})}}function $e(ye){var Se;Te(y,ye);var Le=ye.pageX,Ve=ye.pageY,nt=y[0],Xe=y[1],He=ut(y);if(W.next({x:nt,y:Xe,pageX:Le,pageY:Ve,buttons:D,button:k,modifiers:w(),inside:He}),A!==0&&(c&&((Se=ye.preventDefault)===null||Se===void 0||Se.call(ye)),Ke.div(b,Ke.sub(b,y,m),Ee(S)),!(Ke.magnitude(b)<yn))){var se=A===1;if(!(se&&!d(ye.clientX,ye.clientY))){var pe=b[0],Ae=b[1];H.next({x:nt,y:Xe,dx:pe,dy:Ae,pageX:Le,pageY:Ve,buttons:D,button:k,modifiers:w(),isStart:se}),Ke.copy(m,y),A=2}}}function Ze(ye){if(d(ye.clientX,ye.clientY)){Te(y,ye);var Se=ye.pageX,Le=ye.pageY,Ve=y[0],nt=y[1];o&&ye.preventDefault();var Xe=1;switch(ye.deltaMode){case 0:Xe=1;break;case 1:Xe=40;break;case 2:Xe=800;break}var He=(ye.deltaX||0)*Xe,se=(ye.deltaY||0)*Xe,pe=(ye.deltaZ||0)*Xe;D=k=4,(He||se||pe)&&j.next({x:Ve,y:nt,pageX:Se,pageY:Le,dx:He,dy:se,dz:pe,buttons:D,button:k,modifiers:w()})}}function ht(ye){R=!0,J.next()}function Ue(ye){R=!1,q.next()}function rt(ye){he.next()}function ut(ye){if(n instanceof Window||n instanceof Document||n===document.body)return!0;var Se=n.getBoundingClientRect();return ye[0]>=0&&ye[1]>=0&&ye[0]<Se.width&&ye[1]<Se.height}function Ee(ye){return ye[0]=n.clientWidth,ye[1]=n.clientHeight,ye}function Te(ye,Se){h=n.clientWidth*C(),v=n.clientHeight*C();var Le=Se.clientX||0,Ve=Se.clientY||0,nt=n.getBoundingClientRect();return ye[0]=Le-nt.left,ye[1]=Ve-nt.top,ye}}e.fromElement=r})(kD||(kD={}));function $a(){return $a.zero()}(function(e){function t(){return{x:0,y:0,width:0,height:0}}e.zero=t;function r(u,l,c,d){return{x:u,y:l,width:c,height:d}}e.create=r;function n(u){return E({},u)}e.clone=n;function a(u,l){return Object.assign(u,l)}e.copy=a;function i(u,l,c,d,f){return u.x=l,u.y=c,u.width=d,u.height=f,u}e.set=i;function o(u,l){return u[0]=l.x,u[1]=l.y,u[2]=l.width,u[3]=l.height,u}e.toVec4=o;function s(u,l){return u.x===l.x&&u.y===l.y&&u.width===l.width&&u.height===l.height}e.equals=s})($a||($a={}));var Ij=0,Mj=1,rl=wr();function YGe(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height;wr.set(rl,t[0],t[1],t[2],1),wr.transformMat4(rl,rl,n);var u=rl[3];return u!==0&&(rl[0]/=u,rl[1]/=u,rl[2]/=u),e[0]=a+o/2*rl[0]+(0+o/2),e[1]=i+s/2*rl[1]+(0+s/2),e[2]=(Mj-Ij)/2*rl[2]+(Mj+Ij)/2,e[3]=u===0?0:1/u,e}function _S(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height,u=t[0]-a,l=s-t[1]-1-i,c=t[2];return e[0]=2*u/o-1,e[1]=2*l/s-1,e[2]=2*c-1,_.transformMat4(e,e,n)}var OD={backgroundColor:T.Color(dt(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:T.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:T.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:T.Boolean(!0,{label:"Use Interior Color"}),interiorColor:T.Color(dt.fromNormalizedRgb(.3,.3,.3)),highlightColor:T.Color(dt.fromNormalizedRgb(1,.4,.6)),selectColor:T.Color(dt.fromNormalizedRgb(.2,1,.1)),xrayEdgeFalloff:T.Numeric(1,{min:0,max:3,step:.1}),style:T.MappedStatic("matte",{custom:T.Group({lightIntensity:T.Numeric(.6,{min:0,max:1,step:.01}),ambientIntensity:T.Numeric(.4,{min:0,max:1,step:.01}),metalness:T.Numeric(0,{min:0,max:1,step:.01}),roughness:T.Numeric(1,{min:0,max:1,step:.01}),reflectivity:T.Numeric(.5,{min:0,max:1,step:.01})},{isExpanded:!0}),flat:T.Group({}),matte:T.Group({}),glossy:T.Group({}),metallic:T.Group({}),plastic:T.Group({})},{label:"Lighting",description:"Style in which the 3D scene is rendered/lighted"}),clip:T.Group({variant:T.Select("instance",T.arrayToOptions(["instance","pixel"])),objects:T.ObjectList({type:T.Select("plane",T.objectToOptions(an.Type,function(e){return Yo(e)})),invert:T.Boolean(!1),position:T.Vec3(_()),rotation:T.Group({axis:T.Vec3(_.create(1,0,0)),angle:T.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:T.Vec3(_.create(1,1,1))},function(e){return Yo(e.type)})})};function Dj(e){switch(e.name){case"custom":return e.params;case"flat":return{lightIntensity:0,ambientIntensity:1,metalness:0,roughness:.4,reflectivity:.5};case"matte":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:1,reflectivity:.5};case"glossy":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.4,reflectivity:.5};case"metallic":return{lightIntensity:.7,ambientIntensity:.7,metalness:.6,roughness:.6,reflectivity:.5};case"plastic":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.2,reflectivity:.5}}}var KGe=Gn();function Rj(e,t){for(var r=(t==null?void 0:t.objects)||{type:new Array(5).fill(1),invert:new Array(5).fill(!1),position:new Array(15).fill(0),rotation:new Array(20).fill(0),scale:new Array(15).fill(1)},n=r.type,a=r.invert,i=r.position,o=r.rotation,s=r.scale,u=0,l=e.objects.length;u<l;++u){var c=e.objects[u];n[u]=an.Type[c.type],a[u]=c.invert,_.toArray(c.position,i,u*3),Gn.toArray(Gn.setAxisAngle(KGe,c.rotation.axis,Xr(c.rotation.angle)),o,u*4),_.toArray(c.scale,s,u*3)}return{variant:e.variant,objects:{count:e.objects.length,type:n,invert:a,position:i,rotation:o,scale:s}}}var LD;(function(e){function t(r,n){n===void 0&&(n={});var a=r.gl,i=r.state,o=r.stats,s=r.extensions.fragDepth,u=T.merge(OD,T.getDefaultValues(OD),n),l=Dj(u.style),c=Rj(u.clip),d=$a(),f=Ke.create(a.drawingBufferWidth,a.drawingBufferHeight),h=dt.toVec3Normalized(_(),u.backgroundColor),v=!1,p=D3(a),g=[["tDepth",p]],m=le(),y=le(),b=le(),S=le(),x=le(),C=le(),w=le(),A=_(),I=Ke(),D={uModel:N.create(le.identity()),uView:N.create(m),uInvView:N.create(y),uModelView:N.create(b),uInvModelView:N.create(S),uInvProjection:N.create(x),uProjection:N.create(le()),uModelViewProjection:N.create(C),uInvModelViewProjection:N.create(w),uIsOrtho:N.create(1),uViewOffset:N.create(I),uPixelRatio:N.create(r.pixelRatio),uViewportHeight:N.create(d.height),uViewport:N.create($a.toVec4(wr(),d)),uDrawingBufferSize:N.create(f),uCameraPosition:N.create(_()),uCameraDir:N.create(A),uNear:N.create(1),uFar:N.create(1e4),uFogNear:N.create(1),uFogFar:N.create(1e4),uFogColor:N.create(h),uRenderWboit:N.create(!1),uTransparentBackground:N.create(!1),uClipObjectType:N.create(c.objects.type),uClipObjectInvert:N.create(c.objects.invert),uClipObjectPosition:N.create(c.objects.position),uClipObjectRotation:N.create(c.objects.rotation),uClipObjectScale:N.create(c.objects.scale),uLightIntensity:N.create(l.lightIntensity),uAmbientIntensity:N.create(l.ambientIntensity),uMetalness:N.create(l.metalness),uRoughness:N.create(l.roughness),uReflectivity:N.create(l.reflectivity),uPickingAlphaThreshold:N.create(u.pickingAlphaThreshold),uInteriorDarkening:N.create(u.interiorDarkening),uInteriorColorFlag:N.create(u.interiorColorFlag),uInteriorColor:N.create(dt.toVec3Normalized(_(),u.interiorColor)),uHighlightColor:N.create(dt.toVec3Normalized(_(),u.highlightColor)),uSelectColor:N.create(dt.toVec3Normalized(_(),u.selectColor)),uXrayEdgeFalloff:N.create(u.xrayEdgeFalloff)},k=Object.entries(D),R=!0,L=function(U,z){if(!(U.state.disposed||!U.state.visible||!U.state.pickable&&z[0]==="p")){var ee=!1;U.state.noClip?U.values.dClipObjectCount.ref.value!==0&&(N.update(U.values.dClipObjectCount,0),ee=!0):(U.values.dClipObjectCount.ref.value!==c.objects.count&&(N.update(U.values.dClipObjectCount,c.objects.count),ee=!0),U.values.dClipVariant.ref.value!==c.variant&&(N.update(U.values.dClipVariant,c.variant),ee=!0)),ee&&U.update();var Y=U.getProgram(z);i.currentProgramId!==Y.id&&(R=!0,Y.use()),R&&(Y.setUniforms(k),R=!1),U.values.dRenderMode?(i.disable(a.CULL_FACE),i.frontFace(a.CCW),z==="colorBlended"&&(U.values.dRenderMode.ref.value==="volume"||!s?(i.disable(a.DEPTH_TEST),i.depthMask(!1)):(i.enable(a.DEPTH_TEST),i.depthMask(U.values.uAlpha.ref.value===1)))):(U.values.dDoubleSided?U.values.dDoubleSided.ref.value||U.values.hasReflection.ref.value?i.disable(a.CULL_FACE):i.enable(a.CULL_FACE):i.disable(a.CULL_FACE),U.values.dFlipSided&&U.values.dFlipSided.ref.value?(i.frontFace(a.CW),i.cullFace(a.FRONT)):(i.frontFace(a.CCW),i.cullFace(a.BACK))),U.render(z,g)}},H=function(U){N.update(D.uView,U.view),N.update(D.uInvView,le.invert(y,U.view)),N.update(D.uProjection,U.projection),N.update(D.uInvProjection,le.invert(x,U.projection)),N.updateIfChanged(D.uIsOrtho,U.state.mode==="orthographic"?1:0),N.update(D.uViewOffset,U.viewOffset.enabled?Ke.set(I,U.viewOffset.offsetX*16,U.viewOffset.offsetY*16):Ke.set(I,0,0)),N.update(D.uCameraPosition,U.state.position),N.update(D.uCameraDir,_.normalize(A,_.sub(A,U.state.target,U.state.position))),N.updateIfChanged(D.uFar,U.far),N.updateIfChanged(D.uNear,U.near),N.updateIfChanged(D.uFogFar,U.fogFar),N.updateIfChanged(D.uFogNear,U.fogNear),N.updateIfChanged(D.uTransparentBackground,v)},B=function(U,z,ee,Y){tEe(g,"tDepth",ee||p),N.update(D.uModel,U.view),N.update(D.uModelView,le.mul(b,U.view,z.view)),N.update(D.uInvModelView,le.invert(S,b)),N.update(D.uModelViewProjection,le.mul(C,b,z.projection)),N.update(D.uInvModelViewProjection,le.invert(w,C)),N.updateIfChanged(D.uRenderWboit,Y),i.enable(a.SCISSOR_TEST),i.colorMask(!0,!0,!0,!0);var Z=d.x,te=d.y,ce=d.width,be=d.height;a.viewport(Z,te,ce,be),a.scissor(Z,te,ce,be),R=!0,i.currentRenderItemId=-1},j=function(U,z,ee,Y){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),B(U,z,Y,!1);for(var Z=U.renderables,te=0,ce=Z.length;te<ce;++te)Z[te].state.colorOnly||L(Z[te],ee)},Q=function(U,z,ee){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),B(U,z,ee,!1);for(var Y=U.renderables,Z=0,te=Y.length;Z<te;++Z)L(Y[Z],"depth")},G=function(U,z,ee){W(U,z,ee),q(U,z,ee)},W=function(U,z,ee){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),B(U,z,ee,!1);for(var Y=U.renderables,Z=0,te=Y.length;Z<te;++Z){var ce=Y[Z];ce.state.opaque&&L(ce,"colorBlended")}},q=function(U,z,ee){i.enable(a.DEPTH_TEST),B(U,z,ee,!1);var Y=U.renderables;v?i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA):i.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),i.depthMask(!0);for(var Z=0,te=Y.length;Z<te;++Z){var ce=Y[Z];!ce.state.opaque&&ce.state.writeDepth&&L(ce,"colorBlended")}i.depthMask(!1);for(var Z=0,te=Y.length;Z<te;++Z){var ce=Y[Z];!ce.state.opaque&&!ce.state.writeDepth&&L(ce,"colorBlended")}},J=function(U,z,ee){var Y;i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),B(U,z,ee,!1);for(var Z=U.renderables,te=0,ce=Z.length;te<ce;++te){var be=Z[te],xe=ki(be.values.alpha.ref.value*be.state.alphaFactor,0,1);xe===1&&be.values.transparencyAverage.ref.value!==1&&!(!((Y=be.values.dXrayShaded)===null||Y===void 0)&&Y.ref.value)&&L(be,"colorBlended")}},he=function(U,z,ee){var Y;i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),B(U,z,ee,!1);for(var Z=U.renderables,te=0,ce=Z.length;te<ce;++te){var be=Z[te],xe=ki(be.values.alpha.ref.value*be.state.alphaFactor,0,1);(xe<1||be.values.transparencyAverage.ref.value>0||!((Y=be.values.dXrayShaded)===null||Y===void 0)&&Y.ref.value)&&L(be,"colorBlended")}},$=function(U,z,ee){var Y,Z,te;i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),B(U,z,ee,!1);for(var ce=U.renderables,be=0,xe=ce.length;be<xe;++be){var Ie=ce[be],_e=ki(Ie.values.alpha.ref.value*Ie.state.alphaFactor,0,1);_e===1&&Ie.values.transparencyAverage.ref.value!==1&&((Y=Ie.values.dRenderMode)===null||Y===void 0?void 0:Y.ref.value)!=="volume"&&!(!((Z=Ie.values.dPointFilledCircle)===null||Z===void 0)&&Z.ref.value)&&!(!((te=Ie.values.dXrayShaded)===null||te===void 0)&&te.ref.value)&&L(Ie,"colorWboit")}},X=function(U,z,ee){var Y,Z,te;B(U,z,ee,!0);for(var ce=U.renderables,be=0,xe=ce.length;be<xe;++be){var Ie=ce[be],_e=ki(Ie.values.alpha.ref.value*Ie.state.alphaFactor,0,1);(_e<1||Ie.values.transparencyAverage.ref.value>0||((Y=Ie.values.dRenderMode)===null||Y===void 0?void 0:Y.ref.value)==="volume"||!((Z=Ie.values.dPointFilledCircle)===null||Z===void 0)&&Z.ref.value||Ie.values.uBackgroundColor||!((te=Ie.values.dXrayShaded)===null||te===void 0)&&te.ref.value)&&L(Ie,"colorWboit")}};return{clear:function(U){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),v?i.clearColor(0,0,0,0):U?i.clearColor(h[0],h[1],h[2],1):i.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},clearDepth:function(){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.depthMask(!0),a.clear(a.DEPTH_BUFFER_BIT)},update:H,renderPick:j,renderDepth:Q,renderBlended:G,renderBlendedOpaque:W,renderBlendedTransparent:q,renderBlendedVolumeOpaque:J,renderBlendedVolumeTransparent:he,renderWboitOpaque:$,renderWboitTransparent:X,setProps:function(U){U.backgroundColor!==void 0&&U.backgroundColor!==u.backgroundColor&&(u.backgroundColor=U.backgroundColor,dt.toVec3Normalized(h,u.backgroundColor),N.update(D.uFogColor,_.copy(D.uFogColor.ref.value,h))),U.pickingAlphaThreshold!==void 0&&U.pickingAlphaThreshold!==u.pickingAlphaThreshold&&(u.pickingAlphaThreshold=U.pickingAlphaThreshold,N.update(D.uPickingAlphaThreshold,u.pickingAlphaThreshold)),U.interiorDarkening!==void 0&&U.interiorDarkening!==u.interiorDarkening&&(u.interiorDarkening=U.interiorDarkening,N.update(D.uInteriorDarkening,u.interiorDarkening)),U.interiorColorFlag!==void 0&&U.interiorColorFlag!==u.interiorColorFlag&&(u.interiorColorFlag=U.interiorColorFlag,N.update(D.uInteriorColorFlag,u.interiorColorFlag)),U.interiorColor!==void 0&&U.interiorColor!==u.interiorColor&&(u.interiorColor=U.interiorColor,N.update(D.uInteriorColor,dt.toVec3Normalized(D.uInteriorColor.ref.value,u.interiorColor))),U.highlightColor!==void 0&&U.highlightColor!==u.highlightColor&&(u.highlightColor=U.highlightColor,N.update(D.uHighlightColor,dt.toVec3Normalized(D.uHighlightColor.ref.value,u.highlightColor))),U.selectColor!==void 0&&U.selectColor!==u.selectColor&&(u.selectColor=U.selectColor,N.update(D.uSelectColor,dt.toVec3Normalized(D.uSelectColor.ref.value,u.selectColor))),U.xrayEdgeFalloff!==void 0&&U.xrayEdgeFalloff!==u.xrayEdgeFalloff&&(u.xrayEdgeFalloff=U.xrayEdgeFalloff,N.update(D.uXrayEdgeFalloff,u.xrayEdgeFalloff)),U.style!==void 0&&(u.style=U.style,Object.assign(l,Dj(U.style)),N.updateIfChanged(D.uLightIntensity,l.lightIntensity),N.updateIfChanged(D.uAmbientIntensity,l.ambientIntensity),N.updateIfChanged(D.uMetalness,l.metalness),N.updateIfChanged(D.uRoughness,l.roughness),N.updateIfChanged(D.uReflectivity,l.reflectivity)),U.clip!==void 0&&!zc(U.clip,u.clip)&&(u.clip=U.clip,Object.assign(c,Rj(U.clip,c)),N.update(D.uClipObjectPosition,c.objects.position),N.update(D.uClipObjectRotation,c.objects.rotation),N.update(D.uClipObjectScale,c.objects.scale),N.update(D.uClipObjectType,c.objects.type))},setViewport:function(U,z,ee,Y){a.viewport(U,z,ee,Y),a.scissor(U,z,ee,Y),(U!==d.x||z!==d.y||ee!==d.width||Y!==d.height)&&($a.set(d,U,z,ee,Y),N.update(D.uViewportHeight,Y),N.update(D.uViewport,wr.set(D.uViewport.ref.value,U,z,ee,Y)))},setTransparentBackground:function(U){v=U},setDrawingBufferSize:function(U,z){(U!==f[0]||z!==f[1])&&N.update(D.uDrawingBufferSize,Ke.set(f,U,z))},props:u,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},dispose:function(){}}}e.create=t})(LD||(LD={}));function fr(e,t,r){return t===void 0&&(t=""),r===void 0&&(r=""),fr.create(e,t,r)}(function(e){function t(s,u,l){return u===void 0&&(u=""),l===void 0&&(l=""),{triggers:s,action:u,description:l}}e.create=t,e.Empty={triggers:[],action:"",description:""};function r(s){return s.triggers.length===0||s.triggers.every(function(u){return u.buttons===void 0&&u.modifiers===void 0})}e.isEmpty=r;function n(s,u,l){return s.triggers.some(function(c){return o.match(c,u,l)})}e.match=n;function a(s){return s.triggers.map(o.format).join(" or ")}e.formatTriggers=a;function i(s,u){u===void 0&&(u="");var l=s.description||Yo(u);return _Se(l,{triggers:"<i>"+a(s)+"</i>"})}e.format=i;function o(s,u){return o.create(s,u)}e.Trigger=o,function(s){function u(d,f){return{buttons:d,modifiers:f}}s.create=u,s.Empty={};function l(d,f,h){var v=d.buttons,p=d.modifiers;return v!==void 0&&(v===f||ev.has(v,f))&&(!p||Ru.areEqual(p,h))}s.match=l;function c(d){var f=[],h=QGe(d.buttons);h&&f.push(h);var v=ZGe(d.modifiers);return v&&f.push(v),f.join(" + ")}s.format=c}(o=e.Trigger||(e.Trigger={}))})(fr||(fr={}));var px=ev;function QGe(e){var t=[];return e===void 0?t.push("any mouse button"):e===0?t.push("mouse hover"):(px.has(e,1)&&t.push("left mouse button"),px.has(e,2)&&t.push("right mouse button"),px.has(e,4)&&t.push("wheel/middle mouse button"),px.has(e,8)&&t.push("three fingers")),t.join(" + ")}function ZGe(e,t){var r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}var Bd=Ru,Ud=fr.Trigger,JGe={dragRotate:fr([Ud(1,Bd.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:fr([Ud(1,Bd.create({shift:!0}))],"Rotate around z-axis","Drag using ${triggers}"),dragPan:fr([Ud(2,Bd.create()),Ud(1,Bd.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:fr.Empty,dragFocus:fr([Ud(8,Bd.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:fr([Ud(4,Bd.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:fr([Ud(4,Bd.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:fr([Ud(4,Bd.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:fr.Empty},oee={noScroll:T.Boolean(!0,{isHidden:!0}),rotateSpeed:T.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:T.Numeric(7,{min:1,max:15,step:1}),panSpeed:T.Numeric(1,{min:.1,max:5,step:.1}),spin:T.Boolean(!1,{description:"Spin the 3D scene around the x-axis in view space"}),spinSpeed:T.Numeric(1,{min:-20,max:20,step:1}),staticMoving:T.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:T.Numeric(.2,{},{isHidden:!0}),minDistance:T.Numeric(.01,{},{isHidden:!0}),maxDistance:T.Numeric(1e150,{},{isHidden:!0}),bindings:T.Value(JGe,{isHidden:!0}),autoAdjustMinMaxDistance:T.MappedStatic("on",{off:T.EmptyGroup(),on:T.Group({minDistanceFactor:T.Numeric(0),minDistancePadding:T.Numeric(5),maxDistanceFactor:T.Numeric(10),maxDistanceMin:T.Numeric(20)})},{isHidden:!0})},ND;(function(e){function t(r,n,a){a===void 0&&(a={});var i=E(E({},T.getDefaultValues(oee)),a),o=$a.clone(n.viewport),s=!1,u=r.drag.subscribe(V),l=r.interactionEnd.subscribe(ve),c=r.wheel.subscribe(Pe),d=r.pinch.subscribe(Me),f=!1,h=_(),v=_(),p=Ke(),g=Ke(),m=_(),y=0,b=Ke(),S=Ke(),x=0,C=Ke(),w=Ke(),A=Ke(),I=Ke(),D=Ke(),k=Ke(),R=_.clone(n.target),L=_.clone(n.position),H=_.clone(n.up),B=Ke();function j(Ue,rt){return Ke.set(B,(Ue-o.x)/o.width,(rt-o.y)/o.height)}var Q=Ke();function G(Ue,rt){return Ke.set(Q,(Ue-o.width*.5-o.x)/(o.width*.5),(o.height+2*(o.y-rt))/o.width)}var W=_(),q=Gn(),J=_(),he=_(),$=_(),X=_();function U(){var Ue=g[0]-p[0],rt=g[1]-p[1];_.set(X,Ue,rt,0);var ut=r.width/r.height,Ee=_.magnitude(X)*i.rotateSpeed*r.pixelRatio*ut;Ee?(_.sub(v,n.position,n.target),_.normalize(J,v),_.normalize(he,n.up),_.normalize($,_.cross($,he,J)),_.setMagnitude(he,he,rt),_.setMagnitude($,$,Ue),_.add(X,he,$),_.normalize(W,_.cross(W,X,v)),Gn.setAxisAngle(q,W,Ee),_.transformQuat(v,v,q),_.transformQuat(n.up,n.up,q),_.copy(m,W),y=Ee):!i.staticMoving&&y&&(y*=Math.sqrt(1-i.dynamicDampingFactor),_.sub(v,n.position,n.target),Gn.setAxisAngle(q,m,y),_.transformQuat(v,v,q),_.transformQuat(n.up,n.up,q)),Ke.copy(p,g)}var z=Gn();function ee(){var Ue=S[0]-b[0],rt=S[1]-b[1],ut=i.rotateSpeed*(-Ue+rt)*-.05;ut?(_.sub(v,n.position,n.target),Gn.setAxisAngle(z,v,ut),_.transformQuat(n.up,n.up,z),x=ut):!i.staticMoving&&x&&(x*=Math.sqrt(1-i.dynamicDampingFactor),_.sub(v,n.position,n.target),Gn.setAxisAngle(z,v,x),_.transformQuat(n.up,n.up,z)),Ke.copy(b,S)}function Y(){var Ue=1+(w[1]-C[1])*i.zoomSpeed;Ue!==1&&Ue>0&&_.scale(v,v,Ue),i.staticMoving?Ke.copy(C,w):C[1]+=(w[1]-C[1])*i.dynamicDampingFactor}function Z(){var Ue=(I[1]-A[1])*i.zoomSpeed;if(Ue!==0){var rt=Math.max(1,n.state.radius+n.state.radius*Ue);n.setState({radius:rt})}i.staticMoving?Ke.copy(A,I):A[1]+=(I[1]-A[1])*i.dynamicDampingFactor}var te=Ke(),ce=_(),be=_();function xe(){if(Ke.sub(te,Ke.copy(te,k),D),Ke.squaredMagnitude(te)){var Ue=r.pixelRatio*i.panSpeed;te[0]*=1/n.zoom*n.viewport.width*Ue,te[1]*=1/n.zoom*n.viewport.height*Ue,_.cross(be,_.copy(be,v),n.up),_.setMagnitude(be,be,te[0]),_.setMagnitude(ce,n.up,te[1]),_.add(be,be,ce),_.add(n.position,n.position,be),_.add(n.target,n.target,be),i.staticMoving?Ke.copy(D,k):(Ke.sub(te,k,D),Ke.scale(te,te,i.dynamicDampingFactor),Ke.add(D,D,te))}}function Ie(){var Ue=Math.min(Math.max(n.state.radiusMax*1e3,.01),i.maxDistance);_.squaredMagnitude(v)>Ue*Ue&&(_.setMagnitude(v,v,Ue),_.add(n.position,n.target,v),Ke.copy(C,w),Ke.copy(A,I)),_.squaredMagnitude(v)<i.minDistance*i.minDistance&&(_.setMagnitude(v,v,i.minDistance),_.add(n.position,n.target,v),Ke.copy(C,w),Ke.copy(A,I))}function _e(Ue,rt){return Ue*=r.pixelRatio,rt*=r.pixelRatio,Ue>o.x+o.width||r.height-rt>o.y+o.height||Ue<o.x||r.height-rt<o.y}var ae=-1;function ie(Ue){ae!==Ue&&(i.spin&&ae>0&&Ze(Ue-ae),_.sub(v,n.position,n.target),U(),ee(),Y(),Z(),xe(),_.add(n.position,n.target,v),Ie(),_.squaredDistance(h,n.position)>yn&&_.copy(h,n.position),ae=Ue)}function O(){_.copy(n.target,R),_.copy(n.position,L),_.copy(n.up,H),_.sub(v,n.position,n.target),_.copy(h,n.position)}function V(Ue){var rt=Ue.x,ut=Ue.y,Ee=Ue.pageX,Te=Ue.pageY,ye=Ue.buttons,Se=Ue.modifiers,Le=Ue.isStart,Ve=_e(rt,ut);if(!(Le&&Ve)&&!(!Le&&!f)){f=!0;var nt=fr.match(i.bindings.dragRotate,ye,Se),Xe=fr.match(i.bindings.dragRotateZ,ye,Se),He=fr.match(i.bindings.dragPan,ye,Se),se=fr.match(i.bindings.dragZoom,ye,Se),pe=fr.match(i.bindings.dragFocus,ye,Se),Ae=fr.match(i.bindings.dragFocusZoom,ye,Se);if(G(Ee,Te),j(Ee,Te),Le&&(nt&&(Ke.copy(g,Q),Ke.copy(p,g)),Xe&&(Ke.copy(S,Q),Ke.copy(b,S)),(se||Ae)&&(Ke.copy(C,B),Ke.copy(w,C)),pe&&(Ke.copy(A,B),Ke.copy(I,A)),He&&(Ke.copy(D,B),Ke.copy(k,D))),nt&&Ke.copy(g,Q),Xe&&Ke.copy(S,Q),(se||Ae)&&Ke.copy(w,B),pe&&Ke.copy(I,B),Ae){var Ye=_.distance(n.state.position,n.state.target);n.setState({radius:Ye/5})}He&&Ke.copy(k,B)}}function ve(){f=!1}function Pe(Ue){var rt=Ue.x,ut=Ue.y,Ee=Ue.dx,Te=Ue.dy,ye=Ue.dz,Se=Ue.buttons,Le=Ue.modifiers;if(!_e(rt,ut)){var Ve=mSe(Ee,Te,ye);fr.match(i.bindings.scrollZoom,Se,Le)&&(w[1]+=Ve*1e-4),fr.match(i.bindings.scrollFocus,Se,Le)&&(I[1]+=Ve*1e-4)}}function Me(Ue){var rt=Ue.fraction,ut=Ue.buttons,Ee=Ue.modifiers;fr.match(i.bindings.scrollZoom,ut,Ee)&&(f=!0,w[1]+=(rt-1)*.1)}function Ge(){s||(s=!0,u.unsubscribe(),c.unsubscribe(),d.unsubscribe(),l.unsubscribe())}var $e=Ke.create(.005,0);function Ze(Ue){if(i.spinSpeed!==0){var rt=(i.spinSpeed||0)/1e3;$e[0]=60*Math.min(Math.abs(Ue),1e3/8)/1e3*rt,f||Ke.add(g,p,$e)}}function ht(Ue){ae=-1,ie(Ue)}return{viewport:o,get props(){return i},setProps:function(Ue){Object.assign(i,Ue)},start:ht,update:ie,reset:O,dispose:Ge}}e.create=t})(ND||(ND={}));var D_;(function(e){function t(){return{view:le.identity(),position:_.create(0,0,0),direction:_.create(0,0,-1),up:_.create(0,1,0)}}e.create=t;var r=_.zero();function n(a){_.add(r,a.position,a.direction),le.lookAt(a.view,a.position,r,a.up)}e.update=n})(D_||(D_={}));var eqe=function(){function e(){this.removeList=bM(),this.removeMap=new Map,this.addList=bM(),this.addMap=new Map}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.removeList.count===0&&this.addList.count===0},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.removeMap.has(t)){var r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(!this.addMap.has(t)){var n=this.addList.addLast(t);this.addMap.set(t,n)}},e.prototype.remove=function(t){if(this.addMap.has(t)){var r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(!this.removeMap.has(t)){var n=this.removeList.addLast(t);this.removeMap.set(t,n)}},e.prototype.tryGetRemove=function(){var t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t},e.prototype.tryGetAdd=function(){var t=this.addList.removeFirst();return t&&this.addMap.delete(t),t},e}(),G0=new ls("98");function kj(e,t,r){G0.reset();for(var n=0,a=e.length;n<a;++n)if(!(r&&!e[n].state.visible)){var i=e[n].values.boundingSphere.ref.value;i.radius&&G0.includeSphere(i)}G0.finishedIncludeStep();for(var n=0,a=e.length;n<a;++n)if(!(r&&!e[n].state.visible)){var o=e[n].values.boundingSphere.ref.value;o.radius&&G0.radiusSphere(o)}return G0.getSphere(t)}function tqe(e,t){var r=e.getProgram("colorBlended").id,n=t.getProgram("colorBlended").id,a=e.materialId,i=t.materialId;return r!==n?r-n:a!==i?a-i:e.id-t.id}var Rg;(function(e){function t(r){var n=new Map,a=[],i=je(),o=je(),s=[],u=[],l=!0,c=!0,d=D_.create(),f=d.view,h=d.position,v=d.direction,p=d.up;function g(A){if(n.has(A))return console.warn("RenderObject with id '"+A.id+"' already present"),n.get(A);var I=D6e(r,A);return a.push(I),A.type==="direct-volume"?u.push(I):s.push(I),n.set(A,I),l=!0,c=!0,I}function m(A){var I=n.get(A);I&&(I.dispose(),yp(a,I),yp(s,I),yp(u,I),n.delete(A),l=!0,c=!0)}var y=100;function b(A){for(var I=kn(),D=0;;){var k=S.tryGetRemove();if(!k)break;if(m(k),++D%y===0&&kn()-I>A)return!1}for(;;){var k=S.tryGetAdd();if(!k)break;if(g(k),++D%y===0&&kn()-I>A)return!1}return a.sort(tqe),!0}var S=new eqe,x=-1;function C(){for(var A=23,I=0,D=a.length;I<D;++I)a[I].state.visible&&(A=31*A+a[I].id|0);return A=SX(A),A===-1&&(A=0),A}function w(){var A=C();return A!==x?(c=!0,!0):!1}return{view:f,position:h,direction:v,up:p,renderables:a,primitives:{view:f,position:h,direction:v,up:p,renderables:s},volumes:{view:f,position:h,direction:v,up:p,renderables:u},syncVisibility:w,update:function(A,I){var D;if(D_.update(d),A)for(var k=0,R=A.length;k<R;++k)(D=n.get(A[k]))===null||D===void 0||D.update();else for(var k=0,R=a.length;k<R;++k)a[k].update();I?w():(l=!0,c=!0)},add:function(A){return S.add(A)},remove:function(A){return S.remove(A)},commit:function(A){return A===void 0&&(A=Number.MAX_VALUE),b(A)},get needsCommit(){return!S.isEmpty},has:function(A){return n.has(A)},clear:function(){for(var A=0,I=a.length;A<I;++A)a[A].dispose();a.length=0,n.clear(),l=!0,c=!0},forEach:function(A){n.forEach(A)},get count(){return a.length},get boundingSphere(){return l&&(kj(a,i,!1),l=!1),i},get boundingSphereVisible(){return c&&(kj(a,o,!0),c=!1,x=C()),o}}}e.create=t})(Rg||(Rg={}));var FD=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=ua.createDefaultSnapshot(),this._target=ua.createDefaultSnapshot(),this._current=ua.createDefaultSnapshot()}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,n){if(r===void 0&&(r=0),(!this.inTransition||r>0)&&ua.copySnapshot(this._source,this.camera.state),this.inTransition||ua.copySnapshot(this._target,this.camera.state),ua.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)},e.prototype.tick=function(t){this.t=t,this.update()},e.prototype.finish=function(t){ua.copySnapshot(this.camera.state,t),this.inTransition=!1},e.prototype.update=function(){if(this.inTransition){var t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),ua.copySnapshot(this.camera.state,this._current)}},e}();(function(e){var t=Gn.identity();function r(n,a,i,o){ua.copySnapshot(n,o),Gn.slerp(t,Gn.Identity,Gn.rotationTo(t,i.up,o.up),a),_.transformQuat(n.up,i.up,t),_.lerp(n.target,i.target,o.target,a),_.lerp(n.position,i.position,o.position,a),n.radius=Wo(i.radius,o.radius,a),n.radiusMax=Wo(i.radiusMax,o.radiusMax,a),n.fov=Wo(i.fov,o.fov,a),n.fog=Wo(i.fog,o.fog,a)}e.defaultTransition=r})(FD||(FD={}));var ua=function(){function e(t,r,n){r===void 0&&(r=$a.create(0,0,128,128)),n===void 0&&(n={}),this.view=le.identity(),this.projection=le.identity(),this.projectionView=le.identity(),this.inverseProjectionView=le.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new FD(this),this.stateChanged=new _f(this.state),this.prevProjection=le.identity(),this.prevView=le.identity(),this.deltaDirection=_(),this.newPosition=_(),this.viewport=r,this.pixelScale=n.pixelScale||1,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"pixelRatio",{get:function(){var t=typeof window<"u"?window.devicePixelRatio:1;return t*this.pixelScale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(t){_.copy(this.state.position,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(t){_.copy(this.state.up,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(t){_.copy(this.state.target,t)},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=this.state;if(t.radiusMax===0)return!1;var r=2*Math.tan(t.fov/2)*_.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,aqe(this),this.state.mode){case"orthographic":rqe(this);break;case"perspective":nqe(this);break;default:throw new Error("unknown camera mode")}var n=!le.areEqual(this.projection,this.prevProjection,yn)||!le.areEqual(this.view,this.prevView,yn);if(n){if(le.mul(this.projectionView,this.projection,this.view),!le.tryInvert(this.inverseProjectionView,this.projectionView))return le.copy(this.view,this.prevView),le.copy(this.projection,this.prevProjection),le.mul(this.projectionView,this.projection,this.view),!1;le.copy(this.prevView,this.view),le.copy(this.prevProjection,this.projection)}return n},e.prototype.setState=function(t,r){this.transition.apply(t,r),this.stateChanged.next(t)},e.prototype.getSnapshot=function(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)},e.prototype.getTargetDistance=function(t){return e.targetDistance(t,this.state.fov,this.viewport.width,this.viewport.height)},e.prototype.getFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);_.sub(this.deltaDirection,this.target,this.position),a&&_.matchDirection(this.deltaDirection,a,this.deltaDirection),_.setMagnitude(this.deltaDirection,this.deltaDirection,o),_.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=_.clone(t),s.radius=i,s.position=_.clone(this.newPosition),n&&_.matchDirection(s.up,n,s.up),s},e.prototype.getInvariantFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);_.copy(this.deltaDirection,a),_.setMagnitude(this.deltaDirection,this.deltaDirection,o),_.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=_.clone(t),s.radius=i,s.position=_.clone(this.newPosition),_.copy(s.up,n),s},e.prototype.focus=function(t,r,n,a,i){r>0&&this.setState(this.getFocus(t,r,a,i),n)},e.prototype.project=function(t,r){return YGe(t,r,this.viewport,this.projectionView)},e.prototype.unproject=function(t,r){return _S(t,r,this.viewport,this.inverseProjectionView)},e}();(function(e){function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}e.ViewOffset=t;function r(u,l,c,d,f,h,v){u.fullWidth=l,u.fullHeight=c,u.offsetX=d,u.offsetY=f,u.width=h,u.height=v}e.setViewOffset=r;function n(u,l){u.enabled=l.enabled,u.fullWidth=l.fullWidth,u.fullHeight=l.fullHeight,u.offsetX=l.offsetX,u.offsetY=l.offsetY,u.width=l.width,u.height=l.height}e.copyViewOffset=n;function a(u,l,c,d){var f=Math.max(u,.01),h=c/d,v=d<c?1:h;return Math.abs(f/v/Math.sin(l/2))}e.targetDistance=a;function i(){return{mode:"perspective",fov:Math.PI/4,position:_.create(0,0,100),up:_.create(0,1,0),target:_.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0}}e.createDefaultSnapshot=i;function o(u,l){return l&&(typeof l.mode<"u"&&(u.mode=l.mode),typeof l.fov<"u"&&(u.fov=l.fov),typeof l.position<"u"&&_.copy(u.position,l.position),typeof l.up<"u"&&_.copy(u.up,l.up),typeof l.target<"u"&&_.copy(u.target,l.target),typeof l.radius<"u"&&(u.radius=l.radius),typeof l.radiusMax<"u"&&(u.radiusMax=l.radiusMax),typeof l.fog<"u"&&(u.fog=l.fog),typeof l.clipFar<"u"&&(u.clipFar=l.clipFar)),u}e.copySnapshot=o;function s(u,l){return u.mode===l.mode&&u.fov===l.fov&&u.radius===l.radius&&u.radiusMax===l.radiusMax&&u.fog===l.fog&&u.clipFar===l.clipFar&&_.exactEquals(u.position,l.position)&&_.exactEquals(u.up,l.up)&&_.exactEquals(u.target,l.target)}e.areSnapshotsEqual=s})(ua||(ua={}));function rqe(e){var t=e.viewport,r=e.zoom,n=e.near,a=e.far,i=e.viewOffset,o=-t.width/2,s=t.width/2,u=t.height/2,l=-t.height/2,c=(s-o)/(2*r),d=(u-l)/(2*r),f=(s+o)/2,h=(u+l)/2,v=f-c,p=f+c,g=h+d,m=h-d;if(i.enabled){var y=r/(i.width/i.fullWidth),b=r/(i.height/i.fullHeight),S=(s-o)/i.width,x=(u-l)/i.height;v+=S*(i.offsetX/y),p=v+S*(i.width/y),g-=x*(i.offsetY/b),m=g-x*(i.height/b)}le.ortho(e.projection,v,p,g,m,n,a),le.lookAt(e.view,e.position,e.target,e.up)}function nqe(e){var t=e.viewport.width/e.viewport.height,r=e.near,n=e.far,a=e.viewOffset,i=r*Math.tan(.5*e.state.fov),o=2*i,s=t*o,u=-.5*s;a.enabled&&(u+=a.offsetX*s/a.fullWidth,i-=a.offsetY*o/a.fullHeight,s*=a.width/a.fullWidth,o*=a.height/a.fullHeight),le.perspective(e.projection,u,u+s,i,i-o,r,n),le.lookAt(e.view,e.position,e.target,e.up)}function aqe(e){var t=e.state,r=t.radius,n=t.radiusMax,a=t.mode,i=t.fog,o=t.clipFar;r<.01&&(r=.01);var s=o?r:n,u=_.distance(e.position,e.target),l=u-r,c=u+s,d=-(50-i)/50,f=u-s*d,h=c;l=Math.max(Math.min(n,5),l),c=Math.max(5,c),l===c&&(c=l+.01),e.near=l,e.far=2*c,e.fogNear=f,e.fogFar=h}var EO={sceneBoundingSpheres:T.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:T.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:T.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:T.Boolean(!1,{description:"Show bounding spheres of visible instances."})},iqe=function(){function e(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=Rg.create(t),this.parent=r,this._props=E(E({},T.getDefaultValues(EO)),n)}return e.prototype.update=function(){var t=this,r=vx(this.scene,this.parent.boundingSphere,this.sceneData,dr.lightgrey,sqe);r&&(this.sceneData=r);var n=vx(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,dr.black,uqe);n&&(this.visibleSceneData=n),this.parent.forEach(function(a,i){var o=t.objectsData.get(i),s=vx(t.scene,a.values.boundingSphere.ref.value,o,dr.tomato,lqe);s&&t.objectsData.set(i,s);var u=t.instancesData.get(i),l=vx(t.scene,a.values.invariantBoundingSphere.ref.value,u,dr.skyblue,cqe,{aTransform:i.values.aTransform,matrix:i.values.matrix,transform:i.values.transform,extraTransform:i.values.extraTransform,uInstanceCount:i.values.uInstanceCount,instanceCount:i.values.instanceCount,aInstance:i.values.aInstance,hasReflection:i.values.hasReflection});l&&t.instancesData.set(i,l)}),this.objectsData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.objectsData.delete(i))}),this.instancesData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.instancesData.delete(i))}),this.scene.update(void 0,!1),this.scene.commit()},e.prototype.syncVisibility=function(){var t=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach(function(r,n){var a=t.objectsData.get(n);a&&(a.renderObject.state.visible=n.state.visible&&t._props.objectBoundingSpheres);var i=t.instancesData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&t._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this._props,t),this.isEnabled&&this.update()},e}();function vx(e,t,r,n,a,i){if(!r||!je.equals(r.boundingSphere,t)){var o=oqe(t,r&&r.mesh),s=r?r.renderObject:dqe(o,n,a,i);return r?N.updateIfChanged(s.values.drawCount,oi.getDrawCount(o)):e.add(s),{boundingSphere:je.clone(t),renderObject:s,mesh:o}}}function oqe(e,t){var r=2,n=R3(r),a=Et.createState(n,n/2,t);if(e.radius&&(Na(a,e.center,e.radius,r),je.hasExtrema(e)))for(var i=0,o=e.extrema;i<o.length;i++){var s=o[i];Na(a,s,1,0)}return Et.getMesh(a)}var sqe=_d(),uqe=_d(),lqe=_d(),cqe=_d();function dqe(e,t,r,n){var a=Ft.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n);return a0("mesh",a,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1,noClip:!1},r)}var fqe=function(){function e(t,r,n,a,i){var o=this;i===void 0&&(i=30),this.canvasIdentify=t,this.getLoci=r,this.input=n,this.camera=a,this.maxFps=i,this.ev=Wc.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=sr.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=ev.create(0),this.button=ev.create(0),this.modifiers=Ru.None,n.drag.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.isInteracting=!0,o.drag(u,l,c,d,f)}),n.move.subscribe(function(s){var u=s.x,l=s.y,c=s.inside,d=s.buttons,f=s.button,h=s.modifiers;!c||o.isInteracting||o.move(u,l,d,f,h)}),n.leave.subscribe(function(){o.leave()}),n.click.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.outsideViewport(u,l)||o.click(u,l,c,d,f)}),n.interactionEnd.subscribe(function(){o.isInteracting=!1}),n.modifiers.subscribe(function(s){o.modify(s)})}return e.prototype.identify=function(t,r){var n=this.startX!==this.endX||this.startY!==this.endY;if(t===2){n&&!sr.Loci.isEmpty(this.prevLoci)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:Ke.create(this.startX,this.startY),pageEnd:Ke.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY);return}if(n){var a=this.canvasIdentify(this.endX,this.endY);this.id=a==null?void 0:a.id,this.position=a==null?void 0:a.position,this.startX=this.endX,this.startY=this.endY}if(t===1){var i=this.getLoci(this.id);this.events.click.next({current:i,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ke.create(this.endX,this.endY),position:this.position}),this.prevLoci=i;return}if(!(!this.inside||this.currentIdentifyT!==r||!n||this.outsideViewport(this.endX,this.endY))){var o=this.getLoci(this.id);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ke.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}},e.prototype.tick=function(t){this.inside&&t-this.prevT>1e3/this.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?2:0,t))},e.prototype.leave=function(){this.inside=!1,sr.Loci.isEmpty(this.prevLoci)||(this.prevLoci=sr.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))},e.prototype.move=function(t,r,n,a,i){this.inside=!0,this.buttons=n,this.button=a,this.modifiers=i,this.endX=t,this.endY=r},e.prototype.click=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(1,0)},e.prototype.drag=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(2,0)},e.prototype.modify=function(t){Ru.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ke.create(this.endX,this.endY),position:this.position}))},e.prototype.outsideViewport=function(t,r){var n=this,a=n.input,i=n.camera.viewport;return t*=a.pixelRatio,r*=a.pixelRatio,t>i.x+i.width||a.height-r>i.y+i.height||t<i.x||a.height-r<i.y},e.prototype.dispose=function(){this.ev.dispose()},e}(),Ro=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,hqe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepth;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;

uniform float uMaxPossibleViewZDiff;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(getDepth(coords));

    float outline = 1.0;
    float bestDepth = 1.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;
            float sampleDepth = getDepth(sampleCoords);
            float sampleViewZ = isBackground(sampleDepth) ? backgroundViewZ : getViewZ(sampleDepth);

            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff && selfDepth > sampleDepth && sampleDepth <= bestDepth) {
                outline = 0.0;
                bestDepth = sampleDepth;
            }
        }
    }

    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), 0.0);
}
`,pqe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uRadius;
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getDepth(const in vec2 coords) {
    return outsideBounds(coords) ? 1.0 : unpackRGBAToDepth(texture2D(tDepth, coords));
}

vec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {
    vec3 p1 = vec3(offset1, depth1 - depth);
    vec3 p2 = vec3(offset2, depth2 - depth);

    vec3 normal = cross(p1, p2);
    normal.z = -normal.z;

    return normalize(normal);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(0.0), selfPackedDepth);
        return;
    }

    vec2 offset1 = vec2(0.0, invTexSize.y);
    vec2 offset2 = vec2(invTexSize.x, 0.0);

    float selfDepth1 = getDepth(selfCoords + offset1);
    float selfDepth2 = getDepth(selfCoords + offset2);

    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));

    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    for(int i = 0; i < dNSamples; i++){
        vec3 sampleViewPos = TBN * uSamples[i];
        sampleViewPos = selfViewPos + sampleViewPos * uRadius;

        vec4 offset = vec4(sampleViewPos, 1.0);
        offset = uProjection * offset;
        offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, getDepth(offset.xy)), uInvProjection).z;

        occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
    }
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(occlusion);

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`,vqe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform float uMaxPossibleViewZDiff;

uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // if background and if second pass
    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    // only if kernelSize is odd
    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {
        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth)) {
            continue;
        }

        if (abs(float(i)) > 1.0) { // abs is not defined for int in webgl1
            float sampleViewZ = getViewZ(sampleDepth);
            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff) {
                continue;
            }
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }

    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`,mqe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tColor;
uniform sampler2D tDepth;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform bool uTransparentBackground;

uniform float uOcclusionBias;
uniform float uOcclusionRadius;

uniform float uMaxPossibleViewZDiff;

const vec3 occlusionColor = vec3(0.0);

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getOutline(const in vec2 coords, out float closestTexel) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(selfDepth);

    float outline = 1.0;
    closestTexel = 1.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > dOutlineScale * dOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);

            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel && abs(selfViewZ - sampleOutlineDepth) > uMaxPossibleViewZDiff) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
            }
        }
    }
    return outline;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float viewDist;
    float fogFactor;

    #ifdef dOcclusionEnable
        float depth = getDepth(coords);
        if (!isBackground(depth)) {
            viewDist = abs(getViewZ(depth));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            float occlusionFactor = getSsao(coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(occlusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(occlusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
    #endif

    // outline needs to be handled after occlusion to keep them clean
    #ifdef dOutlineEnable
        float closestTexel;
        float outline = getOutline(coords, closestTexel);

        if (outline == 0.0) {
            color.rgb *= outline;
            viewDist = abs(getViewZ(closestTexel));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(color.rgb, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
            }
        }
    #endif

    gl_FragColor = color;
}
`,gqe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`,yqe={edgeThresholdMin:T.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:T.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:T.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:T.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},bqe=function(){function e(t,r){this.webgl=t,this.renderable=Cqe(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){N.update(this.renderable.values.uTexSizeInv,Ke.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,a=r.edgeThresholdMin,i=r.edgeThresholdMax,o=r.iterations,s=r.subpixelQuality,u=!1;n.tColor.ref.value!==t&&(N.update(this.renderable.values.tColor,t),u=!0),n.dEdgeThresholdMin.ref.value!==a&&(u=!0),N.updateIfChanged(n.dEdgeThresholdMin,a),n.dEdgeThresholdMax.ref.value!==i&&(u=!0),N.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==o&&(u=!0),N.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(u=!0),N.updateIfChanged(n.dSubpixelQuality,s),u&&this.renderable.update()},e.prototype.render=function(t,r){r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render()},e}(),xqe=E(E({},xi),{tColor:lr("texture","rgba","ubyte","linear"),uTexSizeInv:Qe("v2"),dEdgeThresholdMin:Qt("number"),dEdgeThresholdMax:Qt("number"),dIterations:Qt("number"),dSubpixelQuality:Qt("number")}),Sqe=Ln("fxaa",Ro,gqe);function Cqe(e,t){var r=t.getWidth(),n=t.getHeight(),a=E(E({},Si),{tColor:N.create(t),uTexSizeInv:N.create(Ke.create(1/r,1/n)),dEdgeThresholdMin:N.create(.0312),dEdgeThresholdMax:N.create(.125),dIterations:N.create(12),dSubpixelQuality:N.create(.3)}),i=E({},xqe),o=Za(e,"triangles",Sqe,i,a);return Qa(o,a)}var _qe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,wqe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`,Eqe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,Aqe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`,Pqe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,Tqe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`,Iqe={edgeThreshold:T.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:T.Numeric(16,{min:0,max:32,step:1})},Mqe=function(){function e(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement>"u"){Mr&&console.log('Missing "HTMLImageElement" required for "SMAA"');return}var n=r.getWidth(),a=r.getHeight();this.edgesTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.edgesRenderable=kqe(t,r),this.weightsRenderable=Nqe(t,this.edgesTarget.texture),this.blendRenderable=Uqe(t,r,this.weightsTarget.texture),this._supported=!0}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),N.update(this.edgesRenderable.values.uViewport,$a.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),N.update(this.weightsRenderable.values.uViewport,$a.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),N.update(this.blendRenderable.values.uViewport,$a.toVec4(this.blendRenderable.values.uViewport.ref.value,t))},e.prototype.setSize=function(t,r){var n=this.edgesTarget.getWidth(),a=this.edgesTarget.getHeight();(t!==n||r!==a)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),N.update(this.edgesRenderable.values.uTexSizeInv,Ke.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),N.update(this.weightsRenderable.values.uTexSizeInv,Ke.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),N.update(this.blendRenderable.values.uTexSizeInv,Ke.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t,r){var n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(N.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(N.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(N.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(N.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())},e.prototype.render=function(t,r){this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render()},e}(),Dqe=E(E({},xi),{tColor:lr("texture","rgba","ubyte","linear"),uTexSizeInv:Qe("v2"),uViewport:Qe("v4"),dEdgeThreshold:Qt("number")}),Rqe=Ln("smaa-edges",Pqe,Tqe);function kqe(e,t){var r=t.getWidth(),n=t.getHeight(),a=E(E({},Si),{tColor:N.create(t),uTexSizeInv:N.create(Ke.create(1/r,1/n)),uViewport:N.create(wr()),dEdgeThreshold:N.create(.1)}),i=E({},Dqe),o=Za(e,"triangles",Rqe,i,a);return Qa(o,a)}var Oqe=E(E({},xi),{tEdges:lr("texture","rgba","ubyte","linear"),tArea:lr("texture","rgb","ubyte","linear"),tSearch:lr("texture","rgba","ubyte","nearest"),uTexSizeInv:Qe("v2"),uViewport:Qe("v4"),dMaxSearchSteps:Qt("number")}),Lqe=Ln("smaa-weights",Eqe,Aqe);function Nqe(e,t){var r=t.getWidth(),n=t.getHeight(),a=$M(e.gl,e.extensions,"image-uint8","rgb","ubyte","linear"),i=$M(e.gl,e.extensions,"image-uint8","rgba","ubyte","nearest"),o=E(E({},Si),{tEdges:N.create(t),tArea:N.create(a),tSearch:N.create(i),uTexSizeInv:N.create(Ke.create(1/r,1/n)),uViewport:N.create(wr()),dMaxSearchSteps:N.create(8)});FU(jqe(),o.tArea,a),FU(zqe(),o.tSearch,i);var s=E({},Oqe),u=Za(e,"triangles",Lqe,s,o);return Qa(u,o)}var Fqe=E(E({},xi),{tColor:lr("texture","rgba","ubyte","linear"),tWeights:lr("texture","rgba","ubyte","linear"),uTexSizeInv:Qe("v2"),uViewport:Qe("v4")}),Bqe=Ln("smaa-blend",_qe,wqe);function Uqe(e,t,r){var n=t.getWidth(),a=t.getHeight(),i=E(E({},Si),{tColor:N.create(t),tWeights:N.create(r),uTexSizeInv:N.create(Ke.create(1/n,1/a)),uViewport:N.create(wr())}),o=E({},Fqe),s=Za(e,"triangles",Bqe,o,i);return Qa(s,i)}function jqe(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function zqe(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var Vqe=E(E({},xi),{tDepth:lr("texture","rgba","ubyte","nearest"),uTexSize:Qe("v2"),dOrthographic:Qt("number"),uNear:Qe("f"),uFar:Qe("f"),uMaxPossibleViewZDiff:Qe("f")});function Hqe(e,t){var r=E(E({},Si),{tDepth:N.create(t),uTexSize:N.create(Ke.create(t.getWidth(),t.getHeight())),dOrthographic:N.create(0),uNear:N.create(1),uFar:N.create(1e4),uMaxPossibleViewZDiff:N.create(.5)}),n=E({},Vqe),a=Ln("outlines",Ro,hqe),i=Za(e,"triangles",a,n,r);return Qa(i,r)}var Gqe=E(E({},xi),{tDepth:lr("texture","rgba","ubyte","nearest"),uSamples:Qe("v3[]"),dNSamples:Qt("number"),uProjection:Qe("m4"),uInvProjection:Qe("m4"),uBounds:Qe("v4"),uTexSize:Qe("v2"),uRadius:Qe("f"),uBias:Qe("f")});function qqe(e,t){var r=E(E({},Si),{tDepth:N.create(t),uSamples:N.create([0,0,1]),dNSamples:N.create(1),uProjection:N.create(le.identity()),uInvProjection:N.create(le.identity()),uBounds:N.create(wr()),uTexSize:N.create(Ke.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:N.create(8),uBias:N.create(.025)}),n=E({},Gqe),a=Ln("ssao",Ro,pqe),i=Za(e,"triangles",a,n,r);return Qa(i,r)}var Wqe=E(E({},xi),{tSsaoDepth:lr("texture","rgba","ubyte","nearest"),uTexSize:Qe("v2"),uKernel:Qe("f[]"),dOcclusionKernelSize:Qt("number"),uBlurDirectionX:Qe("f"),uBlurDirectionY:Qe("f"),uMaxPossibleViewZDiff:Qe("f"),uNear:Qe("f"),uFar:Qe("f"),uBounds:Qe("v4"),dOrthographic:Qt("number")});function Oj(e,t,r){var n=E(E({},Si),{tSsaoDepth:N.create(t),uTexSize:N.create(Ke.create(t.getWidth(),t.getHeight())),uKernel:N.create([0]),dOcclusionKernelSize:N.create(1),uBlurDirectionX:N.create(r==="horizontal"?1:0),uBlurDirectionY:N.create(r==="vertical"?1:0),uMaxPossibleViewZDiff:N.create(.5),uNear:N.create(0),uFar:N.create(1e4),uBounds:N.create(wr()),dOrthographic:N.create(0)}),a=E({},Wqe),i=Ln("ssao_blur",Ro,vqe),o=Za(e,"triangles",i,a,n);return Qa(o,n)}function $qe(e){for(var t=e/3,r=Math.floor((e+1)/2),n=[],a=0;a<r;a++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-a*a/(2*t*t)));return n}function Xqe(e,t){for(var r=[],n=0;n<t;n++){var a=(n*n+2*n+1)/(t*t);a=.1+a*(1-.1),r.push(e[n][0]*a),r.push(e[n][1]*a),r.push(e[n][2]*a)}return r}var Yqe=E(E({},xi),{tSsaoDepth:lr("texture","rgba","ubyte","nearest"),tColor:lr("texture","rgba","ubyte","nearest"),tDepth:lr("texture","rgba","ubyte","nearest"),tOutlines:lr("texture","rgba","ubyte","nearest"),uTexSize:Qe("v2"),dOrthographic:Qt("number"),uNear:Qe("f"),uFar:Qe("f"),uFogNear:Qe("f"),uFogFar:Qe("f"),uFogColor:Qe("v3"),uTransparentBackground:Qe("b"),uMaxPossibleViewZDiff:Qe("f"),dOcclusionEnable:Qt("boolean"),dOutlineEnable:Qt("boolean"),dOutlineScale:Qt("number"),uOutlineThreshold:Qe("f")});function Kqe(e,t,r,n,a){var i=E(E({},Si),{tSsaoDepth:N.create(a),tColor:N.create(t),tDepth:N.create(r),tOutlines:N.create(n),uTexSize:N.create(Ke.create(t.getWidth(),t.getHeight())),dOrthographic:N.create(0),uNear:N.create(1),uFar:N.create(1e4),uFogNear:N.create(1e4),uFogFar:N.create(1e4),uFogColor:N.create(_.create(1,1,1)),uTransparentBackground:N.create(!1),uMaxPossibleViewZDiff:N.create(.5),dOcclusionEnable:N.create(!1),dOutlineEnable:N.create(!1),dOutlineScale:N.create(1),uOutlineThreshold:N.create(.33)}),o=E({},Yqe),s=Ln("postprocessing",Ro,mqe),u=Za(e,"triangles",s,o,i);return Qa(u,i)}var see={occlusion:T.MappedStatic("on",{on:T.Group({samples:T.Numeric(32,{min:1,max:256,step:1}),radius:T.Numeric(5,{min:0,max:10,step:.1},{description:"Final radius is 2^x."}),bias:T.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:T.Numeric(15,{min:1,max:25,step:2})}),off:T.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),outline:T.MappedStatic("off",{on:T.Group({scale:T.Numeric(1,{min:1,max:5,step:1}),threshold:T.Numeric(.33,{min:.01,max:1,step:.01})}),off:T.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:T.MappedStatic("smaa",{fxaa:T.Group(yqe),smaa:T.Group(Iqe),off:T.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"})},lc=function(){function e(t,r){this.webgl=t,this.ssaoScale=this.calcSsaoScale();var n=r.colorTarget,a=r.depthTexture,i=n.getWidth(),o=n.getHeight();this.nSamples=1,this.blurKernelSize=1,this.target=t.createRenderTarget(i,o,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(i,o,!1),this.outlinesRenderable=Hqe(t,a),this.randomHemisphereVector=[];for(var s=0;s<256;s++){var u=_();u[0]=Math.random()*2-1,u[1]=Math.random()*2-1,u[2]=Math.random(),_.normalize(u,u),_.scale(u,u,Math.random()),this.randomHemisphereVector.push(u)}this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();var l=Math.floor(i*this.ssaoScale),c=Math.floor(o*this.ssaoScale);this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthTexture.define(l,c),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthBlurProxyTexture.define(l,c),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=qqe(t,a),this.ssaoBlurFirstPassRenderable=Oj(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=Oj(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=Kqe(t,n.texture,a,this.outlinesTarget.texture,this.ssaoDepthTexture)}return e.isEnabled=function(t){return t.occlusion.name==="on"||t.outline.name==="on"},e.prototype.calcSsaoScale=function(){return Math.min(1,1/this.webgl.pixelRatio)},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1],o=this.calcSsaoScale();if(t!==a||r!==i||this.ssaoScale!==o){this.ssaoScale=o;var s=Math.floor(t*this.ssaoScale),u=Math.floor(r*this.ssaoScale);this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.ssaoDepthTexture.define(s,u),this.ssaoDepthBlurProxyTexture.define(s,u),N.update(this.renderable.values.uTexSize,Ke.set(this.renderable.values.uTexSize.ref.value,t,r)),N.update(this.outlinesRenderable.values.uTexSize,Ke.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),N.update(this.ssaoRenderable.values.uTexSize,Ke.set(this.ssaoRenderable.values.uTexSize.ref.value,s,u)),N.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Ke.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,u)),N.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Ke.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,u))}},e.prototype.updateState=function(t,r,n,a){var i=!1,o=!1,s=!1,u=t.state.mode==="orthographic"?1:0,l=a.outline.name==="on",c=a.occlusion.name==="on",d=le.identity();if(le.invert(d,t.projection),a.occlusion.name==="on"){N.update(this.ssaoRenderable.values.uProjection,t.projection),N.update(this.ssaoRenderable.values.uInvProjection,d);var f=this.renderable.values.uTexSize.ref.value,h=f[0],v=f[1],p=this.ssaoRenderable.values.uBounds,g=t.viewport,m=this.ssaoScale;if(wr.set(p.ref.value,Math.floor(g.x*m)/(h*m),Math.floor(g.y*m)/(v*m),Math.ceil((g.x+g.width)*m)/(h*m),Math.ceil((g.y+g.height)*m)/(v*m)),N.update(p,p.ref.value),N.update(this.ssaoBlurFirstPassRenderable.values.uBounds,p.ref.value),N.update(this.ssaoBlurSecondPassRenderable.values.uBounds,p.ref.value),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==u&&(s=!0),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOrthographic,u),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOrthographic,u),this.nSamples!==a.occlusion.params.samples&&(o=!0,this.nSamples=a.occlusion.params.samples,N.update(this.ssaoRenderable.values.uSamples,Xqe(this.randomHemisphereVector,this.nSamples)),N.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples)),N.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,a.occlusion.params.radius)),N.updateIfChanged(this.ssaoRenderable.values.uBias,a.occlusion.params.bias),this.blurKernelSize!==a.occlusion.params.blurKernelSize){s=!0,this.blurKernelSize=a.occlusion.params.blurKernelSize;var y=$qe(this.blurKernelSize);N.update(this.ssaoBlurFirstPassRenderable.values.uKernel,y),N.update(this.ssaoBlurSecondPassRenderable.values.uKernel,y),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}}if(a.outline.name==="on"){var b=a.outline.params.threshold;t.state.mode==="orthographic"&&(b/=5);var S=Math.pow(1e3,b)/1e3,x=S*t.state.radiusMax,C=a.outline.params.scale-1;N.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),N.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),N.updateIfChanged(this.outlinesRenderable.values.uMaxPossibleViewZDiff,x),N.updateIfChanged(this.renderable.values.uMaxPossibleViewZDiff,x),this.renderable.values.dOutlineScale.ref.value!==C&&(i=!0),N.updateIfChanged(this.renderable.values.dOutlineScale,C)}N.updateIfChanged(this.renderable.values.uFar,t.far),N.updateIfChanged(this.renderable.values.uNear,t.near),N.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),N.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),N.update(this.renderable.values.uFogColor,dt.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),N.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==u&&(i=!0),N.updateIfChanged(this.renderable.values.dOrthographic,u),this.renderable.values.dOutlineEnable.ref.value!==l&&(i=!0),N.updateIfChanged(this.renderable.values.dOutlineEnable,l),this.renderable.values.dOcclusionEnable.ref.value!==c&&(i=!0),N.updateIfChanged(this.renderable.values.dOcclusionEnable,c),o&&this.ssaoRenderable.update(),s&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),i&&this.renderable.update();var w=this.webgl,A=w.gl,I=w.state;I.enable(A.SCISSOR_TEST),I.disable(A.BLEND),I.disable(A.DEPTH_TEST),I.depthMask(!1);var D=t.viewport,k=D.x,R=D.y,L=D.width,H=D.height;A.viewport(k,R,L,H),A.scissor(k,R,L,H)},e.prototype.render=function(t,r,n,a,i){if(this.updateState(t,n,a,i),i.outline.name==="on"&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),i.occlusion.name==="on"){var o=t.viewport,s=o.x,u=o.y,l=o.width,c=o.height,d=Math.floor(s*this.ssaoScale),f=Math.floor(u*this.ssaoScale),h=Math.ceil(l*this.ssaoScale),v=Math.ceil(c*this.ssaoScale);this.webgl.gl.viewport(d,f,h,v),this.webgl.gl.scissor(d,f,h,v),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),this.webgl.gl.viewport(s,u,l,c),this.webgl.gl.scissor(s,u,l,c)}r?this.webgl.unbindFramebuffer():this.target.bind();var p=this.webgl,g=p.gl,m=p.state;m.clearColor(0,0,0,1),g.clear(g.COLOR_BUFFER_BIT),this.renderable.render()},e}(),uT=function(){function e(t,r){this.drawPass=r;var n=r.colorTarget,a=n.getWidth(),i=n.getHeight();this.target=t.createRenderTarget(a,i,!1),this.fxaa=new bqe(t,this.target.texture),this.smaa=new Mqe(t,this.target.texture)}return e.isEnabled=function(t){return t.antialiasing.name!=="off"},e.prototype.setSize=function(t,r){var n=this.target.texture.getWidth(),a=this.target.texture.getHeight();(t!==n||r!==a)&&(this.target.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r))},e.prototype._renderFxaa=function(t,r,n){if(n.antialiasing.name==="fxaa"){var a=lc.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(a,n.antialiasing.params),this.fxaa.render(t.viewport,r?void 0:this.target)}},e.prototype._renderSmaa=function(t,r,n){if(n.antialiasing.name==="smaa"){var a=lc.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(a,n.antialiasing.params),this.smaa.render(t.viewport,r?void 0:this.target)}},e.prototype.render=function(t,r,n){if(n.antialiasing.name!=="off"){if(n.antialiasing.name==="fxaa")this._renderFxaa(t,r,n);else if(n.antialiasing.name==="smaa"){if(!this.smaa.supported)throw new Error('SMAA not supported, missing "HTMLImageElement"');this._renderSmaa(t,r,n)}}},e}(),Qqe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`,Zqe=E(E({},xi),{tColor:lr("texture","rgba","ubyte","nearest"),uTexSize:Qe("v2"),uWeight:Qe("f")}),Jqe=Ln("compose",Ro,Qqe);function eWe(e,t){var r=E(E({},Si),{tColor:N.create(t),uTexSize:N.create(Ke.create(t.getWidth(),t.getHeight())),uWeight:N.create(1)}),n=E({},Zqe),a=Za(e,"triangles",Jqe,n,r);return Qa(a,r)}var uee={mode:T.Select("off",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:T.Numeric(2,{min:0,max:5,step:1})},R_=function(){function e(t,r){this.webgl=t,this.drawPass=r;var n=t.extensions,a=n.colorBufferFloat,i=n.textureFloat,o=n.colorBufferHalfFloat,s=n.textureHalfFloat,u=r.colorTarget.getWidth(),l=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(u,l,!1);var c=o&&s?"fp16":a&&i?"float32":"uint8";this.composeTarget=t.createRenderTarget(u,l,!1,c),this.holdTarget=t.createRenderTarget(u,l,!1),this.compose=eWe(t,r.colorTarget.texture)}return e.isEnabled=function(t){return t.mode!=="off"},e.prototype.syncSize=function(){var t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),n=this.compose.values.uTexSize.ref.value,a=n[0],i=n[1];(t!==a||r!==i)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),N.update(this.compose.values.uTexSize,Ke.set(this.compose.values.uTexSize.ref.value,t,r)))},e.prototype.render=function(t,r,n,a,i,o,s,u){return u.multiSample.mode==="temporal"?this.renderTemporalMultiSample(t,r,n,a,i,o,s,u):(this.renderMultiSample(r,n,a,i,o,s,u),t)},e.prototype.bindOutputTarget=function(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()},e.prototype.renderMultiSample=function(t,r,n,a,i,o,s){var u=this,l=u.compose,c=u.composeTarget,d=u.drawPass,f=u.webgl,h=f.gl,v=f.state,p=BD[Math.max(0,Math.min(s.multiSample.sampleLevel,5))],g=r.viewport,m=g.x,y=g.y,b=g.width,S=g.height,x=1/p.length,C=1/32;r.viewOffset.enabled=!0,N.update(l.values.tColor,d.getColorTarget(s.postprocessing).texture),l.update();for(var w=0;w<p.length;++w){var A=p[w];ua.setViewOffset(r.viewOffset,b,S,A[0],A[1],b,S),r.update();var I=-.5+(w+.5)/p.length,D=x+C*I;N.update(l.values.uWeight,D),d.render(t,r,n,a,!1,o,s.postprocessing),c.bind(),v.enable(h.BLEND),v.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),v.blendFuncSeparate(h.ONE,h.ONE,h.ONE,h.ONE),v.disable(h.DEPTH_TEST),v.depthMask(!1),h.viewport(m,y,b,S),h.scissor(m,y,b,S),w===0&&(v.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT)),l.render()}N.update(l.values.uWeight,1),N.update(l.values.tColor,c.texture),l.update(),this.bindOutputTarget(i),h.viewport(m,y,b,S),h.scissor(m,y,b,S),v.disable(h.BLEND),l.render(),r.viewOffset.enabled=!1,r.update()},e.prototype.renderTemporalMultiSample=function(t,r,n,a,i,o,s,u){var l=this,c=l.compose,d=l.composeTarget,f=l.holdTarget,h=l.drawPass,v=l.webgl,p=v.gl,g=v.state,m=BD[Math.max(0,Math.min(u.multiSample.sampleLevel,5))];if(t===-2||t>=m.length)return-2;var y=n.viewport,b=y.x,S=y.y,x=y.width,C=y.height,w=1/m.length;if(t===-1)h.render(r,n,a,i,!1,s,u.postprocessing),N.update(c.values.uWeight,1),N.update(c.values.tColor,h.getColorTarget(u.postprocessing).texture),c.update(),f.bind(),g.disable(p.BLEND),g.disable(p.DEPTH_TEST),g.depthMask(!1),p.viewport(b,S,x,C),p.scissor(b,S,x,C),c.render(),t+=1;else{n.viewOffset.enabled=!0,N.update(c.values.tColor,h.getColorTarget(u.postprocessing).texture),N.update(c.values.uWeight,w),c.update();for(var A=Math.pow(2,Math.max(0,u.multiSample.sampleLevel-2)),I=0;I<A;++I){var D=m[t];if(ua.setViewOffset(n.viewOffset,x,C,D[0],D[1],x,C),n.update(),h.render(r,n,a,i,!1,s,u.postprocessing),d.bind(),g.enable(p.BLEND),g.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD),g.blendFuncSeparate(p.ONE,p.ONE,p.ONE,p.ONE),g.disable(p.DEPTH_TEST),g.depthMask(!1),p.viewport(b,S,x,C),p.scissor(b,S,x,C),t===0&&(g.clearColor(0,0,0,0),p.clear(p.COLOR_BUFFER_BIT)),c.render(),t+=1,t>=m.length)break}}this.bindOutputTarget(o),p.viewport(b,S,x,C),p.scissor(b,S,x,C);var k=t*w;return k>0&&(N.update(c.values.uWeight,1),N.update(c.values.tColor,d.texture),c.update(),g.disable(p.BLEND),c.render()),k<1&&(N.update(c.values.uWeight,1-k),N.update(c.values.tColor,f.texture),c.update(),k===0?g.disable(p.BLEND):g.enable(p.BLEND),c.render()),n.viewOffset.enabled=!1,n.update(),t>=m.length?-2:t},e}(),BD=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];BD.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var lee=function(){function e(t){this.multiSamplePass=t,this.sampleIndex=-2}return e.prototype.update=function(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1},e.prototype.render=function(t,r,n,a,i,o,s){this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,a,i,o,s)},e}(),cee={eyeSeparation:T.Numeric(.064,{min:.01,max:.5,step:.001}),focus:T.Numeric(10,{min:1,max:100,step:.01})},tWe=T.getDefaultValues(cee),kg=function(){function e(t,r){r===void 0&&(r={}),this.parent=t,this.left=new Lj,this.right=new Lj,this.props=E(E({},tWe),r)}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.parent.viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewOffset",{get:function(){return this.parent.viewOffset},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.update=function(){this.parent.update(),rWe(this.parent,this.props,this.left,this.right)},e}();(function(e){function t(r){return"left"in r&&"right"in r}e.is=t})(kg||(kg={}));var Lj=function(){function e(){this.viewport=$a.create(0,0,0,0),this.view=le(),this.projection=le(),this.projectionView=le(),this.inverseProjectionView=le(),this.state=ua.createDefaultSnapshot(),this.viewOffset=ua.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}return e}(),Nj=le.identity(),Fj=le.identity();function rWe(e,t,r,n){$a.copy(r.viewport,e.viewport),le.copy(r.view,e.view),le.copy(r.projection,e.projection),ua.copySnapshot(r.state,e.state),ua.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,$a.copy(n.viewport,e.viewport),le.copy(n.view,e.view),le.copy(n.projection,e.projection),ua.copySnapshot(n.state,e.state),ua.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;var a=Math.floor(e.viewport.width/2),i=a/e.viewport.height;r.viewport.width=a,n.viewport.x+=a,n.viewport.width-=a;var o=t.eyeSeparation/2,s=o*e.near/t.focus,u=e.near*Math.tan(e.state.fov*.5),l,c;Nj[12]=-o,Fj[12]=o,l=-u*i+s,c=u*i+s,r.projection[0]=2*e.near/(c-l),r.projection[8]=(c+l)/(c-l),le.mul(r.view,r.view,Nj),le.mul(r.projectionView,r.projection,r.view),le.invert(r.inverseProjectionView,r.projectionView),l=-u*i-s,c=u*i-s,n.projection[0]=2*e.near/(c-l),n.projection[8]=(c+l)/(c-l),le.mul(n.view,n.view,Fj),le.mul(n.projectionView,n.projection,n.view),le.invert(n.inverseProjectionView,n.projectionView)}var lT=Math.pow(2,24)-2,nWe=function(){function e(t,r,n){this.webgl=t,this.drawPass=r,this.pickBaseScale=n;var a=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*a),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*a),this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight)}return Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.drawPass.colorTarget.getHeight()},enumerable:!1,configurable:!0}),e.prototype.syncSize=function(){var t=this.pickBaseScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight))},e.prototype.renderVariant=function(t,r,n,a,i){var o=this.drawPass.depthTexturePrimitives;t.clear(!1),t.update(r),t.renderPick(n.primitives,r,i,null),t.renderPick(n.volumes,r,i,o),t.renderPick(a.handle.scene,r,i,null),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera),t.renderPick(a.camera.scene,a.camera.camera,i,null))},e.prototype.render=function(t,r,n,a){this.objectPickTarget.bind(),this.renderVariant(t,r,n,a,"pickObject"),this.instancePickTarget.bind(),this.renderVariant(t,r,n,a,"pickInstance"),this.groupPickTarget.bind(),this.renderVariant(t,r,n,a,"pickGroup"),this.depthPickTarget.bind(),this.renderVariant(t,r,n,a,"depth")},e}(),aWe=function(){function e(t,r,n,a,i,o){this.webgl=t,this.renderer=r,this.scene=n,this.helper=a,this.pickPass=i,this.dirty=!0,this.viewport=$a(),this.setViewport(o.x,o.y,o.width,o.height)}return e.prototype.setupBuffers=function(){var t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))},e.prototype.setViewport=function(t,r,n,a){$a.set(this.viewport,t,r,n,a),this.pickScale=this.pickPass.pickBaseScale/this.webgl.pixelRatio,this.pickX=Math.ceil(t*this.pickScale),this.pickY=Math.ceil(r*this.pickScale);var i=Math.floor(n*this.pickScale),o=Math.floor(a*this.pickScale);(i!==this.pickWidth||o!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers())},e.prototype.syncBuffers=function(){var t=this,r=t.pickX,n=t.pickY,a=t.pickWidth,i=t.pickHeight;this.pickPass.objectPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.objectBuffer),this.pickPass.instancePickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.instanceBuffer),this.pickPass.groupPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.groupBuffer),this.pickPass.depthPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.depthBuffer)},e.prototype.getBufferIdx=function(t,r){return(r*this.pickWidth+t)*4},e.prototype.getDepth=function(t,r){var n=this.getBufferIdx(t,r),a=this.depthBuffer;return eOe(a[n],a[n+1],a[n+2],a[n+3])},e.prototype.getId=function(t,r,n){var a=this.getBufferIdx(t,r);return Yk(n[a],n[a+1],n[a+2])},e.prototype.render=function(t){var r=this,n=r.pickX,a=r.pickY,i=r.pickWidth,o=r.pickHeight,s=r.halfPickWidth,u=this,l=u.renderer,c=u.scene,d=u.helper;l.setTransparentBackground(!1),l.setDrawingBufferSize(this.pickPass.objectPickTarget.getWidth(),this.pickPass.objectPickTarget.getHeight()),kg.is(t)?(l.setViewport(n,a,s,o),this.pickPass.render(l,t.left,c,d),l.setViewport(n+s,a,i-s,o),this.pickPass.render(l,t.right,c,d)):(l.setViewport(n,a,i,o),this.pickPass.render(l,t,c,d)),this.dirty=!1},e.prototype.identify=function(t,r,n){var a=this,i=a.webgl,o=a.pickScale;if(!i.isContextLost){t*=i.pixelRatio,r*=i.pixelRatio,r=this.pickPass.drawingBufferHeight-r;var s=this.viewport;if(!(t<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)){this.dirty&&(this.render(n),this.syncBuffers());var u=t-s.x,l=r-s.y,c=Math.floor(u*o),d=Math.floor(l*o),f=this.getId(c,d,this.objectBuffer);if(!(f===-1||f===lT)){var h=this.getId(c,d,this.instanceBuffer);if(!(h===-1||h===lT)){var v=this.getId(c,d,this.groupBuffer);if(!(v===-1||v===lT)){var p=this.getDepth(c,d),g=_.create(t,s.height-r,p);if(kg.is(n)){var m=Math.floor(s.width/2);t>s.x+m?(g[0]=s.x+(u-m)*2,_S(g,g,s,n.right.inverseProjectionView)):(g[0]=s.x+u*2,_S(g,g,s,n.left.inverseProjectionView))}else _S(g,g,s,n.inverseProjectionView);return{id:{objectId:f,instanceId:h,groupId:v},position:g}}}}}}},e}(),iWe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tDepthPrimitives;
uniform sampler2D tDepthVolumes;
uniform vec2 uTexSize;

#include common

float getDepth(const in vec2 coords, sampler2D tDepth) {
    #ifdef dPackedDepth
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #else
        return texture2D(tDepth, coords).r;
    #endif
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = min(getDepth(coords, tDepthPrimitives), getDepth(coords, tDepthVolumes));
    gl_FragColor = packDepthToRGBA(depth);
}
`,oWe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`,sWe=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`,uWe=E(E({},xi),{tWboitA:lr("texture","rgba","float","nearest"),tWboitB:lr("texture","rgba","float","nearest"),uTexSize:Qe("v2")}),lWe=Ln("evaluate-wboit",Ro,sWe);function cWe(e,t,r){var n=E(E({},Si),{tWboitA:N.create(t),tWboitB:N.create(r),uTexSize:N.create(Ke.create(t.getWidth(),t.getHeight()))}),a=E({},uWe),i=Za(e,"triangles",lWe,a,n);return Qa(i,n)}var dWe=function(){function e(t,r,n){if(this.webgl=t,this._supported=!1,!!e.isSupported(t)){var a=t.resources;this.textureA=a.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=a.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.renderable=cWe(t,this.textureA,this.textureB),this.framebuffer=a.framebuffer(),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl;this.framebuffer.bind(),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),r.disable(n.DEPTH_TEST),r.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND)},e.prototype.render=function(){var t=this.webgl,r=t.state,n=t.gl;r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND),this.renderable.update(),this.renderable.render()},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1];(t!==a||r!==i)&&(this.textureA.define(t,r),this.textureB.define(t,r),N.update(this.renderable.values.uTexSize,Ke.set(this.renderable.values.uTexSize.ref.value,t,r)))},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){var t=this.webgl.extensions.drawBuffers;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1")},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,a=r.textureFloat,i=r.colorBufferFloat,o=r.depthTexture;if(!a||!i||!o||!n){if(Mr){var s=[];a||s.push("textureFloat"),i||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log('Missing "'+s.join('", "')+'" extensions required for "wboit"')}return!1}else return!0},e}(),fWe=E(E({},xi),{tDepthPrimitives:lr("texture","depth","ushort","nearest"),tDepthVolumes:lr("texture","depth","ushort","nearest"),uTexSize:Qe("v2"),dPackedDepth:Qt("boolean")}),hWe=Ln("depth-merge",Ro,iWe);function pWe(e,t,r,n){var a=E(E({},Si),{tDepthPrimitives:N.create(t),tDepthVolumes:N.create(r),uTexSize:N.create(Ke.create(t.getWidth(),t.getHeight())),dPackedDepth:N.create(n)}),i=E({},fWe),o=Za(e,"triangles",hWe,i,a);return Qa(o,a)}var vWe=E(E({},xi),{tColor:lr("texture","rgba","ubyte","nearest"),uTexSize:Qe("v2")}),mWe=Ln("copy",Ro,oWe);function Bj(e,t){var r=E(E({},Si),{tColor:N.create(t),uTexSize:N.create(Ke.create(t.getWidth(),t.getHeight()))}),n=E({},vWe),a=Za(e,"triangles",mWe,n,r);return Qa(a,r)}var dee=function(){function e(t,r,n,a){this.webgl=t;var i=t.extensions,o=t.resources,s=t.isWebGL2;this.drawTarget=FNe(t.gl),this.colorTarget=t.createRenderTarget(r,n,!0,"uint8","linear"),this.packedDepth=!i.depthTexture,this.depthTarget=t.createRenderTarget(r,n),this.depthTexture=this.depthTarget.texture,this.depthTargetPrimitives=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTargetVolumes=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTexturePrimitives=this.depthTargetPrimitives?this.depthTargetPrimitives.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.depthTextureVolumes=this.depthTargetVolumes?this.depthTargetVolumes.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.packedDepth||(this.depthTexturePrimitives.define(r,n),this.depthTextureVolumes.define(r,n)),this.depthMerge=pWe(t,this.depthTexturePrimitives,this.depthTextureVolumes,this.packedDepth),this.wboit=a?new dWe(t,r,n):void 0,this.postprocessing=new lc(t,this),this.antialiasing=new uT(t,this),this.copyFboTarget=Bj(t,this.colorTarget.texture),this.copyFboPostprocessing=Bj(t,this.postprocessing.target.texture)}return Object.defineProperty(e.prototype,"wboitEnabled",{get:function(){var t;return!!(!((t=this.wboit)===null||t===void 0)&&t.supported)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var t;(t=this.wboit)===null||t===void 0||t.reset()},e.prototype.setSize=function(t,r){var n,a=this.colorTarget.getWidth(),i=this.colorTarget.getHeight();(t!==a||r!==i)&&(this.colorTarget.setSize(t,r),this.depthTarget.setSize(t,r),this.depthTargetPrimitives?this.depthTargetPrimitives.setSize(t,r):this.depthTexturePrimitives.define(t,r),this.depthTargetVolumes?this.depthTargetVolumes.setSize(t,r):this.depthTextureVolumes.define(t,r),N.update(this.depthMerge.values.uTexSize,Ke.set(this.depthMerge.values.uTexSize.ref.value,t,r)),N.update(this.copyFboTarget.values.uTexSize,Ke.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),N.update(this.copyFboPostprocessing.values.uTexSize,Ke.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r)),!((n=this.wboit)===null||n===void 0)&&n.supported&&this.wboit.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r))},e.prototype._depthMerge=function(){var t=this.webgl,r=t.state,n=t.gl;this.depthMerge.update(),this.depthTarget.bind(),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.disable(n.CULL_FACE),r.depthMask(!1),r.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT),this.depthMerge.render()},e.prototype._renderWboit=function(t,r,n,a,i){var o;if(!(!((o=this.wboit)===null||o===void 0)&&o.supported))throw new Error("expected wboit to be supported");this.colorTarget.bind(),t.clear(!0),this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.primitives,r,null),this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.volumes,r,this.depthTexturePrimitives),this._depthMerge(),lc.isEnabled(i)&&this.postprocessing.render(r,!1,a,t.props.backgroundColor,i),this.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.depthTexture),t.renderWboitTransparent(n.volumes,r,this.depthTexture),lc.isEnabled(i)?(this.depthTexturePrimitives.attachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.target.bind()):(this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind()),this.wboit.render()},e.prototype._renderBlended=function(t,r,n,a,i,o){if(a?this.drawTarget.bind():(this.colorTarget.bind(),this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth")),t.clear(!0),t.renderBlendedOpaque(n.primitives,r,null),!a){this.depthTargetPrimitives&&(this.depthTargetPrimitives.bind(),t.clear(!1),t.renderDepth(n.primitives,r,null),this.colorTarget.bind()),this.packedDepth||(this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clearDepth()),t.renderBlendedVolumeOpaque(n.volumes,r,this.depthTexturePrimitives),this.depthTargetVolumes&&(this.depthTargetVolumes.bind(),t.clear(!1),t.renderDepth(n.volumes,r,this.depthTexturePrimitives),this.colorTarget.bind()),this._depthMerge(),this.colorTarget.bind(),lc.isEnabled(o)&&this.postprocessing.render(r,!1,i,t.props.backgroundColor,o),t.renderBlendedVolumeTransparent(n.volumes,r,this.depthTexturePrimitives);var s=lc.isEnabled(o)?this.postprocessing.target:this.colorTarget;this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(s.framebuffer,"depth"),s.bind()}t.renderBlendedTransparent(n.primitives,r,null)},e.prototype._render=function(t,r,n,a,i,o,s){var u=n.volumes.renderables.length>0,l=lc.isEnabled(s),c=uT.isEnabled(s),d=r.viewport,f=d.x,h=d.y,v=d.width,p=d.height;t.setViewport(f,h,v,p),t.update(r),o&&!c&&i&&(this.drawTarget.bind(),t.clear(!1)),this.wboitEnabled?this._renderWboit(t,r,n,o,s):this._renderBlended(t,r,n,!u&&!l&&!c&&i,o,s),l?this.postprocessing.target.bind():!i||u||this.wboitEnabled?this.colorTarget.bind():this.drawTarget.bind(),a.debug.isEnabled&&(a.debug.syncVisibility(),t.renderBlended(a.debug.scene,r,null)),a.handle.isEnabled&&t.renderBlended(a.handle.scene,r,null),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera),t.renderBlended(a.camera.scene,a.camera.camera,null)),c?this.antialiasing.render(r,i,s):i&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),l?this.copyFboPostprocessing.render():(u||this.wboitEnabled)&&this.copyFboTarget.render()),this.webgl.gl.flush()},e.prototype.render=function(t,r,n,a,i,o,s){t.setTransparentBackground(o),t.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),kg.is(r)?(this._render(t,r.left,n,a,i,o,s),this._render(t,r.right,n,a,i,o,s)):this._render(t,r,n,a,i,o,s)},e.prototype.getColorTarget=function(t){return uT.isEnabled(t)?this.antialiasing.target:lc.isEnabled(t)?this.postprocessing.target:this.colorTarget},e}(),gWe=E(E({},Ft.Params),{alpha:E(E({},Ft.Params.alpha),{defaultValue:.51}),ignoreLight:E(E({},Ft.Params.ignoreLight),{defaultValue:!0}),colorX:T.Color(dr.red,{isEssential:!0}),colorY:T.Color(dr.green,{isEssential:!0}),colorZ:T.Color(dr.blue,{isEssential:!0}),scale:T.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),J3={axes:T.MappedStatic("on",{on:T.Group(gWe),off:T.Group({})},{cycle:!0,description:"Show camera orientation axes"})},fee=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={axes:{name:"off",params:{}}},this.eachGroup=function(a,i){if(!n.renderObject||!UD(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=a.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,h=d.instanceId,v=h*s+f;i(Re.ofSingleton(v))&&(o=!0)}return o},this.scene=Rg.create(t),this.camera=new ua,_.set(this.camera.up,0,1,0),_.set(this.camera.target,0,0,0),this.setProps(r)}return e.prototype.setProps=function(t){var r=this;this.props=Ek(this.props,function(n){if(t.axes!==void 0&&(n.axes.name=t.axes.name,t.axes.name==="on")){r.scene.clear();var a=E(E({},t.axes.params),{scale:t.axes.params.scale*r.webgl.pixelRatio});r.renderObject=_We(a),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),_.set(r.camera.position,0,0,a.scale*200),le.lookAt(r.camera.view,r.camera.position,r.camera.target,r.camera.up),n.axes.params=E({},t.axes.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.axes.name==="on"},enumerable:!1,configurable:!0}),e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,a=t.instanceId;return!this.renderObject||r!==this.renderObject.id||n===0?Or:bWe(this,n,a)},e.prototype.mark=function(t,r){return!Mo.is(Mo.Highlighting,r)||!UD(t)||t.data!==this?!1:Cr.mark(this.renderObject,t,r,this.eachGroup)},e.prototype.update=function(t){if(this.renderObject){xWe(this.camera,t.viewport,t.viewOffset),le.extractRotation(this.scene.view,t.view);var r=this.renderObject.values.boundingSphere.ref.value.radius;le.setTranslation(this.scene.view,_.create(-t.viewport.width/2+r,-t.viewport.height/2+r,0))}},e}();function yWe(e){switch(e){case 1:return"X Axis";case 2:return"Y Axis";case 3:return"Z Axis";case 4:return"XY Plane";case 5:return"XZ Plane";case 6:return"YZ Plane";default:return"Axes"}}function bWe(e,t,r){return F3("camera-axes",e,[{groupId:t,instanceId:r}],void 0,function(){return yWe(t)})}function UD(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function xWe(e,t,r){var n=e.near,a=e.far,i=-t.width/2,o=t.width/2,s=t.height/2,u=-t.height/2,l=(o-i)/2,c=(s-u)/2,d=(o+i)/2,f=(s+u)/2,h=d-l,v=d+l,p=f+c,g=f-c;if(r.enabled){var m=(o-i)/r.width,y=(s-u)/r.height;h+=m*r.offsetX,v=h+m*r.width,p-=y*r.offsetY,g=p-y*r.height}le.ortho(e.projection,h,v,p,g,n,a)}function SWe(e,t){var r=Et.createState(512,256,t),n=.075*e,a=_.scale(_(),_.unitX,e),i=_.scale(_(),_.unitY,e),o=_.scale(_(),_.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};r.currentGroup=0,Na(r,_.origin,n,2),r.currentGroup=1,Na(r,a,n,2),Oi(r,_.origin,a,1,s),r.currentGroup=2,Na(r,i,n,2),Oi(r,_.origin,i,1,s),r.currentGroup=3,Na(r,o,n,2),Oi(r,_.origin,o,1,s),_.scale(a,a,.5),_.scale(i,i,.5),_.scale(o,o,.5),r.currentGroup=4,Et.addTriangle(r,_.origin,a,i),Et.addTriangle(r,_.origin,i,a);var u=_.add(_(),a,i);Et.addTriangle(r,u,a,i),Et.addTriangle(r,u,i,a),r.currentGroup=5,Et.addTriangle(r,_.origin,a,o),Et.addTriangle(r,_.origin,o,a);var l=_.add(_(),a,o);Et.addTriangle(r,l,a,o),Et.addTriangle(r,l,o,a),r.currentGroup=6,Et.addTriangle(r,_.origin,i,o),Et.addTriangle(r,_.origin,o,i);var c=_.add(_(),i,o);return Et.addTriangle(r,c,i,o),Et.addTriangle(r,c,o,i),Et.getMesh(r)}function CWe(e,t){var r=100*e.scale,n=SWe(r,t==null?void 0:t.geometry);n.setBoundingSphere(je.create(_.create(r/2,r/2,r/2),r+r/4));var a=function(i){switch(i){case 1:return e.colorX;case 2:return e.colorY;case 3:return e.colorZ;default:return dr.grey}};return kr.create("axes",{},n,a,function(){return 1},function(){return""})}function _We(e){var t=CWe(e);return kr.createRenderObject(t,e)}var wWe={transparentBackground:T.Boolean(!1),multiSample:T.Group(uee),postprocessing:T.Group(see),cameraHelper:T.Group(J3)},EWe=function(){function e(t,r,n,a,i,o,s){this.webgl=t,this.renderer=r,this.scene=n,this.camera=a,this._width=0,this._height=0,this._camera=new ua,this.props=E(E({},T.getDefaultValues(wWe)),s),this.drawPass=new dee(t,128,128,o),this.multiSamplePass=new R_(t,this.drawPass),this.multiSampleHelper=new lee(this.multiSamplePass),this.helper={camera:new fee(t,this.props.cameraHelper),debug:i.debug,handle:i.handle},this.setSize(1024,768)}return Object.defineProperty(e.prototype,"colorTarget",{get:function(){return this._colorTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())},e.prototype.setProps=function(t){t===void 0&&(t={}),Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)},e.prototype.render=function(){ua.copySnapshot(this._camera.state,this.camera.state),$a.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update(),R_.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props.postprocessing),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))},e.prototype.getImageData=function(t,r,n){var a,i;this.setSize(t,r),this.render(),this.colorTarget.bind();var o=(a=n==null?void 0:n.width)!==null&&a!==void 0?a:t,s=(i=n==null?void 0:n.height)!==null&&i!==void 0?i:r,u=new Uint8Array(o*s*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,o,s,u):this.webgl.readPixels(0,0,o,s,u);var l=Cp.create(u,o,s);return Cp.flipY(l),Cp.divideByAlpha(l),new ImageData(new Uint8ClampedArray(u),o,s)},e}(),AWe=E(E({},Ft.Params),{alpha:E(E({},Ft.Params.alpha),{defaultValue:1}),ignoreLight:E(E({},Ft.Params.ignoreLight),{defaultValue:!0}),colorX:T.Color(dr.red,{isEssential:!0}),colorY:T.Color(dr.green,{isEssential:!0}),colorZ:T.Color(dr.blue,{isEssential:!0}),scale:T.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),hee={handle:T.MappedStatic("off",{on:T.Group(AWe),off:T.Group({})},{cycle:!0,description:"Show handle tool"})},PWe=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={handle:{name:"off",params:{}}},this._transform=le(),this.eachGroup=function(a,i){if(!n.renderObject||!Uj(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=a.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,h=d.instanceId,v=h*s+f;i(Re.ofSingleton(v))&&(o=!0)}return o},this.scene=Rg.create(t),this.setProps(r)}return e.prototype.getBoundingSphere=function(t,r){return this.renderObject&&(je.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),le.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),je.transform(t,t,this._transform)),t},e.prototype.setProps=function(t){var r=this;this.props=Ek(this.props,function(n){if(t.handle!==void 0&&(n.handle.name=t.handle.name,t.handle.name==="on")){r.scene.clear();var a=E(E({},t.handle.params),{scale:t.handle.params.scale*r.webgl.pixelRatio});r.renderObject=DWe(a),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),n.handle.params=E({},t.handle.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.handle.name==="on"},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r,n){this.renderObject&&(le.setTranslation(this.renderObject.values.aTransform.ref.value,r),le.fromMat3(this.renderObject.values.aTransform.ref.value,n),N.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))},e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,a=t.instanceId;return!this.renderObject||r!==this.renderObject.id?Or:IWe(this,n,a)},e.prototype.mark=function(t,r){return!Mo.is(Mo.Highlighting,r)||!Uj(t)||t.data!==this?!1:Cr.mark(this.renderObject,t,r,this.eachGroup)},e}();function TWe(e,t){var r=Et.createState(512,256,t),n=.05*e,a=_.scale(_(),_.unitX,e),i=_.scale(_(),_.unitY,e),o=_.scale(_(),_.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=cp.TranslateScreenXY,Na(r,_.origin,n*3,2),r.currentGroup=cp.TranslateObjectX,Na(r,a,n,2),Oi(r,_.origin,a,1,s),r.currentGroup=cp.TranslateObjectY,Na(r,i,n,2),Oi(r,_.origin,i,1,s),r.currentGroup=cp.TranslateObjectZ,Na(r,o,n,2),Oi(r,_.origin,o,1,s),Et.getMesh(r)}var cp={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function IWe(e,t,r){return F3("handle",e,[{groupId:t,instanceId:r}],function(n){return e.getBoundingSphere(n,r)},function(){return"Handle Helper | Group Id "+t+" | Instance Id "+r})}function Uj(e){return e.kind==="data-loci"&&e.tag==="handle"}function MWe(e,t){var r=10*e.scale,n=TWe(r,t==null?void 0:t.geometry);n.setBoundingSphere(je.create(_.create(r/2,r/2,r/2),r+r/4));var a=function(i){switch(i){case cp.TranslateObjectX:return e.colorX;case cp.TranslateObjectY:return e.colorY;case cp.TranslateObjectZ:return e.colorZ;default:return dr.grey}};return kr.create("handle",{},n,a,function(){return 1},function(){return""})}function DWe(e){var t=MWe(e);return kr.createRenderObject(t,e)}var RWe={debug:T.Group(EO),camera:T.Group({helper:T.Group(J3)}),handle:T.Group(hee)},kWe=T.getDefaultValues(RWe),OWe=function(){function e(t,r,n){n===void 0&&(n={});var a=E(E({},kWe),n);this.debug=new iqe(t,r,a.debug),this.camera=new fee(t,a.camera.helper),this.handle=new PWe(t,a.handle)}return e}(),LWe=function(){function e(t,r){r===void 0&&(r={}),this.webgl=t;var n=t.gl;this.draw=new dee(t,n.drawingBufferWidth,n.drawingBufferHeight,r.enableWboit||!1),this.pick=new nWe(t,this.draw,r.pickScale||.25),this.multiSample=new R_(t,this.draw)}return e.prototype.updateSize=function(){var t=this.webgl.gl;this.draw.setSize(t.drawingBufferWidth,t.drawingBufferHeight),this.pick.syncSize(),this.multiSample.syncSize()},e}(),Es={camera:T.Group({mode:T.Select("perspective",T.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:T.Group(J3,{isFlat:!0}),stereo:T.MappedStatic("off",{on:T.Group(cee),off:T.Group({})},{cycle:!0,hideIf:function(e){return(e==null?void 0:e.mode)!=="perspective"}}),manualReset:T.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:T.MappedStatic("on",{on:T.Group({intensity:T.Numeric(15,{min:1,max:100,step:1})}),off:T.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:T.Group({radius:T.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:T.Boolean(!0,{description:"Hide scene in the distance"})},{pivot:"radius"}),viewport:T.MappedStatic("canvas",{canvas:T.Group({}),"static-frame":T.Group({x:T.Numeric(0),y:T.Numeric(0),width:T.Numeric(128),height:T.Numeric(128)}),"relative-frame":T.Group({x:T.Numeric(.33,{min:0,max:1,step:.01}),y:T.Numeric(.33,{min:0,max:1,step:.01}),width:T.Numeric(.5,{min:.01,max:1,step:.01}),height:T.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:T.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),transparentBackground:T.Boolean(!1),multiSample:T.Group(uee),postprocessing:T.Group(see),renderer:T.Group(OD),trackball:T.Group(oee),debug:T.Group(EO),handle:T.Group(hee)},AO=T.getDefaultValues(Es),jD;(function(e){e.DefaultAttribs={antialias:!0,preserveDrawingBuffer:!0,pixelScale:1,pickScale:.25,enableWboit:!0};function t(r,n){n===void 0&&(n={});var a=E(E({},e.DefaultAttribs),n),i=a.antialias,o=a.preserveDrawingBuffer,s=a.pixelScale,u=BNe(r,{antialias:i,preserveDrawingBuffer:o,alpha:!0,depth:!0,premultipliedAlpha:!0});if(u===null)throw new Error("Could not create a WebGL rendering context");var l=kD.fromElement(r,{pixelScale:s}),c=HNe(u,{pixelScale:s}),d=new LWe(c,n);if(Mr){var f=u.getExtension("WEBGL_lose_context");f&&r.addEventListener("mousedown",function(g){c.isContextLost||!g.shiftKey||!g.ctrlKey||!g.altKey||(Mr&&console.log("lose context"),f.loseContext(),setTimeout(function(){c.isContextLost&&(Mr&&console.log("restore context"),f.restoreContext())},1e3))},!1)}var h=new _f(0),v=function(g){c.setContextLost(),g.preventDefault(),Mr&&console.log("context lost"),h.next(kn())},p=function(){c.isContextLost&&(c.handleContextRestored(function(){d.draw.reset()}),Mr&&console.log("context restored"))};return r.addEventListener("webglcontextlost",v,!1),r.addEventListener("webglcontextrestored",p,!1),{canvas:r,webgl:c,input:l,passes:d,attribs:a,contextLost:h,contextRestored:c.contextRestored,dispose:function(g){l.dispose(),r.removeEventListener("webglcontextlost",v,!1),r.removeEventListener("webglcontextrestored",p,!1),c.destroy(g)}}}e.fromCanvas=t})(jD||(jD={}));var NWe=typeof window<"u"?window.requestAnimationFrame:function(e){return setImmediate(function(){return e(Date.now())})},FWe=typeof window<"u"?window.cancelAnimationFrame:function(e){return clearImmediate(e)},zD;(function(e){function t(r,n){var a=r.webgl,i=r.input,o=r.passes,s=r.attribs;n===void 0&&(n={});var u=E(E({},AO),n),l=new Map,c=new Map,d=new _f(0),f=kn(),h=new _f(0),v=new _f(0),p=a.gl,g=a.contextRestored,m=0,y=0,b=128,S=128;Te();var x=Rg.create(a),C=new ua({position:_.create(0,0,100),mode:u.camera.mode,fog:u.cameraFog.name==="on"?u.cameraFog.params.intensity:0,clipFar:u.cameraClipping.far},{x:m,y,width:b,height:S},{pixelScale:s.pixelScale}),w=new kg(C,u.camera.stereo.params),A=ND.create(i,C,u.trackball),I=LD.create(a,u.renderer),D=new OWe(a,x,u),k=new aWe(a,I,x,D,o.pick,{x:m,y,width:b,height:S}),R=new fqe(Ie,W,i,C),L=new lee(o.multiSample),H=!1,B=void 0,j=void 0,Q=!1,G=!0;function W(Se){var Le=Or,Ve=sr.Empty;if(Se){var nt=D.camera.getLoci(Se);if(nt!==Or)return{loci:nt,repr:Ve};Le=D.handle.getLoci(Se),l.forEach(function(Xe,He){var se=He.getLoci(Se);Mu(se)||(Mu(Le)||console.warn("found another loci, this should not happen"),Le=se,Ve=He)})}return{loci:Le,repr:Ve}}function q(Se,Le){var Ve=Se.repr,nt=Se.loci,Xe=!1;if(Ve?Xe=Ve.mark(nt,Le):(Xe=D.handle.mark(nt,Le),Xe=D.camera.mark(nt,Le)||Xe,l.forEach(function(se,pe){Xe=pe.mark(nt,Le)||Xe})),Xe){x.update(void 0,!0),D.handle.scene.update(void 0,!0),D.camera.scene.update(void 0,!0);var He=k.dirty;z(!0),k.dirty=He}}function J(Se){if(a.isContextLost)return!1;var Le=!1;if(Q&&(Ee(!1),Q=!1,Le=!0),m>p.drawingBufferWidth||m+b<0||y>p.drawingBufferHeight||y+S<0)return!1;var Ve=!1;A.update(X);var nt=C.update(),Xe=Se||nt||Le||he;he=!1;var He=L.update(Xe,u.multiSample);if(Xe||He){var se=C;u.camera.stereo.name==="on"&&(w.update(),se=w),R_.isEnabled(u.multiSample)?L.render(I,se,x,D,!0,u.transparentBackground,u):o.draw.render(I,se,x,D,!0,u.transparentBackground,u.postprocessing),k.dirty=!0,Ve=!0}return Ve}var he=!1,$=!1,X=0,U=!1;function z(Se){U||J(!!Se)&&G&&h.next(kn()-f)}function ee(Se){he=he||!!Se}var Y=0;function Z(Se,Le){X=Se,_e(Le==null?void 0:Le.isSynchronous),C.transition.tick(X),!(Le!=null&&Le.manualDraw)&&(z(!1),!C.transition.inTransition&&!a.isContextLost&&R.tick(X))}function te(){Z(kn()),Y=NWe(te)}function ce(Se){f=Se,A.start(Se)}function be(){U=!1,A.start(kn()),Y===0&&te()}function xe(Se){Se===void 0&&(Se=!1),U=Se,FWe(Y),Y=0}function Ie(Se,Le){var Ve=u.camera.stereo.name==="on"?w:C;return a.isContextLost?void 0:k.identify(Se,Le,Ve)}function _e(Se){Se===void 0&&(Se=!1);var Le=Pe(Se);Le&&(ae(),$&&(D.debug.isEnabled&&D.debug.update(),z(!0),$=!1),v.next(kn()))}function ae(){if(H){var Se=x.boundingSphereVisible,Le=Se.center,Ve=Se.radius,nt=A.props.autoAdjustMinMaxDistance;if(nt.name==="on"){var Xe=nt.params.minDistanceFactor*Ve+nt.params.minDistancePadding,He=Math.max(nt.params.maxDistanceFactor*Ve,nt.params.maxDistanceMin);A.setProps({minDistance:Xe,maxDistance:He})}if(Ve>0){var se=B===void 0?u.cameraResetDurationMs:B,pe=C.getFocus(Le,Ve),Ae=typeof j=="function"?j(x,C):j,Ye=Ae?E(E({},pe),Ae):pe;C.setState(E(E({},Ye),{radiusMax:x.boundingSphere.radius}),se)}B=void 0,j=void 0,H=!1}}var ie=je(),O=je();function V(){if(C.state.radiusMax===0)return!0;if(C.transition.inTransition||j)return!1;var Se=!0;je.set(O,C.state.target,C.state.radius);for(var Le=0,Ve=x.renderables;Le<Ve.length;Le++){var nt=Ve[Le];if(nt.state.visible){var Xe=nt.values.boundingSphere.ref.value;if(Xe.radius){var He=_.distance(O.center,Xe.center);if((He>O.radius||He>Xe.radius||Xe.radius>C.state.radiusMax)&&!je.includes(ie,Xe))return!0;je.overlaps(O,Xe)&&(Se=!1)}}}return Se}var ve=250;function Pe(Se){return x.needsCommit?(je.copy(ie,x.boundingSphereVisible),x.commit(Se?void 0:ve)?(D.debug.isEnabled&&D.debug.update(),!u.camera.manualReset&&(d.value===0||V())&&(H=!0),ie.radius===0&&(B=0),C.setState({radiusMax:x.boundingSphere.radius},0),d.next(l.size),Mr&&Me(),!0):!1):!0}function Me(){console.table(x.renderables.map(function(Xe){return{drawCount:Xe.values.drawCount.ref.value,instanceCount:Xe.values.instanceCount.ref.value,materialId:Xe.materialId,renderItemId:Xe.id}})),console.log(a.stats);var Se=a.resources.getByteCounts(),Le=Se.texture,Ve=Se.attribute,nt=Se.elements;console.log({texture:(Le/1024/1024).toFixed(3)+" MiB",attribute:(Ve/1024/1024).toFixed(3)+" MiB",elements:(nt/1024/1024).toFixed(3)+" MiB"})}function Ge(Se){Ze(Se);var Le=l.get(Se),Ve=new Set;Se.renderObjects.forEach(function(nt){return Ve.add(nt)}),Le?fa.areEqual(Ve,Le)||(Ve.forEach(function(nt){Le.has(nt)||x.add(nt)}),Le.forEach(function(nt){Ve.has(nt)||x.remove(nt)})):Se.renderObjects.forEach(function(nt){return x.add(nt)}),l.set(Se,Ve),x.update(Se.renderObjects,!1),$=!0,Mr&&Me()}function $e(Se){ht(Se);var Le=l.get(Se);Le&&(Le.forEach(function(Ve){return x.remove(Ve)}),l.delete(Se),$=!0,Mr&&Me())}function Ze(Se){c.has(Se)||c.set(Se,Se.updated.subscribe(function(Le){Se.state.syncManually||Ge(Se)}))}function ht(Se){var Le=c.get(Se);Le&&(Le.unsubscribe(),c.delete(Se))}function Ue(){var Se=x.boundingSphere.radius>0?100-Math.round(C.transition.target.radius/x.boundingSphere.radius*100):0;return{camera:{mode:C.state.mode,helper:E({},D.camera.props),stereo:E({},u.camera.stereo),manualReset:!!u.camera.manualReset},cameraFog:C.state.fog>0?{name:"on",params:{intensity:C.state.fog}}:{name:"off",params:{}},cameraClipping:{far:C.state.clipFar,radius:Se},cameraResetDurationMs:u.cameraResetDurationMs,transparentBackground:u.transparentBackground,viewport:u.viewport,postprocessing:E({},u.postprocessing),multiSample:E({},u.multiSample),renderer:E({},I.props),trackball:E({},A.props),debug:E({},D.debug.props),handle:E({},D.handle.props)}}var rt=g.subscribe(function(){k.dirty=!0,z(!0),z(!0)}),ut=new _f(0);function Ee(Se){Se===void 0&&(Se=!0),o.updateSize(),Te(),ye(),Se&&ee(!0),ut.next(+new Date)}return{webgl:a,add:Ge,remove:$e,commit:_e,update:function(Se,Le){if(Se){if(!l.has(Se))return;x.update(Se.renderObjects,!!Le)}else x.update(void 0,!!Le);$=!0},clear:function(){c.forEach(function(Se){return Se.unsubscribe()}),c.clear(),l.clear(),x.clear(),D.debug.clear(),ee(!0),d.next(l.size)},syncVisibility:function(){C.state.radiusMax===0&&(H=!0,B=0),x.syncVisibility()&&D.debug.isEnabled&&D.debug.update(),ee(!0)},requestDraw:ee,tick:Z,animate:be,resetTime:ce,pause:xe,resume:function(){U=!1},identify:Ie,mark:q,getLoci:W,handleResize:Ee,requestResize:function(){Q=!0},requestCameraReset:function(Se){B=Se==null?void 0:Se.durationMs,j=Se==null?void 0:Se.snapshot,H=!0},camera:C,boundingSphere:x.boundingSphere,boundingSphereVisible:x.boundingSphereVisible,get notifyDidDraw(){return G},set notifyDidDraw(Se){G=Se},didDraw:h,commited:v,reprCount:d,resized:ut,setProps:function(Se,Le){var Ve,nt,Xe;Le===void 0&&(Le=!1);var He=typeof Se=="function"?Vp(Ue(),Se):Se,se=Object.create(null);if(He.camera&&He.camera.mode!==void 0&&He.camera.mode!==C.state.mode&&(se.mode=He.camera.mode),He.cameraFog!==void 0&&He.cameraFog.params){var pe=He.cameraFog.name==="on"?He.cameraFog.params.intensity:0;pe!==C.state.fog&&(se.fog=pe)}if(He.cameraClipping!==void 0&&(He.cameraClipping.far!==void 0&&He.cameraClipping.far!==C.state.clipFar&&(se.clipFar=He.cameraClipping.far),He.cameraClipping.radius!==void 0)){var Ae=x.boundingSphere.radius/100*(100-He.cameraClipping.radius);Ae>0&&Ae!==se.radius&&(se.radius=Math.max(Ae,.01))}if(Object.keys(se).length>0&&C.setState(se),!((Ve=He.camera)===null||Ve===void 0)&&Ve.helper&&D.camera.setProps(He.camera.helper),((nt=He.camera)===null||nt===void 0?void 0:nt.manualReset)!==void 0&&(u.camera.manualReset=He.camera.manualReset),((Xe=He.camera)===null||Xe===void 0?void 0:Xe.stereo)!==void 0&&Object.assign(u.camera.stereo,He.camera.stereo),He.cameraResetDurationMs!==void 0&&(u.cameraResetDurationMs=He.cameraResetDurationMs),He.transparentBackground!==void 0&&(u.transparentBackground=He.transparentBackground),He.viewport!==void 0){var Ye=u.viewport===He.viewport||u.viewport.name===He.viewport.name&&MC(u.viewport.params,He.viewport.params);Ye||(u.viewport=He.viewport,Te(),ye())}He.postprocessing&&Object.assign(u.postprocessing,He.postprocessing),He.multiSample&&Object.assign(u.multiSample,He.multiSample),He.renderer&&I.setProps(He.renderer),He.trackball&&A.setProps(He.trackball),He.debug&&D.debug.setProps(He.debug),He.handle&&D.handle.setProps(He.handle),se.mode==="orthographic"&&(u.camera.stereo.name="off"),Le||ee(!0)},getImagePass:function(Se){return Se===void 0&&(Se={}),new EWe(a,I,x,C,D,o.draw.wboitEnabled,Se)},getRenderObjects:function(){var Se=[];return x.forEach(function(Le,Ve){return Se.push(Ve)}),Se},get props(){return Ue()},get input(){return i},get stats(){return I.stats},get interaction(){return R.events},dispose:function(){rt.unsubscribe(),x.clear(),D.debug.clear(),A.dispose(),I.dispose(),R.dispose()}};function Te(){var Se=m,Le=y,Ve=b,nt=S;u.viewport.name==="canvas"?(m=0,y=0,b=p.drawingBufferWidth,S=p.drawingBufferHeight):u.viewport.name==="static-frame"?(m=u.viewport.params.x*a.pixelRatio,S=u.viewport.params.height*a.pixelRatio,y=p.drawingBufferHeight-S-u.viewport.params.y*a.pixelRatio,b=u.viewport.params.width*a.pixelRatio):u.viewport.name==="relative-frame"&&(m=Math.round(u.viewport.params.x*p.drawingBufferWidth),S=Math.round(u.viewport.params.height*p.drawingBufferHeight),y=Math.round(p.drawingBufferHeight-S-u.viewport.params.y*p.drawingBufferHeight),b=Math.round(u.viewport.params.width*p.drawingBufferWidth)),(Se!==m||Le!==y||Ve!==b||nt!==S)&&(he=!0)}function ye(){k.setViewport(m,y,b,S),I.setViewport(m,y,b,S),$a.set(C.viewport,m,y,b,S),$a.set(A.viewport,m,y,b,S)}}e.create=t})(zD||(zD={}));function BWe(e){pee(e)}function pee(e){wt.Canvas3D.ResetSettings.subscribe(e,function(){var t;(t=e.canvas3d)===null||t===void 0||t.setProps(AO),e.events.canvas3d.settingsUpdated.next()}),wt.Canvas3D.SetSettings.subscribe(e,function(t){var r;e.canvas3d&&((r=e.canvas3d)===null||r===void 0||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next())})}const UWe=Object.freeze(Object.defineProperty({__proto__:null,Canvas3DSetSettings:pee,registerDefault:BWe},Symbol.toStringTag,{value:"Module"}));var Hf=Ru,Ep=fr.Trigger,jWe={hoverHighlightOnly:fr([Ep(0)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:fr([Ep(0,Hf.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},zWe={bindings:T.Value(jWe,{isHidden:!0}),ignore:T.Value([],{isHidden:!0}),mark:T.Boolean(!0)},VWe=Dr.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.lociMarkProvider=function(n,a){!r.ctx.canvas3d||!r.params.mark||r.ctx.canvas3d.mark(n,a)},r}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.hover,function(n){var a,i=n.current,o=n.buttons,s=n.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy)){if(((a=r.params.ignore)===null||a===void 0?void 0:a.indexOf(i.loci.kind))>=0){r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:i.repr,loci:Or});return}var u=!1;fr.match(r.params.bindings.hoverHighlightOnly,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:i.loci}),u=!0),fr.match(r.params.bindings.hoverHighlightOnlyExtend,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:i.loci}),u=!0),u||r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:i.repr,loci:Or})}}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)},t}(Dr.Handler),params:function(){return zWe},display:{name:"Highlight Loci on Canvas"}}),HWe={clickSelect:fr.Empty,clickToggleExtend:fr([Ep(1,Hf.create({shift:!0}))],"Toggle extended selection","${triggers} to extend selection along polymer"),clickSelectOnly:fr.Empty,clickToggle:fr([Ep(1,Hf.create())],"Toggle selection","${triggers} on element"),clickDeselect:fr.Empty,clickDeselectAllOnEmpty:fr([Ep(1,Hf.create())],"Deselect all","Click on nothing using ${triggers}")},GWe={bindings:T.Value(HWe,{isHidden:!0}),ignore:T.Value([],{isHidden:!0}),mark:T.Boolean(!0)},vee=Dr.create({name:"representation-select-loci",category:"interaction",ctor:function(e){Be(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.lociMarkProvider=function(i,o){!a.ctx.canvas3d||!a.params.mark||a.ctx.canvas3d.mark({loci:i.loci},o)},a.spine=new $1.Impl(r.state.data.cells),a}return t.prototype.applySelectMark=function(r,n){var a=this.ctx.state.data.cells.get(r);if(a&&ge.isRepresentation3D(a.obj)){this.spine.current=a;var i=this.spine.getRootOfType(ge.Molecule.Structure);if(i){n&&this.lociMarkProvider({loci:tt.Loci(i.data)},tr.Deselect);var o=this.ctx.managers.structure.selection.getLoci(i.data);this.lociMarkProvider({loci:o},tr.Select)}}},t.prototype.register=function(){var r=this,n=function(o){return or.isEmpty(o.loci)},a=function(o){return!or.isEmpty(o.loci)},i=[["clickSelect",function(o){return r.ctx.managers.interactivity.lociSelects.select(o)},a],["clickToggle",function(o){return r.ctx.managers.interactivity.lociSelects.toggle(o)},a],["clickToggleExtend",function(o){return r.ctx.managers.interactivity.lociSelects.toggleExtend(o)},a],["clickSelectOnly",function(o){return r.ctx.managers.interactivity.lociSelects.selectOnly(o)},a],["clickDeselect",function(o){return r.ctx.managers.interactivity.lociSelects.deselect(o)},a],["clickDeselectAllOnEmpty",function(){return r.ctx.managers.interactivity.lociSelects.deselectAll()},n]];i.sort(function(o,s){var u=r.params.bindings[o[0]],l=r.params.bindings[s[0]],c=u.triggers.length===0?0:Ml(u.triggers.map(function(f){return Hf.size(f.modifiers)})),d=l.triggers.length===0?0:Ml(l.triggers.map(function(f){return Hf.size(f.modifiers)}));return d-c}),this.subscribeObservable(this.ctx.behaviors.interaction.click,function(o){var s,u=o.current,l=o.button,c=o.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy||!r.ctx.selectionMode)&&!(((s=r.params.ignore)===null||s===void 0?void 0:s.indexOf(u.loci.kind))>=0))for(var d=0,f=i;d<f.length;d++){var h=f[d],v=h[0],p=h[1],g=h[2];if(fr.match(r.params.bindings[v],l,c)&&(!g||g(u))){p(u);break}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,function(o){var s=o.ref;return r.applySelectMark(s)}),this.subscribeObservable(this.ctx.state.events.object.updated,function(o){var s=o.ref,u=o.obj,l=o.oldObj,c=o.oldData,d=o.action,f=r.ctx.state.data.cells.get(s);if(f&&ge.Molecule.Structure.is(f.obj)){var h=u.data,v=d==="recreate"?l==null?void 0:l.data:d==="in-place"?c:void 0;if(v&&tt.areEquivalent(h,v)&&tt.areHierarchiesEqual(h,v))return;for(var p=r.ctx.state.data.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D,s)),g=0,m=p;g<m.length;g++){var y=m[g];r.applySelectMark(y.transform.ref,!0)}}})},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)},t}(Dr.Handler),params:function(){return GWe},display:{name:"Select Loci on Canvas"}}),qWe=Dr.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(t){this.ctx=t,this.f={label:function(r){var n=[];if(Oe.is(r)&&r.elements.length===1){var a=r.elements[0].unit,i=at.create(r.structure,a,a.elements[0]),o=pt.entity.pdbx_description(i).join(", ");n.push(o)}return n.push(ih(r)),n.filter(function(s){return!!s}).join("</br>")},group:function(r){return r.toString().replace(/Model [0-9]+/g,"Models")},priority:100}}return e.prototype.register=function(){this.ctx.managers.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.managers.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label"}}),WWe={clickFocus:fr([Ep(1,Hf.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:fr([Ep(1,Hf.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:fr([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:fr([],"Representation Focus Add","Click element using ${triggers}")},$We={bindings:T.Value(WWe,{isHidden:!0})},eE=Dr.create({name:"representation-focus-loci",category:"interaction",ctor:function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a,i=n.current,o=n.button,s=n.modifiers,u=r.params.bindings,l=u.clickFocus,c=u.clickFocusAdd,d=u.clickFocusSelectMode,f=u.clickFocusAddSelectMode,h=r.ctx.managers.interactivity.props.granularity;if(!(h!=="residue"&&h!=="element")){var v=r.ctx.selectionMode?d:l,p=fr.match(v,o,s),g=r.ctx.selectionMode?f:c,m=fr.match(g,o,s);if(!(!p&&!m)){var y=or.normalize(i.loci,"residue"),b=r.ctx.managers.structure.focus.current;if(b&&or.areEqual(b.loci,y))r.ctx.managers.structure.focus.clear();else if(p)r.ctx.managers.structure.focus.setFromLoci(y);else{r.ctx.managers.structure.focus.addFromLoci(y);var S=(a=r.ctx.managers.structure.focus.current)===null||a===void 0?void 0:a.loci;S&&r.ctx.managers.camera.focusLoci(S)}}}})},t}(Dr.Handler),params:function(){return $We},display:{name:"Representation Focus Loci on Canvas"}});const XWe=Object.freeze(Object.defineProperty({__proto__:null,DefaultLociLabelProvider:qWe,FocusLoci:eE,HighlightLoci:VWe,SelectLoci:vee},Symbol.toStringTag,{value:"Module"}));var q0=Ru,W0=fr.Trigger,YWe={clickCenterFocus:fr([W0(1,q0.create()),W0(2,q0.create()),W0(1,q0.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:fr([W0(2,q0.create()),W0(1,q0.create({control:!0}))],"Camera center and focus","Click element using ${triggers}")},KWe={minRadius:T.Numeric(8,{min:1,max:50,step:1}),extraRadius:T.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:T.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:T.Value(YWe,{isHidden:!0})},QWe=Dr.create({name:"camera-focus-loci",category:"interaction",ctor:function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a=n.current,i=n.button,o=n.modifiers;if(r.ctx.canvas3d){var s=r.ctx.selectionMode?r.params.bindings.clickCenterFocusSelectMode:r.params.bindings.clickCenterFocus;if(fr.match(s,i,o)){if(or.isEmpty(a.loci)){wt.Camera.Reset(r.ctx,{});return}var u=or.normalize(a.loci,r.ctx.managers.interactivity.props.granularity);r.ctx.managers.camera.focusLoci(u,r.params)}}})},t}(Dr.Handler),params:function(){return KWe},display:{name:"Camera Focus Loci on Canvas"}}),ZWe=Dr.create({name:"camera-axis-helper",category:"interaction",ctor:function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this,n=0,a=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(i){var o=i.current;if(!(!r.ctx.canvas3d||!UD(o.loci))){var s=o.loci.elements[0].groupId;if(s===0){n=0,a=0;return}var u=r.ctx.canvas3d.camera,l,c;if(s>=1&&s<=3){n=0,a=0;var d=_.sub(_(),u.target,u.position),f=_.cross(_(),d,u.up);c=_(),c[s-1]=1,l=_.cross(_(),c,f),_.magnitude(l)===0&&(l=d)}else n===s?a=(a+1)%2:(n=s,a=0),s===4?(c=a?_.unitX:_.unitY,l=_.negUnitZ):s===5?(c=a?_.unitX:_.unitZ,l=_.negUnitY):(c=a?_.unitY:_.unitZ,l=_.negUnitX);r.ctx.canvas3d.requestCameraReset({snapshot:function(h,v){return v.getInvariantFocus(h.boundingSphereVisible.center,h.boundingSphereVisible.radius,c,l)}})}})},t}(Dr.Handler),params:function(){return{}},display:{name:"Camera Axis Helper"}});const JWe=Object.freeze(Object.defineProperty({__proto__:null,CameraAxisHelper:ZWe,FocusLoci:QWe},Symbol.toStringTag,{value:"Module"}));var e$e=Dr.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"maxModelIndex",{get:function(){for(var r,n,a=-1,i=this.ctx.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Model)),o=0,s=i;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&Xt.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>a&&(a=l)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStructureIndex",{get:function(){for(var r,n,a=-1,i=this.ctx.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Structure)),o=0,s=i;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&tt.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>a&&(a=l)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"asymIdOffset",{get:function(){for(var r,n=0,a=0,i=this.ctx.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Model)),o=0,s=i;o<s.length;o++){var u=s[o],l=(r=u.obj)===null||r===void 0?void 0:r.data;if(l){var c=Xt.AsymIdCount.get(l),d=Xt.AsymIdOffset.get(l).value;c!==void 0&&d!==void 0&&(n=Math.max(n,d.auth+c.auth),a=Math.max(a,d.label+c.label))}}return{auth:n,label:a}},enumerable:!1,configurable:!0}),t.prototype.handleModel=function(r,n){if(Xt.Index.get(r).value===void 0){var a=n&&Xt.Index.get(n).value,i=a??this.maxModelIndex+1;Xt.Index.set(r,{value:i})}if(Xt.AsymIdOffset.get(r).value===void 0){var o=n&&Xt.AsymIdOffset.get(n).value,i=o??E({},this.asymIdOffset);Xt.AsymIdOffset.set(r,{value:i})}},t.prototype.handleStructure=function(r,n){if(r.parent===void 0&&tt.Index.get(r).value===void 0){var a=n&&tt.Index.get(n).value,i=a??this.maxStructureIndex+1;tt.Index.set(r,{value:i})}},t.prototype.handle=function(r,n,a){if(ge.Molecule.Structure.is(n)){var i=this.ctx.state.data.tree.transforms.get(r);!i.transformer.definition.isDecorator&&n.data.parent===void 0&&this.handleStructure(n.data,a==null?void 0:a.data)}else if(ge.Molecule.Model.is(n)){var i=this.ctx.state.data.tree.transforms.get(r);i.transformer.definition.isDecorator||this.handleModel(n.data,a==null?void 0:a.data)}},t.prototype.register=function(){var r=this;this.ctx.customModelProperties.register(Xt.AsymIdOffset,!0),this.ctx.customModelProperties.register(Xt.Index,!0),this.ctx.customStructureProperties.register(tt.Index,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,function(n){r.handle(n.ref,n.obj)}),this.subscribeObservable(this.ctx.state.data.events.object.updated,function(n){r.handle(n.ref,n.obj,n.oldObj)})},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(Xt.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(Xt.Index.descriptor.name),this.ctx.customStructureProperties.unregister(tt.Index.descriptor.name)},t}(Dr.Handler)}),Pf=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],mee={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},t$e=121;function r$e(e){var t=pt.residue.key,r=pt.atom,n=r.type_symbol,a=r.label_atom_id,i=r.label_comp_id,o=e.structure,s=e.atomRadiusType,u=e.serialResidueIndex,l=at.create(o),c=0,d=0,f=-1;l.structure=o;for(var h=0,v=0,p=o.units.length;h<p;++h){var g=o.units[h],m=g.elements;l.unit=g,c=-1;for(var y=0,b=m.length;y<b;++y){var S=m[y],x=v+y;l.element=S,d=t(l),c!==d&&++f,c=d;var C=n(l),w=Ag(C);if(tb(w)){s[x]=0,u[x]=-1;continue}var A=a(l),I=Fk(g,S);if(I===2||!e.nonPolymer&&!Nk(I)){s[x]=0,u[x]=-1;continue}var D=i(l);if(e.traceOnly&&(A!=="CA"&&A!=="BB"||!mee[D])){s[x]=0,u[x]=f;continue}Fl(I)?s[x]=a$e(A,C):I===5?s[x]=n$e(A,C,D):s[x]=PO(C),u[x]=f}v+=m.length}}function n$e(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return PO(t)}function a$e(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return PO(t)}function PO(e){var t=Mb(e),r=Pf.indexOf(t);return r===-1&&(r=Pf.length,Pf[r]=t),r}var jj=5e3;function i$e(e,t){return de(this,void 0,void 0,function(){var r,n;return fe(this,function(a){switch(a.label){case 0:r=t.atomRadiusType,n=0,a.label=1;case 1:return n<r.length?e.shouldUpdate?[4,e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length})]:[3,3]:[3,5];case 2:a.sent(),a.label=3;case 3:o$e(t,n,Math.min(n+jj,r.length)),a.label=4;case 4:return n+=jj,[3,1];case 5:return[2]}})})}function o$e(e,t,r){for(var n=e.structure,a=e.atomRadiusType,i=e.serialResidueIndex,o=e.area,s=e.spherePoints,u=e.scalingConstant,l=e.maxLookupRadius,c=e.probeSize,d=n.lookup3d,f=n.serialMapping,h=n.unitIndexMap,v=n.units,p=f.cumulativeUnitElementCount,g=f.elementIndices,m=f.unitIndices,y=t;y<r;++y){var b=Pf[a[y]];if(b!==Pf[0]){for(var S=v[m[y]],x=g[y],C=S.conformation.x(x),w=S.conformation.y(x),A=S.conformation.z(x),I=d.find(C,w,A,l),D=I.count,k=I.units,R=I.indices,L=I.squaredDistances,H=c+b,B=c+H,j=[],Q=0;Q<D;++Q){var G=k[Q],W=p[h.get(G.id)]+R[Q],q=g[W],J=Pf[a[W]];if(!(S===G&&x===q||J===Pf[0])){var he=c+J;if(L[Q]<(B+J)*(B+J)){var $=g[W];j[j.length]=[L[Q],(L[Q]+H*H-he*he)/(2*H),G.conformation.x($)-C,G.conformation.y($)-w,G.conformation.z($)-A]}}}j.sort(function(ie,O){return ie[0]-O[0]});var X=0;e:for(var U=0;U<s.length;++U){for(var z=s[U],ee=z[0],Y=z[1],Z=z[2],te=0;te<j.length;++te){var ce=j[te],be=ce[1],xe=ce[2],Ie=ce[3],_e=ce[4],ae=ee*xe+Y*Ie+Z*_e;if(ae>be)continue e}++X}o[i[y]]+=u*X*H*H}}}var gee={numberOfSpherePoints:T.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:T.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:T.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:T.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})},Og;(function(e){function t(l,c){var d=this;c===void 0&&(c={});var f=E(E({},T.getDefaultValues(gee)),c);return et.create("Compute Accessible Surface Area",function(h){return de(d,void 0,void 0,function(){return fe(this,function(v){switch(v.label){case 0:return[4,r(h,l,f)];case 1:return[2,v.sent()]}})})})}e.compute=t;function r(l,c,d){return de(this,void 0,void 0,function(){var f,h,v;return fe(this,function(p){switch(p.label){case 0:return f=n(c,d),r$e(f),[4,i$e(l,f)];case 1:return p.sent(),h=f.area,v=f.serialResidueIndex,[2,{area:h,serialResidueIndex:v}]}})})}function n(l,c){var d=l.elementCount,f=l.atomicResidueCount,h=c.probeSize,v=c.nonPolymer,p=c.traceOnly,g=c.numberOfSpherePoints;return{structure:l,probeSize:h,nonPolymer:v,traceOnly:p,spherePoints:a(g),scalingConstant:4*Math.PI/g,maxLookupRadius:2*c.probeSize+2*Pf[2],atomRadiusType:new Int8Array(d),serialResidueIndex:new Int32Array(d),area:new Float32Array(f)}}function a(l){for(var c=[],d=Math.PI*(3-Math.sqrt(5)),f=2/l,h=0;h<l;++h){var v=h*f-1+f/2,p=Math.sqrt(1-v*v),g=h*d;c[c.length]=_.create(Math.cos(g)*p,v,Math.sin(g)*p)}return c}function i(l,c){var d=mee[l]||t$e;return c/d}e.normalize=i;function o(l,c){var d=c.area,f=c.serialResidueIndex,h=f[it.indexOf(it.ofSortedArray(l.structure.root.serialMapping.elementIndices),l.element)];return h===-1?-1:d[h]}e.getValue=o;function s(l,c){var d=o(l,c);return d===-1?-1:i(pt.atom.label_comp_id(l),d)}e.getNormalizedValue=s;function u(l,c){var d=s(l,c);return d===-1?0:d<.16?1:2}e.getFlag=u})(Og||(Og={}));var cT=E({},gee),TO={isBuried:Ig.Dynamic(c7("computed","accessible-surface-area.is-buried",ke.Bool),function(e){if(!We.isAtomic(e.element.unit))return!1;var t=Ns.get(e.element.structure).value;return t?Og.getFlag(e.element,t)===1:!1}),isAccessible:Ig.Dynamic(c7("computed","accessible-surface-area.is-accessible",ke.Bool),function(e){if(!We.isAtomic(e.element.unit))return!1;var t=Ns.get(e.element.structure).value;return t?Og.getFlag(e.element,t)===2:!1})},Ns=th.createProvider({label:"Accessible Surface Area",descriptor:Po({name:"molstar_accessible_surface_area",symbols:TO}),type:"root",defaultParams:cT,getParams:function(e){return cT},isApplicable:function(e){return!0},obtain:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return n=E(E({},T.getDefaultValues(cT)),r),a={},[4,Og.compute(t,n).runInContext(e.runtime)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),dT=dt(16448250),s$e="Assigns a color based on the relative accessible surface area of a residue.",yee={list:T.ColorList("rainbow",{presetKind:"scale"})};function u$e(e){return yee}function bee(e,t){var r,n=Fu.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),a=e.structure&&Ns.get(e.structure),i=a?cv(a.id,a.version):-1;if(a!=null&&a.value&&e.structure){var o=at.create(e.structure),s=a.value,u=function(l){var c=Og.getNormalizedValue(l,s);return c===-1?dT:n.color(c)};r=function(l){return at.is(l)&&We.isAtomic(l.unit)?u(l):Gt.isLocation(l)?(o.unit=l.aUnit,o.element=l.aUnit.elements[l.aIndex],u(o)):dT}}else r=function(){return dT};return{factory:bee,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:i,description:s$e,legend:n?n.legend:void 0}}var zj={name:"accessible-surface-area",label:"Accessible Surface Area",category:"Residue Property",factory:bee,getParams:u$e,defaultValues:T.getDefaultValues(yee),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Ns.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Ns.ref(e.structure,!1)}}},l$e=Dr.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Ns,r.labelProvider={label:function(n){if(r.params.showTooltip)return c$e(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){i_.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(zj),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(Vj),this.ctx.query.structure.registry.add(Hj)},t.prototype.unregister=function(){i_.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(zj),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(Vj),this.ctx.query.structure.registry.remove(Hj)},t}(Dr.Handler),params:function(){return{autoAttach:T.Boolean(!1),showTooltip:T.Boolean(!0)}}});function c$e(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=Ns.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Ns.descriptor))return;for(var r=e.structure.root.serialMapping.getSerialIndex,n=t.area,a=t.serialResidueIndex,i=new Set,o=0,s=function(v,p){var g=p.elements;Fe.forEach(v,function(m){var y=a[r(p,g[m])];y!==-1&&!i.has(y)&&(o+=n[y],i.add(y))})},u=0,l=e.elements;u<l.length;u++){var c=l[u],d=c.indices,f=c.unit;s(d,f)}if(i.size===0)return;var h="<small>("+i.size+" "+(i.size>1?"Residues sum":"Residue")+")</small>";return"Accessible Surface Area "+h+": "+o.toFixed(2)+" Å<sup>2</sup>"}else if(e.kind==="structure-loci"){var t=Ns.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Ns.descriptor)?void 0:"Accessible Surface Area <small>(Whole Structure)</small>: "+Yy(t.area).toFixed(2)+" Å<sup>2</sup>"}}var Vj=jr("Buried Protein Residues",ue.struct.modifier.union([ue.struct.modifier.wholeResidues([ue.struct.modifier.union([ue.struct.generator.atomGroups({"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":TO.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:Ur.Residue,ensureCustomProperties:function(e,t){return Ns.attach(e,t)}}),Hj=jr("Accessible Protein Residues",ue.struct.modifier.union([ue.struct.modifier.wholeResidues([ue.struct.modifier.union([ue.struct.generator.atomGroups({"chain-test":ue.core.rel.eq([ue.ammp("objectPrimitive"),"atomistic"]),"residue-test":TO.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:Ur.Residue,ensureCustomProperties:function(e,t){return Ns.attach(e,t)}}),d$e=Dr.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Wn,r.labelProvider={label:function(n){if(r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var a=[],i=r.getStructures(n.structure),o=0,s=i;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(l){var c=Oe.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Fe.size(d.indices)===1){var f=l.unitsFeatures.get(d.unit.id);if(f){for(var h=[],v=[],p=[],g=Fe.start(d.indices),m=f.types,y=f.groups,b=f.elementsIndex,S=b.indices,x=b.offsets,C=x[g],w=x[g+1];C<w;++C){var A=S[C],I=m[A],D=y[A];I&&h.push(_Ve(I)),D&&v.push(wVe(D))}h.length&&p.push("<small>Types</small> "+h.join(", ")),v.length&&p.push("<small>Groups</small> "+v.join(", ")),p.length&&a.push("Interaction Feature: "+p.join(" | "))}}}}}return a.length?a.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var i=this.ctx.state.data,o=i.select(ir.Generators.ofType(ge.Molecule.Structure,a.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&Di(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(ID),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(I_)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(ID),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(I_)},t}(Dr.Handler),params:function(){return{autoAttach:T.Boolean(!1),showTooltip:T.Boolean(!0)}}}),f$e=Dr.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Ol,r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach;return this.params.autoAttach=r.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)},t}(Dr.Handler),params:function(){return{autoAttach:T.Boolean(!1)}}}),h$e=Dr.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=jb,r.labelProvider={label:function(n){if(r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var a=[],i=r.getStructures(n.structure),o=0,s=i;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(l){var c=Oe.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Fe.size(d.indices)===1){var f=l.get(d.unit.id);if(f){var h=Fe.start(d.indices),v=f.charge[h],p=f.idealGeometry[h],g=f.implicitH[h],m=f.totalH[h];a.push("Valence Model: <small>Charge</small> "+v+" | <small>Ideal Geometry</small> "+mVe(p)+" | <small>Implicit H</small> "+g+" | <small>Total H</small> "+m)}}}}}return a.length?a.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var i=this.ctx.state.data,o=i.select(ir.Generators.ofType(ge.Molecule.Structure,a.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&Di(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Dr.Handler),params:function(){return{autoAttach:T.Boolean(!1),showTooltip:T.Boolean(!0)}}}),ku;(function(e){var t=this;e.Provider=Xp.createProvider({label:"Best Database Sequence Mapping",descriptor:Po({name:"molstar_best_database_sequence_mapping"}),type:"static",defaultParams:{},getParams:function(){return{}},isApplicable:function(i){var o,s;return nn.is(i.sourceData)&&((s=(o=i.sourceData.data.frame.categories)===null||o===void 0?void 0:o.atom_site)===null||s===void 0?void 0:s.fieldNames.indexOf("db_name"))>=0},obtain:function(i,o){return de(t,void 0,void 0,function(){return fe(this,function(s){return[2,{value:a(o)}]})})}});function r(i){var o=i.unit.model,s=e.Provider.get(o).value;if(!s)return"";var u=i.unit.elements[i.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u];return s.accession[l]}e.getKey=r;function n(i){var o=i.unit.model,s=e.Provider.get(o).value;if(s){var u=i.unit.elements[i.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u],c=s.dbName[l];if(c)return c+" "+s.accession[l]+" "+s.num[l]+" "+s.residue[l]}}e.getLabel=n;function a(i){if(nn.is(i.sourceData)){var o=i.sourceData.data.frame.categories.atom_site,s=o.getField("db_name"),u=o.getField("db_acc"),l=o.getField("db_num"),c=o.getField("db_res");if(!(!s||!u||!l||!c)){for(var d=i.atomicHierarchy.atomSourceIndex,f=i.atomicHierarchy.residueAtomSegments,h=f.count,v=f.offsets,p=new Array(h),g=new Array(h),m=new Array(h),y=new Array(h),b=0;b<h;b++){var S=d.value(v[b]);if(s.valueKind(S)!==0){p[S]="",g[S]="",m[S]=0,y[S]="";continue}p[S]=s.str(S),g[S]=u.str(S),m[S]=l.int(S),y[S]=c.str(S)}return{dbName:p,accession:g,num:m,residue:y}}}}})(ku||(ku={}));var fT=dt(16448250),p$e="Assigns a color based on best dababase sequence mapping.",$0=new Map,xee=E({},ds({type:"colors",colorList:"set-1"}));function v$e(e){return xee}function See(e,t){var r;if(e.structure){for(var n=0,a=e.structure.models;n<a.length;n++){var i=a[n],o=ku.Provider.get(i).value;if(o)for(var s=0,u=o.accession;s<u.length;s++){var l=u[s];!l||$0.has(l)||$0.set(l,$0.size)}}var c=at.create(e.structure),d=eu($0.size+1,t,{valueLabel:function(v){return""+v}}),f=new Map,h=function(v){var p=ku.getKey(v);if(!p)return fT;if(f.has(p))return f.get(p);var g=d.color($0.get(p));return f.set(p,g),g};r=function(v){return at.is(v)&&We.isAtomic(v.unit)?h(v):Gt.isLocation(v)?(c.unit=v.aUnit,c.element=v.aUnit.elements[v.aIndex],h(c)):fT}}else r=function(){return fT};return{factory:See,granularity:"group",preferSmoothing:!0,color:r,props:t,description:p$e}}var Gj={name:"best-sequence-database-mapping",label:"Best Database Sequence Mapping",category:"Residue Property",factory:See,getParams:v$e,defaultValues:T.getDefaultValues(xee),isApplicable:function(e){var t;return!!(!((t=e.structure)===null||t===void 0)&&t.models.some(function(r){return ku.Provider.isApplicable(r)}))},ensureCustomProperties:{attach:function(e,t){return de(void 0,void 0,void 0,function(){var r,n,a;return fe(this,function(i){switch(i.label){case 0:if(!t.structure)return[2];r=0,n=t.structure.models,i.label=1;case 1:return r<n.length?(a=n[r],[4,ku.Provider.attach(e,a,void 0,!0)]):[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},detach:function(e){if(e.structure)for(var t=0,r=e.structure.models;t<r.length;t++){var n=r[t];ku.Provider.ref(n,!1)}}}},m$e=Dr.create({name:"best-sequence-database-mapping-prop",category:"custom-props",display:{name:"Best Database Sequence Mapping"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=ku.Provider,r.labelProvider={label:function(n){if(r.params.showTooltip)return g$e(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Gj),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Gj),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Dr.Handler),params:function(){return{autoAttach:T.Boolean(!0),showTooltip:T.Boolean(!0)}}});function g$e(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=e.elements[0],r=t.unit,n=at.create(e.structure,r,r.elements[Fe.getAt(t.indices,0)]);return ku.getLabel(n)}}var td;(function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=ju.create(e.Descriptor);function t(r,n){var a={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},i={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function o(v,p,g){var m=v.get(p);m?m.push(g):v.set(p,[g])}function s(v,p){var g=p.entity_id.value(v),m=p.asym_id.value(v),y=p.seq_id.value(v);if(r.model_granularity.value(v)==="by-atom"){var b=n.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:m,label_atom_id:p.atom_id.value(v),label_entity_id:g});b>=0&&o(l,b,v)}else if(n.coarseHierarchy.isDefined){var S=n.coarseHierarchy.spheres.findSequenceKey(g,m,y);if(S>=0)o(c,S,v);else{var x=n.coarseHierarchy.gaussians.findSequenceKey(g,m,y);x>=0&&o(d,x,v)}}}function u(v){switch(v){case 0:return l;case 1:return c;case 2:return d}}for(var l=new Map,c=new Map,d=new Map,f=[],h=0;h<r._rowCount;++h)s(h,a),s(h,i);return{getIndicesByElement:function(v,p){var g=u(p),m=g.get(v);return m!==void 0?m:f},data:r}}e.fromTable=t})(td||(td={}));var y$e=[];function qj(e,t,r,n){return e+"|"+t.id+"|"+r+"|"+n.id}var Wj=function(){function e(t){this.pairs=t;var r=new Map;this.pairs.forEach(function(n,a){var i=qj(n.indexA,n.unitA,n.indexB,n.unitB),o=r.get(i);o?o.push(a):r.set(i,[a])}),this.count=t.length,this.pairKeyIndices=r}return e.prototype.getPairIndices=function(t,r,n,a){var i=qj(t,r,n,a);return this.pairKeyIndices.get(i)||y$e},e.prototype.getPairs=function(t,r,n,a){var i=this,o=this.getPairIndices(t,r,n,a);return o.map(function(s){return i.pairs[s]})},e}(),rd=th.createProvider({label:"Cross Link Restraint",descriptor:Po({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:function(e){return{}},isApplicable:function(e){return e.models.some(function(t){return!!td.Provider.get(t)})},obtain:function(e,t,r){return de(void 0,void 0,void 0,function(){return fe(this,function(n){return[2,{value:S$e(t)}]})})}}),Ou;(function(e){(function(v){v.CrossLinkRestraint="cross-link-restraint"})(e.Tag||(e.Tag={}));function t(v){return v.models.some(function(p){return!!td.Provider.get(p)})}e.isApplicable=t;var r=_(),n=_();function a(v){return v.unitA.conformation.position(v.unitA.elements[v.indexA],r),v.unitB.conformation.position(v.unitB.elements[v.indexB],n),_.distance(r,n)}e.distance=a;function i(v,p,g){return bY("cross-link-restraints",{structure:p,crossLinkRestraints:v},g)}e.Location=i;function o(v){return!!v&&v.kind==="data-location"&&v.tag==="cross-link-restraints"}e.isLocation=o;function s(v,p){return v.data.structure===p.data.structure&&v.data.crossLinkRestraints===p.data.crossLinkRestraints&&v.element===p.element}e.areLocationsEqual=s;function u(v,p){var g=v.pairs[p];return"Cross Link Restraint | Type: "+g.restraintType+" | Threshold: "+g.distanceThreshold+" Å | Psi: "+g.psi+" | Sigma 1: "+g.sigma1+" | Sigma 2: "+g.sigma2+" | Distance: "+a(g).toFixed(2)+" Å"}function l(v){return u(v.data.crossLinkRestraints,v.element)}e.locationLabel=l;function c(v,p,g){return F3("cross-link-restraints",{structure:v,crossLinkRestraints:p},g,function(m){return f(p,g,m)},function(){return h(v,p,g)})}e.Loci=c;function d(v){return!!v&&v.kind==="data-loci"&&v.tag==="interactions"}e.isLoci=d;function f(v,p,g){return Yc.fromPairProvider(p.length,function(m,y,b){var S=v.pairs[p[m]];S.unitA.conformation.position(S.unitA.elements[S.indexA],y),S.unitB.conformation.position(S.unitB.elements[S.indexB],b)},g)}e.getBoundingSphere=f;function h(v,p,g){var m=g[0];if(m===void 0)return"";var y=p.pairs[m];return[u(p,m),lO(Gt.Location(v,y.unitA,y.indexA,v,y.unitB,y.indexB))].join("</br>")}e.getLabel=h})(Ou||(Ou={}));function $j(e,t,r){for(var n=t.elements,a=n.length,i=t.kind,o=function(u){var l=n[u];r.getIndicesByElement(l,i).forEach(function(c){return e.set(c,u)})},s=0;s<a;s++)o(s)}function b$e(e,t,r){if(t.model===r.model&&t.model.sourceData.kind==="mmCIF"){var n=td.Provider.get(t.model);if(n){var a=new Map,i=new Map;$j(a,t,n),$j(i,r,n),a.forEach(function(o,s){var u=i.get(s);u!==void 0&&e.push(k_(t,o,r,u,n,s),k_(r,u,t,o,n,s))})}}}function x$e(e,t){if(t.model.sourceData.kind==="mmCIF"){var r=td.Provider.get(t.model);if(r){for(var n=t.elements,a=n.length,i=t.kind,o=new Map,s=function(l){var c=n[l];r.getIndicesByElement(c,i).forEach(function(d){var f=o.get(d);f?f.push(l):o.set(d,[l])})},u=0;u<a;u++)s(u);o.forEach(function(l,c){if(!(l.length<2)){var d=l[0],f=l[1];e.push(k_(t,d,t,f,r,c),k_(t,f,t,d,r,c))}})}}}function k_(e,t,r,n,a,i){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:a.data.restraint_type.value(i),distanceThreshold:a.data.distance_threshold.value(i),psi:a.data.psi.value(i),sigma1:a.data.sigma_1.value(i),sigma2:a.data.sigma_2.value(i)}}function S$e(e){var t=[];if(!e.models.some(function(s){return td.Provider.get(s)}))return new Wj(t);for(var r=e.units.length,n=0;n<r;++n){var a=e.units[n];x$e(t,a);for(var i=n+1;i<r;++i){var o=e.units[i];a.model===o.model&&b$e(t,a,o)}}return new Wj(t)}function C$e(e,t,r,n,a){var i=rd.get(t).value;if(!i.count)return Ft.createEmpty(a);var o=n.sizeFactor,s=at.create(t),u={linkCount:i.count,position:function(l,c,d){var f=i.pairs[d],h=f.unitA,v=f.unitB;h.conformation.position(h.elements[f.indexA],l),v.conformation.position(v.elements[f.indexB],c)},radius:function(l){var c=i.pairs[l];return s.unit=c.unitA,s.element=c.unitA.elements[c.indexA],r.size.size(s)*o}};return _v(e,u,n,a)}var Cee=E(E(E({},Ub),Cv),{sizeFactor:T.Numeric(.5,{min:0,max:10,step:.1})});function _$e(e){return xv({defaultProps:T.getDefaultValues(Cee),createGeometry:C$e,createLocationIterator:w$e,getLoci:E$e,eachLocation:A$e,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function w$e(e){var t=rd.get(e).value,r=t.pairs,n=r.length,a=1,i=Ou.Location(t,e),o=function(s){return i.element=s,i};return bn(n,a,1,o,!0)}function E$e(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=rd.get(t).value,o=i.pairs[a];if(o)return Ou.Loci(t,i,[a])}return Or}function A$e(e,t,r){var n=!1;if(Ou.isLoci(e)){if(!tt.areEquivalent(e.data.structure,t))return!1;var a=rd.get(t).value;if(e.data.crossLinkRestraints!==a)return!1;for(var i=0,o=e.elements;i<o.length;i++){var s=o[i];r(Re.ofSingleton(s))&&(n=!0)}}return n}var P$e={"cross-link-restraint":function(e,t){return Du("Cross-link restraint",e,t,_$e)}},_ee=E({},Cee);function T$e(e,t){return T.clone(_ee)}function I$e(e,t){return sr.createMulti("CrossLinkRestraint",e,t,Ba,P$e)}var Xj={name:Ou.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:I$e,getParams:T$e,defaultValues:T.getDefaultValues(_ee),defaultColorTheme:{name:Ou.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return Ou.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return rd.attach(e,t,void 0,!0)},detach:function(e){return rd.ref(e,!1)}}},Yj=dt(13421772),M$e="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",wee={domain:T.Interval([.5,1.5],{step:.01}),list:T.ColorList("red-grey",{presetKind:"scale"})};function D$e(e){return wee}function Eee(e,t){var r,n=void 0,a=e.structure&&rd.get(e.structure).value;if(a){n=Fu.create({domain:t.domain,listOrName:t.list.colors});var i=n.color;r=function(o){if(Ou.isLocation(o)){var s=a.pairs[o.element];if(s)return i(Ou.distance(s)/s.distanceThreshold)}return Yj}}else r=function(){return Yj};return{factory:Eee,granularity:"group",color:r,props:t,description:M$e,legend:n?n.legend:void 0}}var Kj={name:"cross-link",label:"Cross Link",category:"Miscellaneous",factory:Eee,getParams:D$e,defaultValues:T.getDefaultValues(wee),isApplicable:function(e){return!!e.structure&&Ou.isApplicable(e.structure)},ensureCustomProperties:{attach:function(e,t){return t.structure?rd.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&rd.ref(e.structure,!1)}}},R$e=Dr.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=td.Provider,r}return t.prototype.register=function(){this.provider.formatRegistry.add("mmCIF",k$e),this.ctx.representation.structure.themes.colorThemeRegistry.add(Kj),this.ctx.representation.structure.registry.add(Xj)},t.prototype.unregister=function(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Kj),this.ctx.representation.structure.registry.remove(Xj)},t}(Dr.Handler)});function k$e(e){if(nn.is(e.sourceData)){var t=e.sourceData.data.db.ihm_cross_link_restraint;if(t._rowCount!==0)return td.fromTable(t,e)}}const O$e=Object.freeze(Object.defineProperty({__proto__:null,AccessibleSurfaceArea:l$e,BestDatabaseSequenceMapping:m$e,CrossLinkRestraint:R$e,Interactions:d$e,SecondaryStructure:f$e,StructureInfo:e$e,ValenceModel:h$e},Symbol.toStringTag,{value:"Module"}));var mx={State:HGe,Representation:qGe,Camera:$Ge,Misc:UWe},Fo={Representation:XWe,Camera:JWe,CustomProps:O$e},L$e=function(e){var t=st.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:T.Numeric(5,{min:1,max:10,step:1}),targetParams:T.Group(t,{label:"Target",customDefault:CS(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.26,alpha:.51}})}),surroundingsParams:T.Group(t,{label:"Surroundings",customDefault:CS(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16}})}),nciParams:T.Group(t,{label:"Non-covalent Int.",customDefault:CS(e,void 0,{type:I_,color:ID,size:Ya.BuiltIn.uniform})}),components:T.MultiSelect(Qj,T.arrayToOptions(Qj)),excludeTargetFromSurroundings:T.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:T.Boolean(!1)}},Qj=["target","surroundings","interactions"],ln;(function(e){e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr"})(ln||(ln={}));var N$e=new Set([ln.TargetSel,ln.TargetRepr,ln.SurrSel,ln.SurrRepr,ln.SurrNciRepr]),F$e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.currentSource=void 0,r}return Object.defineProperty(t.prototype,"surrLabel",{get:function(){return"[Focus] Surroundings ("+this.params.expandRadius+" Å)"},enumerable:!1,configurable:!0}),t.prototype.getReprParams=function(r){return E(E({},this.params.targetParams),{type:{name:r.type.name,params:E(E({},r.type.params),{ignoreHydrogens:this.params.ignoreHydrogens})}})},t.prototype.ensureShape=function(r){var n,a=this.plugin.state.data,i=a.tree,o=a.build(),s=ir.findUniqueTagsInSubtree(i,r.transform.ref,N$e);s[ln.TargetSel]||(s[ln.TargetSel]=o.to(r).apply(st.Model.StructureSelectionFromBundle,{bundle:en.Empty,label:"[Focus] Target"},{tags:ln.TargetSel}).ref),s[ln.SurrSel]||(s[ln.SurrSel]=o.to(r).apply(st.Model.StructureSelectionFromExpression,{expression:ue.struct.generator.empty(),label:this.surrLabel},{tags:ln.SurrSel}).ref);var u=this.params.components;return u.indexOf("target")>=0&&!s[ln.TargetRepr]&&(s[ln.TargetRepr]=o.to(s[ln.TargetSel]).apply(st.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:ln.TargetRepr}).ref),u.indexOf("surroundings")>=0&&!s[ln.SurrRepr]&&(s[ln.SurrRepr]=o.to(s[ln.SurrSel]).apply(st.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:ln.SurrRepr}).ref),u.indexOf("interactions")>=0&&!s[ln.SurrNciRepr]&&r.obj&&I_.isApplicable((n=r.obj)===null||n===void 0?void 0:n.data)&&(s[ln.SurrNciRepr]=o.to(s[ln.SurrSel]).apply(st.Representation.StructureRepresentation3D,this.params.nciParams,{tags:ln.SurrNciRepr}).ref),{state:a,builder:o,refs:s}},t.prototype.clear=function(r){var n=this.plugin.state.data;this.currentSource=void 0;var a=n.select(ir.Generators.byRef(r).subtree().withTag(ln.TargetSel)),i=n.select(ir.Generators.byRef(r).subtree().withTag(ln.SurrSel));if(!(a.length===0&&i.length===0)){for(var o=n.build(),s=en.Empty,u=0,l=a;u<l.length;u++){var c=l[u];o.to(c).update(st.Model.StructureSelectionFromBundle,function(p){return E(E({},p),{bundle:s})})}for(var d=ue.struct.generator.empty(),f=0,h=i;f<h.length;f++){var v=h[f];o.to(v).update(st.Model.StructureSelectionFromExpression,function(p){return E(E({},p),{expression:d})})}return wt.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}},t.prototype.focus=function(r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h=this;return fe(this,function(v){switch(v.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),!n||!n.obj?[2]:(this.currentSource=r,a=Oe.remap(r,n.obj.data),i=Oe.extendToWholeResidues(a),o=en.fromLoci(i),s=en.toExpression(o),u=ue.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0}),this.params.excludeTargetFromSurroundings&&(u=ue.struct.modifier.exceptBy({0:u,by:s})),l=this.ensureShape(n),c=l.state,d=l.builder,f=l.refs,d.to(f[ln.TargetSel]).update(st.Model.StructureSelectionFromBundle,function(p){return E(E({},p),{bundle:o})}),d.to(f[ln.SurrSel]).update(st.Model.StructureSelectionFromExpression,function(p){return E(E({},p),{expression:u,label:h.surrLabel})}),[4,wt.State.Update(this.plugin,{state:c,tree:d,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})]);case 1:return v.sent(),[2]}})})},t.prototype.register=function(r){var n=this;this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(a){a?n.focus(a.loci):n.clear(cr.RootRef)})},t.prototype.update=function(r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,p,d,f,p,h,v,p;return fe(this,function(g){switch(g.label){case 0:if(n=this.params,this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),[2,!0];for(a=this.plugin.state.data,i=a.build(),o=ir.Generators.root.subtree(),s=this.params.components,u=s.indexOf("target")>=0,l=0,c=a.select(o.withTag(ln.TargetRepr));l<c.length;l++)p=c[l],u?i.to(p).update(this.getReprParams(this.params.targetParams)):i.delete(p.transform.ref);for(u=s.indexOf("surroundings")>=0,d=0,f=a.select(o.withTag(ln.SurrRepr));d<f.length;d++)p=f[d],u?i.to(p).update(this.getReprParams(this.params.surroundingsParams)):i.delete(p.transform.ref);for(u=s.indexOf("interactions")>=0,h=0,v=a.select(o.withTag(ln.SurrNciRepr));h<v.length;h++)p=v[h],u?i.to(p).update(this.params.nciParams):i.delete(p.transform.ref);return[4,wt.State.Update(this.plugin,{state:a,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})];case 1:return g.sent(),r.expandRadius!==n.expandRadius?(this.currentSource&&this.focus(this.currentSource),[2,!0]):[2,!0]}})})},t}(Dr.WithSubscribers),IO=Dr.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:F$e,params:function(e,t){return L$e(t)}});function no(e){return e}(function(e){e.CommonParams={ignoreHydrogens:T.Optional(T.Boolean(!1)),quality:T.Optional(T.Select("auto",kk)),theme:T.Optional(T.Group({globalName:T.Optional(T.Text("")),carbonColor:T.Optional(T.Select("chain-id",T.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:T.Optional(T.Text("")),focus:T.Optional(T.Group({name:T.Optional(T.Text("")),params:T.Optional(T.Value({}))}))}))};function t(i){return i==="chain-id"?{name:i,params:HQ.defaultValues}:i==="operator-name"?{name:i,params:sO.defaultValues}:{name:i,params:{}}}function r(i){return i.units.some(function(o){return!o.conformation.operator.assembly&&o.conformation.operator.spgrOp>=0})}function n(i,o,s){var u,l,c,d,f,h,v=i.state.data.build(),p=i.builders.structure.representation,g={quality:i.managers.structure.component.state.options.visualQuality,ignoreHydrogens:!i.managers.structure.component.state.options.showHydrogens};o.quality&&o.quality!=="auto"&&(g.quality=o.quality),o.ignoreHydrogens!==void 0&&(g.ignoreHydrogens=!!o.ignoreHydrogens);var m=!((u=o.theme)===null||u===void 0)&&u.globalName?(l=o.theme)===null||l===void 0?void 0:l.globalName:void 0,y=((c=o.theme)===null||c===void 0?void 0:c.carbonColor)!==void 0?{carbonColor:t((d=o.theme)===null||d===void 0?void 0:d.carbonColor)}:{},b=s&&(!((f=o.theme)===null||f===void 0)&&f.symmetryColor)&&r(s)?(h=o.theme)===null||h===void 0?void 0:h.symmetryColor:m;return{update:v,builder:p,color:m,symmetryColor:b,typeParams:g,ballAndStickColor:y}}e.reprBuilder=n;function a(i,o,s,u){return i.state.updateBehavior(IO,function(l){var c=MD(i,o,"ball-and-stick",s||"element-symbol",u);l.surroundingsParams.colorTheme=c,l.targetParams.colorTheme=c})}e.updateFocusRepr=a})(no||(no={}));var l0=no.CommonParams,Vb=no.reprBuilder,tE=no.updateFocusRepr,B$e=no({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:function(){return l0},apply:function(e,t,r){var n,a,i=(a=(n=La.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!i)return{};var o=r.config.get($r.Structure.SizeThresholds)||tt.DefaultSizeThresholds,s=tt.getSize(i,o),u=i.polymerResidueCount/i.polymerGapCount;switch(s){case tt.Size.Gigantic:case tt.Size.Huge:return Pee.apply(e,t,r);case tt.Size.Large:return Tee.apply(e,t,r);case tt.Size.Medium:if(u>3)return Aee.apply(e,t,r);case tt.Size.Small:return Iee.apply(e,E(E({},t),{showCarbohydrateSymbol:!0}),r);default:bD()}}}),U$e=no({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:function(e,t,r){return de(this,void 0,void 0,function(){return fe(this,function(n){return[2,{}]})})}}),Hb="Basic",Aee=no({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:Hb,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:function(){return l0},apply:function(e,t,r){var n,a,i,o,s,u,l,c,d,f;return de(this,void 0,void 0,function(){var h,v,p,g,m,y,b,S,x,C,w,A,I,D,k;return fe(this,function(R){switch(R.label){case 0:return h=La.resolveAndCheck(r.state.data,e),h?(k={},[4,jo(r,h,"polymer")]):[2,{}];case 1:return k.polymer=R.sent(),[4,jo(r,h,"ligand")];case 2:return k.ligand=R.sent(),[4,jo(r,h,"non-standard")];case 3:return k.nonStandard=R.sent(),[4,jo(r,h,"branched",{label:"Carbohydrate"})];case 4:return k.branched=R.sent(),[4,jo(r,h,"water")];case 5:return k.water=R.sent(),[4,jo(r,h,"ion")];case 6:return k.ion=R.sent(),[4,jo(r,h,"lipid")];case 7:return k.lipid=R.sent(),[4,jo(r,h,"coarse")];case 8:return v=(k.coarse=R.sent(),k),p=h.obj.data,g={sizeFactor:p.isCoarseGrained?.8:.2},m=(((i=(a=(n=v.water)===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data)===null||i===void 0?void 0:i.elementCount)||0)>5e4?"line":"ball-and-stick",y=(((u=(s=(o=v.lipid)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data)===null||u===void 0?void 0:u.elementCount)||0)>2e4?"line":"ball-and-stick",b=Vb(r,t,p),S=b.update,x=b.builder,C=b.typeParams,w=b.color,A=b.symmetryColor,I=b.ballAndStickColor,D={polymer:x.buildRepresentation(S,v.polymer,{type:"cartoon",typeParams:E(E({},C),g),color:A},{tag:"polymer"}),ligand:x.buildRepresentation(S,v.ligand,{type:"ball-and-stick",typeParams:C,color:w,colorParams:I},{tag:"ligand"}),nonStandard:x.buildRepresentation(S,v.nonStandard,{type:"ball-and-stick",typeParams:C,color:w,colorParams:I},{tag:"non-standard"}),branchedBallAndStick:x.buildRepresentation(S,v.branched,{type:"ball-and-stick",typeParams:E(E({},C),{alpha:.3}),color:w,colorParams:I},{tag:"branched-ball-and-stick"}),branchedSnfg3d:x.buildRepresentation(S,v.branched,{type:"carbohydrate",typeParams:C,color:w},{tag:"branched-snfg-3d"}),water:x.buildRepresentation(S,v.water,{type:m,typeParams:E(E({},C),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"water"}),ion:x.buildRepresentation(S,v.ion,{type:"ball-and-stick",typeParams:C,color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"ion"}),lipid:x.buildRepresentation(S,v.lipid,{type:y,typeParams:E(E({},C),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"lipid"}),coarse:x.buildRepresentation(S,v.coarse,{type:"spacefill",typeParams:C,color:w||"chain-id"},{tag:"coarse"})},[4,S.commit({revertOnError:!1})];case 9:return R.sent(),[4,tE(r,p,(c=(l=t.theme)===null||l===void 0?void 0:l.focus)===null||c===void 0?void 0:c.name,(f=(d=t.theme)===null||d===void 0?void 0:d.focus)===null||f===void 0?void 0:f.params)];case 10:return R.sent(),[2,{components:v,representations:D}]}})})}}),j$e=no({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:Hb,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:function(){return l0},apply:function(e,t,r){var n,a,i,o;return de(this,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,g,m,y;return fe(this,function(b){switch(b.label){case 0:return s=La.resolveAndCheck(r.state.data,e),s?(y={},[4,Zj(r,s,"protein")]):[2,{}];case 1:return y.protein=b.sent(),[4,Zj(r,s,"nucleic")];case 2:return u=(y.nucleic=b.sent(),y),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d={radiusOffset:l.isCoarseGrained?2:0,smoothness:l.isCoarseGrained?1:1.5},f=Vb(r,t,l),h=f.update,v=f.builder,p=f.typeParams,g=f.symmetryColor,m={protein:v.buildRepresentation(h,u.protein,{type:"cartoon",typeParams:E(E({},p),c),color:g},{tag:"protein"}),nucleic:v.buildRepresentation(h,u.nucleic,{type:"gaussian-surface",typeParams:E(E({},p),d),color:g},{tag:"nucleic"})},[4,h.commit({revertOnError:!0})];case 3:return b.sent(),[4,tE(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:m}]}})})}}),Pee=no({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:Hb,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:function(){return l0},apply:function(e,t,r){var n,a,i,o;return de(this,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,g,m,y;return fe(this,function(b){switch(b.label){case 0:return s=La.resolveAndCheck(r.state.data,e),s?(y={},[4,jo(r,s,"polymer")]):[2,{}];case 1:return y.polymer=b.sent(),[4,jo(r,s,"lipid")];case 2:return u=(y.lipid=b.sent(),y),l=s.obj.data,c=tt.getSize(l),d=Object.create(null),c===tt.Size.Gigantic?Object.assign(d,{traceOnly:!l.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):c===tt.Size.Huge?Object.assign(d,{radiusOffset:l.isCoarseGrained?2:0,smoothness:1}):l.isCoarseGrained&&Object.assign(d,{radiusOffset:2,smoothness:1}),f=Vb(r,t,l),h=f.update,v=f.builder,p=f.typeParams,g=f.symmetryColor,m={polymer:v.buildRepresentation(h,u.polymer,{type:"gaussian-surface",typeParams:E(E({},p),d),color:g},{tag:"polymer"}),lipid:v.buildRepresentation(h,u.lipid,{type:"gaussian-surface",typeParams:E(E({},p),d),color:g},{tag:"lipid"})},[4,h.commit({revertOnError:!0})];case 3:return b.sent(),[4,tE(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:m}]}})})}}),Tee=no({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:Hb,description:"Shows polymers as Cartoon."},params:function(){return l0},apply:function(e,t,r){var n,a,i,o;return de(this,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,g,m;return fe(this,function(y){switch(y.label){case 0:return s=La.resolveAndCheck(r.state.data,e),s?(m={},[4,jo(r,s,"polymer")]):[2,{}];case 1:return u=(m.polymer=y.sent(),m),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d=Vb(r,t,l),f=d.update,h=d.builder,v=d.typeParams,p=d.symmetryColor,g={polymer:h.buildRepresentation(f,u.polymer,{type:"cartoon",typeParams:E(E({},v),c),color:p},{tag:"polymer"})},[4,f.commit({revertOnError:!0})];case 2:return y.sent(),[4,tE(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 3:return y.sent(),[2,{components:u,representations:g}]}})})}}),Iee=no({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:Hb,description:"Shows everything in atomic detail with Ball & Stick."},params:function(){return E(E({},l0),{showCarbohydrateSymbol:T.Boolean(!1)})},apply:function(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C,w,A;return fe(this,function(I){switch(I.label){case 0:return n=La.resolveAndCheck(r.state.data,e),n?(w={},[4,jo(r,n,"all")]):[2,{}];case 1:return a=(w.all=I.sent(),w.branched=void 0,w),i=n.obj.data,o=i.elementCount>1e5,s=i.atomicResidueCount&&i.elementCount>1e3&&i.atomicResidueCount/i.elementCount<3,u=i.models[0],l=!!gi.Provider.get(u)||kl.isExhaustive(u),c="ball-and-stick",i.isCoarseGrained?c=i.elementCount>1e6?"point":"spacefill":s&&!l?c="spacefill":o&&(c="line"),d=t.showCarbohydrateSymbol&&!o&&!s,d?(h=(f=Object).assign,v=[a],A={},[4,jo(r,n,"branched",{label:"Carbohydrate"})]):[3,3];case 2:h.apply(f,v.concat([(A.branched=I.sent(),A)])),I.label=3;case 3:return p=Vb(r,t,i),g=p.update,m=p.builder,y=p.typeParams,b=p.color,S=p.ballAndStickColor,x=s&&!l?{carbonColor:{name:"element-symbol",params:{}}}:S,C={all:m.buildRepresentation(g,a.all,{type:c,typeParams:y,color:b,colorParams:x},{tag:"all"})},d&&Object.assign(C,{snfg3d:m.buildRepresentation(g,a.branched,{type:"carbohydrate",typeParams:E(E({},y),{alpha:.4,visuals:["carbohydrate-symbol"]}),color:b},{tag:"snfg-3d"})}),[4,g.commit({revertOnError:!0})];case 4:return I.sent(),[2,{components:a,representations:C}]}})})}});function jo(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function Zj(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,ma[r],"selection-"+r,n)}var Zm={empty:U$e,auto:B$e,"atomic-detail":Iee,"polymer-cartoon":Tee,"polymer-and-ligand":Aee,"protein-and-nucleic":j$e,"coarse-surface":Pee};function MO(e,t){if(e.ext==="bcif")try{if(YY(t).encoder.startsWith("VolumeServer"))return"dscif"}catch{}else if(e.ext==="cif"){var r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}var Ad="Trajectory";function Pd(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var z$e={label:"mmCIF",description:"mmCIF",category:Ad,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?MO(e,t)===-1:!1},parse:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a,i,o,s;return fe(this,function(u){switch(u.label){case 0:return n=e.state.data,a=n.build().to(t).apply(st.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,a.apply(st.Model.TrajectoryFromMmCif,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),(((s=(o=a.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:Pd},V$e={label:"cifCore",description:"CIF Core",category:Ad,stringExtensions:["cif"],isApplicable:function(e,t){return e.ext==="cif"?MO(e,t)==="coreCif":!1},parse:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a,i,o,s;return fe(this,function(u){switch(u.label){case 0:return n=e.state.data,a=n.build().to(t).apply(st.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,a.apply(st.Model.TrajectoryFromCifCore,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),(((s=(o=a.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:Pd};function wv(e,t){var r=this;return function(n,a,i){return de(r,void 0,void 0,function(){var o,s;return fe(this,function(u){switch(u.label){case 0:return o=n.state.data,[4,o.build().to(a).apply(e,t,{tags:i==null?void 0:i.trajectoryTags}).commit({revertOnError:!0})];case 1:return s=u.sent(),[2,{trajectory:s}]}})})}}var H$e={label:"PDB",description:"PDB",category:Ad,stringExtensions:["pdb","ent"],parse:wv(st.Model.TrajectoryFromPDB),visuals:Pd},G$e={label:"PDBQT",description:"PDBQT",category:Ad,stringExtensions:["pdbqt"],parse:wv(st.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:Pd},q$e={label:"XYZ",description:"XYZ",category:Ad,stringExtensions:["xyz"],parse:wv(st.Model.TrajectoryFromXYZ),visuals:Pd},W$e={label:"GRO",description:"GRO",category:Ad,stringExtensions:["gro"],binaryExtensions:[],parse:wv(st.Model.TrajectoryFromGRO),visuals:Pd},$$e={label:"MOL",description:"MOL",category:Ad,stringExtensions:["mol"],parse:wv(st.Model.TrajectoryFromMOL),visuals:Pd},X$e={label:"SDF",description:"SDF",category:Ad,stringExtensions:["sdf","sd"],parse:wv(st.Model.TrajectoryFromSDF),visuals:Pd},Y$e={label:"MOL2",description:"MOL2",category:Ad,stringExtensions:["mol2"],parse:wv(st.Model.TrajectoryFromMOL2),visuals:Pd},Mee=[["mmcif",z$e],["cifCore",V$e],["pdb",H$e],["pdbqt",G$e],["gro",W$e],["xyz",q$e],["mol",$$e],["sdf",X$e],["mol2",Y$e]],K$e=function(e){return T.Group({type:wp.getParams(void 0,"auto").type,representation:T.Select(Zm.auto.id,e.builders.structure.representation.getPresets().map(function(t){return[t.id,t.display.name,t.display.group]}),{description:"Which representation preset to use."}),representationParams:T.Group(no.CommonParams,{isHidden:!0}),asTrajectory:T.Optional(T.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},DO={rcsb:T.Group({encoding:T.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{label:"RCSB PDB",isFlat:!0}),pdbe:T.Group({variant:T.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0})},VD=Ao.build({from:ge.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:function(e,t){var r=K$e(t),n=t.config.get($r.Download.DefaultPdbProvider)||"pdbe";return{source:T.MappedStatic("pdb",{pdb:T.Group({provider:T.Group({id:T.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:T.MappedStatic(n,DO)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":T.Group({provider:T.Group({id:T.Text("PDBDEV_00000001",{label:"PDBDev Id(s)",description:"One or more comma/space separated ids."}),encoding:T.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{pivot:"id"}),options:r},{isFlat:!0,label:"PDBDEV"}),swissmodel:T.Group({id:T.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),pubchem:T.Group({id:T.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:T.Group({url:T.Url(""),format:T.Select("mmcif",T.arrayToOptions(Mee.map(function(a){return a[0]}),function(a){return a})),isBinary:T.Boolean(!1),options:r},{isFlat:!0,label:"URL"})})}}})(function(e,t){var r=e.params,n=e.state;return et.create("Download Structure",function(a){return de(void 0,void 0,void 0,function(){var i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:switch(t.behaviors.layout.leftPanelTabName.next("data"),i=r.source,s=!1,u="mmcif",i.name){case"url":o=[{url:i.params.url,isBinary:i.params.isBinary}],u=i.params.format;break;case"pdb":o=i.params.provider.server.name==="pdbe"?i.params.provider.server.params.variant==="updated"?jd(i.params.provider.id,function(h){return"https://www.ebi.ac.uk/pdbe/static/entry/"+h.toLowerCase()+"_updated.cif"},function(h){return"PDBe: "+h+" (updated cif)"},!1):i.params.provider.server.params.variant==="updated-bcif"?jd(i.params.provider.id,function(h){return"https://www.ebi.ac.uk/pdbe/entry-files/download/"+h.toLowerCase()+".bcif"},function(h){return"PDBe: "+h+" (updated cif)"},!0):jd(i.params.provider.id,function(h){return"https://www.ebi.ac.uk/pdbe/static/entry/"+h.toLowerCase()+".cif"},function(h){return"PDBe: "+h+" (cif)"},!1):i.params.provider.server.params.encoding==="cif"?jd(i.params.provider.id,function(h){return"https://files.rcsb.org/download/"+h.toUpperCase()+".cif"},function(h){return"RCSB: "+h+" (cif)"},!1):jd(i.params.provider.id,function(h){return"https://models.rcsb.org/"+h.toUpperCase()+".bcif"},function(h){return"RCSB: "+h+" (bcif)"},!0),s=!!i.params.options.asTrajectory;break;case"pdb-dev":o=jd(i.params.provider.id,function(h){var v=h.toUpperCase().startsWith("PDBDEV_")?h:"PDBDEV_"+h.padStart(8,"0");return i.params.provider.encoding==="bcif"?"https://pdb-dev.wwpdb.org/bcif/"+v.toUpperCase()+".bcif":"https://pdb-dev.wwpdb.org/cif/"+v.toUpperCase()+".cif"},function(h){return h.toUpperCase().startsWith("PDBDEV_")?h:"PDBDEV_"+h.padStart(8,"0")},i.params.provider.encoding==="bcif"),s=!!i.params.options.asTrajectory;break;case"swissmodel":o=jd(i.params.id,function(h){return"https://swissmodel.expasy.org/repository/uniprot/"+h.toUpperCase()+".pdb"},function(h){return"SWISS-MODEL: "+h},!1),s=!!i.params.options.asTrajectory,u="pdb";break;case"pubchem":o=jd(i.params.id,function(h){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/"+h.trim()+"/record/SDF/?record_type=3d"},function(h){return"PubChem: "+h},!1),s=!!i.params.options.asTrajectory,u="mol";break;default:throw new Error(i.name+" not supported.")}return l=r.source.params.options.representation||Zm.auto.id,c=l!==Zm.empty.id,d=i.params.options.type.name==="auto"?void 0:i.params.options.type,[4,n.transaction(function(){return de(void 0,void 0,void 0,function(){var h,y,v,p,g,m,y;return fe(this,function(b){switch(b.label){case 0:return o.length>0&&s?[4,t.builders.data.downloadBlob({sources:o.map(function(S,x){return{id:""+x,url:S.url,isBinary:S.isBinary}}),maxConcurrency:6},{state:{isGhost:!0}})]:[3,4];case 1:return h=b.sent(),[4,t.builders.structure.parseTrajectory(h,{formats:o.map(function(S,x){return{id:""+x,format:"cif"}})})];case 2:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 3:return b.sent(),[3,10];case 4:v=0,p=o,b.label=5;case 5:return v<p.length?(g=p[v],[4,t.builders.data.download(g,{state:{isGhost:!0}})]):[3,10];case 6:return m=b.sent(),[4,t.builders.structure.parseTrajectory(m,u)];case 7:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 8:b.sent(),b.label=9;case 9:return v++,[3,5];case 10:return[2]}})})}).runInContext(a)];case 1:return f.sent(),[2]}})})})});function jd(e,t,r,n){for(var a=e.split(/[,\s]/).map(function(l){return l.trim()}).filter(function(l){return!!l&&(l.length>=4||/^[1-9][0-9]*$/.test(l))}),i=[],o=0,s=a;o<s.length;o++){var u=s[o];i.push({url:Pn.Url(t(u)),isBinary:n,label:r(u)})}return i}var wS=Ao.build({display:{name:"Update Trajectory"},params:{action:T.Select("advance",[["advance","Advance"],["reset","Reset"]]),by:T.Optional(T.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,r=e.state,n=r.selectQ(function(d){return d.ofTransformer(st.Model.ModelFromTrajectory)}),a=r.build();if(t.action==="reset")for(var i=0,o=n;i<o.length;i++){var s=o[i];a.to(s).update({modelIndex:0})}else for(var u=function(d){var f=ir.findAncestorOfType(r.tree,r.cells,d.transform.ref,ge.Molecule.Trajectory);if(!f||!f.obj)return"continue";var h=f.obj;a.to(d).update(function(v){var p=(v.modelIndex+t.by)%h.data.frameCount;return p<0&&(p+=h.data.frameCount),{modelIndex:p}})},l=0,c=n;l<c.length;l++){var s=c[l];u(s)}return r.updateTree(a)}),Q$e=Ao.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:ge.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==OQ}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertModelProperties(r,n)}),Z$e=Ao.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:ge.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==LQ}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertStructureProperties(r,n)}),J$e=Ao.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:ge.Root,params:function(e,t){var r=t.state.data,n=Ut(Ut([],r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Model)})),r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Topology)})),a=n.map(function(s){return[s.transform.ref,s.obj.label]}),i=r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Coordinates)}),o=i.map(function(s){return[s.transform.ref,s.obj.label]});return{model:T.Select(a.length?a[0][0]:"",a),coordinates:T.Select(o.length?o[0][0]:"",o)}}})(function(e,t){var r=e.params,n=e.state;return et.create("Add Trajectory",function(a){return n.transaction(function(){return de(void 0,void 0,void 0,function(){var i,o,s;return fe(this,function(u){switch(u.label){case 0:return i=[r.model,r.coordinates],o=n.build().toRoot().apply(RQ,{modelRef:r.model,coordinatesRef:r.coordinates},{dependsOn:i}).apply(st.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(o).runInContext(a)];case 1:return u.sent(),[4,t.builders.structure.createStructure(o.selector)];case 2:return s=u.sent(),[4,t.builders.structure.representation.applyPreset(s,"auto")];case 3:return u.sent(),[2]}})})}).runInContext(a)})});const eXe=Object.freeze(Object.defineProperty({__proto__:null,AddTrajectory:J$e,DownloadStructure:VD,EnableModelCustomProps:Q$e,EnableStructureCustomProps:Z$e,PdbDownloadProvider:DO,UpdateTrajectory:wS},Symbol.toStringTag,{value:"Module"}));var er=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){return r.props.onSelect(void 0)},r}return t.prototype.render=function(){var r=this.props,n=M.jsx(tXe,{items:r.items,onSelect:r.onSelect,current:r.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent},void 0);return M.jsxs("div",E({className:"msp-action-menu-options"+(r.header?"":" msp-action-menu-options-no-header")},{children:[r.header&&M.jsx(Cc,E({header:r.header,title:r.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:Sc},{children:n}),void 0),!r.header&&n]}),void 0)},t}(ze.PureComponent);(function(e){function t(l,c){return c?E({kind:"header",label:l},c):{kind:"header",label:l}}e.Header=t;function r(l,c,d){return E({kind:"item",label:l,value:c},d)}e.Item=r;function n(l,c){for(var d=c||{},f=d.label,h=d.value,v=d.category,p=d.selected,g=d.icon,m=d.addOn,y=d.description,b=void 0,S=[],x=0;x<l.length;x++){var C=l[x];if(!(c!=null&&c.filter&&!c.filter(C))){var w=v==null?void 0:v(C),A=f?f(C):""+C,I=h?h(C):C,D=y?y(C):typeof C=="string"?C:void 0,k=void 0;w?(b||(b=new Map),k=b.get(w),k||(k=[e.Header(w,{description:w})],b.set(w,k),S.push(k))):k=S;var R=m==null?void 0:m(C);k.push({kind:"item",label:A,value:I,icon:g?g(C):void 0,selected:p?p(C):void 0,addOn:R,description:D})}}return S}e.createItems=n;var a={value:function(l){return l[0]},label:function(l){return l[1]},category:function(l){return l[2]}};function i(l,c){return n(l,c?E(E({},a),c):a)}e.createItemsFromSelectOptions=i;function o(l){if(hc(l))return!1;if(Jm(l))return!!l.selected;for(var c=0,d=l;c<d.length;c++){var f=d[c],h=o(f);if(h)return!0}return!1}e.hasSelectedItem=o;function s(l,c){if(!hc(l)){if(Jm(l))return l.value===c?l:void 0;for(var d=0,f=l;d<f.length;d++){var h=f[d],v=s(h,c);if(v)return v}}}e.findItem=s;function u(l){if(!hc(l)){if(Jm(l))return l;for(var c=0,d=l;c<d.length;c++){var f=d[c],h=u(f);if(h)return h}}}e.getFirstItem=u})(er||(er={}));var tXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=t.createState(r.props),r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.selectAll=function(){var n=HD(r.props.items,[]).filter(function(a){return!a.selected});r.props.onSelect(n)},r.selectNone=function(){var n=HD(r.props.items,[]).filter(function(a){return!!a.selected});r.props.onSelect(n)},r}return t.createState=function(r,n){var a=hT(r.items)&&hc(r.items[0])?r.items[0]:void 0,i=a!=null&&a.isIndependent?!1:r.multiselect?er.hasSelectedItem(r.items):!!r.current&&!!er.findItem(r.items,r.current.value)||er.hasSelectedItem(r.items);return{header:a,hasCurrent:i,isExpanded:i||(n??!!(a!=null&&a.initiallyExpanded))}},t.prototype.componentDidUpdate=function(r){if(this.props.items!==r.items||this.props.current!==r.current){var n=hT(this.props.items)&&hT(r.items)&&hc(this.props.items[0])&&hc(r.items[0])&&this.props.items[0].label===r.items[0].label?this.state.isExpanded:void 0;this.setState(t.createState(this.props,n))}},Object.defineProperty(t.prototype,"multiselectHeader",{get:function(){var r=this.state,n=r.header,a=r.hasCurrent;return M.jsxs("div",E({className:"msp-flex-row msp-control-group-header"},{children:[M.jsx(pr,E({icon:this.state.isExpanded?Hc:Gc,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+"."+(n!=null&&n.description?" "+(n==null?void 0:n.description):"")},{children:a?M.jsx("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0),M.jsx(pr,E({icon:$g,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"}},{children:"All"}),void 0),M.jsx(pr,E({icon:Sc,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"}},{children:"None"}),void 0)]}),void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"basicHeader",{get:function(){var r=this.state,n=r.header,a=r.hasCurrent;return M.jsx("div",E({className:"msp-control-group-header",style:{marginTop:"1px"}},{children:M.jsx(pr,E({noOverflow:!0,icon:this.state.isExpanded?Hc:Gc,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+". "+(n!=null&&n.description?n==null?void 0:n.description:"")},{children:a?M.jsx("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n=this.props,a=n.items,i=n.onSelect,o=n.current;if(hc(a))return null;if(Jm(a))return M.jsx(Jj,{item:a,onSelect:i,current:o,multiselect:this.props.multiselect},void 0);var s=this.state.header;return M.jsxs(M.Fragment,{children:[s&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),M.jsx("div",E({className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset"},{children:(!s||this.state.isExpanded)&&a.map(function(u,l){return hc(u)?null:Jm(u)?M.jsx(Jj,{item:u,onSelect:i,current:o,multiselect:r.props.multiselect},l):M.jsx(t,{items:u,onSelect:i,current:o,multiselect:r.props.multiselect,noAccent:!0},l)})}),void 0)]},void 0)},t}(ze.PureComponent),Jj=function(e){var t=e.item,r=e.onSelect,n=e.current,a=e.multiselect,i=n===t,o=t.addOn?{position:"relative"}:void 0;return M.jsxs(pr,E({icon:t.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:function(s){return r(a?[t]:t,s)},disabled:t.disabled,style:o,title:t.description},{children:[i||t.selected?M.jsx("b",{children:t.label},void 0):t.label,t.addOn]}),void 0)};function hT(e){return!!e&&Array.isArray(e)}function Jm(e){var t=e;return t&&t.kind==="item"}function hc(e){var t=e;return t&&t.kind==="header"}function HD(e,t){if(hc(e))return t;if(Jm(e))return t.push(e),t;for(var r=0,n=e;r<n.length;r++){var a=n[r];HD(a,t)}return t}var RO=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]],rXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,lightness:0},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.onClickSwatch=function(n){var a=dt(+(n.currentTarget.getAttribute("data-color")||"0"));a!==r.props.value&&(r.props.param.isExpanded||r.setState({isExpanded:!1}),r.update(a))},r.onR=function(n){var a=dt.toRgb(r.props.value),i=a[1],o=a[2],s=dt.fromRgb(n,i,o);s!==r.props.value&&r.update(s)},r.onG=function(n){var a=dt.toRgb(r.props.value),i=a[0],o=a[2],s=dt.fromRgb(i,n,o);s!==r.props.value&&r.update(s)},r.onB=function(n){var a=dt.toRgb(r.props.value),i=a[0],o=a[1],s=dt.fromRgb(i,o,n);s!==r.props.value&&r.update(s)},r.onLighten=function(){r.update(dt.lighten(r.props.value,.1))},r.onDarken=function(){r.update(dt.darken(r.props.value,.1))},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.swatch=function(){var r=this;return M.jsx("div",E({className:"msp-combined-color-swatch"},{children:RO.map(function(n){return M.jsx(pr,{inline:!0,"data-color":n[1],onClick:r.onClickSwatch,style:{background:dt.toStyle(n[1])}},n[1])})}),void 0)},t.prototype.render=function(){var r=this.props.param.label||Bi(this.props.name),n=dt.toRgb(this.props.value),a=n[0],i=n[1],o=n[2];return M.jsxs(M.Fragment,{children:[M.jsx(qs,{title:this.props.param.description,label:r,control:M.jsx(pr,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:dt.toStyle(this.props.value)}},void 0)},void 0),this.state.isExpanded&&M.jsxs("div",E({className:"msp-control-offset"},{children:[this.swatch(),M.jsx(qs,{label:"RGB",className:"msp-control-label-short",control:M.jsxs("div",E({style:{display:"flex",textAlignLast:"center",left:"80px"}},{children:[M.jsx(Dc,{onChange:this.onR,numeric:!0,value:a,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),M.jsx(Dc,{onChange:this.onG,numeric:!0,value:i,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),M.jsx(Dc,{onChange:this.onB,numeric:!0,value:o,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0)]}),void 0)},void 0),M.jsxs("div",E({style:{display:"flex",textAlignLast:"center"}},{children:[M.jsx(pr,E({onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Lighten"}),void 0),M.jsx(pr,E({onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Darken"}),void 0)]}),void 0)]}),void 0)]},void 0)},t}(ze.PureComponent),gx=void 0;function nXe(){return gx||(gx=M.jsx(M.Fragment,{children:RO.map(function(e){return M.jsx("option",E({value:e[1],style:{background:""+dt.toStyle(e[1])}},{children:Yo(e[0])}),e[1])})},void 0),gx)}var aXe=function(){for(var e=new Map,t=0,r=RO;t<r.length;t++){var n=r[t];e.set(n[1],n[0])}return e}();function iXe(e){return aXe.has(e)?null:M.jsx("option",E({value:e,style:{background:""+dt.toStyle(e)}},{children:dt.toRgbString(e)}),dt.toHexString(e))}function oXe(e){switch(e.kind){case"scale-legend":return sXe;case"table-legend":return uXe;default:var t=e;console.warn(t+" has no associated UI component");return}}var sXe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend,n=r.colors.map(function(a){return Array.isArray(a)?dt.toStyle(a[0])+" "+100*a[1]+"%":dt.toStyle(a)}).join(", ");return M.jsx("div",E({className:"msp-scale-legend"},{children:M.jsxs("div",E({style:{background:"linear-gradient(to right, "+n+")"}},{children:[M.jsx("span",E({style:{float:"left"}},{children:r.minLabel}),void 0),M.jsx("span",E({style:{float:"right"}},{children:r.maxLabel}),void 0)]}),void 0)}),void 0)},t}(ze.PureComponent),uXe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend;return M.jsx("div",E({className:"msp-table-legend"},{children:r.table.map(function(n,a){var i=n[0],o=n[1];return M.jsxs("div",{children:[M.jsx("div",{className:"msp-table-legend-color",style:{backgroundColor:dt.toStyle(o)}},void 0),M.jsx("div",E({className:"msp-table-legend-text"},{children:i}),void 0)]},a)})}),void 0)},t}(ze.PureComponent),lXe=function(e){Be(t,e);function t(r){var n=e.call(this,r)||this;return n.state={show:!1},n.handleHover=n.handleHover.bind(n),n.handleHoverOff=n.handleHoverOff.bind(n),n.deletePoint=n.deletePoint.bind(n),n}return t.prototype.handleHover=function(){this.setState({show:!0});var r=Ke.create(this.props.nX,this.props.nY);this.props.onmouseover(r)},t.prototype.handleHoverOff=function(){this.setState({show:!1}),this.props.onmouseover(void 0)},t.prototype.deletePoint=function(){this.props.delete(this.props.id)},t.prototype.render=function(){return[M.jsx("circle",{r:"10",id:""+this.props.id,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},this.props.id+"circle")]},t}(ze.Component),cXe=function(e){Be(t,e);function t(r){var n=e.call(this,r)||this;n.handleKeyDown=function(s){},n.handleKeyUp=function(s){},n.handleClick=function(s){return function(u){}},n.handleMouseDown=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)&&!n.state.canSelectMultiple){var l=n.normalizePoint(Ke.create(n.state.points[s][0],n.state.points[s][1]));n.ghostPoints.push(document.createElementNS(n.namespace,"circle")),n.ghostPoints[0].setAttribute("r","10"),n.ghostPoints[0].setAttribute("fill","orange"),n.ghostPoints[0].setAttribute("cx",""+l[0]),n.ghostPoints[0].setAttribute("cy",""+l[1]),n.ghostPoints[0].setAttribute("style","display: none"),n.gElement.appendChild(n.ghostPoints[0]),n.updatedX=l[0],n.updatedY=l[1],n.selected=[s]}}},n.deletePoint=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)){var l=n.state.points.filter(function(c,d){return d!==s});l.sort(function(c,d){return c[0]===d[0]?c[0]===0?c[1]-d[1]:c[1]===1?d[1]-c[1]:c[1]-d[1]:c[0]-d[0]}),n.setState({points:l}),n.change(l),u.stopPropagation()}}},n.myRef=ze.createRef(),n.state={points:[Ke.create(0,0),Ke.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},n.height=400,n.width=600,n.padding=70,n.selected=void 0,n.ghostPoints=[],n.namespace="http://www.w3.org/2000/svg";for(var a=0,i=n.props.data;a<i.length;a++){var o=i[a];n.state.points.push(o)}return n.state.points.sort(function(s,u){return s[0]===u[0]?s[0]===0?s[1]-u[1]:s[1]===1?u[1]-s[1]:s[1]-u[1]:s[0]-u[0]}),n.handleDrag=n.handleDrag.bind(n),n.handleMultipleDrag=n.handleMultipleDrag.bind(n),n.handleDoubleClick=n.handleDoubleClick.bind(n),n.refCallBack=n.refCallBack.bind(n),n.handlePointUpdate=n.handlePointUpdate.bind(n),n.change=n.change.bind(n),n.handleKeyUp=n.handleKeyUp.bind(n),n.handleLeave=n.handleLeave.bind(n),n.handleEnter=n.handleEnter.bind(n),n}return t.prototype.render=function(){var r=this.renderPoints(),n=this.renderLines();return[M.jsx("div",{children:M.jsxs("svg",E({className:"msp-canvas",ref:this.refCallBack,viewBox:"0 0 "+(this.width+this.padding)+" "+(this.height+this.padding),onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick},{children:[M.jsxs("g",E({stroke:"black",fill:"black"},{children:[n,r]}),void 0),M.jsx("g",{className:"ghost-points",stroke:"black",fill:"black"},void 0)]}),void 0)},"LineGraph"),M.jsx("div",{id:"modal-root"},"modal")]},t.prototype.componentDidMount=function(){this.gElement=document.getElementsByClassName("ghost-points")[0]},t.prototype.change=function(r){var n=r.slice();n.shift(),n.pop(),this.props.onChange(n)},t.prototype.handleDrag=function(r){if(this.selected!==void 0){var n=this.myRef.createSVGPoint(),a,i=this.padding/2;n.x=r.clientX,n.y=r.clientY;var o=n.matrixTransform(this.myRef.getScreenCTM().inverse());a=Ke.create(o.x,o.y),(o.x<i||o.x>this.width+i)&&(o.y>this.height+i||o.y<i)?a=Ke.create(this.updatedX,this.updatedY):o.x<i?a=Ke.create(i,o.y):o.x>this.width+i?a=Ke.create(this.width+i,o.y):o.y>this.height+i?a=Ke.create(o.x,this.height+i):o.y<i?a=Ke.create(o.x,i):a=Ke.create(o.x,o.y),this.updatedX=a[0],this.updatedY=a[1];var s=this.unNormalizePoint(a);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",""+a[0]),this.ghostPoints[0].setAttribute("cy",""+a[1]),this.props.onDrag(s)}},t.prototype.handleMultipleDrag=function(){},t.prototype.handlePointUpdate=function(r){var n=this.selected;if(!this.state.canSelectMultiple){if(n===void 0||n[0]===0||n[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;var a=this.unNormalizePoint(Ke.create(this.updatedX,this.updatedY)),i=this.state.points.filter(function(o,s){return s!==n[0]});i.push(a),i.sort(function(o,s){return o[0]===s[0]?o[0]===0?o[1]-s[1]:o[1]===1?s[1]-o[1]:o[1]-s[1]:o[0]-s[0]}),this.setState({points:i}),this.change(i),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}},t.prototype.handleDoubleClick=function(r){var n,a=this.myRef.createSVGPoint();a.x=r.clientX,a.y=r.clientY;var i=a.matrixTransform(this.myRef.getScreenCTM().inverse()),o=this.state.points,s=this.padding/2;i.x<s||i.x>this.width+s||i.y>this.height+s||i.y<this.padding/2||(n=this.unNormalizePoint(Ke.create(i.x,i.y)),o.push(n),o.sort(function(u,l){return u[0]===l[0]?u[0]===0?u[1]-l[1]:u[1]===1?l[1]-u[1]:u[1]-l[1]:u[0]-l[0]}),this.setState({points:o}),this.change(o))},t.prototype.handleLeave=function(){this.selected!==void 0&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))},t.prototype.handleEnter=function(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)},t.prototype.normalizePoint=function(r){var n=this.padding/2,a=this.width+n,i=this.height+n,o=r[0]*(a-n)+n,s=r[1]*(i-n)+n,u=this.height+this.padding-s,l=Ke.create(o,u);return l},t.prototype.unNormalizePoint=function(r){var n=this.padding/2,a=this.width+n,i=this.height+n,o=(r[0]-n)/(a-n),s=(this.height+this.padding-r[1]-n)/(i-n);return Ke.create(o,s)},t.prototype.refCallBack=function(r){r&&(this.myRef=r)},t.prototype.renderPoints=function(){for(var r=[],n,a=0;a<this.state.points.length;a++)a!==0&&a!==this.state.points.length-1&&(n=this.normalizePoint(this.state.points[a]),r.push(M.jsx(lXe,{id:a,x:n[0],y:n[1],nX:this.state.points[a][0],nY:this.state.points[a][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(a),onclick:this.handleClick(a)},a)));return r},t.prototype.renderLines=function(){for(var r=[],n=[],a,i,o,s,u,l,c=0,d=this.state.points;c<d.length;c++){var f=d[c];a=this.padding/2,i=this.width+a,o=this.height+a,s=f[0]*(i-a)+a,u=f[1]*(o-a)+a,l=this.height+this.padding-u,r.push(Ke.create(s,l))}for(var h=r,v=h.length,p=0;p<v-1;p++){var g=h[p][0],m=h[p][1],y=h[p+1][0],b=h[p+1][1];n.push(M.jsx("line",{x1:g,x2:y,y1:m,y2:b,stroke:"#cec9ba",strokeWidth:"5"},"lineOf"+p))}return n},t}(ze.Component),Dee=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:0},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){var a,i;r.setState({current:n}),(i=(a=r.props).onChangeImmediate)===null||i===void 0||i.call(a,n)},r.updateManually=function(n){r.setState({isChanging:!0});var a=n;r.props.step===1&&(a=Math.round(a)),a<r.props.min&&(a=r.props.min),a>r.props.max&&(a=r.props.max),r.setState({current:a,isChanging:!0})},r.onManualBlur=function(){r.setState({isChanging:!1}),r.props.onChange(r.state.current)},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value===n.current?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),M.jsxs("div",E({className:"msp-slider"},{children:[M.jsx("div",{children:M.jsx(Ree,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end},void 0)},void 0),M.jsx("div",{children:M.jsx(Dc,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually},void 0)},void 0)]}),void 0)},t}(ze.Component),dXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:[0,1]},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){r.setState({current:n})},r.updateMax=function(n){var a=n;r.props.step===1&&(a=Math.round(a)),a<r.state.current[0]?a=r.state.current[0]:a<r.props.min&&(a=r.props.min),a>r.props.max&&(a=r.props.max),r.props.onChange([r.state.current[0],a])},r.updateMin=function(n){var a=n;r.props.step===1&&(a=Math.round(a)),a<r.props.min&&(a=r.props.min),a>r.state.current[1]?a=r.state.current[1]:a>r.props.max&&(a=r.props.max),r.props.onChange([a,r.state.current[1]])},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value[0]===n.current[0]&&r.value[1]===n.current[1]?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),M.jsxs("div",E({className:"msp-slider2"},{children:[M.jsx("div",{children:M.jsx(Dc,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin},void 0)},void 0),M.jsx("div",{children:M.jsx(Ree,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0},void 0)},void 0),M.jsx("div",{children:M.jsx(Dc,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax},void 0)},void 0)]}),void 0)},t}(ze.Component);function GD(e){for(var t=[],r={}.hasOwnProperty,n=0;n<arguments.length;n++){var a=arguments[n];if(a){var i=typeof a;if(i==="string"||i==="number")t.push(a);else if(Array.isArray(a))t.push(GD.apply(null,a));else if(i==="object")for(var o in a)r.call(a,o)&&a[o]&&t.push(o)}}return t.join(" ")}function ez(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function tz(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function rz(e,t){return e?t.clientY:t.pageX}function nz(e,t){var r=t.getBoundingClientRect();return e?r.top+r.height*.5:r.left+r.width*.5}function pT(e){e.stopPropagation(),e.preventDefault()}var fXe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.className,a=r.tipFormatter,i=r.vertical,o=r.offset,s=r.value,u=r.index,l=i?{bottom:o+"%"}:{left:o+"%"};return M.jsx("div",{className:n,style:l,title:a(s,u)},void 0)},t}(ze.Component),Ree=function(e){Be(t,e);function t(r){var n=e.call(this,r)||this;n.sliderElement=ze.createRef(),n.handleElements=[],n.dragOffset=0,n.startPosition=0,n.startValue=0,n._getPointsCache=void 0,n.onMouseDown=function(f){if(f.button===0){var h=rz(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var v=nz(n.props.vertical,f.target);n.dragOffset=h-v,h=v}n.onStart(h),n.addDocumentEvents("mouse"),pT(f)}},n.onTouchMove=function(f){if(ez(f)){n.end("touch");return}var h=tz(n.props.vertical,f);n.onMove(f,h-n.dragOffset)},n.onTouchStart=function(f){if(!ez(f)){var h=tz(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var v=nz(n.props.vertical,f.target);n.dragOffset=h-v,h=v}n.onStart(h),n.addDocumentEvents("touch"),pT(f)}},n.eventHandlers={touchmove:function(f){return n.onTouchMove(f)},touchend:function(f){return n.end("touch")},mousemove:function(f){return n.onMouseMove(f)},mouseup:function(f){return n.end("mouse")}},n.calcOffset=function(f){var h=n.props,v=h.min,p=h.max,g=(f-v)/(p-v);return g*100};var a=r.range,i=r.min,o=r.max,s=a?Array.apply(null,Array(+a+1)).map(function(){return i}):i,u="defaultValue"in r?r.defaultValue:s,l=r.value!==void 0?r.value:u,c=(a?l:[i,l]).map(function(f){return n.trimAlignValue(f)}),d;return a&&c[0]===c[c.length-1]&&c[0]===o?d=0:d=c.length-1,n.state={handle:null,recent:d,bounds:c},n}return t.prototype.componentDidUpdate=function(r){var n=this;if("value"in this.props||"min"in this.props||"max"in this.props){var a=this.state.bounds;if(r.range){var i=this.props.value||a,o=i.map(function(u){return n.trimAlignValue(u,n.props)});if(o.every(function(u,l){return u===a[l]}))return;this.setState({bounds:o}),a.some(function(u){return n.isValueOutOfBounds(u,n.props)})&&this.props.onChange(o)}else{var i=this.props.value!==void 0?this.props.value:a[1],s=this.trimAlignValue(i,this.props);if(s===a[1]&&a[0]===r.min)return;this.setState({bounds:[r.min,s]}),this.isValueOutOfBounds(a[1],this.props)&&this.props.onChange(s)}}},t.prototype.onChange=function(r){var n=this.props,a=!("value"in n);a?this.setState(r):r.handle!==void 0&&this.setState({handle:r.handle});var i=E(E({},this.state),r),o=n.range?i.bounds:i.bounds[1];n.onChange(o)},t.prototype.onMouseMove=function(r){var n=rz(this.props.vertical,r);this.onMove(r,n-this.dragOffset)},t.prototype.onMove=function(r,n){pT(r);var a=this.props,i=this.state,o=n-this.startPosition;o=this.props.vertical?-o:o;var s=o/this.getSliderLength()*(a.max-a.min),u=this.trimAlignValue(this.startValue+s),l=i.bounds[i.handle];if(u!==l){var c=Ut([],i.bounds);c[i.handle]=u;var d=i.handle;if(a.pushable){var f=i.bounds[d];this.pushSurroundingHandles(c,d,f)}else a.allowCross&&(c.sort(function(h,v){return h-v}),d=c.indexOf(u));this.onChange({handle:d,bounds:c})}},t.prototype.onStart=function(r){var n=this.props;n.onBeforeChange(this.getValue());var a=this.calcValueByPos(r);this.startValue=a,this.startPosition=r;var i=this.state,o=i.bounds,s=1;if(this.props.range){for(var u=0,l=1;l<o.length-1;++l)a>o[l]&&(u=l);Math.abs(o[u+1]-a)<Math.abs(o[u]-a)&&(u=u+1),s=u;var c=o[u+1]===o[u];c&&(s=i.recent),c&&a!==o[u+1]&&(s=a<o[u+1]?u:u+1)}this.setState({handle:s,recent:s});var d=i.bounds[s];if(a!==d){var f=Ut([],i.bounds);f[s]=a,this.onChange({bounds:f})}},t.prototype.getPoints=function(){var r=this.props,n=r.marks,a=r.step,i=r.min,o=r.max,s=this._getPointsCache;if(!s||s.marks!==n||s.step!==a){var u=E({},n);if(a!==null)for(var l=i;l<=o;l+=a)u[l]=l;var c=Object.keys(u).map(parseFloat);c.sort(function(d,f){return d-f}),this._getPointsCache={marks:n,step:a,points:c}}return this._getPointsCache.points},t.prototype.getPrecision=function(r){var n=r.toString(),a=0;return n.indexOf(".")>=0&&(a=n.length-n.indexOf(".")-1),a},t.prototype.getSliderLength=function(){var r=this.sliderElement.current;return r?this.props.vertical?r.clientHeight:r.clientWidth:0},t.prototype.getSliderStart=function(){var r=this.sliderElement.current,n=r.getBoundingClientRect();return this.props.vertical?n.top:n.left},t.prototype.getValue=function(){var r=this.state.bounds;return this.props.range?r:r[1]},t.prototype.addDocumentEvents=function(r){r==="touch"?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.calcValue=function(r){var n=this.props,a=n.vertical,i=n.min,o=n.max,s=Math.abs(r/this.getSliderLength()),u=a?(1-s)*(o-i)+i:s*(o-i)+i;return u},t.prototype.calcValueByPos=function(r){var n=r-this.getSliderStart(),a=this.trimAlignValue(this.calcValue(n));return a},t.prototype.end=function(r){this.removeEvents(r),this.props.onAfterChange(this.getValue()),this.setState({handle:null})},t.prototype.isEventFromHandle=function(r){for(var n=0,a=this.handleElements;n<a.length;n++){var i=a[n];if(i.current===r.target)return!0}return!1},t.prototype.isValueOutOfBounds=function(r,n){return r<n.min||r>n.max},t.prototype.pushHandle=function(r,n,a,i){for(var o=r[n],s=r[n];a*(s-o)<i;){if(!this.pushHandleOnePoint(r,n,a))return r[n]=o,!1;s=r[n]}return!0},t.prototype.pushHandleOnePoint=function(r,n,a){var i=this.getPoints(),o=i.indexOf(r[n]),s=o+a;if(s>=i.length||s<0)return!1;var u=n+a,l=i[s],c=this.props.pushable,d=a*(r[u]-l);return this.pushHandle(r,u,a,+c-d)?(r[n]=l,!0):!1},t.prototype.pushSurroundingHandles=function(r,n,a){var i=this.props.pushable,o=r[n],s=0;if(r[n+1]-o<i?s=1:o-r[n-1]<i&&(s=-1),s!==0){var u=n+s,l=s*(r[u]-o);this.pushHandle(r,u,s,+i-l)||(r[n]=a)}},t.prototype.removeEvents=function(r){r==="touch"?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.trimAlignValue=function(r,n){var a=this.state||{},i=a.handle,o=a.bounds,s=E(E({},this.props),n||{}),u=s.marks,l=s.step,c=s.min,d=s.max,f=s.allowCross,h=r;h<=c&&(h=c),h>=d&&(h=d),!f&&i!=null&&i>0&&h<=o[i-1]&&(h=o[i-1]),!f&&i!=null&&i<o.length-1&&h>=o[i+1]&&(h=o[i+1]);var v=Object.keys(u).map(parseFloat);if(l!==null){var p=Math.round((h-c)/l)*l+c;v.push(p)}var g=v.map(function(y){return Math.abs(h-y)}),m=v[g.indexOf(Math.min.apply(Math,g))];return l!==null?parseFloat(m.toFixed(this.getPrecision(l))):m},t.prototype.render=function(){var r,n=this,a=this.state,i=a.handle,o=a.bounds,s=this.props,u=s.className,l=s.prefixCls,c=s.disabled,d=s.vertical,f=s.range,h=s.step,v=s.marks,p=s.tipFormatter,g=this.props.handle,m=o.map(this.calcOffset),y=l+"-handle",b=o.map(function(I,D){var k;return GD((k={},k[y]=!0,k[y+"-"+(D+1)]=!0,k[y+"-lower"]=D===0,k[y+"-upper"]=D===o.length-1,k))}),S=h===null||p===null,x={prefixCls:l,noTip:S,tipFormatter:p,vertical:d};if(this.handleElements.length!==o.length){this.handleElements=[];for(var C=0;C<o.length;C++)this.handleElements.push(ze.createRef())}var w=o.map(function(I,D){return ze.cloneElement(g,E(E({},x),{className:b[D],value:I,offset:m[D],dragging:i===D,index:D,key:D,ref:n.handleElements[D]}))});f||w.shift();var A=GD((r={},r[l]=!0,r[l+"-with-marks"]=Object.keys(v).length,r[l+"-disabled"]=c,r[l+"-vertical"]=this.props.vertical,r[u]=!!u,r));return M.jsxs("div",E({ref:this.sliderElement,className:A,onTouchStart:c?cf:this.onTouchStart,onMouseDown:c?cf:this.onMouseDown},{children:[M.jsx("div",{className:l+"-rail"},void 0),w]}),void 0)},t.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:M.jsx(fXe,{className:"",vertical:!1,offset:0,tipFormatter:function(r){return r},value:0,index:0},void 0),onBeforeChange:cf,onChange:cf,onAfterChange:cf,tipFormatter:function(r,n){return r},disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1},t}(ze.Component),Un=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a,i,o;if((o=(i=r.props).onChange)===null||o===void 0||o.call(i,n,r.props.values),r.props.onChangeValues){var s=E(E({},r.props.values),(a={},a[n.name]=n.value,a));r.props.onChangeValues(s,r.props.values)}},r.paramGroups=rh(function(n){return pXe(n)}),r}return t.prototype.renderGroup=function(r){var n;if(r.length===0)return null;for(var a=this.props.values,i=null,o=void 0,s=0,u=r;s<u.length;s++){var l=u[s],c=l[0],d=l[1],f=l[2];!((n=d.hideIf)===null||n===void 0)&&n.call(d,a)||(i||(i=[]),o=d.category,i.push(M.jsx(f,{param:d,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:c,value:a[c]},c)))}return i?o?[M.jsx(Bu,E({header:o},{children:i}),o)]:i:null},t.prototype.renderPart=function(r){for(var n=null,a=0,i=r;a<i.length;a++){var o=i[a],s=this.renderGroup(o);if(s){n||(n=[]);for(var u=0,l=s;u<l.length;u++){var c=l[u];n.push(c)}}}return n},t.prototype.render=function(){var r=this.paramGroups(this.props.params),n=this.renderPart(r.essentials),a=this.renderPart(r.advanced);return n&&a?M.jsxs(M.Fragment,{children:[n,M.jsx(Bu,E({header:"Advanced Options"},{children:a}),void 0)]},void 0):n||a},t}(ze.PureComponent),hXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n,a){var i,o=E(E({},a),(i={},i[n.name]=n.value,i)),s=r.props.mapping.update(o,r.plugin);r.props.mapping.apply(s,r.plugin)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.mapping.getTarget(this.plugin),n=this.props.mapping.getValues(r,this.plugin),a=this.props.mapping.params(this.plugin);return M.jsx(Un,{params:a,values:n,onChange:this.setSettings},void 0)},t}(vr);function pXe(e){function t(c,d,f){var h=Gb(d);if(h)if(!d.category)f.params[0].push([c,d,h]);else{f.map||(f.map=new Map);var v=f.map.get(d.category);v||(v=[],f.map.set(d.category,v),f.params.push(v)),v.push([c,d,h])}}function r(c,d){var f=c[0],h=d[0];return!f||!f[1].category?-1:!h||!h[1].category?1:f[1].category<h[1].category?-1:1}for(var n=Object.keys(e),a={params:[[]],map:void 0},i={params:[[]],map:void 0},o=0,s=n;o<s.length;o++){var u=s[o],l=e[u];l.isHidden||(l.isEssential?t(u,l,a):t(u,l,i))}return a.params.sort(r),i.params.sort(r),{essentials:a.params,advanced:i.params}}function Gb(e){switch(e.type){case"value":return;case"boolean":return kO;case"number":return typeof e.min<"u"&&typeof e.max<"u"?yXe:gXe;case"converted":return BXe;case"conditioned":return FXe;case"multi-select":return OXe;case"color":return rXe;case"color-list":return e.offsets?TXe:PXe;case"vec3":return IXe;case"mat4":return MXe;case"url":return DXe;case"file":return RXe;case"file-list":return kXe;case"select":return OO;case"value-ref":return xXe;case"data-ref":return;case"text":return bXe;case"interval":return typeof e.min<"u"&&typeof e.max<"u"?CXe:SXe;case"group":return Oee;case"mapped":return LXe;case"line-graph":return mXe;case"script":return UXe;case"object-list":return NO;default:var t=e;console.warn(t+" has no associated UI component");return}}var vXe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.legend,a=r.description,i=n&&oXe(n);return M.jsx("div",E({className:"msp-help-text"},{children:M.jsxs("div",{children:[M.jsxs("div",E({className:"msp-help-description"},{children:[M.jsx(on,{svg:Il,inline:!0},void 0),a]}),void 0),i&&M.jsx("div",E({className:"msp-help-legend"},{children:M.jsx(i,{legend:n},void 0)}),void 0)]},void 0)}),void 0)},t}(ze.PureComponent);function Ev(e){var t=e.props,r=e.state,n=e.control,a=e.toggleHelp,i=e.addOn,o=[];t.param.shortLabel&&o.push("msp-control-label-short"),t.param.twoColumns&&o.push("msp-control-col-2");var s=o.join(" "),u=t.param.label||Bi(t.name),l=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},c=l.description||l.legend,d=u+(c?". Click for help.":"");return M.jsxs(M.Fragment,{children:[M.jsx(qs,{className:s,title:d,label:M.jsxs(M.Fragment,{children:[u,c&&M.jsx("button",E({className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:a,title:d||(r.showHelp?"Hide":"Show")+" help",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:M.jsx(on,{svg:Il},void 0)}),void 0)]},void 0),control:n},void 0),c&&r.showHelp&&M.jsx("div",E({className:"msp-control-offset"},{children:M.jsx(vXe,{legend:l.legend,description:l.description},void 0)}),void 0),i]},void 0)}var Av=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderAddOn=function(){return null},t.prototype.render=function(){return Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(ze.PureComponent),kO=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){r.update(!r.props.value),n.currentTarget.blur()},r}return t.prototype.renderControl=function(){return M.jsxs("button",E({onClick:this.onClick,disabled:this.props.isDisabled},{children:[M.jsx(on,{svg:this.props.value?$g:LX},void 0),this.props.value?"On":"Off"]}),void 0)},t}(Av),mXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1,isOverPoint:!1,message:r.props.param.defaultValue.length+" points"},r.onHover=function(n){if(r.setState({isOverPoint:!r.state.isOverPoint}),n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"});return}r.setState({message:r.props.value.length+" points"})},r.onDrag=function(n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"})},r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:n})},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){var r=this.props.param.label||Bi(this.props.name);return M.jsxs(M.Fragment,{children:[M.jsx(qs,{label:r,control:M.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:""+this.state.message}),void 0)},void 0),M.jsx("div",E({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:M.jsx(cXe,{data:this.props.param.defaultValue,onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag},void 0)}),void 0)]},void 0)},t}(ze.PureComponent),gXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={value:"0"},r.update=function(n){var a=KC(r.props.param.step||.01);n=parseFloat(n.toFixed(a)),r.props.onChange({param:r.props.param,name:r.props.name,value:n})},r}return t.prototype.render=function(){var r=this.props.param.label||Bi(this.props.name),n=this.props.param.label||Bi(this.props.name),a=KC(this.props.param.step||.01);return M.jsx(qs,{title:this.props.param.description,label:n,control:M.jsx(Dc,{numeric:!0,value:parseFloat(this.props.value.toFixed(a)),onEnter:this.props.onEnter,placeholder:r,isDisabled:this.props.isDisabled,onChange:this.update},void 0)},void 0)},t}(ze.PureComponent),yXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){var r=typeof this.props.value>"u"?this.props.param.defaultValue:this.props.value;return M.jsx(Dee,{value:r,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(Av),bXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==r.props.value&&r.update(a)},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Bi(this.props.name);return M.jsx("input",{type:"text",value:this.props.value||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Av),um=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){typeof r.props.param.defaultValue=="number"?r.update(parseInt(n.target.value,10)):r.update(n.target.value)},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.render=function(){var r=this,n=this.props.value!==void 0&&!this.props.param.options.some(function(a){return a[0]===r.props.value});return M.jsxs("select",E({className:"msp-form-control",title:this.props.title,value:this.props.value!==void 0?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled},{children:[n&&M.jsx("option",E({value:this.props.value},{children:"[Invalid] "+this.props.value}),this.props.value),this.props.param.options.map(function(a){var i=a[0],o=a[1];return M.jsx("option",E({value:i},{children:o}),i)})]}),void 0)},t}(ze.PureComponent),OO=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:n.value})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.cycle=function(){var n=r.props.param.options,a=n.findIndex(function(o){return o[0]===r.props.value}),i=a===n.length-1?0:a+1;r.props.onChange({param:r.props.param,name:r.props.name,value:n[i][0]})},r.items=rh(function(n){return er.createItemsFromSelectOptions(n.options)}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),a=this.props.value!==void 0?er.findItem(n,this.props.value):void 0,i=a?a.label:typeof this.props.value>"u"?(((r=er.getFirstItem(n))===null||r===void 0?void 0:r.label)||"")+" [Default]":"[Invalid] "+this.props.value,o=this.props.param.cycle?this.cycle:this.toggle,s=this.props.param.cycle?"center":"left",u=this.props.param.cycle?this.props.value==="on"?$g:this.props.value==="off"?LX:void 0:void 0;return M.jsx(Ra,{disabled:this.props.isDisabled,style:{textAlign:s,overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,icon:u,toggle:o,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=er.findItem(r,this.props.value);return M.jsx(er,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(ze.PureComponent),xXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:{ref:n.value}})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.items=rh(function(n){return er.createItemsFromSelectOptions(n.getOptions())}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),a=this.props.value.ref?er.findItem(n,this.props.value.ref):void 0,i=a?a.label:"[Ref] "+((r=this.props.value.ref)!==null&&r!==void 0?r:"");return M.jsx(Ra,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,toggle:this.toggle,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=er.findItem(r,this.props.value.ref);return M.jsx(er,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(ze.PureComponent),SXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:T.Numeric(0,{step:r.props.param.step},{label:"Min"}),1:T.Numeric(0,{step:r.props.param.step},{label:"Max"})},r.componentChange=function(n){var a=n.name,i=n.value,o=Ut([],r.props.value);o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Bi(this.props.name),a=KC(this.props.param.step||.01),i="["+r[0].toFixed(a)+", "+r[1].toFixed(a)+"]";return M.jsxs(M.Fragment,{children:[M.jsx(qs,{label:n,control:M.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&M.jsx("div",E({className:"msp-control-offset"},{children:M.jsx(Un,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(ze.PureComponent),CXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){return M.jsx(dXe,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(Av);(function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(dt(parseInt(n.target.value)))},r}return t.prototype.stripStyle=function(){return{background:dt.toStyle(this.props.value),position:"absolute",bottom:"0",height:"4px",right:"0",left:"0"}},t.prototype.renderControl=function(){return M.jsxs("div",E({style:{position:"relative"}},{children:[M.jsxs("select",E({value:this.props.value,onChange:this.onChange},{children:[iXe(this.props.value),nXe()]}),void 0),M.jsx("div",{style:this.stripStyle()},void 0)]}),void 0)},t})(Av);function Py(e,t){return t===void 0&&(t=!1),Array.isArray(e)?t?dt.toStyle(e[0])+" "+(100*e[1]).toFixed(2)+"%":dt.toStyle(e[0]):dt.toStyle(e)}var _Xe=T3(function(e){var t=e.map(function(r){return Py(r,!0)});return"linear-gradient(to right, "+t.join(", ")+")"}),wXe=T3(function(e){for(var t=e.length,r=[Py(e[0])+" "+100*(1/t)+"%"],n=1,a=t-1;n<a;++n)r.push(Py(e[n])+" "+100*(n/t)+"%",Py(e[n])+" "+100*((n+1)/t)+"%");return r.push(Py(e[t-1])+" "+100*((t-1)/t)+"%"),"linear-gradient(to right, "+r.join(", ")+")"});function LO(e,t){return t===void 0&&(t="0"),{background:EXe(e.colors,e.kind==="set"),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function EXe(e,t){return t?wXe(e):_Xe(e)}function AXe(){var e=function(t){var r=Hs(t[0]);return M.jsx("div",{style:LO({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})},void 0)};return{ColorPresets:{all:er.createItemsFromSelectOptions(ak,{addOn:e}),scale:er.createItemsFromSelectOptions(ESe,{addOn:e}),set:er.createItemsFromSelectOptions(ASe,{addOn:e})},ColorsParam:T.ObjectList({color:T.Color(0)},function(t){var r=t.color;return dt.toHexString(r).toUpperCase()}),OffsetColorsParam:T.ObjectList({color:T.Color(0),offset:T.Numeric(0,{min:0,max:1,step:.01})},function(t){var r=t.color,n=t.offset;return dt.toHexString(r).toUpperCase()+" ["+n.toFixed(2)+"]"}),IsInterpolatedParam:T.Boolean(!1,{label:"Interpolated"})}}var yx;function kee(){return yx||(yx=AXe(),yx)}var PXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(n){r.setState({show:void 0});var a=Hs(n.value);r.update({kind:a.type!=="qualitative"?"interpolate":"set",colors:a.list})}},r.colorsChanged=function(n){var a=n.value;r.update({kind:r.props.value.kind,colors:a.map(function(i){return i.color})})},r.isInterpolatedChanged=function(n){var a=n.value;r.update({kind:a?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return M.jsxs(M.Fragment,{children:[M.jsxs("button",E({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",M.jsx("div",{style:LO(r,"33px")},void 0)]}),void 0),M.jsx(qt,{svg:u3,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=kee(),n=r.ColorPresets,a=r.ColorsParam,i=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return M.jsx(er,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors.map(function(u){return{color:u}});return M.jsxs("div",E({className:"msp-control-offset"},{children:[M.jsx(NO,{name:"colors",param:a,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),M.jsx(kO,{name:"isInterpolated",param:i,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(ze.PureComponent),TXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(n){r.setState({show:void 0});var a=Hs(n.value);r.update({kind:a.type!=="qualitative"?"interpolate":"set",colors:a.list})}},r.colorsChanged=function(n){var a=n.value,i=a.map(function(o){return[o.color,o.offset]});i.sort(function(o,s){return o[1]-s[1]}),r.update({kind:r.props.value.kind,colors:i})},r.isInterpolatedChanged=function(n){var a=n.value;r.update({kind:a?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return M.jsxs(M.Fragment,{children:[M.jsxs("button",E({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",M.jsx("div",{style:LO(r,"33px")},void 0)]}),void 0),M.jsx(qt,{svg:u3,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=kee(),n=r.ColorPresets,a=r.OffsetColorsParam,i=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return M.jsx(er,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors,u=s.map(function(l,c){return Array.isArray(l)?{color:l[0],offset:l[1]}:{color:l,offset:c/s.length}});return u.sort(function(l,c){return l.offset-c.offset}),M.jsxs("div",E({className:"msp-control-offset"},{children:[M.jsx(NO,{name:"colors",param:a,value:u,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),M.jsx(kO,{name:"isInterpolated",param:i,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(ze.PureComponent),IXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:T.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.x||"X"}),1:T.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.y||"Y"}),2:T.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.z||"Z"})},r.componentChange=function(n){var a=n.name,i=n.value,o=_.copy(_.zero(),r.props.value);o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Bi(this.props.name),a=KC(this.props.param.step||.01),i="["+r[0].toFixed(a)+", "+r[1].toFixed(a)+", "+r[2].toFixed(a)+"]";return M.jsxs(M.Fragment,{children:[M.jsx(qs,{label:n,control:M.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&M.jsx("div",E({className:"msp-control-offset"},{children:M.jsx(Un,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(ze.PureComponent),MXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={json:T.Text(JSON.stringify(le()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},r.componentChange=function(n){var a=n.name,i=n.value,o=le.copy(le(),r.props.value);a==="json"?le.copy(o,JSON.parse(i)):o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.changeValue=function(r){var n=this;return function(a){var i=le.copy(le(),n.props.value);i[r]=a,n.change(i)}},Object.defineProperty(t.prototype,"grid",{get:function(){for(var r=this.props.value,n=[],a=0;a<4;a++){for(var i=[],o=0;o<4;o++)i.push(M.jsx(Dc,{numeric:!0,delayMs:50,value:le.getValue(r,a,o),onChange:this.changeValue(4*o+a),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},o));n.push(M.jsx("div",E({className:"msp-flex-row"},{children:i}),a))}return M.jsx("div",E({className:"msp-parameter-matrix"},{children:n}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r={json:JSON.stringify(this.props.value)},n=this.props.param.label||Bi(this.props.name);return M.jsxs(M.Fragment,{children:[M.jsx(qs,{label:n,control:M.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:"4×4 Matrix"}),void 0)},void 0),this.state.isExpanded&&M.jsxs("div",E({className:"msp-control-offset"},{children:[this.grid,M.jsx(Un,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)]}),void 0)]},void 0)},t}(ze.PureComponent),DXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==Pn.getUrl(r.props.value||"")&&r.update(Pn.Url(a))},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Bi(this.props.name);return M.jsx("input",{type:"text",value:Pn.getUrl(this.props.value||""),placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Av),RXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFile=function(n){r.change(n.target.files[0])},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:Pn.File(r)})},t.prototype.renderControl=function(){var r=this.props.value;return M.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[r?r.name:"Select a file..."," ",M.jsx("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(ze.PureComponent),kXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFileList=function(n){r.change(n.target.files)},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){var n=[];if(r)for(var a=0,i=r.length;a<i;++a)n.push(Pn.File(r[a]));this.props.onChange({name:this.props.name,param:this.props.param,value:n})},t.prototype.renderControl=function(){var r=this.props.value,n=[];if(r)for(var a=0,i=r;a<i.length;a++){var o=i[a];n.push(o.name)}var s=n.length===0?"Select files...":n.length===1?n[0]:n.length+" files selected";return M.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[s," ",M.jsx("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(ze.PureComponent),OXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.toggle=function(r){var n=this;return function(a){n.props.value.indexOf(r)<0?n.change(n.props.value.concat(r)):n.change(n.props.value.filter(function(i){return i!==r})),a.currentTarget.blur()}},t.prototype.render=function(){var r=this,n=this.props.value,a=this.props.param.emptyValue,i=this.props.param.label||Bi(this.props.name);return M.jsxs(M.Fragment,{children:[M.jsx(qs,{label:i,control:M.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:n.length===0&&a?a:n.length+" of "+this.props.param.options.length}),void 0)},void 0),this.state.isExpanded&&M.jsx("div",E({className:"msp-control-offset"},{children:this.props.param.options.map(function(o){var s=o[0],u=o[1],l=n.indexOf(s)>=0;return M.jsx(pr,E({onClick:r.toggle(s),disabled:r.props.isDisabled,style:{marginTop:"1px"}},{children:M.jsx("span",E({style:{float:l?"left":"right"}},{children:l?"✓ "+u:u+" ✗"}),void 0)}),s)})}),void 0)]},void 0)},t}(ze.PureComponent),Oee=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,showHelp:!1},r.onChangeParam=function(n){var a;r.change(E(E({},r.props.value),(a={},a[n.name]=n.value,a)))},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.pivoted=function(){var r=this.props.param.pivot,n=this.props.param.params,a=n[r],i=Gb(a),o=M.jsx(i,{name:r,param:a,value:this.props.value[r],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);if(!this.state.isExpanded)return M.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[o,M.jsx(qt,{svg:Up,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0)]}),void 0);for(var s=Object.create(null),u=0,l=Object.keys(n);u<l.length;u++){var c=l[u];c!==r&&(s[c]=n[c])}return M.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[o,M.jsx(qt,{svg:Up,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0),M.jsx("div",E({className:"msp-control-offset"},{children:M.jsx(Un,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)},t.prototype.render=function(){var r=this.props.param.params;if(Object.keys(r).length===0)return null;if(this.props.param.pivot)return this.pivoted();var n=this.props.param.label||Bi(this.props.name),a=M.jsx(Un,{params:r,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);return this.props.inMapped?M.jsx("div",E({className:"msp-control-offset"},{children:a}),void 0):this.props.param.isFlat?a:M.jsxs("div",E({className:"msp-control-group-wrapper"},{children:[M.jsx("div",E({className:"msp-control-group-header"},{children:M.jsxs("button",E({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded},{children:[M.jsx(on,{svg:this.state.isExpanded?Hc:Gc},void 0),n]}),void 0)}),void 0),this.state.isExpanded&&M.jsx("div",E({className:"msp-control-offset"},{children:a}),void 0)]}),void 0)},t}(ze.PureComponent),LXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.valuesCache={},r.onChangeName=function(n){r.change({name:n.value,params:r.getValues(n.value)})},r.onChangeParam=function(n){r.setValues(r.props.value.name,n.value),r.change({name:r.props.value.name,params:n.value})},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.setValues=function(r,n){this.valuesCache[r]=n},t.prototype.getValues=function(r){return r in this.valuesCache?this.valuesCache[r]:this.props.param.map(r).defaultValue},t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.areParamsEmpty=function(r){for(var n=0,a=Object.keys(r);n<a.length;n++){var i=a[n];if(!r[i].isHidden)return!1}return!0},t.prototype.render=function(){var r=this,n=this.props.value||this.props.param.defaultValue,a=this.props.param.map(n.name),i=this.props.param.label||Bi(this.props.name),o=Gb(a),s=this.props.param.help,u=s?E(E({},this.props.param.select),{help:function(c){return s({name:c,params:r.getValues(c)})}}):this.props.param.select,l=M.jsx(OO,{param:u,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:i,value:n.name},void 0);return o?a.type==="group"&&!a.isFlat?this.areParamsEmpty(a.params)?l:M.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[l,M.jsx(qt,{svg:Up,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:i+" Properties"},void 0),this.state.isExpanded&&M.jsx(Oee,{inMapped:!0,param:a,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]}),void 0):M.jsxs(M.Fragment,{children:[l,M.jsx(o,{param:a,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):l},t}(ze.PureComponent),Lee=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={current:r.props.value},r.onChangeParam=function(n){var a;r.setState({current:E(E({},r.state.current),(a={},a[n.name]=n.value,a))})},r.apply=function(){r.props.apply(r.state.current)},r}return t.prototype.componentDidUpdate=function(r){(this.props.params!==r.params||this.props.value!==r.value)&&this.setState({current:this.props.value})},t.prototype.render=function(){return M.jsxs(M.Fragment,{children:[M.jsx(Un,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled},void 0),M.jsx("button",E({className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled},{children:this.props.isUpdate?"Update":"Add"}),void 0)]},void 0)},t}(ze.PureComponent),NXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.update=function(n){r.props.actions.update(n,r.props.index)},r.moveUp=function(){r.props.actions.move(r.props.index,-1)},r.moveDown=function(){r.props.actions.move(r.props.index,1)},r.remove=function(){r.setState({isExpanded:!1}),r.props.actions.remove(r.props.index)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-param-object-list-item"},{children:[M.jsxs("button",E({className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded},{children:[M.jsx("span",{children:this.props.index+1+": "},void 0),this.props.param.getLabel(this.props.value)]}),void 0),M.jsxs("div",{children:[M.jsx(qt,{svg:o3,title:"Move Up",onClick:this.moveUp,small:!0},void 0),M.jsx(qt,{svg:s3,title:"Move Down",onClick:this.moveDown,small:!0},void 0),M.jsx(qt,{svg:Zs,title:"Remove",onClick:this.remove,small:!0},void 0)]},void 0)]}),void 0),this.state.isExpanded&&M.jsx("div",E({className:"msp-control-offset"},{children:M.jsx(Lee,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled},void 0)}),void 0)]},void 0)},t}(ze.PureComponent),NO=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.add=function(n){r.change(Ut(Ut([],r.props.value),[n]))},r.actions={update:function(n,a){var i=r.props.value.slice(0);i[a]=n,r.change(i)},move:function(n,a){var i=r.props.value;if(i.length!==1){var o=(n+a)%i.length;o<0&&(o+=i.length),i=i.slice(0);var s=i[n];i[n]=i[o],i[o]=s,r.change(i)}},remove:function(n){for(var a=r.props.value,i=[],o=0;o<a.length;o++)n!==o&&i.push(a[o]);r.change(i)}},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this,n=this.props.value,a=this.props.param.label||Bi(this.props.name),i=n.length+" item"+(n.length!==1?"s":"");return M.jsxs(M.Fragment,{children:[M.jsx(qs,{label:a,control:M.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&M.jsxs("div",E({className:"msp-control-offset"},{children:[this.props.value.map(function(o,s){return M.jsx(NXe,{param:r.props.param,value:o,index:s,actions:r.actions,isDisabled:r.props.isDisabled},s)}),M.jsx(Cc,E({header:"New Item"},{children:M.jsx(Lee,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)]},void 0)},t}(ze.PureComponent),FXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChangeCondition=function(n){r.change(r.props.param.conditionedValue(r.props.value,n.value))},r.onChangeParam=function(n){r.change(n.value)},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.conditionForValue(r),a=this.props.param.conditionParams[n],i=this.props.param.label||Bi(this.props.name),o=Gb(a),s=M.jsx(OO,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:i+" Kind",value:n},void 0);return o?M.jsxs(M.Fragment,{children:[s,M.jsx(o,{param:a,value:r,name:i,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):s},t}(ze.PureComponent),BXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:r.props.param.toValue(n.value)})},r}return t.prototype.render=function(){var r=this.props.param.fromValue(this.props.value),n=Gb(this.props.param.converted);return n?M.jsx(n,{param:this.props.param.converted,value:r,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0):null},t}(ze.PureComponent),UXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==r.props.value.expression&&r.update({language:r.props.value.language,expression:a})},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Bi(this.props.name);return M.jsx("input",{type:"text",value:this.props.value.expression||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Av),jXe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.updateParams=function(n){var a;r.plugin.managers.animation.updateParams((a={},a[n.name]=n.value,a))},r.updateCurrentParams=function(n){var a;r.plugin.managers.animation.updateCurrentParams((a={},a[n.name]=n.value,a))},r.startOrStop=function(){var n=r.plugin.managers.animation;n.state.animationState==="playing"?n.stop():(r.props.onStart&&r.props.onStart(),n.start())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.animation.events.updated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r,n,a=this.plugin.managers.animation;if(a.isEmpty)return null;var i=a.state.animationState==="playing",o=(n=(r=a.current.anim).canApply)===null||n===void 0?void 0:n.call(r,this.plugin);return M.jsxs(M.Fragment,{children:[M.jsx(Un,{params:a.getParams(),values:a.state.params,onChange:this.updateParams,isDisabled:i},void 0),M.jsx(Un,{params:a.current.params,values:a.current.paramValues,onChange:this.updateCurrentParams,isDisabled:i},void 0),M.jsx("div",E({className:"msp-flex-row"},{children:M.jsx(pr,E({icon:a.state.animationState!=="playing"?void 0:BX,onClick:this.startOrStop,disabled:o!==void 0&&o.canApply===!1},{children:a.state.animationState==="playing"?"Stop":o===void 0||o.canApply?"Start":o.reason||"Start"}),void 0)}),void 0)]},void 0)},t}(vr),Nee="overpaint-controls";function az(e,t,r,n,a){return de(this,void 0,void 0,function(){var i=this;return fe(this,function(o){switch(o.label){case 0:return[4,zXe(e,t,function(s,u,l){return de(i,void 0,void 0,function(){var c,d,f,h,v,v;return fe(this,function(p){switch(p.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=p.sent(),or.isEmpty(d)?[2]:(f={bundle:en.fromLoci(d),color:r===-1?dt(0):r,clear:r===-1},l?(h=Ut(Ut([],l.params.values.layers),[f]),v=iz(h,c),s.to(l).update(qa.toBundle(v))):(v=iz([f],c),s.to(u.transform.ref).apply(st.Representation.OverpaintStructureRepresentation3DFromBundle,qa.toBundle(v),{tags:Nee})),[2])}})})})];case 1:return o.sent(),[2]}})})}function zXe(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ir.Generators.ofTransformer(st.Representation.OverpaintStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(Nee)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function iz(e,t){var r=qa.ofBundle(e,t.root),n=qa.merge(r);return qa.filter(n,t)}var Fee="clipping-controls";function VXe(e,t,r,n,a){return de(this,void 0,void 0,function(){var i=this;return fe(this,function(o){switch(o.label){case 0:return[4,HXe(e,t,function(s,u,l){return de(i,void 0,void 0,function(){var c,d,f,h,v,v;return fe(this,function(p){switch(p.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=p.sent(),or.isEmpty(d)?[2]:(f={bundle:en.fromLoci(d),groups:r},l?(h=Ut(Ut([],l.params.values.layers),[f]),v=oz(h,c),s.to(l).update(an.toBundle(v))):(v=oz([f],c),s.to(u.transform.ref).apply(st.Representation.ClippingStructureRepresentation3DFromBundle,an.toBundle(v),{tags:Fee})),[2])}})})})];case 1:return o.sent(),[2]}})})}function HXe(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ir.Generators.ofTransformer(st.Representation.ClippingStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(Fee)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function oz(e,t){var r=an.ofBundle(e,t.root),n=an.merge(r);return an.filter(n,t)}var Bee="transparency-controls";function GXe(e,t,r,n,a){return de(this,void 0,void 0,function(){var i=this;return fe(this,function(o){switch(o.label){case 0:return[4,qXe(e,t,function(s,u,l){return de(i,void 0,void 0,function(){var c,d,f,h,v,v;return fe(this,function(p){switch(p.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=p.sent(),or.isEmpty(d)?[2]:(f={bundle:en.fromLoci(d),value:r},l?(h=Ut(Ut([],l.params.values.layers),[f]),v=sz(h,c),s.to(l).update(Wa.toBundle(v))):(v=sz([f],c),s.to(u.transform.ref).apply(st.Representation.TransparencyStructureRepresentation3DFromBundle,Wa.toBundle(v),{tags:Bee})),[2])}})})})];case 1:return o.sent(),[2]}})})}function qXe(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ir.Generators.ofTransformer(st.Representation.TransparencyStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(Bee)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function sz(e,t){var r=Wa.ofBundle(e,t.root),n=Wa.merge(r);return Wa.filter(n,t)}var tv=function(e){Be(t,e);function t(r){var n=e.call(this,{options:T.getDefaultValues(t.OptionsParams)})||this;return n.plugin=r,n.events={optionsUpdated:n.ev()},n}return Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivotStructure",{get:function(){return this.currentStructures[0]},enumerable:!1,configurable:!0}),t.prototype.setOptions=function(r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d=this;return fe(this,function(f){for(n=r.interactions!==this.state.options.interactions,this.updateState({options:r}),this.events.optionsUpdated.next(),a=this.dataState.build(),i=0,o=this.currentStructures;i<o.length;i++)for(s=o[i],u=0,l=s.components;u<l.length;u++)c=l[u],this.updateReprParams(a,c);return[2,this.plugin.dataTransaction(function(){return de(d,void 0,void 0,function(){return fe(this,function(h){switch(h.label){case 0:return[4,a.commit()];case 1:return h.sent(),[4,this.plugin.state.updateBehavior(IO,function(v){v.ignoreHydrogens=!r.showHydrogens})];case 2:return h.sent(),n?[4,this.updateInterationProps()]:[3,4];case 3:h.sent(),h.label=4;case 4:return[2]}})})})]})})},t.prototype.updateReprParams=function(r,n){for(var a=this.state.options,i=a.showHydrogens,o=a.visualQuality,s=!i,u=0,l=n.representations;u<l.length;u++){var c=l[u];if(c.cell.transform.transformer===g_){var d=c.cell.transform.params;(!!d.type.params.ignoreHydrogens!==s||d.type.params.quality!==o)&&r.to(c.cell).update(function(f){f.type.params.ignoreHydrogens=s,f.type.params.quality=o})}}},t.prototype.updateInterationProps=function(){var r,n,a;return de(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f=this;return fe(this,function(h){switch(h.label){case 0:i=0,o=this.currentStructures,h.label=1;case 1:return i<o.length?(s=o[i],u=Wn.getParams((r=s.cell.obj)===null||r===void 0?void 0:r.data),s.properties?(l=(n=s.properties.cell.transform.params)===null||n===void 0?void 0:n.properties[Wn.descriptor.name],T.areEqual(u,l,this.state.options.interactions)?[3,5]:[4,this.dataState.build().to(s.properties.cell).update(function(v){v.properties[Wn.descriptor.name]=f.state.options.interactions}).commit()]):[3,3]):[3,6];case 2:return h.sent(),[3,5];case 3:return c=this.plugin.customStructureProperties.getParams((a=s.cell.obj)===null||a===void 0?void 0:a.data),d=T.getDefaultValues(c),T.areEqual(u,d.properties[Wn.descriptor.name],this.state.options.interactions)?[3,5]:(d.properties[Wn.descriptor.name]=this.state.options.interactions,[4,this.plugin.builders.structure.insertStructureProperties(s.cell,d)]);case 4:h.sent(),h.label=5;case 5:return i++,[3,1];case 6:return[2]}})})},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return de(i,void 0,void 0,function(){var o,s,u,l;return fe(this,function(c){switch(c.label){case 0:o=0,s=r,c.label=1;case 1:return o<s.length?(u=s[o],[4,this.plugin.builders.structure.representation.applyPreset(u.cell,n,a)]):[3,5];case 2:return l=c.sent(),[4,this.syncPreset(u,l)];case 3:c.sent(),c.label=4;case 4:return o++,[3,1];case 5:return[2]}})})},{canUndo:"Preset"})},t.prototype.syncPreset=function(r,n){if(!n||!n.components)return this.clearComponents([r]);var a=new Set;if(Uu(n.components,function(y){y&&a.add(y.ref)}),n.representations&&Uu(n.representations,function(y){y&&a.add(y.ref)}),a.size===0)return this.clearComponents([r]);for(var i=!1,o=this.dataState.build(),s=function(y){a.has(y.cell.transform.ref)||(i=!0,o.delete(y.cell))},u=0,l=r.components;u<l.length;u++){var c=l[u];s(c);for(var d=0,f=c.representations;d<f.length;d++){var h=f[d];s(h)}if(c.genericRepresentations)for(var v=0,p=c.genericRepresentations;v<p.length;v++){var h=p[v];s(h)}}if(r.genericRepresentations)for(var g=0,m=r.genericRepresentations;g<m.length;g++){var h=m[g];s(h)}if(i)return o.commit()},t.prototype.clear=function(r){return this.clearComponents(r)},t.prototype.selectThis=function(r){var n,a=this.plugin.managers.structure.selection;a.clear();for(var i=0,o=r;i<o.length;i++){var s=o[i],u=tt.toSubStructureElementLoci(s.structure.cell.obj.data,(n=s.cell.obj)===null||n===void 0?void 0:n.data);a.fromLoci("set",u)}},t.prototype.canBeModified=function(r){return this.plugin.builders.structure.isComponentTransform(r.cell)},t.prototype.modifyByCurrentSelection=function(r,n){var a=this;return this.plugin.runTask(et.create("Modify Component",function(i){return de(a,void 0,void 0,function(){var o,s,u,l,c;return fe(this,function(d){switch(d.label){case 0:for(o=this.dataState.build(),s=0,u=r;s<u.length;s++)l=u[s],this.canBeModified(l)&&(c=this.plugin.managers.structure.selection.getStructure(l.structure.cell.obj.data),!(!c||c.elementCount===0)&&this.modifyComponent(o,l,c,n));return[4,this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(i)];case 1:return d.sent(),[2]}})})}))},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)if(n)for(var u=r[0].representations.indexOf(n),a=!n.cell.state.isHidden,l=0,c=r;l<c.length;l++){var s=c[l],d=s.representations[u];d&&Jp(this.dataState,d.cell.transform.ref,a)}else for(var a=!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];Jp(this.dataState,s.cell.transform.ref,a)}},t.prototype.removeRepresentations=function(r,n){if(r.length!==0){var a=[];if(n){var i=r[0].representations.indexOf(n);if(i<0)return;for(var o=0,s=r;o<s.length;o++){var u=s[o];u.representations[i]&&a.push(u.representations[i])}}else for(var l=0,c=r;l<c.length;l++)for(var u=c[l],d=0,f=u.representations;d<f.length;d++){var h=f[d];a.push(h)}return this.plugin.managers.structure.hierarchy.remove(a,!0)}},t.prototype.updateRepresentations=function(r,n,a){if(r.length===0)return Promise.resolve();var i=r[0].representations.indexOf(n);if(i<0)return Promise.resolve();for(var o=this.dataState.build(),s=0,u=r;s<u.length;s++){var l=u[s],c=l.representations[i];c&&c.cell.transform.transformer===n.cell.transform.transformer&&o.to(c.cell).update(a)}return o.commit({canUndo:"Update Representation"})},t.prototype.updateRepresentationsTheme=function(r,n){var a,i,o,s;if(r.length!==0){for(var u=this.dataState.build(),l=0,c=r;l<c.length;l++)for(var d=c[l],f=function(m){var y=m.cell.transform.params,b=typeof n=="function"?n(d,m):n,S=b.color==="default"?MD(h.plugin,(a=d.structure.cell.obj)===null||a===void 0?void 0:a.data,y==null?void 0:y.type.name):b.color?MD(h.plugin,(i=d.structure.cell.obj)===null||i===void 0?void 0:i.data,y==null?void 0:y.type.name,b.color,b.colorParams):void 0,x=b.size==="default"?Ej(h.plugin,(o=d.structure.cell.obj)===null||o===void 0?void 0:o.data,y==null?void 0:y.type.name):b.color?Ej(h.plugin,(s=d.structure.cell.obj)===null||s===void 0?void 0:s.data,y==null?void 0:y.type.name,b.size,b.sizeParams):void 0;(S||x)&&u.to(m.cell).update(function(C){S&&(C.colorTheme=S),x&&(C.sizeTheme=x)})},h=this,v=0,p=d.representations;v<p.length;v++){var g=p[v];f(g)}return u.commit({canUndo:"Update Theme"})}},t.prototype.addRepresentation=function(r,n){var a=this;if(r.length!==0){var i=this.state.options,o=i.showHydrogens,s=i.visualQuality,u=!o,l={ignoreHydrogens:u,quality:s};return this.plugin.dataTransaction(function(){return de(a,void 0,void 0,function(){var c,d,f;return fe(this,function(h){switch(h.label){case 0:c=0,d=r,h.label=1;case 1:return c<d.length?(f=d[c],[4,this.plugin.builders.structure.representation.addRepresentation(f.cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:l})]):[3,4];case 2:h.sent(),h.label=3;case 3:return c++,[3,1];case 4:return[2]}})})},{canUndo:"Add Representation"})}},t.prototype.tryFindComponent=function(r,n){var a=this;if(r.components.length!==0)return this.plugin.runTask(et.create("Find Component",function(i){return de(a,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p;return fe(this,function(g){switch(g.label){case 0:return o=(v=r.cell.obj)===null||v===void 0?void 0:v.data,o?(l=(u=yt).unionStructure,[4,n.getSelection(this.plugin,i,o)]):[2];case 1:for(s=l.apply(u,[g.sent()]),c=0,d=r.components;c<d.length;c++)if(f=d[c],h=(p=f.cell.obj)===null||p===void 0?void 0:p.data,!(!h||!f.cell.parent)&&CMe(s,h))return[2,f.cell];return[2]}})})}))},t.prototype.add=function(r,n){return de(this,void 0,void 0,function(){var a=this;return fe(this,function(i){return[2,this.plugin.dataTransaction(function(){return de(a,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,g;return fe(this,function(m){switch(m.label){case 0:if(o=n||this.currentStructures,o.length===0)return[2];s=this.state.options,u=s.showHydrogens,l=s.visualQuality,c=!u,d={ignoreHydrogens:c,quality:l},f=pn.create22(),h=0,v=o,m.label=1;case 1:return h<v.length?(p=v[h],g=void 0,r.options.checkExisting?[4,this.tryFindComponent(p,r.selection)]:[3,3]):[3,8];case 2:g=m.sent(),m.label=3;case 3:return g?[3,5]:[4,this.plugin.builders.structure.tryCreateComponentFromSelection(p.cell,r.selection,f,{label:r.options.label||(r.selection===ma.current?"Custom Selection":"")})];case 4:g=m.sent(),m.label=5;case 5:return r.representation==="none"||!g?[3,7]:[4,this.plugin.builders.structure.representation.addRepresentation(g,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:d})];case 6:m.sent(),m.label=7;case 7:return h++,[3,1];case 8:return[2]}})})},{canUndo:"Add Selection"})]})})},t.prototype.applyTheme=function(r,n){return de(this,void 0,void 0,function(){var a=this;return fe(this,function(i){return[2,this.plugin.dataTransaction(function(o){return de(a,void 0,void 0,function(){var s,u,l,c,d,f,f,f,h=this;return fe(this,function(v){switch(v.label){case 0:if(s=n||this.currentStructures,s.length===0)return[2];u=function(p){return de(h,void 0,void 0,function(){var g,m;return fe(this,function(y){switch(y.label){case 0:return m=(g=yt).toLociWithSourceUnits,[4,r.selection.getSelection(this.plugin,o,p)];case 1:return[2,m.apply(g,[y.sent()])]}})})},l=0,c=s,v.label=1;case 1:return l<c.length?(d=c[l],r.action.name!=="reset"?[3,3]:[4,az(this.plugin,d.components,-1,u,r.representations)]):[3,10];case 2:return v.sent(),[3,9];case 3:return r.action.name!=="color"?[3,5]:(f=r.action.params,[4,az(this.plugin,d.components,f.color,u,r.representations)]);case 4:return v.sent(),[3,9];case 5:return r.action.name!=="transparency"?[3,7]:(f=r.action.params,[4,GXe(this.plugin,d.components,f.value,u,r.representations)]);case 6:return v.sent(),[3,9];case 7:return r.action.name!=="clipping"?[3,9]:(f=r.action.params,[4,VXe(this.plugin,d.components,an.Groups.fromNames(f.excludeGroups),u,r.representations)]);case 8:v.sent(),v.label=9;case 9:return l++,[3,1];case 10:return[2]}})})},{canUndo:"Apply Theme"})]})})},t.prototype.modifyComponent=function(r,n,a,i){var o,s,u,l=(o=n.cell.obj)===null||o===void 0?void 0:o.data;if(l&&!((i==="subtract"||i==="intersect")&&!A3(l,a))){var c=(s=n.structure.cell.obj)===null||s===void 0?void 0:s.data,d=i==="union"?rb(c,[l,a]):i==="intersect"?vK(l,a):Gk(l,a);if(d.elementCount===0)r.delete(n.cell.transform.ref);else{var f=en.fromSubStructure(c,d),h={type:{name:"bundle",params:f},nullIfEmpty:!0,label:(u=n.cell.obj)===null||u===void 0?void 0:u.label};r.to(n.cell).update(h)}}},t.prototype.updateLabel=function(r,n){var a,i,o={type:(a=r.cell.params)===null||a===void 0?void 0:a.values.type,nullIfEmpty:(i=r.cell.params)===null||i===void 0?void 0:i.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()},Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),t.prototype.clearComponents=function(r){for(var n=this.dataState.build(),a=0,i=r;a<i.length;a++)for(var o=i[a],s=0,u=o.components;s<u.length;s++){var l=u[s];n.delete(l.cell.transform.ref)}return n.commit({canUndo:"Clear Selections"})},t}(Ed);(function(e){e.OptionsParams={showHydrogens:T.Boolean(!0,{description:"Toggle display of hydrogen atoms in representations"}),visualQuality:T.Select("auto",kk,{description:"Control the visual/rendering quality of representations"}),interactions:T.Group(Wn.defaultParams,{label:"Non-covalent Interactions"})};function t(i,o){var s=i.query.structure.registry.options;return o=E({pivot:i.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1},o),{selection:T.Select(s[1][0],s,{isHidden:o==null?void 0:o.hideSelection}),representation:a(i,o==null?void 0:o.pivot,o!=null&&o.allowNone?[["none","< Create Later >"]]:[]),options:T.Group({label:T.Text(""),checkExisting:T.Boolean(!!(o!=null&&o.checkExisting),{help:function(){return{description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."}}})})}}e.getAddParams=t;function r(i,o){var s=i.query.structure.registry.options;return{selection:T.Select(s[1][0],s,{isHidden:!1}),action:T.MappedStatic("color",{color:T.Group({color:T.Color(dr.blue,{isExpanded:!0})},{isFlat:!0}),reset:T.EmptyGroup({label:"Reset Color"}),transparency:T.Group({value:T.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),clipping:T.Group({excludeGroups:T.MultiSelect([],T.objectToOptions(an.Groups.Names))},{isFlat:!0})}),representations:T.MultiSelect([],n(i,o),{emptyValue:"All"})}}e.getThemeParams=r;function n(i,o){var s,u;return!((s=o==null?void 0:o.cell.obj)===null||s===void 0)&&s.data?i.representation.structure.registry.getApplicableTypes((u=o.cell.obj)===null||u===void 0?void 0:u.data):i.representation.structure.registry.types}e.getRepresentationTypes=n;function a(i,o,s,u){var l=Ut(Ut([],s),n(i,o));return T.Select(l[0][0],l,{label:u})}})(tv||(tv={}));var n1;(function(e){function t(i,o){return{key:i,data:o}}function r(i){return{entries:bM(),capacity:Math.max(1,i)}}e.create=r;function n(i,o){for(var s=i.entries.first;s;s=s.next)if(s.value.key===o)return i.entries.remove(s),i.entries.addLast(s.value),s.value.data}e.get=n;function a(i,o,s){var u=void 0;if(i.entries.count>=i.capacity){var l=i.entries.first;u=l.value.data,i.entries.remove(l)}return i.entries.addLast(t(o,s)),u}e.set=a})(n1||(n1={}));var Li=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ge.CreateBehavior({name:"Volume Streaming"}));(function(e){e.RootTag="volume-streaming-info";function t(o,s,u,l,c){var d,f,h,v;return c===void 0&&(c={}),T.Group({isoValue:_t.createIsoValueParam((d=c.isoValue)!==null&&d!==void 0?d:u,l),color:T.Color((f=c.color)!==null&&f!==void 0?f:s),wireframe:T.Boolean((h=c.wireframe)!==null&&h!==void 0?h:!1),opacity:T.Numeric((v=c.opacity)!==null&&v!==void 0?v:.3,{min:0,max:1,step:.01})},{label:o,isExpanded:!0})}var r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(o){o===void 0&&(o={});var s=o.data,u=o.defaultView,l=o.channelParams,c=new Map;s&&s.entries.forEach(function(h){return c.set(h.dataId,h)});var d=s?s.entries.map(function(h){return[h.dataId,h.dataId]}):[],f=s?s.entries[0].dataId:"";return{entry:T.Mapped(f,d,function(h){return T.Group(a({entryData:c.get(h),defaultView:u,structure:s&&s.structure,channelParams:l}))})}}e.createParams=n;function a(o){var s=o.entryData,u=o.defaultView,l=o.structure,c=o.channelParams,d=c===void 0?{}:c,f=s||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:_t.IsoValue.relative(0)},h=l&&l.boundary.box||Yt();return{view:T.MappedStatic(u||(f.kind==="em"?"cell":"selection-box"),{off:T.Group({}),box:T.Group({bottomLeft:T.Vec3(h.min),topRight:T.Vec3(h.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":T.Group({radius:T.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in Å within which the volume is shown."}),bottomLeft:T.Vec3(_.create(0,0,0),{},{isHidden:!0}),topRight:T.Vec3(_.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),cell:T.Group({}),auto:T.Group({radius:T.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in Å within which the volume is shown."}),selectionDetailLevel:T.Select(Math.min(6,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(v,p){return[p,p+1+" [ "+(Math.pow(v.maxVoxels,1/3)|0)+"^3 cells ]"]}),{label:"Selection Detail",description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),isSelection:T.Boolean(!1,{isHidden:!0}),bottomLeft:T.Vec3(h.min,{},{isHidden:!0}),topRight:T.Vec3(h.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:T.Select(Math.min(3,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(v,p){return[p,p+1+" [ "+(Math.pow(v.maxVoxels,1/3)|0)+"^3 cells ]"]}),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),channels:f.kind==="em"?T.Group({em:t("EM",dt(6524815),f.emDefaultContourLevel||_t.IsoValue.relative(1),f.header.sampling[0].valuesInfo[0],d.em)},{isFlat:!0}):T.Group({"2fo-fc":t("2Fo-Fc",dt(3367602),_t.IsoValue.relative(1.5),f.header.sampling[0].valuesInfo[0],d["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",dt(3390259),_t.IsoValue.relative(3),f.header.sampling[0].valuesInfo[1],d["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",dt(12268339),_t.IsoValue.relative(-3),f.header.sampling[0].valuesInfo[1],d["fo-fc(-ve)"])},{isFlat:!0})}}e.createEntryParams=a,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];var i=function(o){Be(s,o);function s(u,l){var c=o.call(this,u,{})||this;return c.plugin=u,c.data=l,c.cache=n1.create(25),c.params={},c.lastLoci=Or,c.ref="",c.channels={},c._invTransform=le(),c.infoMap=new Map,c.data.entries.forEach(function(d){return c.infoMap.set(d.dataId,d)}),c}return Object.defineProperty(s.prototype,"info",{get:function(){return this.infoMap.get(this.params.entry.name)},enumerable:!1,configurable:!0}),s.prototype.queryData=function(u){return de(this,void 0,void 0,function(){var l,c,d,f,h,v,p,g,m;return fe(this,function(y){switch(y.label){case 0:return l=Z3(this.data.serverUrl,this.info.kind+"/"+this.info.dataId.toLowerCase()),u?(c=u.min,d=u.max,l+="/box"+("/"+c.map(function(b){return Math.round(1e3*b)/1e3}).join(","))+("/"+d.map(function(b){return Math.round(1e3*b)/1e3}).join(","))):l+="/cell",f=this.params.entry.params.detailLevel,this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(f=this.params.entry.params.view.params.selectionDetailLevel),l+="?detail="+f,h=n1.get(this.cache,l),h?[2,h.data]:(v=Pn.getUrlAsset(this.plugin.managers.asset,l),[4,this.plugin.runTask(this.plugin.managers.asset.resolve(v,"binary"))]);case 1:return p=y.sent(),[4,this.parseCif(p.data)];case 2:return g=y.sent(),g?(m=n1.set(this.cache,l,{data:g,asset:p}),m&&m.asset.dispose(),[2,g]):[2]}})})},s.prototype.parseCif=function(u){return de(this,void 0,void 0,function(){var l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:return[4,this.plugin.runTask(Xc.parseBinary(u))];case 1:if(l=p.sent(),l.isError)return this.plugin.log.error("VolumeStreaming, parsing CIF: "+l.toString()),[2];if(l.result.blocks.length<2)return this.plugin.log.error("VolumeStreaming: Invalid data."),[2];c={},d=1,p.label=2;case 2:return d<l.result.blocks.length?(f=l.result.blocks[d],h=Xc.schema.densityServer(f),[4,this.plugin.runTask(NQ(h))]):[3,5];case 3:v=p.sent(),c[f.header]=v,p.label=4;case 4:return d++,[3,2];case 5:return[2,c]}})})},s.prototype.updateSelectionBoxParams=function(u){if(this.params.entry.params.view.name==="selection-box"){var l=this.plugin.state.data,c=E(E({},this.params),{entry:{name:this.params.entry.name,params:E(E({},this.params.entry.params),{view:{name:"selection-box",params:{radius:this.params.entry.params.view.params.radius,bottomLeft:u.min,topRight:u.max}}})}}),d=l.build().to(this.ref).update(c);wt.State.Update(this.plugin,{state:l,tree:d,options:{doNotUpdateCurrent:!0}})}},s.prototype.updateAutoParams=function(u,l){if(this.params.entry.params.view.name==="auto"){var c=this.plugin.state.data,d=E(E({},this.params),{entry:{name:this.params.entry.name,params:E(E({},this.params.entry.params),{view:{name:"auto",params:{radius:this.params.entry.params.view.params.radius,selectionDetailLevel:this.params.entry.params.view.params.selectionDetailLevel,isSelection:l,bottomLeft:(u==null?void 0:u.min)||_.zero(),topRight:(u==null?void 0:u.max)||_.zero()}}})}}),f=c.build().to(this.ref).update(d);wt.State.Update(this.plugin,{state:c,tree:f,options:{doNotUpdateCurrent:!0}})}},s.prototype.getStructureRoot=function(){return this.plugin.state.data.select(ir.Generators.byRef(this.ref).rootOfType(ge.Molecule.Structure))[0]},s.prototype.register=function(u){var l=this;this.ref=u,this.subscribeObservable(this.plugin.state.events.object.removed,function(c){!ge.Molecule.Structure.is(c.obj)||!Oe.is(l.lastLoci)||l.lastLoci.structure===c.obj.data&&(l.lastLoci=Or)}),this.subscribeObservable(this.plugin.state.events.object.updated,function(c){!ge.Molecule.Structure.is(c.oldObj)||!Oe.is(l.lastLoci)||l.lastLoci.structure===c.oldObj.data&&(l.lastLoci=Or)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(c){if(l.plugin.state.data.tree.children.has(l.ref)){var d=c?c.loci:Or;switch(l.params.entry.params.view.name){case"auto":l.updateAuto(d);break;case"selection-box":l.updateSelectionBox(d);break;default:l.lastLoci=d;break}}})},s.prototype.unregister=function(){for(var u=this.cache.entries.first;u;)u.value.data.asset.dispose(),u=u.next},s.prototype.getBoxFromLoci=function(u){var l,c,d;if(or.isEmpty(u))return Yt();var f=this.plugin.helpers.substructureParent.get(u.structure,!0);if(!f)return Yt();var h=this.getStructureRoot();if(!h||((l=h.obj)===null||l===void 0?void 0:l.data)!==((c=f.obj)===null||c===void 0?void 0:c.data))return Yt();var v=xp.get((d=h.obj)===null||d===void 0?void 0:d.data.models[0]);v&&le.invert(this._invTransform,v);var p=Oe.extendToWholeResidues(u),g=Oe.getBoundary(p,v&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return Oe.size(p)===1&&Yt.expand(g,g,_.create(1,1,1)),g},s.prototype.updateAuto=function(u){if(this.lastLoci=u,Mu(u)){this.updateAutoParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1);return}var l=this.getBoxFromLoci(u);this.updateAutoParams(l,!0)},s.prototype.updateSelectionBox=function(u){if(or.areEqual(this.lastLoci,u)){this.lastLoci=Or,this.updateSelectionBoxParams(Yt());return}if(this.lastLoci=u,Mu(u)){this.updateSelectionBoxParams(Yt());return}var l=this.getBoxFromLoci(u);this.updateSelectionBoxParams(l)},s.prototype.update=function(u){return de(this,void 0,void 0,function(){var l,c,d,f,f,h,v,p;return fe(this,function(g){switch(g.label){case 0:switch(l=u.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box",this.params=u,c=void 0,d=!1,u.entry.params.view.name){case"off":d=!0;break;case"box":c=Yt.create(u.entry.params.view.params.bottomLeft,u.entry.params.view.params.topRight),d=Yt.volume(c)<1e-4;break;case"selection-box":{l?c=this.getBoxFromLoci(this.lastLoci)||Yt():c=Yt.create(_.clone(u.entry.params.view.params.bottomLeft),_.clone(u.entry.params.view.params.topRight)),f=u.entry.params.view.params.radius,d=Yt.volume(c)<1e-4,Yt.expand(c,c,_.create(f,f,f));break}case"cell":c=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":c=u.entry.params.view.params.isSelection||this.info.kind==="x-ray"?Yt.create(_.clone(u.entry.params.view.params.bottomLeft),_.clone(u.entry.params.view.params.topRight)):void 0,c&&(d=Yt.volume(c)<1e-4,u.entry.params.view.params.isSelection&&(f=u.entry.params.view.params.radius,Yt.expand(c,c,_.create(f,f,f))));break}return d?(v={},[3,3]):[3,1];case 1:return[4,this.queryData(c)];case 2:v=g.sent(),g.label=3;case 3:return h=v,h?(p=u.entry.params.channels,this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(h["2FO-FC"]||_t.One,p["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(h["FO-FC"]||_t.One,p["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(h["FO-FC"]||_t.One,p["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(h.EM||_t.One,p.em,this.info.header.sampling[0].valuesInfo[0]),[2,!0]):[2,!1]}})})},s.prototype.createChannel=function(u,l,c){var d=l;return{data:u,color:d.color,wireframe:d.wireframe,opacity:d.opacity,isoValue:d.isoValue.kind==="relative"?d.isoValue:_t.IsoValue.toRelative(d.isoValue,c)}},s.prototype.getDescription=function(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""},s}(Dr.WithSubscribers);e.Behavior=i})(Li||(Li={}));function WXe(e,t){var r=nYe(e,t||FO());return sYe(e.tree,r),t&&t.refs.forEach(iYe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function FO(){return{trajectories:[],models:[],structures:[],refs:new Map}}function $Xe(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function uz(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function XXe(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function YXe(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function lz(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function KXe(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function QXe(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function ZXe(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function JXe(e){return e.transform.tags?Ut([],e.transform.tags).sort().join():e.transform.ref}function eYe(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:JXe(e),representations:[]}}function tYe(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function rYe(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function nYe(e,t){return{state:e,oldHierarchy:t,hierarchy:FO(),changed:!1,added:new Set}}function Qv(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function kh(e,t,r){for(var n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];var i=r.apply(void 0,n);e.hierarchy.refs.set(t.transform.ref,i);var o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function cz(e){return function(t){return e.is(t.obj)}}function dz(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function bx(e){return function(t){return t.transform.transformer===e}}function Oh(){}var aYe=[[cz(ge.Molecule.Trajectory),function(e,t){e.currentTrajectory=Qv(e,t,e.hierarchy.trajectories,$Xe,t)},function(e){return e.currentTrajectory=void 0}],[dz(ge.Molecule.Model,function(e){return e.currentModel}),function(e,t){e.currentTrajectory?e.currentModel=Qv(e,t,e.currentTrajectory.models,uz,t,e.currentTrajectory):e.currentModel=kh(e,t,uz,t),e.hierarchy.models.push(e.currentModel)},function(e){return e.currentModel=void 0}],[bx(st.Model.CustomModelProperties),function(e,t){if(!e.currentModel)return!1;e.currentModel.properties=kh(e,t,XXe,t,e.currentModel)},Oh],[bx(st.Representation.ModelUnitcell3D),function(e,t){if(!e.currentModel)return!1;e.currentModel.unitcell=kh(e,t,YXe,t,e.currentModel)},Oh],[dz(ge.Molecule.Structure,function(e){return e.currentStructure}),function(e,t){e.currentModel?e.currentStructure=Qv(e,t,e.currentModel.structures,lz,t,e.currentModel):e.currentStructure=kh(e,t,lz,t),e.hierarchy.structures.push(e.currentStructure)},function(e){return e.currentStructure=void 0}],[bx(st.Model.CustomStructureProperties),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.properties=kh(e,t,KXe,t,e.currentStructure)},Oh],[bx(st.Model.TransformStructureConformation),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.transform=kh(e,t,QXe,t,e.currentStructure)},Oh],[cz(Li),function(e,t){return e.currentStructure&&(e.currentStructure.volumeStreaming=kh(e,t,ZXe,t,e.currentStructure)),!1},Oh],[function(e,t){return t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:ge.Molecule.Structure.is(e.obj)},function(e,t){e.currentStructure&&(e.currentComponent=Qv(e,t,e.currentStructure.components,eYe,t,e.currentStructure))},function(e){return e.currentComponent=void 0}],[function(e,t){return!e.state.isGhost&&!!t.currentComponent&&ge.Molecule.Structure.Representation3D.is(e.obj)},function(e,t){return e.currentComponent&&Qv(e,t,e.currentComponent.representations,tYe,t,e.currentComponent),!1},Oh],[function(e){return!e.state.isGhost&&ge.isRepresentation3D(e.obj)},function(e,t){var r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),Qv(e,t,r.genericRepresentations,rYe,t,r))},Oh]];function Uee(e){if(!e||!(e!=null&&e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===On.Null||e.status!=="ok"&&e.status!=="error")}function iYe(e){var t=e.cell;Uee(t)||(this.changed=!0)}function oYe(e){jee(this,this.tree.transforms.get(e))}function jee(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(Uee(n)){for(var a=void 0,i=!1,o=0,s=aYe;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){i=!0;break}a=d;break}}if(!i){var h=e.tree.children.get(t.ref);h&&h.size&&h.forEach(oYe,e),a&&a(r)}}}function sYe(e,t){var r={tree:e,state:t};return jee(r,e.root),r.state}var ub=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:FO(),selection:{trajectories:[],models:[],structures:[]}},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,trajectories:n.selection.trajectories,models:n.selection.models,structures:n.selection.structures})},n._currentComponentGroups=void 0,n._currentSelectionSet=void 0,n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentComponentGroups",{get:function(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=t.getComponentGroups(this.selection.structures),this._currentComponentGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seletionSet",{get:function(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(var r=0,n=this.selection.trajectories;r<n.length;r++){var a=n[r];this._currentSelectionSet.add(a.cell.transform.ref)}for(var i=0,o=this.selection.models;i<o.length;i++){var a=o[i];this._currentSelectionSet.add(a.cell.transform.ref)}for(var s=0,u=this.selection.structures;s<u.length;s++){var a=u[s];this._currentSelectionSet.add(a.cell.transform.ref)}return this._currentSelectionSet},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.getStructuresWithSelection=function(){for(var r=this.plugin.managers.structure.hierarchy.current.structures,n=[],a=0,i=r;a<i.length;a++){var o=i[a];this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o)}return n},t.prototype.syncCurrent=function(r,n){for(var a=this.seletionSet,i=[],o=0,s=r;o<s.length;o++){var u=s[o],l=u.cell.transform.ref;(a.has(l)||n.has(l))&&i.push(u)}return i.length===0?r.length>0?[r[0]]:[]:i},t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next(E({hierarchy:this.state.hierarchy},this.state.selection)));return}this.state.syncedTree=this.dataState.tree;var n=WXe(this.plugin.state.data,this.current);if(n.changed){var a=n.hierarchy,i=this.syncCurrent(a.trajectories,n.added),o=this.syncCurrent(a.models,n.added),s=this.syncCurrent(a.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=a,this.state.selection.trajectories=i,this.state.selection.models=o,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,trajectories:i,models:o,structures:s})):this.state.notified=!1}}},t.prototype.updateCurrent=function(r,n){for(var a=this.current,i=n==="add"?fa.union(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))):fa.difference(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))),o=[],s=[],u=[],l=0,c=a.trajectories;l<c.length;l++){var d=c[l];i.has(d.cell.transform.ref)&&o.push(d)}for(var f=0,h=a.models;f<h.length;f++){var v=h[f];i.has(v.cell.transform.ref)&&s.push(v)}for(var p=0,g=a.structures;p<g.length;p++){var m=g[p];i.has(m.cell.transform.ref)&&u.push(m)}this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=u,this.behaviors.selection.next({hierarchy:a,trajectories:o,models:s,structures:u})},t.prototype.remove=function(r,n){if(r.length!==0){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete(typeof s=="string"?s:s.cell.transform.ref)}return a.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var a=n!==void 0?n!=="show":!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];Jp(this.dataState,s.cell.transform.ref,a)}},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return de(i,void 0,void 0,function(){var o,s,u;return fe(this,function(l){switch(l.label){case 0:o=0,s=r,l.label=1;case 1:return o<s.length?(u=s[o],u.models.length>0?[4,this.clearTrajectory(u)]:[3,3]):[3,6];case 2:l.sent(),l.label=3;case 3:return[4,this.plugin.builders.structure.hierarchy.applyPreset(u.cell,n,a)];case 4:l.sent(),l.label=5;case 5:return o++,[3,1];case 6:return[2]}})})})},t.prototype.updateStructure=function(r,n){return de(this,void 0,void 0,function(){var a=this;return fe(this,function(i){switch(i.label){case 0:return[4,this.plugin.dataTransaction(function(){return de(a,void 0,void 0,function(){var o,s;return fe(this,function(u){switch(u.label){case 0:return o=sa.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),s=this.dataState.tree.children.get(o).toArray(),[4,this.remove(s,!1)];case 1:return u.sent(),[4,this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type")];case 2:return u.sent(),[4,this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")];case 3:return u.sent(),[2]}})})},{canUndo:"Structure Type"})];case 1:return i.sent(),wt.Camera.Reset(this.plugin),[2]}})})},t.prototype.clearTrajectory=function(r){for(var n=this.dataState.build(),a=0,i=r.models;a<i.length;a++){var o=i[a];n.delete(o.cell)}return n.commit()},t}(zb);(function(e){function t(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(function(v){return[v]});for(var a=[],i=new Map,o=0,s=n;o<s.length;o++)for(var u=s[o],l=0,c=u.components;l<c.length;l++){var d=c[l],f=d.key;if(f){var h=i.get(f);h||(h=[],i.set(f,h),a.push(h)),h.push(d)}}return a}e.getComponentGroups=t;function r(n){var a,i,o,s,u,l,c,d,f,h=n.managers.structure.hierarchy.selection.structures;if(h.length===0)return"";if(h.length===1){var v=h[0],p=(a=v.cell.obj)===null||a===void 0?void 0:a.data;if(!p)return((i=v.cell.obj)===null||i===void 0?void 0:i.label)||"Structure";var g=p.models[0]||p.representativeModel||p.masterModel;if(!g)return((o=v.cell.obj)===null||o===void 0?void 0:o.label)||"Structure";var m=g.entryId;return!((u=(s=v.model)===null||s===void 0?void 0:s.trajectory)===null||u===void 0)&&u.models&&v.model.trajectory.models.length===1?m:v.model?((l=v.model.cell.obj)===null||l===void 0?void 0:l.label)+" | "+m:m}for(var y=h[0],b=(c=y==null?void 0:y.model)===null||c===void 0?void 0:c.trajectory,S=!0,x=0,C=h;x<C.length;x++){var v=C[x];if(((d=v==null?void 0:v.model)===null||d===void 0?void 0:d.trajectory)!==b){S=!1;break}}return S&&b?((f=b.cell.obj)===null||f===void 0?void 0:f.label)+" | "+h.length+" structures":h.length+" structures"}e.getSelectedStructuresDescription=r})(ub||(ub={}));var rv=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a,i=n.name,o=n.value,s=E(E({},r.props.params),(a={},a[i]=o,a));r.props.events.onChange(s,r.areInitial(s),r.validate(s))},r}return t.prototype.validate=function(r){},t.prototype.areInitial=function(r){return T.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.render=function(){return M.jsx(Un,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)},t}(Ka);(function(e){function t(a){for(var i=Object.keys(a),o=0,s=i;o<s.length;o++){var u=s[o];if(!a[u].isHidden)return!1}return!0}function r(a,i,o,s){var u=i.cells.get(s).obj,l=o.definition.params?o.definition.params(u,a):{},c=T.getDefaultValues(l);return{initialValues:c,params:l,isEmpty:t(l)}}e.infoFromAction=r;function n(a,i,o){var s=i.cells.get(o.ref),u=s.params&&s.params.definition||{},l=s.params&&s.params.values||{};return{initialValues:l,params:u,isEmpty:t(u)}}e.infoFromTransform=n})(rv||(rv={}));var zee=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.busy=new ta,r.onEnter=function(){r.state.error||r.apply()},r.autoApplyHandle=void 0,r.events={onEnter:r.onEnter,onChange:function(n,a,i){r.clearAutoApply(),r.setState({params:n,isInitial:a,error:i&&i[0]},function(){!a&&!r.state.error&&r.canAutoApply(n)&&(r.clearAutoApply(),r.autoApplyHandle=setTimeout(r.apply,50))})}},r.apply=function(){return de(r,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:this.clearAutoApply(),this.setState({busy:!0}),i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,this.applyAction()];case 2:return i.sent(),[3,5];case 3:return i.sent(),[3,5];case 4:return(a=(n=this.props).onApply)===null||a===void 0||a.call(n),this.busy.next(!1),[7];case 5:return[2]}})})},r.refresh=function(){r.setState({params:r.getInfo().initialValues,isInitial:!0,error:void 0})},r.setDefault=function(){var n=r.getInfo(),a=T.getDefaultValues(n.params);r.setState({params:a,isInitial:T.areEqual(n.params,a,n.initialValues),error:void 0})},r.toggleExpanded=function(){r.setState({isCollapsed:!r.state.isCollapsed})},r}return t.prototype.clearAutoApply=function(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.state.busy!==n&&r.busy.next(n)}),this.subscribe(this.busy,function(n){r.state.busy!==n&&r.setState({busy:n})})},t.prototype.renderApply=function(){var r=this.canApply();return this.props.autoHideApply&&(!r||this.canAutoApply(this.state.params))?null:M.jsxs("div",E({className:"msp-transform-apply-wrap"},{children:[M.jsx(qt,{svg:iM,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"},void 0),M.jsx("div",E({className:"msp-transform-apply-wider"},{children:M.jsx(pr,E({icon:r?$g:void 0,className:"msp-btn-commit msp-btn-commit-"+(r?"on":"off"),onClick:this.apply,disabled:!r},{children:this.props.applyLabel||this.applyText()}),void 0)}),void 0)]}),void 0)},t.prototype.renderDefault=function(){var r=this.getInfo(),n=r.isEmpty&&this.isUpdate(),a=this.getHeader(),i=this.getTransformerId(),o=this.plugin.customParamEditors.has(i)?this.plugin.customParamEditors.get(i):rv,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",u=null;if(!n&&!this.state.isCollapsed){var l=this.getSourceAndTarget(),c=l.a,d=l.b,f=l.bCell,h=this.renderApply();u=M.jsxs(M.Fragment,{children:[M.jsx(o,{info:r,a:c,b:d,bCell:f,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0),h]},void 0)}var v=M.jsxs("div",E({className:s,style:{marginBottom:this.props.noMargin?0:void 0}},{children:[a!=="none"&&!this.props.wrapInExpander&&M.jsx("div",E({className:"msp-transform-header"},{children:M.jsxs(pr,E({onClick:this.toggleExpanded,title:a.description},{children:[!n&&M.jsx(on,{svg:this.state.isCollapsed?Gc:Hc},void 0),a.name]}),void 0)}),void 0),u]}),void 0);return n||!this.props.wrapInExpander?v:M.jsx(Bu,E({header:this.isUpdate()?"Update "+(a==="none"?"":a.name):"Apply "+(a==="none"?"":a.name),headerLeftMargin:this.props.expanderHeaderLeftMargin},{children:v}),void 0)},t.prototype.renderSimple=function(){var r,n,a,i=this.getInfo(),o=this.canApply(),s=M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsx(pr,E({icon:(r=this.props.simpleApply)===null||r===void 0?void 0:r.icon,title:(n=this.props.simpleApply)===null||n===void 0?void 0:n.title,disabled:this.state.busy||!o,onClick:this.apply,className:"msp-btn-apply-simple"},{children:(a=this.props.simpleApply)===null||a===void 0?void 0:a.header}),void 0),!i.isEmpty&&M.jsx(Ra,{icon:jp,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0);if(this.state.isCollapsed)return s;var u=this.getTransformerId(),l=this.plugin.customParamEditors.has(u)?this.plugin.customParamEditors.get(u):rv,c=this.getSourceAndTarget(),d=c.a,f=c.b,h=c.bCell;return M.jsxs(M.Fragment,{children:[s,M.jsx(l,{info:i,a:d,b:f,bCell:h,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0)]},void 0)},t.prototype.render=function(){return this.props.simpleApply?this.renderSimple():this.renderDefault()},t}(Ka),nd=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=rh(function(n){return rv.infoFromTransform(r.plugin,r.props.state,n)}),r.state={error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)},t.prototype.getInfo=function(){return this._getInfo(this.props.transform)},t.prototype.getTransformerId=function(){return this.props.transform.transformer.id},t.prototype.getHeader=function(){return this.props.customHeader||this.props.transform.transformer.definition.display},t.prototype.canApply=function(){var r=this.props.state,n=r.cells.get(this.props.transform.ref);if(!n)return!1;if(n.status==="error"){var a=r.cells.get(this.props.transform.parent);return a?a.status==="ok":!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial},t.prototype.applyText=function(){return this.canApply()?"Update":"Nothing to Update"},t.prototype.isUpdate=function(){return!0},t.prototype.getSourceAndTarget=function(){var r=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:r==null?void 0:r.obj,bCell:r}},t.prototype.canAutoApply=function(r){var n=this.props.transform.transformer.definition.canAutoUpdate;if(!n)return!1;var a=this.props.state,i=a.cells.get(this.props.transform.ref);if(!i||!i.sourceRef||i.status!=="ok")return!1;var o=a.cells.get(i.sourceRef);return n({a:o.obj,b:i.obj,oldParams:this.getInfo().initialValues,newParams:r},this.plugin)},t.prototype.componentDidMount=function(){var r=this;e.prototype.componentDidMount.call(this),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,function(){return r.setState({isCollapsed:!r.state.isCollapsed})}),this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state;r.props.transform.ref!==a||r.props.state!==i||r.state.params!==r.props.transform.params&&(r._getInfo=rh(function(o){return rv.infoFromTransform(r.plugin,r.props.state,o)}),r.setState({params:r.props.transform.params,isInitial:!0}))})},t.prototype.componentDidUpdate=function(r){var n;if(this.props.transform!==r.transform){var a=this.props.state.cells.get(this.props.transform.ref);this.setState({params:((n=a.params)===null||n===void 0?void 0:n.values)||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}},t}(zee);(function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state;r.props.nodeRef!==a||r.plugin.state.data!==i||r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data,n=this.props.nodeRef,a=r.cells.get(n);if(!a||a.status!=="ok"&&a.status!=="error")return null;var i=a.transform;return M.jsx(nd,{state:r,transform:i,initiallyCollapsed:this.props.initiallyCollapsed,customHeader:this.props.header},void 0)},t})(vr);var uYe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.plugin.managers.structure.hierarchy.behaviors.selection},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.current,function(){return r.forceUpdate()})},Object.defineProperty(t.prototype,"unitcell",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length===0)return null;for(var a=[],i=0,o=n.structures;i<o.length;i++){var s=o[i],u=s.model;u!=null&&u.unitcell&&(!((r=u.unitcell)===null||r===void 0)&&r.cell.obj)&&a.push(u.unitcell)}return a.length===0?null:M.jsx(fz,{refs:a,labelMultiple:"Unit Cells"},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customControls",{get:function(){var r=this,n=[];return this.plugin.genericRepresentationControls.forEach(function(a,i){var o=a(r.plugin.managers.structure.hierarchy.selection),s=o[0],u=o[1];s.length>0&&n.push(M.jsx("div",{children:M.jsx(fz,{refs:s,labelMultiple:u},void 0)},i))}),n.length>0?n:null},enumerable:!1,configurable:!0}),t.prototype.render=function(){return M.jsx(M.Fragment,{children:M.jsxs("div",E({style:{marginTop:"6px"}},{children:[this.unitcell,this.customControls]}),void 0)},void 0)},t}(Ka),fz=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showOptions:!1},r.toggleVisibility=function(n){n.preventDefault(),r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),r.pivot.cell.parent&&wt.Interactivity.Object.Highlight(r.plugin,{state:r.pivot.cell.parent,ref:r.props.refs.map(function(a){return a.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),wt.Interactivity.ClearHighlights(r.plugin)},r.focus=function(n){var a;n.preventDefault();for(var i=!0,o=0,s=r.props.refs;o<s.length;o++){var u=s[o];if(!u.cell.state.isHidden){i=!1;break}}i&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs,"show");for(var l=[],c=0,d=r.props.refs;c<d.length;c++){var u=d[c];if(!u.cell.state.isHidden){var f=(a=u.cell.obj)===null||a===void 0?void 0:a.data.repr.getLoci();f&&l.push(f)}}r.plugin.managers.camera.focusLoci(l)},r.toggleOptions=function(){return r.setState({showOptions:!r.state.showOptions})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){var a;Zf.ObjectEvent.isCell(n,(a=r.pivot)===null||a===void 0?void 0:a.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.refs[0]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props,n=r.refs,a=r.labelMultiple;if(n.length===0)return null;var i=n[0],o,s;if(n.length===1){var u=i.cell.obj;if(!u)return null;o=u==null?void 0:u.label,s=u==null?void 0:u.description}else o=n.length+" "+(a||"Objects");return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsxs("button",E({className:"msp-form-control msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o," ",M.jsx("small",{children:s},void 0)]}),void 0),M.jsx(qt,{svg:i.cell.state.isHidden?fv:hv,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:i.cell.state.isHidden?"Show":"Hide",small:!0,flex:!0},void 0),n.length===1&&M.jsx(qt,{svg:Up,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0},void 0)]}),void 0),n.length===1&&this.state.showOptions&&i.cell.parent&&M.jsx(M.Fragment,{children:M.jsx("div",E({className:"msp-control-offset"},{children:M.jsx(nd,{state:i.cell.parent,transform:i.cell.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)},void 0)]},void 0)},t}(Ka),lYe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:tM}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({description:ub.getSelectedStructuresDescription(r.plugin)})})},t.prototype.renderControls=function(){return M.jsxs(M.Fragment,{children:[M.jsx(cYe,{},void 0),M.jsx(fYe,{},void 0),M.jsx(uYe,{},void 0)]},void 0)},t}(Xg),cYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1,canUndo:!1},r.togglePreset=r.toggleAction("preset"),r.toggleAdd=r.toggleAction("add"),r.toggleOptions=r.toggleAction("options"),r.hideAction=function(){return r.setState({action:void 0})},r.applyPreset=function(n){if(r.hideAction(),!!n){var a=r.plugin.managers.structure,i=a.hierarchy.selection.structures;n.value===null?a.component.clear(i):a.component.applyPreset(i,n.value)}},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r}return Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({action:r.state.action!=="options"||n.structures.length===0?void 0:"options",isEmpty:n.structures.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:r.state.action!=="options"?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var a=n.state;r.setState({canUndo:a.canUndo})})},t.prototype.toggleAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r})}},Object.defineProperty(t.prototype,"presetControls",{get:function(){return M.jsx(er,{items:this.presetActions,onSelect:this.applyPreset},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=this.plugin.managers.structure.component.pivotStructure,n=this.plugin.builders.structure.representation.getPresets(r==null?void 0:r.cell.obj);return er.createItems(n,{label:function(a){return a.display.name},category:function(a){return a.display.group},description:function(a){return a.display.description}})},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.";return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsx(Ra,{icon:u3,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:this.state.action==="preset",disabled:this.isDisabled},void 0),M.jsx(Ra,{icon:Wg,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),M.jsx(Ra,{icon:jp,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.isDisabled},void 0),M.jsx(qt,{svg:sM,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:r},void 0)]}),void 0),this.state.action==="preset"&&this.presetControls,this.state.action==="add"&&M.jsx("div",E({className:"msp-control-offset"},{children:M.jsx(Vee,{onApply:this.hideAction},void 0)}),void 0),this.state.action==="options"&&M.jsx("div",E({className:"msp-control-offset"},{children:M.jsx(dYe,{isDisabled:this.isDisabled},void 0)}),void 0)]},void 0)},t}(Ka),Vee=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=r.createState(),r.apply=function(){var n=r.props.forSelection?r.currentStructures:r.selectedStructures;r.props.onApply(),r.plugin.managers.structure.component.add(r.state.values,n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return t.prototype.createState=function(){var r=tv.getAddParams(this.plugin);return{params:r,values:T.getDefaultValues(r)}},Object.defineProperty(t.prototype,"selectedStructures",{get:function(){return this.plugin.managers.structure.component.currentStructures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.current.structures},enumerable:!1,configurable:!0}),t.prototype.render=function(){return M.jsxs(M.Fragment,{children:[M.jsx(Un,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),M.jsx(pr,E({icon:Wg,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Create Component"}),void 0)]},void 0)},t}(Ka),dYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.update=function(n){return r.plugin.managers.structure.component.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){return M.jsx(Un,{params:tv.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled},void 0)},t}(Ka),fYe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.structure.hierarchy.currentComponentGroups;return r.length===0?null:M.jsx("div",E({style:{marginTop:"6px"}},{children:r.map(function(n){return M.jsx(hYe,{group:n},n[0].cell.transform.ref)})}),void 0)},t}(Ka),hYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group)},r.selectAction=function(n){n&&(r.setState({action:void 0}),(n==null?void 0:n.value)())},r.remove=function(){return r.plugin.managers.structure.hierarchy.remove(r.props.group,!0)},r.toggleAction=function(){return r.setState({action:r.state.action==="action"?void 0:"action"})},r.toggleLabel=function(){return r.setState({action:r.state.action==="label"?void 0:"label"})},r.highlight=function(n){n.preventDefault(),r.props.group[0].cell.parent&&wt.Interactivity.Object.Highlight(r.plugin,{state:r.props.group[0].cell.parent,ref:r.props.group.map(function(a){return a.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),wt.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){for(var n=!0,a=0,i=r.props.group;a<i.length;a++){var o=i[a];if(!o.cell.state.isHidden){n=!1;break}}n&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.group,"show"),r.plugin.managers.camera.focusSpheres(r.props.group,function(s){var u;if(!s.cell.state.isHidden)return(u=s.cell.obj)===null||u===void 0?void 0:u.data.boundary.sphere})},r.updateLabel=function(n){r.plugin.managers.structure.component.updateLabel(r.pivot,n)},r}return Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.group[0]},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){Zf.ObjectEvent.isCell(n,r.pivot.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"colorByActions",{get:function(){var r=this,n,a,i=this.plugin.managers.structure.component,o=this.pivot.representations[0],s=(n=o.cell.transform.params)===null||n===void 0?void 0:n.colorTheme.name,u=OGe(this.plugin,(a=this.pivot.cell.obj)===null||a===void 0?void 0:a.data);return er.createItemsFromSelectOptions(u,{value:function(l){return function(){return i.updateRepresentationsTheme(r.props.group,{color:l[0]})}},selected:function(l){return l[0]===s}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.plugin.managers.structure.component,a=[Ut([er.Header("Add Representation")],tv.getRepresentationTypes(this.plugin,this.props.group[0]).map(function(i){return er.Item(i[1],function(){return n.addRepresentation(r.props.group,i[0])})}))];return this.pivot.representations.length>0&&a.push(Ut([er.Header("Set Coloring",{isIndependent:!0})],this.colorByActions)),n.canBeModified(this.props.group[0])&&a.push([er.Header("Modify by Selection"),er.Item("Include",function(){return n.modifyByCurrentSelection(r.props.group,"union")},{icon:ZI}),er.Item("Subtract",function(){return n.modifyByCurrentSelection(r.props.group,"subtract")},{icon:JI}),er.Item("Intersect",function(){return n.modifyByCurrentSelection(r.props.group,"intersect")},{icon:eM})]),a.push(er.Item("Select This",function(){return n.selectThis(r.props.group)},{icon:BC})),n.canBeModified(this.props.group[0])&&a.push(er.Item("Edit Label",this.toggleLabel)),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reprLabel",{get:function(){var r,n=this.pivot;return n.representations.length===0?"No repr.":n.representations.length===1?(r=n.representations[0].cell.obj)===null||r===void 0?void 0:r.label:n.representations.length+" reprs"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n,a=this.pivot,i=a.cell,o=(n=i.obj)===null||n===void 0?void 0:n.label,s=this.reprLabel;return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsxs(pr,E({noOverflow:!0,className:"msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o,M.jsx("small",E({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:s}),void 0)]}),void 0),M.jsx(qt,{svg:i.state.isHidden?fv:hv,toggleState:!1,onClick:this.toggleVisible,title:(i.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),M.jsx(qt,{svg:Zs,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0},void 0),M.jsx(qt,{svg:Up,onClick:this.toggleAction,title:"Actions",toggleState:this.state.action==="action",className:"msp-form-control",flex:!0},void 0)]}),void 0),this.state.action==="label"&&M.jsx("div",E({className:"msp-control-offset",style:{marginBottom:"6px"}},{children:M.jsx(qs,{label:"Label",control:M.jsxs("div",E({style:{display:"flex",textAlignLast:"center"}},{children:[M.jsx(Dc,{onChange:this.updateLabel,value:o,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0},void 0),M.jsx(qt,{svg:$g,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0},void 0)]}),void 0)},void 0)}),void 0),this.state.action==="action"&&M.jsxs("div",E({className:"msp-accent-offset"},{children:[M.jsx("div",E({style:{marginBottom:"6px"}},{children:M.jsx(er,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0)}),void 0),M.jsx("div",E({style:{marginBottom:"6px"}},{children:a.representations.map(function(u){return M.jsx(pYe,{group:r.props.group,representation:u},u.cell.transform.ref)})}),void 0)]}),void 0)]},void 0)},t}(Ka),pYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(){return r.plugin.managers.structure.component.removeRepresentations(r.props.group,r.props.representation)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group,r.props.representation)},r.update=function(n){return r.plugin.managers.structure.component.updateRepresentations(r.props.group,r.props.representation,n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){Zf.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n=this.props.representation.cell;return M.jsxs("div",E({className:"msp-representation-entry"},{children:[n.parent&&M.jsx(Bu,E({header:(((r=n.obj)===null||r===void 0?void 0:r.label)||"")+" Representation",noOffset:!0},{children:M.jsx(nd,{state:n.parent,transform:n.transform,customHeader:"none",customUpdate:this.update,noMargin:!0},void 0)}),void 0),M.jsx(qt,{svg:Zs,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}},void 0),M.jsx(qt,{svg:this.props.representation.cell.state.isHidden?fv:hv,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}},void 0)]}),void 0)},t}(Ka),vT="measurement-group",Hee={distanceUnitLabel:T.Text("Å",{isEssential:!0}),textColor:zZ.textColor},vYe=T.getDefaultValues(Hee),mYe=function(e){Be(t,e);function t(r){var n=e.call(this,{labels:[],distances:[],angles:[],dihedrals:[],orientations:[],options:vYe})||this;return n.plugin=r,n.behaviors={state:n.ev.behavior(n.state)},n._empty=[],r.state.data.events.changed.subscribe(function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync()}),r.behaviors.state.isAnimating.subscribe(function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync()}),n}return t.prototype.stateUpdated=function(){this.behaviors.state.next(this.state)},t.prototype.getGroup=function(){var r=this.plugin.state.data,n=ir.findTagInSubtree(r.tree,cr.RootRef,vT),a=this.plugin.state.data.build();return n?a.to(n):a.toRoot().group(st.Misc.CreateGroup,{label:"Measurements"},{tags:vT})},t.prototype.setOptions=function(r){return de(this,void 0,void 0,function(){var n,a,i,f,o,s,f,u,l,f,c,d,f;return fe(this,function(h){switch(h.label){case 0:for(this.updateState({options:r})&&this.stateUpdated(),n=this.plugin.state.data.build(),a=0,i=this.state.distances;a<i.length;a++)f=i[a],n.to(f).update(function(v){v.unitLabel=r.distanceUnitLabel,v.textColor=r.textColor});for(o=0,s=this.state.labels;o<s.length;o++)f=s[o],n.to(f).update(function(v){v.textColor=r.textColor});for(u=0,l=this.state.angles;u<l.length;u++)f=l[u],n.to(f).update(function(v){v.textColor=r.textColor});for(c=0,d=this.state.dihedrals;c<d.length;c++)f=d[c],n.to(f).update(function(v){v.textColor=r.textColor});return n.editInfo.count===0?[2]:[4,wt.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return h.sent(),[2]}})})},t.prototype.addDistance=function(r,n,a){return de(this,void 0,void 0,function(){var i,o,s,u,l;return fe(this,function(c){switch(c.label){case 0:return i=this.plugin.helpers.substructureParent.get(r.structure),o=this.plugin.helpers.substructureParent.get(n.structure),!i||!o?[2]:(s=[i.transform.ref],Di(s,o.transform.ref),u=this.getGroup(),u.apply(st.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:i.transform.ref,expression:Oe.toExpression(r)},{key:"b",groupId:"b",ref:o.transform.ref,expression:Oe.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:a==null?void 0:a.selectionTags}).apply(st.Representation.StructureSelectionsDistance3D,E(E(E({customText:(a==null?void 0:a.customText)||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor},a==null?void 0:a.lineParams),a==null?void 0:a.labelParams),a==null?void 0:a.visualParams),{tags:a==null?void 0:a.reprTags}),l=this.plugin.state.data,[4,wt.State.Update(this.plugin,{state:l,tree:u,options:{doNotLogTiming:!0}})]);case 1:return c.sent(),[2]}})})},t.prototype.addAngle=function(r,n,a,i){return de(this,void 0,void 0,function(){var o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:return o=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(a.structure),!o||!s||!u?[2]:(l=[o.transform.ref],Di(l,s.transform.ref),Di(l,u.transform.ref),c=this.getGroup(),c.apply(st.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:o.transform.ref,expression:Oe.toExpression(r)},{key:"b",ref:s.transform.ref,expression:Oe.toExpression(n)},{key:"c",ref:u.transform.ref,expression:Oe.toExpression(a)}],isTransitive:!0,label:"Angle"},{dependsOn:l,tags:i==null?void 0:i.selectionTags}).apply(st.Representation.StructureSelectionsAngle3D,E(E(E({customText:(i==null?void 0:i.customText)||"",textColor:this.state.options.textColor},i==null?void 0:i.lineParams),i==null?void 0:i.labelParams),i==null?void 0:i.visualParams),{tags:i==null?void 0:i.reprTags}),d=this.plugin.state.data,[4,wt.State.Update(this.plugin,{state:d,tree:c,options:{doNotLogTiming:!0}})]);case 1:return f.sent(),[2]}})})},t.prototype.addDihedral=function(r,n,a,i,o){return de(this,void 0,void 0,function(){var s,u,l,c,d,f,h;return fe(this,function(v){switch(v.label){case 0:return s=this.plugin.helpers.substructureParent.get(r.structure),u=this.plugin.helpers.substructureParent.get(n.structure),l=this.plugin.helpers.substructureParent.get(a.structure),c=this.plugin.helpers.substructureParent.get(i.structure),!s||!u||!l||!c?[2]:(d=[s.transform.ref],Di(d,u.transform.ref),Di(d,l.transform.ref),Di(d,c.transform.ref),f=this.getGroup(),f.apply(st.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:Oe.toExpression(r)},{key:"b",ref:u.transform.ref,expression:Oe.toExpression(n)},{key:"c",ref:l.transform.ref,expression:Oe.toExpression(a)},{key:"d",ref:c.transform.ref,expression:Oe.toExpression(i)}],isTransitive:!0,label:"Dihedral"},{dependsOn:d,tags:o==null?void 0:o.selectionTags}).apply(st.Representation.StructureSelectionsDihedral3D,E(E(E({customText:(o==null?void 0:o.customText)||"",textColor:this.state.options.textColor},o==null?void 0:o.lineParams),o==null?void 0:o.labelParams),o==null?void 0:o.visualParams),{tags:o==null?void 0:o.reprTags}),h=this.plugin.state.data,[4,wt.State.Update(this.plugin,{state:h,tree:f,options:{doNotLogTiming:!0}})]);case 1:return v.sent(),[2]}})})},t.prototype.addLabel=function(r,n){return de(this,void 0,void 0,function(){var a,i,o,s;return fe(this,function(u){switch(u.label){case 0:return a=this.plugin.helpers.substructureParent.get(r.structure),a?(i=[a.transform.ref],o=this.getGroup(),o.apply(st.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:a.transform.ref,expression:Oe.toExpression(r)}],isTransitive:!0,label:"Label"},{dependsOn:i,tags:n==null?void 0:n.selectionTags}).apply(st.Representation.StructureSelectionsLabel3D,E(E({textColor:this.state.options.textColor},n==null?void 0:n.labelParams),n==null?void 0:n.visualParams),{tags:n==null?void 0:n.reprTags}),s=this.plugin.state.data,[4,wt.State.Update(this.plugin,{state:s,tree:o,options:{doNotLogTiming:!0}})]):[2];case 1:return u.sent(),[2]}})})},t.prototype.addOrientation=function(r){return de(this,void 0,void 0,function(){var n,a,i,o;return fe(this,function(s){switch(s.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),n?(a=[n.transform.ref],i=this.getGroup(),i.apply(st.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:n.transform.ref,expression:Oe.toExpression(r)}],isTransitive:!0,label:"Orientation"},{dependsOn:a}).apply(st.Representation.StructureSelectionsOrientation3D),o=this.plugin.state.data,[4,wt.State.Update(this.plugin,{state:o,tree:i,options:{doNotLogTiming:!0}})]):[2];case 1:return s.sent(),[2]}})})},t.prototype.getTransforms=function(r){var n=this.plugin.state.data,a=ir.findTagInSubtree(n.tree,cr.RootRef,vT),i=a?n.select(ir.Generators.ofTransformer(r,a)):this._empty;return i.length===0?this._empty:i},t.prototype.sync=function(){var r=this.updateState({labels:this.getTransforms(st.Representation.StructureSelectionsLabel3D),distances:this.getTransforms(st.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(st.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(st.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(st.Representation.StructureSelectionsOrientation3D)});r&&this.stateUpdated()},t}(Ed),O_=function(e){Be(t,e);function t(r,n){n===void 0&&(n={});var a=e.call(this,{props:E(E({},T.getDefaultValues(t.Params)),n)})||this;return a.plugin=r,a._props=T.getDefaultValues(t.Params),a.events={propsUpdated:a.ev()},a.lociSelects=new t.LociSelectManager(r,a._props),a.lociHighlights=new t.LociHighlightManager(r,a._props),a}return Object.defineProperty(t.prototype,"props",{get:function(){return E({},this.state.props)},enumerable:!1,configurable:!0}),t.prototype.setProps=function(r){var n=this.props,a=E(E({},this.state.props),r);fk(n,a)||(this.updateState({props:a}),this.lociSelects.setProps(a),this.lociHighlights.setProps(a),this.events.propsUpdated.next())},t}(Ed);(function(e){e.Params={granularity:T.Select("residue",or.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};var t=function(){function a(i,o){o===void 0&&(o={}),this.ctx=i,this.providers=[],this.props=T.getDefaultValues(e.Params),this.sel=i.managers.structure.selection,this.setProps(o)}return a.prototype.setProps=function(i){Object.assign(this.props,i)},a.prototype.addProvider=function(i){this.providers.push(i)},a.prototype.removeProvider=function(i){this.providers=this.providers.filter(function(o){return o!==i})},a.prototype.normalizedLoci=function(i,o){o===void 0&&(o=!0);var s=i.loci,u=i.repr,l=o?this.props.granularity:void 0;return{loci:or.normalize(s,l),repr:u}},a.prototype.mark=function(i,o){if(!or.isEmpty(i.loci))for(var s=0,u=this.providers;s<u.length;s++){var l=u[s];l(i,o)}},a}();e.LociMarkManager=t;var r=function(a){Be(i,a);function i(){var o=a!==null&&a.apply(this,arguments)||this;return o.prev=[],o.clearHighlights=function(){for(var s=0,u=o.prev;s<u.length;s++){var l=u[s];o.mark(l,tr.RemoveHighlight)}o.prev.length=0},o}return i.prototype.isHighlighted=function(o){for(var s=0,u=this.prev;s<u.length;s++){var l=u[s];if(sr.Loci.areEqual(l,o))return!0}return!1},i.prototype.addHighlight=function(o){this.mark(o,tr.Highlight),this.prev.push(o)},i.prototype.highlight=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||this.addHighlight(u)},i.prototype.highlightOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||(this.clearHighlights(),this.addHighlight(u))},i.prototype.highlightOnlyExtend=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);if(Oe.is(u.loci)){var l={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(l)||(this.clearHighlights(),this.addHighlight(l))}},i}(t);e.LociHighlightManager=r;var n=function(a){Be(i,a);function i(){return a!==null&&a.apply(this,arguments)||this}return i.prototype.toggle=function(o,s){if(s===void 0&&(s=!0),!or.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);Oe.is(u.loci)?this.toggleSel(u):a.prototype.mark.call(this,u,tr.Toggle)}},i.prototype.toggleExtend=function(o,s){if(s===void 0&&(s=!0),!or.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);if(Oe.is(u.loci)){var l=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:l,repr:u.repr})}}},i.prototype.select=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Oe.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,tr.Select)},i.prototype.selectJoin=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Oe.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,tr.Select)},i.prototype.selectOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Oe.is(u.loci)&&(this.deselect({loci:tt.toStructureElementLoci(u.loci.structure),repr:u.repr},!1),this.sel.modify("set",u.loci)),this.mark(u,tr.Select)},i.prototype.deselect=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Oe.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,tr.Deselect)},i.prototype.deselectAll=function(){this.sel.clear(),this.mark({loci:LUe},tr.Deselect)},i.prototype.deselectAllOnEmpty=function(o){Mu(o.loci)&&this.deselectAll()},i.prototype.mark=function(o,s){var u=o.loci;or.isEmpty(u)||(Oe.is(u)?(a.prototype.mark.call(this,{loci:tt.Loci(u.structure)},tr.Deselect),a.prototype.mark.call(this,{loci:this.sel.getLoci(u.structure)},tr.Select)):a.prototype.mark.call(this,o,s))},i.prototype.toggleSel=function(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,tr.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,tr.Select))},i}(t);e.LociSelectManager=n})(O_||(O_={}));function gYe(e,t){for(var r,n=[],a=t==="auth"?"auth_asym_id":"label_asym_id",i=t==="auth"?"auth_seq_id":"label_seq_id",o=0,s=e;o<s.length;o++){var u=s[o];if(u.kind==="range")n.push(ue.struct.generator.atomGroups({"chain-test":ue.core.rel.eq([ue.ammp(a),u.asym_id]),"residue-test":ue.core.rel.inRange([ue.ammp(i),u.seq_id_beg,u.seq_id_end])}));else{var l=((r=u.ins_code)!==null&&r!==void 0?r:"").trim();n.push(ue.struct.generator.atomGroups({"chain-test":ue.core.rel.eq([ue.ammp(a),u.asym_id]),"residue-test":ue.core.logic.and([ue.core.rel.eq([ue.ammp(i),u.seq_id]),ue.core.rel.eq([ue.ammp("pdbx_PDB_ins_code"),l])])}))}}var c=ue.struct.combinator.merge(n);return Yp(c)}function yYe(e){for(var t=Jr.create(),r=0,n=e;r<n.length;r++)for(var a=n[r],i=a[0],o=a[1],s=i;s<=o;s++)Jr.add(t,s,s);var u=ue.struct.generator.atomGroups({"atom-test":ue.core.set.has([ue.set.apply(ue,t.array),ue.ammp("id")])});return Yp(u)}function bYe(e,t,r){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(r)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:r}}function xYe(e){return e?e.split(":"):[]}function SYe(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).map(function(t){return bYe(t[0],xYe(t[1]),+t[2])}).filter(function(t){return!!t})}function CYe(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).filter(function(t){return t.length===1||t.length===2}).map(function(t){return t.length===1?[+t[0],+t[0]]:[+t[0],+t[1]]})}function _Ye(e,t){if(t==="atom-id"){var r=CYe(e);return yYe(r)}else{var r=SYe(e);return gYe(r,t)}}function wYe(e){return Object.keys(e).map(function(t){return[t,e[t]]})}var qD=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBindingComponents=function(){var r=wYe(this.props.bindings);return M.jsx(M.Fragment,{children:r.map(function(n){var a=n[0],i=n[1];return fr.isEmpty(i)?null:M.jsxs("div",E({style:{marginBottom:"6px"}},{children:[M.jsx("b",{children:i.action},void 0),M.jsx("br",{},void 0),M.jsx("span",{dangerouslySetInnerHTML:{__html:fr.format(i,a)}},void 0)]}),a)})},void 0)},t.prototype.render=function(){return M.jsx(cl,{children:this.getBindingComponents()},void 0)},t}(ze.PureComponent),cl=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return M.jsx("div",E({className:"msp-help-text"},{children:M.jsx("div",{children:this.props.children},void 0)}),void 0)},t}(ze.PureComponent),hl=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={header:r.props.header,isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return M.jsxs("div",E({className:"msp-control-group-wrapper"},{children:[M.jsx("div",E({className:"msp-control-group-header"},{children:M.jsxs(pr,E({onClick:this.toggleExpanded},{children:[M.jsx(on,{svg:this.state.isExpanded?Hc:Gc},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&M.jsx("div",E({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:this.props.children}),void 0)]}),void 0)},t}(ze.PureComponent);function mT(e){return M.jsx("div",E({className:"msp-simple-help-section"},{children:e.header}),void 0)}var BO=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r={};return this.plugin.spec.behaviors.forEach(function(n){var a=n.defaultParams.bindings;a&&Object.assign(r,a)}),M.jsxs(M.Fragment,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&M.jsx(hl,E({header:"Moving in 3D"},{children:M.jsx(qD,{bindings:this.plugin.canvas3d.props.trackball.bindings},void 0)}),"trackball"),M.jsx(hl,E({header:"Mouse Controls"},{children:M.jsx(qD,{bindings:r},void 0)}),"interactions")]},void 0)},t}(vr),EYe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.formatTriggers=function(r){return r.triggers.map(function(n){return fr.Trigger.format(n)}).join(" or ")},t.prototype.getTriggerFor=function(r,n){var a=this.plugin.state.behaviors,i=a.select(ir.Generators.ofTransformer(r)),o=i.length===1?i[0].params:void 0,s=o?o.values.bindings:{},u=n in s?s[n]:fr.Empty;return this.formatTriggers(u)},t.prototype.render=function(){var r=this.getTriggerFor(vee,"clickSelectToggle"),n=this.getTriggerFor(eE,"clickFocus");return M.jsxs("div",{children:[M.jsx(mT,{header:"Interface Controls"},void 0),M.jsxs(hl,E({header:"Inline Help"},{children:[M.jsx(cl,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."},void 0),M.jsx(cl,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."},void 0)]}),void 0),M.jsx(hl,E({header:"Selections"},{children:M.jsxs(cl,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",M.jsxs("ul",E({style:{paddingLeft:"20px"}},{children:[M.jsxs("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",r," (for more see help section on ",M.jsx("i",{children:"Mouse Controls"},void 0),")"]},void 0),M.jsxs("li",{children:["using the ",M.jsx("i",{children:"Add"},void 0),", ",M.jsx("i",{children:"Remove"},void 0)," and ",M.jsx("i",{children:"Only"},void 0)," dropdown buttons in the ",M.jsx("i",{children:"Manage Selection"},void 0)," panel which allow modifing the current selection by predefined sets"]},void 0)]}),void 0)]},void 0)}),void 0),M.jsx(hl,E({header:"Coloring"},{children:M.jsxs(cl,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",M.jsx("i",{children:"Structure Settings"},void 0)," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",M.jsx("i",{children:"Selections"},void 0),") and, second, choose a color from the color dropdown botton in the ",M.jsx("i",{children:"Selection"},void 0)," row of the ",M.jsx("i",{children:"Change Representation"},void 0)," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]},void 0)}),void 0),M.jsx(hl,E({header:"Representations"},{children:M.jsxs(cl,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",M.jsx("i",{children:"Change Representation"},void 0)," panel offers a collection of predefined styles which can be applied using the ",M.jsx("i",{children:"Preset"},void 0)," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",M.jsx("i",{children:"Selections"},void 0),") and, second, choose a representation to hide or show from the ",M.jsx("i",{children:"Show"},void 0)," and ",M.jsx("i",{children:"Hide"},void 0)," dropdown bottons in the ",M.jsx("i",{children:"Selection"},void 0)," row of the ",M.jsx("i",{children:"Change Representation"},void 0)," panel. The ",M.jsx("i",{children:"Everything"},void 0)," row applies the action to the whole structure instead of the current selection."]},void 0)}),void 0),M.jsx(hl,E({header:"Surroundings"},{children:M.jsxs(cl,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",n,"."]},void 0)}),void 0),M.jsx(mT,{header:"How-to Guides"},void 0),M.jsx(hl,E({header:"Create an Image"},{children:M.jsxs(cl,{children:[M.jsxs("p",{children:["Use the ",M.jsx(on,{svg:ewe},void 0)," icon in the viewport to bring up the screenshot controls."]},void 0),M.jsxs("p",{children:["To adjust the size of the image, use the ",M.jsx("i",{children:"Resolution"},void 0)," dropdown."]},void 0)]},void 0)}),void 0),M.jsx(mT,{header:"Mouse Controls"},void 0),M.jsx(BO,{},void 0)]},void 0)},t}(vr),L_=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._toggleSelMode=function(){r.plugin.selectionMode=!r.plugin.selectionMode},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"};return M.jsx(qt,{svg:t3e,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:r,toggleState:this.plugin.selectionMode},void 0)},t}(Ka),AYe={granularity:O_.Params.granularity},Zv=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]),PYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1},r.set=function(n,a){r.plugin.managers.structure.selection.fromSelectionQuery(n,a,!1)},r.selectQuery=function(n,a){if(!n||!r.state.action){r.setState({action:void 0});return}var i=r.state.action;a!=null&&a.shiftKey?r.set(i,n.value):r.setState({action:void 0},function(){r.set(i,n.value)})},r.selectHelper=function(n,a){if(console.log(n),!n||!r.state.action){r.setState({action:void 0,helper:void 0});return}r.setState({helper:n.value.kind})},r.queriesItems=[],r.queriesVersion=-1,r.helpersItems=void 0,r.toggleAdd=r.showAction("add"),r.toggleRemove=r.showAction("remove"),r.toggleIntersect=r.showAction("intersect"),r.toggleSet=r.showAction("set"),r.toggleTheme=r.showAction("theme"),r.toggleAddComponent=r.showAction("add-component"),r.toggleHelp=r.showAction("help"),r.setGranuality=function(n){var a=n.value;r.plugin.managers.interactivity.setProps({granularity:a})},r.turnOff=function(){return r.plugin.selectionMode=!1},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r.subtract=function(){for(var n=r.plugin.managers.structure.hierarchy.getStructuresWithSelection(),a=[],i=0,o=n;i<o.length;i++){var s=o[i];a.push.apply(a,s.components)}a.length!==0&&r.plugin.managers.structure.component.modifyByCurrentSelection(a,"subtract")},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var a=n.hierarchy.structures.length===0;r.state.isEmpty!==a&&r.setState({isEmpty:a}),r.queriesVersion=-1,r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var a=n.state;r.setState({canUndo:a.canUndo})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structures",{get:function(){for(var r,n=[],a=0,i=this.plugin.managers.structure.hierarchy.selection.structures;a<i.length;a++){var o=i[a],s=(r=o.cell.obj)===null||r===void 0?void 0:r.data;s&&n.push(s)}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queries",{get:function(){var r=this.plugin.query.structure.registry;if(r.version!==this.queriesVersion){var n=this.structures,a=Ut(Ut(Ut(Ut([],r.list),Dze(n)),Mze(n)),Ize(n)).sort(function(i,o){return o.priority-i.priority});this.queriesItems=er.createItems(a,{filter:function(i){return i!==ma.current&&!i.isHidden},label:function(i){return i.label},category:function(i){return i.category},description:function(i){return i.description}}),this.queriesVersion=r.version}return this.queriesItems},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"helpers",{get:function(){if(this.helpersItems)return this.helpersItems;var r=[{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}];return this.helpersItems=er.createItems(r,{label:function(n){return n.label},category:function(n){return n.category},description:function(n){return n.description}}),this.helpersItems},enumerable:!1,configurable:!0}),t.prototype.showAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r,helper:void 0})}},t.prototype.render=function(){var r=this,n=this.plugin.managers.interactivity.props.granularity,a=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.",i=void 0;if(this.state.action&&!this.state.helper)i=M.jsxs(M.Fragment,{children:[this.state.action&&this.state.action!=="theme"&&this.state.action!=="add-component"&&this.state.action!=="help"&&M.jsxs("div",E({className:"msp-selection-viewport-controls-actions"},{children:[M.jsx(er,{header:Zv.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0},void 0),M.jsx(er,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0},void 0)]}),void 0),this.state.action==="theme"&&M.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:M.jsx(Cc,E({header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:Sc},{children:M.jsx(IYe,{onApply:this.toggleTheme},void 0)}),void 0)}),void 0),this.state.action==="add-component"&&M.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:M.jsx(Cc,E({header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:Sc},{children:M.jsx(Vee,{onApply:this.toggleAddComponent,forSelection:!0},void 0)}),void 0)}),void 0),this.state.action==="help"&&M.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:M.jsxs(Cc,E({header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:Sc,maxHeight:"300px"},{children:[M.jsx(hl,E({header:"Selection Operations"},{children:M.jsxs(cl,{children:["Use ",M.jsx(on,{svg:ZI,inline:!0},void 0)," ",M.jsx(on,{svg:JI,inline:!0},void 0)," ",M.jsx(on,{svg:eM,inline:!0},void 0)," ",M.jsx(on,{svg:BC,inline:!0},void 0)," to modify the selection."]},void 0)}),void 0),M.jsx(hl,E({header:"Representation Operations"},{children:M.jsxs(cl,{children:["Use ",M.jsx(on,{svg:rM,inline:!0},void 0)," ",M.jsx(on,{svg:tM,inline:!0},void 0)," ",M.jsx(on,{svg:oM,inline:!0},void 0)," ",M.jsx(on,{svg:sM,inline:!0},void 0)," to color, create components, remove from components, or undo actions."]},void 0)}),void 0),M.jsx(BO,{selectOnly:!0},void 0)]}),void 0)}),void 0)]},void 0);else if(Zv.has(this.state.action)&&this.state.helper==="residue-list"){var o=function(){return r.setState({action:void 0,helper:void 0})};i=M.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:M.jsx(Cc,E({header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:o,topRightIcon:Sc},{children:M.jsx(DYe,{modifier:this.state.action,plugin:this.plugin,close:o},void 0)}),void 0)}),void 0)}return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row",style:{background:"none"}},{children:[M.jsx(um,{title:"Picking Level for selecting and highlighting",param:AYe.granularity,name:"granularity",value:n,onChange:this.setGranuality,isDisabled:this.isDisabled},void 0),M.jsx(Ra,{icon:ZI,title:Zv.get("add")+". Hold shift key to keep menu open.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),M.jsx(Ra,{icon:JI,title:Zv.get("remove")+". Hold shift key to keep menu open.",toggle:this.toggleRemove,isSelected:this.state.action==="remove",disabled:this.isDisabled},void 0),M.jsx(Ra,{icon:eM,title:Zv.get("intersect")+". Hold shift key to keep menu open.",toggle:this.toggleIntersect,isSelected:this.state.action==="intersect",disabled:this.isDisabled},void 0),M.jsx(Ra,{icon:BC,title:Zv.get("set")+". Hold shift key to keep menu open.",toggle:this.toggleSet,isSelected:this.state.action==="set",disabled:this.isDisabled},void 0),M.jsx(Ra,{icon:rM,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:this.state.action==="theme",disabled:this.isDisabled,style:{marginLeft:"10px"}},void 0),M.jsx(Ra,{icon:tM,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:this.state.action==="add-component",disabled:this.isDisabled},void 0),M.jsx(qt,{svg:oM,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled},void 0),M.jsx(qt,{svg:sM,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:a},void 0),M.jsx(Ra,{icon:Il,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:this.state.action==="help"},void 0),M.jsx(qt,{svg:dk,title:"Turn selection mode off",onClick:this.turnOff},void 0)]}),void 0),i]},void 0)},t}(vr),TYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1},r.clear=function(){return r.plugin.managers.interactivity.lociSelects.deselectAll()},r.focus=function(){if(r.plugin.managers.structure.selection.stats.elementCount!==0){var n=r.plugin.managers.structure.selection.getBoundary().sphere;r.plugin.managers.camera.focusSphere(n)}},r.highlight=function(n){r.plugin.managers.interactivity.lociHighlights.clearHighlights(),r.plugin.managers.structure.selection.entries.forEach(function(a){r.plugin.managers.interactivity.lociHighlights.highlight({loci:a.selection},!1)})},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var a=n.structures.length===0;r.state.isEmpty!==a&&r.setState({isEmpty:a})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){var r=this.plugin.managers.structure.selection.stats;return r.structureCount===0||r.elementCount===0?"Nothing Selected":xf(r.label)+" Selected"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.plugin.managers.structure.selection.stats,n=r.structureCount===0||r.elementCount===0;return n&&this.props.hideOnEmpty?null:M.jsx(M.Fragment,{children:M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsx(pr,E({noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:n,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:n?void 0:"left"}},{children:this.stats}),void 0),!n&&M.jsx(qt,{svg:dk,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0},void 0)]}),void 0)},void 0)},t}(vr),IYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._params=rh(function(n){return tv.getThemeParams(r.plugin,n)}),r.state={values:T.getDefaultValues(r.params)},r.apply=function(){var n,a;r.plugin.managers.structure.component.applyTheme(r.state.values,r.plugin.managers.structure.hierarchy.current.structures),(a=(n=r.props).onApply)===null||a===void 0||a.call(n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params(this.plugin.managers.structure.component.pivotStructure)},enumerable:!1,configurable:!0}),t.prototype.render=function(){return M.jsxs(M.Fragment,{children:[M.jsx(Un,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),M.jsx(pr,E({icon:rM,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Apply Theme"}),void 0)]},void 0)},t}(Ka),Gee={idType:T.Select("auth",T.arrayToOptions(["auth","label","atom-id"])),identifiers:T.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},MYe=T.getDefaultValues(Gee);function DYe(e){var t=e.modifier,r=e.plugin,n=e.close,a=ze.useState(MYe),i=a[0],o=a[1],s=function(){if(i.identifiers.trim().length!==0)try{n();var u=_Ye(i.identifiers,i.idType);r.managers.structure.selection.fromCompiledQuery(t,u,!1)}catch(l){r.log.error("Failed to create selection: "+l)}};return M.jsxs(M.Fragment,{children:[M.jsx(Un,{params:Gee,values:i,onChangeValues:o,onEnter:s},void 0),M.jsxs(pr,E({className:"msp-btn-commit msp-btn-commit-on",disabled:i.identifiers.trim().length===0,onClick:s,style:{marginTop:"1px"}},{children:[qg(t)," Selection"]}),void 0)]},void 0)}var RYe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:L_e}}},t.prototype.renderControls=function(){return M.jsxs(M.Fragment,{children:[M.jsx(OYe,{},void 0),M.jsx(kYe,{},void 0)]},void 0)},t}(Xg),kYe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()})},t.prototype.renderGroup=function(r,n){for(var a=[],i=0,o=r;i<o.length;i++){var s=o[i];s.obj&&a.push(M.jsx(NYe,{cell:s},s.obj.id))}return a.length?M.jsx(Bu,E({header:n,initiallyExpanded:!0},{children:a}),void 0):null},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return M.jsxs("div",E({style:{marginTop:"6px"}},{children:[this.renderGroup(r.labels,"Labels"),this.renderGroup(r.distances,"Distances"),this.renderGroup(r.angles,"Angles"),this.renderGroup(r.dihedrals,"Dihedrals")]}),void 0)},t}(Ka),OYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,action:void 0},r.measureDistance=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDistance(n[0].loci,n[1].loci)},r.measureAngle=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addAngle(n[0].loci,n[1].loci,n[2].loci)},r.measureDihedral=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDihedral(n[0].loci,n[1].loci,n[2].loci,n[3].loci)},r.addLabel=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addLabel(n[0].loci)},r.selectAction=function(n){r.toggleAdd(),n&&(n==null?void 0:n.value)()},r.toggleAdd=function(){return r.setState({action:r.state.action==="add"?void 0:"add"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this.selection.additionsHistory,n=[{kind:"item",label:"Label "+(r.length===0?" (1 selection required)":" (1st selection)"),value:this.addLabel,disabled:r.length===0},{kind:"item",label:"Distance "+(r.length<2?" (2 selections required)":" (top 2 selections)"),value:this.measureDistance,disabled:r.length<2},{kind:"item",label:"Angle "+(r.length<3?" (3 selections required)":" (top 3 selections)"),value:this.measureAngle,disabled:r.length<3},{kind:"item",label:"Dihedral "+(r.length<4?" (4 selections required)":" (top 4 selections)"),value:this.measureDihedral,disabled:r.length<4}];return n},enumerable:!1,configurable:!0}),t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,4)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.historyEntry=function(r,n){var a=this,i=this.plugin.managers.structure.selection.additionsHistory;return M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsxs(pr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",M.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),i.length>1&&M.jsx(qt,{svg:s3,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),i.length>1&&M.jsx(qt,{svg:o3,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),M.jsx(qt,{svg:Zs,small:!0,className:"msp-form-control",onClick:function(){return a.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.add=function(){for(var r=this.plugin.managers.structure.selection.additionsHistory,n=[],a=0,i=Math.min(r.length,4);a<i;a++)n.push(this.historyEntry(r[a],a+1));return M.jsxs(M.Fragment,{children:[M.jsx(er,{items:this.actions,onSelect:this.selectAction},void 0),n.length>0&&M.jsx("div",E({className:"msp-control-offset"},{children:n}),void 0),n.length===0&&M.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:M.jsxs("div",E({className:"msp-help-description"},{children:[M.jsx(on,{svg:Il,inline:!0},void 0),"Add one or more selections (toggle ",M.jsx(L_,{inline:!0},void 0)," mode)"]}),void 0)}),void 0)]},void 0)},t.prototype.render=function(){return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsx(Ra,{icon:Wg,label:"Add",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.state.isBusy,className:"msp-btn-apply-simple"},void 0),M.jsx(Ra,{icon:jp,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="add"&&this.add(),this.state.action==="options"&&M.jsx(LYe,{},void 0)]},void 0)},t}(Ka),LYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isDisabled:!1},r.changed=function(n){r.plugin.managers.structure.measurement.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isDisabled:n})})},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return M.jsx("div",E({className:"msp-control-offset"},{children:M.jsx(Un,{params:Hee,values:r.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled},void 0)}),void 0)},t}(Ka),NYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showUpdate:!1},r.delete=function(){wt.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent,removeParentGhosts:!0})},r.toggleVisibility=function(n){n.preventDefault(),wt.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent}),n.currentTarget.blur()},r.highlight=function(){var n,a=r.selections;if(a){r.plugin.managers.interactivity.lociHighlights.clearHighlights();for(var i=0,o=r.lociArray;i<o.length;i++){var s=o[i];r.plugin.managers.interactivity.lociHighlights.highlight({loci:s},!1)}r.plugin.managers.interactivity.lociHighlights.highlight({loci:(n=r.props.cell.obj)===null||n===void 0?void 0:n.data.repr.getLoci()},!1)}},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r.toggleUpdate=function(){return r.setState({showUpdate:!r.state.showUpdate})},r.focus=function(){var n=r.selections;if(n){var a=or.getBundleBoundingSphere({loci:r.lociArray});a&&r.plugin.managers.camera.focusSphere(a)}},r.selectAction=function(n){n&&(r.setState({showUpdate:!1}),(n==null?void 0:n.value)())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.forceUpdate()})},Object.defineProperty(t.prototype,"selections",{get:function(){var r;return(r=this.props.cell.obj)===null||r===void 0?void 0:r.data.sourceData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lociArray",{get:function(){var r=this.selections;return r?r.infos?[r.infos[0].loci]:r.pairs?r.pairs[0].loci:r.triples?r.triples[0].loci:r.quads?r.quads[0].loci:[]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r=this.selections;return r?r.infos?ih(r.infos[0].loci,{condensed:!0}):r.pairs?U3(r.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):r.triples?j3(r.triples[0],{condensed:!0}):r.quads?z3(r.quads[0],{condensed:!0}):"<empty>":"<empty>"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this;return this.props.cell.sourceRef,[er.Item("Select This",function(){return r.plugin.managers.structure.selection.fromSelections(r.props.cell.sourceRef)},{icon:BC})]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props.cell,n=r.obj;return n?M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight},{children:[M.jsx("button",E({className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"}},{children:M.jsx("span",{dangerouslySetInnerHTML:{__html:this.label}},void 0)}),void 0),M.jsx(qt,{svg:r.state.isHidden?fv:hv,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:r.state.isHidden?"Show":"Hide"},void 0),M.jsx(qt,{svg:Zs,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1},void 0),M.jsx(qt,{svg:Up,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate},void 0)]}),n.id),this.state.showUpdate&&r.parent&&M.jsx(M.Fragment,{children:M.jsxs("div",E({className:"msp-accent-offset"},{children:[M.jsx(er,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0),M.jsx(Bu,E({header:"Options",noOffset:!0},{children:M.jsx(nd,{state:r.parent,transform:r.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)]}),void 0)},void 0)]},void 0):null},t}(Ka);function gT(e,t,r,n){for(var a=it.indexOf(t.unit.elements,t.element),i=Oe(t.structure,[{unit:t.unit,indices:Fe.ofSingleton(a)}]),o=n==="residue"?Oe.extendToWholeResidues(i):Oe.extendToWholeChains(i),s=pt.entity.pdbx_description(t).join(", "),u=0,l=r.units;u<l.length;u++){var c=l[u],d=Oe(o.structure,[{unit:c,indices:o.elements[0].indices}]),f=ih(d,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:n});f||(f=ih(d,{hidePrefix:!1,htmlStyling:!1})),r.units.length>1&&(f+=" | "+d.elements[0].unit.conformation.operator.name);var h={label:f,category:s,loci:d};e.has(s)?e.get(s).push(h):e.set(s,[h])}}function FYe(e){for(var t=new Map,r=at.create(e),n=0,a=e.unitSymmetryGroups;n<a.length;n++){var i=a[n];if(We.isAtomic(i.units[0])){r.unit=i.units[0],r.element=i.elements[0];var o=We.Traits.is(r.unit.traits,1),s=pt.entity.type(r),u=s==="non-polymer",l=s==="branched",c=!!pt.entity.prd_id(r);if(c)gT(t,r,i,"chain");else if(u&&!o)gT(t,r,i,"residue");else if(l||u&&o)for(var d=r.unit,f=d.model.atomicHierarchy.residueAtomSegments.index,h=-1,v=0,p=d.elements.length;v<p;++v){var g=d.elements[v],m=f[g];m!==h&&(r.element=g,gT(t,r,i,"residue"),h=m)}}}var y=[];return t.forEach(function(b,S){b.length===1?y.push({label:S+": "+b[0].label,loci:b[0].loci}):b.length<2e3&&y.push.apply(y,b)}),y}var BYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,showAction:!1},r.getSelectionItems=rh(function(n){for(var a,i=[],o=0,s=n;o<s.length;o++){var u=s[o],l=(a=u.cell.obj)===null||a===void 0?void 0:a.data;if(l){var c=FYe(l);c.length>0&&i.push(Ut([er.Header(l.label,{description:l.label})],er.createItems(c,{label:function(d){return d.label},category:function(d){return d.category},description:function(d){return d.label}})))}}return i}),r.selectAction=function(n,a){if(!n||!r.state.showAction){r.setState({showAction:!1});return}var i=n.value;a!=null&&a.shiftKey?r.plugin.managers.structure.focus.addFromLoci(i.loci):r.plugin.managers.structure.focus.set(i),r.focusCamera()},r.toggleAction=function(){return r.setState({showAction:!r.state.showAction})},r.focusCamera=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.camera.focusLoci(n.loci)},r.clear=function(){r.plugin.managers.structure.focus.clear(),r.plugin.managers.camera.reset()},r.highlightCurrent=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:n.loci},!1)},r.clearHighlights=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.focus.behaviors.current,function(n){r.getSelectionItems([]),r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,function(n){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,showAction:!1})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.actionItems.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actionItems",{get:function(){var r=[],n=this.plugin.managers.structure.focus.history;n.length>0&&r.push(Ut([er.Header("History",{description:"Previously focused on items."})],er.createItems(n,{label:function(u){return u.label},description:function(u){return u.category&&u.label!==u.category?u.category+" | "+u.label:u.label}})));var a=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(a.length===1){var i=a[0],o=i[0];o.initiallyExpanded=!0}var s=[];return a.length>0&&s.push.apply(s,a),r.length>0&&s.push.apply(s,r),s},enumerable:!1,configurable:!0}),t.prototype.getToggleBindingLabel=function(){var r,n=this.plugin.state.behaviors.transforms.get(eE.id);if(!n)return"";var a=(r=n.params)===null||r===void 0?void 0:r.bindings.clickFocus;return!a||fr.isEmpty(a)?"":fr.formatTriggers(a)},t.prototype.render=function(){var r=this.plugin.managers.structure.focus.current,n=(r==null?void 0:r.label)||"Nothing Focused",a="Click to Center Camera";if(!r){a="Select focus using the menu";var i=this.getToggleBindingLabel();i&&(a+=`
or use '`+i+"' on element")}return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsx(pr,E({noOverflow:!0,onClick:this.focusCamera,title:a,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!r,style:{textAlignLast:r?"left":void 0}},{children:n}),void 0),r&&M.jsx(qt,{svg:dk,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled},void 0),M.jsx(Ra,{icon:awe,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.showAction&&M.jsx(er,{items:this.actionItems,onSelect:this.selectAction},void 0)]},void 0)},t}(vr),UYe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var a,i,o,s,u,l,c,d,f,h=r.plugin.managers.structure.hierarchy.seletionSet,v;switch(n.kind){case"model":{var p=(a=n.cell.obj)===null||a===void 0?void 0:a.data;p&&Xt.TrajectoryInfo.get(p).size>1&&(v=((i=n.cell.obj)===null||i===void 0?void 0:i.data.entryId)+" | Model "+(Xt.TrajectoryInfo.get(p).index+1)+" of "+Xt.TrajectoryInfo.get(p).size),v=((o=n.cell.obj)===null||o===void 0?void 0:o.data.entryId)+" | "+((s=n.cell.obj)===null||s===void 0?void 0:s.label);break}case"structure":{var p=(u=n.cell.obj)===null||u===void 0?void 0:u.data.models[0];if(p&&Xt.TrajectoryInfo.get(p).size>1){v=p.entryId+" | "+((l=n.cell.obj)===null||l===void 0?void 0:l.label)+" (Model "+(Xt.TrajectoryInfo.get(p).index+1)+" of "+Xt.TrajectoryInfo.get(p).size+")";break}else if(p){v=p.entryId+" | "+((c=n.cell.obj)===null||c===void 0?void 0:c.label);break}else{v=""+((d=n.cell.obj)===null||d===void 0?void 0:d.label);break}}default:v=(f=n.cell.obj)===null||f===void 0?void 0:f.label;break}var g={kind:"item",label:v||n.kind,selected:h.has(n.cell.transform.ref),value:[n]};return g},r.getTrajectoryItems=function(n){var a;return n.models.length===0?r.item(n):Ut([er.Header((a=n.cell.obj)===null||a===void 0?void 0:a.label)],n.models.map(r.getModelItems))},r.getModelItems=function(n){var a,i,o;if(n.structures.length===0)return r.item(n);if(n.structures.length===1){var s=r.plugin.managers.structure.hierarchy.seletionSet,u=n.structures[0];return{label:((a=n.cell.obj)===null||a===void 0?void 0:a.label)+" | "+((i=u.cell.obj)===null||i===void 0?void 0:i.label),selected:s.has(u.cell.transform.ref),value:[n,u]}}return Ut([er.Header((o=n.cell.obj)===null||o===void 0?void 0:o.label)],n.structures.map(r.item))},r.selectHierarchy=function(n){if(!(!n||n.length===0)){for(var a=[],i=0,o=n;i<o.length;i++)for(var s=o[i],u=0,l=s.value;u<l.length;u++){var c=l[u];a.push(c)}r.plugin.managers.structure.hierarchy.updateCurrent(a,n[0].selected?"remove":"add")}},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.togglePreset=function(){return r.setState({show:r.state.show!=="presets"?"presets":void 0})},r.applyPreset=function(n){if(r.setState({show:void 0}),!!n){var a=r.plugin.managers.structure,i=a.hierarchy.selection.trajectories;a.hierarchy.applyPreset(i,n.value)}},r.updateModelQueueParams=void 0,r.isUpdatingModel=!1,r.updateStructureModel=function(n){r.updateModelQueueParams=n,r._updateStructureModel()},r.updateStructure=function(n){var a=r.plugin.managers.structure.hierarchy.selection,i=a.structures[0];return r.plugin.managers.structure.hierarchy.updateStructure(i,n)},r}return t.prototype.defaultState=function(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:M_e}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){var r=this.plugin.managers.structure.hierarchy,n=r.current,a=[];return n.trajectories.length>1&&a.push(Ut([er.Header("Trajectories")],n.trajectories.map(this.item))),(n.models.length>1||n.trajectories.length>1)&&a.push(Ut([er.Header("Models")],n.models.map(this.item))),n.trajectories.length===1&&n.models.length===1?a.push.apply(a,n.structures.map(this.item)):n.structures.length>0&&a.push(Ut([er.Header("Structures")],n.structures.map(this.item))),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.structure.hierarchy.current,n=r.structures,a=r.models,i=r.trajectories;return i.length===0&&a.length===0&&n.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r,n,a,i,o,s,u,l,c,d,f,h,v,p,g=this.plugin.managers.structure.hierarchy.selection,m=g.structures,y=g.models,b=g.trajectories;if(m.length===1){var S=m[0];return!((n=(r=S.model)===null||r===void 0?void 0:r.trajectory)===null||n===void 0)&&n.models&&S.model.trajectory.models.length===1?(a=S.cell.obj)===null||a===void 0?void 0:a.data.label:S.model?((i=S.model.cell.obj)===null||i===void 0?void 0:i.label)+" | "+((o=S.cell.obj)===null||o===void 0?void 0:o.data.label):(s=S.cell.obj)===null||s===void 0?void 0:s.data.label}if(m.length>1){for(var x=m[0],C=(u=x==null?void 0:x.model)===null||u===void 0?void 0:u.trajectory,w=!0,A=0,I=m;A<I.length;A++){var S=I[A];if(((l=S==null?void 0:S.model)===null||l===void 0?void 0:l.trajectory)!==C){w=!1;break}}return w&&C?((c=C.cell.obj)===null||c===void 0?void 0:c.label)+" | "+m.length+" structures":m.length+" structures"}if(y.length>0){var C=y[0].trajectory;if(y.length===1){var D=(d=y[0].cell.obj)===null||d===void 0?void 0:d.data;return D&&Xt.TrajectoryInfo.get(D).size>1?((f=C==null?void 0:C.cell.obj)===null||f===void 0?void 0:f.label)+" | Model "+(Xt.TrajectoryInfo.get(D).index+1)+" of "+Xt.TrajectoryInfo.get(D).size:((h=C==null?void 0:C.cell.obj)===null||h===void 0?void 0:h.label)+" | Model"}for(var w=!0,k=0,R=y;k<R.length;k++){var L=R[k];if(L.trajectory!==C){w=!1;break}}return w?((v=C==null?void 0:C.cell.obj)===null||v===void 0?void 0:v.label)+" | "+y.length+" models":y.length+" models"}return b.length>0?b.length===1?((p=b[0].cell.obj)===null||p===void 0?void 0:p.label)+" trajectory":b.length+" trajectories":b.length===0&&y.length===0&&m.length===0?"Nothing Loaded":"Nothing Selected"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=[],n=this.plugin.managers.structure.hierarchy.selection.trajectories;if(n.length===0)return r;var a=this.plugin.builders.structure.hierarchy.getPresets(n[0].cell.obj);if(n.length>1){for(var i=new Set(a),o=1;o<n.length;o++)for(var s=this.plugin.builders.structure.hierarchy.getPresets(n[o].cell.obj),u=new Set(s),l=0,c=s;l<c.length;l++){var d=c[l];u.has(d)||i.delete(d)}a=a.filter(function(v){return i.has(v)})}for(var f=0,h=a;f<h.length;f++){var d=h[f];r.push(er.Item(d.display.name,d,{description:d.display.description}))}return r},enumerable:!1,configurable:!0}),t.prototype._updateStructureModel=function(){return de(this,void 0,void 0,function(){var r,n,a;return fe(this,function(i){switch(i.label){case 0:if(!this.updateModelQueueParams||this.isUpdatingModel)return[2];r=this.updateModelQueueParams,this.updateModelQueueParams=void 0,i.label=1;case 1:return i.trys.push([1,,3,4]),this.isUpdatingModel=!0,n=this.plugin.managers.structure.hierarchy.selection,a=n.structures[0].model,[4,this.plugin.state.updateTransform(this.plugin.state.data,a.cell.transform.ref,r,"Model Index")];case 2:return i.sent(),[3,4];case 3:return this.isUpdatingModel=!1,this._updateStructureModel(),[7];case 4:return[2]}})})},Object.defineProperty(t.prototype,"modelIndex",{get:function(){var r,n,a=this.plugin.managers.structure.hierarchy.selection;if(a.structures.length!==1)return null;var i=a.structures[0].model;if(!i||i.cell.transform.transformer!==st.Model.ModelFromTrajectory||!i.cell.obj||Xt.TrajectoryInfo.get(i.cell.obj.data).size<=1)return null;var o=(r=i.cell.params)===null||r===void 0?void 0:r.definition;return o?M.jsx(Un,{params:o,values:(n=i.cell.params)===null||n===void 0?void 0:n.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy},void 0):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structureType",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length!==1)return null;var a=n.structures[0],i=(r=a.cell.params)===null||r===void 0?void 0:r.definition;return!i||!a.cell.parent?null:M.jsx(nd,{state:a.cell.parent,transform:a.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){var r=this.plugin.managers.structure.hierarchy.selection;if(r.structures.length!==1)return null;var n=r.structures[0];if(!n.cell.parent)return null;var a=ir.tryFindDecorator(this.plugin.state.data,n.cell.transform.ref,st.Model.TransformStructureConformation);if(a)return M.jsx(Bu,E({header:"Conformation Transform"},{children:M.jsx(nd,{state:a.parent,transform:a.transform,customHeader:"none",noMargin:!0,autoHideApply:!0},void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.presetActions,a=this.label;return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[M.jsx(pr,E({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:a},{children:a}),void 0),n.length>0&&M.jsx(qt,{svg:u3,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="presets",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&M.jsx(er,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0},void 0),this.state.show==="presets"&&M.jsx(er,{items:n,onSelect:this.applyPreset},void 0),this.modelIndex,this.structureType,this.transform,M.jsxs("div",E({style:{marginTop:"6px"}},{children:[M.jsx(BYe,{},void 0),M.jsx(TYe,{hideOnEmpty:!0},void 0)]}),void 0)]},void 0)},t}(Xg);function jYe(e,t){var r=GYe(e,t||UO());return YYe(e.tree,r),t&&t.refs.forEach($Ye,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function UO(){return{volumes:[],lazyVolumes:[],refs:new Map}}function zYe(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function VYe(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function HYe(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function GYe(e,t){return{state:e,oldHierarchy:t,hierarchy:UO(),changed:!1,added:new Set}}function yT(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function qYe(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function hz(){}var WYe=[[qYe(ge.Volume.Data,function(e){return e.currentVolume}),function(e,t){e.currentVolume=yT(e,t,e.hierarchy.volumes,zYe,t)},function(e){return e.currentVolume=void 0}],[function(e){return ge.Volume.Lazy.is(e.obj)},function(e,t){yT(e,t,e.hierarchy.lazyVolumes,VYe,t)},hz],[function(e,t){return!e.state.isGhost&&!!t.currentVolume&&ge.Volume.Representation3D.is(e.obj)},function(e,t){return e.currentVolume&&yT(e,t,e.currentVolume.representations,HYe,t,e.currentVolume),!1},hz]];function qee(e){if(!e||!(e!=null&&e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===On.Null||e.status!=="ok"&&e.status!=="error")}function $Ye(e){var t=e.cell;qee(t)||(this.changed=!0)}function XYe(e){Wee(this,this.tree.transforms.get(e))}function Wee(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(qee(n)){for(var a=void 0,i=!1,o=0,s=WYe;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){i=!0;break}a=d;break}}if(!i){var h=e.tree.children.get(t.ref);h&&h.size&&h.forEach(XYe,e),a&&a(r)}}}function YYe(e,t){var r={tree:e,state:t};return Wee(r,e.root),r.state}function eg(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?KYe(e,t||_t.One,r):$ee(e,t||_t.One,r)}function KYe(e,t,r){var n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,a=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return $ee(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function $ee(e,t,r){r===void 0&&(r={});var n=e.representation.volume.themes,a={volume:t},i=r.type||e.representation.volume.registry.default.provider,o=T.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),l=T.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(l,i.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=T.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var h=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:h}}}var N_=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:UO(),selection:void 0},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,volume:n.selection})},n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;var n=jYe(this.plugin.state.data,this.current);if(n.changed){var a=n.hierarchy;this.state.hierarchy=a,this.state.selection?this.state.selection=a.refs.has(this.state.selection.cell.transform.ref)?a.refs.get(this.state.selection.cell.transform.ref):a.volumes[0]:this.state.selection=a.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,volume:this.state.selection})):this.state.notified=!1}}},t.prototype.setCurrent=function(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})},t.prototype.remove=function(r,n){if(r.length!==0){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete(typeof s=="string"?s:s.cell.transform.ref)}return a.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var a=n!==void 0?n!=="show":!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];Jp(this.dataState,s.cell.transform.ref,a)}},t.prototype.addRepresentation=function(r,n){var a,i=this.dataState.build().to(r.cell).apply(st.Representation.VolumeRepresentation3D,eg(this.plugin,(a=r.cell.obj)===null||a===void 0?void 0:a.data,{type:n}));return i.commit({canUndo:"Add Representation"})},t}(zb);(function(e){function t(r,n){var a,i;return!((a=n==null?void 0:n.cell.obj)===null||a===void 0)&&a.data?r.representation.volume.registry.getApplicableTypes((i=n.cell.obj)===null||i===void 0?void 0:i.data):r.representation.volume.registry.types}e.getRepresentationTypes=t})(N_||(N_={}));var WD=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ge.Create({name:"Volume Streaming",typeClass:"Object"})),pz;(function(e){(function(t){t.Float32="float32",t.Int8="int8"})(e.ValueType||(e.ValueType={}))})(pz||(pz={}));function QYe(e,t){if(t===void 0&&(t="x-ray"),!e)return t;var r=e.models[0];return nn.is(r.sourceData)?Xt.hasEmMap(r)?"em":Xt.hasXrayMap(r)?"x-ray":Xt.isFromEm(r)?"em":Xt.isFromXray(r)?"x-ray":t:t}function ZYe(e){var t=[];if(!nn.is(e.sourceData))return[e.entryId];var r=e.sourceData.data.db.pdbx_database_related,n=r.db_id,a=r.db_name,i=r.content_type;if(!a.isDefined)return[e.entryId];for(var o=0,s=a.rowCount;o<s;++o)a.value(o).toUpperCase()==="EMDB"&&i.value(o)==="associated EM volume"&&t.push(n.value(o));return t}function JYe(e){return[e.entryId]}function eKe(e,t){if(!t||!t.models.length)return[];var r=t.models[0];switch(e){case"em":return ZYe(r);case"x-ray":return JYe(r)}}function vz(e,t,r,n){return de(this,void 0,void 0,function(){return fe(this,function(a){switch(e){case"emdb":return[2,Xee(t,r,n)];case"pdbe":return[2,tKe(t,r,n)]}return[2]})})}function Xee(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o;return fe(this,function(s){switch(s.label){case 0:return n=e.config.get($r.VolumeStreaming.EmdbHeaderServer),[4,e.fetch({url:n+"/"+r.toUpperCase()+"/header/"+r.toLowerCase()+".xml",type:"xml"}).runInContext(t)];case 1:return a=s.sent(),i=a.getElementsByTagName("map")[0],o=parseFloat(i.getElementsByTagName("contourLevel")[0].textContent),[2,o]}})})}function tKe(e,t,r){var n,a,i,o;return de(this,void 0,void 0,function(){var s,u;return fe(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/emdb/api/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return s=l.sent(),u=(a=(n=s==null?void 0:s.map)===null||n===void 0?void 0:n.contour_list)===null||a===void 0?void 0:a.contour,!u||u.length===0?[2,rKe(e,t,r)]:[2,(o=(i=u.find(function(c){return c.primary}))===null||i===void 0?void 0:i.level)!==null&&o!==void 0?o:u[0].level]}})})}function rKe(e,t,r){var n,a,i;return de(this,void 0,void 0,function(){var o,s,u;return fe(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return o=l.sent(),s=o==null?void 0:o[r],u=void 0,((i=(a=(n=s==null?void 0:s[0])===null||n===void 0?void 0:n.map)===null||a===void 0?void 0:a.contour_level)===null||i===void 0?void 0:i.value)!==void 0&&(u=+s[0].map.contour_level.value),[2,u]}})})}function nKe(e,t,r){var n;return de(this,void 0,void 0,function(){var a,i,o,s;return fe(this,function(u){switch(u.label){case 0:return[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/"+r,type:"json"}).runInContext(t)];case 1:if(a=u.sent(),i=a==null?void 0:a[r],o=[],!((n=i==null?void 0:i[0])===null||n===void 0)&&n.related_structures){if(s=i[0].related_structures.filter(function(l){return l.resource==="EMDB"&&l.relationship==="associated EM volume"}),!s.length)throw new Error("No related EMDB entry found for '"+r+"'.");o.push.apply(o,s.map(function(l){return l.accession}))}else throw new Error("No related EMDB entry found for '"+r+"'.");return[2,o]}})})}function zd(e,t,r){return{i:e,j:t,k:r}}function bs(e,t){return{a:e,b:t}}var Jn=[zd(0,0,0),zd(1,0,0),zd(1,1,0),zd(0,1,0),zd(0,0,1),zd(1,0,1),zd(1,1,1),zd(0,1,1)],aKe=[bs(Jn[0],Jn[1]),bs(Jn[1],Jn[2]),bs(Jn[2],Jn[3]),bs(Jn[3],Jn[0]),bs(Jn[4],Jn[5]),bs(Jn[5],Jn[6]),bs(Jn[6],Jn[7]),bs(Jn[7],Jn[4]),bs(Jn[0],Jn[4]),bs(Jn[1],Jn[5]),bs(Jn[2],Jn[6]),bs(Jn[3],Jn[7])],iKe=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],oKe=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],tg=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],bT=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function sKe(e,t){var r=Math.min(65536,e*4),n=Je.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),a=Je.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),i=Je.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=Je.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,u=0;return{addVertex:function(l,c,d){return++s,Je.add3(n,l,c,d)},addNormal:function(l,c,d){Je.add3(a,l,c,d)},addGroup:function(l){Je.add(i,l)},addTriangle:function(l,c,d,f){var h=l[c],v=l[d],p=l[f];h>=0&&v>=0&&p>=0&&(++u,Je.add3(o,h,v,p))},get:function(){var l=Je.compact(n,!0),c=Je.compact(a,!0),d=Je.compact(o,!0),f=Je.compact(i,!0);return Ft.create(l,d,c,f,s,u,t)}}}function uKe(e,t){var r=Je.create(Float32Array,3,e),n=Je.create(Float32Array,1,e),a=Je.create(Float32Array,2,e),i=0;return{addVertex:function(o,s,u){return Je.add3(r,o,s,u)},addNormal:function(){return cf},addGroup:function(o){Je.add(n,o)},addTriangle:function(o,s,u,l,c){var d=o[s],f=o[u],h=o[l];d>=0&&f>=0&&h>=0&&(bT[s][u]&c&&(++i,Je.add2(a,o[s],o[u])),bT[u][l]&c&&(++i,Je.add2(a,o[u],o[l])),bT[s][l]&c&&(++i,Je.add2(a,o[s],o[l])))},get:function(){for(var o=Je.compact(r,!0),s=Je.compact(a,!0),u=Je.compact(n,!0),l=is.create(i,i/10,t),c=0;c<i;++c){var d=s[c*2],f=s[c*2+1];l.add(o[d*3],o[d*3+1],o[d*3+2],o[f*3],o[f*3+1],o[f*3+2],u[d])}return l.getLines()}}}function Yee(e){return E(E({},e),{bottomLeft:Da(e.bottomLeft,[0,0,0]),topRight:Da(e.topRight,e.scalarField.space.dimensions)})}function Kee(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function rE(e,t){var r=this;return et.create("Marching Cubes Mesh",function(n){return de(r,void 0,void 0,function(){var a,i,o,s,u,l,c;return fe(this,function(d){switch(d.label){case 0:return a=Yee(e),i=Kee(a),o=i.dX,s=i.dY,u=i.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=sKe(l,t),[4,new Qee(n,c,a).run()];case 1:return d.sent(),[2,c.get()]}})})})}function jO(e,t){var r=this;return et.create("Marching Cubes Lines",function(n){return de(r,void 0,void 0,function(){var a,i,o,s,u,l,c;return fe(this,function(d){switch(d.label){case 0:return a=Yee(e),i=Kee(a),o=i.dX,s=i.dY,u=i.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=uKe(l,t),[4,new Qee(n,c,a).run()];case 1:return d.sent(),[2,c.get()]}})})})}var Qee=function(){function e(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new lKe(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return de(this,void 0,void 0,function(){var t,r;return fe(this,function(n){switch(n.label){case 0:t=0,this.edgeFilter=15,r=this.minZ,n.label=1;case 1:return r<this.maxZ?(this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:t,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r++,this.edgeFilter&=-5,[3,1];case 4:return[2]}})})},e.prototype.slice=function(t){this.edgeFilter|=2;for(var r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)},e.prototype.run=function(){return de(this,void 0,void 0,function(){return fe(this,function(t){switch(t.label){case 0:return[4,this.doSlices()];case 1:return t.sent(),[2]}})})},e}(),lKe=function(){function e(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i},e.prototype.clearEdgeVertexIndexSlice=function(t){var r=t%2===0?0:3*this.nX*this.nY,n=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)},e.prototype.interpolate=function(t){var r=iKe[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,a=this.verticesOnEdges[n];if(a>0)return a-1;var i=this.scalarField,o=this.scalarFieldGet,s=aKe[t],u=s.a,l=s.b,c=u.i+this.i,d=u.j+this.j,f=u.k+this.k,h=l.i+this.i,v=l.j+this.j,p=l.k+this.k,g=o(i,c,d,f),m=o(i,h,v,p),y=(this.isoLevel-g)/(g-m);if(this.idField){var b=this.idFieldGet(this.idField,c,d,f),S=this.idFieldGet(this.idField,h,v,p),x=y<.5?b:S;if(x===-1&&(x=y<.5?S:b),x===-2)return-1;this.builder.addGroup(x)}else this.builder.addGroup(0);var C=this.builder.addVertex(c+y*(c-h),d+y*(d-v),f+y*(f-p));this.verticesOnEdges[n]=C+1;var w=o(i,Math.max(0,c-1),d,f)-o(i,Math.min(this.nX-1,c+1),d,f),A=o(i,c,Math.max(0,d-1),f)-o(i,c,Math.min(this.nY-1,d+1),f),I=o(i,c,d,Math.max(0,f-1))-o(i,c,d,Math.min(this.nZ,f+1)),D=o(i,Math.max(0,h-1),v,p)-o(i,Math.min(this.nX-1,h+1),v,p),k=o(i,h,Math.max(0,v-1),p)-o(i,h,Math.min(this.nY-1,v+1),p),R=o(i,h,v,Math.max(0,p-1))-o(i,h,v,Math.min(this.nZ-1,p+1)),L=w+y*(w-D),H=A+y*(A-k),B=I+y*(I-R);return this.isoLevel>=0?this.builder.addNormal(L,H,B):this.builder.addNormal(-L,-H,-B),C},e.prototype.get=function(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)},e.prototype.processCell=function(t,r,n,a){var i=0;if(this.get(t,r,n)<this.isoLevel&&(i|=1),this.get(t+1,r,n)<this.isoLevel&&(i|=2),this.get(t+1,r+1,n)<this.isoLevel&&(i|=4),this.get(t,r+1,n)<this.isoLevel&&(i|=8),this.get(t,r,n+1)<this.isoLevel&&(i|=16),this.get(t+1,r,n+1)<this.isoLevel&&(i|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(i|=64),this.get(t,r+1,n+1)<this.isoLevel&&(i|=128),!(i===0||i===255)){this.i=t,this.j=r,this.k=n;var o=oKe[i];(o&1)>0&&(this.vertList[0]=this.interpolate(0)),(o&2)>0&&(this.vertList[1]=this.interpolate(1)),(o&4)>0&&(this.vertList[2]=this.interpolate(2)),(o&8)>0&&(this.vertList[3]=this.interpolate(3)),(o&16)>0&&(this.vertList[4]=this.interpolate(4)),(o&32)>0&&(this.vertList[5]=this.interpolate(5)),(o&64)>0&&(this.vertList[6]=this.interpolate(6)),(o&128)>0&&(this.vertList[7]=this.interpolate(7)),(o&256)>0&&(this.vertList[8]=this.interpolate(8)),(o&512)>0&&(this.vertList[9]=this.interpolate(9)),(o&1024)>0&&(this.vertList[10]=this.interpolate(10)),(o&2048)>0&&(this.vertList[11]=this.interpolate(11));for(var s=tg[i],u=0;u<s.length;u+=3){var l=s[u],c=s[u+1],d=s[u+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,l,c,d,a):this.builder.addTriangle(this.vertList,d,c,l,a)}}},e}();function cKe(e,t,r,n,a,i){var o=oi.getUtils(t),s=o.createValues,u=o.createRenderableState,l=Mk(),c=s(t,l,r,n,a),d=u(a);return a0(t.kind,c,d,i)}function qb(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.dispose,c=e.geometryUtils,d=c.updateValues,f=c.updateBoundingSphere,h=c.updateRenderableState,v=c.createPositionIterator,p=Ll.create(),g,m,y,b,S=Object.assign({},r),x=ya.createEmpty(),C,w,A,I;function D(L,H,B){if(!B&&!C)throw new Error("missing volume");if(m=Object.assign({},S,H),y=L,b=B,Ll.reset(p),g?(!C||!_t.areEquivalent(b,C))&&(p.createNew=!0):p.createNew=!0,p.createNew){p.createGeometry=!0;return}s(p,B,m,S,y,x),Qc.areEqual(L.color,x.color)||(p.updateColor=!0),p.createGeometry&&(p.updateColor=!0)}function k(L){if(p.createNew)if(A=a(b),L)g=cKe(b,L,A,y,m,t),I=v(L,g.values);else throw new Error("expected geometry to be given");else{if(!g)throw new Error("expected renderObject to be available");if(A.reset(),p.createGeometry)if(L)N.updateIfChanged(g.values.drawCount,oi.getDrawCount(L)),N.updateIfChanged(g.values.uVertexCount,oi.getVertexCount(L));else throw new Error("expected geometry to be given");(p.updateTransform||p.createGeometry)&&(f(g.values,L||w),I=v(L||w,g.values)),p.updateSize&&"uSize"in g.values&&hd(A,y.size,g.values),p.updateColor&&cs(A,I,y.color,g.values),d(g.values,m),h(g.state,m)}S=m,x=y,C=b,L&&(w=L)}function R(L,H){return js(L)?H(Re.ofBounds(0,A.groupCount*A.instanceCount)):o(L,C,S,H)}return{get groupCount(){return A?A.count:0},get renderObject(){return g},createOrUpdate:function(L,H,B,j){return B===void 0&&(B={}),de(this,void 0,void 0,function(){var Q;return fe(this,function(G){return D(H,B,j||C),p.createGeometry?(Q=n(L,b,y,m,w),[2,uO(Q)?Q.then(k):k(Q)]):(k(),[2])})})},getLoci:function(L){return g?i(L,C,S,g.id):Or},mark:function(L,H){return Cr.mark(g,L,H,R)},setVisibility:function(L){Cr.setVisibility(g,L)},setAlphaFactor:function(L){Cr.setAlphaFactor(g,L)},setPickable:function(L){Cr.setPickable(g,L)},setColorOnly:function(L){Cr.setColorOnly(g,L)},setTransform:function(L,H){Cr.setTransform(g,L,H)},setOverpaint:function(L){return Cr.setOverpaint(g,L,R,!0)},setTransparency:function(L){return Cr.setTransparency(g,L,R,!0)},setClipping:function(L){return Cr.setClipping(g,L,R,!0)},destroy:function(){l==null||l(w),g&&(g.state.disposed=!0,g=void 0)},mustRecreate:u}}E({},At.Params);function F_(e,t,r,n,a){var i=0,o=t.webgl,s=new ta,u=_d(),l=[],c=sr.createState(),d,f,h,v,p=ya.createEmpty();function g(x,C){var w=this;x===void 0&&(x={}),C&&C!==f&&(h=r(t,C),f=C,v||(v=T.getDefaultValues(h)));var A=xD(Object.assign({},v,x),f);return Object.assign(v,x,A),et.create("Creating or updating VolumeRepresentation",function(I){return de(w,void 0,void 0,function(){var D,k;return fe(this,function(R){switch(R.label){case 0:return d?!((k=d.mustRecreate)===null||k===void 0)&&k.call(d,f,v,o)&&(d.destroy(),d=n(u,f,v,o)):d=n(u,f,v,o),D=d.createOrUpdate({webgl:o,runtime:I},p,v,C),D?[4,D]:[3,2];case 1:R.sent(),R.label=2;case 2:return l.length=0,d&&d.renderObject&&l.push(d.renderObject),s.next(i++),[2]}})})})}function m(x,C){return d?d.mark(x,C):!1}function y(x){x.visible!==void 0&&d&&d.setVisibility(x.visible),x.alphaFactor!==void 0&&d&&d.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&d&&d.setPickable(x.pickable),x.overpaint!==void 0&&d&&d.setOverpaint(x.overpaint),x.transparency!==void 0&&d&&d.setTransparency(x.transparency),x.transform!==void 0&&d&&d.setTransform(x.transform),sr.updateState(c,x)}function b(x){p=x}function S(){d&&d.destroy()}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return v},get params(){return h},get state(){return c},get theme(){return p},renderObjects:l,updated:s,createOrUpdate:g,setState:y,setTheme:b,getLoci:function(x){return x===void 0?a(f,v):d?d.getLoci(x):Or},mark:m,destroy:S}}var B_=_.set,Zee=_.normalize,Jee=_.sub,ete=_.addScalar,U_=_.scale,tte=_.toArray;function zO(e,t,r,n){var a=!1;if(_t.isLoci(e)){if(!_t.areEquivalent(e.volume,t))return!1;n(Re.ofLength(t.grid.cells.data.length))&&(a=!0)}else if(_t.Isosurface.isLoci(e)){if(!_t.areEquivalent(e.volume,t))return!1;if(r){if(!_t.IsoValue.areSame(e.isoValue,r,t.grid.stats))return!1;n(Re.ofLength(t.grid.cells.data.length))&&(a=!0)}else for(var i=t.grid,o=i.stats,s=i.cells.data,u=o.sigma,l=_t.IsoValue.toAbsolute(e.isoValue,o).absoluteValue,c=0,d=s.length;c<d;++c)mn(l,s[c],u)&&n(Re.ofSingleton(c))&&(a=!0)}else if(_t.Cell.isLoci(e)){if(!_t.areEquivalent(e.volume,t))return!1;Re.is(e.indices)?n(e.indices)&&(a=!0):Fe.forEach(e.indices,function(f){n(Re.ofSingleton(f))&&(a=!0)})}return a}function Wb(e,t){t===void 0&&(t=0);var r=e[0]*e[1]*e[2],n=Math.sqrt(r),a=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),i=e[0]+t,o=e[1]+t,s=1,u=i;return a<i*e[2]?(u=Math.floor(a/i),s=Math.ceil(e[2]/u),i*=u,o*=s):i*=e[2],{width:i,height:o,columns:u,rows:s,powerOfTwoSize:o<a?a:a*2}}function rte(e,t,r){r===void 0&&(r=0);for(var n=e.grid,a=n.cells,i=a.space,o=a.data,s=n.stats,u=s.max,l=s.min,c=i.dimensions,d=i.dataOffset,f=Wb(c,r),h=f.width,v=f.height,p=t==="data"?1:4,g=new Uint8Array(h*v*p),m={array:g,width:h,height:v},y=u-l,b=c[0],S=c[1],x=c[2],C=b+r,w=S+r,A=_(),I=_(),D=b-1,k=S-1,R=x-1,L=0;L<x;++L)for(var H=0;H<S;++H)for(var B=0;B<b;++B){var j=Math.floor(L*C%h/C),Q=Math.floor(L*C/h),G=j*C+B,W=p*(Q*w*h+H*h+G),q=d(B,H,L);t==="data"?g[W]=Math.round((o[q]-l)/y*255):(t==="groups"?Ob(q,g,W):(B_(A,o[d(Math.max(0,B-1),H,L)],o[d(B,Math.max(0,H-1),L)],o[d(B,H,Math.max(0,L-1))]),B_(I,o[d(Math.min(D,B+1),H,L)],o[d(B,Math.min(k,H+1),L)],o[d(B,H,Math.min(R,L+1))]),Zee(A,Jee(A,A,I)),ete(A,U_(A,A,.5),.5),tte(U_(A,A,255),g,W)),g[W+3]=Math.round((o[q]-l)/y*255))}return m}function dKe(e){for(var t=e.grid,r=t.cells,n=r.space,a=r.data,i=t.stats,o=i.max,s=i.min,u=n.dimensions,l=u[0],c=u[1],d=u[2],f=n.dataOffset,h=new Uint8Array(l*c*d*4),v={array:h,width:l,height:c,depth:d},p=o-s,g=_(),m=_(),y=l-1,b=c-1,S=d-1,x=0,C=0;C<d;++C)for(var w=0;w<c;++w)for(var A=0;A<l;++A){var I=f(A,w,C);B_(g,a[f(Math.max(0,A-1),w,C)],a[f(A,Math.max(0,w-1),C)],a[f(A,w,Math.max(0,C-1))]),B_(m,a[f(Math.min(y,A+1),w,C)],a[f(A,Math.min(b,w+1),C)],a[f(A,w,Math.min(S,C+1))]),Zee(g,Jee(g,g,m)),ete(g,U_(g,g,.5),.5),tte(U_(g,g,255),h,x),h[x+3]=Math.round((a[I]-s)/p*255),x+=4}return v}var fKe=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`,hKe=E(E({},xi),{tTexture:lr("texture","rgba","float","nearest")}),Ms="histopyramid-sum";function pKe(e,t){if(e.namedComputeRenderables[Ms]){var r=e.namedComputeRenderables[Ms].values;N.update(r.tTexture,t),e.namedComputeRenderables[Ms].update()}else e.namedComputeRenderables[Ms]=vKe(e,t);return e.namedComputeRenderables[Ms]}function vKe(e,t){var r=E(E({},Si),{tTexture:N.create(t)}),n=E({},hKe),a=Ln("sum",Ro,fKe,{},{0:"ivec4"}),i=Za(e,"triangles",a,n,r);return Qa(i,r)}function mKe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var xx=new Uint8Array(4),mz=new Int32Array(4);function gKe(e,t){var r=e.gl,n=e.resources,a=pKe(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[Ms]||(e.namedFramebuffers[Ms]=n.framebuffer());var i=e.namedFramebuffers[Ms];e.namedTextures[Ms]||(e.namedTextures[Ms]=Er(r)?n.texture("image-int32","rgba","int","nearest"):n.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[Ms].define(1,1));var o=e.namedTextures[Ms];return o.attachFramebuffer(i,0),mKe(e),r.viewport(0,0,1,1),a.render(),r.finish(),e.readPixels(0,0,1,1,Er(r)?mz:xx),e.unbindFramebuffer(),Er(r)?mz[0]:Yk(xx[0],xx[1],xx[2])}var yKe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = decodeFloatRGB(texture2D(tPreviousLevel, position).rgb);
            b = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(encodeFloatRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`,bKe=E(E({},xi),{tInputLevel:lr("texture","rgba","float","nearest"),tPreviousLevel:lr("texture","rgba","float","nearest"),uSize:Qe("f"),uTexSize:Qe("f"),uFirst:Qe("b")}),tp="histogram-pyramid";function xKe(e,t,r){if(e.namedComputeRenderables[tp]){var n=e.namedComputeRenderables[tp].values;N.update(n.tInputLevel,t),N.update(n.tPreviousLevel,r),e.namedComputeRenderables[tp].update()}else e.namedComputeRenderables[tp]=SKe(e,t,r);return e.namedComputeRenderables[tp]}function SKe(e,t,r){var n=E(E({},Si),{tInputLevel:N.create(t),tPreviousLevel:N.create(r),uSize:N.create(0),uTexSize:N.create(0),uFirst:N.create(!0)}),a=E({},bKe),i=Ln("reduction",Ro,yKe,{},{0:"ivec4"}),o=Za(e,"triangles",i,a,n);return Qa(o,n)}var gz=[];function CKe(e,t){var r=gz[t],n=Math.pow(2,t);if(r===void 0){var a=e.isWebGL2?j_("level"+t,e,"image-int32","alpha","int","nearest"):j_("level"+t,e,"image-uint8","rgba","ubyte","nearest");a.define(n,n);var i=nte("level"+t,e);a.attachFramebuffer(i,0),r={texture:a,framebuffer:i},gz[t]=r}return r}function _Ke(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function nte(e,t){var r=tp+"-"+e;return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function j_(e,t,r,n,a,i){var o=tp+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function wKe(e,t,r,n){var a=e.gl,i=t.getWidth(),o=t.getHeight();if(i!==o||!vSe(i))throw new Error("inputTexture must be of square power-of-two size");var s=Math.ceil(Math.log(i)/Math.log(2)),u=Math.pow(2,s),l=Math.pow(2,s),c=Math.pow(2,s-1),d=e.isWebGL2?j_("pyramid",e,"image-int32","alpha","int","nearest"):j_("pyramid",e,"image-uint8","rgba","ubyte","nearest");d.define(l,c);var f=nte("pyramid",e);d.attachFramebuffer(f,0),a.viewport(0,0,l,c),Er(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT);for(var h=[],v=0;v<s;++v)h.push(CKe(e,v));var p=xKe(e,t,h[0].texture);e.state.currentRenderItemId=-1,_Ke(e);for(var g=0,v=0;v<s;v++){var m=s-1-v,y=h[m];y.framebuffer.bind();var b=Math.pow(2,m);N.update(p.values.uSize,Math.pow(2,v+1)/u),N.update(p.values.uTexSize,b),N.updateIfChanged(p.values.uFirst,v===0),v>0&&(N.update(p.values.tPreviousLevel,h[s-v].texture),p.update()),e.state.currentRenderItemId=-1,a.viewport(0,0,b,b),a.scissor(0,0,b,b),Er(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT),a.scissor(0,0,n[0],n[1]),p.render(),d.bind(0),a.copyTexSubImage2D(a.TEXTURE_2D,0,g,0,0,0,b,b),d.unbind(0),g+=b}a.finish();var S=Math.max(1,gKe(e,h[0].texture)),x=Math.ceil(S/Math.pow(2,s));return{pyramidTex:d,count:S,height:x,levels:s,scale:r}}var X0;function EKe(){if(X0!==void 0)return X0;X0=bi(16*16,1,Uint8Array);for(var e=X0.array,t=0,r=tg.length;t<r;++t)e[t]=tg[t].length/3;return X0}var Y0;function AKe(){if(Y0!==void 0)return Y0;Y0=bi(64*64,1,Uint8Array);for(var e=Y0.array,t=0,r=tg.length;t<r;++t)for(var n=0;n<16;++n)n<tg[t].length?e[t*16+n]=tg[t][n]:e[t*16+n]=255;return Y0}var PKe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform mat4 uGridTransform;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

vec4 voxelPadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(decodeFloatRGB(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    float v0 = d0.a;
    float v1 = d1.a;

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // so we ensure a constant group id per triangle here
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = coord3d.z + coord3d.y * gridDim.z + coord3d.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            vec3 b = t < 0.5 ? b0 : b1;
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = b.z + b.y * gridDim.z + b.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,
        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,
        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a
    ));
    vec3 n1 = -normalize(vec3(
        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,
        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,
        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));
}
`,TKe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxel(posXYZ).a, uIsoValue)
        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)
        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)
        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)
        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)
        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)
        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)
        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`,IKe=E(E({},xi),{tTriCount:lr("image-uint8","alpha","ubyte","nearest"),tVolumeData:lr("texture","rgba","ubyte","nearest"),uIsoValue:Qe("f"),uGridDim:Qe("v3"),uGridTexDim:Qe("v3"),uScale:Qe("v2")}),mu="active-voxels";function MKe(e,t,r,n,a,i){if(e.namedComputeRenderables[mu]){var o=e.namedComputeRenderables[mu].values;N.update(o.uQuadScale,i),N.update(o.tVolumeData,t),N.updateIfChanged(o.uIsoValue,a),N.update(o.uGridDim,r),N.update(o.uGridTexDim,n),N.update(o.uScale,i),e.namedComputeRenderables[mu].update()}else e.namedComputeRenderables[mu]=DKe(e,t,r,n,a,i);return e.namedComputeRenderables[mu]}function DKe(e,t,r,n,a,i){var o=E(E({},Si),{tTriCount:N.create(EKe()),uQuadScale:N.create(i),tVolumeData:N.create(t),uIsoValue:N.create(a),uGridDim:N.create(r),uGridTexDim:N.create(n),uScale:N.create(i)}),s=E({},IKe),u=Ln("active-voxels",Ro,TKe),l=Za(e,"triangles",u,s,o);return Qa(l,o)}function RKe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function kKe(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=t.getWidth(),l=t.getHeight();e.namedFramebuffers[mu]||(e.namedFramebuffers[mu]=s.framebuffer());var c=e.namedFramebuffers[mu];c.bind(),e.namedTextures[mu]||(e.namedTextures[mu]=s.texture("image-uint8","rgba","ubyte","nearest"));var d=e.namedTextures[mu];d.define(u,l);var f=MKe(e,t,r,n,a,i);return e.state.currentRenderItemId=-1,d.attachFramebuffer(c,0),RKe(e),o.viewport(0,0,u,l),o.scissor(0,0,u,l),o.clear(o.COLOR_BUFFER_BIT),o.scissor(0,0,n[0],n[1]),f.render(),o.finish(),d}var OKe=E(E({},xi),{tTriIndices:lr("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:lr("texture","rgba","float","nearest"),tActiveVoxelsBase:lr("texture","rgba","float","nearest"),tVolumeData:lr("texture","rgba","ubyte","nearest"),uIsoValue:Qe("f"),uSize:Qe("f"),uLevels:Qe("f"),uCount:Qe("f"),uInvert:Qe("b"),uGridDim:Qe("v3"),uGridTexDim:Qe("v3"),uGridTransform:Qe("m4"),uScale:Qe("v2"),dPackedGroup:Qt("boolean")}),mf="isosurface";function LKe(e,t,r,n,a,i,o,s,u,l,c,d,f){if(e.namedComputeRenderables[mf]){var h=e.namedComputeRenderables[mf].values;N.update(h.tActiveVoxelsPyramid,t),N.update(h.tActiveVoxelsBase,r),N.update(h.tVolumeData,n),N.updateIfChanged(h.uIsoValue,s),N.updateIfChanged(h.uSize,Math.pow(2,u)),N.updateIfChanged(h.uLevels,u),N.updateIfChanged(h.uCount,c),N.updateIfChanged(h.uInvert,d),N.update(h.uGridDim,a),N.update(h.uGridTexDim,i),N.update(h.uGridTransform,o),N.update(h.uScale,l),N.update(h.dPackedGroup,f),e.namedComputeRenderables[mf].update()}else e.namedComputeRenderables[mf]=NKe(e,t,r,n,a,i,o,s,u,l,c,d,f);return e.namedComputeRenderables[mf]}function NKe(e,t,r,n,a,i,o,s,u,l,c,d,f){var h=E(E({},Si),{tTriIndices:N.create(AKe()),tActiveVoxelsPyramid:N.create(t),tActiveVoxelsBase:N.create(r),tVolumeData:N.create(n),uIsoValue:N.create(s),uSize:N.create(Math.pow(2,u)),uLevels:N.create(u),uCount:N.create(c),uInvert:N.create(d),uGridDim:N.create(a),uGridTexDim:N.create(i),uGridTransform:N.create(o),uScale:N.create(l),dPackedGroup:N.create(f)}),v=E({},OKe),p=Ln("isosurface",Ro,PKe,{drawBuffers:"required"}),g=Za(e,"triangles",p,v,h);return Qa(g,h)}function FKe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function BKe(e,t,r,n,a,i,o,s,u,l,c,d,f){var h=e.gl,v=e.resources,p=e.extensions,g=n.pyramidTex,m=n.height,y=n.levels,b=n.scale,S=n.count,x=g.getWidth();e.namedFramebuffers[mf]||(e.namedFramebuffers[mf]=v.framebuffer());var C=e.namedFramebuffers[mf];Er(h)?(c||(c=p.colorBufferHalfFloat&&p.textureHalfFloat?v.texture("image-float16","rgba","fp16","nearest"):v.texture("image-float32","rgba","float","nearest")),d||(d=v.texture("image-uint8","rgba","ubyte","nearest")),f||(f=p.colorBufferHalfFloat&&p.textureHalfFloat?v.texture("image-float16","rgba","fp16","nearest"):v.texture("image-float32","rgba","float","nearest"))):(c||(c=v.texture("image-float32","rgba","float","nearest")),d||(d=v.texture("image-float32","rgba","float","nearest")),f||(f=v.texture("image-float32","rgba","float","nearest"))),c.define(x,m),d.define(x,m),f.define(x,m),c.attachFramebuffer(C,0),d.attachFramebuffer(C,1),f.attachFramebuffer(C,2);var w=LKe(e,g,t,r,a,i,o,s,y,b,S,u,l);e.state.currentRenderItemId=-1;var A=e.extensions.drawBuffers;if(!A)throw new Error("need WebGL draw buffers");return C.bind(),A.drawBuffers([A.COLOR_ATTACHMENT0,A.COLOR_ATTACHMENT1,A.COLOR_ATTACHMENT2]),FKe(e),h.viewport(0,0,x,m),h.clear(h.COLOR_BUFFER_BIT),w.render(),h.finish(),{vertexTexture:c,groupTexture:d,normalTexture:f,vertexCount:S}}function VO(e,t,r,n,a,i,o,s,u,l,c,d){var f=kKe(e,t,r,n,o,a),h=wKe(e,f,a,n),v=BKe(e,f,t,h,r,n,i,o,s,u,l,c,d);return v}var ate={isoValue:_t.IsoValueParam};function UKe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var Ty=1;function HO(e,t){var r=e.grid.cells.space.dimensions,n=Wb(r,Ty).powerOfTwoSize;return n<=t.maxTextureSize/2}function jKe(e,t,r,n){return r.tryUseGpu&&n&&UKe(n)&&HO(t,n)?GKe(e):VKe(e)}function yz(e,t){return _t.Isosurface.Loci(e,t.isoValue)}function GO(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?_t.Cell.Loci(t,Re.ofSingleton(i)):Or}function qO(e,t,r,n){return zO(e,t,r.isoValue,n)}function zKe(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o,s;return fe(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),i=Ws(new Int32Array(t.grid.cells.data.length)),[4,rE({isoLevel:_t.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Pr.create(t.grid.cells.space,Pr.Data1(i))},a).runAsChild(e.runtime)];case 1:return o=u.sent(),s=Pi.getGridToCartesianTransform(t.grid),Ft.transform(o,s),e.webgl&&!e.webgl.isWebGL2&&Ft.uniformTriangleGroup(o,!1),o.setBoundingSphere(_t.getBoundingSphere(t)),[2,o]}})})}var WO=E(E(E(E({},Ft.Params),Vu.Params),ate),{quality:E(E({},Ft.Params.quality),{isEssential:!1}),tryUseGpu:T.Boolean(!0)});function VKe(e){return qb({defaultProps:T.getDefaultValues(WO),createGeometry:zKe,createLocationIterator:function(t){return bn(t.grid.cells.data.length,1,1,function(){return ns})},getLoci:GO,eachLocation:qO,setUpdateState:function(t,r,n,a){_t.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Ft.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&HO(t,n)}},e)}var $D;(function(e){var t="volume-isosurface-texture";e.descriptor=Po({name:t});function r(n,a){var i=a.resources,o=Pi.getGridToCartesianTransform(n.grid),s=_.clone(n.grid.cells.space.dimensions),u=Wb(s,Ty),l=u.width,c=u.height,d=u.powerOfTwoSize,f=_.create(l,c,0),h=Ke.create(l/d,c/d);if(d>a.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=i.texture("image-uint8","alpha","ubyte","linear");var v=n._propertyData[t];v.define(d,d),v.load(rte(n,"data",Ty),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:function(){return v.destroy()}}])}return s[0]+=Ty,s[1]+=Ty,{texture:n._propertyData[t],transform:o,gridDimension:s,gridTexDim:f,gridTexScale:h}}e.get=r})($D||($D={}));function HKe(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,h,v,p,g,m,y,b;return fe(this,function(S){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");return i=t.grid.stats,o=i.max,s=i.min,u=o-s,l=_t.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,c=(l-s)/u,d=$D.get(t,e.webgl),f=d.texture,h=d.gridDimension,v=d.gridTexDim,p=d.gridTexScale,g=d.transform,m=a==null?void 0:a.doubleBuffer.get(),y=VO(e.webgl,f,h,v,p,g,c,l<0,!1,m==null?void 0:m.vertex,m==null?void 0:m.group,m==null?void 0:m.normal),b=Vu.create(y.vertexCount,1,y.vertexTexture,y.groupTexture,y.normalTexture,_t.getBoundingSphere(t),a),[2,b]})})}function GKe(e){return qb({defaultProps:T.getDefaultValues(WO),createGeometry:HKe,createLocationIterator:function(t){return bn(t.grid.cells.data.length,1,1,function(){return ns})},getLoci:GO,eachLocation:qO,setUpdateState:function(t,r,n,a){_t.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Vu.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!HO(t,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function qKe(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o,s;return fe(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),i=Ws(new Int32Array(t.grid.cells.data.length)),[4,jO({isoLevel:_t.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Pr.create(t.grid.cells.space,Pr.Data1(i))},a).runAsChild(e.runtime)];case 1:return o=u.sent(),s=Pi.getGridToCartesianTransform(t.grid),Cn.transform(o,s),o.setBoundingSphere(_t.getBoundingSphere(t)),[2,o]}})})}var ite=E(E(E({},Cn.Params),ate),{quality:E(E({},Cn.Params.quality),{isEssential:!1}),sizeFactor:T.Numeric(3,{min:0,max:10,step:.1})});function WKe(e){return qb({defaultProps:T.getDefaultValues(ite),createGeometry:qKe,createLocationIterator:function(t){return bn(t.grid.cells.data.length,1,1,function(){return ns})},getLoci:GO,eachLocation:qO,setUpdateState:function(t,r,n,a){_t.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Cn.Utils},e)}var ote={solid:function(e,t){return F_("Isosurface mesh",e,t,jKe,yz)},wireframe:function(e,t){return F_("Isosurface wireframe",e,t,WKe,yz)}},ste=E(E(E({},WO),ite),{visuals:T.MultiSelect(["solid"],T.objectToOptions(ote))});function $Ke(e,t){var r=T.clone(ste);return r.isoValue=_t.createIsoValueParam(_t.IsoValue.relative(2),t.grid.stats),r}function XKe(e,t){return sr.createMulti("Isosurface",e,t,sr.StateBuilder,ote)}var YKe={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:XKe,getParams:$Ke,defaultValues:T.getDefaultValues(ste),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!_t.isEmpty(e)}};function KKe(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C,w,A,I,D,k,R,L,H,B,j,Q,G,W,q,J,he,$,X,U,z;return fe(this,function(ee){for(i=n.dimension.name,o=n.isoValue,s=t.grid.cells,u=s.space,l=s.data,c=t.grid.stats,d=c.min,f=c.max,h=_t.IsoValue.toAbsolute(o,t.grid.stats).absoluteValue,v=r.color.color(ns,!1),p=dt.toRgbNormalized(v),g=p[0],m=p[1],y=p[2],b=$O(t.grid,n),S=b.width,x=b.height,C=b.x,w=b.y,A=b.z,I=b.x0,D=b.y0,k=b.z0,R=b.nx,L=b.ny,H=b.nz,B=new Float32Array(i==="x"?[C,0,0,C,w,0,C,0,A,C,w,A]:i==="y"?[0,w,0,C,w,0,0,w,A,C,w,A]:[0,0,A,0,w,A,C,0,A,C,w,A]),j=new Uint8Array(S*x*4),Q=QKe(t.grid,n),G=0,W=D;W<L;++W)for(q=I;q<R;++q)for(J=k;J<H;++J)he=u.get(l,q,W,J),$=(he-d)/(f-d),j[G]=g*$*2*255,j[G+1]=m*$*2*255,j[G+2]=y*$*2*255,j[G+3]=he>=h?255:0,G+=4;return X={width:S,height:x,array:j,flipY:!0},U={width:S,height:x,array:Q,flipY:!0},z=Pi.getGridToCartesianTransform(t.grid),Kp(z,B,0,4),[2,Kc.create(X,B,U,a)]})})}function $O(e,t){var r=t.dimension,n=r.name,a=r.params,i=e.cells.space,o,s,u,l,c,d=0,f=0,h=0,v=i.dimensions,p=v[0],g=v[1],m=v[2];return n==="x"?(u=a,l=g-1,c=m-1,o=m,s=g,d=u,p=d+1):n==="y"?(u=p-1,l=a,c=m-1,o=m,s=p,f=l,g=f+1):(u=p-1,l=g-1,c=a,o=p,s=g,h=c,m=h+1),{width:o,height:s,x:u,y:l,z:c,x0:d,y0:f,z0:h,nx:p,ny:g,nz:m}}function QKe(e,t){for(var r=e.cells.space,n=$O(e,t),a=n.width,i=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint8Array(a*i*4),h=0,v=s;v<c;++v)for(var p=o;p<l;++p)for(var g=u;g<d;++g)Ob(r.dataOffset(p,v,g),f,h),h+=4;return f}function ZKe(e,t){for(var r=e.cells.space,n=$O(e,t),a=n.width,i=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint32Array(a*i),h=0,v=s;v<c;++v)for(var p=o;p<l;++p)for(var g=u;g<d;++g)f[h]=r.dataOffset(p,v,g),h+=1;return f}function JKe(e,t){var r=ZKe(e.grid,t);return _t.Cell.Loci(e,it.ofUnsortedArray(r))}function eQe(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?_t.Cell.Loci(t,Re.ofSingleton(i)):Or}function tQe(e,t,r,n){return zO(e,t,void 0,n)}var XO=E(E({},Kc.Params),{quality:E(E({},Kc.Params.quality),{isEssential:!1}),dimension:T.MappedStatic("x",{x:T.Numeric(0,{min:0,max:0,step:1}),y:T.Numeric(0,{min:0,max:0,step:1}),z:T.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:_t.IsoValueParam});function rQe(e,t){var r=T.clone(XO),n=t.grid.cells.space.dimensions;return r.dimension=T.MappedStatic("x",{x:T.Numeric(0,{min:0,max:n[0]-1,step:1}),y:T.Numeric(0,{min:0,max:n[1]-1,step:1}),z:T.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=_t.createIsoValueParam(_t.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}function nQe(e){return qb({defaultProps:T.getDefaultValues(XO),createGeometry:KKe,createLocationIterator:function(t){return bn(t.grid.cells.data.length,1,1,function(){return ns})},getLoci:eQe,eachLocation:tQe,setUpdateState:function(t,r,n,a,i,o){t.createGeometry=n.dimension.name!==a.dimension.name||n.dimension.params!==a.dimension.params||!_t.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||!Qc.areEqual(i.color,o.color)},geometryUtils:E(E({},Kc.Utils),{createRenderableState:function(t){var r=Kc.Utils.createRenderableState(t);return bz(r,t),r},updateRenderableState:bz})},e)}function bz(e,t){Kc.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}function aQe(e,t){return F_("Slice",e,t,nQe,JKe)}var iQe={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:aQe,getParams:rQe,defaultValues:T.getDefaultValues(XO),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!_t.isEmpty(e)}};function ute(e,t){var r=Yt();return Yt.add(r,e),Yt.transform(r,r,t),r}function oQe(e,t,r,n){var a=r.grid.cells.space.dimensions,i=Wb(a),o=i.width,s=i.height;if(Math.max(o,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");var u=rte(r,"normals"),l=Pi.getGridToCartesianTransform(r.grid),c=ute(a,l),d=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");d.load(u);var f=lte(r.grid),h=f.unitToCartn,v=f.cellDim;return ro.create(c,a,l,h,v,d,r.grid.stats,!1,n)}function lte(e){if(e.transform.kind==="matrix")return{unitToCartn:le.mul(le(),e.transform.matrix,le.fromScaling(le(),e.cells.space.dimensions)),cellDim:le.getScaling(_(),e.transform.matrix)};var t=e.transform.fractionalBox,r=Yt.size(_(),t);return{unitToCartn:le.mul3(le(),e.transform.cell.fromFractional,le.fromTranslation(le(),t.min),le.fromScaling(le(),r)),cellDim:_.div(_(),e.transform.cell.size,e.cells.space.dimensions)}}function sQe(e,t,r,n){var a=r.grid.cells.space.dimensions;if(Math.max.apply(Math,a)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");var i=dKe(r),o=Pi.getGridToCartesianTransform(r.grid),s=ute(a,o),u=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");u.load(i);var l=lte(r.grid),c=l.unitToCartn,d=l.cellDim;return ro.create(s,a,o,c,d,u,r.grid.stats,!1,n)}function uQe(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o;return fe(this,function(s){if(i=e.runtime,o=e.webgl,o===void 0)throw new Error("DirectVolumeVisual requires `webgl` in props");return[2,o.isWebGL2?sQe(i,o,t,a):oQe(i,o,t,a)]})})}function lQe(e,t){return t.renderMode.name==="isosurface"?_t.Isosurface.Loci(e,t.renderMode.params.isoValue):_t.Loci(e)}function cQe(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?_t.Cell.Loci(t,Re.ofSingleton(i)):Or}function dQe(e,t,r,n){var a=r.renderMode.name==="isosurface"?r.renderMode.params.isoValue:void 0;return zO(e,t,a,n)}var YO=E(E({},ro.Params),{quality:E(E({},ro.Params.quality),{isEssential:!1})});function fQe(e,t){var r=T.clone(YO);return r.renderMode=ro.createRenderModeParam(t.grid.stats),r}function hQe(e){return qb({defaultProps:T.getDefaultValues(YO),createGeometry:uQe,createLocationIterator:function(t){return bn(t.grid.cells.data.length,1,1,function(){return ns})},getLoci:cQe,eachLocation:dQe,setUpdateState:function(t,r,n,a){},geometryUtils:ro.Utils,dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function pQe(e,t){return F_("Direct Volume",e,t,hQe,lQe)}var vQe={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:pQe,getParams:fQe,defaultValues:T.getDefaultValues(YO),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!_t.isEmpty(e)}},z_=function(e){Be(t,e);function t(){var r=e.call(this)||this;return Uu(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInVolumeRepresentations to have matching names. "+n.name+" "+a);r.add(n)}),r}return t}(UZ);(function(e){e.BuiltIn={isosurface:YKe,slice:iQe,"direct-volume":vQe}})(z_||(z_={}));function xz(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:_t.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var XD=Ao.build({display:{name:"Volume Streaming"},from:ge.Molecule.Structure,params:function(e,t){var r=QYe(e&&e.data),n=eKe(r,e&&e.data);return{method:T.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:T.ObjectList({id:T.Text(n[0]||"")},function(a){var i=a.id;return i},{defaultValue:n.map(function(a){return{id:a}})}),defaultView:T.Select(r==="em"?"cell":"selection-box",Li.ViewTypeOptions),options:T.Group({serverUrl:T.Text(t.config.get($r.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:T.Text("",{isHidden:!0}),emContourProvider:T.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:T.Value({},{isHidden:!0})})}},isApplicable:function(e,t,r){var n=r.config.get($r.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&Xt.probablyHasDensityMap(e.data.models[0])}})(function(e,t){var r=e.ref,n=e.state,a=e.params;return et.create("Volume Streaming",function(i){return de(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C;return fe(this,function(w){switch(w.label){case 0:o=[],s=0,u=a.entries.length,w.label=1;case 1:return s<u?(l=a.entries[s].id.toLowerCase(),c=void 0,a.method!=="em"?[3,14]:l.toUpperCase().startsWith("EMD")?[3,11]:[4,i.update("Getting EMDB info...")]):[3,16];case 2:return w.sent(),[4,nKe(t,i,l)];case 3:d=w.sent(),f=0,h=d.length,w.label=4;case 4:if(!(f<h))return[3,10];v=d[f],p=void 0,w.label=5;case 5:return w.trys.push([5,7,,8]),[4,vz(a.options.emContourProvider,t,i,v)];case 6:return p=w.sent(),[3,8];case 7:return g=w.sent(),console.info("Could not get map info for "+v+": "+g),[3,9];case 8:xz(o,a.method,v,p||0),w.label=9;case 9:return++f,[3,4];case 10:return[3,15];case 11:return w.trys.push([11,13,,14]),[4,vz(a.options.emContourProvider,t,i,l)];case 12:return c=w.sent(),[3,14];case 13:return m=w.sent(),console.info("Could not get map info for "+l+": "+m),[3,15];case 14:xz(o,a.method,l,c||0),w.label=15;case 15:return++s,[3,1];case 16:return y=n.build().to(r).applyOrUpdateTagged(Li.RootTag,yQe,{serverUrl:a.options.serverUrl,entries:o}),[4,y.commit()];case 17:return w.sent(),b=y.selector,b.isOk?(S=n.tree.children.get(b.ref),(S==null?void 0:S.size)>0?[4,t.managers.structure.hierarchy.remove(S==null?void 0:S.toArray())]:[3,19]):[2];case 18:w.sent(),w.label=19;case 19:return x=b.cell.obj,C=n.build().to(y.ref).apply(KO,T.getDefaultValues(Li.createParams({data:x.data,defaultView:a.defaultView,channelParams:a.options.channelParams})),{ref:a.options.behaviorRef?a.options.behaviorRef:void 0}),a.method==="em"?C.apply(Sx,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(C.apply(Sx,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),C.apply(Sx,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),C.apply(Sx,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),[4,n.updateTree(C).runInContext(i)];case 20:return w.sent(),[2]}})})})}),mQe=Ao.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:Li,isApplicable:function(e){return e.data.params.entry.params.view.name==="selection-box"}})(function(e,t){var r=e.a,n=e.ref,a=e.state,i=r.data.params;if(i.entry.params.view.name==="selection-box"){var o=Yt.create(_.clone(i.entry.params.view.params.bottomLeft),_.clone(i.entry.params.view.params.topRight)),s=i.entry.params.view.params.radius;Yt.expand(o,o,_.create(s,s,s));var u=E(E({},i),{entry:{name:i.entry.name,params:E(E({},i.entry.params),{view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}})}});return a.updateTree(a.build().to(n).update(u))}}),gQe={dataId:T.Text(""),source:T.MappedStatic("x-ray",{em:T.Group({isoValue:_t.createIsoValueParam(_t.IsoValue.relative(1))}),"x-ray":T.Group({})})},yQe=kt.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:ge.Molecule.Structure,to:WD,params:function(e){return{serverUrl:T.Text("https://ds.litemol.org"),entries:T.ObjectList(gQe,function(t){var r=t.dataId;return r},{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:function(e,t){var r=e.a,n=e.params;return et.create("",function(a){return de(void 0,void 0,void 0,function(){var i,o,s,u,l,c,d,f;return fe(this,function(h){switch(h.label){case 0:i=[],o=0,s=n.entries.length,h.label=1;case 1:return o<s?(u=n.entries[o],l=u.dataId,c=u.source.name==="em"?u.source.params.isoValue:_t.IsoValue.relative(1),[4,a.update("Getting server header...")]):[3,5];case 2:return h.sent(),[4,t.fetch({url:Z3(n.serverUrl,u.source.name+"/"+l.toLocaleLowerCase()),type:"json"}).runInContext(a)];case 3:d=h.sent(),i.push({dataId:l,kind:u.source.name,header:d,emDefaultContourLevel:c}),h.label=4;case 4:return++o,[3,1];case 5:return f={serverUrl:n.serverUrl,entries:i,structure:r.data},[2,new WD(f,{label:"Volume Server",description:""+i.map(function(v){return v.dataId}).join(", ")})]}})})})}}),KO=kt.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:WD,to:Li,params:function(e){return Li.createParams({data:e&&e.data})}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.entry.params.view===r.entry.params.view||r.entry.params.view.name==="selection-box"||r.entry.params.view.name==="off"},apply:function(e,t){var r=e.a,n=e.params;return et.create("Volume streaming",function(a){return de(void 0,void 0,void 0,function(){var i;return fe(this,function(o){switch(o.label){case 0:return i=new Li.Behavior(t,r.data),[4,i.update(n)];case 1:return o.sent(),[2,new Li(i,{label:"Volume Streaming",description:i.getDescription()})]}})})})},update:function(e){var t=this;e.a;var r=e.b,n=e.oldParams,a=e.newParams;return et.create("Update Volume Streaming",function(i){return de(t,void 0,void 0,function(){var o,s;return fe(this,function(u){switch(u.label){case 0:return n.entry.name!==a.entry.name&&"em"in a.entry.params.channels&&(o=r.data.infoMap.get(a.entry.name).emDefaultContourLevel,o&&(a.entry.params.channels.em.isoValue=o)),[4,r.data.update(a)];case 1:return s=u.sent()?vt.UpdateResult.Updated:vt.UpdateResult.Unchanged,r.description=r.data.getDescription(),[2,s]}})})})}}),Sx=kt.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:Li,to:ge.Volume.Representation3D,params:{channel:T.Select("em",Li.ChannelTypeOptions,{isHidden:!0})}})({apply:function(e,t){var r=e.a,n=e.params,a=e.spine;return et.create("Volume Representation",function(i){return de(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:return o=r.data.channels[n.channel],o?(s=Sz(r.data,n.channel),u=z_.BuiltIn.isosurface,l=s.type.params||{},c=u.factory(E({webgl:(h=t.canvas3d)===null||h===void 0?void 0:h.webgl},t.representation.volume.themes),u.getParams),c.setTheme(ya.create(t.representation.volume.themes,{volume:o.data},s)),d=(v=a.getAncestorOfType(ge.Molecule.Structure))===null||v===void 0?void 0:v.data,f=(d==null?void 0:d.models.length)===0?void 0:xp.get(d==null?void 0:d.models[0]),[4,c.createOrUpdate(l,o.data).runInContext(i)]):[2,On.Null];case 1:return p.sent(),f&&c.setState({transform:f}),[2,new ge.Volume.Representation3D({repr:c,sourceData:o.data},{label:Math.round(o.isoValue.relativeValue*100)/100+" σ ["+n.channel+"]"})]}})})})},update:function(e,t){var r=e.a,n=e.b,a=e.newParams;return e.spine,et.create("Volume Representation",function(i){return de(void 0,void 0,void 0,function(){var o,s,u,l;return fe(this,function(c){switch(c.label){case 0:return o=r.data.channels[a.channel],o?(s=n.data.repr.state.visible,u=Sz(r.data,a.channel),l=E(E({},n.data.repr.props),u.type.params),n.data.repr.setTheme(ya.create(t.representation.volume.themes,{volume:o.data},u)),[4,n.data.repr.createOrUpdate(l,o.data).runInContext(i)]):[2,vt.UpdateResult.Unchanged];case 1:return c.sent(),n.data.repr.setState({visible:s}),n.data.sourceData=o.data,[2,vt.UpdateResult.Updated]}})})})}});function Sz(e,t){var r=e.channels[t];return kc.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var QO=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=rh(function(n,a){return rv.infoFromAction(r.plugin,r.props.state,r.props.action,r.props.nodeRef)}),r.state={plugin:r.plugin,ref:r.props.nodeRef,version:r.props.state.transforms.get(r.props.nodeRef).version,error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return wt.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})},t.prototype.getInfo=function(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version)},t.prototype.getTransformerId=function(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id},t.prototype.getHeader=function(){return this.props.hideHeader?"none":this.props.action.definition.display},t.prototype.canApply=function(){return!this.state.error&&!this.state.busy},t.prototype.canAutoApply=function(){return!1},t.prototype.applyText=function(){return"Apply"},t.prototype.isUpdate=function(){return!1},t.prototype.getSourceAndTarget=function(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}},t.getDerivedStateFromProps=function(r,n){var a=r.state.transforms.get(r.nodeRef).version;if(r.nodeRef===n.ref&&a===n.version)return null;var i=r.state.cells.get(r.nodeRef).obj,o=r.action.definition.params?T.getDefaultValues(r.action.definition.params(i,n.plugin)):{},s={plugin:n.plugin,ref:r.nodeRef,version:a,params:o,isInitial:!0,error:void 0};return s},t}(zee),bQe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:kX}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.setState({isHidden:!r.canEnable(),description:ub.getSelectedStructuresDescription(r.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){cr.hasTag(n.cell.transform,Li.RootTag)&&r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures[0]},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){var r,n,a=this.plugin.managers.structure.hierarchy.selection;if(a.structures.length!==1)return!1;var i=this.pivot.cell;return i.obj?!!(!((n=(r=XD.definition).isApplicable)===null||n===void 0)&&n.call(r,i.obj,i.transform,this.plugin)):!1},t.prototype.renderEnable=function(){var r,n=this.pivot;if(!n.cell.parent)return null;var a=ir.findTagInSubtree(n.cell.parent.tree,this.pivot.cell.transform.ref,Li.RootTag),i=a&&n.cell.parent.cells.get(a),o=i&&i.status==="error"?{header:"Error enabling",icon:g8,title:i.errorText}:i&&((r=i.obj)===null||r===void 0?void 0:r.data.entries.length)===0?{header:"Error enabling",icon:g8,title:"No entry for streaming found"}:{header:"Enable",icon:$g,title:"Enable"};return M.jsx(QO,{state:n.cell.parent,action:XD,initiallyCollapsed:!0,nodeRef:n.cell.transform.ref,simpleApply:o},void 0)},t.prototype.renderParams=function(){var r,n,a,i,o,s=this.pivot;if(!s.cell.parent)return null;var u=((n=(r=s.volumeStreaming)===null||r===void 0?void 0:r.cell.transform.params)===null||n===void 0?void 0:n.entry.params.view.name)==="selection-box"&&((o=(i=(a=this.plugin.state.behaviors.cells.get(eE.id))===null||a===void 0?void 0:a.params)===null||i===void 0?void 0:i.values)===null||o===void 0?void 0:o.bindings);return M.jsxs(M.Fragment,{children:[M.jsx(nd,{state:s.cell.parent,transform:s.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0},void 0),u&&M.jsx(Bu,E({header:"Controls Help"},{children:M.jsx(qD,{bindings:u},void 0)}),void 0)]},void 0)},t.prototype.renderControls=function(){var r=this.pivot;return r?r.volumeStreaming?this.renderParams():this.renderEnable():null},t}(Xg),xQe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var a,i=r.plugin.managers.volume.hierarchy.selection,o=((a=n.cell.obj)===null||a===void 0?void 0:a.label)||"Volume",s={kind:"item",label:(n.kind==="lazy-volume"?"Load ":"")+(o||n.kind),selected:i===n,value:n};return s},r.selectCurrent=function(n){if(r.toggleHierarchy(),!!n){var a=n.value;a.kind==="volume"?r.plugin.managers.volume.hierarchy.setCurrent(a):r.lazyLoad(a.cell)}},r.selectAdd=function(n){n&&(r.setState({show:void 0}),n.value())},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.toggleAddRepr=function(){return r.setState({show:r.state.show!=="add-repr"?"add-repr":void 0})},r}return t.prototype.defaultState=function(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:kX}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.hierarchy.volumes.length===0&&n.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){for(var r=this.plugin.managers.volume.hierarchy,n=r.current,a=[],i=0,o=n.volumes;i<o.length;i++){var s=o[i];a.push(this.item(s))}for(var u=0,l=n.lazyVolumes;u<l.length;u++){var s=l[u];a.push(this.item(s))}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"addActions",{get:function(){var r=this.plugin.managers.volume.hierarchy,n=r.selection,a=Ut([],N_.getRepresentationTypes(this.plugin,n).map(function(i){return er.Item(i[1],function(){return r.addRepresentation(n,i[0])})}));return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.volume.hierarchy.current,n=r.volumes,a=r.lazyVolumes;return n.length===0&&a.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r;if(this.state.loadingLabel)return"Loading "+this.state.loadingLabel+"...";var n=this.plugin.managers.volume.hierarchy.selection;return n?((r=n==null?void 0:n.cell.obj)===null||r===void 0?void 0:r.label)||"Volume":"Nothing Selected"},enumerable:!1,configurable:!0}),t.prototype.lazyLoad=function(r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c=this;return fe(this,function(d){switch(d.label){case 0:n=r.obj.data,a=n.url,i=n.isBinary,o=n.format,s=n.entryId,u=n.isovalues,this.setState({isBusy:!0,loadingLabel:r.obj.label}),d.label=1;case 1:return d.trys.push([1,,3,4]),l=this.plugin,[4,l.dataTransaction(function(){return de(c,void 0,void 0,function(){var f,h,v,p,g,m,y,b,S,x,C;return fe(this,function(w){switch(w.label){case 0:return[4,l.builders.data.download({url:a,isBinary:i},{state:{isGhost:!0}})];case 1:return f=w.sent(),[4,l.dataFormats.get(o).parse(l,f,{entryId:s})];case 2:if(h=w.sent(),v=h.volume||h.volumes[0],!(v!=null&&v.isOk))throw new Error("Failed to parse any volume.");for(p=l.build(),g=0,m=u;g<m.length;g++)y=m[g],p.to((x=(b=h.volumes)===null||b===void 0?void 0:b[(S=y.volumeIndex)!==null&&S!==void 0?S:0])!==null&&x!==void 0?x:h.volume).apply(st.Representation.VolumeRepresentation3D,eg(this.plugin,v.data,{type:"isosurface",typeParams:{alpha:(C=y.alpha)!==null&&C!==void 0?C:1,isoValue:y.type==="absolute"?{kind:"absolute",absoluteValue:y.value}:{kind:"relative",relativeValue:y.value}},color:"uniform",colorParams:{value:y.color}}));return[4,p.commit()];case 3:return w.sent(),[4,l.build().delete(r).commit()];case 4:return w.sent(),[2]}})})})];case 2:return d.sent(),[3,4];case 3:return this.setState({isBusy:!1,loadingLabel:void 0}),[7];case 4:return[2]}})})},t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.label,a=this.plugin.managers.volume.hierarchy.selection;return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[M.jsx(pr,E({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:n},{children:n}),void 0),!this.isEmpty&&a&&M.jsx(qt,{svg:Wg,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="add-repr",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&M.jsx(er,{items:this.hierarchyItems,onSelect:this.selectCurrent},void 0),this.state.show==="add-repr"&&M.jsx(er,{items:this.addActions,onSelect:this.selectAdd},void 0),a&&a.representations.length>0&&M.jsx("div",E({style:{marginTop:"6px"}},{children:a.representations.map(function(i){return M.jsx(SQe,{representation:i},i.cell.transform.ref)})}),void 0)]},void 0)},t}(Xg),SQe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.remove=function(){return r.plugin.managers.volume.hierarchy.remove([r.props.representation],!0)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation])},r.toggleUpdate=function(){return r.setState({action:r.state.action==="update"?void 0:"update"})},r.highlight=function(n){n.preventDefault(),r.props.representation.cell.parent&&wt.Interactivity.Object.Highlight(r.plugin,{state:r.props.representation.cell.parent,ref:r.props.representation.cell.transform.ref})},r.clearHighlight=function(n){n.preventDefault(),wt.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){var n,a=r.props.representation,i=(n=r.props.representation.cell.obj)===null||n===void 0?void 0:n.data.repr.renderObjects;a.cell.state.isHidden&&r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation],"show"),r.plugin.managers.camera.focusRenderObjects(i,{extraRadius:1})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){Zf.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n,a,i=this.props.representation.cell;return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsxs(pr,E({noOverflow:!0,className:"msp-control-button-label",title:((r=i.obj)===null||r===void 0?void 0:r.label)+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[(n=i.obj)===null||n===void 0?void 0:n.label,M.jsx("small",E({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:(a=i.obj)===null||a===void 0?void 0:a.description}),void 0)]}),void 0),M.jsx(qt,{svg:i.state.isHidden?fv:hv,toggleState:!1,onClick:this.toggleVisible,title:(i.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),M.jsx(qt,{svg:Zs,onClick:this.remove,title:"Remove",small:!0},void 0),M.jsx(qt,{svg:Up,onClick:this.toggleUpdate,title:"Actions",toggleState:this.state.action==="update"},void 0)]}),void 0),this.state.action==="update"&&!!i.parent&&M.jsx("div",E({style:{marginBottom:"6px"},className:"msp-accent-offset"},{children:M.jsx(nd,{state:i.parent,transform:i.transform,customHeader:"none",noMargin:!0},void 0)}),void 0)]},void 0)},t}(Ka),V_;(function(e){function t(n){return{size:n,matrix:Ar.create(n,n),eigenValues:new Float64Array(n),D:new Float64Array(n),E:new Float64Array(n)}}e.createCache=t;function r(n){CQe(n.size,n.matrix.data,n.eigenValues,n.D,n.E)}e.compute=r})(V_||(V_={}));function CQe(e,t,r,n,a){for(var i=0;i<e;i++)a[i]=0;for(var o=e-1,i=0;i<e;i++)n[i]=t[i*e+o];_Qe(t,n,a,e),wQe(t,n,a,e);for(var i=0;i<e;i++)r[i]=n[i]}function _Qe(e,t,r,n){for(var a=n-1;a>0;a--){for(var i=0,o=0,s=0;s<a;s++)i=i+Math.abs(t[s]);if(i===0){r[a]=t[a-1];for(var u=0;u<a;u++)t[u]=e[u*n+a-1],e[u*n+a]=0,e[a*n+u]=0}else{for(var s=0;s<a;s++)t[s]/=i,o+=t[s]*t[s];var l=t[a-1],c=Math.sqrt(o);l>0&&(c=-c),r[a]=i*c,o=o-l*c,t[a-1]=l-c;for(var u=0;u<a;u++)r[u]=0;for(var u=0;u<a;u++){l=t[u],e[a*n+u]=l,c=r[u]+e[u*n+u]*l;for(var s=u+1;s<=a-1;s++)c+=e[u*n+s]*t[s],r[s]+=e[u*n+s]*l;r[u]=c}l=0;for(var u=0;u<a;u++)r[u]/=o,l+=r[u]*t[u];for(var d=l/(o+o),u=0;u<a;u++)r[u]-=d*t[u];for(var u=0;u<a;u++){l=t[u],c=r[u];for(var s=u;s<=a-1;s++)e[u*n+s]-=l*r[s]+c*t[s];t[u]=e[u*n+a-1],e[u*n+a]=0}}t[a]=o}for(var a=0;a<n-1;a++){e[a*n+n-1]=e[a*n+a],e[a*n+a]=1;var o=t[a+1];if(o!==0){for(var s=0;s<=a;s++)t[s]=e[(a+1)*n+s]/o;for(var u=0;u<=a;u++){for(var c=0,s=0;s<=a;s++)c+=e[(a+1)*n+s]*e[u*n+s];for(var s=0;s<=a;s++)e[u*n+s]-=c*t[s]}}for(var s=0;s<=a;s++)e[(a+1)*n+s]=0}for(var u=0;u<n;u++)t[u]=e[u*n+n-1],e[u*n+n-1]=0;e[n*n-1]=1,r[0]=0}function wQe(e,t,r,n){for(var a=1e3,i=1;i<n;i++)r[i-1]=r[i];r[n-1]=0;for(var o=0,s=0,u=Math.pow(2,-53),l=0;l<n;l++){s=Math.max(s,Math.abs(t[l])+Math.abs(r[l]));for(var c=l;c<n&&!(Math.abs(r[c])<=u*s);)c++;if(c>l){var d=0;do{d=d+1;var f=t[l],h=(t[l+1]-f)/(2*r[l]),v=Cz(h,1);h<0&&(v=-v),t[l]=r[l]/(h+v),t[l+1]=r[l]*(h+v);for(var p=t[l+1],g=f-t[l],i=l+2;i<n;i++)t[i]-=g;o=o+g,h=t[c];for(var m=1,y=m,b=m,S=r[l+1],x=0,C=0,i=c-1;i>=l;i--){b=y,y=m,C=x,f=m*r[i],g=m*h,v=Cz(h,r[i]),r[i+1]=x*v,x=r[i]/v,m=h/v,h=m*t[i]-x*f,t[i+1]=g+x*(m*f+x*t[i]);for(var w=0;w<n;w++)g=e[(i+1)*n+w],e[(i+1)*n+w]=x*e[i*n+w]+m*g,e[i*n+w]=m*e[i*n+w]-x*g}if(h=-x*C*b*S*r[l]/p,r[l]=x*h,t[l]=m*h,d>=a)throw"SVD: Not converging."}while(Math.abs(r[l])>u*s)}t[l]=t[l]+o,r[l]=0}for(var i=0;i<n-1;i++){for(var w=i,h=t[i],A=i+1;A<n;A++)t[A]<h&&(w=A,h=t[A]);if(w!==i){t[w]=t[i],t[i]=h;for(var A=0;A<n;A++)h=e[i*n+A],e[i*n+A]=e[w*n+A],e[w*n+A]=h}}}function Cz(e,t){if(Math.abs(e)>Math.abs(t)){var r=t/e;return Math.abs(e)*Math.sqrt(1+r*r)}if(t!==0){var r=e/t;return Math.abs(t)*Math.sqrt(1+r*r)}return 0}var ad;(function(e){(function(r){function n(a){return{x:new Float64Array(a),y:new Float64Array(a),z:new Float64Array(a)}}r.empty=n})(e.Positions||(e.Positions={}));function t(r,n){return typeof n>"u"&&(n={bTransform:le.zero(),rmsd:0}),TQe(new EQe(r,n)),n}e.compute=t})(ad||(ad={}));var EQe=function(){function e(t,r){this.evdCache=V_.createCache(4),this.translateB=le.identity(),this.rotateB=le.identity(),this.tempMatrix=le.identity(),this.a=t.a,this.b=t.b,t.centerA?this.centerA=t.centerA:this.centerA=t.centerA=Yc.fromArrays(t.a,je()).center,t.centerB?this.centerB=t.centerB:this.centerB=t.centerB=Yc.fromArrays(t.b,je()).center,this.result=r}return e}();function AQe(e){var t=e.evdCache.matrix;Ar.makeZero(t);for(var r=e.a.x,n=e.a.y,a=e.a.z,i=e.b.x,o=e.b.y,s=e.b.z,u=e.centerA,l=e.centerB,c=0,d=0,f=e.a.x.length;d<f;d++){var h=r[d]-u[0],v=n[d]-u[1],p=a[d]-u[2],g=i[d]-l[0],m=o[d]-l[1],y=s[d]-l[2];c+=h*h+v*v+p*p+g*g+m*m+y*y,Ar.add(t,0,0,h*g+v*m+p*y),Ar.add(t,0,1,-(p*m)+v*y),Ar.add(t,0,2,p*g-h*y),Ar.add(t,0,3,-(v*g)+h*m),Ar.add(t,1,0,-(p*m)+v*y),Ar.add(t,1,1,h*g-v*m-p*y),Ar.add(t,1,2,v*g+h*m),Ar.add(t,1,3,p*g+h*y),Ar.add(t,2,0,p*g-h*y),Ar.add(t,2,1,v*g+h*m),Ar.add(t,2,2,-(h*g)+v*m-p*y),Ar.add(t,2,3,p*m+v*y),Ar.add(t,3,0,-(v*g)+h*m),Ar.add(t,3,1,p*g+h*y),Ar.add(t,3,2,p*m+v*y),Ar.add(t,3,3,-(h*g)-v*m+p*y)}return c}function PQe(e){var t=e.evdCache.matrix,r=Ar.get(t,1,3),n=Ar.get(t,2,3),a=Ar.get(t,3,3),i=Ar.get(t,0,3),o=2*n*n,s=2*a*a,u=2*r*r,l=2*r*n,c=2*i*a,d=2*r*a,f=2*i*n,h=2*n*a,v=2*i*r,p=e.translateB;le.setValue(p,0,3,-e.centerB[0]),le.setValue(p,1,3,-e.centerB[1]),le.setValue(p,2,3,-e.centerB[2]),p=e.rotateB,le.setValue(p,0,0,1-o-s),le.setValue(p,0,1,l+c),le.setValue(p,0,2,d-f),le.setValue(p,1,0,l-c),le.setValue(p,1,1,1-u-s),le.setValue(p,1,2,h+v),le.setValue(p,2,0,d+f),le.setValue(p,2,1,h-v),le.setValue(p,2,2,1-u-o),le.setValue(p,3,3,1),le.mul(e.tempMatrix,e.rotateB,e.translateB),p=e.translateB,le.setValue(p,0,3,e.centerA[0]),le.setValue(p,1,3,e.centerA[1]),le.setValue(p,2,3,e.centerA[2]),le.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function TQe(e){var t=AQe(e);V_.compute(e.evdCache);var r=t-2*e.evdCache.eigenValues[3];r=r<0?0:Math.sqrt(r/e.a.x.length),PQe(e),e.result.rmsd=r}var IQe="ACDEFGHIKLMNPQRSTVWY",MQe="ARNDCQEGHILKMFPSTWYVBZX",DQe=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],RQe=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function _z(e,t){var r,n=0,a={};return t.forEach(function(i){r=0;var o={};i.forEach(function(s){return o[e[r++]]=s}),a[e[n++]]=o}),a}var kQe=function(){return{blosum62:_z(MQe,RQe),blosum62x:_z(IQe,DQe)}}(),OQe={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};function LQe(e,t,r){r===void 0&&(r={});var n=E(E({},OQe),r),a=new NQe(e,t,n);return a.calculate(),a.trace()}var NQe=function(){function e(t,r,n){this.seqA=t,this.seqB=r,this.S=[],this.V=[],this.H=[],this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix==="default"?void 0:kQe[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}return e.prototype.initMatrices=function(){for(var t=this,r=t.n,n=t.m,a=t.gapPenalty,i=t.S,o=t.V,s=t.H,u=0;u<=r;++u){i[u]=[],o[u]=[],s[u]=[];for(var l=0;l<=n;++l)i[u][l]=0,o[u][l]=0,s[u][l]=0}for(var u=0;u<=r;++u)i[u][0]=a,s[u][0]=-1/0;for(var l=0;l<=n;++l)i[0][l]=a,o[0][l]=-1/0;i[0][0]=0},e.prototype.makeScoreFn=function(){var t=this,r=t.seqA,n=t.seqB,a=t.substMatrix;return a?function(o,s){var u,l,c=r[o],d=n[s];return(l=(u=a[c])===null||u===void 0?void 0:u[d])!==null&&l!==void 0?l:-4}:function(o,s){var u=r[o],l=n[s];return u===l?5:-3}},e.prototype.calculate=function(){this.initMatrices();for(var t=this.makeScoreFn(),r=this,n=r.V,a=r.H,i=r.S,o=r.n,s=r.m,u=r.gapExtensionPenalty,l=r.gapPenalty,c,d,f,h,v,p=1;p<=o;++p){d=i[p-1],c=n[p-1],f=n[p],h=a[p],v=i[p];for(var g=1;g<=s;++g)f[g]=Math.max(d[g]+l,c[g]+u),h[g]=Math.max(v[g-1]+l,h[g-1]+u),v[g]=Math.max(d[g-1]+t(p-1,g-1),f[g],h[g])}},e.prototype.trace=function(){var t=this.makeScoreFn(),r=this,n=r.V,a=r.H,i=r.S,o=r.seqA,s=r.seqB,u=r.gapExtensionPenalty,l=r.gapPenalty,c=this.n,d=this.m,f,h,v="",p="";for(i[c][d]>=n[c][d]?(f="S",h=i[c][d]):n[c][d]>=a[c][d]?(f="V",h=n[c][d]):(f="H",h=a[c][d]);c>0&&d>0;)f==="S"?i[c][d]===i[c-1][d-1]+t(c-1,d-1)?(v=o[c-1]+v,p=s[d-1]+p,--c,--d,f="S"):i[c][d]===n[c][d]?f="V":i[c][d]===a[c][d]?f="H":(--c,--d):f==="V"?n[c][d]===n[c-1][d]+u?(v=o[c-1]+v,p="-"+p,--c,f="V"):n[c][d]===i[c-1][d]+l?(v=o[c-1]+v,p="-"+p,--c,f="S"):--c:f==="H"&&(a[c][d]===a[c][d-1]+u?(v="-"+v,p=s[d-1]+p,--d,f="H"):a[c][d]===i[c][d-1]+l?(v="-"+v,p=s[d-1]+p,--d,f="S"):--d);for(;c>0;)v=o[c-1]+v,p="-"+p,--c;for(;d>0;)v="-"+v,p=s[d-1]+p,--d;return{aliA:v,aliB:p,score:h}},e}(),YD;(function(e){function t(n){var a=new Map;if(We.isAtomic(n.unit))for(var i=n.unit.model.atomicHierarchy.residues.label_seq_id,o=n.unit.residueIndex,s=0,u=Fe.size(n.indices);s<u;++s){var l=Fe.getAt(n.indices,s),c=n.unit.elements[l],d=i.value(o[c]);a.has(d)?a.get(d).push(l):a.set(d,[l])}else if(We.isCoarse(n.unit))for(var f=(We.isSpheres(n.unit)?n.unit.model.coarseHierarchy.spheres:n.unit.model.coarseHierarchy.gaussians).seq_id_begin,s=0,u=Fe.size(n.indices);s<u;++s){var l=Fe.getAt(n.indices,s),c=n.unit.elements[l],d=f.value(c);a.set(d,[l])}return a}function r(n,a){a===void 0&&(a={});for(var i=wz(n.a.unit),o=wz(n.b.unit),s=t(n.a),u=t(n.b),l=[],c=[],d=LQe(i.code.toArray(),o.code.toArray(),a),f=d.aliA,h=d.aliB,v=d.score,p=0,g=0,m=0,y=f.length;m<y;++m){if(f[m]==="-"||h[m]==="-"){f[m]!=="-"&&(p+=1),h[m]!=="-"&&(g+=1);continue}var b=i.seqId.value(p),S=o.seqId.value(g);if(s.has(b)&&u.has(S))for(var x=s.get(b),C=u.get(S),w=0,A=Math.min(x.length,C.length);w<A;++w)l.push(x[w]),c.push(C[w]);p+=1,g+=1}var I=Fe.intersect(Fe.ofSortedArray(l),n.a.indices),D=Fe.intersect(Fe.ofSortedArray(c),n.b.indices);return{a:{unit:n.a.unit,indices:I},b:{unit:n.b.unit,indices:D},score:v}}e.compute=r})(YD||(YD={}));function FQe(e){switch(e.kind){case 0:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case 1:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case 2:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function wz(e){return e.model.sequence.byEntityKey[FQe(e)].sequence}function Ez(e){var t=[];if(e.length<=0)return t;var r=jQe(e),n={a:a1(e[0],r),b:a1(e[1],r)};t[0]=ad.compute(n);for(var a=2;a<e.length;a++)n.b=a1(e[a],r),n.centerB=void 0,t.push(ad.compute(n));return t}var BQe=/(polypeptide|cyclic-pseudo-peptide)/i;function UQe(e){var t=[];if(e.length<=0)return t;for(var r=Oe.getFirstLocation(e[0]),n=pt.entity.subtype(r),a=n.match(BQe)?"blosum62":"default",i=1;i<e.length;i++){var o=YD.compute({a:e[0].elements[0],b:e[i].elements[0]},{substMatrix:a}),s=o.a,u=o.b,l=o.score,c=Oe(e[0].structure,[s]),d=Oe(e[i].structure,[u]),f=Fe.size(s.indices);t.push(E(E({},ad.compute({a:a1(c,f),b:a1(d,f)})),{alignmentScore:l}))}return t}function a1(e,t){for(var r=ad.Positions.empty(t),n=0,a=0,i=e.elements;a<i.length;a++){for(var o=i[a],s=o.unit,u=o.indices,l=s.elements,c=s.conformation,d=c.x,f=c.y,h=c.z,v=0,p=Fe.size(u);v<p;v++){var g=l[Fe.getAt(u,v)];if(r.x[n]=d(g),r.y[n]=f(g),r.z[n]=h(g),n++,n>=t)break}if(n>=t)break}return r}function jQe(e){if(e.length===0)return 0;for(var t=Oe.size(e[0]),r=1;r<e.length;r++){var n=Oe.size(e[r]);n<t&&(t=n)}return t}function zQe(e){for(var t=new Map,r=0;r<e.length;r++)GQe(e[r],t,r);for(var n=Array.from(t.values()),a=HQe(e.length,n),i=[],o=0,s=a;o<s.length;o++){var u=s[o],l=VQe(n,u.i,u.j,u.count),c=l[0],d=l[1],f=ad.compute({a:c,b:d});i.push({transform:f,pivot:u.i,other:u.j})}return i}function VQe(e,t,r,n){for(var a=ad.Positions.empty(n),i=ad.Positions.empty(n),o=0,s=0,u=e;s<u.length;s++){var l=u[s].pivots,c=l[t],d=l[r];if(!(!c||!d))for(var f=Math.min(c[2]-c[1],d[2]-d[1]),h=0;h<f;h++){var v=c[1]+h;a.x[o]=c[0].conformation.x(v),a.y[o]=c[0].conformation.y(v),a.z[o]=c[0].conformation.z(v),v=d[1]+h,i.x[o]=d[0].conformation.x(v),i.y[o]=d[0].conformation.y(v),i.z[o]=d[0].conformation.z(v),o++}}return[a,i]}function HQe(e,t){for(var r=[],n=0;n<e;n++){r[n]=[];for(var a=0;a<e;a++)r[n][a]=0}for(var i=0,o=t;i<o.length;i++)for(var s=o[i].pivots,n=0;n<e;n++)if(s[n]){for(var u=s[n][2]-s[n][1],a=n+1;a<e;a++)if(s[a]){var l=s[a][2]-s[a][1];r[n][a]=r[n][a]+Math.min(u,l)}}for(var c=[],a=1;a<e;a++)c[a-1]={i:0,j:a,count:r[0][a]};return c}function GQe(e,t,r){for(var n,a=0,i=e.units;a<i.length;a++){var o=i[a];if(o.kind===0){var s=o.elements,u=o.model,l=u.atomicHierarchy.residueAtomSegments.offsets,c=ku.Provider.get(u).value;if(!c)return;for(var d=c.dbName,f=c.accession,h=c.num,v=ar.transientSegments(o.model.atomicHierarchy.chainAtomSegments,s),p=ar.transientSegments(o.model.atomicHierarchy.residueAtomSegments,s);v.hasNext;){var g=v.move();for(p.setSegment(g);p.hasNext;){var m=p.move(),y=s[m.start],b=l[y];if(d[b]){var S=d[b]+"-"+f[b]+"-"+h[b];if(!t.has(S))t.set(S,{key:S,pivots:(n={},n[r]=[o,y,s[m.end]],n)});else{var x=t.get(S);x.pivots[r]||(x.pivots[r]=[o,y,s[m.end]])}}}}}}}var qQe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:n3e},isHidden:!0}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.structures.length<2})})},t.prototype.renderControls=function(){return M.jsx(M.Fragment,{children:M.jsx($Qe,{},void 0)},void 0)},t}(Xg),cte={alignSequences:T.Boolean(!0,{isEssential:!0,description:"Perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."})},WQe=T.getDefaultValues(cte),Az="SuperpositionTransform",$Qe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,canUseDb:!1,action:void 0,options:WQe},r.superposeChains=function(){return de(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v,p,g=this;return fe(this,function(m){switch(m.label){case 0:n=ma.trace.query,a=this.chainEntries,i=a.map(function(y,b){var S=Oe.toStructure(y.loci),x=yt.toLociWithSourceUnits(n(new as(S)));return Oe.remap(x,b===0?g.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:x.structure.root)}),o=this.state.options.alignSequences?UQe(i):Ez(i),s=a[0],u=1,l=i.length,m.label=1;case 1:return u<l?(c=a[u],d=o[u-1],f=d.bTransform,h=d.rmsd,[4,this.transform(c.cell,f)]):[3,4];case 2:m.sent(),v=xf(s.label),p=xf(c.label),this.plugin.log.info("Superposed ["+v+"] and ["+p+"] with RMSD "+h.toFixed(2)+"."),m.label=3;case 3:return++u,[3,1];case 4:return[2]}})})},r.superposeAtoms=function(){return de(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v,p,g=this;return fe(this,function(m){switch(m.label){case 0:n=this.atomEntries,a=n.map(function(y,b){return Oe.remap(y.loci,b===0?g.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:y.loci.structure.root)}),i=Ez(a),o=n[0],s=1,u=a.length,m.label=1;case 1:return s<u?(l=n[s],c=i[s-1],d=c.bTransform,f=c.rmsd,[4,this.transform(l.cell,d)]):[3,4];case 2:m.sent(),h=xf(o.label),v=xf(l.label),p=n[s].atoms.length,this.plugin.log.info("Superposed "+p+" "+(p===1?"atom":"atoms")+" of ["+h+"] and ["+v+"] with RMSD "+f.toFixed(2)+"."),m.label=3;case 3:return++s,[3,1];case 4:return[2]}})})},r.superposeDb=function(){return de(r,void 0,void 0,function(){var n,a,i,o,s,u;return fe(this,function(l){switch(l.label){case 0:n=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,a=zQe(n.map(function(c){var d;return(d=c.cell.obj)===null||d===void 0?void 0:d.data})),i=0,o=0,s=a,l.label=1;case 1:return o<s.length?(u=s[o],[4,this.transform(n[u.other].cell,u.transform.bTransform)]):[3,4];case 2:l.sent(),i+=u.transform.rmsd,l.label=3;case 3:return o++,[3,1];case 4:return i/=a.length-1,this.plugin.log.info("Superposed "+n.length+" structures with avg. RMSD "+i.toFixed(2)+"."),[4,new Promise(function(c){return requestAnimationFrame(c)})];case 5:return l.sent(),wt.Camera.Reset(this.plugin),[2]}})})},r.toggleByChains=function(){return r.setState({action:r.state.action==="byChains"?void 0:"byChains"})},r.toggleByAtoms=function(){return r.setState({action:r.state.action==="byAtoms"?void 0:"byAtoms"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r.setOptions=function(n){r.setState({options:n})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({canUseDb:n.structures.every(function(a){var i;return!!(!((i=a.cell.obj)===null||i===void 0)&&i.data)&&a.cell.obj.data.models.some(function(o){return ku.Provider.isApplicable(o)})})})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),t.prototype.transform=function(r,n){return de(this,void 0,void 0,function(){var a,i,o,s;return fe(this,function(u){switch(u.label){case 0:return a=La.resolveAndCheck(this.plugin.state.data,r),a?(i=ir.findTagInSubtree(this.plugin.state.data.tree,a.transform.ref,Az),o={transform:{name:"matrix",params:{data:n,transpose:!1}}},s=i?this.plugin.state.data.build().to(i).update(o):this.plugin.state.data.build().to(r).insert(st.Model.TransformStructureConformation,o,{tags:Az}),[4,this.plugin.runTask(this.plugin.state.data.updateTree(s))]):[2];case 1:return u.sent(),[2]}})})},t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,void 0,!0)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.lociEntry=function(r,n){var a=this;return M.jsx("div",E({className:"msp-flex-row"},{children:M.jsx(pr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:M.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)}),void 0)}),n)},t.prototype.historyEntry=function(r,n){var a=this,i=this.plugin.managers.structure.selection.additionsHistory;return M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsxs(pr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",M.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),i.length>1&&M.jsx(qt,{svg:s3,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),i.length>1&&M.jsx(qt,{svg:o3,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),M.jsx(qt,{svg:Zs,small:!0,className:"msp-form-control",onClick:function(){return a.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.atomsLociEntry=function(r,n){var a=this;return M.jsxs("div",{children:[M.jsx("div",E({className:"msp-control-group-header"},{children:M.jsx("div",E({className:"msp-no-overflow",title:r.label},{children:r.label}),void 0)}),void 0),M.jsx("div",E({className:"msp-control-offset"},{children:r.atoms.map(function(i,o){return a.historyEntry(i,o)})}),void 0)]},n)},Object.defineProperty(t.prototype,"chainEntries",{get:function(){var r=this,n=at.create(),a=[];return this.plugin.managers.structure.selection.entries.forEach(function(i,o){var s=i.selection,u=La.resolveAndCheck(r.plugin.state.data,o);if(!(!u||Oe.isEmpty(s))){var l=Oe.getFirstLocation(s,n);if(!(s.elements.length>1||pt.entity.type(l)!=="polymer")){var c=Ef.ofLoci(s),d=m_(c,{countsOnly:!0}),f=du(l,{reverse:!0,granularity:"chain"}).split("|"),h=d+" | "+f[0]+" | "+f[f.length-1];a.push({loci:s,label:h,cell:u})}}}),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"atomEntries",{get:function(){for(var r=this,n=new Map,a=this.plugin.managers.structure.selection.additionsHistory,i=0,o=a.length;i<o;++i){var s=a[i];if(Oe.size(s.loci)===1){var u=s.loci.structure;n.has(u)?n.get(u).push(s):n.set(u,[s])}}var l=[];return n.forEach(function(c,d){for(var f=r.plugin.helpers.substructureParent.get(d),h=[],v=0,p=c.length;v<p;++v)h.push(c[v].loci.elements[0]);var g=Oe(c[0].loci.structure,h),m=g.structure.label.split(" | ")[0];l.push({loci:g,label:m,cell:f,atoms:c})}),l},enumerable:!1,configurable:!0}),t.prototype.addByChains=function(){var r=this,n=this.chainEntries;return M.jsxs(M.Fragment,{children:[n.length>0&&M.jsx("div",E({className:"msp-control-offset"},{children:n.map(function(a,i){return r.lociEntry(a,i)})}),void 0),n.length<2&&M.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:M.jsxs("div",E({className:"msp-help-description"},{children:[M.jsx(on,{svg:Il,inline:!0},void 0),"Add 2 or more selections (toggle ",M.jsx(L_,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single polymer chains or residues therein."]}),void 0)}),void 0),n.length>1&&M.jsx(pr,E({title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.addByAtoms=function(){var r=this,n=this.atomEntries;return M.jsxs(M.Fragment,{children:[n.length>0&&M.jsx("div",E({className:"msp-control-offset"},{children:n.map(function(a,i){return r.atomsLociEntry(a,i)})}),void 0),n.length<2&&M.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:M.jsxs("div",E({className:"msp-help-description"},{children:[M.jsx(on,{svg:Il,inline:!0},void 0),"Add 1 or more selections (toggle ",M.jsx(L_,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single atoms."]}),void 0)}),void 0),n.length>1&&M.jsx(pr,E({title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.superposeByDbMapping=function(){return M.jsx(M.Fragment,{children:M.jsx(pr,E({icon:y8,title:"Superpose structures using database mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy},{children:"DB"}),void 0)},void 0)},t.prototype.render=function(){return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsx(Ra,{icon:y8,label:"Chains",toggle:this.toggleByChains,isSelected:this.state.action==="byChains",disabled:this.state.isBusy},void 0),M.jsx(Ra,{icon:r3e,label:"Atoms",toggle:this.toggleByAtoms,isSelected:this.state.action==="byAtoms",disabled:this.state.isBusy},void 0),this.state.canUseDb&&this.superposeByDbMapping(),M.jsx(Ra,{icon:jp,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="byChains"&&this.addByChains(),this.state.action==="byAtoms"&&this.addByAtoms(),this.state.action==="options"&&M.jsx("div",E({className:"msp-control-offset"},{children:M.jsx(Un,{params:cte,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy},void 0)}),void 0)]},void 0)},t}(Ka),XQe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={show:!1,label:""},r.update=function(){var n=r.plugin.state.data,a=n.selectQ(function(h){return h.ofTransformer(st.Model.ModelFromTrajectory)});if(a.length===0){r.setState({show:!1});return}for(var i="",o=0,s=new Set,u=0,l=a;u<l.length;u++){var c=l[u];if(c.sourceRef){var d=n.cells.get(c.sourceRef).obj;if(d&&d.data.frameCount>1){if(s.has(c.sourceRef)){r.setState({show:!1});return}if(s.add(c.sourceRef),o++,!i){var f=c.transform.params.modelIndex;i="Model "+(f+1)+" / "+d.data.frameCount}}}}o>1&&(i=""),r.setState({show:o>0,label:i})},r.reset=function(){return wt.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:wS.create({action:"reset"})})},r.prev=function(){return wt.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:wS.create({action:"advance",by:-1})})},r.next=function(){return wt.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:wS.create({action:"advance",by:1})})},r}return t.prototype.componentDidMount=function(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)},t.prototype.render=function(){var r=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||r&&!this.state.label?null:M.jsxs("div",E({className:"msp-traj-controls"},{children:[!r&&M.jsx(qt,{svg:Gwe,title:"First Model",onClick:this.reset,disabled:r},void 0),!r&&M.jsx(qt,{svg:NX,title:"Previous Model",onClick:this.prev,disabled:r},void 0),!r&&M.jsx(qt,{svg:FX,title:"Next Model",onClick:this.next,disabled:r},void 0),!!this.state.label&&M.jsx("span",{children:this.state.label},void 0)]}),void 0)},t}(vr),YQe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,show:!0},r.keyUp=function(n){if(!(!n.ctrlKey||r.state.isBusy||n.target!==document.body)){var a=r.plugin.managers.snapshot;if(n.keyCode===37||n.key==="ArrowLeft")a.state.isPlaying&&a.stop(),r.prev();else if(n.keyCode===38||n.key==="ArrowUp"){if(a.state.isPlaying&&a.stop(),a.state.entries.size===0)return;var i=a.state.entries.get(0);r.update(i.snapshot.id)}else if(n.keyCode===39||n.key==="ArrowRight")a.state.isPlaying&&a.stop(),r.next();else if(n.keyCode===40||n.key==="ArrowDown"){if(a.state.isPlaying&&a.stop(),a.state.entries.size===0)return;var o=a.state.entries.get(a.state.entries.size-1);r.update(o.snapshot.id)}}},r.change=function(n){n.target.value!=="none"&&r.update(n.target.value)},r.prev=function(){var n=r.plugin.managers.snapshot,a=n.getNextId(n.state.current,-1);a&&r.update(a)},r.next=function(){var n=r.plugin.managers.snapshot,a=n.getNextId(n.state.current,1);a&&r.update(a)},r.togglePlay=function(){r.plugin.managers.snapshot.togglePlay()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){return r.setState({isBusy:n})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){return r.setState({isBusy:n})}),window.addEventListener("keyup",this.keyUp,!1)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),window.removeEventListener("keyup",this.keyUp,!1)},t.prototype.update=function(r){return de(this,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),[4,wt.State.Snapshots.Apply(this.plugin,{id:r})];case 1:return n.sent(),this.setState({isBusy:!1}),[2]}})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot,n=r.state.entries.size;if(n<2||!this.state.show)return null;var a=r.state.current,i=r.state.isPlaying;return M.jsxs("div",E({className:"msp-state-snapshot-viewport-controls"},{children:[M.jsxs("select",E({className:"msp-form-control",value:a||"none",onChange:this.change,disabled:this.state.isBusy||i},{children:[!a&&M.jsx("option",{value:"none"},"none"),r.state.entries.valueSeq().map(function(o,s){return M.jsxs("option",E({value:o.snapshot.id},{children:["["+(s+1)+"/"+n+"]"," ",o.name||new Date(o.timestamp).toLocaleString()]}),o.snapshot.id)})]}),void 0),M.jsx(qt,{svg:i?jX:BX,title:i?"Pause":"Cycle States",onClick:this.togglePlay,disabled:i?!1:this.state.isBusy},void 0),!i&&M.jsxs(M.Fragment,{children:[M.jsx(qt,{svg:NX,title:"Previous State",onClick:this.prev,disabled:this.state.isBusy||i},void 0),M.jsx(qt,{svg:FX,title:"Next State",onClick:this.next,disabled:this.state.isBusy||i},void 0)]},void 0)]}),void 0)},t}(vr),KQe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r.stop=function(){r.plugin.managers.animation.stop(),r.plugin.managers.snapshot.stop()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){r.plugin.managers.snapshot.state.isPlaying?r.setState({isPlaying:!0,isExpanded:!1}):r.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){n?r.setState({isBusy:!0,isExpanded:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2}):r.setState({isBusy:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){n?r.setState({isAnimating:!0,isExpanded:!1}):r.setState({isAnimating:!1})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot.state.isPlaying;if(r||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get($r.Viewport.ShowAnimation))return null;var n=this.state.isAnimating;return M.jsxs("div",E({className:"msp-animation-viewport-controls"},{children:[M.jsxs("div",{children:[M.jsx("div",{className:"msp-semi-transparent-background"},void 0),M.jsx(qt,{svg:n||r?jX:$we,transparent:!0,title:n?"Stop":"Select Animation",onClick:n||r?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:n||r?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty},void 0)]},void 0),this.state.isExpanded&&!this.state.isBusy&&M.jsx("div",E({className:"msp-animation-viewport-controls-select"},{children:M.jsx(jXe,{onStart:this.toggleExpanded},void 0)}),void 0)]}),void 0)},t}(vr),QQe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){return this.plugin.selectionMode?M.jsx("div",E({className:"msp-selection-viewport-controls",onMouseMove:this.onMouseMove},{children:M.jsx(PYe,{},void 0)}),void 0):null},t}(vr),ZQe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={labels:[]},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.labels.highlight,function(n){return r.setState({labels:n.labels})})},t.prototype.render=function(){return this.state.labels.length===0?null:M.jsx("div",E({className:"msp-highlight-info"},{children:this.state.labels.map(function(r,n){return M.jsx("div",{dangerouslySetInnerHTML:{__html:r}},""+n)})}),void 0)},t}(vr),JQe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.behaviors.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=[];return this.plugin.customStructureControls.forEach(function(a,i){n.push(M.jsx(a,{initiallyCollapsed:r.props.initiallyCollapsed},i))}),n.length>0?M.jsx(M.Fragment,{children:n},void 0):null},t}(vr),eZe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-section-header"},{children:[M.jsx(on,{svg:K_e},void 0),"Structure Tools"]}),void 0),M.jsx(UYe,{},void 0),M.jsx(RYe,{},void 0),M.jsx(qQe,{},void 0),M.jsx(lYe,{},void 0),this.plugin.config.get($r.VolumeStreaming.Enabled)&&M.jsx(bQe,{},void 0),M.jsx(xQe,{},void 0),M.jsx(JQe,{},void 0)]},void 0)},t}(vr),tZe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.props.state.behaviors.currentObject.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state,o=r.current;o.ref!==a||o.state!==i||r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,function(){return r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.removed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.props,a=n.state,i=n.nodeRef,o=a.cells.get(i),s=a.actions.fromCell(o,this.plugin);if(s.length===0)return null;var u=o.transform.transformer.definition,l=o.obj?o.obj.label:u.display&&u.display.name||u.name;return M.jsxs("div",E({className:"msp-state-actions"},{children:[!this.props.hideHeader&&M.jsxs("div",E({className:"msp-section-header"},{children:[M.jsx(on,{svg:dwe},void 0)," ","Actions ("+l+")"]}),void 0),s.map(function(c,d){return M.jsx(QO,{state:a,action:c,nodeRef:i,initiallyCollapsed:d===0?!r.props.alwaysExpandFirst&&r.props.initiallyCollapsed:r.props.initiallyCollapsed},""+c.id)})]}),void 0)},t}(vr),H_=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.data=Zf.create(new ge.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,historyCapacity:n.plugin.config.get($r.State.HistoryCapacity)}),n.behaviors=Zf.create(new Dr.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,rootState:{isLocked:!0}}),n.events={cell:{stateUpdated:fc(n.data.events.cell.stateUpdated,n.behaviors.events.cell.stateUpdated),created:fc(n.data.events.cell.created,n.behaviors.events.cell.created),removed:fc(n.data.events.cell.removed,n.behaviors.events.cell.removed)},object:{created:fc(n.data.events.object.created,n.behaviors.events.object.created),removed:fc(n.data.events.object.removed,n.behaviors.events.object.removed),updated:fc(n.data.events.object.updated,n.behaviors.events.object.updated)}},n.snapshotParams=n.ev.behavior(t.DefaultSnapshotParams),n.setSnapshotParams=function(a){n.snapshotParams.next(E(E({},t.DefaultSnapshotParams),a))},n}return Object.defineProperty(t.prototype,"animation",{get:function(){return this.plugin.managers.animation},enumerable:!1,configurable:!0}),t.prototype.getSnapshot=function(r){var n,a,i=E(E({},this.snapshotParams.value),r);return{id:pn.create22(),data:i.data?this.data.getSnapshot():void 0,behaviour:i.behavior?this.behaviors.getSnapshot():void 0,animation:i.animation?this.animation.getSnapshot():void 0,startAnimation:i.startAnimation?!!i.startAnimation:void 0,camera:i.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:i.cameraTransition.name,transitionDurationInMs:((n=i==null?void 0:i.cameraTransition)===null||n===void 0?void 0:n.name)==="animate"?i.cameraTransition.params.durationInMs:void 0}:void 0,canvas3d:i.canvas3d?{props:(a=this.plugin.canvas3d)===null||a===void 0?void 0:a.props}:void 0,interactivity:i.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),durationInMs:i==null?void 0:i.durationInMs}},t.prototype.setSnapshot=function(r){var n;return de(this,void 0,void 0,function(){var a;return fe(this,function(i){switch(i.label){case 0:return[4,this.animation.stop()];case 1:return i.sent(),r.behaviour?[4,this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour))]:[3,3];case 2:i.sent(),i.label=3;case 3:return r.data?[4,this.plugin.runTask(this.data.setSnapshot(r.data))]:[3,5];case 4:i.sent(),i.label=5;case 5:return!((n=r.canvas3d)===null||n===void 0)&&n.props?(a=T.normalizeParams(Es,r.canvas3d.props,"children"),[4,wt.Canvas3D.SetSettings(this.plugin,{settings:a})]):[3,7];case 6:i.sent(),i.label=7;case 7:return r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.animation&&this.animation.setSnapshot(r.animation),r.camera&&wt.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start(),[2]}})})},t.prototype.updateTransform=function(r,n,a,i){var o=r.build().to(n).update(a);return wt.State.Update(this.plugin,{state:r,tree:o,options:{canUndo:i}})},t.prototype.updateBehavior=function(r,n){var a=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))a.to(r.id).update(n);else{var i=r.createDefaultParams(void 0,this.plugin);a.to(Dr.getCategoryId(r)).apply(r,Vp(i,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(a))},t.prototype.dispose=function(){this.behaviors.cells.forEach(function(r){Dr.Behavior.is(r.obj)&&r.obj.data.unregister()}),e.prototype.dispose.call(this),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()},t}(zb);(function(e){e.SnapshotParams={durationInMs:T.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:T.Boolean(!0),behavior:T.Boolean(!1),animation:T.Boolean(!0),startAnimation:T.Boolean(!1),canvas3d:T.Boolean(!0),interactivity:T.Boolean(!0),camera:T.Boolean(!0),cameraTransition:T.MappedStatic("animate",{animate:T.Group({durationInMs:T.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:T.Group({})},{options:[["animate","Animate"],["instant","Instant"]]})},e.DefaultSnapshotParams=T.getDefaultValues(e.SnapshotParams)})(H_||(H_={}));var rZe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r;return M.jsxs("div",{children:[M.jsx(_c,{icon:UX,title:"Plugin State"},void 0),M.jsx("div",E({style:{marginBottom:"10px"}},{children:M.jsx(Bu,E({header:"Save Options",initiallyExpanded:!1},{children:M.jsx(fte,{},void 0)}),void 0)}),void 0),M.jsx(nZe,{},void 0),M.jsx(aZe,{},void 0),M.jsx(_c,{title:"Save as File",accent:"blue"},void 0),M.jsx(dte,{},void 0),((r=this.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&M.jsx(hte,{},void 0)]},void 0)},t}(vr),dte=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.downloadToFileJson=function(){var n,a;(a=(n=r.props).onAction)===null||a===void 0||a.call(n),wt.State.Snapshots.DownloadToFile(r.plugin,{type:"json"})},r.downloadToFileZip=function(){var n,a;(a=(n=r.props).onAction)===null||a===void 0||a.call(n),wt.State.Snapshots.DownloadToFile(r.plugin,{type:"zip"})},r.open=function(n){var a,i;if(!n.target.files||!n.target.files[0]){r.plugin.log.error("No state file selected");return}(i=(a=r.props).onAction)===null||i===void 0||i.call(a),wt.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.render=function(){return M.jsxs(M.Fragment,{children:[M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsx(pr,E({icon:nM,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input."},{children:"State"}),void 0),M.jsx(pr,E({icon:nM,onClick:this.downloadToFileZip,title:"Save the state including the input data."},{children:"Session"}),void 0),M.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file"},{children:[M.jsx(on,{svg:Lwe,inline:!0},void 0)," Open ",M.jsx("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"},void 0)]}),void 0)]}),void 0),M.jsxs("div",E({className:"msp-help-text",style:{padding:"10px"}},{children:[M.jsx(on,{svg:e3e},void 0)," This is an experimental feature and stored states/sessions might not be openable in a future version."]}),void 0)]},void 0)},t}(vr),fte=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.snapshotParams,function(){return r.forceUpdate()})},t.prototype.render=function(){return M.jsx(Un,{params:H_.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams},void 0)},t}(vr),nZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={params:T.getDefaultValues(t.Params)},r.add=function(){wt.State.Snapshots.Add(r.plugin,{name:r.state.params.name,description:r.state.params.description})},r.updateParams=function(n){return r.setState({params:n})},r.clear=function(){wt.State.Snapshots.Clear(r.plugin,{})},r}return t.prototype.shouldComponentUpdate=function(r,n){return!Cg(this.props,r)||!Cg(this.state,n)},t.prototype.render=function(){return M.jsxs("div",{children:[M.jsx(Un,{params:t.Params,values:this.state.params,onEnter:this.add,onChangeValues:this.updateParams},void 0),M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsx(qt,{onClick:this.clear,svg:Zs,title:"Remove All"},void 0),M.jsx(pr,E({onClick:this.add,icon:Wg,style:{textAlign:"right"},commit:!0},{children:"Add"}),void 0)]}),void 0)]},void 0)},t.Params={name:T.Text(),description:T.Text()},t}(vr),aZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.apply=function(n){var a=n.currentTarget.getAttribute("data-id");a&&wt.State.Snapshots.Apply(r.plugin,{id:a})},r.remove=function(n){var a=n.currentTarget.getAttribute("data-id");a&&wt.State.Snapshots.Remove(r.plugin,{id:a})},r.moveUp=function(n){var a=n.currentTarget.getAttribute("data-id");a&&wt.State.Snapshots.Move(r.plugin,{id:a,dir:-1})},r.moveDown=function(n){var a=n.currentTarget.getAttribute("data-id");a&&wt.State.Snapshots.Move(r.plugin,{id:a,dir:1})},r.replace=function(n){var a=n.currentTarget.getAttribute("data-id");a&&wt.State.Snapshots.Replace(r.plugin,{id:a})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.plugin.managers.snapshot.state.current;return M.jsx("ul",E({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.plugin.managers.snapshot.state.entries.map(function(a){return M.jsxs("li",E({className:"msp-flex-row"},{children:[M.jsxs(pr,E({"data-id":a.snapshot.id,onClick:r.apply,className:"msp-no-overflow"},{children:[M.jsx("span",E({style:{fontWeight:a.snapshot.id===n?"bold":void 0}},{children:a.name||new Date(a.timestamp).toLocaleString()}),void 0)," ",M.jsx("small",{children:(a.snapshot.durationInMs?dS(a.snapshot.durationInMs,!1)+(a.description?", ":""):"")+(a.description?a.description:"")},void 0)]}),void 0),M.jsx(qt,{svg:s3,"data-id":a.snapshot.id,title:"Move Up",onClick:r.moveUp,flex:"20px"},void 0),M.jsx(qt,{svg:o3,"data-id":a.snapshot.id,title:"Move Down",onClick:r.moveDown,flex:"20px"},void 0),M.jsx(qt,{svg:Ywe,"data-id":a.snapshot.id,title:"Replace",onClick:r.replace,flex:"20px"},void 0),M.jsx(qt,{svg:Zs,"data-id":a.snapshot.id,title:"Remove",onClick:r.remove,flex:"20px"},void 0)]}),a.snapshot.id)})}),void 0)},t}(vr),hte=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.Params={name:T.Text(),options:T.Group({description:T.Text(),playOnLoad:T.Boolean(!1),serverUrl:T.Text(r.plugin.config.get($r.State.CurrentServer))})},r.state={params:T.getDefaultValues(r.Params),entries:ia.OrderedMap(),isBusy:!1},r.ListOnlyParams={options:T.Group({serverUrl:T.Text(r.plugin.config.get($r.State.CurrentServer))},{isFlat:!0})},r._mounted=!1,r.refresh=function(){return de(r,void 0,void 0,function(){var n,a,i,o,s,u;return fe(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),this.setState({isBusy:!0}),this.plugin.config.set($r.State.CurrentServer,this.state.params.options.serverUrl),[4,this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))];case 1:for(n=l.sent()||[],n.sort(function(c,d){return c.isSticky===d.isSticky?c.timestamp-d.timestamp:c.isSticky?-1:1}),a=ia.OrderedMap().asMutable(),i=0,o=n;i<o.length;i++)s=o[i],a.set(s.id,E(E({},s),{url:this.serverUrl("get/"+s.id),removeUrl:this.serverUrl("remove/"+s.id)}));return this._mounted&&this.setState({entries:a.asImmutable(),isBusy:!1}),[3,3];case 2:return u=l.sent(),this.plugin.log.error("Fetching Remote Snapshots: "+u),this._mounted&&this.setState({entries:ia.OrderedMap(),isBusy:!1}),[3,3];case 3:return[2]}})})},r.upload=function(){return de(r,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),this.plugin.config.set($r.State.CurrentServer,this.state.params.options.serverUrl),[4,wt.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl})];case 1:return n.sent(),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh()),[2]}})})},r.fetch=function(n){return de(r,void 0,void 0,function(){var a,i;return fe(this,function(o){switch(o.label){case 0:if(a=n.currentTarget.getAttribute("data-id"),!a)return[2];if(i=this.state.entries.get(a),!i)return[2];this.setState({isBusy:!0}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,wt.State.Snapshots.Fetch(this.plugin,{url:i.url})];case 2:return o.sent(),[3,4];case 3:return this._mounted&&this.setState({isBusy:!1}),[7];case 4:return[2]}})})},r.remove=function(n){return de(r,void 0,void 0,function(){var a,i;return fe(this,function(o){switch(o.label){case 0:if(a=n.currentTarget.getAttribute("data-id"),!a)return[2];if(i=this.state.entries.get(a),!i)return[2];this.setState({entries:this.state.entries.remove(a)}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(i.removeUrl)];case 2:return o.sent(),[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}})})},r}return t.prototype.componentDidMount=function(){this.refresh(),this._mounted=!0},t.prototype.componentWillUnmount=function(){this._mounted=!1},t.prototype.serverUrl=function(r){return r?Z3(this.state.params.options.serverUrl,r):this.state.params.options.serverUrl},t.prototype.render=function(){var r=this;return M.jsxs(M.Fragment,{children:[M.jsx(_c,{title:"Remote States",accent:"blue"},void 0),!this.props.listOnly&&M.jsxs(M.Fragment,{children:[M.jsx(Un,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:function(n){var a;r.setState({params:E(E({},r.state.params),(a={},a[n.name]=n.value,a))})},isDisabled:this.state.isBusy},void 0),M.jsxs("div",E({className:"msp-flex-row"},{children:[M.jsx(qt,{onClick:this.refresh,disabled:this.state.isBusy,svg:iM},void 0),M.jsx(pr,E({icon:lwe,onClick:this.upload,disabled:this.state.isBusy,commit:!0},{children:"Upload"}),void 0)]}),void 0)]},void 0),M.jsx(iZe,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove},void 0),this.props.listOnly&&M.jsxs("div",E({style:{marginTop:"10px"}},{children:[M.jsx(Un,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:function(n){var a;r.setState({params:E(E({},r.state.params),(a={},a[n.name]=n.value,a))})},isDisabled:this.state.isBusy},void 0),M.jsx("div",E({className:"msp-flex-row"},{children:M.jsx(pr,E({onClick:this.refresh,disabled:this.state.isBusy,icon:iM},{children:"Refresh"}),void 0)}),void 0)]}),void 0)]},void 0)},t}(vr),iZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.open=function(n){return de(r,void 0,void 0,function(){var a,i,o,s;return fe(this,function(u){return a=n.currentTarget.getAttribute("data-id"),a?(i=this.props.entries.get(a),i?(n.preventDefault(),o=""+window.location,s=o.indexOf("?"),s>0&&(o=o.substr(0,s)),window.open(o+"?snapshot-url="+encodeURIComponent(i.url),"_blank"),[2]):[2]):[2]})})},r}return t.prototype.render=function(){var r=this;return M.jsx("ul",E({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.props.entries.valueSeq().map(function(n){return M.jsxs("li",E({className:"msp-flex-row"},{children:[M.jsxs(pr,E({"data-id":n.id,onClick:r.props.fetch,disabled:r.props.isBusy,onContextMenu:r.open,title:"Click to download, right-click to open in a new tab."},{children:[n.name||new Date(n.timestamp).toLocaleString()," ",M.jsx("small",{children:n.description},void 0)]}),void 0),!n.isSticky&&r.props.remove&&M.jsx(qt,{svg:Zs,"data-id":n.id,title:"Remove",onClick:r.props.remove,disabled:r.props.isBusy,small:!0},void 0)]}),n.id)})}),void 0)},t}(Ka);function pte(e,t){return t===void 0&&(t=wEe),function(r){return r.lift(new oZe(e,t))}}var oZe=function(){function e(t,r){this.dueTime=t,this.scheduler=r}return e.prototype.call=function(t,r){return r.subscribe(new sZe(t,this.dueTime,this.scheduler))},e}(),sZe=function(e){yi(t,e);function t(r,n,a){var i=e.call(this,r)||this;return i.dueTime=n,i.scheduler=a,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return t.prototype._next=function(r){this.clearDebounce(),this.lastValue=r,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(uZe,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var r=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(r)}},t.prototype.clearDebounce=function(){var r=this.debouncedSubscription;r!==null&&(this.remove(r),r.unsubscribe(),this.debouncedSubscription=null)},t}(Us);function uZe(e){e.debouncedNext()}function lZe(e){return function(t){return e===0?bEe():t.lift(new cZe(e))}}var cZe=function(){function e(t){if(this.total=t,this.total<0)throw new AEe}return e.prototype.call=function(t,r){return r.subscribe(new dZe(t,this.total))},e}(),dZe=function(e){yi(t,e);function t(r,n){var a=e.call(this,r)||this;return a.total=n,a.count=0,a}return t.prototype._next=function(r){var n=this.total,a=++this.count;a<=n&&(this.destination.next(r),a===n&&(this.destination.complete(),this.unsubscribe()))},t}(Us),vte=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showActions:!0},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===cr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===cr.RootRef&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var a=r.state.tree.root.ref,i=r.state.tree.children.get(a),o=i.size===0;return n.showActions===o?null:{showActions:o}},t.prototype.render=function(){var r=this.props.state.tree.root.ref;return this.state.showActions?M.jsxs("div",E({style:{margin:"10px",cursor:"default"}},{children:[M.jsx("p",{children:"Nothing to see here yet."},void 0),M.jsxs("p",{children:["Structures and Volumes can be loaded from the ",M.jsx(on,{svg:aM},void 0)," tab."]},void 0)]}),void 0):M.jsx(fZe,{cell:this.props.state.cells.get(r),depth:0},void 0)},t}(vr),fZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCollapsed:!!r.props.cell.state.isCollapsed,isNull:t.isNull(r.props.cell),showLabel:t.showLabel(r.props.cell)},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.props.cell===n.cell&&r.is(n)&&n.state.cells.has(r.ref)&&(r.state.isCollapsed!==!!n.cell.state.isCollapsed||r.state.isNull!==t.isNull(n.cell)||r.state.showLabel!==t.showLabel(n.cell))&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,function(n){r.props.cell.parent===n.state&&r.ref===n.cell.transform.parent&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){r.props.cell.parent===n.state&&r.ref===n.parent&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var a=t.isNull(r.cell),i=t.showLabel(r.cell);return!!r.cell.state.isCollapsed===n.isCollapsed&&n.isNull===a&&n.showLabel===i?null:{isCollapsed:!!r.cell.state.isCollapsed,isNull:a,showLabel:i}},t.hasDecorator=function(r){var n,a=r.parent.tree.children.get(r.transform.ref);return a.size!==1?!1:!!(!((n=r.parent)===null||n===void 0)&&n.tree.transforms.get(a.first()).transformer.definition.isDecorator)},t.isNull=function(r){return!r||!r.parent||r.obj===On.Null||!r.parent.tree.transforms.has(r.transform.ref)},t.showLabel=function(r){return r.transform.ref!==cr.RootRef&&(r.status!=="ok"||!r.state.isGhost&&!t.hasDecorator(r))},t.prototype.render=function(){var r=this;if(this.state.isNull)return null;var n=this.props.cell,a=n.parent.tree.children.get(this.ref);if(!this.state.showLabel)return a.size===0?null:M.jsx(M.Fragment,{children:a.map(function(o){return M.jsx(t,{cell:n.parent.cells.get(o),depth:r.props.depth},o)})},void 0);var i=this.props.depth+1;return M.jsxs(M.Fragment,{children:[M.jsx(hZe,{cell:n,depth:this.props.depth},void 0),a.size===0?void 0:M.jsx("div",E({style:{display:this.state.isCollapsed?"none":"block"}},{children:a.map(function(o){return M.jsx(t,{cell:n.parent.cells.get(o),depth:i},o)})}),void 0)]},void 0)},t}(vr),hZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCurrent:r.props.cell.parent.current===r.ref,isCollapsed:!!r.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},r.setCurrent=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),wt.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:r.ref})},r.setCurrentRoot=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),wt.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:cr.RootRef})},r.remove=function(n){n==null||n.preventDefault(),wt.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.ref,removeParentGhosts:!0})},r.toggleVisible=function(n){n.preventDefault(),wt.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.toggleExpanded=function(n){n.preventDefault(),wt.State.ToggleExpanded(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),wt.Interactivity.Object.Highlight(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.clearHighlight=function(n){n.preventDefault(),wt.Interactivity.ClearHighlights(r.plugin),n.currentTarget.blur()},r.hideApply=function(){r.setCurrentRoot()},r.selectAction=function(n){n&&(n==null?void 0:n.value)()},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(v3(function(n){return r.is(n)}),pte(33)),function(n){r.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,function(n){if(!r.is(n)){r.state.isCurrent&&n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,r.state.isCollapsed);return}n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,!!r.props.cell.state.isCollapsed)})},t.prototype._setCurrent=function(r,n){r?this.setState({isCurrent:r,action:"options",currentAction:void 0,isCollapsed:n}):this.setState({isCurrent:r,action:void 0,currentAction:void 0,isCollapsed:n})},t.getDerivedStateFromProps=function(r,n){var a=r.cell.parent.current===r.cell.transform.ref,i=!!r.cell.state.isCollapsed;return n.isCollapsed===i&&n.isCurrent===a?null:{isCurrent:a,isCollapsed:i,action:void 0,currentAction:void 0}},Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.props.cell,a=Ut([],n.parent.actions.fromCell(n,this.plugin));if(a.length!==0)return a.sort(function(i,o){return i.definition.display.name<o.definition.display.name?-1:i.definition.display.name===o.definition.display.name?0:1}),Ut([er.Header("Apply Action")],a.map(function(i){return er.Item(i.definition.display.name,function(){return r.setState({action:"apply",currentAction:i})})}))},enumerable:!1,configurable:!0}),t.prototype.updates=function(r){for(var n=this.props.cell,a=$1.getDecoratorChain(n.parent,n.transform.ref),i=[],o=a.length-1;o>=0;o--){var s=a[o];i.push(M.jsx(nd,{state:n.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:r},s.transform.transformer.id+"-"+o))}return M.jsx("div",E({className:"msp-tree-updates-wrapper"},{children:i}),void 0)},t.prototype.render=function(){var r=this.props.cell,n=r.transform;if(!r)return null;var a=this.is(r.parent.behaviors.currentObject.value),i=r.status!=="error"&&r.status!=="ok",o;if(r.status==="error"||!r.obj){var s=r.status==="error"?r.errorText:n.transformer.definition.display.name;o=M.jsxs(pr,E({className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:s,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:i},{children:[r.status==="error"&&M.jsxs("b",{children:["[",r.status,"]"]},void 0)," ",M.jsx("span",{children:s},void 0)]}),void 0)}else{var u=r.obj,l=u.label+" "+(u.description?u.description:"");o=M.jsxs(pr,E({className:"msp-btn-tree-label msp-type-class-"+u.type.typeClass,noOverflow:!0,disabled:i,title:l,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent},{children:[M.jsx("span",{children:u.label},void 0)," ",u.description?M.jsx("small",{children:u.description},void 0):void 0]}),void 0)}var c=r.parent.tree.children.get(this.ref),d=r.state,f=M.jsx(qt,{svg:d.isCollapsed?Gc:Hc,flex:"20px",disabled:i,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:c.size>0?"visible":"hidden"}},void 0),h=r.state.isLocked?void 0:M.jsx(qt,{svg:Zs,onClick:this.remove,disabled:i,small:!0,toggleState:!1},void 0),v=M.jsx(qt,{svg:d.isHidden?fv:hv,toggleState:!1,disabled:i,small:!0,onClick:this.toggleVisible},void 0),p={marginLeft:this.props.depth*8+"px"},g=M.jsxs("div",E({className:"msp-flex-row msp-tree-row"+(a?" msp-tree-row-current":""),onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:p},{children:[f,o,h,v]}),void 0);if(!a)return g;if(this.state.action==="apply"&&this.state.currentAction)return M.jsxs("div",E({style:{marginBottom:"1px"}},{children:[g,M.jsx(Cc,E({header:"Apply "+this.state.currentAction.definition.display.name,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:Sc,headerLeftMargin:this.props.depth*8+21+"px"},{children:M.jsx(QO,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0},void 0)}),void 0)]}),void 0);if(this.state.action==="options"){var m=this.actions,y=this.updates(this.props.depth*8+21+"px");return M.jsxs("div",E({style:{marginBottom:"1px"}},{children:[g,y,m&&M.jsx("div",E({style:{marginLeft:this.props.depth*8+21+"px",marginTop:"-1px"}},{children:M.jsx(er,{items:m,onSelect:this.selectAction},void 0)}),void 0)]}),void 0)}return g},t}(vr),pZe=function(e){Be(t,e);function t(){var r,n=e.apply(this,arguments)||this;return n.state={tab:n.plugin.behaviors.layout.leftPanelTabName.value},n.set=function(a){if(n.state.tab===a){n.setState({tab:"none"},function(){return n.plugin.behaviors.layout.leftPanelTabName.next("none")}),wt.Layout.Update(n.plugin,{state:{regionState:E(E({},n.plugin.layout.state.regionState),{left:"collapsed"})}});return}n.setState({tab:a},function(){return n.plugin.behaviors.layout.leftPanelTabName.next(a)}),n.plugin.layout.state.regionState.left!=="full"&&wt.Layout.Update(n.plugin,{state:{regionState:E(E({},n.plugin.layout.state.regionState),{left:"full"})}})},n.tabs={none:M.jsx(M.Fragment,{},void 0),root:M.jsxs(M.Fragment,{children:[M.jsx(_c,{icon:aM,title:"Home"},void 0),M.jsx(tZe,{state:n.plugin.state.data,nodeRef:cr.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0},void 0),((r=n.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&M.jsx(hte,{listOnly:!0},void 0)]},void 0),data:M.jsxs(M.Fragment,{children:[M.jsx(_c,{icon:RX,title:M.jsxs(M.Fragment,{children:[M.jsx(gZe,{},void 0)," State Tree"]},void 0)},void 0),M.jsx(vte,{state:n.plugin.state.data},void 0)]},void 0),states:M.jsx(rZe,{},void 0),settings:M.jsxs(M.Fragment,{children:[M.jsx(_c,{icon:jp,title:"Plugin Settings"},void 0),M.jsx(mZe,{},void 0)]},void 0),help:M.jsxs(M.Fragment,{children:[M.jsx(_c,{icon:Il,title:"Help"},void 0),M.jsx(EYe,{},void 0)]},void 0)},n}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.state.tab!==n&&r.setState({tab:n}),n==="none"&&r.plugin.layout.state.regionState.left!=="collapsed"&&wt.Layout.Update(r.plugin,{state:{regionState:E(E({},r.plugin.layout.state.regionState),{left:"collapsed"})}})}),this.subscribe(this.plugin.state.data.events.changed,function(n){var a=n.state;r.state.tab==="data"&&a.cells.size===1&&r.set("root")})},t.prototype.render=function(){var r=this,n=this.state.tab;return M.jsxs("div",E({className:"msp-left-panel-controls"},{children:[M.jsxs("div",E({className:"msp-left-panel-controls-buttons"},{children:[M.jsx(qt,{svg:aM,toggleState:n==="root",transparent:!0,onClick:function(){return r.set("root")},title:"Home"},void 0),M.jsx(vZe,{set:this.set},void 0),M.jsx(qt,{svg:UX,toggleState:n==="states",transparent:!0,onClick:function(){return r.set("states")},title:"Plugin State"},void 0),M.jsx(qt,{svg:Il,toggleState:n==="help",transparent:!0,onClick:function(){return r.set("help")},title:"Help"},void 0),M.jsx("div",E({className:"msp-left-panel-controls-buttons-bottom"},{children:M.jsx(qt,{svg:jp,toggleState:n==="settings",transparent:!0,onClick:function(){return r.set("settings")},title:"Settings"},void 0)}),void 0)]}),void 0),M.jsx("div",E({className:"msp-scrollable-container"},{children:this.tabs[n]}),void 0)]}),void 0)},t}(vr),vZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={changed:!1},r}return Object.defineProperty(t.prototype,"tab",{get:function(){return this.plugin.behaviors.layout.leftPanelTabName.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.tab==="data"?r.setState({changed:!1}):r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,function(n){r.tab!=="data"&&r.setState({changed:!0})})},t.prototype.render=function(){var r=this;return M.jsx(qt,{svg:RX,toggleState:this.tab==="data",transparent:!0,onClick:function(){return r.props.set("data")},title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?M.jsx("div",{className:"msp-left-panel-controls-button-data-dirty"},void 0):void 0},void 0)},t}(vr),mZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n){var a;wt.Canvas3D.SetSettings(r.plugin,{settings:(a={},a[n.name]=n.value,a)})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return M.jsxs(M.Fragment,{children:[this.plugin.canvas3d&&M.jsxs(M.Fragment,{children:[M.jsx(_c,{title:"Viewport"},void 0),M.jsx(Un,{params:Es,values:this.plugin.canvas3d.props,onChange:this.setSettings},void 0)]},void 0),M.jsx(_c,{title:"Behavior"},void 0),M.jsx(vte,{state:this.plugin.state.behaviors},void 0)]},void 0)},t}(vr),gZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(n){n.preventDefault(),wt.State.RemoveObject(r.plugin,{state:r.plugin.state.data,ref:cr.RootRef})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===cr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===cr.RootRef&&r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data.tree.children.get(cr.RootRef).size;return r===0?null:M.jsx(qt,{svg:Zs,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0},void 0)},t}(vr),Pz=5,yZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.parentDiv=ze.createRef(),r.lastMouseOverSeqIdx=-1,r.highlightQueue=new ta,r.lociHighlightProvider=function(n,a){var i=r.props.sequenceWrapper.markResidue(n.loci,a);i&&r.updateMarker()},r.lociSelectionProvider=function(n,a){var i=r.props.sequenceWrapper.markResidue(n.loci,a);i&&r.updateMarker()},r.contextMenu=function(n){n.preventDefault()},r.mouseDownLoci=void 0,r.mouseDown=function(n){n.stopPropagation();var a=r.getSeqIdx(n),i=r.getLoci(a),o=lp(n.nativeEvent),s=Rm(n.nativeEvent),u=hx(n.nativeEvent);r.click(i,o,s,u),r.mouseDownLoci=i},r.mouseUp=function(n){if(n.stopPropagation(),r.mouseDownLoci!==void 0){var a=r.getSeqIdx(n),i=r.getLoci(a);if(i&&!Oe.areEqual(r.mouseDownLoci,i)){var o=lp(n.nativeEvent),s=Rm(n.nativeEvent),u=hx(n.nativeEvent),l=r.mouseDownLoci.elements[0],c=i.elements[0],d=Math.min(Fe.min(l.indices),Fe.min(c.indices)),f=Math.max(Fe.max(l.indices),Fe.max(c.indices)),h=Oe(i.structure,[{unit:l.unit,indices:Fe.ofRange(d,f)}]);r.click(Oe.subtract(h,r.mouseDownLoci),o,s,u)}r.mouseDownLoci=void 0}},r.location=at.create(void 0),r.mouseMove=function(n){n.stopPropagation();var a=lp(n.nativeEvent),i=Rm(n.nativeEvent),o=hx(n.nativeEvent),s=n.target;if(!s||!s.getAttribute){if(r.lastMouseOverSeqIdx===-1)return;r.lastMouseOverSeqIdx=-1,r.highlightQueue.next({seqIdx:-1,buttons:a,button:i,modifiers:o});return}var u=s.hasAttribute("data-seqid")?+s.getAttribute("data-seqid"):-1;if(r.lastMouseOverSeqIdx!==u)if(r.lastMouseOverSeqIdx=u,r.mouseDownLoci!==void 0){var l=r.getLoci(u);r.hover(l,0,0,E(E({},o),{shift:!0}))}else r.highlightQueue.next({seqIdx:u,buttons:a,button:i,modifiers:o})},r.mouseLeave=function(n){if(n.stopPropagation(),r.mouseDownLoci=void 0,r.lastMouseOverSeqIdx!==-1){r.lastMouseOverSeqIdx=-1;var a=lp(n.nativeEvent),i=Rm(n.nativeEvent),o=hx(n.nativeEvent);r.highlightQueue.next({seqIdx:-1,buttons:a,button:i,modifiers:o})}},r}return Object.defineProperty(t.prototype,"sequenceNumberPeriod",{get:function(){if(this.props.sequenceNumberPeriod!==void 0)return this.props.sequenceNumberPeriod;if(this.props.sequenceWrapper.length>10)return 10;var r=this.getSequenceNumber(this.props.sequenceWrapper.length-1);return r.length>1?5:1},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(pte(15)(this.highlightQueue),function(n){var a=r.getLoci(n.seqIdx<0?void 0:n.seqIdx);r.hover(a,n.buttons,n.button,n.modifiers)})},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)},t.prototype.getLoci=function(r){if(r!==void 0){var n=this.props.sequenceWrapper.getLoci(r);if(!Oe.isEmpty(n))return n}},t.prototype.getSeqIdx=function(r){var n=void 0,a=r.target;return a&&a.getAttribute&&(n=a.hasAttribute("data-seqid")?+a.getAttribute("data-seqid"):void 0),n},t.prototype.hover=function(r,n,a,i){var o={current:sr.Loci.Empty,buttons:n,button:a,modifiers:i};r!==void 0&&!Oe.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.hover.next(o)},t.prototype.click=function(r,n,a,i){var o={current:sr.Loci.Empty,buttons:n,button:a,modifiers:i};r!==void 0&&!Oe.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.click.next(o)},t.prototype.getBackgroundColor=function(r){return typeof r>"u"&&console.error("unexpected marker value"),r===0?"":r%2===0?"rgb(51, 255, 25)":"rgb(255, 102, 153)"},t.prototype.getResidueClass=function(r,n){return n.length>1?this.props.sequenceWrapper.residueClass(r)+(r===0?" msp-sequence-residue-long-begin":" msp-sequence-residue-long"):this.props.sequenceWrapper.residueClass(r)},t.prototype.residue=function(r,n,a){return M.jsx("span",E({"data-seqid":r,style:{backgroundColor:this.getBackgroundColor(a)},className:this.getResidueClass(r,n)},{children:"​"+n+"​"}),r)},t.prototype.getSequenceNumberClass=function(r,n,a){var i=["msp-sequence-number"];return n.startsWith("-")?a.length>1&&r>0?i.push("msp-sequence-number-long-negative"):i.push("msp-sequence-number-negative"):a.length>1&&r>0&&i.push("msp-sequence-number-long"),i.join(" ")},t.prototype.getSequenceNumber=function(r){var n="",a=this.props.sequenceWrapper.getLoci(r),i=Oe.getFirstLocation(a,this.location);if(i)if(We.isAtomic(i.unit)){var o=pt.residue.auth_seq_id(i),s=pt.residue.pdbx_PDB_ins_code(i);n=""+o+(s||"")}else We.isCoarse(i.unit)&&(n=""+(r+1));return n},t.prototype.padSeqNum=function(r){return r.length<Pz?r+new Array(Pz-r.length+1).join(" "):r},t.prototype.getSequenceNumberSpan=function(r,n){var a=this.getSequenceNumber(r);return M.jsx("span",E({className:this.getSequenceNumberClass(r,a,n)},{children:this.padSeqNum(a)}),"marker-"+r)},t.prototype.updateMarker=function(){if(this.parentDiv.current)for(var r=this.parentDiv.current.children,n=this.props.sequenceWrapper.markerArray,a=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod,o=0,s=0,u=n.length;s<u;s++){a&&s%i===0&&s<u&&o++;var l=r[o];if(!l)return;o++;var c=this.getBackgroundColor(n[s]);l.style.backgroundColor!==c&&(l.style.backgroundColor=c)}},t.prototype.render=function(){for(var r=this.props.sequenceWrapper,n=[],a=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod,o=0,s=r.length;o<s;++o){var u=r.residueLabel(o);a&&o%i===0&&o<s&&(n[n.length]=this.getSequenceNumberSpan(o,u)),n[n.length]=this.residue(o,u,r.markerArray[o])}return this.updateMarker(),M.jsx("div",E({className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv},{children:n}),void 0)},t}(vr),nE=function(){function e(t,r,n){this.data=t,this.markerArray=r,this.length=n}return e.prototype.markResidue=function(t,r){return js(t)?Hu(this.markerArray,Re.ofLength(this.length),r):this.mark(t,r)},e}(),bZe=function(e){Be(t,e);function t(r){var n=this,a=at.create(r.structure,r.units[0],r.units[0].elements[0]),i=r.units[0].model.sequence.byEntityKey[pt.entity.key(a)],o=i.sequence.length,s=new Uint8Array(o);n=e.call(this,r,s,o)||this,n.unitMap=new Map;for(var u=0,l=r.units;u<l.length;u++){var c=l[u];n.unitMap.set(c.id,c)}n.sequence=i.sequence,n.missing=r.units[0].model.properties.missingResidues,n.modelNum=r.units[0].model.modelNum,n.asymId=We.isAtomic(r.units[0])?pt.chain.label_asym_id(a):pt.coarse.asym_id(a);for(var d=[],f=0;f<o;++f)n.missing.has(n.modelNum,n.asymId,n.seqId(f))&&d.push(f);return n.observed=Fe.subtract(Re.ofBounds(0,o),it.ofSortedArray(d)),n}return t.prototype.seqId=function(r){return this.sequence.seqId.value(r)},t.prototype.residueLabel=function(r){return this.sequence.label.value(r)||this.sequence.code.value(r)},t.prototype.residueColor=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?dr.grey:dr.black},t.prototype.residueClass=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?"msp-sequence-missing":"msp-sequence-present"},t.prototype.mark=function(r,n){var a=this,i=!1,o=this.data.structure,s=function(d){return a.sequence.index(d)};if(Oe.is(r)){if(!tt.areRootsEquivalent(r.structure,o))return!1;r=Oe.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u];this.unitMap.has(c.unit.id)&&(We.isAtomic(c.unit)?i=SZe(c,n,this.markerArray,s):i=CZe(c,n,this.markerArray,s))}}else if(tt.isLoci(r)){if(!tt.areRootsEquivalent(r.structure,o))return!1;Hu(this.markerArray,this.observed,n)&&(i=!0)}return i},t.prototype.getLoci=function(r){var n=xZe(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(r));return yt.toLociWithSourceUnits(LM.run(n,this.data.structure))},t}(nE);function xZe(e,t,r){return rn.generators.atoms({unitTest:function(n){return pt.unit.chainGroupId(n.element)===e&&pt.unit.operator_name(n.element)===t},residueTest:function(n){return n.element.unit.kind===0?pt.residue.label_seq_id(n.element)===r:pt.coarse.seq_id_begin(n.element)<=r&&pt.coarse.seq_id_end(n.element)>=r}})}function SZe(e,t,r,n){var a=e.unit,i=a.model,o=a.elements,s=i.atomicHierarchy.residueAtomSegments.index,u=i.atomicHierarchy.residues.label_seq_id;return Fe.forEachSegment(e.indices,function(l){return s[o[l]]},function(l){var c=u.value(l);p_(r,n(c),t)}),!0}function CZe(e,t,r,n){var a=e.unit,i=a.model,o=a.elements,s=We.isSpheres(e.unit)?i.coarseHierarchy.spheres.seq_id_begin:i.coarseHierarchy.gaussians.seq_id_begin,u=We.isSpheres(e.unit)?i.coarseHierarchy.spheres.seq_id_end:i.coarseHierarchy.gaussians.seq_id_end;return Fe.forEach(e.indices,function(l){for(var c=o[l],d=n(s.value(c)),f=n(u.value(c));d<=f;d++)p_(r,d,t)}),!0}var _Ze=function(e){Be(t,e);function t(r){for(var n=this,a=[],i=new Map,o=new Map,s=new Map,u=0,l=r.units.length;u<l;++u)for(var c=r.units[u],d=c.model.atomicHierarchy,f=d.residueAtomSegments,h=d.atoms,v=ar.transientSegments(f,c.elements);v.hasNext;){var p=v.move().index;i.set(p,a.length),o.set(a.length,p),s.set(a.length,c),a.push(h.label_comp_id.value(f.offsets[p]))}var g=a.length,m=new Uint8Array(g);n=e.call(this,r,m,g)||this,n.unitMap=new Map;for(var y=0,b=r.units;y<b.length;y++){var c=b[y];n.unitMap.set(c.id,c)}return n.sequence=a,n.sequenceIndices=i,n.residueIndices=o,n.seqToUnit=s,n}return t.prototype.residueLabel=function(r){return this.sequence[r]},t.prototype.residueColor=function(r){return dr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=this,i=!1,o=this.data.structure;if(Oe.is(r)){if(!tt.areRootsEquivalent(r.structure,o))return!1;r=Oe.remap(r,o);for(var s=function(f){var h=u.unitMap.get(f.unit.id);if(h){var v=f.unit.model.atomicHierarchy.residueAtomSegments.index;Fe.forEach(f.indices,function(p){var g=a.sequenceIndices.get(v[h.elements[p]]);g!==void 0&&Hu(a.markerArray,Re.ofSingleton(g),n)&&(i=!0)})}},u=this,l=0,c=r.elements;l<c.length;l++){var d=c[l];s(d)}}else if(tt.isLoci(r)){if(!tt.areRootsEquivalent(r.structure,o))return!1;Hu(this.markerArray,Re.ofBounds(0,this.length),n)&&(i=!0)}return i},t.prototype.getLoci=function(r){var n=[],a=this.residueIndices.get(r);if(a!==void 0){var i=this.seqToUnit.get(r),o=i.model.atomicHierarchy.residueAtomSegments.offsets,s=it.findPredecessorIndex(i.elements,o[a]),u=it.findPredecessorIndex(i.elements,o[a+1]);n.push({unit:i,indices:Re.ofBounds(s,u)})}return Oe(this.data.structure,n)},t}(nE),xT=function(e){Be(t,e);function t(r){for(var n=this,a=0,i=0,o=[],s=at.create(r.structure),u=new Map,l=[],c=0,d=r.units.length;c<d;++c){var f=r.units[c];at.set(s,r.structure,f,f.elements[0]);var h=f.model.sequence.byEntityKey[pt.entity.key(s)];h&&(a+=h.sequence.length),i+=f.elements.length;var v=Re.ofBounds(0,f.elements.length);u.set(f.id,v),l.push({unit:f,indices:v})}a>0&&o.push(a+" residues"),o.push(i+" elements");var p=1,g=new Uint8Array(p);return n=e.call(this,r,g,p)||this,n.label="Whole Chain ("+o.join(", ")+")",n.unitIndices=u,n.loci=Oe(n.data.structure,l),n}return t.prototype.residueLabel=function(r){return this.label},t.prototype.residueColor=function(r){return dr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=!1,i=this.data.structure;if(Oe.is(r)){if(!tt.areRootsEquivalent(r.structure,i))return!1;r=Oe.remap(r,i);for(var o=0,s=r.elements;o<s.length;o++){var u=s[o],l=this.unitIndices.get(u.unit.id);l&&Fe.isSubset(l,u.indices)&&Hu(this.markerArray,Re.ofSingleton(0),n)&&(a=!0)}}else if(tt.isLoci(r)){if(!tt.areRootsEquivalent(r.structure,i))return!1;Hu(this.markerArray,Re.ofSingleton(0),n)&&(a=!0)}return a},t.prototype.getLoci=function(r){return this.loci},t}(nE),wZe=function(e){Be(t,e);function t(r){for(var n=this,a=0,i=new Map,o=0,s=r.units.length;o<s;++o){var u=r.units[o];a+=u.elements.length;var l=Re.ofBounds(0,u.elements.length);i.set(u.id,l)}var c=new Uint8Array(a);return n=e.call(this,r,c,a)||this,n.unitIndices=i,n}return t.prototype.residueLabel=function(r){return"X"},t.prototype.residueColor=function(r){return dr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=!1,i=this.data,o=i.structure,s=i.units;if(Oe.is(r)){if(!tt.areRootsEquivalent(r.structure,o))return!1;r=Oe.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u],d=this.unitIndices.get(c.unit.id);d&&Fe.isSubset(d,c.indices)&&Hu(this.markerArray,c.indices,n)&&(a=!0)}}else if(tt.isLoci(r)){if(!tt.areRootsEquivalent(r.structure,o))return!1;for(var f=0,h=s.length;f<h;++f){var d=this.unitIndices.get(s[f].id);Hu(this.markerArray,d,n)&&(a=!0)}}return a},t.prototype.getLoci=function(r){for(var n=this.data.units,a=[],i=0,o=0,s=n.length;o<s;++o){var u=n[o];if(r<i+u.elements.length){a.push({unit:u,indices:Re.ofSingleton(r-i)});break}i+=u.elements.length}return Oe(this.data.structure,a)},t}(nE),ST=5e3;function mte(e){var t=pt.unit.pdbx_struct_oper_list_ids(e),r=pt.unit.struct_ncs_oper_id(e),n=pt.unit.hkl(e),a=pt.unit.spgrOp(e);return t.sort().join(",")+"|"+r+"|"+n+"|"+a}function ZO(e){var t=e.split("|"),r=t[0],n=t[1];return[parseInt(r),n]}function Tz(e,t){for(var r=e.structure,n=e.modelEntityId,a=e.chainGroupId,i=e.operatorKey,o=at.create(r),s=ZO(n),u=s[0],l=s[1],c=[],d=0,f=r.units;d<f.length;d++){var h=f[d];at.set(o,r,h,h.elements[0]),r.getModelIndex(h.model)===u&&pt.entity.id(o)===l&&h.chainGroupId===a&&mte(o)===i&&c.push(h)}if(c.length>0){var v={structure:r,units:c},h=c[0],p=void 0;if(h.polymerElements.length){var g=at.create(r,h,h.elements[0]),m=h.model.sequence.byEntityKey[pt.entity.key(g)];if(m&&m.sequence.length<=ST)p=new bZe(v);else{var y=c.reduce(function(x,C){return x+C.polymerElements.length},0);We.isAtomic(h)||y>ST?p=new xT(v):p=new wZe(v)}}else if(We.isAtomic(h)){var b=c.reduce(function(x,C){return x+C.residueCount},0);b>ST?p=new xT(v):p=new _Ze(v)}else console.warn("should not happen, expecting coarse units to be polymeric"),p=new xT(v);return p.markResidue(t.getLoci(r),tr.Select),p}else return"No sequence available"}function Cx(e,t){t===void 0&&(t=!1);for(var r=[],n=at.create(e),a=new Set,i=0,o=e.units;i<o.length;i++){var s=o[i];at.set(n,e,s,s.elements[0]);var u=pt.entity.id(n),l=e.getModelIndex(s.model),c=l+"|"+u;if(!a.has(c)&&!(t&&pt.entity.type(n)!=="polymer")){var d=pt.entity.pdbx_description(n).join(", ");e.models.length&&(e.representativeModel?d+=" (Model "+e.models[l].modelNum+")":d.startsWith("Polymer ")&&(d+=" ("+e.models[l].entry+")"));var f=u+": "+d;r.push([c,f]),a.add(c)}}return r.length===0&&r.push(["","No entities"]),r}function K0(e,t){for(var r=[],n=at.create(e),a=new Set,i=ZO(t),o=i[0],s=i[1],u=0,l=e.units;u<l.length;u++){var c=l[u];if(at.set(n,e,c,c.elements[0]),e.getModelIndex(c.model)===o&&pt.entity.id(n)===s){var d=c.chainGroupId;if(!a.has(d)){var f=du(n,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});r.push([d,f]),a.add(d)}}}return r.length===0&&r.push([-1,"No units"]),r}function Jv(e,t,r){for(var n=[],a=at.create(e),i=new Set,o=ZO(t),s=o[0],u=o[1],l=0,c=e.units;l<c.length;l++){var d=c[l];if(at.set(a,e,d,d.elements[0]),e.getModelIndex(d.model)===s&&pt.entity.id(a)===u&&d.chainGroupId===r){var f=mte(a);if(!i.has(f)){var h=d.conformation.operator.name;n.push([f,h]),i.add(f)}}}return n.length===0&&n.push(["","No operators"]),n}function Iz(e){for(var t,r=[],n=[],a=e.select(ir.Generators.rootsOfType(ge.Molecule.Structure)),i=0,o=a;i<o.length;i++){var s=o[i];!((t=s.obj)===null||t===void 0)&&t.data&&(n.push(s.obj.data),r.push([s.transform.ref,s.obj.data.label]))}return r.length===0&&r.push(["","No structure"]),{options:r,all:n}}var Mz=T.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]),EZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={structureOptions:{options:[],all:[]},structure:tt.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single"},r.setParamProps=function(n){var a=E({},r.state);switch(n.name){case"mode":if(a.mode=n.value,r.state.mode===a.mode)return;if(a.mode==="all"||a.mode==="polymers")break;case"structure":n.name==="structure"&&(a.structureRef=n.value),a.structure=r.getStructure(a.structureRef),a.modelEntityId=Cx(a.structure)[0][0],a.chainGroupId=K0(a.structure,a.modelEntityId)[0][0],a.operatorKey=Jv(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"entity":a.modelEntityId=n.value,a.chainGroupId=K0(a.structure,a.modelEntityId)[0][0],a.operatorKey=Jv(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"chain":a.chainGroupId=n.value,a.operatorKey=Jv(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"operator":a.operatorKey=n.value;break}r.setState(a)},r}return t.prototype.componentDidMount=function(){var r=this;this.plugin.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.obj;a===r.state.structureRef&&i&&i.type===ge.Molecule.Structure.type&&i.data!==r.state.structure&&r.sync()}),this.subscribe(this.plugin.state.events.object.created,function(n){var a=n.obj;a&&a.type===ge.Molecule.Structure.type&&r.sync()}),this.subscribe(this.plugin.state.events.object.removed,function(n){var a=n.obj;a&&a.type===ge.Molecule.Structure.type&&a.data===r.state.structure&&r.sync()})},t.prototype.sync=function(){var r=Iz(this.plugin.state.data);gk(r.all,this.state.structureOptions.all)||this.setState(this.getInitialState())},t.prototype.getStructure=function(r){var n=this.plugin.state.data,a=n.select(r)[0];return!r||!a||!a.obj?tt.Empty:a.obj.data},t.prototype.getSequenceWrapper=function(r){return{wrapper:Tz(this.state,this.plugin.managers.structure.selection),label:T.optionLabel(r.chain,this.state.chainGroupId)+" | "+T.optionLabel(r.entity,this.state.modelEntityId)}},t.prototype.getSequenceWrappers=function(r){if(this.state.mode==="single")return[this.getSequenceWrapper(r)];for(var n=this.getStructure(this.state.structureRef),a=[],i=0,o=Cx(n,this.state.mode==="polymers");i<o.length;i++)for(var s=o[i],u=s[0],l=s[1],c=0,d=K0(n,u);c<d.length;c++)for(var f=d[c],h=f[0],v=f[1],p=0,g=Jv(n,u,h);p<g.length;p++){var m=g[p][0];a.push({wrapper:Tz({structure:n,modelEntityId:u,chainGroupId:h,operatorKey:m},this.plugin.managers.structure.selection),label:v+" | "+l})}return a},t.prototype.getInitialState=function(){var r,n=Iz(this.plugin.state.data),a=n.options[0][0],i=this.getStructure(a),o=Cx(i)[0][0],s=K0(i,o)[0][0],u=Jv(i,o,s)[0][0];return this.state.structure&&this.state.structure===i&&(o=this.state.modelEntityId,s=this.state.chainGroupId,u=this.state.operatorKey),{structureOptions:n,structure:i,structureRef:a,modelEntityId:o,chainGroupId:s,operatorKey:u,mode:(r=this.props.defaultMode)!==null&&r!==void 0?r:"single"}},Object.defineProperty(t.prototype,"params",{get:function(){var r=this.state,n=r.structureOptions,a=r.structure,i=r.modelEntityId,o=r.chainGroupId,s=Cx(a),u=K0(a,i),l=Jv(a,i,o);return{structure:T.Select(n.options[0][0],n.options,{shortLabel:!0}),entity:T.Select(s[0][0],s,{shortLabel:!0}),chain:T.Select(u[0][0],u,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:T.Select(l[0][0],l,{shortLabel:!0,twoColumns:!0}),mode:Mz}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}},enumerable:!1,configurable:!0}),t.prototype.render=function(){if(this.getStructure(this.state.structureRef)===tt.Empty)return M.jsx("div",E({className:"msp-sequence"},{children:M.jsxs("div",E({className:"msp-sequence-select"},{children:[M.jsx(on,{svg:Il,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."},void 0),M.jsx("span",{children:"Sequence"},void 0),M.jsx("span",E({style:{fontWeight:"normal"}},{children:"No structure available"}),void 0)]}),void 0)}),void 0);var r=this.params,n=this.values,a=this.getSequenceWrappers(r);return M.jsxs("div",E({className:"msp-sequence"},{children:[M.jsxs("div",E({className:"msp-sequence-select"},{children:[M.jsx(on,{svg:Il,style:{cursor:"help",position:"absolute",right:0,top:0},title:"This shows a single sequence. Use the controls to show a different sequence."},void 0),M.jsx("span",{children:"Sequence of"},void 0),M.jsx(um,{title:"[Structure] "+T.optionLabel(r.structure,n.structure),param:r.structure,name:"structure",value:n.structure,onChange:this.setParamProps},void 0),M.jsx(um,{title:"[Mode]",param:Mz,name:"mode",value:n.mode,onChange:this.setParamProps},void 0),n.mode==="single"&&M.jsx(um,{title:"[Entity] "+T.optionLabel(r.entity,n.entity),param:r.entity,name:"entity",value:n.entity,onChange:this.setParamProps},void 0),n.mode==="single"&&M.jsx(um,{title:"[Chain] "+T.optionLabel(r.chain,n.chain),param:r.chain,name:"chain",value:n.chain,onChange:this.setParamProps},void 0),r.operator.options.length>1&&M.jsx(M.Fragment,{children:M.jsx(um,{title:"[Instance] "+T.optionLabel(r.operator,n.operator),param:r.operator,name:"operator",value:n.operator,onChange:this.setParamProps},void 0)},void 0)]}),void 0),M.jsx(AZe,{children:a.map(function(i,o){var s=typeof i.wrapper=="string"?M.jsx("div",E({className:"msp-sequence-wrapper"},{children:i.wrapper}),o):M.jsx(yZe,{sequenceWrapper:i.wrapper},o);return n.mode==="single"?s:M.jsxs(ze.Fragment,{children:[M.jsx("div",E({className:"msp-sequence-chain-label"},{children:i.label}),void 0),s]},o)})},void 0)]}),void 0)},t}(vr);function AZe(e){var t=e.children;return M.jsx("div",E({className:"msp-sequence-wrapper-non-empty"},{children:t}),void 0)}var PZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:ia.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this,n,a=!!(!((n=this.plugin.spec.components)===null||n===void 0)&&n.hideTaskOverlay);this.subscribe(this.plugin.events.task.progress.pipe(v3(function(i){return i.level==="background"&&(a||!i.useOverlay)})),function(i){r.setState({tracked:r.state.tracked.set(i.id,i)})}),this.subscribe(this.plugin.events.task.finished,function(i){var o=i.id;r.setState({tracked:r.state.tracked.delete(o)})})},t.prototype.render=function(){return M.jsx("div",E({className:"msp-background-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return M.jsx(gte,{event:r},r.id)})}),void 0)},t}(vr),gte=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.abort=function(){r.plugin.managers.task.requestAbort(r.props.event.progress.root.progress.taskId,"User Request")},r}return t.prototype.render=function(){var r=this.props.event.progress.root,n=yte(this.props.event.progress.root)-1,a=r.progress.isIndeterminate?void 0:M.jsxs(M.Fragment,{children:["[",r.progress.current,"/",r.progress.max,"]"]},void 0),i=n>0?M.jsxs(M.Fragment,{children:["[",n," subtask(s)]"]},void 0):void 0;return M.jsx("div",E({className:"msp-task-state"},{children:M.jsxs("div",{children:[r.progress.canAbort&&M.jsx(qt,{svg:OX,onClick:this.abort,title:"Abort"},void 0),M.jsxs("div",{children:[r.progress.message," ",a," ",i]},void 0)]},void 0)}),void 0)},t}(vr);function yte(e){if(e.children.length===0)return 1;for(var t=0,r=0,n=e.children;r<n.length;r++){var a=n[r];t+=yte(a)}return t}var TZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:ia.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.task.progress.pipe(v3(function(n){return!!n.useOverlay})),function(n){r.setState({tracked:r.state.tracked.set(n.id,n)})}),this.subscribe(this.plugin.events.task.finished,function(n){var a=n.id;r.setState({tracked:r.state.tracked.delete(a)})})},t.prototype.render=function(){return this.state.tracked.size===0?null:M.jsx("div",E({className:"msp-overlay-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return M.jsx(gte,{event:r},r.id)})}),void 0)},t}(vr),IZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){var n=r.props.entry;(n.hide||function(){}).call(null)},r}return t.prototype.render=function(){var r=this,n=this.props.entry,a=typeof n.message=="string"?M.jsx("div",{dangerouslySetInnerHTML:{__html:n.message}},void 0):M.jsx("div",{children:M.jsx(n.message,{},void 0)},void 0);return M.jsxs("div",E({className:"msp-toast-entry"},{children:[M.jsx("div",E({className:"msp-toast-title",onClick:function(){return r.hide()}},{children:n.title}),void 0),M.jsx("div",E({className:"msp-toast-message"},{children:a}),void 0),M.jsx("div",{className:"msp-toast-clear"},void 0),M.jsx("div",E({className:"msp-toast-hide"},{children:M.jsx(qt,{svg:OX,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"},void 0)}),void 0)]}),void 0)},t}(vr),MZe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.toast.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.toast.state;if(!r.entries.count())return null;var n=[];return r.entries.forEach(function(a,i){return n.push(a)}),n.sort(function(a,i){return a.serialNumber-i.serialNumber}),M.jsx("div",E({className:"msp-toast-container"},{children:n.map(function(a){return M.jsx(IZe,{entry:a},a.serialNumber)})}),void 0)},t}(vr),DZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.container=ze.createRef(),r.canvas=ze.createRef(),r.state={noWebGl:!1,showLogo:!0},r.handleLogo=function(){var n;r.setState({showLogo:!(!((n=r.plugin.canvas3d)===null||n===void 0)&&n.reprCount.value)})},r}return t.prototype.componentDidMount=function(){if(!this.canvas.current||!this.container.current||!this.plugin.initViewer(this.canvas.current,this.container.current)){this.setState({noWebGl:!0});return}this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this)},t.prototype.renderMissing=function(){if(this.props.noWebGl){var r=this.props.noWebGl;return M.jsx(r,{},void 0)}return M.jsx("div",E({className:"msp-no-webgl"},{children:M.jsxs("div",{children:[M.jsx("p",{children:M.jsx("b",{children:"WebGL does not seem to be available."},void 0)},void 0),M.jsx("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps."},void 0),M.jsxs("p",{children:["For a list of supported browsers, refer to ",M.jsx("a",E({href:"http://caniuse.com/#feat=webgl",target:"_blank"},{children:"http://caniuse.com/#feat=webgl"}),void 0),"."]},void 0)]},void 0)}),void 0)},t.prototype.render=function(){if(this.state.noWebGl)return this.renderMissing();var r=this.props.logo;return M.jsxs("div",E({className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle},{children:[M.jsx("div",E({className:this.props.hostClassName||"msp-viewport-host3d",style:this.props.hostStyle,ref:this.container},{children:M.jsx("canvas",{ref:this.canvas},void 0)}),void 0),this.state.showLogo&&r&&M.jsx(r,{},void 0)]}),void 0)},t}(vr);function dp(e){var t=ze.useState(e==null?void 0:e.value),r=t[0],n=t[1];return ze.useEffect(function(){if(!e){r!==void 0&&n(void 0);return}var a=!0,i=e.subscribe(function(o){a?(a=!1,o!==r&&n(o)):n(o)});return function(){i.unsubscribe()}},[e]),r}var RZe=function(e){var t=e.plugin,r=e.cropFrameColor,n=t.helpers.viewportScreenshot,a=ze.useState(null),i=a[0],o=a[1],s=ze.useRef(null),u=ze.useRef(e);return ze.useEffect(function(){u.current=e},Object.values(e)),ze.useEffect(function(){i!==s.current&&o(s.current)}),ze.useEffect(function(){var l,c=!1,d=[];function f(m,y){m&&d.push(m.subscribe(y))}function h(){var m=u.current;!m.suspend&&s.current&&Dz(n,s.current,m.customBackground,m.borderColor,m.borderWidth),s.current||(c=!0)}var v=setInterval(function(){c&&(c=!1,h())},1e3/8);f(t.events.canvas3d.settingsUpdated,function(){return c=!0}),f((l=t.canvas3d)===null||l===void 0?void 0:l.didDraw,function(){return c=!0}),f(t.state.data.behaviors.isUpdating,function(m){m||(c=!0)}),f(n.behaviors.values,function(){return c=!0}),f(n.behaviors.cropParams,function(){return c=!0});var p=void 0;typeof ResizeObserver<"u"&&(p=new ResizeObserver(function(){return c=!0}));var g=s.current;return p==null||p.observe(g),h(),function(){clearInterval(v),d.forEach(function(m){return m.unsubscribe()}),p==null||p.unobserve(g)}},[n]),ze.useLayoutEffect(function(){s.current&&Dz(n,s.current,e.customBackground,e.borderColor,e.borderWidth)},Ut([],Object.values(e))),M.jsx(M.Fragment,{children:M.jsxs("div",E({style:{position:"relative",width:"100%",height:"100%"}},{children:[M.jsx("canvas",{ref:s,onContextMenu:function(l){l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}},void 0),M.jsx(OZe,{plugin:t,canvas:i,color:r},void 0)]}),void 0)},void 0)},kZe=ze.memo(RZe,function(e,t){return fk(e,t)});function Dz(e,t,r,n,a){var i=e.getPreview(),o=i.canvas,s=i.width,u=i.height,l=t.getContext("2d");if(l){var c=t.clientWidth,d=t.clientHeight;t.width=c,t.height=d,l.clearRect(0,0,c,d);var f=bte(s,u,c,d);if(r)l.fillStyle=r,l.fillRect(f.x,f.y,f.width,f.height);else if(e.values.transparent)for(var h=13,v=0;v<f.width;v+=h)for(var p=0;p<f.height;p+=h){l.fillStyle=(v+p)%2?"#ffffff":"#bfbfbf";var g=f.x+v,m=f.y+p,y=v+h>f.width?f.width-v:h,b=p+h>f.height?f.height-p:h;l.fillRect(g,m,y,b)}if(l.drawImage(o,f.x,f.y,f.width,f.height),n&&a){var S=a;l.rect(f.x,f.y,f.width,f.height),l.rect(f.x+S,f.y+S,f.width-2*S,f.height-2*S),l.fillStyle=n,l.fill("evenodd")}}}function OZe(e){var t,r=e.plugin,n=e.canvas,a=e.color,i=a===void 0?"rgba(255, 87, 45, 0.75)":a,o=r.helpers.viewportScreenshot,s=dp(o==null?void 0:o.behaviors.values),u=dp(o==null?void 0:o.behaviors.cropParams),l=dp(o==null?void 0:o.behaviors.relativeCrop),c=ze.useRef({x:0,y:0,width:0,height:0});dp((s==null?void 0:s.resolution.name)==="viewport"?(t=r.canvas3d)===null||t===void 0?void 0:t.resized:void 0);var d=ze.useState(""),f=d[0],h=d[1],v=ze.useState([0,0]),p=v[0],g=v[1],m=ze.useState([0,0]),y=m[0],b=m[1];if(!o||!n)return null;var S=o.getSizeAndViewport(),x=S.width,C=S.height,w=bte(x,C,n.clientWidth,n.clientHeight),A={x:w.x+Math.floor(w.width*l.x),y:w.y+Math.floor(w.height*l.y),width:Math.ceil(w.width*l.width),height:Math.ceil(w.height*l.height)},I=Rz(A),D=Rz(w);if(f==="move"?(I.l+=y[0]-p[0],I.r+=y[0]-p[0],I.t+=y[1]-p[1],I.b+=y[1]-p[1]):f&&(f.indexOf("left")>=0?I.l+=y[0]-p[0]:f.indexOf("right")>=0&&(I.r+=y[0]-p[0]),f.indexOf("top")>=0?I.t+=y[1]-p[1]:f.indexOf("bottom")>=0&&(I.b+=y[1]-p[1])),I.l>I.r){var k=I.l;I.l=I.r,I.r=k}if(I.t>I.b){var k=I.t;I.t=I.b,I.b=k}var R=40;I.l=Math.min(D.r-R,Math.max(D.l,I.l)),I.r=Math.max(D.l+R,Math.min(D.r,I.r)),I.t=Math.min(D.b-R,Math.max(D.t,I.t)),I.b=Math.max(D.t+R,Math.min(D.b,I.b)),A.x=I.l,A.y=I.t,A.width=I.r-I.l+1,A.height=I.b-I.t+1,c.current=A;var L=function(X){X.preventDefault(),b([X.pageX,X.pageY])},H=function(X){X.preventDefault();var U=X.touches[0];b([U.pageX,U.pageY])},B=function(X){X.preventDefault(),h(X.currentTarget.getAttribute("data-drag"));var U=X.touches[0],z=[U.pageX,U.pageY];g(z),b(z),window.addEventListener("touchend",G),window.addEventListener("touchmove",H)},j=function(X){X.preventDefault(),h(X.currentTarget.getAttribute("data-drag"));var U=[X.pageX,X.pageY];g(U),b(U),window.addEventListener("mouseup",Q),window.addEventListener("mousemove",L)},Q=function(){window.removeEventListener("mouseup",Q),window.removeEventListener("mousemove",L),W()},G=function(){window.removeEventListener("touchend",G),window.removeEventListener("touchmove",H),W()};function W(){var X=c.current;u.auto&&(o==null||o.behaviors.cropParams.next(E(E({},u),{auto:!1}))),o==null||o.behaviors.relativeCrop.next({x:(X.x-w.x)/w.width,y:(X.y-w.y)/w.height,width:X.width/w.width,height:X.height/w.height}),h("");var U=[0,0];g(U),b(U)}var q=function(X){X.preventDefault(),X.stopPropagation()},J=4,he="3px solid "+i,$="transparent";return M.jsxs(M.Fragment,{children:[M.jsx("div",{"data-drag":"move",style:{position:"absolute",left:A.x,top:A.y,width:A.width,height:A.height,border:he,cursor:"move"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),M.jsx("div",{"data-drag":"left",style:{position:"absolute",left:A.x-J,top:A.y+J,width:4*J,height:A.height-J,background:$,cursor:"w-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),M.jsx("div",{"data-drag":"right",style:{position:"absolute",left:I.r-2*J,top:A.y,width:4*J,height:A.height-J,background:$,cursor:"w-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),M.jsx("div",{"data-drag":"top",style:{position:"absolute",left:A.x-J,top:A.y-J,width:A.width+2*J,height:4*J,background:$,cursor:"n-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),M.jsx("div",{"data-drag":"bottom",style:{position:"absolute",left:A.x-J,top:I.b-2*J,width:A.width+2*J,height:4*J,background:$,cursor:"n-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),M.jsx("div",{"data-drag":"top, left",style:{position:"absolute",left:I.l-J,top:I.t-J,width:4*J,height:4*J,background:$,cursor:"nw-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),M.jsx("div",{"data-drag":"bottom, right",style:{position:"absolute",left:I.r-2*J,top:I.b-2*J,width:4*J,height:4*J,background:$,cursor:"nw-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),M.jsx("div",{"data-drag":"top, right",style:{position:"absolute",left:I.r-2*J,top:I.t-J,width:4*J,height:4*J,background:$,cursor:"ne-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),M.jsx("div",{"data-drag":"bottom, left",style:{position:"absolute",left:I.l-J,top:I.b-2*J,width:4*J,height:4*J,background:$,cursor:"ne-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0)]},void 0)}function Rz(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function bte(e,t,r,n){var a=e/t,i=r/n;if(a<=i){var o=n*a;return{x:Math.round((r-o)/2),y:0,width:Math.round(o),height:n}}else{var o=r/a;return{x:0,y:Math.round((n-o)/2),width:r,height:Math.round(o)}}}var LZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showPreview:!0,isDisabled:!1},r.download=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download(),r.props.close()},r.copy=function(){return de(r,void 0,void 0,function(){var n;return fe(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,(n=this.plugin.helpers.viewportScreenshot)===null||n===void 0?void 0:n.copyToClipboard()];case 1:return a.sent(),wt.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500}),[3,3];case 2:return a.sent(),[2,this.copyImg()];case 3:return[2]}})})},r.copyImg=function(){return de(r,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return[4,(a=this.plugin.helpers.viewportScreenshot)===null||a===void 0?void 0:a.getImageDataUri()];case 1:return n=i.sent(),this.setState({imageData:n}),[2]}})})},r.open=function(n){!n.target.files||!n.target.files[0]||wt.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.behaviors.isUpdating,function(n){r.setState({isDisabled:n})})},t.prototype.componentWillUnmount=function(){this.setState({imageData:void 0})},t.prototype.render=function(){var r=this,n,a=!!(!((n=navigator.clipboard)===null||n===void 0)&&n.write);return M.jsxs("div",{children:[this.state.showPreview&&M.jsxs("div",E({className:"msp-image-preview"},{children:[M.jsx(kZe,{plugin:this.plugin},void 0),M.jsx(FZe,{plugin:this.plugin},void 0)]}),void 0),M.jsxs("div",E({className:"msp-flex-row"},{children:[!this.state.imageData&&M.jsx(pr,E({icon:hwe,onClick:a?this.copy:this.copyImg,disabled:this.state.isDisabled},{children:"Copy"}),void 0),this.state.imageData&&M.jsx(pr,E({onClick:function(){return r.setState({imageData:void 0})},disabled:this.state.isDisabled},{children:"Clear"}),void 0),M.jsx(pr,E({icon:nM,onClick:this.download,disabled:this.state.isDisabled},{children:"Download"}),void 0)]}),void 0),this.state.imageData&&M.jsxs("div",E({className:"msp-row msp-copy-image-wrapper"},{children:[M.jsx("div",{children:"Right click below + Copy Image"},void 0),M.jsx("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}},void 0)]}),void 0),M.jsx(NZe,{plugin:this.plugin,isDisabled:this.state.isDisabled},void 0),M.jsxs(Bu,E({header:"State"},{children:[M.jsx(dte,{onAction:this.props.close},void 0),M.jsx(Bu,E({header:"Save Options",initiallyExpanded:!1,noOffset:!0},{children:M.jsx(fte,{},void 0)}),void 0)]}),void 0)]},void 0)},t}(vr);function NZe(e){var t=e.plugin,r=e.isDisabled,n=t.helpers.viewportScreenshot,a=dp(n.behaviors.values);return M.jsx(Un,{params:n.params,values:a,onChangeValues:function(i){return n.behaviors.values.next(i)},isDisabled:r},void 0)}function FZe(e){var t=e.plugin,r=t.helpers.viewportScreenshot,n=dp(r==null?void 0:r.behaviors.cropParams);return dp(r==null?void 0:r.behaviors.relativeCrop),r?M.jsxs("div",E({style:{width:"100%",height:"24px",marginTop:"8px"}},{children:[M.jsx(Ra,{icon:bwe,title:"Auto-crop",inline:!0,isSelected:n.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:function(){return r.toggleAutocrop()},label:"Auto-crop "+(n.auto?"On":"Off")},void 0),!n.auto&&M.jsx(pr,{icon:vwe,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.autocrop()}},void 0),!n.auto&&!r.isFullFrame&&M.jsx(pr,{icon:gwe,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.resetCrop()}},void 0)]}),void 0):null}function BZe(e){return function(t){var r=t.values,n=t.update,a=t.apply;return{params:typeof e.params=="function"?e.params:function(i){return e.params},getTarget:e.target,getValues:r,update:function(i,o){var s=e.target(o);return Vp(s,function(u){return n(i,u,o)})},apply:a||function(){}}}}var UZe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return this.plugin.canvas3d?M.jsxs(M.Fragment,{children:[M.jsx(hXe,{mapping:zZe},void 0),M.jsx(BO,{},void 0)]},void 0):null},t}(vr),ES={sequence:"Sequence",log:"Log",left:"Left Panel"},jZe={spin:T.Group({spin:Es.trackball.params.spin,speed:Es.trackball.params.spinSpeed},{pivot:"spin"}),camera:Es.camera,background:T.Group({color:T.Color(dt(16579577),{label:"Background",description:"Custom background color"}),transparent:T.Boolean(!1)},{pivot:"color"}),lighting:T.Group({renderStyle:Es.renderer.params.style,occlusion:Es.postprocessing.params.occlusion,outline:Es.postprocessing.params.outline,fog:Es.cameraFog},{pivot:"renderStyle"}),clipping:T.Group(E(E({},Es.cameraClipping.params),Es.renderer.params.clip.params),{pivot:"radius"}),layout:T.MultiSelect([],T.objectToOptions(ES))},zZe=BZe({params:function(e){var t,r=T.clone(jZe),n=(t=e.spec.components)===null||t===void 0?void 0:t.controls;if(n){var a=[];n.top!=="none"&&a.push(["sequence",ES.sequence]),n.bottom!=="none"&&a.push(["log",ES.log]),n.left!=="none"&&a.push(["left",ES.left]),r.layout.options=a}return r},target:function(e){var t,r,n=(t=e.spec.components)===null||t===void 0?void 0:t.controls,a=e.layout.state.regionState,i=[];return a.top!=="hidden"&&(!n||n.top!=="none")&&i.push("sequence"),a.bottom!=="hidden"&&(!n||n.bottom!=="none")&&i.push("log"),a.left!=="hidden"&&(!n||n.left!=="none")&&i.push("left"),{canvas:(r=e.canvas3d)===null||r===void 0?void 0:r.props,layout:i}}})({values:function(e,t){var r=e.canvas,n=r.renderer;return{layout:e.layout,spin:{spin:!!r.trackball.spin,speed:r.trackball.spinSpeed},camera:r.camera,background:{color:n.backgroundColor,transparent:r.transparentBackground},lighting:{renderStyle:n.style,occlusion:r.postprocessing.occlusion,outline:r.postprocessing.outline,fog:r.cameraFog},clipping:E(E({},r.cameraClipping),r.renderer.clip)}},update:function(e,t){var r=t.canvas;r.trackball.spin=e.spin.spin,r.trackball.spinSpeed=e.spin.speed,r.camera=e.camera,r.transparentBackground=e.background.transparent,r.renderer.backgroundColor=e.background.color,r.renderer.style=e.lighting.renderStyle,r.postprocessing.occlusion=e.lighting.occlusion,r.postprocessing.outline=e.lighting.outline,r.cameraFog=e.lighting.fog,r.cameraClipping={radius:e.clipping.radius,far:e.clipping.far},r.renderer.clip={variant:e.clipping.variant,objects:e.clipping.objects},t.layout=e.layout},apply:function(e,t){return de(this,void 0,void 0,function(){var r,n;return fe(this,function(a){switch(a.label){case 0:return[4,wt.Canvas3D.SetSettings(t,{settings:e.canvas})];case 1:return a.sent(),r=e.layout.indexOf("left")<0,n=Vp(t.layout.state,function(i){i.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",i.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",i.regionState.left=r?"hidden":t.behaviors.layout.leftPanelTabName.value==="none"?"collapsed":"full"}),[4,wt.Layout.Update(t,{state:n})];case 2:return a.sent(),r&&wt.State.SetCurrentObject(t,{state:t.state.data,ref:cr.RootRef}),[2]}})})}}),VZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},r.state=E({},r.allCollapsedState),r.resetCamera=function(){wt.Camera.Reset(r.plugin,{})},r.toggleSettingsExpanded=r.toggle("isSettingsExpanded"),r.toggleScreenshotExpanded=r.toggle("isScreenshotExpanded"),r.toggleControls=function(){wt.Layout.Update(r.plugin,{state:{showControls:!r.plugin.layout.state.showControls}})},r.toggleExpanded=function(){wt.Layout.Update(r.plugin,{state:{isExpanded:!r.plugin.layout.state.isExpanded}})},r.setSettings=function(n){var a;wt.Canvas3D.SetSettings(r.plugin,{settings:(a={},a[n.name]=n.value,a)})},r.setLayout=function(n){var a;wt.Layout.Update(r.plugin,{state:(a={},a[n.name]=n.value,a)})},r.screenshot=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download()},r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.toggle=function(r){var n=this;return function(a){var i;n.setState(E(E({},n.allCollapsedState),(i={},i[r]=!n.state[r],i))),a==null||a.currentTarget.blur()}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.icon=function(r,n,a,i){return i===void 0&&(i=!0),M.jsx(qt,{svg:r,toggleState:i,onClick:n,title:a,style:{background:"transparent"}},void 0)},t.prototype.render=function(){return M.jsxs("div",E({className:"msp-viewport-controls",onMouseMove:this.onMouseMove},{children:[M.jsxs("div",E({className:"msp-viewport-controls-buttons"},{children:[M.jsxs("div",{children:[M.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.icon(H_e,this.resetCamera,"Reset Camera")]},void 0),M.jsxs("div",{children:[M.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.icon(Z_e,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]},void 0),M.jsxs("div",{children:[M.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.plugin.config.get($r.Viewport.ShowControls)&&this.icon(X_e,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get($r.Viewport.ShowExpand)&&this.icon(Ewe,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),this.plugin.config.get($r.Viewport.ShowSettings)&&this.icon(jp,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded)]},void 0),this.plugin.config.get($r.Viewport.ShowSelectionMode)&&M.jsxs("div",{children:[M.jsx("div",{className:"msp-semi-transparent-background"},void 0),M.jsx(L_,{},void 0)]},void 0)]}),void 0),this.state.isScreenshotExpanded&&M.jsx("div",E({className:"msp-viewport-controls-panel"},{children:M.jsx(Cc,E({header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:Sc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:M.jsx(LZe,{close:this.toggleScreenshotExpanded},void 0)}),void 0)}),void 0),this.state.isSettingsExpanded&&M.jsx("div",E({className:"msp-viewport-controls-panel"},{children:M.jsx(Cc,E({header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:Sc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:M.jsx(UZe,{},void 0)}),void 0)}),void 0)]}),void 0)},t}(vr),HZe=function(){return M.jsx("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"},void 0)},GZe=function(){return M.jsx(DZe,{logo:HZe},void 0)},qZe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.region=function(r,n){return M.jsx("div",E({className:"msp-layout-region msp-layout-"+r},{children:M.jsx("div",E({className:"msp-layout-static"},{children:n}),void 0)}),void 0)},t.prototype.render=function(){return M.jsx(l3.Provider,E({value:this.props.plugin},{children:M.jsx(WZe,{},void 0)}),void 0)},t}(ze.Component);(function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return M.jsx(l3.Provider,E({value:this.props.plugin},{children:M.jsx("div",E({className:"msp-plugin"},{children:this.props.children}),void 0)}),void 0)},t})(ze.Component);var WZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onDrop=function(n){n.preventDefault();var a;if(n.dataTransfer.items){for(var i=0;i<n.dataTransfer.items.length;i++)if(n.dataTransfer.items[i].kind==="file"){a=n.dataTransfer.items[i].getAsFile();break}}else a=n.dataTransfer.files[0];if(a){var o=(a==null?void 0:a.name.toLowerCase())||"";(o.endsWith("molx")||o.endsWith("molj"))&&wt.State.Snapshots.OpenFile(r.plugin,{file:a})}},r.onDragOver=function(n){n.preventDefault()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.region=function(r,n){return M.jsx("div",E({className:"msp-layout-region msp-layout-"+r},{children:M.jsx("div",E({className:"msp-layout-static"},{children:n?M.jsx(n,{},void 0):null}),void 0)}),void 0)},Object.defineProperty(t.prototype,"layoutVisibilityClassName",{get:function(){var r,n,a=this.plugin.layout.state,i=(n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)!==null&&n!==void 0?n:{},o=[];return(i.top==="none"||!a.showControls||a.regionState.top==="hidden")&&o.push("msp-layout-hide-top"),i.left==="none"||!a.showControls||a.regionState.left==="hidden"?o.push("msp-layout-hide-left"):a.regionState.left==="collapsed"&&o.push("msp-layout-collapse-left"),(i.right==="none"||!a.showControls||a.regionState.right==="hidden")&&o.push("msp-layout-hide-right"),(i.bottom==="none"||!a.showControls||a.regionState.bottom==="hidden")&&o.push("msp-layout-hide-bottom"),o.join(" ")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutClassName",{get:function(){var r=this.plugin.layout.state,n=["msp-plugin-content"];return r.isExpanded?n.push("msp-layout-expanded"):n.push("msp-layout-standard","msp-layout-standard-"+r.controlsDisplay),n.join(" ")},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r,n,a,i,o=this.plugin.layout.state,s=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)||{},u=((a=(n=this.plugin.spec.components)===null||n===void 0?void 0:n.viewport)===null||a===void 0?void 0:a.view)||XZe;return M.jsx("div",E({className:"msp-plugin",onDrop:this.onDrop,onDragOver:this.onDragOver},{children:M.jsxs("div",E({className:this.layoutClassName},{children:[M.jsxs("div",E({className:this.layoutVisibilityClassName},{children:[this.region("main",u),o.showControls&&s.top!=="none"&&this.region("top",s.top||EZe),o.showControls&&s.left!=="none"&&this.region("left",s.left||pZe),o.showControls&&s.right!=="none"&&this.region("right",s.right||$Ze),o.showControls&&s.bottom!=="none"&&this.region("bottom",s.bottom||YZe)]}),void 0),!(!((i=this.plugin.spec.components)===null||i===void 0)&&i.hideTaskOverlay)&&M.jsx(TZe,{},void 0)]}),void 0)}),void 0)},t}(vr),$Ze=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.structureTools)||eZe;return M.jsx("div",E({className:"msp-scrollable-container"},{children:M.jsx(n,{},void 0)}),void 0)},t}(vr),XZe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n,a=((n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.viewport)===null||n===void 0?void 0:n.controls)||VZe;return M.jsxs(M.Fragment,{children:[M.jsx(GZe,{},void 0),M.jsxs("div",E({className:"msp-viewport-top-left-controls"},{children:[M.jsx(KQe,{},void 0),M.jsx(XQe,{},void 0),M.jsx(YQe,{},void 0)]}),void 0),M.jsx(QQe,{},void 0),M.jsx(a,{},void 0),M.jsx(PZe,{},void 0),M.jsxs("div",E({className:"msp-highlight-toast-wrapper"},{children:[M.jsx(ZQe,{},void 0),M.jsx(MZe,{},void 0)]}),void 0)]},void 0)},t}(vr),YZe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.wrapper=ze.createRef(),r.state={entries:r.plugin.log.entries},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.log,function(){return r.setState({entries:r.plugin.log.entries})})},t.prototype.componentDidUpdate=function(){this.scrollToBottom()},t.prototype.scrollToBottom=function(){var r=this.wrapper.current;r&&(r.scrollTop=r.scrollHeight-r.clientHeight-1)},t.prototype.render=function(){for(var r=10,n=this.state.entries,a=n.size,i=[],o=Math.max(0,a-r),s=0;o<a;o++){var u=n.get(o);i.push(M.jsxs("li",{children:[M.jsx("div",{className:"msp-log-entry-badge msp-log-entry-"+u.type},void 0),M.jsx("div",E({className:"msp-log-timestamp"},{children:pSe(u.timestamp)}),void 0),M.jsx("div",E({className:"msp-log-entry"},{children:u.message}),void 0)]},s++))}return M.jsx("div",E({ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"}},{children:M.jsx("ul",E({className:"msp-list-unstyled"},{children:i}),void 0)}),void 0)},t}(vr);function KZe(e,t,r,n){n===void 0&&(n=1),e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:t+"px",height:r+"px"})}function QZe(e,t,r){r===void 0&&(r=1);var n=window.innerWidth,a=window.innerHeight;t!==document.body&&(n=t.offsetWidth,a=t.offsetHeight),KZe(e,n,a,r)}function ZZe(e,t,r,n){for(var a=atob(e.toDataURL(r,n).split(",")[1]),i=a.length,o=i>>2,s=new Uint8Array(i),u=new Uint32Array(s.buffer,0,o),l=0,c=0;c<o;++c)u[c]=a.charCodeAt(l++)|a.charCodeAt(l++)<<8|a.charCodeAt(l++)<<16|a.charCodeAt(l++)<<24;for(var d=i&3;d--;)s[l]=a.charCodeAt(l++);t(new Blob([s],{type:r||"image/png"}))}function kz(e,t,r){return de(this,void 0,void 0,function(){return fe(this,function(n){return[2,new Promise(function(a,i){var o=function(s){s?a(s):i("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,r):ZZe(e,o,t,r)})]})})}var G_;(function(e){var t=function(){function r(){this.providers=ia.OrderedMap().asMutable(),this.defaultAutoAttachValues=new Map}return r.prototype.getParams=function(n){var a={},i=[],o=[];if(n)for(var s=this.providers.values();;){var u=s.next();if(u.done)break;var l=u.value;l.isApplicable(n)&&(l.isHidden||(i.push([l.descriptor.name,l.label]),this.defaultAutoAttachValues.get(l.descriptor.name)&&o.push(l.descriptor.name)),a[l.descriptor.name]=T.Group(E({},l.getParams(n)),{label:l.label,isHidden:l.isHidden}))}return{autoAttach:T.MultiSelect(o,i),properties:T.Group(a,{isFlat:!0})}},r.prototype.setDefaultAutoAttach=function(n,a){this.defaultAutoAttachValues.set(n,a)},r.prototype.get=function(n){var a=this.providers.get(n);if(!a)throw new Error("Custom property '"+n+"' is not registered.");return this.providers.get(n)},r.prototype.register=function(n,a){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,a)},r.prototype.unregister=function(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)},r}();e.Registry=t})(G_||(G_={}));var JZe=["gz","zip"],eJe=["bcif","ccp4","dcd"];function JO(e){var t,r,n="";e instanceof File?t=e.name:e instanceof Blob?t="":t=e;var a=t.lastIndexOf("?"),i=a!==-1?t.substring(a):"";t=t.substring(0,a===-1?t.length:a);var o=t.replace(/^.*[\\/]/,""),s=o.substring(0,o.lastIndexOf(".")),u=o.split("."),l=u.length>1?(u.pop()||"").toLowerCase():"",c=t.match(/^(.+):\/\/(.+)$/);c&&(n=c[1].toLowerCase(),t=c[2]||"");var d=t.substring(0,t.lastIndexOf("/")+1);if(JZe.includes(l)){r=l;var f=t.length-l.length-1;l=(t.substr(0,f).split(".").pop()||"").toLowerCase();var h=s.length-l.length-1;s=s.substr(0,h)}else r=!1;var v=eJe.includes(l);return{path:t,name:o,ext:l,base:s,dir:d,compressed:r,binary:v,protocol:n,query:i,src:e}}var tJe=function(){function e(t){this.plugin=t}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.rawData=function(t,r){var n=this.dataState.build().toRoot().apply(HK,t,r);return n.commit({revertOnError:!0})},e.prototype.download=function(t,r){var n=this.dataState.build().toRoot().apply(zK,t,r);return n.commit({revertOnError:!0})},e.prototype.downloadBlob=function(t,r){var n=this.dataState.build().toRoot().apply(VK,t,r);return n.commit({revertOnError:!0})},e.prototype.readFile=function(t,r){var n;return de(this,void 0,void 0,function(){var a,i;return fe(this,function(o){switch(o.label){case 0:return[4,this.dataState.build().toRoot().apply(GK,t,r).commit({revertOnError:!0})];case 1:return a=o.sent(),i=JO(((n=t.file)===null||n===void 0?void 0:n.file)||""),[2,{data:a,fileInfo:i}]}})})},e}(),rJe=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=Zm.auto,Uu(Zm,function(n){return r.registerPreset(n)})}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=Zm[t])!==null&&r!==void 0?r:sk(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name,i.display.group])}return T.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?T.Group(o.params(t,this.plugin)):T.EmptyGroup())}return r.length===0?T.MappedStatic("",{"":T.EmptyGroup()}):T.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Representation provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),H1(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i,o=this.resolveProvider(r);if(o){var s=this.plugin.state.data,u=La.resolveAndCheck(s,t);if(!u){Yg||console.warn("Applying structure repr. provider to bad cell.");return}var l=((i=o.params)===null||i===void 0?void 0:i.call(o,u.obj,this.plugin))||{},c=n||(o.params?T.getDefaultValues(l):{}),d=this.plugin.config.get($r.Structure.DefaultRepresentationPresetParams);c=T.merge(l,d,c);var f=et.create(""+o.display.name,function(){return o.apply(u,c,a.plugin)});return this.plugin.runTask(f)}},e.prototype.addRepresentation=function(t,r,n){return de(this,void 0,void 0,function(){var a,i;return fe(this,function(o){switch(o.label){case 0:return a=this.dataState.build(),i=this.buildRepresentation(a,t,r,n),i?[4,a.commit()]:[2];case 1:return o.sent(),[2,i]}})})},e.prototype.buildRepresentation=function(t,r,n,a){var i,o;if(r){var s=(o=(i=La.resolveAndCheck(this.dataState,r))===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data;if(s){var u=CS(this.plugin,s,n);return a!=null&&a.tag?t.to(r).applyOrUpdateTagged(a.tag,g_,u,{state:a==null?void 0:a.initialState}).selector:t.to(r).apply(g_,u,{state:a==null?void 0:a.initialState}).selector}}},e}();function oh(e){return e}(function(e){e.CommonParams=function(t,r){return{modelProperties:T.Optional(T.Group(vt.getParamDefinition(st.Model.CustomModelProperties,void 0,r))),structureProperties:T.Optional(T.Group(vt.getParamDefinition(st.Model.CustomStructureProperties,void 0,r))),representationPreset:T.Optional(T.Text("auto"))}}})(oh||(oh={}));var aE=oh.CommonParams,nJe=function(e,t){return E({model:T.Optional(T.Group(vt.getParamDefinition(st.Model.ModelFromTrajectory,e,t))),showUnitcell:T.Optional(T.Boolean(!1)),structure:T.Optional(wp.getParams(void 0,"assembly").type),representationPresetParams:T.Optional(T.Group(no.CommonParams))},aE(e,t))},xte=oh({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:function(e){return!0},params:nJe,apply:function(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c;return fe(this,function(d){switch(d.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return a=d.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=d.sent(),[4,n.createStructure(i||a,t.structure)];case 3:return o=d.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=d.sent(),t.showUnitcell===void 0||t.showUnitcell?[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})]:[3,6];case 5:return l=d.sent(),[3,7];case 6:l=void 0,d.label=7;case 7:return u=l,[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",t.representationPresetParams)];case 8:return c=d.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:c}]}})})}}),aJe=function(e,t){return E({useDefaultIfSingleModel:T.Optional(T.Boolean(!1)),representationPresetParams:T.Optional(T.Group(no.CommonParams))},aE(e,t))},iJe=oh({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by model-index."},isApplicable:function(e){return e.data.frameCount>1},params:aJe,apply:function(e,t,r){var n,a;return de(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:if(i=(a=(n=La.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data,!i)return[2,{}];if(i.frameCount===1&&t.useDefaultIfSingleModel)return[2,xte.apply(e,t,r)];o=r.builders.structure,s=[],u=[],l=0,p.label=1;case 1:return l<i.frameCount?[4,o.createModel(e,{modelIndex:l})]:[3,8];case 2:return c=p.sent(),[4,o.insertModelProperties(c,t.modelProperties,{isCollapsed:!0})];case 3:return d=p.sent(),[4,o.createStructure(d||c,{name:"model",params:{}})];case 4:return f=p.sent(),[4,o.insertStructureProperties(f,t.structureProperties)];case 5:return h=p.sent(),s.push(c),u.push(f),v=f.obj?BZ(f.obj.data,{elementCountFactor:i.frameCount}):"medium",[4,o.representation.applyPreset(h,t.representationPreset||"auto",{theme:{globalName:"model-index"},quality:v})];case 6:p.sent(),p.label=7;case 7:return l++,[3,1];case 8:return[2,{models:s,structures:u}]}})})}}),Ste=function(e,t){return E({model:T.Optional(T.Group(vt.getParamDefinition(st.Model.ModelFromTrajectory,e,t)))},aE(e,t))};function Cte(e,t,r,n){return de(this,void 0,void 0,function(){var a,i,o,s,u,l,c;return fe(this,function(d){switch(d.label){case 0:return a=n.builders.structure,[4,a.createModel(t,r.model)];case 1:return i=d.sent(),[4,a.insertModelProperties(i,r.modelProperties)];case 2:return o=d.sent(),[4,a.createStructure(o||i,{name:"symmetry",params:e})];case 3:return s=d.sent(),[4,a.insertStructureProperties(s,r.structureProperties)];case 4:return u=d.sent(),[4,a.tryCreateUnitcell(o,void 0,{isHidden:!1})];case 5:return l=d.sent(),[4,n.builders.structure.representation.applyPreset(u,r.representationPreset||"auto",{theme:{globalName:e.theme}})];case 6:return c=d.sent(),[2,{model:i,modelProperties:o,unitcell:l,structure:s,structureProperties:u,representation:c}]}})})}var oJe=oh({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:function(e){return Xt.hasCrystalSymmetry(e.data.representative)},params:Ste,apply:function(e,t,r){return de(this,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return[4,Cte({ijkMin:_.create(0,0,0),ijkMax:_.create(0,0,0)},e,t,r)];case 1:return[2,n.sent()]}})})}}),sJe=oh({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:function(e){return Xt.hasCrystalSymmetry(e.data.representative)},params:Ste,apply:function(e,t,r){return de(this,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return[4,Cte({ijkMin:_.create(-1,-1,-1),ijkMax:_.create(1,1,1),theme:"operator-hkl"},e,t,r)];case 1:return[2,n.sent()]}})})}}),uJe=function(e,t){return E({model:T.Optional(T.Group(vt.getParamDefinition(st.Model.ModelFromTrajectory,e,t)))},aE(e,t))},lJe=oh({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 Å, i.e., symmetry mates."},isApplicable:function(e){return Xt.hasCrystalSymmetry(e.data.representative)},params:uJe,apply:function(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return fe(this,function(c){switch(c.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return a=c.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=c.sent(),[4,n.createStructure(i||a,{name:"symmetry-mates",params:{radius:5}})];case 3:return o=c.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=c.sent(),[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})];case 5:return u=c.sent(),[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:sO.defaultValues}}}}})];case 6:return l=c.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:l}]}})})}}),CT={default:xte,"all-models":iJe,unitcell:oJe,supercell:sJe,crystalContacts:lJe},cJe=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=CT.default,Uu(CT,function(n){return r.registerPreset(n)})}return e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=CT[t])!==null&&r!==void 0?r:sk(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name])}return T.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?T.Group(o.params(t,this.plugin)):T.EmptyGroup())}return r.length===0?T.MappedStatic("",{"":T.EmptyGroup()}):T.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Hierarchy provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),H1(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i=this.resolveProvider(r);if(i){var o=this.plugin.state.data,s=La.resolveAndCheck(o,t);if(!s){Yg||console.warn("Applying hierarchy preset provider to bad cell.");return}var u=n||(i.params?T.getDefaultValues(i.params(s.obj,this.plugin)):{}),l=et.create(""+i.display.name,function(){return i.apply(s,u,a.plugin)});return this.plugin.runTask(l)}},e}(),dJe=function(){function e(t){this.plugin=t,this.hierarchy=new cJe(this.plugin),this.representation=new rJe(this.plugin)}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.parseTrajectoryData=function(t,r){return de(this,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:if(n=typeof r=="string"?this.plugin.dataFormats.get(r):r,!n)throw new Error("'"+r+"' is not a supported data format.");return[4,n.parse(this.plugin,t)];case 1:return a=i.sent().trajectory,[2,a]}})})},e.prototype.parseTrajectoryBlob=function(t,r){var n=this.dataState,a=n.build().to(t).apply(st.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(st.Model.TrajectoryFromBlob,void 0);return a.commit({revertOnError:!0})},e.prototype.parseTrajectory=function(t,r){var n=La.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return ge.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)},e.prototype.createModel=function(t,r,n){var a=this.dataState,i=a.build().to(t).apply(st.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n});return i.commit({revertOnError:!0})},e.prototype.insertModelProperties=function(t,r,n){var a=this.dataState,i=a.build().to(t).apply(st.Model.CustomModelProperties,r,{state:n});return i.commit({revertOnError:!0})},e.prototype.tryCreateUnitcell=function(t,r,n){var a,i,o,s=this.dataState,u=(i=(a=La.resolveAndCheck(s,t))===null||a===void 0?void 0:a.obj)===null||i===void 0?void 0:i.data;if(u){var l=(o=ca.Provider.get(u))===null||o===void 0?void 0:o.spacegroup.cell;if(!Io.isZero(l)){var c=s.build().to(t).apply(st.Representation.ModelUnitcell3D,r,{state:n});return c.commit({revertOnError:!0})}}},e.prototype.createStructure=function(t,r,n){var a,i=this.dataState;if(!r){var o=La.resolveAndCheck(i,t);if(o){var s=ca.Provider.get((a=o.obj)===null||a===void 0?void 0:a.data);(!s||(s==null?void 0:s.assemblies.length)===0)&&(r={name:"model",params:{}})}}var u=i.build().to(t).apply(st.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n});return u.commit({revertOnError:!0})},e.prototype.insertStructureProperties=function(t,r){var n=this.dataState,a=n.build().to(t).apply(st.Model.CustomStructureProperties,r);return a.commit({revertOnError:!0})},e.prototype.isComponentTransform=function(t){return t.transform.transformer===st.Model.StructureComponent},e.prototype.tryCreateComponent=function(t,r,n,a){var i,o;return de(this,void 0,void 0,function(){var s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:return s=this.dataState,u=s.build().to(t),l="structure-component-"+n,c=u.applyOrUpdateTagged(l,st.Model.StructureComponent,r,{tags:a?Ut(Ut([],a),[l]):[l]}),[4,c.commit()];case 1:return f.sent(),d=c.selector,!d.isOk||((o=(i=d.cell)===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data.elementCount)===0?[4,s.build().delete(d.ref).commit()]:[3,3];case 2:return f.sent(),[2];case 3:return[2,d]}})})},e.prototype.tryCreateComponentFromExpression=function(t,r,n,a){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:((a==null?void 0:a.label)||"").trim()},n,a==null?void 0:a.tags)},e.prototype.tryCreateComponentStatic=function(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:((n==null?void 0:n.label)||"").trim()},"static-"+r,n==null?void 0:n.tags)},e.prototype.tryCreateComponentFromSelection=function(t,r,n,a){var i=this;return this.plugin.runTask(et.create("Query Component",function(o){return de(i,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,g,m,y;return fe(this,function(b){switch(b.label){case 0:return s=a||{},u=s.label,l=s.tags,u=(u||"").trim(),c=(y=(m=La.resolveAndCheck(this.dataState,t))===null||m===void 0?void 0:m.obj)===null||y===void 0?void 0:y.data,c?r.referencesCurrent?(p={},g={name:"bundle"},v=(h=en).fromSelection,[4,r.getSelection(this.plugin,o,c)]):[3,2]:[2];case 1:return f=(p.type=(g.params=v.apply(h,[b.sent()]),g),p.nullIfEmpty=!0,p.label=u||r.label,p),[3,3];case 2:f={type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:u||r.label},b.label=3;case 3:return d=f,r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:this.plugin.managers.asset},c)]:[3,5];case 4:b.sent(),b.label=5;case 5:return[2,this.tryCreateComponent(t,d,n,l)]}})})}))},e}(),KD;(function(e){function t(r){var n=r.name;return{descriptor:r,get:function(a){return a._propertyData[n]},set:function(a,i){a.customProperties.add(r),a._propertyData[n]=i}}}e.create=t})(KD||(KD={}));var q_;(function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=KD.create(e.Descriptor)})(q_||(q_={}));var $b="Volume";function Xb(e,t){return de(this,void 0,void 0,function(){var r,n=this;return fe(this,function(a){return t?(r=t.entryId,!r||!r.toLowerCase().startsWith("emd")?[2]:[2,e.runTask(et.create("Try Set Recommended IsoValue",function(i){return de(n,void 0,void 0,function(){var o;return fe(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,Xee(e,i,r)];case 1:return o=s.sent(),q_.Provider.set(t,_t.IsoValue.absolute(o)),[3,3];case 2:return s.sent(),[3,3];case 3:return[2]}})})}))]):[2]})})}function _te(e){var t=q_.Provider.get(e);if(t){if(t.kind==="relative")return t;var r=e.grid.stats;return h_.is(e.sourceData)&&(r={min:e.sourceData.data.volume_data_3d_info.min_source.value(0),max:e.sourceData.data.volume_data_3d_info.max_source.value(0),mean:e.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:e.sourceData.data.volume_data_3d_info.sigma_source.value(0)}),_t.IsoValue.toRelative(t,r)}}function eL(e,t){return de(this,void 0,void 0,function(){var r,n,a;return fe(this,function(i){switch(i.label){case 0:return r={},n=t.volume.data&&_te(t.volume.data),n&&(r.isoValue=n),a=e.build().to(t.volume).apply(st.Representation.VolumeRepresentation3D,eg(e,t.volume.data,{type:"isosurface",typeParams:r})),[4,a.commit()];case 1:return[2,[i.sent()]]}})})}var fJe={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:$b,binaryExtensions:["ccp4","mrc","map"],parse:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(st.Data.ParseCcp4,{},{state:{isGhost:!0}}),a=n.apply(st.Volume.VolumeFromCcp4,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,Xb(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:eL},hJe={label:"DSN6/BRIX",description:"DSN6/BRIX",category:$b,binaryExtensions:["dsn6","brix"],parse:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(st.Data.ParseDsn6,{},{state:{isGhost:!0}}),a=n.apply(st.Volume.VolumeFromDsn6,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,Xb(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:eL},pJe={label:"DX",description:"DX",category:$b,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a;return fe(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(st.Data.ParseDx,{},{state:{isGhost:!0}}),a=n.apply(st.Volume.VolumeFromDx,{entryId:r==null?void 0:r.entryId}),[4,a.commit({revertOnError:!0})];case 1:return i.sent(),[4,Xb(e,a.selector.data)];case 2:return i.sent(),[2,{volume:a.selector}]}})})},visuals:eL},vJe={label:"Cube",description:"Cube",category:$b,stringExtensions:["cub","cube"],parse:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a,i;return fe(this,function(o){switch(o.label){case 0:return n=e.build().to(t).apply(st.Data.ParseCube,{},{state:{isGhost:!0}}),a=n.apply(st.Volume.VolumeFromCube,{entryId:r==null?void 0:r.entryId}),i=n.apply(st.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(st.Model.ModelFromTrajectory).apply(st.Model.StructureFromModel),[4,n.commit({revertOnError:!0})];case 1:return o.sent(),[4,Xb(e,a.selector.data)];case 2:return o.sent(),[2,{format:n.selector,volume:a.selector,structure:i.selector}]}})})},visuals:function(e,t){return de(void 0,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:return r=e.build(),n=[],a=(d=(c=t.volume.cell)===null||c===void 0?void 0:c.obj)===null||d===void 0?void 0:d.data,a&&_t.isOrbitals(a)?(i=r.to(t.volume).apply(st.Representation.VolumeRepresentation3D,eg(e,a,{type:"isosurface",typeParams:{isoValue:_t.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:dr.blue}})),o=r.to(t.volume).apply(st.Representation.VolumeRepresentation3D,eg(e,a,{type:"isosurface",typeParams:{isoValue:_t.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:dr.red}})),n.push(i.selector,o.selector)):(s=r.to(t.volume).apply(st.Representation.VolumeRepresentation3D,eg(e,a,{type:"isosurface",typeParams:{isoValue:_t.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:dr.grey}})),n.push(s.selector)),[4,e.builders.structure.representation.applyPreset(t.structure,"auto")];case 1:return u=f.sent(),[4,r.commit()];case 2:return f.sent(),l=[],Uu(u==null?void 0:u.representations,function(h){h&&l.push(h)}),[2,Ut(Ut([],n),l)]}})})}},mJe={label:"DensityServer CIF",description:"DensityServer CIF",category:$b,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return MO(e,t)==="dscif"},parse:function(e,t,r){return de(void 0,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:return[4,e.build().to(t).apply(st.Data.ParseCif).commit()];case 1:if(n=p.sent(),a=e.build().to(n),i=n.obj.data.blocks.slice(1),i.length!==1&&i.length!==2)throw new Error("unknown number of blocks");for(o=[],s=0,u=0,l=i;u<l.length;u++)c=l[u],d=Array.isArray(r==null?void 0:r.entryId)?r==null?void 0:r.entryId[s]:r==null?void 0:r.entryId,o.push(a.apply(st.Volume.VolumeFromDensityServerCif,{blockHeader:c.header,entryId:d}).selector),s++;return[4,a.commit()];case 2:p.sent(),f=0,h=o,p.label=3;case 3:return f<h.length?(v=h[f],[4,Xb(e,v.data)]):[3,6];case 4:p.sent(),p.label=5;case 5:return f++,[3,3];case 6:return[2,{volumes:o}]}})})},visuals:function(e,t){return de(void 0,void 0,void 0,function(){var r,n,a,i,o,s;return fe(this,function(u){switch(u.label){case 0:return r=t.volumes,n=e.build(),a=[],r.length>0&&(i=r[0].data&&_te(r[0].data)||_t.IsoValue.relative(1.5),a[0]=n.to(r[0]).apply(st.Representation.VolumeRepresentation3D,kc.getDefaultParamsStatic(e,"isosurface",{isoValue:i,alpha:1},"uniform",{value:dr.teal})).selector),r.length>1&&(o=kc.getDefaultParamsStatic(e,"isosurface",{isoValue:_t.IsoValue.relative(3),alpha:.3},"uniform",{value:dr.green}),s=kc.getDefaultParamsStatic(e,"isosurface",{isoValue:_t.IsoValue.relative(-3),alpha:.3},"uniform",{value:dr.red}),a[a.length]=n.to(r[1]).apply(st.Representation.VolumeRepresentation3D,o).selector,a[a.length]=n.to(r[1]).apply(st.Representation.VolumeRepresentation3D,s).selector),[4,n.commit()];case 1:return u.sent(),[2,a]}})})}},gJe=[["ccp4",fJe],["dsn6",hJe],["cube",vJe],["dx",pJe],["dscif",mJe]],yJe="Shape",bJe={label:"PLY",description:"PLY",category:yJe,stringExtensions:["ply"],parse:function(e,t){return de(void 0,void 0,void 0,function(){var r,n;return fe(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(st.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(st.Model.ShapeFromPly),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,shape:n.selector}]}})})},visuals:function(e,t){var r=e.state.data.build().to(t.shape).apply(st.Representation.ShapeRepresentation3D);return r.commit()}},xJe=[["ply",bJe]],tL="Structure",SJe={label:"PSF",description:"PSF",category:tL,stringExtensions:["psf"],parse:function(e,t){return de(void 0,void 0,void 0,function(){var r,n;return fe(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(st.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(st.Model.TopologyFromPsf),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},CJe={label:"DCD",description:"DCD",category:tL,binaryExtensions:["dcd"],parse:function(e,t){var r=e.state.data.build().to(t).apply(st.Model.CoordinatesFromDcd);return r.commit()}},_Je={label:"XTC",description:"XTC",category:tL,binaryExtensions:["xtc"],parse:function(e,t){var r=e.state.data.build().to(t).apply(st.Model.CoordinatesFromXtc);return r.commit()}},wJe=[["psf",SJe],["dcd",CJe],["xtc",_Je]],EJe=function(){function e(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(var t=0,r=gJe;t<r.length;t++){var n=r[t],a=n[0],i=n[1];this.add(a,i)}for(var o=0,s=wJe;o<s.length;o++){var u=s[o],a=u[0],i=u[1];this.add(a,i)}for(var l=0,c=xJe;l<c.length;l++){var d=c[l],a=d[0],i=d[1];this.add(a,i)}for(var f=0,h=Mee;f<h.length;f++){var v=h[f],a=v[0],i=v[1];this.add(a,i)}}return Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(t){return[t.name,t.provider.label]})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){if(this._extensions)return this._extensions;var t=new Set;return this._list.forEach(function(r){var n,a,i=r.provider;(n=i.stringExtensions)===null||n===void 0||n.forEach(function(o){return t.add(o)}),(a=i.binaryExtensions)===null||a===void 0||a.forEach(function(o){return t.add(o)})}),this._extensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryExtensions",{get:function(){if(this._binaryExtensions)return this._binaryExtensions;var t=new Set;return this._list.forEach(function(r){var n,a=r.provider;return(n=a.binaryExtensions)===null||n===void 0?void 0:n.forEach(function(i){return t.add(i)})}),this._binaryExtensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){if(this._options)return this._options;var t=[];return this._list.forEach(function(r){var n=r.name,a=r.provider;return t.push([n,a.label,a.category||""])}),this._options=t,t},enumerable:!1,configurable:!0}),e.prototype._clear=function(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0},e.prototype.add=function(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)},e.prototype.remove=function(t){this._clear(),this._list.splice(this._list.findIndex(function(r){return r.name===t}),1),this._map.delete(t)},e.prototype.auto=function(t,r){for(var n=0,a=this.list.length;n<a;++n){var i=this._list[n].provider,o=!1;if((i.binaryExtensions&&i.binaryExtensions.indexOf(t.ext)>=0||i.stringExtensions&&i.stringExtensions.indexOf(t.ext)>=0)&&(o=!0),o&&(!i.isApplicable||i.isApplicable(t,r.data)))return i}},e.prototype.get=function(t){if(this._map.has(t))return this._map.get(t);throw new Error("unknown data format name '"+t+"'")},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e}(),AJe=function(e){Be(t,e);function t(r){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=r,n.map=new Map,n._animations=[],n.currentTime=0,n._params=void 0,n.events={updated:n.ev(),applied:n.ev()},n.isStopped=!0,n.isApplying=!1,n}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._animations.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!1,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next()},t.prototype.triggerApply=function(){this.events.applied.next()},t.prototype.getParams=function(){return this._params||(this._params={current:T.Select(this._animations[0]&&this._animations[0].name,this._animations.map(function(r){return[r.name,r.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(r){if(!this.isEmpty){this.updateState({params:E(E({},this.state.params),r)});var n=this.map.get(this.state.params.current),a=n.params(this.context);this._current={anim:n,params:a,paramValues:T.getDefaultValues(a),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}},t.prototype.updateCurrentParams=function(r){this.isEmpty||(this._current.paramValues=E(E({},this._current.paramValues),r),this.triggerUpdate())},t.prototype.register=function(r){if(this.map.has(r.name)){this.context.log.error("Animation '"+r.name+"' is already registered.");return}this._params=void 0,this.map.set(r.name,r),this._animations.push(r),this._animations.length===1?this.updateParams({current:r.name}):this.triggerUpdate()},t.prototype.play=function(r,n){return de(this,void 0,void 0,function(){return fe(this,function(a){switch(a.label){case 0:return[4,this.stop()];case 1:return a.sent(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),[4,this.start()];case 2:return a.sent(),[2]}})})},t.prototype.tick=function(r,n){return de(this,void 0,void 0,function(){return fe(this,function(a){switch(a.label){case 0:return this.currentTime=r,this.isStopped?[2]:n?[4,this.applyFrame()]:[3,2];case 1:return a.sent(),[3,3];case 2:this.applyAsync(),a.label=3;case 3:return[2]}})})},t.prototype.start=function(){return de(this,void 0,void 0,function(){var r,n,a;return fe(this,function(i){switch(i.label){case 0:return this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate(),r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context),r.setup?[4,r.setup(this._current.paramValues,n,this.context)]:[3,2];case 1:a=i.sent(),a&&(n=a),i.label=2;case 2:return this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1,[2]}})})},t.prototype.stop=function(){return de(this,void 0,void 0,function(){var r;return fe(this,function(n){switch(n.label){case 0:return this.isStopped=!0,this.state.animationState==="stopped"?[3,3]:(r=this._current.anim,r.teardown?[4,r.teardown(this._current.paramValues,this._current.state,this.context)]:[3,2]);case 1:n.sent(),n.label=2;case 2:this.updateState({animationState:"stopped"}),this.triggerUpdate(),n.label=3;case 3:return this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1),[2]}})})},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return this.state.animationState==="playing"},enumerable:!1,configurable:!0}),t.prototype.applyAsync=function(){return de(this,void 0,void 0,function(){return fe(this,function(r){switch(r.label){case 0:if(this.isApplying)return[2];this.isApplying=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.applyFrame()];case 2:return r.sent(),[3,4];case 3:return this.isApplying=!1,[7];case 4:return[2]}})})},t.prototype.applyFrame=function(){return de(this,void 0,void 0,function(){var r,n;return fe(this,function(a){switch(a.label){case 0:return r=this.currentTime,this._current.startedTime<0&&(this._current.startedTime=r),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:r-this._current.startedTime},{params:this._current.paramValues,plugin:this.context})];case 1:return n=a.sent(),n.kind==="finished"?this.stop():n.kind==="next"&&(this._current.state=n.state,this._current.lastTime=r-this._current.startedTime),this.triggerApply(),[2]}})})},t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))},t.prototype.resume=function(){return de(this,void 0,void 0,function(){var r;return fe(this,function(n){switch(n.label){case 0:return this._current.lastTime=0,this._current.startedTime=-1,r=this._current.anim,this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup?[4,r.setup(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isStopped=!1,[2]}})})},t}(Ed),PJe={minRadius:5,extraRadius:4,durationMs:250},TJe=function(){function e(t){this.plugin=t,this.boundaryHelper=new ls("98")}return e.prototype.transformedLoci=function(t){var r,n;if(Oe.is(t)){var a=(n=(r=this.plugin.helpers.substructureParent.get(t.structure))===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;a&&(t=Oe.remap(t,a))}return t},e.prototype.focusRenderObjects=function(t,r){if(t){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=o.values.boundingSphere.ref.value;s.radius!==0&&n.push(s)}this.focusSpheres(n,function(u){return u},r)}},e.prototype.focusLoci=function(t,r){var n;if(Array.isArray(t)&&t.length>1){for(var a=[],i=0,o=t;i<o.length;i++){var s=o[i],u=or.getBoundingSphere(this.transformedLoci(s));u&&a.push(u)}if(a.length===0)return;this.boundaryHelper.reset();for(var l=0,c=a;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=or.getBoundingSphere(this.transformedLoci(t[0]))}else n=or.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)},e.prototype.focusSpheres=function(t,r,n){for(var a=[],i=0,o=t;i<o.length;i++){var s=o[i],u=r(s);u&&a.push(u)}if(a.length!==0){if(a.length===1)return this.focusSphere(a[0],n);this.boundaryHelper.reset();for(var l=0,c=a;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}this.focusSphere(this.boundaryHelper.getSphere(),n)}},e.prototype.focusSphere=function(t,r){var n,a,i,o,s=E(E({},PJe),r),u=s.extraRadius,l=s.minRadius,c=s.durationMs,d=Math.max(t.radius+u,l);if(r!=null&&r.principalAxes){var f=r==null?void 0:r.principalAxes.boxAxes,h=f.origin,v=f.dirA,p=f.dirC,g=(n=this.plugin.canvas3d)===null||n===void 0?void 0:n.camera.getFocus(h,d,v,p);(a=this.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({durationMs:c,snapshot:g})}else{var g=(i=this.plugin.canvas3d)===null||i===void 0?void 0:i.camera.getFocus(t.center,d);(o=this.plugin.canvas3d)===null||o===void 0||o.requestCameraReset({durationMs:c,snapshot:g})}},e.prototype.setSnapshot=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e.prototype.reset=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e}(),IJe=function(){function e(t){var r=this;this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider(function(n,a){r.mark(n,a),r.showLabels()})}return e.prototype.clearProviders=function(){this.providers=[],this.isDirty=!0,this.showLabels()},e.prototype.addProvider=function(t){this.providers.push(t),this.providers.sort(function(r,n){return(n.priority||0)-(r.priority||0)}),this.isDirty=!0,this.showLabels()},e.prototype.removeProvider=function(t){this.providers=this.providers.filter(function(r){return r!==t}),this.isDirty=!0,this.showLabels()},e.prototype.mark=function(t,r){var n=this.locis.findIndex(function(a){return sr.Loci.areEqual(t,a)});n===-1&&r===tr.Highlight?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===tr.RemoveHighlight&&(G1(this.locis,n),this.isDirty=!0)},e.prototype.showLabels=function(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})},e.prototype.getLabels=function(){var t=this;if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(var r=0,n=this.providers;r<n.length;r++)for(var a=n[r],i=0,o=this.locis;i<o.length;i++){var s=o[i];if(!or.isEmpty(s.loci)){var u=a.label(s.loci,s.repr);if(u){var l=a.group?a.group(u):u.toString(),c=this.groupedLabels.get(l);c?c.push(u):this.groupedLabels.set(l,[u])}}}this.labels.length=0,this.groupedLabels.forEach(function(d,f){var h=d.length,v=h>1&&d[0]!==d[1]?f:d[0];t.labels.push(h===1?v:v+" <small>|| × "+h+"</small>")}),this.isDirty=!1}return this.labels},e}(),MJe=8,DJe=function(e){Be(t,e);function t(r){var n=e.call(this,{history:[]})||this;n.plugin=r,n.events={historyUpdated:n.ev()},n.behaviors={current:n.ev.behavior(void 0)},r.state.data.events.object.removed.subscribe(function(i){var o,s,u=i.obj;if(ge.Molecule.Structure.is(u)){((s=n.current)===null||s===void 0?void 0:s.loci.structure)===u.data&&n.clear();for(var l=[],c=0,d=n.history;c<d.length;c++){var f=d[c];f.loci.structure===u.data&&l.push(f)}l.length!==n.history.length&&(n.history.length=0,(o=n.history).push.apply(o,l),n.events.historyUpdated.next())}});var a=je();return r.state.data.events.object.updated.subscribe(function(i){var o,s=i.oldData,u=i.obj,l=i.action;if(ge.Molecule.Structure.is(u)&&s!==u.data&&l==="in-place"){var c=n.state.current,d=u.data;if(c&&c.loci.structure===s){var f=Oe.remap(c.loci,d);n.state.current=E(E({},c),{loci:f}),n.behaviors.current.next(n.state.current),or.getBoundingSphere(f,a);var h=(o=n.plugin.canvas3d)===null||o===void 0?void 0:o.camera,v=h.getTargetDistance(a.radius+4);(_.distance(h.target,a.center)>a.radius||v>h.viewport.height/h.zoom)&&n.plugin.managers.camera.focusSphere(a,{durationMs:0})}}}),n}return Object.defineProperty(t.prototype,"current",{get:function(){return this.state.current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this.state.history},enumerable:!1,configurable:!0}),t.prototype.tryAddHistory=function(r){if(!Oe.isEmpty(r.loci)){for(var n=0,a=void 0,i=0,o=this.state.history;i<o.length;i++){var s=o[i];if(Oe.areEqual(s.loci,r.loci)){a=s;break}n++}if(a){G1(this.state.history,n),this.state.history.unshift(r),this.events.historyUpdated.next();return}this.state.history.unshift(r),this.state.history.length>MJe&&this.state.history.pop(),this.events.historyUpdated.next()}},t.prototype.set=function(r){this.tryAddHistory(r),(!this.state.current||!Oe.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))},t.prototype.setFromLoci=function(r){var n=or.normalize(r);if(!Oe.is(n)||Oe.isEmpty(n)){this.clear();return}this.set({loci:n,label:ih(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})})},t.prototype.addFromLoci=function(r){var n=this.state.current&&Oe.is(r)&&r.structure===this.state.current.loci.structure?Oe.union(r,this.state.current.loci):r;this.setFromLoci(n)},t.prototype.clear=function(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))},t.prototype.getSnapshot=function(){if(!this.current)return{};var r=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=r==null?void 0:r.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:en.fromLoci(this.current.loci),category:this.current.category}}:{}},t.prototype.setSnapshot=function(r){var n,a;if(!r.current){this.clear();return}var i=r.current,o=i.label,s=i.ref,u=i.bundle,l=i.category,c=(a=(n=this.plugin.state.data.select(ir.Generators.byRef(s))[0])===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(c){var d=en.toLoci(u,c);this.set({label:o,loci:d,category:l})}},t}(Ed),Q0=new ls("98"),RJe=24,kJe=function(e){Be(t,e);function t(r){var n=e.call(this,{entries:new Map,additionsHistory:[],stats:OJe()})||this;return n.plugin=r,n.events={changed:n.ev(),additionsHistoryUpdated:n.ev(),loci:{add:n.ev(),remove:n.ev(),clear:n.ev()}},r.helpers.substructureParent.events.removed.subscribe(function(a){return n.onRemove(a.ref,a.obj)}),r.helpers.substructureParent.events.updated.subscribe(function(a){return n.onUpdate(a.ref,a.oldObj,a.obj)}),n}return Object.defineProperty(t.prototype,"entries",{get:function(){return this.state.entries},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"additionsHistory",{get:function(){return this.state.additionsHistory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)},enumerable:!1,configurable:!0}),t.prototype.getEntry=function(r){var n=this.plugin.helpers.substructureParent.get(r,!0);if(n){var a=n.transform.ref;if(!this.entries.has(a)){var i=new QD(Oe(r,[]));return this.entries.set(a,i),i}return this.entries.get(a)}},t.prototype.calcStats=function(){var r=0,n=0,a=Ef.create();this.entries.forEach(function(o){var s=o.selection.elements;if(s.length){r+=1;for(var u=0,l=s.length;u<l;++u)n+=Fe.size(s[u].indices);Ef.add(a,a,Ef.ofLoci(o.selection))}});var i=m_(a,{countsOnly:!0});return{structureCount:r,elementCount:n,label:i}},t.prototype.add=function(r){if(!Oe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Oe.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!Oe.areEqual(a,n.selection)},t.prototype.remove=function(r){if(!Oe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Oe.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!Oe.areEqual(a,n.selection)},t.prototype.intersect=function(r){if(!Oe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Oe.intersect(n.selection,r),this.referenceLoci=r,!Oe.areEqual(a,n.selection)},t.prototype.set=function(r){if(!Oe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!Oe.areEqual(a,n.selection)},t.prototype.modifyHistory=function(r,n,a,i){i===void 0&&(i=!1);var o=this.additionsHistory,s=o.indexOf(r);if(!(s<0)){var u=void 0;switch(n){case"remove":G1(o,s);break;case"up":u=s-1;break;case"down":u=s+1;break}if(u!==void 0)for(var l=a?Math.min(o.length,a):o.length;;)if(u=u%l,u<0&&(u+=l),!i||o[s].loci.structure===o[u].loci.structure){var c=o[s];o[s]=o[u],o[u]=c;break}else u+=n==="up"?-1:1;this.events.additionsHistoryUpdated.next()}},t.prototype.tryAddHistory=function(r){if(!or.isEmpty(r)){for(var n=0,a=void 0,i=0,o=this.additionsHistory;i<o.length;i++){var s=o[i];if(or.areEqual(s.loci,r)){a=s;break}n++}if(a){G1(this.additionsHistory,n),this.additionsHistory.unshift(a),this.events.additionsHistoryUpdated.next();return}var u=Ef.ofLoci(r),l=m_(u,{reverse:!0});this.additionsHistory.unshift({id:pn.create22(),loci:r,label:l}),this.additionsHistory.length>RJe&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next()}},t.prototype.clearHistory=function(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next())},t.prototype.clearHistoryForStructure=function(r){for(var n=[],a=0,i=this.state.additionsHistory;a<i.length;a++){var o=i[a];o.loci.structure.root===r.root&&n.push(o)}for(var s=0,u=n;s<u.length;s++){var o=u[s];this.modifyHistory(o,"remove")}n.length!==0&&this.events.additionsHistoryUpdated.next()},t.prototype.onRemove=function(r,n){var a;this.entries.has(r)&&(this.entries.delete(r),n!=null&&n.data&&this.clearHistoryForStructure(n.data),((a=this.referenceLoci)===null||a===void 0?void 0:a.structure)===(n==null?void 0:n.data)&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next())},t.prototype.onUpdate=function(r,n,a){var i,o,s,u;if(!(n===a||(n==null?void 0:n.data)===a.data)){var l=this.plugin.helpers.substructureParent.get(a.data,!0);if(l&&(r=l.transform.ref,!!this.entries.has(r))){var c=(o=(i=this.plugin.helpers.substructureParent.get(a.data))===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data;if(c)if(!(n!=null&&n.data)||tt.areUnitIdsAndIndicesEqual(n.data,a.data)){this.entries.set(r,LJe(this.entries.get(r),c)),((s=this.referenceLoci)===null||s===void 0?void 0:s.structure.root)===c.root&&(this.referenceLoci=Oe.remap(this.referenceLoci,c));for(var d=!1,f=0,h=this.state.additionsHistory;f<h.length;f++){var v=h[f];v.loci.structure.root===c.root&&(v.loci=Oe.remap(v.loci,c),d=!0)}d&&this.events.additionsHistoryUpdated.next()}else this.entries.set(r,new QD(Oe(c,[]))),((u=this.referenceLoci)===null||u===void 0?void 0:u.structure.root)===c.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(c),this.state.stats=void 0,this.events.changed.next()}}},t.prototype.clear=function(){for(var r=this.entries.keys(),n=[];;){var a=r.next();if(a.done)break;var i=this.entries.get(a.value);Oe.isEmpty(i.selection)||n.push(i.selection),i.selection=Oe(i.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(),this.events.loci.clear.next(),this.clearHistory(),n},t.prototype.getLoci=function(r){var n=this.getEntry(r);return n?n.selection:Or},t.prototype.getStructure=function(r){var n=this.getEntry(r);if(n)return n.structure},t.prototype.structureHasSelection=function(r){var n,a,i=(a=(n=r.cell)===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!i)return!1;var o=this.getEntry(i);return!!o&&!Oe.isEmpty(o.selection)},t.prototype.has=function(r){if(Oe.is(r)){var n=this.getEntry(r.structure);if(n)return Oe.isSubset(n.selection,r)}return!1},t.prototype.tryGetRange=function(r){if(Oe.is(r)&&r.elements.length===1){var n=this.getEntry(r.structure);if(n){var a=r.elements[0];if(a){var i=this.referenceLoci;if(!(!i||!Oe.is(i)||i.structure!==r.structure)){for(var o,s=0,u=i.elements;s<u.length;s++){var l=u[s];if(a.unit===l.unit){o=l;break}}if(o&&a.unit===o.unit)return NJe(r.structure,o,a)}}}}},t.prototype.elementCount=function(){var r=0;return this.entries.forEach(function(n){r+=Oe.size(n.selection)}),r},t.prototype.getBoundary=function(){var r=_.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=_.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);Q0.reset();var a=[];this.entries.forEach(function(c){var d=c.selection;Oe.isEmpty(d)||a.push(Oe.getBoundary(d))});for(var i=0,o=a.length;i<o;++i){var s=a[i],u=s.box,l=s.sphere;_.min(r,r,u.min),_.max(n,n,u.max),Q0.includePositionRadius(l.center,l.radius)}Q0.finishedIncludeStep();for(var i=0,o=a.length;i<o;++i){var l=a[i].sphere;Q0.radiusPositionRadius(l.center,l.radius)}return{box:{min:r,max:n},sphere:Q0.getSphere()}},t.prototype.getPrincipalAxes=function(){var r=this.elementCount(),n=new Float32Array(3*r),a=0;return this.entries.forEach(function(i){Oe.toPositionsArray(i.selection,n,a),a+=Oe.size(i.selection)*3}),Wp.ofPositions(n)},t.prototype.modify=function(r,n){var a=!1;switch(r){case"add":a=this.add(n);break;case"remove":a=this.remove(n);break;case"intersect":a=this.intersect(n);break;case"set":a=this.set(n);break}a&&(this.state.stats=void 0,this.events.changed.next())},Object.defineProperty(t.prototype,"applicableStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(function(r){return!!r.cell.obj}).map(function(r){return r.cell.obj.data})},enumerable:!1,configurable:!0}),t.prototype.triggerInteraction=function(r,n,a){switch(a===void 0&&(a=!0),r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},a);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},a);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},a);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},a);break}},t.prototype.fromLoci=function(r,n,a){a===void 0&&(a=!0),this.triggerInteraction(r,n,a)},t.prototype.fromCompiledQuery=function(r,n,a){a===void 0&&(a=!0);for(var i=0,o=this.applicableStructures;i<o.length;i++){var s=o[i],u=n(new as(s));this.triggerInteraction(r,yt.toLociWithSourceUnits(u),a)}},t.prototype.fromSelectionQuery=function(r,n,a){var i=this;a===void 0&&(a=!0),this.plugin.runTask(et.create("Structure Selection",function(o){return de(i,void 0,void 0,function(){var s,u,l,c;return fe(this,function(d){switch(d.label){case 0:s=0,u=this.applicableStructures,d.label=1;case 1:return s<u.length?(l=u[s],[4,n.getSelection(this.plugin,o,l)]):[3,4];case 2:c=d.sent(),this.triggerInteraction(r,yt.toLociWithSourceUnits(c),a),d.label=3;case 3:return s++,[3,1];case 4:return[2]}})})}))},t.prototype.fromSelections=function(r){var n,a=La.resolveAndCheck(this.plugin.state.data,r);if(!(!a||!a.obj)){if(!ge.Molecule.Structure.Selections.is(a.obj)){console.warn("fromSelections applied to wrong object type.",a.obj);return}this.clear();for(var i=0,o=(n=a.obj)===null||n===void 0?void 0:n.data;i<o.length;i++){var s=o[i];this.fromLoci("set",s.loci)}}},t}(Ed);function OJe(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var QD=function(){function e(t){this._structure=void 0,this._selection=t}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t,this._structure=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"structure",{get:function(){return this._structure?this._structure:(or.isEmpty(this._selection)?this._structure=void 0:this._structure=Oe.toStructure(this._selection),this._structure)},enumerable:!1,configurable:!0}),e}();function LJe(e,t){return new QD(Oe.remap(e.selection,t))}function NJe(e,t,r){var n=Math.min(Fe.min(t.indices),Fe.min(r.indices)),a=Math.max(Fe.max(t.indices),Fe.max(r.indices));return Oe(e,[{unit:t.unit,indices:Fe.ofRange(n,a)}])}var FJe=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],_T=[["full","Full"],["hidden","Hidden"]],BJe={isExpanded:T.Boolean(!1),showControls:T.Boolean(!0),regionState:T.Group({left:T.Select("full",FJe),top:T.Select("full",_T),right:T.Select("full",_T),bottom:T.Select("full",_T)}),controlsDisplay:T.Value("outside",{isHidden:!0})},UJe=function(e){Be(t,e);function t(r){var n=e.call(this,E(E({},T.getDefaultValues(BJe)),r.spec.layout&&r.spec.layout.initial))||this;return n.context=r,n.events={updated:n.ev()},n.rootState=void 0,wt.Layout.Update.subscribe(r,function(a){return n.updateProps(a.state)}),typeof document<"u"&&(n.expandedViewport=document.createElement("meta"),n.expandedViewport.name="viewport",n.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),n}return t.prototype.updateProps=function(r){var n=!!this.state.isExpanded;this.updateState(r),this.root&&typeof r.isExpanded=="boolean"&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next()},t.prototype.setProps=function(r){this.updateState(r)},t.prototype.setRoot=function(r){this.root=r,this.state.isExpanded&&this.handleExpand()},t.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},t.prototype.handleExpand=function(){try{var r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){for(var a=n.children,i=[],o=!1,s=0;s<a.length;s++)a[s]===this.expandedViewport?o=!0:(a[s].name||"").toLowerCase()==="viewport"&&i.push(a[s]);for(var u=0,l=i;u<l.length;u++){var c=l[u];n.removeChild(c)}o||n.appendChild(this.expandedViewport);var d=r.style,f=this.getScrollElement(),h=f.scrollLeft,v=f.scrollTop;this.rootState={top:d.top,bottom:d.bottom,right:d.right,left:d.left,scrollTop:v,scrollLeft:h,position:d.position,overflow:d.overflow,viewports:i,zIndex:this.root.style.zIndex,width:d.width,height:d.height,maxWidth:d.maxWidth,maxHeight:d.maxHeight,margin:d.margin,marginLeft:d.marginLeft,marginRight:d.marginRight,marginTop:d.marginTop,marginBottom:d.marginBottom},d.overflow="hidden",d.position="fixed",d.top="0",d.bottom="0",d.right="0",d.left="0",d.width="100%",d.height="100%",d.maxWidth="100%",d.maxHeight="100%",d.margin="0",d.marginLeft="0",d.marginRight="0",d.marginTop="0",d.marginBottom="0"}else{for(var a=n.children,s=0;s<a.length;s++)if(a[s]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){for(var p=this.rootState,g=0,m=p.viewports;g<m.length;g++){var c=m[g];n.appendChild(c)}var d=r.style;d.top=p.top,d.bottom=p.bottom,d.left=p.left,d.right=p.right,d.width=p.width,d.height=p.height,d.maxWidth=p.maxWidth,d.maxHeight=p.maxHeight,d.margin=p.margin,d.marginLeft=p.marginLeft,d.marginRight=p.marginRight,d.marginTop=p.marginTop,d.marginBottom=p.marginBottom,d.position=p.position,d.overflow=p.overflow||"";var f=this.getScrollElement();f.scrollTop=p.scrollTop,f.scrollLeft=p.scrollLeft,this.rootState=void 0,this.root.style.zIndex=p.zIndex}}}catch(b){var y="Layout change error, you might have to reload the page.";this.context.log.error(y),console.error(y,b)}},t}(Ed),rL={includeTypes:T.MultiSelect(N3(Nr.Names),T.objectToOptions(Nr.Names)),excludeTypes:T.MultiSelect([],T.objectToOptions(Nr.Names)),ignoreHydrogens:T.Boolean(!1),aromaticBonds:T.Boolean(!1,{description:"Display aromatic bonds with dashes"})};T.getDefaultValues(rL);var nL=E(E(E({},Cv),rL),{adjustCylinderLength:T.Boolean(!0,{description:"Shorten cylinders to reduce overlap with spheres."})});T.getDefaultValues(nL);var aL=E(E({},kJ),rL);T.getDefaultValues(aL);function wte(e,t,r){return!Nr.is(e,r)||Nr.is(t,r)}function Ete(e,t,r){var n=t.elements,a=t.model.atomicHierarchy.derived.atom.atomicNumber,i=t.bonds,o=i.a,s=i.b,u=i.edgeProps,l=u.flags,c=r.ignoreHydrogens,d=r.includeTypes,f=r.excludeTypes,h=Nr.fromNames(d),v=Nr.fromNames(f),p=Nr.isAll(h)&&v===0,g=e.child,m=g==null?void 0:g.unitMap.get(t.id);if(g&&!m)throw new Error("expected childUnit to exist if child exists");if(!(p&&!c&&!g))return function(y){return!!m&&!it.has(m.elements,n[o[y]])||c&&(b_(a,n[o[y]])||b_(a,n[s[y]]))||!p&&wte(h,v,l[y])}}function Ate(e,t){var r=e.interUnitBonds,n=r.edges,a=t.ignoreHydrogens,i=t.includeTypes,o=t.excludeTypes,s=Nr.fromNames(i),u=Nr.fromNames(o),l=Nr.isAll(s)&&u===0,c=e.child;if(!(l&&!a&&!c))return function(d){if(c){var f=n[d],h=c.unitMap.get(f.unitA);if(!h)return!0;var v=e.unitMap.get(f.unitA),p=v.elements[f.indexA];if(!it.has(h.elements,p))return!0}if(a){var f=n[d],g=e.unitMap.get(f.unitA),m=e.unitMap.get(f.unitB);if(y_(g,g.elements[f.indexA])||y_(m,m.elements[f.indexB]))return!0}return!!(!l&&wte(s,u,n[d].props.flag))}}var sh;(function(e){function t(n){var a=n.group,i=n.structure,o=a.units[0],s=We.isAtomic(o)?o.bonds.edgeCount*2:0,u=a.units.length,l=Gt.Location(i,void 0,void 0,i,void 0,void 0),c=function(d,f){var h=a.units[f];return l.aUnit=h,l.bUnit=h,l.aIndex=h.bonds.a[d],l.bIndex=h.bonds.b[d],l};return bn(s,u,1,c)}e.fromGroup=t;function r(n){var a=n.interUnitBonds.edgeCount,i=1,o=Gt.Location(n,void 0,void 0,n,void 0,void 0),s=function(u){var l=n.interUnitBonds.edges[u];return o.aUnit=n.unitMap.get(l.unitA),o.aIndex=l.indexA,o.bUnit=n.unitMap.get(l.unitB),o.bIndex=l.indexB,o};return bn(a,i,1,s,!0)}e.fromStructure=r})(sh||(sh={}));function iL(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(We.isAtomic(u)){var l=o.target,c=u.bonds.a[i],d=u.bonds.b[i];return Gt.Loci(l,[Gt.Location(l,u,c,l,u,d),Gt.Location(l,u,d,l,u,c)])}}return Or}function oL(e,t,r,n){var a=!1;if(Gt.isLoci(e)){var i=t.structure,o=t.group;if(!tt.areEquivalent(e.structure,i))return!1;var s=o.units[0];if(!We.isAtomic(s))return!1;for(var u=s.bonds.edgeCount*2,l=0,c=e.bonds;l<c.length;l++){var d=c[l];if(d.aUnit===d.bUnit){var f=o.unitIndexMap.get(d.aUnit.id);if(f!==void 0){var h=s.bonds.getDirectedEdgeIndex(d.aIndex,d.bIndex);h!==-1&&r(Re.ofSingleton(f*u+h))&&(a=!0)}}}}else if(Oe.is(e)){var i=t.structure,o=t.group;if(!tt.areEquivalent(e.structure,i))return!1;var s=o.units[0];if(!We.isAtomic(s))return!1;for(var v=s.bonds.edgeCount*2,p=function(C){var w=o.unitIndexMap.get(C.unit.id);if(w!==void 0){var A=s.bonds,I=A.offset,D=A.b;Fe.forEach(C.indices,function(k){for(var R=I[k],L=I[k+1];R<L;R++)(!n||Fe.has(C.indices,D[R]))&&r(Re.ofSingleton(w*v+R))&&(a=!0)})}},g=0,m=e.elements;g<m.length;g++){var y=m[g];p(y)}}return a}function sL(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.target,o=t.interUnitBonds.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Gt.Loci(i,[Gt.Location(i,s,o.indexA,i,u,o.indexB),Gt.Location(i,u,o.indexB,i,s,o.indexA)])}return Or}function uL(e,t,r,n){var a=!1;if(Gt.isLoci(e)){if(!tt.areEquivalent(e.structure,t))return!1;for(var i=0,o=e.bonds;i<o.length;i++){var s=o[i],u=t.interUnitBonds.getBondIndexFromLocation(s);u!==-1&&r(Re.ofSingleton(u))&&(a=!0)}}else if(Oe.is(e)){if(!tt.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(var l=new Map,c=0,d=e.elements;c<d.length;c++){var f=d[c];l.set(f.unit.id,f.indices)}for(var h=function(g){var m=g.unit;if(!We.isAtomic(m))return"continue";t.interUnitBonds.getConnectedUnits(m.id).forEach(function(y){var b=l.get(y.unitB);(!n||b)&&Fe.forEach(g.indices,function(S){y.connectedIndices.includes(S)&&y.getEdges(S).forEach(function(x){if(!n||b&&Fe.has(b,x.indexB)){var C=t.interUnitBonds.getEdgeIndex(S,m.id,x.indexB,y.unitB);r(Re.ofSingleton(C))&&(a=!0)}})})})},v=0,p=e.elements;v<p.length;v++){var f=p[v];h(f)}}return a}var wT=Nr.is;function Pte(e,t,r,n){var a=e.elements,i=e.bonds,o=i.edgeCount,s=i.a,u=i.b,l=i.edgeProps,c=i.offset,d=l.order,f=l.flags,h=n.sizeFactor,v=n.sizeAspectRatio,p=n.adjustCylinderLength,g=n.aromaticBonds,m=_(),y=_(),b=e.conformation.invariantPosition,S,x=at.create(t,e),C=Gt.Location(t,e,void 0,t,e,void 0),w=t.child;if(n.includeParent&&w){var A=w.unitMap.get(e.id);if(!A)throw new Error("expected childUnit to exist");S=function(B){var j=a[s[B]],Q=a[u[B]];return it.has(A.elements,j)&&!it.has(A.elements,Q)}}var I=function(B){return C.aIndex=s[B],C.bIndex=u[B],r.size.size(C)*h},D=function(B){return x.element=a[s[B]],r.size.size(x)*h},k=function(B){return x.element=a[u[B]],r.size.size(x)*h},R=e.rings,L=R.elementRingIndices,H=R.elementAromaticRingIndices;return{linkCount:o*2,referencePosition:function(B){var j,Q,G=s[B],W=u[B];G>W&&(j=[W,G],G=j[0],W=j[1]),c[G+1]-c[G]===1&&(Q=[W,G],G=Q[0],W=Q[1]);for(var q=L.get(G),J=0,he=c[G],$=c[G+1];he<$;++he){var X=u[he];if(X!==W&&X!==G)if(q){var U=L.get(X);if(!U)continue;var z=jC(q,U);z>J&&(J=z,b(a[X],m))}else return b(a[X],m)}return J>0?m:null},position:function(B,j,Q){if(b(a[s[Q]],B),b(a[u[Q]],j),p){var G=D(Q),W=k(Q),q=Math.min(G,W)*v,J=Math.sqrt(Math.max(0,G*G-q*q))-.05,he=Math.sqrt(Math.max(0,W*W-q*q))-.05;if(J<=.01&&he<=.01)return;_.normalize(y,_.sub(y,j,B)),_.scaleAndAdd(B,B,y,J),_.scaleAndAdd(j,j,y,-he)}},style:function(B){var j=d[B],Q=f[B];if(wT(Q,2)||wT(Q,4))return 1;if(j===3)return 3;if(g){var G=s[B],W=u[B],q=H.get(G),J=H.get(W),he=q&&J?jC(q,J):0;if(he||wT(Q,16))return he===2?6:5}return j===2?2:0},radius:function(B){return I(B)*v},ignore:Ete(t,e,n),stub:S}}function jJe(e,t,r,n,a,i){if(!We.isAtomic(t)||!t.bonds.edgeCount)return Ko.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Ko.createEmpty(i);var u=Pte(t,r,n,a),l=OJ(e,u,a,i),c=je.expand(je(),(s??t).boundary.sphere,1*a.sizeFactor);return l.setBoundingSphere(c),l}function zJe(e,t,r,n,a,i){if(!We.isAtomic(t)||!t.bonds.edgeCount)return Ft.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Ft.createEmpty(i);var u=Pte(t,r,n,a),l=_v(e,u,a,i),c=je.expand(je(),(s??t).boundary.sphere,1*a.sizeFactor);return l.setBoundingSphere(c),l}var iE=E(E(E(E({},Ci),SJ),nL),{sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:T.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:T.Boolean(!0),includeParent:T.Boolean(!1)});function Tte(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?VJe(e):HJe(e)}function VJe(e){return CJ({defaultProps:T.getDefaultValues(iE),createGeometry:jJe,createLocationIterator:sh.fromGroup,getLoci:iL,eachLocation:oL,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!to(r.includeTypes,n.includeTypes)||!to(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];We.isAtomic(u)&&We.isAtomic(l)&&(To.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function HJe(e){return oo({defaultProps:T.getDefaultValues(iE),createGeometry:zJe,createLocationIterator:sh.fromGroup,getLoci:iL,eachLocation:oL,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!to(r.includeTypes,n.includeTypes)||!to(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];We.isAtomic(u)&&We.isAtomic(l)&&(To.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var ET=new Gt.ElementBondIterator;function Oz(e,t,r,n){for(ET.setElement(t,r,n);ET.hasNext;){var a=ET.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}var Lz=_();function Ite(e,t,r){var n=at.create(e),a=Gt.Location(e,void 0,void 0,e,void 0,void 0),i=e.interUnitBonds,o=i.edgeCount,s=i.edges,u=r.sizeFactor,l=r.sizeAspectRatio,c=r.adjustCylinderLength,d=r.aromaticBonds,f=_(),h,v=e.child;r.includeParent&&v&&(h=function(y){var b=s[y],S=v.unitMap.get(b.unitA),x=v.unitMap.get(b.unitB),C=e.unitMap.get(b.unitA),w=C.elements[b.indexA],A=e.unitMap.get(b.unitB),I=A.elements[b.indexB];return S&&it.has(S.elements,w)&&(!x||!it.has(x.elements,I))});var p=function(y){var b=s[y];return a.aUnit=e.unitMap.get(b.unitA),a.aIndex=b.indexA,a.bUnit=e.unitMap.get(b.unitB),a.bIndex=b.indexB,t.size.size(a)*u},g=function(y){var b=s[y];return n.unit=e.unitMap.get(b.unitA),n.element=n.unit.elements[b.indexA],t.size.size(n)*u},m=function(y){var b=s[y];return n.unit=e.unitMap.get(b.unitB),n.element=n.unit.elements[b.indexB],t.size.size(n)*u};return{linkCount:o,referencePosition:function(y){var b=s[y],S,x,C,w;if(b.unitA<b.unitB)S=e.unitMap.get(b.unitA),x=e.unitMap.get(b.unitB),C=b.indexA,w=b.indexB;else if(b.unitA>b.unitB)S=e.unitMap.get(b.unitB),x=e.unitMap.get(b.unitA),C=b.indexB,w=b.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return Oz(Lz,e,S,C)||Oz(Lz,e,x,w)},position:function(y,b,S){var x=s[S],C=e.unitMap.get(x.unitA),w=e.unitMap.get(x.unitB);if(C.conformation.position(C.elements[x.indexA],y),w.conformation.position(w.elements[x.indexB],b),c){var A=g(S),I=m(S),D=Math.min(A,I)*l,k=Math.sqrt(Math.max(0,A*A-D*D))-.05,R=Math.sqrt(Math.max(0,I*I-D*D))-.05;if(k<=.01&&R<=.01)return;_.normalize(f,_.sub(f,b,y)),_.scaleAndAdd(y,y,f,k),_.scaleAndAdd(b,b,f,-R)}},style:function(y){var b=s[y].props.order,S=mi.create(s[y].props.flag);return Nr.is(S,2)||Nr.is(S,4)?1:b===3?3:d&&Nr.is(S,16)?5:b===2?2:0},radius:function(y){return p(y)*l},ignore:Ate(e,r),stub:h}}function GJe(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return Ko.createEmpty(a);var i=Ite(t,r,n),o=OJ(e,i,n,a),s=t.child,u=je.expand(je(),(s??t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}function qJe(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return Ft.createEmpty(a);var i=Ite(t,r,n),o=_v(e,i,n,a),s=t.child,u=je.expand(je(),(s??t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}var oE=E(E(E(E({},Ub),Wze),nL),{sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:T.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:T.Boolean(!0),includeParent:T.Boolean(!1)});function Mte(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?WJe(e):$Je(e)}function WJe(e){return $ze({defaultProps:T.getDefaultValues(oE),createGeometry:GJe,createLocationIterator:sh.fromStructure,getLoci:sL,eachLocation:uL,setUpdateState:function(t,r,n){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!to(r.includeTypes,n.includeTypes)||!to(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function $Je(e){return xv({defaultProps:T.getDefaultValues(oE),createGeometry:qJe,createLocationIterator:sh.fromStructure,getLoci:sL,eachLocation:uL,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!to(r.includeTypes,n.includeTypes)||!to(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var Nz=new Float32Array([-1,1,-1,-1,1,1,1,-1]),em=new Uint16Array([0,1,2,1,3,2]),AT=Je.add3,XJe=Je.add2,YJe=Je.add,W_;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024),r*=4,n*=4;var i=Je.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=Je.create(Float32Array,2,n,a?a.mappingBuffer.ref.value:r),s=Je.create(Uint32Array,3,n/2,a?a.indexBuffer.ref.value:r/2),u=Je.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(l,c,d,f){for(var h=i.elementCount,v=0;v<4;++v)AT(i,l,c,d),XJe(o,Nz[v*2],Nz[v*2+1]),YJe(u,f);AT(s,h+em[0],h+em[1],h+em[2]),AT(s,h+em[3],h+em[4],h+em[5])},getSpheres:function(){var l=Je.compact(i,!0),c=Je.compact(o,!0),d=Je.compact(s,!0),f=Je.compact(u,!0);return ah.create(l,c,d,f,i.elementCount/4,a)}}}e.create=t})(W_||(W_={}));var Dte=_.add;function lL(e,t,r){var n=r.ignoreHydrogens,a=r.traceOnly,i=t.model.atomicHierarchy.derived.atom.atomicNumber,o=We.isCoarse(t),s=e.child,u=s==null?void 0:s.unitMap.get(t.id);if(s&&!u)throw new Error("expected childUnit to exist if child exists");if(!(!s&&!n&&!a))return function(l){return!!u&&!it.has(u.elements,l)||!o&&n&&b_(i,l)||a&&!gO(t,l)}}function KJe(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Ft.createEmpty(i);for(var u=a.detail,l=a.sizeFactor,c=t.elements,d=c.length,f=d*R3(u),h=Et.createState(f,f/2,i),v=_(),p=t.conformation.invariantPosition,g=lL(r,t,a),m=at.create(r,t),y=n.size.size,b=_(),S=0,x=0,C=0;C<d;C++)if(!(g&&g(c[C]))){m.element=c[C],p(c[C],v),Dte(b,b,v),x+=1,h.currentGroup=C;var w=y(m);w>S&&(S=w),Na(h,v,w*l,u)}var A;_.scale(b,b,1/x),i&&_.distance(b,i.boundingSphere.center)/i.boundingSphere.radius<1?A=je.clone(i.boundingSphere):A=je.expand(je(),(s??t).boundary.sphere,S*l+.05);var I=Et.getMesh(h);return I.setBoundingSphere(A),I}function QJe(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return ah.createEmpty(i);for(var u=t.elements,l=u.length,c=W_.create(l,l/2,i),d=_(),f=t.conformation.invariantPosition,h=lL(r,t,a),v=at.create(r,t),p=n.size.size,g=_(),m=0,y=0,b=0;b<l;b++)if(!(h!=null&&h(u[b]))){f(u[b],d),c.add(d[0],d[1],d[2],b),Dte(g,g,d),y+=1,v.element=u[b];var S=p(v);S>m&&(m=S)}var x;_.scale(g,g,1/y),i&&_.distance(g,i.boundingSphere.center)/i.boundingSphere.radius<1?x=je.clone(i.boundingSphere):x=je.expand(je(),(s??t).boundary.sphere,m*a.sizeFactor+.05);var C=c.getSpheres();return C.setBoundingSphere(x),C}function Ul(e,t,r){var n=!1;if(!Oe.is(e))return!1;var a=t.structure,i=t.group;if(!tt.areEquivalent(e.structure,a))return!1;for(var o=i.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.unit.id);if(c!==void 0){var d=c*o;if(Re.is(l.indices)){var f=d+Re.start(l.indices),h=d+Re.end(l.indices);r(Re.ofBounds(f,h))&&(n=!0)}else for(var v=0,p=l.indices.length;v<p;v++){for(var f=l.indices[v],g=v+1;g<p&&l.indices[g]===f;)g++;v=g-1;var h=l.indices[v];n=r(Re.ofRange(d+f,d+h))||n}}}return n}function jl(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a],l=Fe.ofSingleton(i);return Oe(o.target,[{unit:u,indices:l}])}return Or}function sE(e,t,r){var n=!1;if(!Oe.is(e)||!tt.areEquivalent(e.structure,t))return!1;for(var a=t.serialMapping.cumulativeUnitElementCount,i=0,o=e.elements;i<o.length;i++){var s=o[i],u=t.unitIndexMap.get(s.unit.id);if(u!==void 0)if(Re.is(s.indices)){var l=a[u]+Re.start(s.indices),c=a[u]+Re.end(s.indices);r(Re.ofBounds(l,c))&&(n=!0)}else for(var d=0,f=s.indices.length;d<f;d++){var h=a[u]+s.indices[d];r(Re.ofSingleton(h))&&(n=!0)}}return n}function uE(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.serialMapping,o=i.unitIndices,s=i.cumulativeUnitElementCount,u=o[a],l=t.units[u],c=a-s[u],d=Fe.ofSingleton(c);return Oe(t,[{unit:l,indices:d}])}return Or}var ji;(function(e){function t(n){var a=n.group,i=n.structure,o=a.elements.length,s=a.units.length,u=at.create(i),l=function(c,d){var f=a.units[d];return u.unit=f,u.element=f.elements[c],u};return bn(o,s,1,l)}e.fromGroup=t;function r(n){var a=n.units,i=n.elementCount,o=i,s=1,u=n.serialMapping,l=u.unitIndices,c=u.elementIndices,d=at.create(n),f=function(h){return d.unit=a[l[h]],d.element=c[h],d};return bn(o,s,1,f,!0)}e.fromStructure=r})(ji||(ji={}));var lE=E(E(E({},Ci),bJ),{sizeFactor:T.Numeric(1,{min:0,max:10,step:.1}),detail:T.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),ignoreHydrogens:T.Boolean(!1),traceOnly:T.Boolean(!1),tryUseImpostor:T.Boolean(!0)});function Rte(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?ZJe(e):JJe(e)}function ZJe(e){return xJ({defaultProps:T.getDefaultValues(lE),createGeometry:QJe,createLocationIterator:ji.fromGroup,getLoci:jl,eachLocation:Ul,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function JJe(e){return oo({defaultProps:T.getDefaultValues(lE),createGeometry:KJe,createLocationIterator:ji.fromGroup,getLoci:jl,eachLocation:Ul,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var kte={"element-sphere":function(e,t){return na("Element sphere",e,t,Rte)},"intra-bond":function(e,t){return na("Intra-unit bond cylinder",e,t,Tte)},"inter-bond":function(e,t){return Du("Inter-unit bond cylinder",e,t,Mte)}},Ote=E(E(E(E(E({},lE),{traceOnly:T.Boolean(!1,{isHidden:!0})}),iE),oE),{includeParent:T.Boolean(!1),unitKinds:Bb(["atomic"]),sizeFactor:T.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:T.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:T.MultiSelect(["element-sphere","intra-bond","inter-bond"],T.objectToOptions(kte))});function eet(e,t){return T.clone(Ote)}function tet(e,t){return sr.createMulti("Ball & Stick",e,t,Ba,kte)}var ret={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:tet,getParams:eet,defaultValues:T.getDefaultValues(Ote),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function net(e,t,r,n,a){var i=t.carbohydrates,o=i.links,s=i.elements,u=n.linkSizeFactor,l=at.create(t),c={linkCount:o.length,position:function(d,f,h){var v=o[h];_.copy(d,s[v.carbohydrateIndexA].geometry.center),_.copy(f,s[v.carbohydrateIndexB].geometry.center)},radius:function(d){var f=o[d],h=s[f.carbohydrateIndexA],v=h.unit.rings.all[h.ringIndex];return l.unit=h.unit,l.element=h.unit.elements[v[0]],r.size.size(l)*u}};return _v(e,c,n,a)}var Lte=E(E(E({},Ci),Cv),{linkSizeFactor:T.Numeric(.3,{min:0,max:3,step:.01})});function aet(e){return xv({defaultProps:T.getDefaultValues(Lte),createGeometry:net,createLocationIterator:iet,getLoci:oet,eachLocation:set,setUpdateState:function(t,r,n){t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function iet(e){var t=e.carbohydrates,r=t.elements,n=t.links,a=n.length,i=1,o=at.create(e),s=function(u){var l=n[u],c=r[l.carbohydrateIndexA],d=c.unit.rings.all[c.ringIndex];return o.unit=c.unit,o.element=c.unit.elements[d[0]],o};return bn(a,i,1,s,!0)}function oet(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates,o=i.links,s=i.elements,u=o[a],l=s[u.carbohydrateIndexA],c=s[u.carbohydrateIndexB];return Oe.union(ob(t,l.unit,l.residueIndex,l.altId),ob(t,c.unit,c.residueIndex,c.altId))}return Or}function set(e,t,r){var n=!1;if(!Oe.is(e)||!tt.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getLinkIndices,i=function(d,f){if(!We.isAtomic(d))return"continue";Fe.forEach(f,function(h){for(var v=a(d,d.elements[h]),p=0,g=v.length;p<g;++p)r(Re.ofSingleton(v[p]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return n}var uet=_.create(0,0,-.5),cet=_.create(0,0,.5),Vd=_(),Hd=_(),_x=_(),Fz=_();function det(e){for(var t=e.length/3,r=t===3?1:t===4?2:t,n=r+t,a=t===4?t*3+4:n*3,i=r0(n,a),o=0;o<t;++o){var s=(o+1)%t;_.set(Vd,e[o*3],e[o*3+1],-.5),_.set(Hd,e[s*3],e[s*3+1],-.5),i.add(Vd,Hd,cet)}if(t===3)_.set(Vd,e[0],e[1],-.5),_.set(Hd,e[3],e[4],-.5),_.set(_x,e[6],e[7],-.5),i.add(_x,Hd,Vd);else if(t===4)_.set(Vd,e[0],e[1],-.5),_.set(Hd,e[3],e[4],-.5),_.set(_x,e[6],e[7],-.5),_.set(Fz,e[9],e[10],-.5),i.addQuad(Fz,_x,Hd,Vd);else for(var o=0;o<t;++o){var s=(o+1)%t;_.set(Vd,e[o*3],e[o*3+1],-.5),_.set(Hd,e[s*3],e[s*3+1],-.5),i.add(uet,Hd,Vd)}return i.getPrimitive()}var PT;function fet(){return PT||(PT=det(Bl(8,!0))),PT}var TT;function het(){if(!TT){for(var e=Bl(8,!0),t=new Float32Array(8*3+6),r=0;r<8;++r)t[r*3]=e[r*3],t[r*3+1]=e[r*3+1],t[r*3+2]=-.5;t[8*3]=0,t[8*3+1]=0,t[8*3+2]=-.5,t[8*3+3]=0,t[8*3+4]=0,t[8*3+5]=.5;var n=[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9];TT=M3(t,n)}return TT}var pet={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},IT=_.zero(),MT=_.zero(),DT=_.zero(),Z0=_.zero(),RT=_.zero();function vet(e){for(var t=E(E({},pet),e),r=t.outerRadius,n=t.innerRadius,a=t.thickness,i=t.pointCount,o=i*2*2,s=r0(o),u=new Float32Array(i*2),l=new Float32Array(i*2),c=0;c<i;++c){var d=c*2,f=c*2+1,h=(d+1)/i*Math.PI,v=(f+1)/i*Math.PI;l[d]=Math.cos(h)*r,l[f]=Math.sin(h)*r,u[d]=Math.cos(v)*n,u[f]=Math.sin(v)*n}_.set(IT,0,0,a/2),_.set(MT,0,0,-a/2);for(var c=0;c<i;++c){var p=(c+1)%i;_.set(DT,l[c*2],l[c*2+1],0),_.set(Z0,u[c*2],u[c*2+1],0),_.set(RT,l[p*2],l[p*2+1],0),s.add(IT,DT,Z0),s.add(Z0,DT,MT),s.add(IT,Z0,RT),s.add(RT,Z0,MT)}return s.getPrimitive()}var Nte=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],met=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],get=[0,2,4,0,4,3,1,2,5,1,5,3],kT;function yet(){return kT||(kT=M3(Nte,met)),kT}var OT;function bet(){return OT||(OT=M3(Nte,get)),OT}var Ot=le.identity(),ec=_.zero(),Bz=_.zero(),xet=2*.806,Uz=Jk(),jz=xOe(),Cet=fet(),zz=het(),_et=vet({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),wet=yet(),Vz=bet(),Hz=zFe(),Eet=VFe(),Aet=HFe(),Pet=GFe(),Tet=qFe();function Iet(e,t,r,n,a){for(var i=Et.createState(256,128,a),o=n.detail,s=n.sizeFactor,u=t.carbohydrates,l=u.elements.length,c=at.create(t),d=0;d<l;++d){var f=u.elements[d],h=f.unit.rings.all[f.ringIndex],v=oPe(f.component.type,h.length);c.unit=f.unit,c.element=f.unit.elements[h[0]];var p=r.size.size(c),g=p*s,m=p*s*xet,y=f.geometry,b=y.center,S=y.normal,x=y.direction;switch(_.add(Bz,b,x),le.targetTo(Ot,b,Bz,S),le.setTranslation(Ot,b),i.currentGroup=d*2,v){case 0:Na(i,b,g,o);break;case 1:le.scaleUniformly(Ot,Ot,m),Et.addPrimitive(i,Ot,Uz);break;case 2:le.scaleUniformly(Ot,Ot,m),Et.addPrimitive(i,Ot,jz),le.mul(Ot,Ot,le.rotZ90X180),i.currentGroup+=1,Et.addPrimitive(i,Ot,jz);break;case 4:le.scaleUniformly(Ot,Ot,m*1.2),Et.addPrimitive(i,Ot,Cet);break;case 5:le.scaleUniformly(Ot,Ot,m*1.2),Et.addPrimitive(i,Ot,zz),le.mul(Ot,Ot,le.rotZ90),i.currentGroup+=1,Et.addPrimitive(i,Ot,zz);break;case 6:le.mul(Ot,Ot,le.rotZY90),le.scale(Ot,Ot,_.set(ec,m,m,m/2)),Et.addPrimitive(i,Ot,Uz);break;case 7:le.scaleUniformly(Ot,Ot,m),le.mul(Ot,Ot,le.rotZY90),Et.addPrimitive(i,Ot,_et);break;case 8:le.mul(Ot,Ot,le.rotZY90),le.scale(Ot,Ot,_.set(ec,m*1.4,m*1.4,m*1.4)),Et.addPrimitive(i,Ot,wet);break;case 3:le.mul(Ot,Ot,le.rotZY90),le.scale(Ot,Ot,_.set(ec,m*1.4,m*1.4,m*1.4)),Et.addPrimitive(i,Ot,Vz),le.mul(Ot,Ot,le.rotY90),i.currentGroup+=1,Et.addPrimitive(i,Ot,Vz);break;case 9:le.mul(Ot,Ot,le.rotZY90),le.scale(Ot,Ot,_.set(ec,m,m/2,m/2)),Et.addPrimitive(i,Ot,Hz);break;case 12:le.mul(Ot,Ot,le.rotZY90),le.scale(Ot,Ot,_.set(ec,m,m,m/2)),Et.addPrimitive(i,Ot,Hz);break;case 13:case 11:le.mul(Ot,Ot,le.rotZY90),le.scale(Ot,Ot,_.set(ec,m,m,m/2)),Et.addPrimitive(i,Ot,Eet);break;case 14:le.mul(Ot,Ot,le.rotZY90),le.scale(Ot,Ot,_.set(ec,m,m,m/2)),Et.addPrimitive(i,Ot,Aet);break;case 15:le.mul(Ot,Ot,le.rotZY90),le.scale(Ot,Ot,_.set(ec,m,m,m/2)),Et.addPrimitive(i,Ot,Tet);break;case 10:default:le.mul(Ot,Ot,le.rotZYZ90),le.scale(Ot,Ot,_.set(ec,m/1.5,m,m/2)),Et.addPrimitive(i,Ot,Pet);break}}return Et.getMesh(i)}var Fte=E(E({},Ub),{detail:T.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),sizeFactor:T.Numeric(1.75,{min:0,max:10,step:.01})});function Met(e){return xv({defaultProps:T.getDefaultValues(Fte),createGeometry:Iet,createLocationIterator:Det,getLoci:Ret,eachLocation:ket,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function Det(e){var t=e.carbohydrates.elements,r=t.length*2,n=1,a=at.create(e);function i(s,u){var l=t[Math.floor(s/2)],c=l.unit.rings.all[l.ringIndex];return a.unit=l.unit,a.element=l.unit.elements[c[0]],a}function o(s,u){return s%2===1}return bn(r,n,1,i,!0,o)}function Ret(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates.elements[Math.floor(a/2)];return ob(t,i.unit,i.residueIndex,i.altId)}return Or}function ket(e,t,r){var n=t.carbohydrates.getElementIndices,a=!1;if(!Oe.is(e)||!tt.areEquivalent(e.structure,t))return!1;for(var i=function(d,f){if(!We.isAtomic(d))return"continue";Fe.forEach(f,function(h){for(var v=n(d,d.elements[h]),p=0,g=v.length;p<g;++p)r(Re.ofSingleton(v[p]*2))&&(a=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return a}function Oet(e,t,r,n,a){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=n.terminalLinkSizeFactor,l=at.create(t),c={linkCount:o.length,position:function(d,f,h){var v=o[h];v.fromCarbohydrate?(_.copy(d,s[v.carbohydrateIndex].geometry.center),v.elementUnit.conformation.position(v.elementUnit.elements[v.elementIndex],f)):(v.elementUnit.conformation.position(v.elementUnit.elements[v.elementIndex],d),_.copy(f,s[v.carbohydrateIndex].geometry.center))},radius:function(d){var f=o[d];if(f.fromCarbohydrate){var h=s[f.carbohydrateIndex],v=h.unit.rings.all[h.ringIndex];l.unit=h.unit,l.element=h.unit.elements[v[0]]}else l.unit=f.elementUnit,l.element=f.elementUnit.elements[f.elementIndex];return r.size.size(l)*u},style:function(d){var f=o[d],h=f.elementUnit.elements[f.elementIndex],v=Ag(f.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(h));return eb.has(v)?1:0}};return _v(e,c,n,a)}var Bte=E(E(E({},Ci),Cv),{terminalLinkSizeFactor:T.Numeric(.2,{min:0,max:3,step:.01})});function Let(e){return xv({defaultProps:T.getDefaultValues(Bte),createGeometry:Oet,createLocationIterator:Net,getLoci:Fet,eachLocation:Bet,setUpdateState:function(t,r,n){t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Net(e){var t=e.carbohydrates,r=t.elements,n=t.terminalLinks,a=n.length,i=1,o=at.create(e),s=function(u){var l=n[u];if(l.fromCarbohydrate){var c=r[l.carbohydrateIndex],d=c.unit.rings.all[c.ringIndex];o.unit=c.unit,o.element=c.unit.elements[d[0]]}else o.unit=l.elementUnit,o.element=l.elementUnit.elements[l.elementIndex];return o};return bn(a,i,1,s,!0)}function Fet(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=o[a],l=s[u.carbohydrateIndex];return Oe.union(ob(t,l.unit,l.residueIndex,l.altId),Lze(t,u.elementUnit,u.elementUnit.elements[u.elementIndex]))}return Or}function Bet(e,t,r){var n=!1;if(!Oe.is(e)||!tt.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getTerminalLinkIndices,i=function(d,f){if(!We.isAtomic(d))return"continue";Fe.forEach(f,function(h){for(var v=a(d,d.elements[h]),p=0,g=v.length;p<g;++p)r(Re.ofSingleton(v[p]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return n}var Ute={"carbohydrate-symbol":function(e,t){return Du("Carbohydrate symbol mesh",e,t,Met)},"carbohydrate-link":function(e,t){return Du("Carbohydrate link cylinder",e,t,aet)},"carbohydrate-terminal-link":function(e,t){return Du("Carbohydrate terminal link cylinder",e,t,Let)}},jte=E(E(E(E({},Fte),Lte),Bte),{visuals:T.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],T.objectToOptions(Ute))});function Uet(e,t){return T.clone(jte)}function jet(e,t){return sr.createMulti("Carbohydrate",e,t,Ba,Ute)}var zet={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:jet,getParams:Uet,defaultValues:T.getDefaultValues(jte),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.models.some(function(t){return Xt.hasCarbohydrate(t)})}};function zte(e,t){switch(e.kind){case 0:return Vet(e,t);case 1:case 2:return Het(e,t)}}function Vet(e,t){for(var r=e.model.atomicRanges.cyclicPolymerMap,n=Zr.transientSegments(Yb(e),e.elements),a=ar.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=e.model.atomicHierarchy.derived.residue.moleculeType,s=-1,u=-1,l=!0,c=-1,d=0;n.hasNext;){for(l=!0,c=d,a.setSegment(n.move());a.hasNext;){if(l){var f=a.move().index;if(++d,!a.hasNext)continue;l=!1,u=f}var h=a.move().index;s=u,u=h,t(i[s],i[u],d-1,d,o[s]),++d}r.has(u)&&(s=u,u=r.get(s),t(i[s],i[u],d-1,c,o[s]))}}function Het(e,t){for(var r=Zr.transientSegments(Yb(e),e.elements),n=e.elements,a=!0,i=0;r.hasNext;){a=!0;for(var o=r.move(),s=o.start,u=o.end,l=s,c=u;l<c;++l){if(a){if(++l,++i,l>c)continue;a=!1}t(n[l-1],n[l],i-1,i,0),++i}}}function Vte(e,t){switch(e.kind){case 0:return Get(e,t);case 1:case 2:return qet(e,t)}}function Get(e,t){for(var r=Zr.transientSegments(Yb(e),e.elements),n=ar.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),a=e.model.atomicHierarchy.derived.residue.traceElementIndex,i=0;r.hasNext;)for(n.setSegment(r.move());n.hasNext;){var o=n.move().index;t(a[o],i),++i}}function qet(e,t){for(var r=Zr.transientSegments(Yb(e),e.elements),n=e.elements,a=0;r.hasNext;)for(var i=r.move(),o=i.start,s=i.end,u=o,l=s;u<l;++u)t(n[u],a),++a}function Wet(e,t){switch(t.kind){case 0:return new $et(e,t);case 1:case 2:return new Xet(e,t)}}function Hte(e,t){return{centerA:at.create(e,t),centerB:at.create(e,t)}}var $et=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=Zr.transientSegments(Wte(r),r.elements),this.value=Hte(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.unit,r=t.elements,n=t.residueIndex,a=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[r[a.start]]],this.value.centerB.element=this.traceElementIndex[n[r[a.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}(),Xet=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.gapIt=Zr.transientSegments(Wte(r),r.elements),this.value=Hte(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();function Yet(e){for(var t=e.atomicConformation,r=t.x,n=t.y,a=t.z,i=e.atomicHierarchy.derived.residue,o=i.polymerType,s=i.traceElementIndex,u=o.length,l=Fe.ofBounds(0,e.atomicConformation.atomId.rowCount),c=Zr.transientSegments(e.atomicRanges.polymerRanges,l),d=ar.transientSegments(e.atomicHierarchy.residueAtomSegments,l),f=new Float32Array(u*3),h=new Float32Array(u*3),v=0,p=-1,g=-1,m=_(),y=_(),b=_(),S=_(),x=_(),C=_(),w=_(),A=_(),I=_(),D=_(),k=_(),R=_(),L=_(),H=_();c.hasNext;){var B=c.move();for(d.setSegment(B),v=-1,g=-1;d.hasNext;){v+=1;var j=d.move().index;v===0&&(g=j),p=j-2;var Q=p*3;_.copy(m,y),_.copy(y,b),_.copy(b,S);var G=s[j];if(_.set(S,r[G],n[G],a[G]),!(v<3)){_.sub(x,y,m),_.sub(C,b,y),_.sub(w,S,b),_.sub(k,x,C),_.sub(R,C,w),_.cross(L,k,R),_.normalize(L,L),_.toArray(L,h,Q);var W=Math.cos(_.angle(k,R)),q=_.magnitude(k),J=_.magnitude(R),he=Math.sqrt(J*q)/Math.max(2,2*(1-W));_.scale(A,k,he/q),_.sub(A,y,A),_.toArray(A,f,Q),_.scale(I,R,he/J),_.sub(I,b,I),_.toArray(I,f,Q+3),_.copy(H,L)}}var $=g*3;_.fromArray(A,f,$+3),_.fromArray(I,f,$+6),_.normalize(L,_.sub(L,A,I));var X=s[g];_.set(m,r[X],n[X],a[X]),_.copy(D,m),_.projectPointOnVector(D,D,L,A),_.toArray(D,f,$);var U=p+2,z=U*3;_.fromArray(A,f,z-3),_.fromArray(I,f,z-6),_.normalize(L,_.sub(L,A,I));var ee=s[U];_.set(m,r[ee],n[ee],a[ee]),_.copy(D,m),_.projectPointOnVector(D,D,L,A),_.toArray(D,f,z)}return{centers:f}}var ZD=Xp.createProvider({label:"Helix Orientation",descriptor:Po({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:function(){return{}},isApplicable:function(e){return!0},obtain:function(e,t){return de(void 0,void 0,void 0,function(){return fe(this,function(r){return[2,{value:Yet(t)}]})})}});function su(e){return Lr.is(e,2)}function Ket(e){return Lr.is(e,4)}function cL(e,t,r){switch(r===void 0&&(r={}),e.kind){case 0:return new Qet(e,t,r);case 1:case 2:return new Zet(e,t)}}var AS=Lr.create(536870912);function Gte(e,t){return{center:at.create(e,t),centerPrev:at.create(e,t),centerNext:at.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:AS,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:_(),p1:_(),p2:_(),p3:_(),p4:_(),d12:_(),d23:_()}}var Kt=_(),wx=_(),Ex=_(),Qet=function(){function e(t,r,n){n===void 0&&(n={});var a;if(this.unit=t,this.state=0,this.p0=_(),this.p1=_(),this.p2=_(),this.p3=_(),this.p4=_(),this.p5=_(),this.p6=_(),this.d01=_(),this.d12=_(),this.d23=_(),this.d34=_(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=Zr.transientSegments(this.polymerRanges,t.elements),this.residueIt=ar.transientSegments(this.residueAtomSegments,t.elements),this.value=Gte(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=(a=Ol.get(r).value)===null||a===void 0?void 0:a.get(t.invariantId)),n.useHelixOrientation){var i=ZD.get(t.model).value;if(!i)throw new Error("missing helix-orientation");this.helixOrientationCenters=i.centers}}return e.prototype.atomicPos=function(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])},e.prototype.pos=function(t,r,n){var a=this.traceElementIndex[r];this.helixOrientationCenters&&su(n)?_.fromArray(t,this.helixOrientationCenters,r*3):this.atomicPos(t,a)},e.prototype.updateResidueSegmentRange=function(t){var r=this.residueAtomSegments.index;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]},e.prototype.getResidueIndex=function(t){if(t<this.residueSegmentMin){var r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){var r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t},e.prototype.getSecStruc=function(t){if(this.secondaryStructure){var r=this.secondaryStructure,n=r.type,a=r.getIndex,i=n[a(t)];return su(i)?2:i}else return AS},e.prototype.setControlPoint=function(t,r,n,a,i){Ket(i)||this.helixOrientationCenters&&su(i)?_.scale(t,_.add(t,r,_.add(t,a,_.add(t,n,n))),1/4):_.copy(t,n)},e.prototype.setFromToVector=function(t,r,n){this.value.isCoarseBackbone||this.helixOrientationCenters&&su(n)?_.set(t,1,0,0):(this.atomicPos(wx,this.directionFromElementIndex[r]),this.atomicPos(Ex,this.directionToElementIndex[r]),_.sub(t,Ex,wx))},e.prototype.setDirection=function(t,r,n,a){_.matchDirection(wx,r,n),_.matchDirection(Ex,a,n),_.scale(t,_.add(t,wx,_.add(t,Ex,_.add(t,n,n))),1/4)},e.prototype.move=function(){var t=this,r=t.residueIt,n=t.polymerIt,a=t.value;if(this.state===0){for(;n.hasNext;)if(this.polymerSegment=n.move(),r.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),r.hasNext){this.state=1;var i=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(i-1);this.currSecStrucType=i===o?AS:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(i),this.currCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[i]===-1||this.directionToElementIndex[i]===-1;break}}if(this.state===1){var s=r.move().index,u=this.getResidueIndex(s-3),l=this.getResidueIndex(s-2),c=this.getResidueIndex(s-1),d=this.getResidueIndex(s+1),f=this.getResidueIndex(s+2),h=this.getResidueIndex(s+3);this.prevSecStrucType=this.currSecStrucType,this.currSecStrucType=this.nextSecStrucType,this.nextSecStrucType=s===d?AS:this.getSecStruc(d),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[d]===-1||this.directionToElementIndex[d]===-1,a.secStrucType=this.currSecStrucType,a.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,a.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,a.isCoarseBackbone=this.currCoarseBackbone,a.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,a.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,a.first=s===this.residueSegmentMin,a.last=s===this.residueSegmentMax,a.moleculeType=this.moleculeType[s],a.initial=s===c,a.final=s===d,a.centerPrev.element=this.traceElementIndex[c],a.center.element=this.traceElementIndex[s],a.centerNext.element=this.traceElementIndex[d];var v=this.getSecStruc(u),p=this.getSecStruc(l),g=this.getSecStruc(c),m=this.getSecStruc(s),y=this.getSecStruc(d),b=this.getSecStruc(f),S=this.getSecStruc(h);this.pos(this.p0,u,v),this.pos(this.p1,l,p),this.pos(this.p2,c,g),this.pos(this.p3,s,m),this.pos(this.p4,d,y),this.pos(this.p5,f,b),this.pos(this.p6,h,S);var x=su(v),C=su(p),w=su(g),A=su(m),I=su(y),D=su(b),k=su(S);this.helixOrientationCenters&&(A!==w?A?(_.copy(this.p0,this.p3),_.copy(this.p1,this.p3),_.copy(this.p2,this.p3)):w&&(_.scale(Kt,_.sub(Kt,this.p2,this.p3),2),_.add(this.p2,this.p3,Kt),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):A!==C?A?(_.copy(this.p0,this.p2),_.copy(this.p1,this.p2)):C&&(_.scale(Kt,_.sub(Kt,this.p1,this.p2),2),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):A!==x&&(A?_.copy(this.p0,this.p1):x&&(_.scale(Kt,_.sub(Kt,this.p0,this.p1),2),_.add(this.p0,this.p1,Kt))),A!==I?A?(_.copy(this.p4,this.p3),_.copy(this.p5,this.p3),_.copy(this.p6,this.p3)):I&&(_.scale(Kt,_.sub(Kt,this.p4,this.p3),2),_.add(this.p4,this.p3,Kt),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):A!==D?A?(_.copy(this.p5,this.p4),_.copy(this.p6,this.p4)):D&&(_.scale(Kt,_.sub(Kt,this.p5,this.p4),2),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):A!==k&&(A?_.copy(this.p6,this.p5):k&&(_.scale(Kt,_.sub(Kt,this.p6,this.p5),2),_.add(this.p6,this.p5,Kt)))),this.setFromToVector(this.d01,c,g),this.setFromToVector(this.d12,s,m),this.setFromToVector(this.d23,d,y),this.setFromToVector(this.d34,f,b);var R=A&&this.helixOrientationCenters,L=1.5;s===c||m!==g&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p3,this.p4),L),_.add(this.p2,this.p3,Kt),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):c===l||m!==p&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p2,this.p3),L),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):(l===u||m!==v&&R)&&(_.setMagnitude(Kt,_.sub(Kt,this.p1,this.p2),L),_.add(this.p0,this.p1,Kt)),s===d||m!==y&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p3,this.p2),L),_.add(this.p4,this.p3,Kt),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):d===f||m!==b&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p4,this.p3),L),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):(f===h||m!==S&&R)&&(_.setMagnitude(Kt,_.sub(Kt,this.p5,this.p4),L),_.add(this.p6,this.p5,Kt)),this.setControlPoint(a.p0,this.p0,this.p1,this.p2,p),this.setControlPoint(a.p1,this.p1,this.p2,this.p3,g),this.setControlPoint(a.p2,this.p2,this.p3,this.p4,m),this.setControlPoint(a.p3,this.p3,this.p4,this.p5,y),this.setControlPoint(a.p4,this.p4,this.p5,this.p6,b),this.setDirection(a.d12,this.d01,this.d12,this.d23),this.setDirection(a.d23,this.d12,this.d23,this.d34),r.hasNext||(this.state=0)}return this.hasNext=r.hasNext||n.hasNext,this.value},e}(),Zet=function(){function e(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=Zr.transientSegments(Yb(t),t.elements),this.value=Gte(r,t),_.set(this.value.d12,1,0,0),_.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}return e.prototype.getElementIndex=function(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)},e.prototype.pos=function(t,r){var n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]},e.prototype.move=function(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){var t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),a=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,a);var i=.5;this.elementIndex===r?(_.scale(Kt,_.sub(Kt,this.value.p2,this.value.p3),i),_.add(this.value.p1,this.value.p2,Kt),_.add(this.value.p0,this.value.p1,Kt)):r===t&&(_.scale(Kt,_.sub(Kt,this.value.p1,this.value.p2),i),_.add(this.value.p0,this.value.p1,Kt)),this.elementIndex===n?(_.scale(Kt,_.sub(Kt,this.value.p2,this.value.p1),i),_.add(this.value.p3,this.value.p2,Kt),_.add(this.value.p4,this.value.p3,Kt)):n===a&&(_.scale(Kt,_.sub(Kt,this.value.p3,this.value.p2),i),_.add(this.value.p4,this.value.p3,Kt)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value},e}(),Lh=_.fromArray,km=_.toArray,JD=_.normalize,Jet=_.sub,tm=_.spline,ett=_.slerp,Gz=_.copy,qz=_.cross,LT=_.orthogonalize,ttt=_.matchDirection,rtt=_.scale,Wz=_.add;function dL(e){var t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function fL(e,t,r,n){ntt(e,t,r,n),itt(e,t)}var NT=_(),FT=_(),BT=_();function ntt(e,t,r,n){for(var a=e.curvePoints,i=e.tangentVectors,o=e.linearSegments,s=t.p0,u=t.p1,l=t.p2,c=t.p3,d=t.p4,f=t.secStrucFirst,h=t.secStrucLast,v=1-n,p=f?.5:r,g=h?.5:r,m=0;m<=o;++m){var y=m*1/o;if(y<v){var b=Wo(p,r,y);tm(BT,s,u,l,c,y+n,b),tm(NT,s,u,l,c,y+n+.01,p),tm(FT,s,u,l,c,y+n-.01,p)}else{var b=Wo(r,g,y);tm(BT,u,l,c,d,y-v,b),tm(NT,u,l,c,d,y-v+.01,b),tm(FT,u,l,c,d,y-v-.01,b)}km(BT,a,m*3),JD(gf,Jet(gf,NT,FT)),km(gf,i,m*3)}}var att=_(),gf=_(),uu=_(),rm=_(),J0=_(),$z=_(),Xz=_(),Yz=_(),UT=_(),Ax=_();function itt(e,t){var r=e.curvePoints,n=e.tangentVectors,a=e.normalVectors,i=e.binormalVectors,o=t.d12,s=t.d23,u=r.length/3;Lh(Xz,n,0),Lh(Yz,n,(u-1)*3),LT(UT,Xz,o),LT(Ax,Yz,s),ttt(Ax,Ax,UT),Gz(J0,UT);for(var l=u-1,c=0;c<u;++c){var d=gX(0,l,c)*l,f=c===0?0:1/(u-d);Lh(gf,n,c*3),LT(uu,gf,ett(att,J0,Ax,f)),km(uu,a,c*3),Gz(J0,uu),JD(rm,qz(rm,gf,uu)),km(rm,i,c*3)}for(var c=1;c<l;++c)Lh(J0,a,(c-1)*3),Lh(uu,a,c*3),Lh($z,a,(c+1)*3),rtt(uu,Wz(uu,J0,Wz(uu,$z,uu)),1/3),km(uu,a,c*3),Lh(gf,n,c*3),JD(rm,qz(rm,gf,uu)),km(rm,i,c*3)}function e5(e,t,r,n,a,i,o,s){for(var u=e.widthValues,l=e.heightValues,c=e.linearSegments,d=1-s,f=0;f<=c;++f){var h=f*1/c;h<d?(u[f]=Wo(t,r,h+s),l[f]=Wo(a,i,h+s)):(u[f]=Wo(r,n,h-d),l[f]=Wo(i,o,h-d))}}var qte=.5,ott=.9,cE=.5,dE=.3,$_=2;function Yb(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function Wte(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}var id;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0].polymerElements,o=i.length,s=n.units.length,u=at.create(a),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=i[c],u};return bn(o,s,1,l)}e.fromGroup=t})(id||(id={}));var t5;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0].gapElements,o=i.length,s=n.units.length,u=at.create(a),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=i[c],u};return bn(o,s,1,l)}e.fromGroup=t})(t5||(t5={}));function Pv(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(We.isAtomic(u))return uJ(o,u,u.polymerElements[i]);var l=u.elements,c=u.polymerElements[i],d=Fe.indexOf(l,c);if(d!==-1){var f=Fe.ofSingleton(d);return Oe(o,[{unit:u,indices:f}])}}return Or}function Kz(e,t,r,n,a,i){for(var o=-1,s=-1,u=a;u<=i;u++){var l=r[u];if(!(l<0)&&(o=Fe.indexOf(t,l),o>=0)){s=u;break}}if(o<0)return!1;for(var c=o,u=i;u>s;u--){var l=r[u];if(!(l<0)){var d=Fe.indexOf(t,l);if(d>=0){c=d;break}}}return n(Re.ofRange(e+o,e+c))}function $te(e,t,r,n,a){var i=!1,o=a.unit.elements,s=a.unit.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.unit.model.atomicHierarchy.residueAtomSegments.index,l=r(a.unit);if(Re.is(a.indices))if(Re.start(a.indices)===0&&Re.end(a.indices)===a.unit.elements.length)i=n(Re.ofBounds(e,e+t))||i;else{var c=u[o[Re.min(a.indices)]],d=u[o[Re.max(a.indices)]];i=Kz(e,l,s,n,c,d)||i}else for(var f=a.indices,h=0,v=f.length;h<v;h++){for(var c=u[o[f[h]]],d=c,p=h+1;p<v;){var g=u[o[f[p]]];if(g-d>1)break;d=g,p++}h=p-1,i=Kz(e,l,s,n,c,d)||i}return i}function stt(e){return e.polymerElements}function Tv(e,t,r){var n=!1;if(!Oe.is(e))return!1;var a=t.structure,i=t.group;if(!tt.areEquivalent(e.structure,a))return!1;for(var o=i.units[0].polymerElements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s];if(i.unitIndexMap.has(l.unit.id)){var c=i.unitIndexMap.get(l.unit.id)*o;if(We.isAtomic(l.unit))n=$te(c,o,stt,r,l)||n;else if(Re.is(l.indices)){var d=c+Re.start(l.indices),f=c+Re.end(l.indices);n=r(Re.ofBounds(d,f))||n}else for(var h=0,v=l.indices.length;h<v;h++){for(var d=l.indices[h],p=h+1;p<v&&l.indices[p]===d;)p++;h=p-1;var f=l.indices[h];n=r(Re.ofRange(c+d,c+f))||n}}}return n}function utt(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a],l=Fe.indexOf(u.elements,u.gapElements[i]),c=Fe.indexOf(u.elements,u.gapElements[i%2?i-1:i+1]);if(l!==-1&&c!==-1)return Gt.Loci(o,[Gt.Location(o,u,l,o,u,c),Gt.Location(o,u,c,o,u,l)])}return Or}function ltt(e,t,r){var n=!1;if(Gt.isLoci(e)){var a=t.structure,i=t.group;if(!tt.areRootsEquivalent(e.structure,a))return!1;e=Gt.remapLoci(e,a);for(var o=i.units[0].gapElements.length,s=0,u=e.bonds;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.aUnit.id);if(c!==void 0){var d=Fe.indexOf(l.aUnit.gapElements,l.aUnit.elements[l.aIndex]),f=Fe.indexOf(l.bUnit.gapElements,l.bUnit.elements[l.bIndex]);d!==-1&&f!==-1&&r(Re.ofSingleton(c*o+d))&&(n=!0)}}}else if(Oe.is(e)){var a=t.structure,i=t.group;if(!tt.areRootsEquivalent(e.structure,a))return!1;e=Oe.remap(e,a);for(var h=i.units[0].gapElements.length,v=function(S){var x=i.unitIndexMap.get(S.unit.id);x!==void 0&&Fe.forEach(S.indices,function(C){var w=Fe.indexOf(S.unit.gapElements,S.unit.elements[C]);w!==-1&&r(Re.ofSingleton(x*h+w))&&(n=!0)})},p=0,g=e.elements;p<g.length;p++){var m=g[p];v(m)}}return n}var X_;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0],o=We.isAtomic(i)?i.nucleotideElements:[],s=o.length,u=n.units.length,l=at.create(a),c=function(d,f){var h=n.units[f];return l.unit=h,l.element=o[d],l};return bn(s,u,1,c)}e.fromGroup=t})(X_||(X_={}));function Xte(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(We.isAtomic(u))return uJ(o,u,u.nucleotideElements[i])}return Or}function ctt(e){return e.nucleotideElements}function Yte(e,t,r){var n=!1;if(!Oe.is(e))return!1;var a=t.structure,i=t.group;if(!tt.areEquivalent(e.structure,a))return!1;var o=i.units[0];if(!We.isAtomic(o))return!1;for(var s=o.nucleotideElements,u=s.length,l=0,c=e.elements;l<c.length;l++){var d=c[l];if(We.isAtomic(d.unit)&&i.unitIndexMap.has(d.unit.id)){var f=i.unitIndexMap.get(d.unit.id)*u;We.isAtomic(d.unit)&&(n=$te(f,u,ctt,r,d)||n)}}return n}var ey=_.zero(),Px=_.zero(),Qz=_.zero(),Zz=_.zero(),Jz=_.zero(),eV=_.zero(),Tx=_.zero(),jT=_.zero(),zT=_.zero(),tV=_.zero(),ty=le.identity(),dtt=_.zero(),rV=Jk(),Kte={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:T.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo)};T.getDefaultValues(Kte);function ftt(e,t,r,n,a,i){if(!We.isAtomic(t))return Ft.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Ft.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=o*(rV.vertices.length/3+u*2),c=Et.createState(l,l/4,i),d=t.elements,f=t.model,h=f.atomicHierarchy,v=h.chainAtomSegments,p=h.residueAtomSegments,g=h.atoms,m=h.index,y=f.atomicHierarchy.derived.residue,b=y.moleculeType,S=y.traceElementIndex,x=g.label_comp_id,C=t.conformation.invariantPosition,w=ar.transientSegments(v,d),A=ar.transientSegments(p,d),I={radiusTop:1*s,radiusBottom:1*s,radialSegments:u,bottomCap:!0},D=0;w.hasNext;)for(A.setSegment(w.move());A.hasNext;){var k=A.move().index;if(Fl(b[k])){var R=x.value(p.offsets[k]),L=-1,H=-1,B=-1,j=-1,Q=-1,G=-1,W=4.5,q=4.5,J=2.5*s,he=LY(R),$=NY(R);if(!he&&!$){var X=m.findAtomOnResidue(k,"C4"),U=m.findAtomOnResidue(k,"N9");X!==-1&&U!==-1&&_.distance(C(X,ey),C(U,Px))<1.6?he=!0:$=!0}he?(q=4.5,L=m.findAtomOnResidue(k,"N1"),H=m.findAtomOnResidue(k,"C4"),B=m.findAtomOnResidue(k,"C6"),j=m.findAtomOnResidue(k,"C2"),Q=m.findAtomOnResidue(k,"N9"),G=S[k]):$&&(q=3,L=m.findAtomOnResidue(k,"N3"),H=m.findAtomOnResidue(k,"C6"),B=m.findAtomOnResidue(k,"C4"),j=m.findAtomOnResidue(k,"C2"),Q=m.findAtomOnResidue(k,"N1"),Q===-1&&(Q=m.findAtomOnResidue(k,"C1")),G=S[k]),Q!==-1&&G!==-1&&(C(Q,Jz),C(G,eV),c.currentGroup=D,Oi(c,Jz,eV,1,I),L!==-1&&H!==-1&&B!==-1&&j!==-1&&(C(L,ey),C(H,Px),C(B,Qz),C(j,Zz),_.normalize(Tx,_.sub(Tx,Px,ey)),_.normalize(jT,_.sub(jT,Zz,Qz)),_.normalize(zT,_.cross(zT,Tx,jT)),le.targetTo(ty,ey,Px,zT),_.scaleAndAdd(tV,ey,Tx,q/2-.2),le.scale(ty,ty,_.set(dtt,W,J,q)),le.setTranslation(ty,tV),Et.addPrimitive(c,ty,rV))),++D}}var z=Et.getMesh(c),ee=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return z.setBoundingSphere(ee),z}var Qte=E(E({},Ci),Kte);function htt(e){return oo({defaultProps:T.getDefaultValues(Qte),createGeometry:ftt,createLocationIterator:X_.fromGroup,getLoci:Xte,eachLocation:Yte,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Ix=_.zero(),Gd=_.zero(),Mx=_.zero(),Dx=_.zero(),Nh=_.zero(),nm=_.zero(),Rx=_.zero(),nV=_.zero(),aV=_.zero(),ry=_.zero(),qd=_.zero(),Zte={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:T.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo),detail:T.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo)};T.getDefaultValues(Zte);var kx=new Float32Array(2*9*3),ptt=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),vtt=new Uint32Array([8,12,14,16,6,4,2,0,10]),mtt=new Uint32Array([9,11,1,3,5,7,17,15,13]),Ox=new Float32Array(2*6*3),gtt=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),ytt=new Uint32Array([0,10,8,6,4,2]),btt=new Uint32Array([1,3,5,7,9,11]),iV=_.zero();function oV(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var a=0,i=r.length;a<i;++a){var o=r[a];_.toArray(_.add(iV,o,t),e,a*2*3),_.toArray(_.sub(iV,o,t),e,(a*2+1)*3)}}function xtt(e,t,r,n,a,i){if(!We.isAtomic(t))return Ft.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Ft.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=a.detail,c=o*(26+u*2),d=Et.createState(c,c/4,i),f=t.elements,h=t.model,v=h.atomicHierarchy,p=v.chainAtomSegments,g=v.residueAtomSegments,m=v.atoms,y=v.index,b=h.atomicHierarchy.derived.residue,S=b.moleculeType,x=b.traceElementIndex,C=m.label_comp_id,w=t.conformation.invariantPosition,A=ar.transientSegments(p,f),I=ar.transientSegments(g,f),D=1*s,k=1.25*s,R={radiusTop:1*s,radiusBottom:1*s,radialSegments:u},L=0;A.hasNext;)for(I.setSegment(A.move());I.hasNext;){var H=I.move().index;if(Fl(S[H])){var B=C.value(g.offsets[H]),j=-1,Q=-1,G=-1,W=-1,q=-1,J=-1,he=-1,$=-1,X=-1,U=-1;d.currentGroup=L;var z=LY(B),ee=NY(B);if(!z&&!ee){var Y=y.findAtomOnResidue(H,"C4"),Z=y.findAtomOnResidue(H,"N9");Y!==-1&&Z!==-1&&_.distance(w(Y,Nh),w(Z,ry))<1.6?z=!0:ee=!0}z?(j=x[H],Q=y.findAtomOnResidue(H,"N1"),G=y.findAtomOnResidue(H,"C2"),W=y.findAtomOnResidue(H,"N3"),q=y.findAtomOnResidue(H,"C4"),J=y.findAtomOnResidue(H,"C5"),J===-1&&(J=y.findAtomOnResidue(H,"N5")),he=y.findAtomOnResidue(H,"C6"),$=y.findAtomOnResidue(H,"N7"),$===-1&&($=y.findAtomOnResidue(H,"C7")),X=y.findAtomOnResidue(H,"C8"),U=y.findAtomOnResidue(H,"N9"),U!==-1&&j!==-1&&(w(U,ry),w(j,Ix),d.currentGroup=L,Oi(d,ry,Ix,1,R),Na(d,ry,D,l)),Q!==-1&&G!==-1&&W!==-1&&q!==-1&&J!==-1&&he!==-1&&$!==-1&&X!==-1&&U!==-1&&(w(Q,Gd),w(G,Mx),w(W,Dx),w(q,Nh),w(J,nm),w(he,Rx),w($,nV),w(X,aV),_.triangleNormal(qd,Gd,Nh,nm),_.scale(qd,qd,k),oV(kx,qd,Gd,Mx,Dx,Nh,nm,Rx,nV,aV,ry),Et.addTriangleStrip(d,kx,ptt),Et.addTriangleFan(d,kx,vtt),Et.addTriangleFan(d,kx,mtt))):ee&&(j=x[H],Q=y.findAtomOnResidue(H,"N1"),Q===-1&&(Q=y.findAtomOnResidue(H,"C1")),G=y.findAtomOnResidue(H,"C2"),W=y.findAtomOnResidue(H,"N3"),q=y.findAtomOnResidue(H,"C4"),J=y.findAtomOnResidue(H,"C5"),he=y.findAtomOnResidue(H,"C6"),Q!==-1&&j!==-1&&(w(Q,Gd),w(j,Ix),d.currentGroup=L,Oi(d,Gd,Ix,1,R),Na(d,Gd,D,l)),Q!==-1&&G!==-1&&W!==-1&&q!==-1&&J!==-1&&he!==-1&&(w(G,Mx),w(W,Dx),w(q,Nh),w(J,nm),w(he,Rx),_.triangleNormal(qd,Gd,Nh,nm),_.scale(qd,qd,k),oV(Ox,qd,Gd,Mx,Dx,Nh,nm,Rx),Et.addTriangleStrip(d,Ox,gtt),Et.addTriangleFan(d,Ox,ytt),Et.addTriangleFan(d,Ox,btt))),++L}}var te=Et.getMesh(d),ce=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return te.setBoundingSphere(ce),te}var Jte=E(E({},Ci),Zte);function Stt(e){return oo({defaultProps:T.getDefaultValues(Jte),createGeometry:xtt,createLocationIterator:X_.fromGroup,getLoci:Xte,eachLocation:Yte,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Fh=_.zero(),am=_.zero(),Bh=_.zero(),sV=_.zero(),Ea=Bl(3,!1);function Ctt(){for(var e=r0(8),t=0;t<3;++t){var r=(t+1)%3;_.set(Fh,Ea[t*3],Ea[t*3+1],-.5),_.set(am,Ea[r*3],Ea[r*3+1],-.5),_.set(Bh,Ea[r*3],Ea[r*3+1],.5),_.set(sV,Ea[t*3],Ea[t*3+1],.5),e.add(Fh,am,Bh),e.add(Bh,sV,Fh)}return _.set(Fh,Ea[0],Ea[1],-.5),_.set(am,Ea[3],Ea[4],-.5),_.set(Bh,Ea[6],Ea[7],-.5),e.add(Bh,am,Fh),_.set(Fh,Ea[0],Ea[1],.5),_.set(am,Ea[3],Ea[4],.5),_.set(Bh,Ea[6],Ea[7],.5),e.add(Fh,am,Bh),e.getPrimitive()}var VT;function _tt(){return VT||(VT=Ctt()),VT}var Uh=le.identity(),wtt=_.zero(),uV=_.zero(),lV=_.zero(),HT=_.zero(),Ett=4,Att=4,Ptt=6,Ttt=_tt(),ere={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01})};T.getDefaultValues(ere);function Itt(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Ft.createEmpty(i);for(var s=a.sizeFactor,u=o*24,l=Et.createState(u,u/10,i),c=1,d=dL(c),f=d.normalVectors,h=d.binormalVectors,v=0,p=cL(t,r);p.hasNext;){var g=p.move();l.currentGroup=v;var m=Fl(g.moleculeType),y=Lr.is(g.secStrucType,4),b=m||y?.5:.9,S=m?.3:.5;if(fL(d,g,b,S),y&&!g.secStrucLast||!y){var x=n.size.size(g.center)*s,C=Ett*x,w=Att*x,A=Ptt*x,I=m?h:f;_.fromArray(uV,I,0),_.fromArray(lV,I,3),_.normalize(HT,_.add(HT,uV,lV)),le.targetTo(Uh,g.p3,g.p1,HT),le.mul(Uh,Uh,le.rotY90Z180),le.scale(Uh,Uh,_.set(wtt,A,w,C)),le.setTranslation(Uh,g.p2),Et.addPrimitive(l,Uh,Ttt)}++v}var D=Et.getMesh(l),k=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return D.setBoundingSphere(k),D}var tre=E(E({},Ci),ere);function Mtt(e){return oo({defaultProps:T.getDefaultValues(tre),createGeometry:Itt,createLocationIterator:id.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var GT=10,rre={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:T.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo)};T.getDefaultValues(rre);function Dtt(e,t,r,n,a,i){var o=t.gapElements.length;if(!o)return Ft.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=GT*u*2*o*2,c=Et.createState(l,l/10,i),d=t.conformation.invariantPosition,f=_.zero(),h=_.zero(),v={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:u},p=0,g=Wet(r,t);g.hasNext;){var m=g.move(),y=m.centerA,b=m.centerB;y.element===b.element||(d(y.element,f),d(b.element,h),v.radiusTop=v.radiusBottom=n.size.size(y)*s,c.currentGroup=p,e1(c,f,h,.5,GT,v),v.radiusTop=v.radiusBottom=n.size.size(b)*s,c.currentGroup=p+1,e1(c,h,f,.5,GT,v)),p+=2}var S=Et.getMesh(c),x=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return S.setBoundingSphere(x),S}var fE=E(E({},Ci),rre);function hL(e){return oo({defaultProps:T.getDefaultValues(fE),createGeometry:Dtt,createLocationIterator:t5.fromGroup,getLoci:utt,eachLocation:ltt,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Ir=_(),qr=_(),Rtt=_(),zo=_(),sl=_(),Lx=_(),Nx=_(),ny=_(),gu=_(),fp=_(),qT=_(),Wd=_(),$d=_(),Xd=_(),Yd=_(),As=_.fromArray,rg=_.scale,Ts=_.add,pc=_.sub,ktt=_.magnitude,cV=_.negate,r5=_.copy,nre=_.cross,Ott=_.set,fn=Je.add3,Ltt=Je.add;function Fx(e,t,r,n,a,i,o,s){var u=t.vertices,l=t.normals,c=t.indices,d=u.elementCount;As(Ir,n,e),rg(Nx,Ir,o),rg(Lx,Ir,s),As(qr,a,e),rg(zo,qr,i),nre(fp,qr,Ir),As(gu,r,e),Ts(Wd,Ts(Wd,gu,zo),Lx),pc($d,Ts($d,gu,zo),Nx),pc(Xd,pc(Xd,gu,zo),Nx),Ts(Yd,pc(Yd,gu,zo),Lx),o<s?(fn(u,Yd[0],Yd[1],Yd[2]),fn(u,Xd[0],Xd[1],Xd[2]),fn(u,$d[0],$d[1],$d[2]),fn(u,Wd[0],Wd[1],Wd[2]),r5(sl,Lx)):(fn(u,Wd[0],Wd[1],Wd[2]),fn(u,$d[0],$d[1],$d[2]),fn(u,Xd[0],Xd[1],Xd[2]),fn(u,Yd[0],Yd[1],Yd[2]),r5(sl,Nx));for(var f=0;f<4;++f)fn(l,fp[0],fp[1],fp[2]);fn(c,d+2,d+1,d),fn(c,d,d+3,d+2)}function n5(e,t,r,n,a,i,o,s,u,l){var c=e.currentGroup,d=e.vertices,f=e.normals,h=e.indices,v=e.groups,p=d.elementCount,g=0;s>0?(As(Ir,t,0),As(qr,t,a*3),g=s/ktt(pc(Rtt,qr,Ir))):Ott(ny,0,0,0);for(var m=0;m<=a;++m){var y=i[m],b=o[m],S=s===0?b:s*(1-m/a),x=m*3;As(sl,r,x),rg(sl,sl,S),As(zo,n,x),rg(zo,zo,y),s>0&&(As(Ir,r,x),As(qr,n,x),rg(ny,nre(ny,Ir,qr),g)),As(gu,t,x),As(fp,r,x),As(qT,n,x),Ts(Ir,Ts(Ir,gu,zo),sl),Ts(qr,fp,ny),fn(d,Ir[0],Ir[1],Ir[2]),fn(f,qr[0],qr[1],qr[2]),Ts(Ir,pc(Ir,gu,zo),sl),fn(d,Ir[0],Ir[1],Ir[2]),fn(f,qr[0],qr[1],qr[2]),cV(qr,qT),fn(d,Ir[0],Ir[1],Ir[2]),fn(f,qr[0],qr[1],qr[2]),pc(Ir,pc(Ir,gu,zo),sl),fn(d,Ir[0],Ir[1],Ir[2]),fn(f,qr[0],qr[1],qr[2]),Ts(qr,cV(qr,fp),ny),fn(d,Ir[0],Ir[1],Ir[2]),fn(f,qr[0],qr[1],qr[2]),pc(Ir,Ts(Ir,gu,zo),sl),fn(d,Ir[0],Ir[1],Ir[2]),fn(f,qr[0],qr[1],qr[2]),r5(qr,qT),fn(d,Ir[0],Ir[1],Ir[2]),fn(f,qr[0],qr[1],qr[2]),Ts(Ir,Ts(Ir,gu,zo),sl),fn(d,Ir[0],Ir[1],Ir[2]),fn(f,qr[0],qr[1],qr[2])}for(var m=0;m<a;++m){for(var C=0;C<2;C++)fn(h,p+m*8+2*C,p+(m+1)*8+2*C+1,p+m*8+2*C+1),fn(h,p+m*8+2*C,p+(m+1)*8+2*C,p+(m+1)*8+2*C+1);for(var C=2;C<4;C++)fn(h,p+m*8+2*C,p+(m+1)*8+2*C,p+m*8+2*C+1),fn(h,p+(m+1)*8+2*C,p+(m+1)*8+2*C+1,p+m*8+2*C+1)}if(u){var y=i[0],b=o[0],w=s===0?b:s;Fx(0,e,t,r,n,y,w,w)}else if(s>0){var y=i[0],b=o[0];Fx(0,e,t,r,n,y,s,-b),Fx(0,e,t,r,n,y,-s,b)}if(l&&s===0){var y=i[a],b=o[a];Fx(a*3,e,t,r,n,y,-b,-b)}for(var A=(a+1)*8+(u?4:s>0?8:0)+(l&&s===0?4:0),m=0,I=A;m<I;++m)Ltt(v,c)}var zn=_(),xs=_(),Ss=_(),tc=_(),nl=_();function Ntt(e,t,r,n,a){e[0]=t[0]*n+r[0]*a,e[1]=t[1]*n+r[1]*a,e[2]=t[2]*n+r[2]*a}function WT(e,t,r,n,a,i){e[0]=t[0]*a+r[0]*i+n[0],e[1]=t[1]*a+r[1]*i+n[1],e[2]=t[2]*a+r[2]*i+n[2]}var rc=_.fromArray,dV=_.normalize,Ftt=_.negate,Btt=_.copy,fV=_.cross,ho=Je.add3,$T=new Map;function Utt(e){if(!$T.has(e)){for(var t=[],r=[],n=0;n<e;++n){var a=2*Math.PI*n/e;t[n]=Math.cos(a),r[n]=Math.sin(a)}$T.set(e,{cos:t,sin:r})}return $T.get(e)}function are(e,t,r,n,a,i,o,s,u,l){for(var c=e.currentGroup,d=e.vertices,f=e.normals,h=e.indices,v=e.groups,p=d.elementCount,g=Utt(i),m=g.cos,y=g.sin,b=0;b<=a;++b){var S=b*3;rc(tc,r,S),rc(nl,n,S),rc(Ss,t,S);for(var x=o[b],C=s[b],w=0;w<i;++w)WT(xs,tc,nl,Ss,C*m[w],x*y[w]),i===2?(Btt(zn,nl),dV(zn,zn),(w!==0||b%2===0)&&Ftt(zn,zn)):Ntt(zn,tc,nl,x*m[w],C*y[w]),dV(zn,zn),ho(d,xs[0],xs[1],xs[2]),ho(f,zn[0],zn[1],zn[2])}for(var b=0;b<a;++b)for(var w=0;w<i;++w)ho(h,p+b*i+(w+1)%i,p+(b+1)*i+(w+1)%i,p+b*i+w),ho(h,p+(b+1)*i+(w+1)%i,p+(b+1)*i+w,p+b*i+w);if(u){var A=0,I=d.elementCount;rc(tc,r,A),rc(nl,n,A),rc(Ss,t,A),fV(zn,nl,tc),ho(d,Ss[0],Ss[1],Ss[2]),ho(f,zn[0],zn[1],zn[2]);var x=o[0],C=s[0];p=d.elementCount;for(var b=0;b<i;++b)WT(xs,tc,nl,Ss,C*m[b],x*y[b]),ho(d,xs[0],xs[1],xs[2]),ho(f,zn[0],zn[1],zn[2]),ho(h,p+(b+1)%i,p+b,I)}if(l){var A=a*3,I=d.elementCount;rc(tc,r,A),rc(nl,n,A),rc(Ss,t,A),fV(zn,tc,nl),ho(d,Ss[0],Ss[1],Ss[2]),ho(f,zn[0],zn[1],zn[2]);var x=o[a],C=s[a];p=d.elementCount;for(var b=0;b<i;++b)WT(xs,tc,nl,Ss,C*m[b],x*y[b]),ho(d,xs[0],xs[1],xs[2]),ho(f,zn[0],zn[1],zn[2]),ho(h,p+b,p+(b+1)%i,I)}var D=(a+1)*i+(u?i+1:0)+(l?i+1:0);Je.addRepeat(v,D,c)}var nc=_.fromArray,jtt=_.magnitude,XT=_.sub,hV=_.add,YT=_.scale,ztt=_.negate,Vtt=_.copy,Htt=_.cross,Cs=Je.add3,Gtt=Je.add,Aa=_(),ei=_(),qtt=_(),KT=_(),jh=_(),pV=_(),ay=_(),Wtt=_(),QT=_();function PS(e,t,r,n,a,i,o,s){var u=e.currentGroup,l=e.vertices,c=e.normals,d=e.indices,f=e.groups,h=l.elementCount,v=0;s>0&&(nc(Aa,t,0),nc(ei,t,a*3),v=s/jtt(XT(qtt,ei,Aa)));for(var p=0;p<=a;++p){var g=i[p],m=o[p],y=s===0?m:s*(1-p/a),b=p*3;nc(jh,r,b),YT(jh,jh,y),nc(KT,n,b),YT(KT,KT,g),s>0&&(nc(Aa,r,b),nc(ei,n,b),YT(pV,Htt(pV,Aa,ei),v)),nc(ay,t,b),nc(Wtt,r,b),nc(QT,n,b),hV(Aa,ay,jh),ztt(ei,QT),Cs(l,Aa[0],Aa[1],Aa[2]),Cs(c,ei[0],ei[1],ei[2]),XT(Aa,ay,jh),Cs(l,Aa[0],Aa[1],Aa[2]),Cs(c,ei[0],ei[1],ei[2]),hV(Aa,ay,jh),Vtt(ei,QT),Cs(l,Aa[0],Aa[1],Aa[2]),Cs(c,ei[0],ei[1],ei[2]),XT(Aa,ay,jh),Cs(l,Aa[0],Aa[1],Aa[2]),Cs(c,ei[0],ei[1],ei[2])}for(var p=0;p<a;++p)Cs(d,h+p*4,h+(p+1)*4+1,h+p*4+1),Cs(d,h+p*4,h+(p+1)*4,h+(p+1)*4+1),Cs(d,h+p*4+2+1,h+(p+1)*4+2+1,h+p*4+2),Cs(d,h+p*4+2,h+(p+1)*4+2+1,h+(p+1)*4+2);for(var S=(a+1)*4,p=0,x=S;p<x;++p)Gtt(f,u)}var ire={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:T.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:T.Numeric(1.5,{min:0,max:3,step:.1}),tubularHelices:T.Boolean(!1),detail:T.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),linearSegments:T.Numeric(8,{min:1,max:48,step:1},At.CustomQualityParamInfo),radialSegments:T.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo)};T.getDefaultValues(ire);var po=_();function $tt(e,t,r,n,a,i){var o,s,u,l=t.polymerElements.length;if(!l)return Ft.createEmpty(i);for(var c=a.sizeFactor,d=a.detail,f=a.linearSegments,h=a.radialSegments,v=a.aspectRatio,p=a.arrowFactor,g=a.tubularHelices,m=f*h*l+(h+1)*l*2,y=Et.createState(m,m/10,i),b=We.isCoarse(t),S=dL(f),x=S.curvePoints,C=S.normalVectors,w=S.binormalVectors,A=S.widthValues,I=S.heightValues,D=0,k=cL(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:g});k.hasNext;){var R=k.move();y.currentGroup=D;var L=Fl(R.moleculeType),H=Lr.is(R.secStrucType,4),B=Lr.is(R.secStrucType,2),j=B&&!g?ott:qte,Q=L?dE:cE;fL(S,R,j,Q);var G=n.size.size(R.centerPrev)*c,W=n.size.size(R.center)*c,q=n.size.size(R.centerNext)*c;b&&(G*=v/2,W*=v/2,q*=v/2);var J=R.secStrucFirst||R.coarseBackboneFirst||R.first,he=R.secStrucLast||R.coarseBackboneLast||R.last,$=f;if(R.initial){$=Math.max(Math.round(f*Q),1);var X=f-$;x.copyWithin(0,X*3),w.copyWithin(0,X*3),C.copyWithin(0,X*3),_.fromArray(po,x,3),_.normalize(po,_.sub(po,R.p2,po)),_.scaleAndAdd(po,R.p2,po,W*$_),_.toArray(po,x,0)}else R.final&&($=Math.max(Math.round(f*(1-Q)),1),_.fromArray(po,x,$*3-3),_.normalize(po,_.sub(po,R.p2,po)),_.scaleAndAdd(po,R.p2,po,W*$_),_.toArray(po,x,$*3));if(R.initial===!0&&R.final===!0)Na(y,R.p2,W*2,d);else if(H){var U=G*v,z=W*v,ee=q*v,Y=R.secStrucLast?z*p:0;e5(S,G,W,q,U,z,ee,Q),h===2?PS(y,x,C,w,$,A,I,Y):n5(y,x,C,w,$,A,I,Y,J,he)}else{var U=void 0,z=void 0,ee=void 0;if(B&&!R.isCoarseBackbone?g?(G*=v*1.5,W*=v*1.5,q*=v*1.5,U=G,z=W,ee=q):(U=G*v,z=W*v,ee=q*v):L&&!R.isCoarseBackbone?(U=G*v,z=W*v,ee=q*v,o=[U,G],G=o[0],U=o[1],s=[z,W],W=s[0],z=s[1],u=[ee,q],q=u[0],ee=u[1]):(U=G,z=W,ee=q),e5(S,G,W,q,U,z,ee,Q),h===2)if(L&&!R.isCoarseBackbone){for(var Z=0,te=w.length;Z<te;Z++)w[Z]*=-1;PS(y,x,w,C,$,I,A,0)}else PS(y,x,C,w,$,A,I,0);else h===4?n5(y,x,C,w,$,A,I,0,J,he):are(y,x,C,w,$,h,A,I,J,he)}++D}var ce=Et.getMesh(y),be=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return ce.setBoundingSphere(be),ce}var ore=E(E({},Ci),ire);function Xtt(e){return oo({defaultProps:T.getDefaultValues(ore),createGeometry:$tt,createLocationIterator:id.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor;var u=Ol.get(o.structure).version;t.info.secondaryStructureHash!==u&&(t.createGeometry=!0,t.info.secondaryStructureHash=u)}},e)}var sre={"polymer-trace":function(e,t){return na("Polymer trace mesh",e,t,Xtt)},"polymer-gap":function(e,t){return na("Polymer gap cylinder",e,t,hL)},"nucleotide-block":function(e,t){return na("Nucleotide block mesh",e,t,htt)},"nucleotide-ring":function(e,t){return na("Nucleotide ring mesh",e,t,Stt)},"direction-wedge":function(e,t){return na("Polymer direction wedge",e,t,Mtt)}},ure=E(E(E(E(E(E({},ore),fE),Qte),Jte),tre),{sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),visuals:T.MultiSelect(["polymer-trace","polymer-gap","nucleotide-block"],T.objectToOptions(sre))});function Ytt(e,t){var r=T.clone(ure),n=!1,a=!1;return t.units.forEach(function(i){!n&&We.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-block"),a&&r.visuals.defaultValue.push("polymer-gap"),r}function Ktt(e,t){return sr.createMulti("Cartoon",e,t,Ba,sre)}var Qtt={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:Ktt,getParams:Ytt,defaultValues:T.getDefaultValues(ure),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0},ensureCustomProperties:{attach:function(e,t){return de(void 0,void 0,void 0,function(){var r,n,a;return fe(this,function(i){switch(i.label){case 0:return[4,Ol.attach(e,t,void 0,!0)];case 1:i.sent(),r=0,n=t.models,i.label=2;case 2:return r<n.length?(a=n[r],[4,ZD.attach(e,a,void 0,!0)]):[3,5];case 3:i.sent(),i.label=4;case 4:return r++,[3,2];case 5:return[2]}})})},detach:function(e){Ol.ref(e,!1);for(var t=0,r=e.models;t<r.length;t++){var n=r[t];ZD.ref(n,!1)}}}},lre=E(E({},Ci),{sizeFactor:T.Numeric(1,{min:0,max:10,step:.1}),detail:T.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),ignoreHydrogens:T.Boolean(!1)});function Ztt(e){return oo({defaultProps:T.getDefaultValues(lre),createGeometry:Jtt,createLocationIterator:ji.fromGroup,getLoci:jl,eachLocation:Ul,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function Jtt(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Ft.createEmpty(i);var u=a.detail,l=a.sizeFactor,c=a.ignoreHydrogens,d=t.elements,f=t.model,h=t.model.atomicHierarchy.derived.atom.atomicNumber,v=d.length,p=v*R3(u),g=Et.createState(p,p/2,i),m=Rl.Provider.get(f);if(!m)return Ft.createEmpty(i);var y=_(),b=qn(),S=_(),x=_(),C=_(),w=m.elementToAnsiotrop,A=m.data,I=A.U,D=A._schema.U.space,k=t.conformation.invariantPosition,R=at.create(r);R.unit=t;for(var L=0;L<v;L++){var H=d[L],B=w[H];if(B!==-1&&!(s&&!it.has(s.elements,H)||c&&b_(h,H))){R.element=H,k(H,y),g.currentGroup=L,Pr.toMat3(b,D,I.value(B)),qn.symmtricFromLower(b,b),qn.symmetricEigenvalues(S,b),qn.eigenvector(x,b,S[1]),qn.eigenvector(C,b,S[2]);for(var j=0;j<3;++j)S[j]=l*1.5958*Math.sqrt(Math.abs(S[j]));mn(S[0],S[1],yn)&&mn(S[1],S[2],yn)?Na(g,y,S[0],u):dO(g,y,C,x,S,u)}}var Q=Et.getMesh(g),G=je.expand(je(),(s||t).boundary.sphere,1*l);return Q.setBoundingSphere(G),Q}var cre={"ellipsoid-mesh":function(e,t){return na("Ellipsoid Mesh",e,t,Ztt)},"intra-bond":function(e,t){return na("Intra-unit bond cylinder",e,t,Tte)},"inter-bond":function(e,t){return Du("Inter-unit bond cylinder",e,t,Mte)}},dre=E(E(E(E({},lre),iE),oE),{includeParent:T.Boolean(!1),adjustCylinderLength:T.Boolean(!1,{isHidden:!0}),unitKinds:Bb(["atomic"]),sizeFactor:T.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:T.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:T.Boolean(!0),visuals:T.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],T.objectToOptions(cre))});function ert(e,t){return T.clone(dre)}function trt(e,t){return sr.createMulti("Ellipsoid",e,t,Ba,cre)}var rrt={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:trt,getParams:ert,defaultValues:T.getDefaultValues(dre),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&e.models.some(function(t){return Rl.Provider.isApplicable(t)})},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},nrt=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`,art=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = encodeFloatRGB(vGroup);
    #endif
}
`,irt={drawCount:Ca("number"),instanceCount:Ca("number"),aRadius:Hr("float32",1,0),aPosition:Hr("float32",3,0),aGroup:Hr("float32",1,0),uCurrentSlice:Qe("f"),uCurrentX:Qe("f"),uCurrentY:Qe("f"),uBboxMin:Qe("v3","material"),uBboxSize:Qe("v3","material"),uGridDim:Qe("v3","material"),uGridTexDim:Qe("v3","material"),uGridTexScale:Qe("v2","material"),uAlpha:Qe("f","material"),uResolution:Qe("f","material"),uRadiusFactorInv:Qe("f","material"),tMinDistanceTex:lr("texture","rgba","float","nearest"),dGridTexType:Qt("string",["2d","3d"]),dCalcType:Qt("string",["density","minDistance","groupId"])},gl="gaussian-density";function fre(e){return e.namedFramebuffers[gl]||(e.namedFramebuffers[gl]=e.resources.framebuffer()),e.namedFramebuffers[gl]}function hre(e,t,r,n,a,i){var o=gl+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function pre(e,t,r,n,a,i){return e.isWebGL2?ort(e,t,r,n,a,i):pL(e,t,r,n,!1,a,i)}function pL(e,t,r,n,a,i,o){return vre(urt(e,t,r,n,a,i,o))}function ort(e,t,r,n,a,i){return vre(lrt(e,t,r,n,a,i))}function vre(e){var t=e.texture,r=e.scale,n=e.bbox,a=e.gridDim,i=e.gridTexDim,o=e.gridTexScale,s=e.radiusFactor,u=e.resolution;return{transform:srt(r,n),texture:t,bbox:n,gridDim:a,gridTexDim:i,gridTexScale:o,radiusFactor:s,resolution:u}}function srt(e,t){var r=le.identity();return le.fromScaling(r,e),le.setTranslation(r,t.min),r}function urt(e,t,r,n,a,i,o){var s=e.gl,u=e.resources,l=e.state,c=e.extensions,d=c.colorBufferFloat,f=c.textureFloat,h=c.colorBufferHalfFloat,v=c.textureHalfFloat,p=c.blendMinMax,g=i.smoothness,m=i.resolution,y=mre(t,r,n,i),b=y.drawCount,S=y.positions,x=y.radii,C=y.groups,w=y.scale,A=y.expandedBox,I=y.dim,D=y.maxRadius,k=I[0],R=I[1],L=I[2],H=drt(I),B=H.texDimX,j=H.texDimY,Q=H.texCols,G=H.powerOfTwoSize,W=_.create(B,j,0),q=Ke.create(B/G,j/G),J=D*2,he=a?G:B,$=a?G:j,X=hre("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");X.define(he,$);var U=gre(e,b,S,x,C,X,A,I,W,q,g,m,J),z=U.values,ee=z.uCurrentSlice,Y=z.uCurrentX,Z=z.uCurrentY,te=fre(e);te.bind(),yre(e),o||(o=h&&v?u.texture("image-float16","rgba","fp16","linear"):d&&f?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),o.define(he,$);function ce(be,xe){l.currentRenderItemId=-1,be.attachFramebuffer(te,0),xe&&(s.viewport(0,0,he,$),s.scissor(0,0,he,$),s.clear(s.COLOR_BUFFER_BIT)),N.update(Z,0);for(var Ie=0,_e=0,ae=0,ie=0;ie<L;++ie)Ie>=Q&&(Ie-=Q,_e+=R,ae=0,N.update(Z,_e)),N.update(Y,ae),N.update(ee,ie),s.viewport(ae,_e,k,R),s.scissor(ae,_e,k,R),U.render(),++Ie,ae+=k;s.flush()}return xre(e,U),ce(o,!0),p&&(bre(e,U),ce(X,!0),Sre(e,U),ce(o,!1)),{texture:o,scale:w,bbox:A,gridDim:I,gridTexDim:W,gridTexScale:q,radiusFactor:J,resolution:m}}function lrt(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=e.state,l=e.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,h=l.textureHalfFloat,v=a.smoothness,p=a.resolution,g=mre(t,r,n,a),m=g.drawCount,y=g.positions,b=g.radii,S=g.groups,x=g.scale,C=g.expandedBox,w=g.dim,A=g.maxRadius,I=w[0],D=w[1],k=w[2],R=hre("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");R.define(I,D,k);var L=Ke.create(1,1),H=A*2,B=gre(e,m,y,b,S,R,C,w,w,L,v,p,H),j=B.values.uCurrentSlice,Q=fre(e);Q.bind(),yre(e),o.viewport(0,0,I,D),o.scissor(0,0,I,D),i||(i=f&&h?s.texture("volume-float16","rgba","fp16","linear"):c&&d?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),i.define(I,D,k);function G(W,q){u.currentRenderItemId=-1;for(var J=0;J<k;++J)N.update(j,J),W.attachFramebuffer(Q,0,J),q&&o.clear(o.COLOR_BUFFER_BIT),B.render();o.flush()}return xre(e,B),G(i,!0),bre(e,B),G(R,!0),Sre(e,B),G(i,!1),{texture:i,scale:x,bbox:C,gridDim:w,gridTexDim:w,gridTexScale:L,radiusFactor:H,resolution:p}}function mre(e,t,r,n){for(var a=n.resolution,i=n.radiusOffset,o=1/a,s=e.indices,u=e.x,l=e.y,c=e.z,d=e.id,f=Fe.size(s),h=new Float32Array(f*3),v=new Float32Array(f),p=new Float32Array(f),g=0,m=0;m<f;++m){var y=Fe.getAt(s,m);h[m*3]=u[y],h[m*3+1]=l[y],h[m*3+2]=c[y];var b=r(y)+i;g<b&&(g=b),v[m]=b,p[m]=d?d[m]:m}var S=g*2+a*4,x=Yt.expand(Yt(),t,_.create(S,S,S)),C=Yt.scale(Yt(),x,o),w=Yt.size(_(),C);_.ceil(w,w);var A=_.create(a,a,a);return{drawCount:f,positions:h,radii:v,groups:p,scale:A,expandedBox:x,dim:w,maxRadius:g}}function gre(e,t,r,n,a,i,o,s,u,l,c,d,f){if(e.namedComputeRenderables[gl]){var h=_.sub(_(),o.max,o.min),v=e.namedComputeRenderables[gl].values;N.updateIfChanged(v.drawCount,t),N.updateIfChanged(v.instanceCount,1),N.update(v.aRadius,n),N.update(v.aPosition,r),N.update(v.aGroup,a),N.updateIfChanged(v.uCurrentSlice,0),N.updateIfChanged(v.uCurrentX,0),N.updateIfChanged(v.uCurrentY,0),N.update(v.uBboxMin,o.min),N.update(v.uBboxSize,h),N.update(v.uGridDim,s),N.update(v.uGridTexDim,u),N.update(v.uGridTexScale,l),N.updateIfChanged(v.uAlpha,c),N.updateIfChanged(v.uResolution,d),N.updateIfChanged(v.uRadiusFactorInv,1/f),N.update(v.tMinDistanceTex,i),N.updateIfChanged(v.dGridTexType,i.getDepth()>0?"3d":"2d"),N.updateIfChanged(v.dCalcType,"density"),e.namedComputeRenderables[gl].update()}else e.namedComputeRenderables[gl]=crt(e,t,r,n,a,i,o,s,u,l,c,d,f);return e.namedComputeRenderables[gl]}function crt(e,t,r,n,a,i,o,s,u,l,c,d,f){var h=_.sub(_(),o.max,o.min),v={drawCount:N.create(t),instanceCount:N.create(1),aRadius:N.create(n),aPosition:N.create(r),aGroup:N.create(a),uCurrentSlice:N.create(0),uCurrentX:N.create(0),uCurrentY:N.create(0),uBboxMin:N.create(o.min),uBboxSize:N.create(h),uGridDim:N.create(s),uGridTexDim:N.create(u),uGridTexScale:N.create(l),uAlpha:N.create(c),uResolution:N.create(d),uRadiusFactorInv:N.create(1/f),tMinDistanceTex:N.create(i),dGridTexType:N.create(i.getDepth()>0?"3d":"2d"),dCalcType:N.create("density")},p=E({},irt),g=Ln(gl,nrt,art),m=Za(e,"points",g,p,v);return Qa(m,v)}function yre(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function bre(e,t){var r=e.gl,n=e.state;if(N.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function xre(e,t){var r=e.gl,n=e.state;N.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function Sre(e,t){var r=e.gl,n=e.state;N.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function drt(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:n*2}}function Cre(e,t,r,n,a){return de(this,void 0,void 0,function(){function i(Y,Z){for(var te=Y;te<Z;++te)for(var ce=Fe.getAt(d,te),be=f[ce],xe=h[ce],Ie=v[ce],_e=m[te],ae=_e*_e,ie=1/ae,O=_e*2,V=O*O,ve=Math.ceil(O*c),Pe=Math.floor(c*(be-w[0])),Me=Math.floor(c*(xe-w[1])),Ge=Math.floor(c*(Ie-w[2])),$e=Math.max(0,Pe-ve),Ze=Math.max(0,Me-ve),ht=Math.max(0,Ge-ve),Ue=Math.min(B,Pe+ve+2),rt=Math.min(j,Me+ve+2),ut=Math.min(Q,Ge+ve+2),Ee=$e;Ee<Ue;++Ee)for(var Te=J[Ee]-be,ye=Ee*q,Se=Ze;Se<rt;++Se)for(var Le=he[Se]-xe,Ve=Te*Te+Le*Le,nt=Se*G+ye,Xe=ht;Xe<ut;++Xe){var He=$[Xe]-Ie,se=Ve+He*He;if(se<=V){var pe=$ke(-U*(se*ie)),Ae=Xe+nt;k[Ae]+=pe,pe>X[Ae]&&(X[Ae]=pe,L[Ae]=p?p[te]:te)}}}function o(){return de(this,void 0,void 0,function(){var Y;return fe(this,function(Z){switch(Z.label){case 0:Y=0,Z.label=1;case 1:return Y<g?(i(Y,Math.min(Y+z,g)),e.shouldUpdate?[4,e.update({message:"filling density grid",current:Y,max:g})]:[3,3]):[3,4];case 2:Z.sent(),Z.label=3;case 3:return Y+=z,[3,1];case 4:return[2]}})})}var s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C,w,A,I,D,k,R,L,H,B,j,Q,G,W,q,J,he,$,X,U,z,ee;return fe(this,function(Y){switch(Y.label){case 0:for(s=a.resolution,u=a.radiusOffset,l=a.smoothness,c=1/s,d=t.indices,f=t.x,h=t.y,v=t.z,p=t.id,g=Fe.size(d),m=new Float32Array(g),y=0,b=0;b<g;++b)S=n(Fe.getAt(d,b))+u,y<S&&(y=S),m[b]=S;return x=y*2+s,C=Yt.expand(Yt(),r,_.create(x,x,x)),w=C.min,A=Yt.scale(Yt(),C,c),I=Yt.size(_(),A),_.ceil(I,I),D=Pr.Space(I,[0,1,2],Float32Array),k=D.create(),R=Pr.create(D,k),L=D.create(),L.fill(-1),H=Pr.create(D,L),B=I[0],j=I[1],Q=I[2],G=Q,W=j,q=G*W,J=Km(I[0],w[0],s),he=Km(I[1],w[1],s),$=Km(I[2],w[2],s),X=D.create(),U=l,z=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*c)),[4,o()];case 1:return Y.sent(),ee=le.identity(),le.fromScaling(ee,_.create(s,s,s)),le.setTranslation(ee,C.min),[2,{field:R,idField:H,transform:ee,radiusFactor:1,resolution:s}]}})})}var Kb=E({resolution:T.Numeric(1,{min:.1,max:20,step:.1},E({description:"Grid resolution/cell spacing."},At.CustomQualityParamInfo)),radiusOffset:T.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:T.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."})},Y3);T.getDefaultValues(Kb);function hE(e,t){var r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function _re(e,t,r){var n=this,a=t.lookup3d.boundary.box,i=bv(a,r),o=K3(e,t,i),s=o.position,u=o.radius;return et.create("Gaussian Density",function(l){return de(n,void 0,void 0,function(){return fe(this,function(c){switch(c.label){case 0:return[4,Cre(l,s,a,u,i)];case 1:return[2,c.sent()]}})})})}function frt(e,t,r,n,a){var i=this,o=t.lookup3d.boundary.box,s=bv(o,r,hE(n,e)),u=K3(e,t,s),l=u.position,c=u.radius;return et.create("Gaussian Density",function(d){return de(i,void 0,void 0,function(){return fe(this,function(f){return[2,pre(n,l,o,c,s,a)]})})})}function hrt(e,t,r,n,a,i){var o=this,s=t.lookup3d.boundary.box,u=bv(s,n,hE(a,e)),l=K3(e,t,u),c=l.position,d=l.radius;return et.create("Gaussian Density",function(f){return de(o,void 0,void 0,function(){return fe(this,function(h){return[2,pL(a,c,s,d,r,u,i)]})})})}function prt(e,t){var r=this,n=e.lookup3d.boundary.box,a=bv(n,t),i=mO(e,t.ignoreHydrogens,t.traceOnly),o=i.position,s=i.radius;return et.create("Gaussian Density",function(u){return de(r,void 0,void 0,function(){return fe(this,function(l){switch(l.label){case 0:return[4,Cre(u,o,n,s,a)];case 1:return[2,l.sent()]}})})})}function vrt(e,t,r,n){var a=this,i=e.lookup3d.boundary.box,o=bv(i,t,hE(r)),s=mO(e,t.ignoreHydrogens,t.traceOnly),u=s.position,l=s.radius;return et.create("Gaussian Density",function(c){return de(a,void 0,void 0,function(){return fe(this,function(d){return[2,pre(r,u,i,l,o,n)]})})})}function mrt(e,t,r,n,a){var i=this,o=e.lookup3d.boundary.box,s=bv(o,r,hE(n)),u=mO(e,r.ignoreHydrogens,r.traceOnly),l=u.position,c=u.radius;return et.create("Gaussian Density",function(d){return de(i,void 0,void 0,function(){return fe(this,function(f){return[2,pL(n,l,o,c,t,s,a)]})})})}function grt(e,t,r,n,a){var i=e.colorType,o=e.vertexCount,s=e.groupCount,u=e.positionBuffer,l=e.transformBuffer,c=e.groupBuffer,d=i.endsWith("Instance"),f=Yt.fromSphere3D(Yt(),d?e.boundingSphere:e.invariantBoundingSphere),h=1/t,v=Yt.scale(Yt(),f,h),p=Yt.size(_(),v);_.ceil(p,p),_.add(p,p,_.create(2,2,2));var g=f.min,m=p[0],y=p[1],b=Wb(p),S=b.width,x=b.height,C=3,w=new Float32Array(S*x*C),A=new Float32Array(S*x),I=new Uint8Array(S*x*C),D={array:I,width:S,height:x,filter:"linear"},k=d?e.instanceCount:1,R=e.colorData.array;function L(Se,Le,Ve){var nt=Math.floor(Ve*m%S/m),Xe=Math.floor(Ve*m/S),He=nt*m+Se;return C*(Xe*y*S+Le*S+He)}for(var H=2,B=p[0],j=p[1],Q=p[2],G=_(),W=0;W<k;++W)for(var q=0;q<o;q+=r){_.fromArray(G,u,q*3),d&&_.transformMat4Offset(G,G,l,0,0,W*16),_.sub(G,G,g),_.scale(G,G,h);for(var J=G[0],he=G[1],$=G[2],X=Math.floor(J),U=Math.floor(he),z=Math.floor($),ee=W*s+c[q],Y=R[ee*3],Z=R[ee*3+1],te=R[ee*3+2],ce=Math.max(0,X-H),be=Math.max(0,U-H),xe=Math.max(0,z-H),Ie=Math.min(B,X+H+2),_e=Math.min(j,U+H+2),ae=Math.min(Q,z+H+2),ie=ce;ie<Ie;++ie)for(var O=ie-J,V=be;V<_e;++V)for(var ve=V-he,Pe=xe;Pe<ae;++Pe){var Me=Pe-$,Ge=Math.sqrt(O*O+ve*ve+Me*Me);if(!(Ge>H)){var $e=H-Ge,Ze=L(ie,V,Pe);w[Ze]+=Y*$e,w[Ze+1]+=Z*$e,w[Ze+2]+=te*$e,A[Ze/3]+=$e}}}for(var W=0,ht=A.length;W<ht;++W){var Ue=W*3,rt=A[W];I[Ue]=Math.round(w[Ue]/rt),I[Ue+1]=Math.round(w[Ue+1]/rt),I[Ue+2]=Math.round(w[Ue+2]/rt)}var ut=Ke.create(S,x),Ee=wr.create(g[0],g[1],g[2],h),Te=d?"volumeInstance":"volume";if(n)return a||(a=n.resources.texture("image-uint8","rgb","ubyte","linear")),a.load(D),{kind:"volume",texture:a,gridTexDim:ut,gridDim:p,gridTransform:Ee,type:Te};var ye=yrt({vertexCount:o,instanceCount:k,transformBuffer:l,positionBuffer:u,colorType:Te,grid:I,gridDim:p,gridTexDim:ut,gridTransform:Ee,vertexStride:3,colorStride:3});return{kind:"vertex",texture:ye,texDim:Ke.create(ye.width,ye.height),type:d?"vertexInstance":"vertex"}}function yrt(e){var t=e.vertexCount,r=e.positionBuffer,n=e.transformBuffer,a=e.grid,i=e.gridDim,o=e.gridTexDim,s=e.gridTransform,u=e.vertexStride,l=e.colorStride,c=e.colorType.endsWith("Instance"),d=c?e.instanceCount:1,f=bi(Math.max(1,d*t),3,Uint8Array),h=f.array,v=i[0],p=i[1],g=o[0],m=_.fromArray(_(),s,0),y=s[3];function b(xe,Ie,_e){var ae=Math.floor(_e*v%g/v),ie=Math.floor(_e*v/g),O=ae*v+xe;return l*(ie*p*g+Ie*g+O)}for(var S=_(),x=_(),C=_(),w=_(),A=0;A<d;++A)for(var I=0;I<t;++I){_.fromArray(S,r,I*u),c&&_.transformMat4Offset(S,S,n,0,0,A*16),_.sub(S,S,m),_.scale(S,S,y),_.floor(x,S),_.ceil(C,S),_.sub(w,S,x),_.sub(S,C,x),_.div(w,w,S);var D=x[0],k=x[1],R=x[2],L=C[0],H=C[1],B=C[2],j=w[0],Q=w[1],G=w[2],W=dt.fromArray(a,b(D,k,R)),q=dt.fromArray(a,b(L,k,R)),J=dt.fromArray(a,b(D,k,B)),he=dt.fromArray(a,b(L,k,B)),$=dt.fromArray(a,b(D,H,R)),X=dt.fromArray(a,b(L,H,R)),U=dt.fromArray(a,b(D,H,B)),z=dt.fromArray(a,b(L,H,B)),ee=dt.interpolate(W,q,j),Y=dt.interpolate(J,he,j),Z=dt.interpolate($,X,j),te=dt.interpolate(U,z,j),ce=dt.interpolate(ee,Z,Q),be=dt.interpolate(Y,te,Q);dt.toArray(dt.interpolate(ce,be,G),h,(A*t+I)*3)}return f}var brt=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    gl_FragColor.rgb = color.rgb / color.a;
}
`,xrt=`
precision highp float;

varying vec3 vPosition;
varying vec3 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    gl_FragColor = vec4(vColor, 1.0) * (p - dist);
}
`,Srt=`
precision highp float;

#include common
#include read_from_texture

uniform int uTotalCount;
uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec3 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = decodeFloatRGB(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #endif
}
`,Crt={drawCount:Ca("number"),instanceCount:Ca("number"),stride:Ca("number"),uTotalCount:Qe("i"),uInstanceCount:Qe("i"),uGroupCount:Qe("i"),aTransform:Hr("float32",16,1),aInstance:Hr("float32",1,1),aSample:Hr("float32",1,0),uGeoTexDim:Qe("v2","buffered"),tPosition:lr("texture","rgba","float","nearest"),tGroup:lr("texture","rgba","float","nearest"),uColorTexDim:Qe("v2"),tColor:lr("image-uint8","rgb","ubyte","nearest"),dColorType:Qt("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Qe("f"),uCurrentX:Qe("f"),uCurrentY:Qe("f"),uBboxMin:Qe("v3","material"),uBboxSize:Qe("v3","material"),uResolution:Qe("f","material")},yu="color-accumulate";function wre(e,t){for(var r=new Float32Array(e),n=0;n<e;++n)r[n]=n*t;return r}function _rt(e,t,r,n,a){if(e.namedComputeRenderables[yu]){var i=_.sub(_(),r.max,r.min),o=e.namedComputeRenderables[yu].values,s=Math.round(t.vertexCount/a);(s>o.drawCount.ref.value||a!==o.stride.ref.value)&&N.update(o.aSample,wre(s,a)),N.updateIfChanged(o.drawCount,s),N.updateIfChanged(o.instanceCount,t.instanceCount),N.updateIfChanged(o.stride,a),N.updateIfChanged(o.uTotalCount,t.vertexCount),N.updateIfChanged(o.uInstanceCount,t.instanceCount),N.updateIfChanged(o.uGroupCount,t.groupCount),N.update(o.aTransform,t.transformBuffer),N.update(o.aInstance,t.instanceBuffer),N.update(o.uGeoTexDim,Ke.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),N.update(o.tPosition,t.positionTexture),N.update(o.tGroup,t.groupTexture),N.update(o.uColorTexDim,Ke.set(o.uColorTexDim.ref.value,t.colorData.width,t.colorData.height)),N.update(o.tColor,t.colorData),N.updateIfChanged(o.dColorType,t.colorType),N.updateIfChanged(o.uCurrentSlice,0),N.updateIfChanged(o.uCurrentX,0),N.updateIfChanged(o.uCurrentY,0),N.update(o.uBboxMin,r.min),N.update(o.uBboxSize,i),N.updateIfChanged(o.uResolution,n),e.namedComputeRenderables[yu].update()}else e.namedComputeRenderables[yu]=wrt(e,t,r,n,a);return e.namedComputeRenderables[yu]}function wrt(e,t,r,n,a){var i=_.sub(_(),r.max,r.min),o=Math.round(t.vertexCount/a),s={drawCount:N.create(o),instanceCount:N.create(t.instanceCount),stride:N.create(a),uTotalCount:N.create(t.vertexCount),uInstanceCount:N.create(t.instanceCount),uGroupCount:N.create(t.groupCount),aTransform:N.create(t.transformBuffer),aInstance:N.create(t.instanceBuffer),aSample:N.create(wre(o,a)),uGeoTexDim:N.create(Ke.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:N.create(t.positionTexture),tGroup:N.create(t.groupTexture),uColorTexDim:N.create(Ke.create(t.colorData.width,t.colorData.height)),tColor:N.create(t.colorData),dColorType:N.create(t.colorType),uCurrentSlice:N.create(0),uCurrentX:N.create(0),uCurrentY:N.create(0),uBboxMin:N.create(r.min),uBboxSize:N.create(i),uResolution:N.create(n)},u=E({},Crt),l=Ln("accumulate",Srt,xrt),c=Za(e,"points",l,u,s);return Qa(c,s)}function Ert(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var Art=E(E({},xi),{tColor:lr("texture","rgba","float","nearest"),uTexSize:Qe("v2")}),iy="color-normalize";function Prt(e,t){if(e.namedComputeRenderables[iy]){var r=e.namedComputeRenderables[iy].values;N.update(r.tColor,t),N.update(r.uTexSize,Ke.set(r.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[iy].update()}else e.namedComputeRenderables[iy]=Trt(e,t);return e.namedComputeRenderables[iy]}function Trt(e,t){var r=E(E({},Si),{tColor:N.create(t),uTexSize:N.create(Ke.create(t.getWidth(),t.getHeight()))}),n=E({},Art),a=Ln("normalize",Ro,brt),i=Za(e,"triangles",a,n,r);return Qa(i,r)}function Irt(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function Mrt(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:n*2}}function Drt(e,t,r,n,a){var i=n.gl,o=n.resources,s=n.state,u=n.extensions,l=u.colorBufferHalfFloat,c=u.textureHalfFloat,d=e.colorType.endsWith("Instance"),f=Yt.fromSphere3D(Yt(),d?e.boundingSphere:e.invariantBoundingSphere),h=1/t,v=Yt.scale(Yt(),f,h),p=Yt.size(_(),v);_.ceil(p,p),_.add(p,p,_.create(2,2,2));var g=f.min,m=p[0],y=p[1],b=p[2],S=Mrt(p),x=S.texDimX,C=S.texDimY,w=S.texCols;n.namedTextures[yu]||(n.namedTextures[yu]=l&&c?o.texture("image-float16","rgba","fp16","nearest"):o.texture("image-float32","rgba","float","nearest"));var A=n.namedTextures[yu];A.define(x,C);var I=_rt(n,e,f,t,r),D=I.values,k=D.uCurrentSlice,R=D.uCurrentX,L=D.uCurrentY;n.namedFramebuffers[yu]||(n.namedFramebuffers[yu]=n.resources.framebuffer());var H=n.namedFramebuffers[yu];H.bind(),Ert(n),s.currentRenderItemId=-1,A.attachFramebuffer(H,0),i.viewport(0,0,x,C),i.scissor(0,0,x,C),i.clear(i.COLOR_BUFFER_BIT),N.update(L,0);for(var B=0,j=0,Q=0,G=0;G<b;++G)B>=w&&(B-=w,j+=y,Q=0,N.update(L,j)),N.update(R,Q),N.update(k,G),i.viewport(Q,j,m,y),i.scissor(Q,j,m,y),I.render(),++B,Q+=m;a||(a=o.texture("image-uint8","rgb","ubyte","linear")),a.define(x,C);var W=Prt(n,A);Irt(n),s.currentRenderItemId=-1,a.attachFramebuffer(H,0),i.viewport(0,0,x,C),i.scissor(0,0,x,C),i.clear(i.COLOR_BUFFER_BIT),W.render();var q=wr.create(g[0],g[1],g[2],h),J=d?"volumeInstance":"volume";return{texture:a,gridDim:p,gridTexDim:Ke.create(x,C),gridTransform:q,type:J}}var Ere={smoothColors:T.MappedStatic("auto",{auto:T.Group({}),on:T.Group({resolutionFactor:T.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:T.Numeric(3,{min:1,max:12,step:1})}),off:T.Group({})})};function Qb(e,t,r,n){if((e.smoothColors.name==="on"||e.smoothColors.name==="auto"&&t.color.preferSmoothing)&&r&&r<3&&n){var a=3;return e.smoothColors.name==="on"?(r*=e.smoothColors.params.resolutionFactor,a=e.smoothColors.params.sampleStride):(r*=2-gX(0,1.1,r),r=Math.max(.5,r),r>1.2&&(a=2)),{resolution:r,stride:a,webgl:n}}}function Are(e){return e==="group"||e==="groupInstance"}function vL(e,t,r,n,a){if(Are(e.dColorType.ref.value)){var i=grt({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);i.kind==="volume"?(N.updateIfChanged(e.dColorType,i.type),N.update(e.tColorGrid,i.texture),N.update(e.uColorTexDim,i.gridTexDim),N.update(e.uColorGridDim,i.gridDim),N.update(e.uColorGridTransform,i.gridTransform)):i.kind==="vertex"&&(N.updateIfChanged(e.dColorType,i.type),N.update(e.tColor,i.texture),N.update(e.uColorTexDim,i.texDim))}}function Pre(e,t,r,n,a){if(Are(e.dColorType.ref.value)){r*=3;var i=Drt({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);N.updateIfChanged(e.dColorType,i.type),N.update(e.tColorGrid,i.texture),N.update(e.uColorTexDim,i.gridTexDim),N.update(e.uColorGridDim,i.gridDim),N.update(e.uColorGridTransform,i.gridTransform)}}var Tre=E(E(E({},Kb),Ere),{ignoreHydrogens:T.Boolean(!1),tryUseGpu:T.Boolean(!0)}),mL=E(E(E({},Ci),sVe),Tre),Ire=E(E(E({},Ub),eVe),Tre);function Mre(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function c0(e,t,r){if(t.resolution>1)return!1;var n=r.maxTextureSize/3,a=dJ(e.boundary.box,t.resolution,n*n),i=a.areaCells,o=a.maxAreaCells;return i<o}function Rrt(e,t,r,n){return r.tryUseGpu&&n&&Mre(n)&&c0(t,r,n)?Urt(e):Lrt(e)}function krt(e,t,r,n){return r.tryUseGpu&&n&&Mre(n)&&c0(t,r,n)?zrt(e):Frt(e)}function Ort(e,t,r,n,a,i){return de(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p;return fe(this,function(g){switch(g.label){case 0:return o=a.smoothness,[4,_re(r,t,a).runInContext(e.runtime)];case 1:return s=g.sent(),u=s.transform,l=s.field,c=s.idField,d=s.radiusFactor,f=s.resolution,h={isoLevel:Math.exp(-o)/d,scalarField:l,idField:c},[4,rE(h,i).runAsChild(e.runtime)];case 2:return v=g.sent(),v.meta.resolution=f,Ft.transform(v,u),e.webgl&&!e.webgl.isWebGL2&&Ft.uniformTriangleGroup(v),p=je.expand(je(),t.boundary.sphere,a.radiusOffset+s0(t)),v.setBoundingSphere(p),[2,v]}})})}function Lrt(e){return oo({defaultProps:T.getDefaultValues(mL),createGeometry:Ort,createLocationIterator:ji.fromGroup,getLoci:jl,eachLocation:Ul,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&c0(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Qb(n,a,s,i);l&&(vL(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function Nrt(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,h,v;return fe(this,function(p){switch(p.label){case 0:return i=n.smoothness,[4,prt(t,n).runInContext(e.runtime)];case 1:return o=p.sent(),s=o.transform,u=o.field,l=o.idField,c=o.radiusFactor,d=o.resolution,f={isoLevel:Math.exp(-i)/c,scalarField:u,idField:l},[4,rE(f,a).runAsChild(e.runtime)];case 2:return h=p.sent(),h.meta.resolution=d,Ft.transform(h,s),e.webgl&&!e.webgl.isWebGL2&&Ft.uniformTriangleGroup(h),v=je.expand(je(),t.boundary.sphere,n.radiusOffset+Q3(t)),h.setBoundingSphere(v),[2,h]}})})}function Frt(e){return xv({defaultProps:T.getDefaultValues(Ire),createGeometry:Nrt,createLocationIterator:ji.fromStructure,getLoci:uE,eachLocation:sE,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&c0(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Qb(n,a,s,i);l&&(vL(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var ng="gaussian-surface";function Brt(e,t,r,n,a,i){return de(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,g,m,y,b;return fe(this,function(S){switch(S.label){case 0:if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");return o=e.webgl,s=o.namedTextures,u=o.resources,l=o.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,h=l.textureHalfFloat,s[ng]||(s[ng]=f&&h?u.texture("image-float16","rgba","fp16","linear"):c&&d?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),[4,hrt(r,t,!0,a,e.webgl,s[ng]).runInContext(e.runtime)];case 1:return v=S.sent(),p=Math.exp(-a.smoothness)/v.radiusFactor,g=i==null?void 0:i.doubleBuffer.get(),m=VO(e.webgl,v.texture,v.gridDim,v.gridTexDim,v.gridTexScale,v.transform,p,!1,!0,g==null?void 0:g.vertex,g==null?void 0:g.group,g==null?void 0:g.normal),y=je.expand(je(),t.boundary.sphere,a.radiusOffset+Q3(r)),b=Vu.create(m.vertexCount,1,m.vertexTexture,m.groupTexture,m.normalTexture,y,i),b.meta={resolution:v.resolution},[2,b]}})})}function Urt(e){return uVe({defaultProps:T.getDefaultValues(mL),createGeometry:Brt,createLocationIterator:ji.fromGroup,getLoci:jl,eachLocation:Ul,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!c0(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Qb(n,a,s,i);l&&(Pre(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function jrt(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,h,v,p,g,m,y;return fe(this,function(b){switch(b.label){case 0:if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");return i=e.webgl,o=i.namedTextures,s=i.resources,u=i.extensions,l=u.colorBufferFloat,c=u.textureFloat,d=u.colorBufferHalfFloat,f=u.textureHalfFloat,o[ng]||(o[ng]=d&&f?s.texture("image-float16","rgba","fp16","linear"):l&&c?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear")),[4,mrt(t,!0,n,e.webgl,o[ng]).runInContext(e.runtime)];case 1:return h=b.sent(),v=Math.exp(-n.smoothness)/h.radiusFactor,p=a==null?void 0:a.doubleBuffer.get(),g=VO(e.webgl,h.texture,h.gridDim,h.gridTexDim,h.gridTexScale,h.transform,v,!1,!0,p==null?void 0:p.vertex,p==null?void 0:p.group,p==null?void 0:p.normal),m=je.expand(je(),t.boundary.sphere,n.radiusOffset+Q3(t)),y=Vu.create(g.vertexCount,1,g.vertexTexture,g.groupTexture,g.normalTexture,m,a),y.meta={resolution:h.resolution},[2,y]}})})}function zrt(e){return tVe({defaultProps:T.getDefaultValues(Ire),createGeometry:jrt,createLocationIterator:ji.fromStructure,getLoci:uE,eachLocation:sE,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!c0(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Qb(n,a,s,i);l&&(Pre(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function Vrt(e,t,r,n,a,i){return de(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h;return fe(this,function(v){switch(v.label){case 0:return o=a.smoothness,[4,_re(r,t,a).runInContext(e.runtime)];case 1:return s=v.sent(),u=s.transform,l=s.field,c=s.idField,d={isoLevel:Math.exp(-o),scalarField:l,idField:c},[4,jO(d,i).runAsChild(e.runtime)];case 2:return f=v.sent(),Cn.transform(f,u),h=je.expand(je(),t.boundary.sphere,a.radiusOffset+s0(t)),f.setBoundingSphere(h),[2,f]}})})}var Dre=E(E(E({},yO),Kb),{sizeFactor:T.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:T.Boolean(!1),ignoreHydrogens:T.Boolean(!1)});function Hrt(e){return bO({defaultProps:T.getDefaultValues(Dre),createGeometry:Vrt,createLocationIterator:ji.fromGroup,getLoci:jl,eachLocation:Ul,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var Rre={"gaussian-surface-mesh":function(e,t){return na("Gaussian surface mesh",e,t,Rrt)},"structure-gaussian-surface-mesh":function(e,t){return Du("Structure-Gaussian surface mesh",e,t,krt)},"gaussian-surface-wireframe":function(e,t){return na("Gaussian surface wireframe",e,t,Hrt)}},kre=E(E(E({},mL),Dre),{visuals:T.MultiSelect(["gaussian-surface-mesh"],T.objectToOptions(Rre))});function Grt(e,t){return T.clone(kre)}function qrt(e,t){return sr.createMulti("Gaussian Surface",e,t,Ba,Rre)}var Wrt={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:qrt,getParams:Grt,defaultValues:T.getDefaultValues(kre),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},Ore=E(E({},Kze),{background:T.Boolean(!0),backgroundMargin:T.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:T.Color(dr.black),backgroundOpacity:T.Numeric(.5,{min:0,max:1,step:.01}),level:T.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]]),chainScale:T.Numeric(10,{min:0,max:20,step:.1}),residueScale:T.Numeric(1,{min:0,max:20,step:.1}),elementScale:T.Numeric(.5,{min:0,max:20,step:.1})});function $rt(e){return Qze({defaultProps:T.getDefaultValues(Ore),createGeometry:Xrt,createLocationIterator:ji.fromStructure,getLoci:uE,eachLocation:sE,setUpdateState:function(t,r,n){t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale}},e)}function Xrt(e,t,r,n,a){switch(n.level){case"chain":return Yrt(e,t,r,n,a);case"residue":return Krt(e,t,r,n,a);case"element":return Qrt(e,t,r,n,a)}}var Fs=_(),oy=new ls("98");function Yrt(e,t,r,n,a){for(var i=at.create(t),o=t.units,s=t.serialMapping,u=pt.chain,l=u.auth_asym_id,c=u.label_asym_id,d=s.cumulativeUnitElementCount,f=o.length,h=n.chainScale,v=Zc.create(n,f,f/2,a),p=0,g=o.length;p<g;++p){var m=o[p];i.unit=m,i.element=m.elements[0];var y=m.lookup3d.boundary.sphere,b=y.center,S=y.radius;_.transformMat4(Fs,b,m.conformation.operator.matrix);var x=l(i),C=c(i),w=x===C?C:C+" ["+x+"]";v.add(w,Fs[0],Fs[1],Fs[2],S,h,d[p])}return v.getText()}function Krt(e,t,r,n,a){for(var i=at.create(t),o=t.units,s=t.serialMapping,u=pt.atom.label_comp_id,l=pt.residue.auth_seq_id,c=s.cumulativeUnitElementCount,d=t.polymerResidueCount*2,f=n.residueScale,h=Zc.create(n,d,d/2,a),v=0,p=o.length;v<p;++v){var g=o[v],m=g.conformation.position,y=g.elements;i.unit=g,i.element=g.elements[0];for(var b=g.model.atomicHierarchy.residueAtomSegments.index,S=c[v],x=0,C=y.length;x<C;){var w=x,A=b[y[x]];for(x++;x<C&&b[y[x]]===A;)x++;oy.reset();for(var I=w;I<x;I++)m(y[I],Fs),oy.includePosition(Fs);oy.finishedIncludeStep();for(var I=w;I<x;I++)m(y[I],Fs),oy.radiusPosition(Fs);i.element=y[w];var D=oy.getSphere(),k=D.center,R=D.radius,L=l(i),H=u(i),B=H+" "+L;h.add(B,k[0],k[1],k[2],R,f,S+w)}}return h.getText()}function Qrt(e,t,r,n,a){for(var i=at.create(t),o=t.units,s=t.serialMapping,u=pt.atom,l=u.label_atom_id,c=u.label_alt_id,d=s.cumulativeUnitElementCount,f=Fb({},{scale:1}),h=t.elementCount,v=n.elementScale,p=Zc.create(n,h,h/2,a),g=0,m=o.length;g<m;++g){var y=o[g],b=y.conformation.position,S=y.elements;i.unit=y;for(var x=d[g],C=0,w=S.length;C<w;C++){i.element=S[C],b(i.element,Fs);var A=l(i),I=c(i),D=I?A+"%"+I:A;p.add(D,Fs[0],Fs[1],Fs[2],f.size(i),v,x+C)}}return p.getText()}var Lre={"label-text":function(e,t){return Du("Label text",e,t,$rt)}},Nre=E(E({},Ore),{visuals:T.MultiSelect(["label-text"],T.objectToOptions(Lre))});function Zrt(e,t){return T.clone(Nre)}function Jrt(e,t){var r=sr.createMulti("Label",e,t,Ba,Lre);return r.setState({pickable:!1,markerActions:tr.None}),r}var ent={name:"label",label:"Label",description:"Displays labels.",factory:Jrt,getParams:Zrt,defaultValues:T.getDefaultValues(Nre),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}};function tnt(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function rnt(e){for(var t=0,r=2*Math.PI/e,n=new Float32Array(e),a=new Float32Array(e),i=0;i<e;i++)n[i]=Math.cos(t),a[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:a}}var gL={probeRadius:T.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:T.Numeric(.5,{min:.01,max:20,step:.01},E({description:"Grid resolution/cell spacing."},At.CustomQualityParamInfo)),probePositions:T.Numeric(36,{min:12,max:90,step:1},E({description:"Number of positions tested for probe target intersection."},At.CustomQualityParamInfo))};T.getDefaultValues(gL);function nnt(e,t,r,n,a,i){return de(this,void 0,void 0,function(){function o($e,Ze,ht,Ue,rt){if(h!==-1){var ut=h;if(ut!==Ue&&ut!==rt&&s(ut,$e,Ze,ht))return ut;h=-1}for(var Ee=0,Te=I.count;Ee<Te;++Ee){var ut=Fe.getAt(D,I.indices[Ee]);if(ut!==Ue&&ut!==rt&&s(ut,$e,Ze,ht))return h=ut,ut}return-1}function s($e,Ze,ht,Ue){var rt=B[$e],ut=k[$e]-Ze,Ee=R[$e]-ht,Te=L[$e]-Ue,ye=ut*ut+Ee*Ee+Te*Te;return ye<rt*rt}function u($e,Ze){for(var ht=$e;ht<Ze;++ht){var Ue=Fe.getAt(D,ht),rt=k[Ue],ut=R[Ue],Ee=L[Ue],Te=B[Ue],ye=Te*Te;A.find(rt,ut,Ee,Te);for(var Se=Math.ceil(Te*x),Le=Math.floor(x*(rt-q)),Ve=Math.floor(x*(ut-J)),nt=Math.floor(x*(Ee-he)),Xe=Math.max(0,Le-Se),He=Math.max(0,Ve-Se),se=Math.max(0,nt-Se),pe=Math.min(U,Le+Se+2),Ae=Math.min(z,Ve+Se+2),Ye=Math.min(ee,nt+Se+2),ct=Xe;ct<pe;++ct)for(var St=ie[ct]-rt,Bt=ct*te,rr=He;rr<Ae;++rr)for(var hr=O[rr]-ut,Lt=St*St+hr*hr,En=rr*Y+Bt,ha=se;ha<Ye;++ha){var pa=V[ha]-Ee,ui=Lt+pa*pa;if(ui<ye){var Vi=ha+En;_e[Vi]<0&&(_e[Vi]*=-1);var tn=Math.sqrt(ui),Xn=Te/tn,so=St*Xn+rt,tu=hr*Xn+ut,An=pa*Xn+Ee;if(o(so,tu,An,Ue,-1)===-1){var fs=Te-tn;fs<_e[Vi]&&(_e[Vi]=fs,ae[Vi]=H[ht])}}}}}function l(){return de(this,void 0,void 0,function(){var $e;return fe(this,function(Ze){switch(Ze.label){case 0:$e=0,Ze.label=1;case 1:return $e<j?(u($e,Math.min($e+ve,j)),e.shouldUpdate?[4,e.update({message:"projecting points",current:$e,max:j})]:[3,3]):[3,4];case 2:Ze.sent(),Ze.label=3;case 3:return $e+=ve,[3,1];case 4:return[2]}})})}function c($e,Ze){var ht=B[$e],Ue=B[Ze],rt=v[0]=k[Ze]-k[$e],ut=v[1]=R[Ze]-R[$e],Ee=v[2]=L[Ze]-L[$e],Te=rt*rt+ut*ut+Ee*Ee,ye=Math.sqrt(Te),Se=(ht*ht+ye*ye-Ue*Ue)/(2*ht*ye),Le=ht*Se;_.normalize(v,v),tnt(g,v),_.normalize(g,g),_.cross(m,v,g),_.normalize(m,m);var Ve=Math.sqrt(ht*ht-Le*Le);_.scale(g,g,Ve),_.scale(m,m,Ve),_.scale(v,v,Le),p[0]=v[0]+k[$e],p[1]=v[1]+R[$e],p[2]=v[2]+L[$e],h=-1;for(var nt=0;nt<S;++nt){var Xe=be[nt],He=xe[nt],se=p[0]+Xe*g[0]+He*m[0],pe=p[1]+Xe*g[1]+He*m[1],Ae=p[2]+Xe*g[2]+He*m[2];if(o(se,pe,Ae,$e,Ze)===-1)for(var Ye=Math.floor(x*(se-q)),ct=Math.floor(x*(pe-J)),St=Math.floor(x*(Ae-he)),Bt=Math.max(0,Ye-C),rr=Math.max(0,ct-C),hr=Math.max(0,St-C),Lt=Math.min(U,Ye+C+2),En=Math.min(z,ct+C+2),ha=Math.min(ee,St+C+2),pa=Bt;pa<Lt;++pa)for(var ui=se-ie[pa],Vi=pa*te,tn=rr;tn<En;++tn)for(var Xn=pe-O[tn],so=ui*ui+Xn*Xn,tu=tn*Y+Vi,An=hr;An<ha;++An){var fs=Ae-V[An],bh=so+fs*fs,zl=An+tu,xh=_e[zl];if(xh>0&&bh<xh*xh){_e[zl]=Math.sqrt(bh);var Hi=ui*v[0]+Xn*v[1]+fs*v[2];ae[zl]=H[Fe.indexOf(D,Hi<0?Ze:$e)]}}}}function d($e,Ze){for(var ht=$e;ht<Ze;++ht){var Ue=Fe.getAt(D,ht);A.find(k[Ue],R[Ue],L[Ue],B[Ue]);for(var rt=0,ut=I.count;rt<ut;++rt){var Ee=Fe.getAt(D,I.indices[rt]);Ue<Ee&&c(Ue,Ee)}}}function f(){return de(this,void 0,void 0,function(){var $e;return fe(this,function(Ze){switch(Ze.label){case 0:$e=0,Ze.label=1;case 1:return $e<j?(d($e,Math.min($e+ve,j)),e.shouldUpdate?[4,e.update({message:"projecting torii",current:$e,max:j})]:[3,3]):[3,4];case 2:Ze.sent(),Ze.label=3;case 3:return $e+=ve,[3,1];case 4:return[2]}})})}var h,v,p,g,m,y,b,S,x,C,w,A,I,D,k,R,L,H,B,j,Q,G,W,q,J,he,$,X,U,z,ee,Y,Z,te,ce,be,xe,Ie,_e,ae,ie,O,V,ve,Pe,Me,Ge;return fe(this,function($e){switch($e.label){case 0:return h=-1,v=_(),p=_(),g=_(),m=_(),y=i.resolution,b=i.probeRadius,S=i.probePositions,x=1/y,C=Math.max(5,2+Math.floor(b*x)),w=_.create(n,n,n),_.scale(w,w,2),A=Gp(t,r,w),I=A.result,a===null&&(a=A.boundary.box),D=t.indices,k=t.x,R=t.y,L=t.z,H=t.id,B=t.radius,j=Fe.size(D),Q=n+y,G=Yt.expand(Yt(),a,_.create(Q,Q,Q)),W=G.min,q=W[0],J=W[1],he=W[2],$=Yt.scale(Yt(),G,x),X=Yt.size(_(),$),_.ceil(X,X),U=X[0],z=X[1],ee=X[2],Y=ee,Z=z,te=Y*Z,ce=rnt(S),be=ce.cosTable,xe=ce.sinTable,Ie=Pr.Space(X,[0,1,2],Float32Array),_e=Ie.create(),ae=Ie.create(),_e.fill(-1001),ae.fill(-1),ie=Km(U,q,y),O=Km(z,J,y),V=Km(ee,he,y),ve=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*x)),[4,l()];case 1:return $e.sent(),[4,f()];case 2:return $e.sent(),Pe=Pr.create(Ie,_e),Me=Pr.create(Ie,ae),Ge=le.identity(),le.fromScaling(Ge,_.create(y,y,y)),le.setTranslation(Ge,G.min),[2,{field:Pe,idField:Me,transform:Ge,resolution:y}]}})})}function ant(e,t,r){for(var n=r.probeRadius,a=K3(e,t,r),i=a.position,o=a.boundary,s=a.radius,u=i.indices,l=Fe.size(u),c=new Float32Array(Fe.end(u)),d=0,f=0;f<l;++f){var h=Fe.getAt(u,f),v=s(h);d<v&&(d=v),c[h]=v+n}return{position:E(E({},i),{radius:c}),boundary:o,maxRadius:d}}function Fre(e,t,r){var n=this,a=t.lookup3d.boundary.box,i=bv(a,r),o=ant(e,t,i),s=o.position,u=o.boundary,l=o.maxRadius;return et.create("Molecular Surface",function(c){return de(n,void 0,void 0,function(){return fe(this,function(d){switch(d.label){case 0:return[4,int(c,s,u,l,a,i)];case 1:return[2,d.sent()]}})})})}function int(e,t,r,n,a,i){return de(this,void 0,void 0,function(){return fe(this,function(o){return[2,nnt(e,t,r,n,a,i)]})})}var Bre=E(E(E(E({},Ci),gL),Y3),Ere);function ont(e,t,r,n,a,i){return de(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h;return fe(this,function(v){switch(v.label){case 0:return[4,Fre(r,t,a).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,u=o.field,l=o.idField,c=o.resolution,d={isoLevel:a.probeRadius,scalarField:u,idField:l},[4,rE(d,i).runAsChild(e.runtime)];case 2:return f=v.sent(),Ft.transform(f,s),e.webgl&&!e.webgl.isWebGL2&&Ft.uniformTriangleGroup(f),h=je.expand(je(),t.boundary.sphere,a.probeRadius+s0(t)),f.setBoundingSphere(h),f.meta.resolution=c,[2,f]}})})}function snt(e){return oo({defaultProps:T.getDefaultValues(Bre),createGeometry:ont,createLocationIterator:ji.fromGroup,getLoci:jl,eachLocation:Ul,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Qb(n,a,s,i);l&&(vL(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var Ure=E(E(E(E({},yO),gL),Y3),{sizeFactor:T.Numeric(1.5,{min:0,max:10,step:.1})});function unt(e,t,r,n,a,i){return de(this,void 0,void 0,function(){var o,s,u,l,c,d,f;return fe(this,function(h){switch(h.label){case 0:return[4,Fre(r,t,a).runInContext(e.runtime)];case 1:return o=h.sent(),s=o.transform,u=o.field,l=o.idField,c={isoLevel:a.probeRadius,scalarField:u,idField:l},[4,jO(c,i).runAsChild(e.runtime)];case 2:return d=h.sent(),Cn.transform(d,s),f=je.expand(je(),t.boundary.sphere,a.probeRadius+s0(t)),d.setBoundingSphere(f),[2,d]}})})}function lnt(e){return bO({defaultProps:T.getDefaultValues(Ure),createGeometry:unt,createLocationIterator:ji.fromGroup,getLoci:jl,eachLocation:Ul,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var jre={"molecular-surface-mesh":function(e,t){return na("Molecular surface mesh",e,t,snt)},"molecular-surface-wireframe":function(e,t){return na("Molecular surface wireframe",e,t,lnt)}},zre=E(E(E({},Bre),Ure),{visuals:T.MultiSelect(["molecular-surface-mesh"],T.objectToOptions(jre))});function cnt(e,t){return T.clone(zre)}function dnt(e,t){return sr.createMulti("Molecular Surface",e,t,Ba,jre)}var fnt={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:dnt,getParams:cnt,defaultValues:T.getDefaultValues(zre),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},Vre=E(E({},Ci),{sizeFactor:T.Numeric(1,{min:0,max:2,step:.1}),detail:T.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo)});function hnt(e){return oo({defaultProps:T.getDefaultValues(Vre),createGeometry:vnt,createLocationIterator:mnt,getLoci:gnt,eachLocation:ynt,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function pnt(e){if(We.Traits.is(e.traits,1)||We.Traits.is(e.traits,2))return!1;if(We.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;var t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function vnt(e,t,r,n,a,i){if(!pnt(t))return Ft.createEmpty(i);var o=a.detail,s=a.sizeFactor,u=256,l=Et.createState(u,u/2,i),c=t.principalAxes.boxAxes,d=c.origin,f=c.dirA,h=c.dirB,v=Su.size(_(),c);_.scale(v,v,s/2);var p=_.create(v[2],v[1],v[0]);l.currentGroup=0,dO(l,d,f,h,p,o+1);var g=Et.getMesh(l),m=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return g.setBoundingSphere(m),g}function mnt(e){var t=e.group,r=e.structure,n=1,a=t.units.length,i=at.create(r),o=function(s,u){var l=t.units[u];return i.unit=l,i.element=l.elements[s],i};return bn(n,a,1,o)}function gnt(e,t,r){var n=e.objectId,a=e.instanceId;if(r===n){var i=t.structure,o=t.group,s=o.units[a],u=Fe.ofBounds(0,s.elements.length);return Oe(i,[{unit:s,indices:u}])}return Or}function ynt(e,t,r){var n=!1;if(!Oe.is(e))return!1;var a=t.structure,i=t.group;if(!tt.areEquivalent(e.structure,a))return!1;for(var o=i.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.unit.id);c!==void 0&&Fe.size(l.indices)===o&&r(Re.ofSingleton(c))&&(n=!0)}return n}var Hre={"orientation-ellipsoid-mesh":function(e,t){return na("Orientation ellipsoid mesh",e,t,hnt)}},Gre=E(E({},Vre),{visuals:T.MultiSelect(["orientation-ellipsoid-mesh"],T.objectToOptions(Hre))});function bnt(e,t){return T.clone(Gre)}function xnt(e,t){return sr.createMulti("Orientation",e,t,Ba,Hre)}var Snt={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:xnt,getParams:bnt,defaultValues:T.getDefaultValues(Gre),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},Cnt=Je.add3,_nt=Je.add,a5;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Je.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=Je.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(s,u,l,c){Cnt(i,s,u,l),_nt(o,c)},getPoints:function(){var s=Je.compact(i,!0),u=Je.compact(o,!0);return Qp.create(s,u,i.elementCount,a)}}}e.create=t})(a5||(a5={}));var qre=E(E({},nVe),{pointSizeAttenuation:T.Boolean(!0),ignoreHydrogens:T.Boolean(!1),traceOnly:T.Boolean(!1)});function wnt(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return Qp.createEmpty(i);var s=t.elements,u=s.length,l=a5.create(u,u/10,i),c=_(),d=t.conformation.invariantPosition,f=lL(r,t,a);if(f)for(var h=0;h<u;++h)f(s[h])||(d(s[h],c),l.add(c[0],c[1],c[2],h));else for(var h=0;h<u;++h)d(s[h],c),l.add(c[0],c[1],c[2],h);var v=l.getPoints(),p=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return v.setBoundingSphere(p),v}function Ent(e){return aVe({defaultProps:T.getDefaultValues(qre),createGeometry:wnt,createLocationIterator:ji.fromGroup,getLoci:jl,eachLocation:Ul,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly}},e)}var Ant={"element-point":function(e,t){return na("Points",e,t,Ent)}},Wre=E({},qre);function Pnt(e,t){return T.clone(Wre)}function Tnt(e,t){return sr.createMulti("Point",e,t,Ba,Ant)}var Int={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as spheres.",factory:Tnt,getParams:Pnt,defaultValues:T.getDefaultValues(Wre),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},$re={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),detail:T.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),linearSegments:T.Numeric(8,{min:1,max:48,step:1},At.CustomQualityParamInfo),radialSegments:T.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo)};T.getDefaultValues($re);var vo=_();function Mnt(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Ft.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,l=a.linearSegments,c=a.radialSegments,d=l*c*o+(c+1)*o*2,f=Et.createState(d,d/10,i),h=dL(l),v=h.curvePoints,p=h.normalVectors,g=h.binormalVectors,m=h.widthValues,y=h.heightValues,b=0,S=cL(t,r,{ignoreSecondaryStructure:!0});S.hasNext;){var x=S.move();f.currentGroup=b;var C=Fl(x.moleculeType),w=C?dE:cE;fL(h,x,qte,w);var A=x.coarseBackboneFirst||x.first,I=x.coarseBackboneLast||x.last,D=n.size.size(x.centerPrev)*s,k=n.size.size(x.center)*s,R=n.size.size(x.centerNext)*s;e5(h,D,k,R,D,k,R,w);var L=l;if(x.initial){L=Math.max(Math.round(l*w),1);var H=l-L;v.copyWithin(0,H*3),g.copyWithin(0,H*3),p.copyWithin(0,H*3),m.copyWithin(0,H*3),y.copyWithin(0,H*3),_.fromArray(vo,v,3),_.normalize(vo,_.sub(vo,x.p2,vo)),_.scaleAndAdd(vo,x.p2,vo,k*$_),_.toArray(vo,v,0)}else x.final&&(L=Math.max(Math.round(l*(1-w)),1),_.fromArray(vo,v,L*3-3),_.normalize(vo,_.sub(vo,x.p2,vo)),_.scaleAndAdd(vo,x.p2,vo,k*$_),_.toArray(vo,v,L*3));x.initial===!0&&x.final===!0?Na(f,x.p2,k*2,u):c===2?PS(f,v,p,g,L,m,y,0):c===4?n5(f,v,p,g,L,m,y,0,A,I):are(f,v,p,g,L,c,m,y,A,I),++b}var B=Et.getMesh(f),j=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return B.setBoundingSphere(j),B}var Xre=E(E({},Ci),$re);function Dnt(e){return oo({defaultProps:T.getDefaultValues(Xre),createGeometry:Mnt,createLocationIterator:id.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var Yre={"polymer-tube":function(e,t){return na("Polymer tube mesh",e,t,Dnt)},"polymer-gap":function(e,t){return na("Polymer gap cylinder",e,t,hL)}},Kre=E(E(E({},Xre),fE),{sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),visuals:T.MultiSelect(["polymer-tube","polymer-gap"],T.objectToOptions(Yre))});function Rnt(e,t){var r=T.clone(Kre),n=!1,a=!1;return t.units.forEach(function(i){!n&&We.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-tube"],a&&r.visuals.defaultValue.push("polymer-gap"),r}function knt(e,t){return sr.createMulti("Putty",e,t,Ba,Yre)}var Ont={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:knt,getParams:Rnt,defaultValues:T.getDefaultValues(Kre),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:function(e){return e.polymerResidueCount>0}},Lnt={"element-sphere":function(e,t){return na("Sphere mesh",e,t,Rte)}},Qre=E({},lE);function Nnt(e,t){var r=T.clone(Qre);return t.isCoarseGrained&&(r.sizeFactor.defaultValue=2),r}function Fnt(e,t){return sr.createMulti("Spacefill",e,t,Ba,Lnt)}var Bnt={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:Fnt,getParams:Nnt,defaultValues:T.getDefaultValues(Qre),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},ZT=Nr.is;function Unt(e,t,r,n,a,i){if(!We.isAtomic(t))return Cn.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Cn.createEmpty(i);var u=at.create(r,t),l=t.elements,c=t.bonds,d=c.edgeCount,f=c.a,h=c.b,v=c.edgeProps,p=c.offset,g=v.order,m=v.flags,y=a.sizeFactor,b=a.aromaticBonds;if(!d)return Cn.createEmpty(i);var S=_(),x=t.conformation.invariantPosition,C=t.rings,w=C.elementRingIndices,A=C.elementAromaticRingIndices,I={linkCount:d*2,referencePosition:function(R){var L,H,B=f[R],j=h[R];B>j&&(L=[j,B],B=L[0],j=L[1]),p[B+1]-p[B]===1&&(H=[j,B],B=H[0],j=H[1]);for(var Q=w.get(B),G=0,W=p[B],q=p[B+1];W<q;++W){var J=h[W];if(J!==j&&J!==B)if(Q){var he=w.get(J);if(!he)continue;var $=jC(Q,he);$>G&&(G=$,x(l[J],S))}else return x(l[J],S)}return G>0?S:null},position:function(R,L,H){x(l[f[H]],R),x(l[h[H]],L)},style:function(R){var L=g[R],H=m[R];if(ZT(H,2)||ZT(H,4))return 1;if(L===3)return 3;if(b){var B=f[R],j=h[R],Q=A.get(B),G=A.get(j),W=Q&&G?jC(Q,G):0;if(W||ZT(H,16))return W===2?6:5}return L===2?2:0},radius:function(R){u.element=l[f[R]];var L=n.size.size(u);u.element=l[h[R]];var H=n.size.size(u);return Math.min(L,H)*y},ignore:Ete(r,t,a)},D=LJ(e,I,a,i),k=je.expand(je(),(s??t).boundary.sphere,1*y);return D.setBoundingSphere(k),D}var Zre=E(E(E({},yO),aL),{includeParent:T.Boolean(!1)});function jnt(e){return bO({defaultProps:T.getDefaultValues(Zre),createGeometry:Unt,createLocationIterator:sh.fromGroup,getLoci:iL,eachLocation:oL,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!to(r.includeTypes,n.includeTypes)||!to(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];We.isAtomic(u)&&We.isAtomic(l)&&(To.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var JT=new Gt.ElementBondIterator;function vV(e,t,r,n){for(JT.setElement(t,r,n);JT.hasNext;){var a=JT.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}function znt(e,t,r,n,a){var i=t.interUnitBonds,o=i.edgeCount,s=i.edges,u=n.sizeFactor,l=n.aromaticBonds;if(!o)return Cn.createEmpty(a);var c=_(),d=at.create(),f={linkCount:o,referencePosition:function(g){var m=s[g],y,b,S,x;if(m.unitA<m.unitB)y=t.unitMap.get(m.unitA),b=t.unitMap.get(m.unitB),S=m.indexA,x=m.indexB;else if(m.unitA>m.unitB)y=t.unitMap.get(m.unitB),b=t.unitMap.get(m.unitA),S=m.indexB,x=m.indexA;else throw new Error("same units in createInterUnitBondLines");return vV(c,t,y,S)||vV(c,t,b,x)},position:function(g,m,y){var b=s[y],S=t.unitMap.get(b.unitA),x=t.unitMap.get(b.unitB);S.conformation.position(S.elements[b.indexA],g),x.conformation.position(x.elements[b.indexB],m)},style:function(g){var m=s[g].props.order,y=mi.create(s[g].props.flag);return Nr.is(y,2)||Nr.is(y,4)?1:m===3?3:l&&Nr.is(y,16)?5:m===2?2:0},radius:function(g){var m=s[g];d.structure=t,d.unit=t.unitMap.get(m.unitA),d.element=d.unit.elements[m.indexA];var y=r.size.size(d);d.unit=t.unitMap.get(m.unitB),d.element=d.unit.elements[m.indexB];var b=r.size.size(d);return Math.min(y,b)*u},ignore:Ate(t,n)},h=LJ(e,f,n,a),v=t.child,p=je.expand(je(),(v??t).boundary.sphere,1*n.sizeFactor);return h.setBoundingSphere(p),h}var Jre=E(E(E({},Xze),aL),{includeParent:T.Boolean(!1)});function Vnt(e){return Yze({defaultProps:T.getDefaultValues(Jre),createGeometry:znt,createLocationIterator:sh.fromStructure,getLoci:sL,eachLocation:uL,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!to(r.includeTypes,n.includeTypes)||!to(r.excludeTypes,n.excludeTypes)}},e)}var ene={"intra-bond":function(e,t){return na("Intra-unit bond line",e,t,jnt)},"inter-bond":function(e,t){return Du("Inter-unit bond line",e,t,Vnt)}},tne=E(E(E({},Zre),Jre),{includeParent:T.Boolean(!1),sizeFactor:T.Numeric(1.5,{min:.01,max:10,step:.01}),unitKinds:Bb(["atomic"]),visuals:T.MultiSelect(["intra-bond","inter-bond"],T.objectToOptions(ene))});function Hnt(e,t){return T.clone(tne)}function Gnt(e,t){return sr.createMulti("Line",e,t,Ba,ene)}var qnt={name:"line",label:"Line",description:"Displays bonds as lines.",factory:Gnt,getParams:Hnt,defaultValues:T.getDefaultValues(tne),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function Wnt(e,t,r,n,a){return de(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,h,v,p,g,m;return fe(this,function(y){switch(y.label){case 0:if(i=e.runtime,o=e.webgl,!o||!o.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");return s=a?a.gridTexture.ref.value:void 0,[4,vrt(t,n,o,s).runInContext(i)];case 1:return u=y.sent(),l=u.transform,c=u.texture,d=u.bbox,f=u.gridDim,h={min:0,max:1,mean:.04,sigma:.01},v=le.mul(le(),l,le.fromScaling(le(),f)),p=le.getScaling(_(),l),g=ro.create(d,f,l,v,p,c,h,!0,a),m=je.expand(je(),t.boundary.sphere,n.radiusOffset+Q3(t)),g.setBoundingSphere(m),[2,g]}})})}var rne=E(E(E({},Zze),Kb),{ignoreHydrogens:T.Boolean(!1)});function $nt(e){return Jze({defaultProps:T.getDefaultValues(rne),createGeometry:Wnt,createLocationIterator:ji.fromStructure,getLoci:uE,eachLocation:sE,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function Xnt(e,t,r,n,a,i){return de(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,g,m,y;return fe(this,function(b){switch(b.label){case 0:if(o=e.runtime,s=e.webgl,!s)throw new Error("GaussianDensityVolume requires `webgl`");return u=i?i.gridTexture.ref.value:void 0,[4,frt(r,t,a,s,u).runInContext(o)];case 1:return l=b.sent(),c=l.transform,d=l.texture,f=l.bbox,h=l.gridDim,v={min:0,max:1,mean:.04,sigma:.01},p=le.mul(le(),c,le.fromScaling(le(),h)),g=le.getScaling(_(),c),m=ro.create(f,h,c,p,g,d,v,!0,i),y=je.expand(je(),t.boundary.sphere,a.radiusOffset+s0(t)),m.setBoundingSphere(y),[2,m]}})})}var Ynt=E(E(E({},iVe),Kb),{ignoreHydrogens:T.Boolean(!1)});function Knt(e){return oVe({defaultProps:T.getDefaultValues(Ynt),createGeometry:Xnt,createLocationIterator:ji.fromGroup,getLoci:jl,eachLocation:Ul,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var nne={"gaussian-volume":function(e,t){return Du("Gaussian volume",e,t,$nt)},"units-gaussian-volume":function(e,t){return na("Units-Gaussian volume",e,t,Knt)}},ane=E(E({},rne),{visuals:T.MultiSelect(["gaussian-volume"],T.objectToOptions(nne))});function Qnt(e,t){var r=T.clone(ane);return r.renderMode=ro.createRenderModeParam({min:0,max:1,mean:.04,sigma:.01}),r.jumpLength=T.Numeric(4,{min:0,max:20,step:.1}),r}function Znt(e,t){return sr.createMulti("Gaussian Volume",e,t,Ba,nne)}var Jnt={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:Znt,getParams:Qnt,defaultValues:T.getDefaultValues(ane),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},eat=_.scale,tat=_.add,rat=_.sub,yL=E(E(E({},Ci),SJ),{sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:T.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo),tryUseImpostor:T.Boolean(!0)});function nat(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?iat(e):sat(e)}function aat(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Ko.createEmpty(i);var s=o*2,u=T_.create(s,s/4,i),l=t.conformation.invariantPosition,c=_(),d=_(),f=_(),h=function(g,m,y,b,S){l(g,c),l(m,d);var x=Fl(S),C=x?dE:cE;tat(f,c,eat(f,rat(f,d,c),C)),u.add(c[0],c[1],c[2],f[0],f[1],f[2],1,!1,!1,y),u.add(f[0],f[1],f[2],d[0],d[1],d[2],1,!1,!1,b)};zte(t,h);var v=u.getCylinders(),p=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return v.setBoundingSphere(p),v}function iat(e){return CJ({defaultProps:T.getDefaultValues(yL),createGeometry:aat,createLocationIterator:id.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function oat(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Ft.createEmpty(i);var s=a.radialSegments,u=a.sizeFactor,l=s*2*o*2,c=Et.createState(l,l/10,i),d=t.conformation.invariantPosition,f=_(),h=_(),v={radiusTop:1,radiusBottom:1,radialSegments:s},p=at.create(r,t),g=at.create(r,t),m=function(S,x,C,w,A){p.element=S,g.element=x,d(p.element,f),d(g.element,h);var I=Fl(A),D=I?dE:cE;v.radiusTop=v.radiusBottom=n.size.size(p)*u,c.currentGroup=C,Oi(c,f,h,D,v),v.radiusTop=v.radiusBottom=n.size.size(g)*u,c.currentGroup=w,Oi(c,h,f,1-D,v)};zte(t,m);var y=Et.getMesh(c),b=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return y.setBoundingSphere(b),y}function sat(e){return oo({defaultProps:T.getDefaultValues(yL),createGeometry:oat,createLocationIterator:id.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var bL=E(E(E({},Ci),bJ),{sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),detail:T.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),tryUseImpostor:T.Boolean(!0)});function uat(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?cat(e):fat(e)}function lat(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return ah.createEmpty(i);var s=W_.create(o,o/2,i),u=t.conformation.invariantPosition,l=_(),c=function(h,v){u(h,l),s.add(l[0],l[1],l[2],v)};Vte(t,c);var d=s.getSpheres(),f=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return d.setBoundingSphere(f),d}function cat(e){return xJ({defaultProps:T.getDefaultValues(bL),createGeometry:lat,createLocationIterator:id.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function dat(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Ft.createEmpty(i);var s=a.detail,u=a.sizeFactor,l=o*R3(s),c=Et.createState(l,l/2,i),d=t.conformation.invariantPosition,f=_(),h=at.create(r,t),v=function(m,y){h.element=m,d(h.element,f),c.currentGroup=y,Na(c,f,n.size.size(h)*u,s)};Vte(t,v);var p=Et.getMesh(c),g=je.expand(je(),t.boundary.sphere,1*a.sizeFactor);return p.setBoundingSphere(g),p}function fat(e){return oo({defaultProps:T.getDefaultValues(bL),createGeometry:dat,createLocationIterator:id.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var ine={"polymer-backbone-cylinder":function(e,t){return na("Polymer backbone cylinder",e,t,nat)},"polymer-backbone-sphere":function(e,t){return na("Polymer backbone sphere",e,t,uat)},"polymer-gap":function(e,t){return na("Polymer gap cylinder",e,t,hL)}},one=E(E(E(E({},bL),yL),fE),{sizeAspectRatio:T.Numeric(1,{min:.1,max:3,step:.1}),visuals:T.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],T.objectToOptions(ine))});function hat(e,t){var r=T.clone(one),n=!1;return t.units.forEach(function(a){!n&&a.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r}function pat(e,t){return sr.createMulti("Backbone",e,t,Ba,ine)}var vat={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:pat,getParams:hat,defaultValues:T.getDefaultValues(one),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0}},i5=function(e){Be(t,e);function t(){var r=e.call(this)||this;return Uu(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInStructureRepresentations to have matching names. "+n.name+" "+a);r.add(n)}),r}return t}(UZ);(function(e){e.BuiltIn={cartoon:Qtt,backbone:vat,"ball-and-stick":ret,carbohydrate:zet,ellipsoid:rrt,"gaussian-surface":Wrt,"gaussian-volume":Jnt,label:ent,line:qnt,"molecular-surface":fnt,orientation:Snt,point:Int,putty:Ont,spacefill:Bnt}})(i5||(i5={}));var mat=function(){function e(t){var r=this;this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=function(){r.tick(kn()),r._isAnimating&&(r.currentFrame=requestAnimationFrame(r.frame))}}return Object.defineProperty(e.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!1,configurable:!0}),e.prototype.tick=function(t,r){var n;return de(this,void 0,void 0,function(){return fe(this,function(a){switch(a.label){case 0:return[4,this.plugin.managers.animation.tick(t,r==null?void 0:r.isSynchronous)];case 1:return a.sent(),(n=this.plugin.canvas3d)===null||n===void 0||n.tick(t,r),[2]}})})},e.prototype.resetTime=function(t){var r;t===void 0&&(t=kn()),(r=this.plugin.canvas3d)===null||r===void 0||r.resetTime(t)},e.prototype.start=function(t){var r;(r=this.plugin.canvas3d)===null||r===void 0||r.resume(),this._isAnimating=!0,this.resetTime(),t!=null&&t.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)},e.prototype.stop=function(t){var r;this._isAnimating=!1,this.currentFrame!==void 0&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t!=null&&t.noDraw&&((r=this.plugin.canvas3d)===null||r===void 0||r.pause(t==null?void 0:t.noDraw))},e}(),gat=function(){function e(t){var r=this;this.plugin=t,this.ev=Wc.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(function(n){r.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(function(n){r.removeMapping(n.ref)&&r.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(function(n){r.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&r.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}return e.prototype.getDecorator=function(t){var r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;var a=n.first();return r.transforms.get(a).transformer.definition.isDecorator?this.getDecorator(a):t},e.prototype.get=function(t,r){r===void 0&&(r=!1);var n=this.root.get(t);if(n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))},e.prototype.addMapping=function(t,r,n){if(!ge.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){var a=this.root.get(n.data);a.count++}else{var i=t.select(ir.Generators.byRef(r).rootOfType([ge.Molecule.Structure]))[0];i?this.root.set(n.data,{ref:i.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0},e.prototype.removeMapping=function(t){if(!this.tracked.has(t))return!1;var r=this.tracked.get(t);this.tracked.delete(t);var n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0},e.prototype.updateMapping=function(t,r,n,a){return ge.Molecule.Structure.is(a)?(this.removeMapping(r),this.addMapping(t,r,a),!0):!1},e.prototype.dispose=function(){this.ev.dispose()},e}(),o5=function(){function e(){this.ev=Wc.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.tryGetAbortTaskId=function(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(var r=0,n=t.children;r<n.length;r++){var a=n[r],i=this.tryGetAbortTaskId(a);if(i!==void 0)return i}},e.prototype.track=function(t,r){var n=this;return function(a){var i;if(a.canAbort&&a.requestAbort){var o=n.tryGetAbortTaskId(a.root);o!==void 0&&a.requestAbort(n.abortRequests.get(o))}var s=kn()-a.root.progress.startedTime;n.events.progress.next({id:t,useOverlay:(i=n.options.get(r))===null||i===void 0?void 0:i.useOverlay,level:s<250?"none":"background",progress:a})}},e.prototype.run=function(t,r){return de(this,void 0,void 0,function(){var n,a,i;return fe(this,function(o){switch(o.label){case 0:n=this.id++,r!=null&&r.createNewContext||this.currentContext.length===0?a={ctx:f3e(t,this.track(n,t.id),100),refCount:1}:(a=this.currentContext[this.currentContext.length-1],a.refCount++),o.label=1;case 1:return o.trys.push([1,,3,4]),this.options.set(t.id,{useOverlay:!!(r!=null&&r.useOverlay)}),this.runningTasks.add(t.id),[4,HX(a.ctx,t)];case 2:return i=o.sent(),[2,i];case 3:return this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),a.refCount--,a.refCount===0&&H1(this.currentContext,a),[7];case 4:return[2]}})})},e.prototype.requestAbortAll=function(t){var r=this;this.runningTasks.forEach(function(n){return r.abortRequests.set(n,t)})},e.prototype.requestAbort=function(t,r){var n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)},e.prototype.dispose=function(){this.ev.dispose()},e}();(function(e){function t(n){return new Promise(function(a){return setTimeout(a,n)})}function r(n){var a=this;return et.create("Test",function(i){return de(a,void 0,void 0,function(){var o;return fe(this,function(s){switch(s.label){case 0:o=0,s.label=1;case 1:return o<n?[4,t(100+Math.random()*200)]:[3,5];case 2:return s.sent(),i.shouldUpdate?[4,i.update({message:"Step "+o,current:o,max:n,isIndeterminate:!1})]:[3,4];case 3:s.sent(),s.label=4;case 4:return o++,[3,1];case 5:return[2]}})})})}e.testTask=r})(o5||(o5={}));var yat=function(e){Be(t,e);function t(r){var n=e.call(this,{entries:ia.OrderedMap()})||this;return n.events={changed:n.ev()},n.serialNumber=0,n.serialId=0,wt.Toast.Show.subscribe(r,function(a){return n.show(a)}),wt.Toast.Hide.subscribe(r,function(a){return n.hide(n.findByKey(a.key))}),n}return t.prototype.findByKey=function(r){return this.state.entries.find(function(n){return!!n&&n.key===r})},t.prototype.show=function(r){var n=this,a=this.state.entries,i=void 0,o=++this.serialId,s;r.key&&(i=this.findByKey(r.key))?(i.timeout!==void 0&&clearTimeout(i.timeout),s=i.serialNumber,a=a.remove(i.id)):s=++this.serialNumber,i={id:o,serialNumber:s,key:r.key,title:r.title,message:r.message,timeout:this.timeout(o,r.timeoutMs),hide:function(){return n.hideId(o)}},this.updateState({entries:a.set(o,i)})&&this.events.changed.next()},t.prototype.timeout=function(r,n){var a=this;if(n!==void 0)return n<0&&(n=500),setTimeout(function(){var i=a.state.entries.get(r);i.timeout=void 0,a.hide(i)},n)},t.prototype.hideId=function(r){this.hide(this.state.entries.get(r))},t.prototype.hide=function(r){r&&(r.timeout!==void 0&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next())},t}(Ed),bat=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n._params=void 0,n.behaviors={values:n.ev.behavior({transparent:n.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:n.params.resolution.defaultValue}),cropParams:n.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:n.ev.behavior({x:0,y:0,width:1,height:1})},n.events={previewed:n.ev()},n.canvas=function(){var a=document.createElement("canvas");return a}(),n.previewCanvas=function(){var a=document.createElement("canvas");return a}(),n.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:dt(0),transparent:!1},n}return t.prototype.createParams=function(){var r=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:T.MappedStatic("viewport",{viewport:T.Group({}),hd:T.Group({}),"full-hd":T.Group({}),"ultra-hd":T.Group({}),custom:T.Group({width:T.Numeric(1920,{min:128,max:r,step:1}),height:T.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:T.Boolean(!1),axes:J3.axes}},Object.defineProperty(t.prototype,"params",{get:function(){return this._params?this._params:this._params=this.createParams()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.behaviors.values.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cropParams",{get:function(){return this.behaviors.cropParams.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeCrop",{get:function(){return this.behaviors.relativeCrop.value},enumerable:!1,configurable:!0}),t.prototype.getCanvasSize=function(){var r,n;return{width:((r=this.plugin.canvas3d)===null||r===void 0?void 0:r.webgl.gl.drawingBufferWidth)||0,height:((n=this.plugin.canvas3d)===null||n===void 0?void 0:n.webgl.gl.drawingBufferHeight)||0}},t.prototype.getSize=function(){var r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}},t.prototype.createPass=function(r){var n=this.plugin.canvas3d,a=n.webgl.extensions,i=a.colorBufferFloat,o=a.textureFloat,s=this.plugin.canvas3d.props.postprocessing.occlusion;return this.plugin.canvas3d.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{mode:r?"on":"off",sampleLevel:i&&o?4:2},postprocessing:E(E({},n.props.postprocessing),{occlusion:s.name==="on"?{name:"on",params:E(E({},s.params),{samples:128})}:s})})},Object.defineProperty(t.prototype,"previewPass",{get:function(){return this._previewPass||(this._previewPass=this.createPass(!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imagePass",{get:function(){if(this._imagePass){var r=this.plugin.canvas3d.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:E(E({},this.plugin.canvas3d.props.postprocessing),{occlusion:r.name==="on"?{name:"on",params:E(E({},r.params),{samples:128})}:r})}),this._imagePass}return this._imagePass=this.createPass(!0)},enumerable:!1,configurable:!0}),t.prototype.getFilename=function(r){r===void 0&&(r=".png");var n=this.plugin.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Model)).map(function(o){return o.obj.data}),a=new Set;n.forEach(function(o){return a.add(o.entryId.toUpperCase())});var i=fa.toArray(a).join("-");return""+(i||"molstar-image")+r},t.prototype.resetCrop=function(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})},t.prototype.toggleAutocrop=function(){this.cropParams.auto?(this.behaviors.cropParams.next(E(E({},this.cropParams),{auto:!1})),this.resetCrop()):this.behaviors.cropParams.next(E(E({},this.cropParams),{auto:!0}))},Object.defineProperty(t.prototype,"isFullFrame",{get:function(){var r=this.relativeCrop;return mn(r.x,0,1e-5)&&mn(r.y,0,1e-5)&&mn(r.width,1,1e-5)&&mn(r.height,1,1e-5)},enumerable:!1,configurable:!0}),t.prototype.autocrop=function(r){r===void 0&&(r=this.cropParams.relativePadding);for(var n=this.previewData.image,a=n.data,i=n.width,o=n.height,s=this.previewData.transparent,u=s?this.previewData.background:4278190080|this.previewData.background,l=i,c=0,d=o,f=0,h=0;h<o;h++)for(var v=h*i,p=0;p<i;p++){var g=4*(v+p);if(s){if(a[g+3]===0)continue}else{var m=a[g]<<16|a[g+1]<<8|a[g+2]|a[g+3]<<24;if(m===u)continue}p<l&&(l=p),p>c&&(c=p),h<d&&(d=h),h>f&&(f=h)}if(l>c){var y=l;l=c,c=y}if(d>f){var y=d;d=f,f=y}var b=c-l+1,S=f-d+1;l-=r*b,c+=r*b,d-=r*S,f+=r*S;var x={x:Math.max(0,l/i),y:Math.max(0,d/o),width:Math.min(1,(c-l+1)/i),height:Math.min(1,(f-d+1)/o)};this.behaviors.relativeCrop.next(x)},t.prototype.getPreview=function(r){r===void 0&&(r=320);var n=this.getSize(),a=n.width,i=n.height;if(!(a<=0||i<=0)){var o=a/i,s=0,u=0;o>1?(s=r,u=Math.round(r/o)):(u=r,s=Math.round(r*o));var l=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:l.postprocessing});var c=this.previewPass.getImageData(s,u),d=this.previewCanvas;d.width=c.width,d.height=c.height,this.previewData.image=c,this.previewData.background=l.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;var f=d.getContext("2d");if(!f)throw new Error("Could not create canvas 2d context");return f.putImageData(c,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(),{canvas:d,width:s,height:u}}},t.prototype.getSizeAndViewport=function(){var r=this.getSize(),n=r.width,a=r.height,i=this.relativeCrop,o={x:Math.floor(i.x*n),y:Math.floor(i.y*a),width:Math.ceil(i.width*n),height:Math.ceil(i.height*a)};return o.width+o.x>n&&(o.width=n-o.x),o.height+o.y>a&&(o.height=a-o.y),{width:n,height:a,viewport:o}},t.prototype.draw=function(r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return fe(this,function(c){switch(c.label){case 0:return n=this.getSizeAndViewport(),a=n.width,i=n.height,o=n.viewport,a<=0||i<=0?[2]:[4,r.update("Rendering image...")];case 1:return c.sent(),s=this.imagePass.getImageData(a,i,o),[4,r.update("Encoding image...")];case 2:if(c.sent(),u=this.canvas,u.width=s.width,u.height=s.height,l=u.getContext("2d"),!l)throw new Error("Could not create canvas 2d context");return l.putImageData(s,0,0),[2]}})})},t.prototype.copyToClipboardTask=function(){var r=this,n=navigator.clipboard;if(!(n!=null&&n.write)){this.plugin.log.error("clipboard.write not supported!");return}return et.create("Copy Image",function(a){return de(r,void 0,void 0,function(){var i,o;return fe(this,function(s){switch(s.label){case 0:return[4,this.draw(a)];case 1:return s.sent(),[4,a.update("Converting image...")];case 2:return s.sent(),[4,kz(this.canvas,"png")];case 3:return i=s.sent(),o=new ClipboardItem({"image/png":i}),[4,n.write([o])];case 4:return s.sent(),this.plugin.log.message("Image copied to clipboard."),[2]}})})})},t.prototype.getImageDataUri=function(){var r=this;return this.plugin.runTask(et.create("Generate Image",function(n){return de(r,void 0,void 0,function(){return fe(this,function(a){switch(a.label){case 0:return[4,this.draw(n)];case 1:return a.sent(),[4,n.update("Converting image...")];case 2:return a.sent(),[2,this.canvas.toDataURL("png")]}})})}))},t.prototype.copyToClipboard=function(){var r=this.copyToClipboardTask();if(r)return this.plugin.runTask(r)},t.prototype.downloadTask=function(r){var n=this;return et.create("Download Image",function(a){return de(n,void 0,void 0,function(){var i;return fe(this,function(o){switch(o.label){case 0:return[4,this.draw(a)];case 1:return o.sent(),[4,a.update("Downloading image...")];case 2:return o.sent(),[4,kz(this.canvas,"png")];case 3:return i=o.sent(),HJ(i,r??this.getFilename()),[2]}})})})},t.prototype.download=function(r){this.plugin.runTask(this.downloadTask(r))},t}(zb),xat=function(){function e(t){var r=this;this.spec=t,this.runTask=function(n,a){return r.managers.task.run(n,a)},this.resolveTask=function(n){if(n)return et.is(n)?r.runTask(n):n},this.subs=[],this.disposed=!1,this.ev=Wc.create(),this.config=new Oze(this.spec.config),this.state=new H_(this),this.commands=new jGe,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:sr.Loci.Empty,modifiers:Ru.None,buttons:0,button:0}),click:this.ev.behavior({current:sr.Loci.Empty,modifiers:Ru.None,buttons:0,button:0}),drag:this.ev.behavior({current:sr.Loci.Empty,modifiers:Ru.None,buttons:0,button:0,pageStart:Ke(),pageEnd:Ke()}),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(v3(function(n){return!!n}),lZe(1))}},this.layout=new UJe(this),this.animationLoop=new mat(this),this.representation={structure:{registry:new i5,themes:{colorThemeRegistry:Qc.createRegistry(),sizeThemeRegistry:Ya.createRegistry()}},volume:{registry:new z_,themes:{colorThemeRegistry:Qc.createRegistry(),sizeThemeRegistry:Ya.createRegistry()}}},this.query={structure:{registry:new Rze}},this.dataFormats=new EJe,this.builders={data:new tJe(this),structure:void 0},this.helpers={substructureParent:new gat(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new ub(this),component:new tv(this),measurement:new mYe(this),selection:new kJe(this),focus:new DJe(this)},volume:{hierarchy:new N_(this)},interactivity:void 0,camera:new TJe(this),animation:new AJe(this),snapshot:new M_(this),lociLabels:void 0,toast:new yat(this),asset:new J3e,task:new o5},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new G_.Registry,this.customStructureProperties=new G_.Registry,this.customStructureControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.log={entries:ia.List(),entry:function(n){return r.events.log.next(n)},error:function(n){return r.events.log.next(bl.error(n))},message:function(n){return r.events.log.next(bl.message(n))},info:function(n){return r.events.log.next(bl.info(n))},warn:function(n){return r.events.log.next(bl.warning(n))}},this.fetch=dM,sAe(!1)}return e.prototype.build=function(){return this.state.data.build()},e.prototype.initViewer=function(t,r,n){var a=this,i,o,s,u,l;try{if(this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n)this.canvas3dContext=n;else{var c=!((i=this.config.get($r.General.DisableAntialiasing))!==null&&i!==void 0&&i),d=!((o=this.config.get($r.General.DisablePreserveDrawingBuffer))!==null&&o!==void 0&&o),f=this.config.get($r.General.PixelScale)||1,h=this.config.get($r.General.PickScale)||.25,v=this.config.get($r.General.EnableWboit)||!1;this.canvas3dContext=jD.fromCanvas(t,{antialias:c,preserveDrawingBuffer:d,pixelScale:f,pickScale:h,enableWboit:v})}this.canvas3d=zD.create(this.canvas3dContext),this.canvas3dInit.next(!0);var p=this.spec.canvas3d,g=dt(16579577);return p?(((u=p.renderer)===null||u===void 0?void 0:u.backgroundColor)===void 0&&(p=Ek(p,function(m){m.renderer?m.renderer.backgroundColor=g:m.renderer={backgroundColor:g}})),(l=this.canvas3d)===null||l===void 0||l.setProps(p)):(s=this.canvas3d)===null||s===void 0||s.setProps({renderer:{backgroundColor:g}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new bat(this),this.subs.push(this.canvas3d.interaction.click.subscribe(function(m){return a.behaviors.interaction.click.next(m)})),this.subs.push(this.canvas3d.interaction.drag.subscribe(function(m){return a.behaviors.interaction.drag.next(m)})),this.subs.push(this.canvas3d.interaction.hover.subscribe(function(m){return a.behaviors.interaction.hover.next(m)})),this.subs.push(this.canvas3d.input.resize.subscribe(function(){return a.handleResize()})),this.subs.push(this.layout.events.updated.subscribe(function(){return requestAnimationFrame(function(){return a.handleResize()})})),this.handleResize(),!0}catch(m){return this.log.error(""+m),console.error(m),!1}},e.prototype.handleResize=function(){var t,r,n=(t=this.canvas3dContext)===null||t===void 0?void 0:t.canvas,a=this.layout.root;if(a&&n){var i=this.config.get($r.General.PixelScale)||1;QZe(n,a,i),(r=this.canvas3d)===null||r===void 0||r.requestResize()}},Object.defineProperty(e.prototype,"isBusy",{get:function(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this.behaviors.interaction.selectionMode.value},set:function(t){this.behaviors.interaction.selectionMode.next(t)},enumerable:!1,configurable:!0}),e.prototype.dataTransaction=function(t,r){return this.runTask(this.state.data.transaction(t,r))},e.prototype.clear=function(t){var r;return t===void 0&&(t=!1),t&&((r=this.canvas3d)===null||r===void 0||r.setProps(AO)),wt.State.RemoveObject(this,{state:this.state.data,ref:cr.RootRef})},e.prototype.dispose=function(t){var r,n;if(!this.disposed){for(var a=0,i=this.subs;a<i.length;a++){var o=i[a];o.unsubscribe()}this.subs=[],this.commands.dispose(),(r=this.canvas3d)===null||r===void 0||r.dispose(),(n=this.canvas3dContext)===null||n===void 0||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.managers.task.dispose(),this.helpers.substructureParent.dispose(),Uu(this.managers,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),Uu(this.managers.structure,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),this.disposed=!0}},e.prototype.initBehaviorEvents=function(){var t=this;this.subs.push(fc(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(function(s){t.behaviors.state.isUpdating.value!==s&&t.behaviors.state.isUpdating.next(s)}));var r=this.config.get($r.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy,a=void 0,i=function(){n.value||n.next(!0)},o=function(){a!==void 0&&clearTimeout(a),a=void 0};this.subs.push(fc(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(function(s){var u=t.behaviors.state.isUpdating.value,l=t.behaviors.state.isAnimating.value;u||l?n.value||(o(),a=setTimeout(i,r)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(function(s){var u;s||(u=t.managers.interactivity)===null||u===void 0||u.lociSelects.deselectAll()}))},e.prototype.initBuiltInBehavior=function(){var t=this;mx.State.registerDefault(this),mx.Representation.registerDefault(this),mx.Camera.registerDefault(this),mx.Misc.registerDefault(this),this.subs.push(fc(this.state.data.events.log,this.state.behaviors.events.log).subscribe(function(r){return t.events.log.next(r)}))},e.prototype.initBehaviors=function(){return de(this,void 0,void 0,function(){var t,r,n,l,a,i,u,l,o,s,u,l;return fe(this,function(c){switch(c.label){case 0:for(t=this.state.behaviors.build(),r=0,n=Object.keys(Dr.Categories);r<n.length;r++)l=n[r],t.toRoot().apply(Dr.CreateCategory,{label:Dr.Categories[l]},{ref:l,state:{isLocked:!0}});for(a=0,i=this.spec.behaviors;a<i.length;a++)u=i[a],l=Dr.getCategoryId(u.transformer),l==="custom-props"&&t.to(Dr.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 1:for(c.sent(),t=this.state.behaviors.build(),o=0,s=this.spec.behaviors;o<s.length;o++)u=s[o],l=Dr.getCategoryId(u.transformer),l!=="custom-props"&&t.to(Dr.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 2:return c.sent(),[2]}})})},e.prototype.initCustomFormats=function(){if(this.spec.customFormats)for(var t=0,r=this.spec.customFormats;t<r.length;t++){var n=r[t];this.dataFormats.add(n[0],n[1])}},e.prototype.initAnimations=function(){if(this.spec.animations)for(var t=0,r=this.spec.animations;t<r.length;t++){var n=r[t];this.managers.animation.register(n)}},e.prototype.initDataActions=function(){if(this.spec.actions)for(var t=0,r=this.spec.actions;t<r.length;t++){var n=r[t];this.state.data.actions.add(n.action)}},e.prototype.init=function(){return de(this,void 0,void 0,function(){var t=this;return fe(this,function(r){switch(r.label){case 0:return this.subs.push(this.events.log.subscribe(function(n){return t.log.entries=t.log.entries.push(n)})),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new O_(this),this.managers.lociLabels=new IJe(this),this.builders.structure=new dJe(this),this.initAnimations(),this.initDataActions(),[4,this.initBehaviors()];case 1:return r.sent(),this.log.message("Mol* Plugin "+DD+" ["+NGe.toLocaleString()+"]"),Yg||this.log.message("Development mode enabled"),Mr&&this.log.message("Debug mode enabled"),[2]}})})},e}(),Sat=function(e){Be(t,e);function t(r){var n=e.call(this,r)||this;return n.spec=r,n.customParamEditors=new Map,n.initCustomParamEditors(),n}return t.prototype.initCustomParamEditors=function(){if(this.spec.customParamEditors)for(var r=0,n=this.spec.customParamEditors;r<n.length;r++){var a=n[r],i=a[0],o=a[1];this.customParamEditors.set(i.id,o)}},t.prototype.dispose=function(r){e.prototype.dispose.call(this,r),this.layout.dispose()},t}(xat),uh;(function(e){function t(n){return n}e.create=t;function r(n,a){var i,o;if(a.customDurationMs)return a.customDurationMs;var s=(o=(i=a.definition).getDuration)===null||o===void 0?void 0:o.call(i,a.params,n);if((s==null?void 0:s.kind)==="fixed")return s.durationMs}e.getDuration=r})(uh||(uh={}));var Cat=uh.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:function(e){for(var t=[["all","All"]],r=e.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Structure)),n=0,a=r;n<a.length;n++){var i=a[n];t.push([i.transform.ref,i.obj.data.models[0].label])}return{durationInMs:T.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:T.Boolean(!1),target:T.Select(t[0][0],t)}},canApply:function(e){var t=e.state.data,r=cr.RootRef,n=t.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D,r));return{canApply:n.length>0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},initialState:function(){return{t:0}},setup:function(e,t,r){for(var n=r.state.data,a=!e.target||e.target==="all"?cr.RootRef:e.target,i=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D,a)),o=n.build(),s=!1,u=0,l=i;u<l.length;u++){var c=l[u],d=n.select(ir.Generators.ofTransformer(st.Representation.UnwindStructureAssemblyRepresentation3D,c.transform.ref));d.length>0||(s=!0,o.to(c).apply(st.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))}if(s)return o.commit({doNotUpdateCurrent:!0})},teardown:function(e,t,r){var n=r.state.data,a=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(a.length!==0){for(var i=n.build(),o=0,s=a;o<s.length;o++){var u=s[o];i.delete(u.transform.ref)}return i.commit()}},apply:function(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f;return fe(this,function(h){switch(h.label){case 0:if(n=r.plugin.state.data,a=!r.params.target||r.params.target==="all"?cr.RootRef:r.params.target,i=n.select(ir.Generators.ofTransformer(st.Representation.UnwindStructureAssemblyRepresentation3D,a)),i.length===0)return[2,{kind:"finished"}];for(o=n.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=e.t+s,l=!1,r.params.playOnce&&u>=1?(l=!0,u=1):u=u%1,c=0,d=i;c<d.length;c++)f=d[c],o.to(f).update({t:u});return[4,wt.State.Update(r.plugin,{state:n,tree:o,options:{doNotLogTiming:!0}})];case 1:return h.sent(),l?[2,{kind:"finished"}]:[2,{kind:"next",state:{t:u}}]}})})}}),Bx=_(),mV=_(),gV=Gn(),_at=uh.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin"},isExportable:!0,params:function(){return{durationInMs:T.Numeric(4e3,{min:100,max:2e4,step:100}),speed:T.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified dutation."}),direction:T.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}},initialState:function(e,t){var r;return{snapshot:(r=t.canvas3d)===null||r===void 0?void 0:r.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return de(this,void 0,void 0,function(){var i,o,s,u;return fe(this,function(l){return t.current===0?[2,{kind:"next",state:e}]:(i=e.snapshot,i.radiusMax<1e-4?[2,{kind:"finished"}]:(o=ki(t.current/r.params.durationInMs,0,1),o>=.99999?((n=r.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:i,durationMs:0}),[2,{kind:"finished"}]):(s=2*Math.PI*o*r.params.speed*(r.params.direction==="ccw"?-1:1),_.sub(Bx,i.position,i.target),_.normalize(mV,i.up),Gn.setAxisAngle(gV,mV,s),_.transformQuat(Bx,Bx,gV),u=_.add(_(),i.target,Bx),(a=r.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({snapshot:E(E({},i),{position:u}),durationMs:0}),[2,{kind:"next",state:e}])))})})}}),wat=uh.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:function(){return{mode:T.MappedStatic("loop",{palindrome:T.Group({}),loop:T.Group({direction:T.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:T.Group({direction:T.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:T.MappedStatic("fixed",{fixed:T.Group({durationInS:T.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:T.Group({targetFps:T.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:T.Group({maxFps:T.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}},canApply:function(e){for(var t=e.state.data,r=t.select(ir.Generators.ofTransformer(st.Model.ModelFromTrajectory)),n=0,a=r;n<a.length;n++){var i=a[n],o=ir.findAncestorOfType(t.tree,t.cells,i.transform.ref,ge.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:function(e,t){var r;if(((r=e.duration)===null||r===void 0?void 0:r.name)==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){for(var n=t.state.data,a=n.select(ir.Generators.ofTransformer(st.Model.ModelFromTrajectory)),i=0,o=0,s=a;o<s.length;o++){var u=s[o],l=ir.findAncestorOfType(n.tree,n.cells,u.transform.ref,ge.Molecule.Trajectory);if(!(!l||!l.obj)){var c=l.obj;i=Math.max(Math.ceil(1e3*c.data.frameCount/e.duration.params.targetFps),i)}}return{kind:"fixed",durationMs:i}}return{kind:"unknown"}},initialState:function(){return{}},apply:function(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h;return fe(this,function(v){switch(v.label){case 0:if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return[2,{kind:"skip"}];if(n=r.plugin.state.data,a=n.select(ir.Generators.ofTransformer(st.Model.ModelFromTrajectory)),a.length===0)return[2,{kind:"finished"}];for(i=n.build(),o=r.params,s=e.palindromeDirections||{},u=!1,l=!0,c=function(p){var g=ir.findAncestorOfType(n.tree,n.cells,p.transform.ref,ge.Molecule.Trajectory);if(!g||!g.obj)return"continue";var m=g.obj;if(m.data.frameCount<=1)return"continue";i.to(p).update(function(y){var b=m.data.frameCount;if(b!==1)l=!1;else return y;if(o.duration.name==="sequential"){var S=1;if(o.mode.name==="once"){if(S=o.mode.params.direction==="backward"?-1:1,S===-1&&y.modelIndex===0||S===1&&y.modelIndex===b-1)return u=!0,y}else o.mode.name==="palindrome"&&(y.modelIndex===0?S=1:y.modelIndex===b-1?S=-1:S=s[p.transform.ref]||1);s[p.transform.ref]=S;var x=(y.modelIndex+S)%b;return x<0&&(x+=b),u=u||S===-1&&x===0||S===1&&x===b-1,{modelIndex:x}}else{var C=o.duration.name==="fixed"?o.duration.params.durationInS*1e3:Math.ceil(1e3*m.data.frameCount/o.duration.params.targetFps),w=t.current%C/C;o.mode.name==="loop"&&o.mode.params.direction==="backward"&&(w=1-w),o.mode.name==="palindrome"&&(w=2*w,w>1&&(w=2-w));var x=Math.min(Math.floor(m.data.frameCount*w),m.data.frameCount-1);return u=u||x===m.data.frameCount-1,{modelIndex:x}}})},d=0,f=a;d<f.length;d++)h=f[d],c(h);return l?[3,2]:[4,wt.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}})];case 1:v.sent(),v.label=2;case 2:return l||o.mode.name==="once"&&u?[2,{kind:"finished"}]:o.mode.name==="palindrome"?[2,{kind:"next",state:{palindromeDirections:s}}]:[2,{kind:"next",state:{}}]}})})}});function yV(e,t,r){var n;return r===void 0&&(r=!1),de(this,void 0,void 0,function(){return fe(this,function(a){switch(a.label){case 0:return t.snapshot.data?[4,e.runTask(e.state.data.setSnapshot(t.snapshot.data))]:[3,2];case 1:a.sent(),a.label=2;case 2:return t.snapshot.camera&&((n=e.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs})),[2]}})})}var Eat=uh.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:function(){return{}},canApply:function(e){var t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(function(r){return!!(r!=null&&r.snapshot.startAnimation)})?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup:function(e,t,r){var n=r.managers.snapshot.state.entries.get(0);yV(r,n,!0)},getDuration:function(e,t){return{kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce(function(r,n){var a;return r+((a=n.snapshot.durationInMs)!==null&&a!==void 0?a:0)},0)}},initialState:function(e,t){var r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce(function(n,a){var i;return n+((i=a.snapshot.durationInMs)!==null&&i!==void 0?i:0)},0),snapshots:r,currentIndex:0}},apply:function(e,t,r){var n;return de(this,void 0,void 0,function(){var a,i,o,s,u;return fe(this,function(l){if(t.current>=e.totalDuration)return[2,{kind:"finished"}];for(a=0,i=0,o=0,s=e.snapshots;o<s.length&&(u=s[o],a+=(n=u.snapshot.durationInMs)!==null&&n!==void 0?n:0,!(t.current<a));o++)i++;return i>=e.snapshots.length?[2,{kind:"finished"}]:i===e.currentIndex?[2,{kind:"skip"}]:(yV(r.plugin,e.snapshots[i]),[2,{kind:"next",state:E(E({},e),{currentIndex:i})}])})})}}),Aat=Ao.build({from:ge.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var r=t.dataFormats.options;return{source:T.MappedStatic("pdb-xray",{"pdb-xray":T.Group({provider:T.Group({id:T.Text("1tqn",{label:"Id"}),server:T.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:T.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":T.Group({provider:T.Group({id:T.Text("1tqn",{label:"Id"}),server:T.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:T.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":T.Group({provider:T.Group({id:T.Text("emd-8004",{label:"Id"}),server:T.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:T.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:T.Group({url:T.Url(""),isBinary:T.Boolean(!1),format:T.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(function(e,t){var r=e.params;return et.create("Download Density",function(n){return de(void 0,void 0,void 0,function(){var a,i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:switch(a=r.source,a.name){case"url":i=a.params;break;case"pdb-xray":i=a.params.provider.server==="pdbe"?{url:Pn.Url(a.params.type==="2fofc"?"http://www.ebi.ac.uk/pdbe/coordinates/files/"+a.params.provider.id.toLowerCase()+".ccp4":"http://www.ebi.ac.uk/pdbe/coordinates/files/"+a.params.provider.id.toLowerCase()+"_diff.ccp4"),isBinary:!0,label:"PDBe X-ray map: "+a.params.provider.id}:{url:Pn.Url(a.params.type==="2fofc"?"https://edmaps.rcsb.org/maps/"+a.params.provider.id.toLowerCase()+"_2fofc.dsn6":"https://edmaps.rcsb.org/maps/"+a.params.provider.id.toLowerCase()+"_fofc.dsn6"),isBinary:!0,label:"RCSB X-ray map: "+a.params.provider.id};break;case"pdb-emd-ds":i=a.params.provider.server==="pdbe"?{url:Pn.Url("https://www.ebi.ac.uk/pdbe/densities/emd/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"PDBe EMD Density Server: "+a.params.provider.id}:{url:Pn.Url("https://maps.rcsb.org/em/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"RCSB PDB EMD Density Server: "+a.params.provider.id};break;case"pdb-xray-ds":i=a.params.provider.server==="pdbe"?{url:Pn.Url("https://www.ebi.ac.uk/pdbe/densities/x-ray/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"PDBe X-ray Density Server: "+a.params.provider.id}:{url:Pn.Url("https://maps.rcsb.org/x-ray/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"RCSB PDB X-ray Density Server: "+a.params.provider.id};break;default:throw new Error(a.name+" not supported.")}return[4,t.builders.data.download(i)];case 1:switch(s=f.sent(),u=void 0,a.name){case"url":i=a.params,o=a.params.format==="auto"?t.dataFormats.auto(JO(Pn.getUrl(i.url)),(c=s.cell)===null||c===void 0?void 0:c.obj):t.dataFormats.get(a.params.format);break;case"pdb-xray":u=a.params.provider.id,o=a.params.provider.server==="pdbe"?t.dataFormats.get("ccp4"):t.dataFormats.get("dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=a.params.provider.id,o=t.dataFormats.get("dscif");break;default:throw new Error(a.name+" not supported.")}return o?[4,o.parse(t,s,{entryId:u})]:(t.log.warn("DownloadDensity: Format provider not found."),[2]);case 2:return l=f.sent(),[4,(d=o.visuals)===null||d===void 0?void 0:d.call(o,t,l)];case 3:return f.sent(),[2]}})})})}),sne=Ao.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:ge.Volume.Data,isApplicable:function(e){return!e.data.colorVolume},params:function(e,t){var r=t.state.data.select(ir.Generators.root.subtree().ofType(ge.Volume.Data).filter(function(n){var a;return!!n.obj&&!(!((a=n.obj)===null||a===void 0)&&a.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:T.Text("",{isHidden:!0,label:"Volume"})}:{ref:T.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}),{label:"Volume"})}}})(function(e,t){var r=e.ref,n=e.params;return e.state,t.build().to(r).apply(st.Volume.AssignColorVolume,{ref:n.ref},{dependsOn:[n.ref]}).commit()});const Pat=Object.freeze(Object.defineProperty({__proto__:null,AssignColorVolume:sne,DownloadDensity:Aat},Symbol.toStringTag,{value:"Module"}));var Tat=Ao.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:ge.Root,params:function(e,t){var r=t.dataFormats,n=r.extensions,a=r.options;return{files:T.FileList({accept:Array.from(n.values()).map(function(i){return"."+i}).join(",")+",.gz,.zip",multiple:!0}),format:T.MappedStatic("auto",{auto:T.EmptyGroup(),specific:T.Select(a[0][0],a)}),visuals:T.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return et.create("Open Files",function(a){return de(void 0,void 0,void 0,function(){return fe(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return de(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,g;return fe(this,function(m){switch(m.label){case 0:if(r.files===null)return t.log.error("No file(s) selected"),[2];o=0,s=r.files,m.label=1;case 1:if(!(o<s.length))return[3,9];u=s[o],m.label=2;case 2:return m.trys.push([2,7,,8]),l=JO(u.file),c=t.dataFormats.binaryExtensions.has(l.ext),[4,t.builders.data.readFile({file:u,isBinary:c})];case 3:return d=m.sent().data,f=r.format.name==="auto"?t.dataFormats.auto(l,(p=d.cell)===null||p===void 0?void 0:p.obj):t.dataFormats.get(r.format.params),f?[4,f.parse(t,d)]:(t.log.warn("OpenFiles: could not find data provider for '"+l.name+"."+l.ext+"'"),[3,8]);case 4:return h=m.sent(),r.visuals?[4,(g=f.visuals)===null||g===void 0?void 0:g.call(f,t,h)]:[3,6];case 5:m.sent(),m.label=6;case 6:return[3,8];case 7:return v=m.sent(),t.log.error(v),[3,8];case 8:return o++,[3,1];case 9:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),Iat=Ao.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:ge.Root,params:function(e,t){var r=t.dataFormats.options;return{url:T.Url(""),format:T.Select(r[0][0],r),isBinary:T.Boolean(!1),visuals:T.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return et.create("Open Files",function(a){return de(void 0,void 0,void 0,function(){return fe(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return de(void 0,void 0,void 0,function(){var o,s,u,l,c;return fe(this,function(d){switch(d.label){case 0:return d.trys.push([0,5,,6]),o=t.dataFormats.get(r.format),o?[4,t.builders.data.download({url:r.url,isBinary:r.isBinary})]:(t.log.warn("DownloadFile: could not find data provider for '"+r.format+"'"),[2]);case 1:return s=d.sent(),[4,o.parse(t,s)];case 2:return u=d.sent(),r.visuals?[4,(c=o.visuals)===null||c===void 0?void 0:c.call(o,t,u)]:[3,4];case 3:d.sent(),d.label=4;case 4:return[3,6];case 5:return l=d.sent(),t.log.error(l),[3,6];case 6:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})});const Mat=Object.freeze(Object.defineProperty({__proto__:null,DownloadFile:Iat,OpenFiles:Tat},Symbol.toStringTag,{value:"Module"}));var zh={Structure:eXe,Volume:Pat,DataFormat:Mat},Dat=uh.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:function(){return{transtionDurationInMs:T.Numeric(2e3,{min:100,max:3e4,step:10})}},canApply:function(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:function(){return{}},apply:function(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,h,v,p,g,m,y,b,S,x,C;return fe(this,function(w){switch(w.label){case 0:if(n=r.plugin.managers.snapshot.state.entries,n.size<2)return[2,{kind:"finished"}];if(a=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,i=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,o=Math.ceil(t.current/r.params.transtionDurationInMs),o===i&&o++,o=o%n.size,s=n.get(i).snapshot,u=n.get(o).snapshot,!s.data||!u.data)return[2,{kind:"skip"}];for(l=s.data.tree.transforms,c=u.data.tree.transforms,d=r.plugin.state.data,f=d.build(),h=0,v=l;h<v.length;h++)for(p=v[h],g=0,m=c;g<m.length;g++)y=m[g],y.ref===p.ref&&y.version!==p.version&&(b=cr.fromJSON(p),S=cr.fromJSON(y),x=d.cells.get(p.ref),x&&(C=void 0,b.transformer.definition.interpolate?C=b.transformer.definition.interpolate(b.params,S.params,a,r.plugin):C=a<=.5?b.params:S.params,MC(x,C)||f.to(p.ref).update(C)));return[4,wt.State.Update(r.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}})];case 1:return w.sent(),[2,{kind:"next",state:{}}]}})})}}),Rat=uh.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:function(){return{durationInMs:T.Numeric(3e3,{min:100,max:1e4,step:100})}},initialState:function(){return{t:0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},setup:function(e,t,r){return de(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c;return fe(this,function(d){for(n=r.state.data,a=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D)),i=n.build(),o=!1,s=0,u=a;s<u.length;s++)l=u[s],c=n.select(ir.Generators.ofTransformer(st.Representation.SpinStructureRepresentation3D,l.transform.ref)),!(c.length>0)&&(o=!0,i.to(l.transform.ref).apply(st.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));return o?[2,i.commit({doNotUpdateCurrent:!0})]:[2]})})},teardown:function(e,t,r){var n=r.state.data,a=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(a.length!==0){for(var i=n.build(),o=0,s=a;o<s.length;o++){var u=s[o];i.delete(u.transform.ref)}return i.commit()}},apply:function(e,t,r){var n;return de(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d;return fe(this,function(f){switch(f.label){case 0:if(a=r.plugin.state.data,i=a.select(ir.Generators.ofTransformer(st.Representation.SpinStructureRepresentation3D)),i.length===0)return[2,{kind:"finished"}];for(o=a.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=(e.t+s)%1,l=0,c=i;l<c.length;l++)d=c[l],o.to(d).update(E(E({},(n=d.params)===null||n===void 0?void 0:n.values),{t:u}));return[4,wt.State.Update(r.plugin,{state:a,tree:o,options:{doNotLogTiming:!0}})];case 1:return f.sent(),[2,{kind:"next",state:{t:u}}]}})})}}),Jt;(function(e){function t(n,a){return{action:n,customControl:a&&a.customControl,autoUpdate:a&&a.autoUpdate}}e.Action=t;function r(n,a){return a===void 0&&(a={}),{transformer:n,defaultParams:a}}e.Behavior=r})(Jt||(Jt={}));var kat=function(){return{actions:[Jt.Action(zh.Structure.DownloadStructure),Jt.Action(zh.Structure.AddTrajectory),Jt.Action(zh.Volume.DownloadDensity),Jt.Action(zh.DataFormat.DownloadFile),Jt.Action(zh.DataFormat.OpenFiles),Jt.Action(zh.Structure.EnableModelCustomProps),Jt.Action(zh.Structure.EnableStructureCustomProps),Jt.Action(XD),Jt.Action(mQe),Jt.Action(KO),Jt.Action(st.Data.Download),Jt.Action(st.Data.ParseCif),Jt.Action(st.Data.ParseCcp4),Jt.Action(st.Data.ParseDsn6),Jt.Action(st.Model.TrajectoryFromMmCif),Jt.Action(st.Model.TrajectoryFromCifCore),Jt.Action(st.Model.TrajectoryFromPDB),Jt.Action(st.Model.TransformStructureConformation),Jt.Action(st.Model.StructureFromModel),Jt.Action(st.Model.StructureFromTrajectory),Jt.Action(st.Model.ModelFromTrajectory),Jt.Action(st.Model.StructureSelectionFromScript),Jt.Action(st.Representation.StructureRepresentation3D),Jt.Action(st.Representation.StructureSelectionsDistance3D),Jt.Action(st.Representation.StructureSelectionsAngle3D),Jt.Action(st.Representation.StructureSelectionsDihedral3D),Jt.Action(st.Representation.StructureSelectionsLabel3D),Jt.Action(st.Representation.StructureSelectionsOrientation3D),Jt.Action(st.Representation.ModelUnitcell3D),Jt.Action(st.Representation.StructureBoundingBox3D),Jt.Action(st.Representation.ExplodeStructureRepresentation3D),Jt.Action(st.Representation.SpinStructureRepresentation3D),Jt.Action(st.Representation.UnwindStructureAssemblyRepresentation3D),Jt.Action(st.Representation.OverpaintStructureRepresentation3DFromScript),Jt.Action(st.Representation.TransparencyStructureRepresentation3DFromScript),Jt.Action(sne),Jt.Action(st.Volume.VolumeFromCcp4),Jt.Action(st.Volume.VolumeFromDsn6),Jt.Action(st.Volume.VolumeFromCube),Jt.Action(st.Volume.VolumeFromDx),Jt.Action(st.Representation.VolumeRepresentation3D)],behaviors:[Jt.Behavior(Fo.Representation.HighlightLoci),Jt.Behavior(Fo.Representation.SelectLoci),Jt.Behavior(Fo.Representation.DefaultLociLabelProvider),Jt.Behavior(Fo.Representation.FocusLoci),Jt.Behavior(Fo.Camera.FocusLoci),Jt.Behavior(Fo.Camera.CameraAxisHelper),Jt.Behavior(IO),Jt.Behavior(Fo.CustomProps.StructureInfo),Jt.Behavior(Fo.CustomProps.AccessibleSurfaceArea),Jt.Behavior(Fo.CustomProps.BestDatabaseSequenceMapping),Jt.Behavior(Fo.CustomProps.Interactions),Jt.Behavior(Fo.CustomProps.SecondaryStructure),Jt.Behavior(Fo.CustomProps.ValenceModel),Jt.Behavior(Fo.CustomProps.CrossLinkRestraint)],animations:[wat,_at,Eat,Cat,Rat,Dat]}},Oat={color:T.Color(dr.black,{description:"Display color of the volume."}),wireframe:T.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:T.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},Lat=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]),Ux=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.ref=ir.findTagInSubtree(r.plugin.state.data.tree,r.props.bCell.transform.ref,r.props.name),r.getVisible=function(){var n=r.plugin.state.data,a=r.ref;return a?!n.cells.get(a).state.isHidden:!1},r.toggleVisible=function(){var n=r.plugin.state.data,a=r.ref;a&&Jp(n,a,!n.cells.get(a).state.isHidden)},r}return t.prototype.componentDidUpdate=function(){this.ref=ir.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.events.cell.stateUpdated,function(n){r.ref===n.ref&&r.forceUpdate()})},t.prototype.render=function(){var r=this.props,n=r.isRelative,a=r.stats,i=r.channels[r.name],o=a.min,s=a.max,u=a.mean,l=a.sigma,c=Math.round(100*(i.isoValue.kind==="relative"?i.isoValue.relativeValue:i.isoValue.absoluteValue))/100,d=(o-u)/l,f=(s-u)/l;if(!this.props.isUnbounded){var h=Lat.get(this.props.name);this.props.name==="em"?(d=Math.max(h[0],d),f=Math.min(h[1],f)):(d=h[0],f=h[1])}var v=u+l*d,p=u+l*f,g=PM(n?Math.round((p-v)/l)/100:l/100,2),m=n?d:v,y=n?f:p;return M.jsx(a3e,{label:r.label+(r.isRelative?" σ":""),colorStripe:i.color,pivot:M.jsxs("div",E({className:"msp-volume-channel-inline-controls"},{children:[M.jsx(Dee,{value:c,min:m,max:y,step:g,onChange:function(b){return r.changeIso(r.name,b,n)},disabled:r.params.isDisabled,onEnter:r.params.events.onEnter},void 0),M.jsx(qt,{svg:this.getVisible()?hv:fv,onClick:this.toggleVisible,toggleState:!1,disabled:r.params.isDisabled},void 0)]}),void 0),controls:M.jsx(Un,{onChange:function(b){var S=b.name,x=b.value;return r.changeParams(r.name,S,x)},params:Oat,values:i,onEnter:r.params.events.onEnter,isDisabled:r.params.isDisabled},void 0)},void 0)},t}(vr),Nat=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.changeIso=function(n,a,i){var o,s=r.props.params;r.newParams(E(E({},s),{entry:{name:s.entry.name,params:E(E({},s.entry.params),{channels:E(E({},s.entry.params.channels),(o={},o[n]=E(E({},s.entry.params.channels[n]),{isoValue:i?_t.IsoValue.relative(a):_t.IsoValue.absolute(a)}),o))})}}))},r.changeParams=function(n,a,i){var o,s,u=r.props.params;r.newParams(E(E({},u),{entry:{name:u.entry.name,params:E(E({},u.entry.params),{channels:E(E({},u.entry.params.channels),(o={},o[n]=E(E({},u.entry.params.channels[n]),(s={},s[a]=i,s)),o))})}}))},r.changeOption=function(n){var a=n.name,i=n.value,o=r.props.params;if(a==="entry")r.newParams(E(E({},o),{entry:{name:i,params:o.entry.params}}));else{var s=r.props.b.data,u=s.info.kind==="em",l=i.params.isRelative,c=s.info.header.sampling[0],d=o.entry.params.channels,f=o.entry.params.view.name===i.name?o.entry.params.view.params:r.props.info.params.entry.map(o.entry.name).params.view.map(i.name).defaultValue,h=E({},f);i.name==="selection-box"?h.radius=i.params.radius:i.name==="box"?(h.bottomLeft=i.params.bottomLeft,h.topRight=i.params.topRight):i.name==="auto"&&(h.radius=i.params.radius,h.selectionDetailLevel=i.params.selectionDetailLevel),h.isUnbounded=!!i.params.isUnbounded,r.newParams(E(E({},o),{entry:{name:o.entry.name,params:E(E({},o.entry.params),{view:{name:i.name,params:h},detailLevel:i.params.detailLevel,channels:u?{em:r.convert(d.em,c.valuesInfo[0],l)}:{"2fo-fc":r.convert(d["2fo-fc"],c.valuesInfo[0],l),"fo-fc(+ve)":r.convert(d["fo-fc(+ve)"],c.valuesInfo[1],l),"fo-fc(-ve)":r.convert(d["fo-fc(-ve)"],c.valuesInfo[1],l)}})}}))}},r}return t.prototype.areInitial=function(r){return T.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.newParams=function(r){this.props.events.onChange(r,this.areInitial(r))},t.prototype.convert=function(r,n,a){return E(E({},r),{isoValue:a?_t.IsoValue.toRelative(r.isoValue,n):_t.IsoValue.toAbsolute(r.isoValue,n)})},t.prototype.render=function(){if(!this.props.b)return null;var r=this.props.b.data,n=r.info.kind==="em",a=n?"em":"2fo-fc",i=this.props.params,o=this.props.info.params.entry.map(i.entry.name),s=o.params.detailLevel,u=i.entry.params.channels[a].isoValue.kind==="relative",l=r.info.header.sampling[0],c=T.Boolean(u,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),d=!!i.entry.params.view.params.isUnbounded,f=T.Boolean(d,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),h=i.entry.params.view.name==="off",v={entry:T.Select(i.entry.name,r.data.entries.map(function(g){return[g.dataId,g.dataId]}),{isHidden:h,description:"Which entry with volume data to display."}),view:T.MappedStatic(i.entry.params.view.name,{off:T.Group({isRelative:T.Boolean(u,{isHidden:!0}),isUnbounded:T.Boolean(d,{isHidden:!0})},{description:"Display off."}),box:T.Group({bottomLeft:T.Vec3(_.zero()),topRight:T.Vec3(_.zero()),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Static box defined by cartesian coords."}),"selection-box":T.Group({radius:T.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in Å within which the volume is shown."}),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around focused element."}),cell:T.Group({detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around the structure's bounding box."}),auto:T.Group({radius:T.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in Å within which the volume is shown."}),detailLevel:s,selectionDetailLevel:E(E({},s),{label:"Selection Detail"}),isRelative:c,isUnbounded:f},{description:"Box around focused element."})},{options:Li.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Whole Structure" shows the volume for the whole structure.'})},p={entry:i.entry.name,view:{name:i.entry.params.view.name,params:{detailLevel:i.entry.params.detailLevel,radius:i.entry.params.view.params.radius,bottomLeft:i.entry.params.view.params.bottomLeft,topRight:i.entry.params.view.params.topRight,selectionDetailLevel:i.entry.params.view.params.selectionDetailLevel,isRelative:u,isUnbounded:d}}};return h?M.jsx(Un,{onChange:this.changeOption,params:v,values:p,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0):M.jsxs(M.Fragment,{children:[!n&&M.jsx(Ux,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),!n&&M.jsx(Ux,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),!n&&M.jsx(Ux,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),n&&M.jsx(Ux,{label:"EM",name:"em",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),M.jsx(Un,{onChange:this.changeOption,params:v,values:p,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0)},t}(vr),une=function(){return E(E({},kat()),{customParamEditors:[[KO,Nat]]})};function Fat(e,t){var r=new Sat(t||une());return r.init(),oR.render(ze.createElement(qZe,{plugin:r}),e),r}var lne=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const Bat="",cne=e=>!!e&&Xt.isFromPdbArchive(e),Uat={local_metric_values:{label_asym_id:me.Schema.str,label_comp_id:me.Schema.str,label_seq_id:me.Schema.int,metric_id:me.Schema.int,metric_value:me.Schema.float,model_id:me.Schema.int,ordinal_id:me.Schema.int}},jat=(e,t)=>{if(!nn.is(t.sourceData)||!t.sourceData.data.frame.categoryNames.includes(e))return;const r=t.sourceData.data.frame.categories[e].getField("metric_value");if(!(!r||r.rowCount===0))return{timestamp_utc:r.str(0)||FGe(new Date)}},zat=(e,t)=>{const r=jat("ma_qa_metric_local",t);if(!r)return;const n=Gat(t),a=qat(t,n.residues);return{info:r,data:a}};function Vat(e,t,r){return lne(this,void 0,void 0,function*(){return{value:zat(e,t)}})}function s5(e){if(!We.isAtomic(e.unit))return[-1,"No Score"];const t=Gf.get(e.unit.model).value;if(!t||!t.data)return[-1,"No Score"];const r=e.unit.residueIndex[e.element];return t.data.score.has(r)?t.data.score.get(r):[-1,"No Score"]}const bV=[];function Hat(e){if(!e)return bV;const t=Gf.get(e.models[0]).value;return!t||!t.data?bV:t.data.category}function Gat(e){if(!nn.is(e.sourceData))throw new Error("Data format must be mmCIF.");return{residues:KY(Uat.local_metric_values,e.sourceData.data.frame.categories.ma_qa_metric_local)}}const e4={serverUrl:T.Text(Bat,{description:"JSON API Server URL"})},Gf=Xp.createProvider({label:"AF Confidence Score",descriptor:Po({name:"af_confidence_score"}),type:"static",defaultParams:e4,getParams:e=>e4,isApplicable:e=>cne(e),obtain:(e,t,r)=>lne(void 0,void 0,void 0,function*(){return Object.assign(Object.assign({},T.getDefaultValues(e4)),r),yield Vat(e,t)})});function qat(e,t){const r=new Map,{label_asym_id:n,label_seq_id:a,metric_value:i,_rowCount:o}=t,s=[];for(let u=0;u<o;u++){const l=i.value(u),c=e.atomicHierarchy.index.findResidue("1",n.value(u),a.value(u),"");let d="Very low";l>50&&l<=70?d="Low":l>70&&l<=90?d="Medium":l>90&&(d="High"),r.set(c,[l,d]),Di(s,d)}return{score:zM.fromResidueMap(r),category:s}}const im={"No Score":dt.fromRgb(170,170,170),"Very low":dt.fromRgb(255,125,69),Low:dt.fromRgb(255,219,19),Medium:dt.fromRgb(101,203,243),High:dt.fromRgb(0,83,214)},Wat={type:T.MappedStatic("score",{score:T.Group({}),category:T.Group({kind:T.Text()})})};function dne(e,t){let r;if(e.structure&&!e.structure.isEmpty&&e.structure.models[0].customProperties.has(Gf.descriptor))if(t.type.name==="score")r=n=>{if(at.is(n)){const a=s5(n);return im[a[1]]}return im["No Score"]};else{const n=t.type.params.kind;r=a=>{if(at.is(a)){const i=s5(a);return i[1]===n?im[i[1]]:im["No Score"]}return im["No Score"]}}else r=()=>im["No Score"];return{factory:dne,granularity:"group",color:r,props:t,description:"Assigns residue colors according to the AF Confidence score"}}const xV={name:"af-confidence",label:"AF Confidence",category:"Validation",factory:dne,getParams:e=>{const t=Hat(e.structure);return t.length===0?{type:T.MappedStatic("score",{score:T.Group({})})}:{type:T.MappedStatic("score",{score:T.Group({}),category:T.Group({kind:T.Select(t[0],T.arrayToOptions(t))},{isFlat:!0})})}},defaultValues:T.getDefaultValues(Wat),isApplicable:e=>{var t;return cne((t=e.structure)===null||t===void 0?void 0:t.models[0])},ensureCustomProperties:{attach:(e,t)=>t.structure?Gf.attach(e,t.structure.models[0],void 0,!0):Promise.resolve(),detach:e=>e.structure&&e.structure.models[0].customProperties.reference(Gf.descriptor,!1)}},$at=Dr.create({name:"af-confidence-prop",category:"custom-props",display:{name:"AlphaFold Confidence Score",description:"AlphaFold Confidence Score."},ctor:class extends Dr.Handler{constructor(){super(...arguments),this.provider=Gf,this.labelAfConfScore={label:e=>{if(this.params.showTooltip&&e.kind==="element-loci"&&e.elements.length!==0){const t=e.elements[0],r=t.unit;if(!r.model.customProperties.hasReference(Gf.descriptor))return;const n=at.create(e.structure,r,r.elements[Fe.getAt(t.indices,0)]),a=s5(n);return a&&a[0]>0?`Confidence score: ${a[0]} <small>( ${a[1]} )</small>`:""}}}}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelAfConfScore),this.ctx.representation.structure.themes.colorThemeRegistry.add(xV)}update(e){const t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customModelProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}unregister(){this.ctx.customModelProperties.unregister(Gf.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelAfConfScore),this.ctx.representation.structure.themes.colorThemeRegistry.remove(xV)}},params:()=>({autoAttach:T.Boolean(!1),showTooltip:T.Boolean(!0)})});var Xat=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const ac={layoutIsExpanded:!1,layoutShowControls:!1,layoutShowRemoteState:!1,layoutControlsDisplay:"reactive",layoutShowSequence:!1,layoutShowLog:!1,layoutShowLeftPanel:!1,disableAntialiasing:!1,pixelScale:1,enableWboit:!1,viewportShowExpand:!0,viewportShowSelectionMode:!1,viewportShowAnimation:!1,pdbProvider:"pdbe",viewportShowControls:$r.Viewport.ShowControls.defaultValue,viewportShowSettings:$r.Viewport.ShowSettings.defaultValue};class Yat{constructor(t,r,n){const a=une(),i={actions:a.actions,behaviors:[...a.behaviors,Jt.Behavior($at,{autoAttach:!0,showTooltip:!0})],layout:{initial:{isExpanded:ac.layoutIsExpanded,showControls:ac.layoutShowControls,controlsDisplay:ac.layoutControlsDisplay}},config:[[$r.General.DisableAntialiasing,ac.disableAntialiasing],[$r.General.PixelScale,ac.pixelScale],[$r.General.EnableWboit,ac.enableWboit],[$r.Viewport.ShowExpand,ac.viewportShowExpand],[$r.Viewport.ShowSelectionMode,ac.viewportShowSelectionMode],[$r.Download.DefaultPdbProvider,ac.pdbProvider],[$r.Structure.DefaultRepresentationPresetParams,{theme:{globalName:"af-confidence",carbonByChainId:!1,focus:{name:"element-symbol",params:{carbonByChainId:!1}}}}]]},o=typeof t=="string"?document.getElementById(t):t;if(!o)throw new Error(`Could not get element with id '${t}'`);this.plugin=Fat(o,i),this.plugin.behaviors.interaction.click.subscribe(s=>{if(Oe.is(s.current.loci)){const u=at.create();Oe.getFirstLocation(s.current.loci,u);const l=pt.residue.label_seq_id(u),c=pt.chain.auth_asym_id(u);r([{position:l,chain:c}])}}),wt.Canvas3D.SetSettings(this.plugin,{settings:s=>{s.renderer.backgroundColor=dt(16777215)}}),n&&(wt.Canvas3D.SetSettings(this.plugin,{settings:s=>{s.trackball.bindings.scrollZoom.triggers[0].modifiers.control=!0}}),this.plugin.canvas3dContext.input.noScroll=!1,o.addEventListener("wheel",s=>{s.ctrlKey&&s.preventDefault()},!1))}clear(t){this.plugin.clear(),t&&this.showMessage("Loading",t)}loadPdb(t,r){const n=VD.createDefaultParams(this.plugin.state.data.root.obj,this.plugin),a=this.plugin.config.get($r.Download.DefaultPdbProvider);return this.plugin.runTask(this.plugin.state.data.applyAction(VD,{source:{name:"pdb",params:{provider:{id:t,server:{name:a,params:DO[a].defaultValue}},options:Object.assign(Object.assign({},n.source.params.options),{representationParams:r==null?void 0:r.representationParams})}}})).then(()=>{this.clearMessages()})}loadCifUrl(t,r){return Xat(this,void 0,void 0,function*(){const{plugin:n}=this,a=yield n.builders.data.download({url:r,isBinary:!1},{state:{isGhost:!0}}),i=yield n.builders.structure.parseTrajectory(a,"mmcif");return this.plugin.builders.structure.hierarchy.applyPreset(i,"all-models",{useDefaultIfSingleModel:!0}).then(()=>this.clearMessages())})}highlight(t){var r,n;const a=(n=(r=this.plugin.managers.structure.hierarchy.current.structures[0])===null||r===void 0?void 0:r.cell.obj)===null||n===void 0?void 0:n.data;if(!a)return;const i=Va.getStructureSelection(s=>s.struct.generator.atomGroups({"residue-test":s.core.logic.or(t.map(({start:u,end:l,chain:c})=>s.core.logic.and([s.core.rel.inRange([s.struct.atomProperty.macromolecular.label_seq_id(),u,l]),s.core.rel.eq([s.struct.atomProperty.macromolecular.auth_asym_id(),c])])))}),a),o=yt.toLociWithSourceUnits(i);this.plugin.managers.camera.focusLoci(o),this.plugin.managers.interactivity.lociSelects.selectOnly({loci:o})}clearHighlight(){this.plugin.managers.interactivity.lociSelects.deselectAll(),wt.Camera.Reset(this.plugin,{})}showMessage(t,r,n){this.clearMessages(),wt.Toast.Show(this.plugin,{title:t,message:r,timeoutMs:n})}clearMessages(){wt.Toast.Hide(this.plugin)}handleResize(){this.plugin.layout.events.updated.next()}}class i1 extends Error{}const SV=(e,t,r,n)=>{if(!r)return[];if(!e||!t||Number.isNaN(e)||Number.isNaN(t))throw new i1("Invalid start, end coordinates");const a=Object.entries(xg(r,i=>i.chain_id)).map(([i,o])=>{let s=null,u=null;for(const c of o){if(c.unp_end-c.unp_start!==c.end.residue_number-c.start.residue_number)throw new i1("Mismatch between protein sequence and structure residues");const d=n==="UP_PDB"?c.unp_start:c.start.residue_number,f=n==="UP_PDB"?c.unp_end:c.end.residue_number;e>=d&&e<=f&&(s=c),t>=d&&t<=f&&(u=c)}if(s===null||u===null)return null;const l=n==="UP_PDB"?1:-1;return{entity:s.entity_id,chain:s.chain_id,start:e+l*(s.start.residue_number-s.unp_start),end:t+l*(u.start.residue_number-u.unp_start)}}).filter(Boolean);if(!a.length)throw new i1("Start or end coordinate outside of mapping range");return a};var t4=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const CV=(e,t)=>{const{ga:r}=window;r&&r("send","event","protvista-structure",e,t)};class Y_ extends HTMLElement{constructor(){super(),this._uniProtMappingUrl="https://www.ebi.ac.uk/pdbe/api/mappings/uniprot/",this._alphaFoldMappingUrl="https://alphafold.ebi.ac.uk/api/prediction/",this._planHighlight=this._planHighlight.bind(this),this.propagateHighlight=this.propagateHighlight.bind(this)}static get is(){return"protvista-structure"}get css(){return`
    protvista-structure h4 {
      display: inline;
      margin-right: 1em;
    }
      
    .structure-viewer-container {
      position: relative;
      height: ${this._height};
    }
    `}get accession(){return this._accession}set accession(t){this.setAttribute("accession",t)}get structureId(){return this._structureId}set structureId(t){this.setAttribute("structureid",t),this._structureId=t}get height(){return this.getAttribute("height")}set height(t){this.setAttribute("height",t),this._height=t}updateUrls(){this._uniProtMappingUrl=this.getAttribute("uniprot-mapping-url")||this._uniProtMappingUrl,this._alphaFoldMappingUrl=this.getAttribute("alphafold-mapping-url")||this._alphaFoldMappingUrl,this._customDownloadUrl=this.getAttribute("custom-download-url")}connectedCallback(){this.innerHTML="";const t=this.closest("protvista-manager");t&&"register"in t&&"unregister"in t&&(this.manager=t,this.manager.register(this)),this._structureId=this.getAttribute("structureid"),this._accession=this.getAttribute("accession"),this._height=this.getAttribute("height")||"480px",this._highlight=this.getAttribute("highlight")&&Y_._parseHighlight(this.getAttribute("highlight")),this.updateUrls();const r=document.createElement("style");r.innerHTML=this.css,this.appendChild(r);const n=document.createElement("div");n.className="structure-viewer-container",n.id="structure-viewer-instance",this.appendChild(n),this._structureViewer=new Yat(n,this.propagateHighlight,this.hasAttribute("use-ctrl-to-zoom"))}disconnectedCallback(){this.manager&&this.manager.unregister(this)}static get observedAttributes(){return["highlight","structureid","accession","height"]}static _parseHighlight(t){return t?t.split(",").map(n=>{const[a,i]=n.split(":");return{start:Number(a),end:Number(i)}}):[]}attributeChangedCallback(t,r,n){if(r!==n){switch(t){case"structureid":n!==null&&(this._structureId=n),this.selectMolecule();break;case"accession":this._accession=n,this.selectMolecule();break;case"highlight":this._highlight=Y_._parseHighlight(this.getAttribute("highlight"));break;case"height":this._height=n;break}this._planHighlight()}}_planHighlight(){this._plannedRender||(this._plannedRender=!0,requestAnimationFrame(()=>{this._plannedRender=!1,this._selectedMolecule&&this.highlightChain()}))}loadPDBEntry(t){var r;return t4(this,void 0,void 0,function*(){(r=this._structureViewer)===null||r===void 0||r.clear(t);try{CV("load-PDBe",t);const{payload:n}=yield n8(`${this._uniProtMappingUrl}${t}`);return n}catch(n){throw this._structureViewer.showMessage("Error","Couldn't load PDB entry"),n}})}loadAFEntry(t){var r;return t4(this,void 0,void 0,function*(){(r=this._structureViewer)===null||r===void 0||r.clear(t);try{const{payload:n}=yield n8(`${this._alphaFoldMappingUrl}${t}`);return CV("load-AF",t),n}catch(n){throw this._structureViewer.showMessage("Error","Couldn't load AF entry"),n}})}isAF(){return this._structureId.startsWith("AF-")}selectMolecule(){var t;return t4(this,void 0,void 0,function*(){if(!this._structureId||!this._accession)return;this.updateUrls();let r;if(this.isAF()){const a=(yield this.loadAFEntry(this._accession)).find(i=>i.entryId===this._structureId);yield this._structureViewer.loadCifUrl(this._structureId,a.cifUrl)}else{const n=yield this.loadPDBEntry(this._structureId);r=(t=Object.values(n)[0].UniProt[this._accession])===null||t===void 0?void 0:t.mappings,this._customDownloadUrl?yield this._structureViewer.loadCifUrl(this._structureId,`${this._customDownloadUrl}${this._structureId.toLowerCase()}.cif`):yield this._structureViewer.loadPdb(this._structureId.toLowerCase())}this._selectedMolecule={id:this._structureId,mappings:r},this._planHighlight()})}propagateHighlight(t){if(!(t!=null&&t.length)||t.some(i=>!Number.isInteger(i.position)))return;let r;try{r=a8(t,i=>SV(i.position,i.position,this._selectedMolecule.mappings,"PDB_UP").filter(o=>o.chain===i.chain)).filter(Boolean)}catch(i){if(i instanceof i1){this._structureViewer.showMessage("Error",i.message);return}throw i}if(!r.length){this._structureViewer.showMessage("Error","Residue outside of sequence range");return}const n=r.map(i=>`${i.start}:${i.end}`);this.setAttribute("highlight",n.join(","));const a=new CustomEvent("change",{detail:{highlight:n},bubbles:!0,cancelable:!0});this.dispatchEvent(a)}highlightChain(){if(!this._highlight||typeof this._highlight=="string")return;let t;try{t=a8(this._highlight,({start:r,end:n})=>this.isAF()?{start:r,end:n,chain:"A"}:SV(r,n,this._selectedMolecule.mappings,"UP_PDB")).filter(Boolean)}catch(r){if(r instanceof i1){this._structureViewer.clearHighlight(),this._structureViewer.showMessage("Error",r.message);return}throw r}if(!(t!=null&&t.length)){this._structureViewer.clearHighlight();return}this._structureViewer.highlight(t),this._structureViewer.clearMessages()}}const Kat=e=>{const t=new Map;return e.forEach(r=>{r.dataset.filter&&t.set(r.dataset.filter,new Set)}),t},Qat=(e,t,r,n)=>!r&&t===n||!n&&e===r||e<=r&&t>=n,Zat=(e,t,r,n)=>e>n||t<r,u5=Qs`pd-group-trigger__expanded`,K_=Qs`active`,o1=Qs`transparent`,l5=Qs`overlapped`,c5=Qs`hidden`,Jat=Qs`
  protvista-datatable table {
    width: 100%;
    padding: 0;
    margin: 0;
    border-spacing: 0;
  }

  protvista-datatable table th {
    position: sticky;
    position: -webkit-sticky;
    position: -moz-sticky;
    position: -ms-sticky;
    position: -o-sticky;
    text-align: left;
    vertical-align: top;
    background-color: var(--protvista-datable__header-background, #fff);
    color: var(--protvista-datable__header-text, #393b42);
    text-overflow: ellipsis;
    top: 0;
    text-transform: uppercase;
    z-index: 400;
  }

  protvista-datatable table th .filter-wrap {
    display: flex;
    flex-direction: column;
  }

  protvista-datatable table th .filter-wrap select {
    width: fit-content;
  }

  protvista-datatable table td,
  protvista-datatable table th {
    padding: 0.2rem;
    border-bottom: 1px solid #c2c4c4;
  }

  protvista-datatable table tr:hover:not(.${K_}):not(.${o1}) {
    background-color: var(--protvista-datatable__hover, #f1f1f1);
  }

  protvista-datatable table td {
    cursor: pointer;
  }

  protvista-datatable table .pd-group-trigger {
    width: 1rem;
  }

  protvista-datatable table .pd-group-trigger button {
    background: none;
    border: none;
    padding: 0.2rem; // increase click area
    position: relative;
    text-decoration: none;
    cursor: pointer;
    transition: background 250ms ease-in-out, transform 150ms ease;
    -webkit-appearance: none;
    -moz-appearance: none;
  }

  protvista-datatable table .pd-group-trigger button:before {
    display: inline-block;
    content: " ";
    border-style: solid;
    border-width: 0.4rem 0 0.4rem 0.6rem;
    border-color: transparent transparent transparent #161d39;
    transition-duration: 0.3s;
    transition-property: transform;
  }

  protvista-datatable table .pd-group-trigger button.${u5}:before {
    transform: rotate(90deg);
  }

  protvista-datatable table td:nth-child(1) {
    border-left: 0.5rem solid transparent;
  }

  protvista-datatable table .${l5} td:nth-child(1) {
    border-left: 0.5rem solid
      var(--protvista-datatable__overlapped, rgba(255, 0, 0, 0.8));
  }

  protvista-datatable table .${K_} {
    background-color: var(
      --protvista-datatable__active,
      rgba(255, 235, 59, 0.3)
    ) !important;
  }

  protvista-datatable table .${o1} {
    opacity: 0.2;
  }
  protvista-datatable table .${o1} td:hover {
    cursor: default;
    background-color: inherit;
  }

  protvista-datatable table .${c5} {
    display: none;
  }

  protvista-datatable table tr[data-group-for] td {
    padding-left: 1.7rem;
    padding-bottom: 0.7rem;
  }

  protvista-datatable table .odd {
    background-color: var(--protvista-datatable__odd, #e4e8eb);
  }

  protvista-datatable table .even {
    background-color: var(--protvista-datatable__even, #fff);
  }
`;class eit extends ph{constructor(){super(),this.height="25rem",this.visibleChildren=[],this.noScrollToRow=!1,this.noDeselect=!1,this.expandTable=!1,this.scrollFilter=new M$(this),this.wheelListener=t=>this.scrollFilter.wheel(t),this.eventHandler=this.eventHandler.bind(this)}static get is(){return"protvista-datatable"}connectedCallback(){super.connectedCallback();const t=this.querySelector("table tbody");if(!t)return;this.mutationObserver=new MutationObserver(()=>{this.init()}),this.mutationObserver.observe(t,{characterData:!0,childList:!0,subtree:!0});const r=document.createElement("style");r.innerHTML=Jat.toString(),document.querySelector("head").appendChild(r),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this.noDeselect||document.addEventListener("click",this.eventHandler),this.classList.add("feature"),this.hasAttribute("filter-scroll")&&document.addEventListener("wheel",this.wheelListener),this.init()}disconnectedCallback(){super.disconnectedCallback(),this.manager&&this.manager.unregister(this),document.removeEventListener("click",this.eventHandler),document.removeEventListener("wheel",this.wheelListener),this.mutationObserver.disconnect()}init(){if(this.columns=this.querySelectorAll("table thead th"),!this.querySelector(".pd-group-column-header")){const t=document.createElement("th");t.classList.add("pd-group-column-header");const r=this.querySelector("table thead tr");r.insertBefore(t,r.firstChild)}this.rows=this.querySelectorAll("table tbody tr"),this.rows.forEach(t=>{if(!t.dataset.groupFor&&!t.querySelector(".pd-group-trigger")){const r=t.insertCell(0);if(r.classList.add("pd-group-trigger"),this.querySelector("[data-group-for]")){const n=document.createElement("button");n.dataset.triggerId=t.dataset.id,r.appendChild(n),n.addEventListener("click",a=>this.handleGroupToggle(a))}}t.addEventListener("click",r=>this.handleClick(r,t))}),this.updateRowStyling(),this.selectedFilters=new Map,this.filterMap=this.parseDataForFilters(),this.addFilterOptions()}parseDataForFilters(){const t=Kat(this.columns);return this.rows.forEach(r=>{r.childNodes.forEach(a=>{var i;!((i=a.dataset)===null||i===void 0)&&i.filter&&t.get(a.dataset.filter).add(a.dataset.filterValue)})}),t}addFilterOptions(){this.columns.forEach(t=>{if(t.dataset.filter){let r,n;t.querySelector(".filter-wrap")?(r=t.querySelector("select"),n=t.querySelector(".filter-wrap")):(n=document.createElement("span"),n.className="filter-wrap",n.innerHTML=t.innerHTML,r=document.createElement("select"),r.dataset.testid="select",r.onchange=a=>this.handleFilterChange(a,t.dataset.filter)),r.innerHTML="<option  selected value>-- Select --</option>",this.filterMap.get(t.dataset.filter).forEach(a=>{const i=document.createElement("option");i.value=a,i.label=a,i.dataset.testid="select-option",r.appendChild(i)}),t.innerHTML="",n.appendChild(r),t.appendChild(n)}})}eventHandler(t){const r=t.target;!r.closest("protvista-datatable")&&!r.closest(".feature")&&(this.selectedid=null,this.highlight=null)}static get properties(){return{highlight:{converter:t=>{if(t&&t!=="null")try{const r=t.split(":").map(n=>Number(n));if(r.length!==2)throw new Error("Highlight should be only 2 values separated by ':'.");return[r[0],r[1]]}catch(r){console.error("Invalid highlight coordinates:",r)}return null}},height:{type:String},displayStart:{type:Number},displayEnd:{type:Number},visibleChildren:{type:Array},selectedid:{type:String},noScrollToRow:{type:Boolean},noDeselect:{type:Boolean},expandTable:{type:Boolean}}}static get styles(){return Qs`
      :host {
        display: block;
      }

      .protvista-datatable-container {
        overflow-y: auto;
        // Note: overflow-x was set to 'hidden' but changing
        // to 'auto' doesn't seem to be an issue.
        overflow-x: auto;
        scrollbar-gutter: stable;
      }

      :host([scrollable="true"]) .protvista-datatable-container {
        overflow-y: auto;
      }

      :host([scrollable="false"]) .protvista-datatable-container {
        overflow-y: hidden;
      }
    `}handleGroupToggle(t){const{triggerId:r}=t.target.dataset;this.visibleChildren.includes(r)?(this.visibleChildren=this.visibleChildren.filter(n=>n!==r),t.target.classList.remove(u5.cssText)):(this.visibleChildren=[...this.visibleChildren,r],t.target.classList.add(u5.cssText))}handleClick(t,r){if(r.classList.contains("transparent"))return;const{id:n,start:a,end:i}=r.dataset;this.selectedid=n;const o={};a&&i&&(o.highlight=`${a}:${i}`),this.selectedid&&(o.selectedid=this.selectedid),this.dispatchEvent(new CustomEvent("change",{detail:o,bubbles:!0,cancelable:!0}))}handleFilterChange(t,r){const{selectedOptions:n}=t.target,{value:a}=n.item(0);a?this.selectedFilters.set(r,a):this.selectedFilters.delete(r),this.updateRowStyling()}isRowVisible(t){const r=!t.dataset.groupFor||t.dataset.groupFor&&this.visibleChildren.includes(t.dataset.groupFor);if(!this.selectedFilters||this.selectedFilters.size===0)return r;for(const[n,a]of this.selectedFilters){let i;if(t.dataset.groupFor?i=this.querySelector(`[data-id="${t.dataset.groupFor}"]`).querySelector(`[data-filter="${n}"]`):i=t.querySelector(`[data-filter="${n}"]`),i&&i.dataset.filterValue!==a)return!1}return r}updateRowStyling(){var t;let r=0;(t=this.rows)===null||t===void 0||t.forEach(n=>{this.isRowVisible(n)?n.classList.remove(c5.cssText):n.classList.add(c5.cssText),n.dataset.groupFor||r++;const{start:i,end:o}=n.dataset;if(n.classList.add(r%2===0?"even":"odd"),this.selectedid&&(this.selectedid===n.dataset.id||n.dataset.groupFor===this.selectedid)?n.classList.add(K_.cssText):n.classList.remove(K_.cssText),Zat(this.displayStart,this.displayEnd,Number(i),Number(o))?n.classList.add(o1.cssText):n.classList.remove(o1.cssText),this.highlight&&Qat(this.highlight[0],this.highlight[1],Number(i),Number(o))?n.classList.add(l5.cssText):n.classList.remove(l5.cssText),n.dataset.groupFor){const s=this.columns.length+1;n.cells[0].colSpan=s-n.cells.length+1}})}scrollIntoView(){if(!this.selectedid)return;const t=this.querySelector(`[data-id="${this.selectedid}"]`);t==null||t.scrollIntoView({behavior:"smooth",block:"center"})}render(){const t=this.expandTable||this.hasAttribute("expand-table")?"height: auto":`max-height:${this.height}`;return Vr`
      <div class="protvista-datatable-container" style=${t}>
        <slot></slot>
      </div>
    `}updated(){this.updateRowStyling(),this.noScrollToRow||this.scrollIntoView()}}const ws=function(e,t){customElements.get(e)||customElements.define(e,t)},fne="/JS-final-task/assets/spinner-374aaf14.svg",tit="/JS-final-task/assets/download-325e4c97.svg",hne=Qs`
  .protvista-loader {
    display: flex;
    justify-content: center;
    padding: 4rem 0;
  }
  .protvista-loader svg {
    height: 100px;
  }

  .protvista-no-results {
    background-color: #e4e8eb;
    display: flex;
    justify-content: center;
    padding: 1rem;
    font-size: 0.8rem;
  }
`,rit=[{name:"PDBe",link:"https://www.ebi.ac.uk/pdbe-srv/view/entry/"},{name:"RCSB-PDB",link:"https://www.rcsb.org/structure/"},{name:"PDBj",link:"https://pdbj.org/mine/summary/"},{name:"PDBsum",link:"https://www.ebi.ac.uk/pdbsum/"}],nit="https://alphafold.ebi.ac.uk/entry/",ait=e=>e.dbReferences.filter(t=>t.type==="PDB").sort((t,r)=>t.id.localeCompare(r.id)).map(({id:t,properties:r})=>{if(!r)return;const{chains:n,resolution:a,method:i}=r;let o,s;if(n){const l=n.split("=");l.length===2&&([o,s]=l)}return{id:t,source:"PDB",method:i,resolution:!a||a==="-"?void 0:a,downloadLink:`https://www.ebi.ac.uk/pdbe/entry-files/download/pdb${t.toLowerCase()}.ent`,chain:o,positions:s,protvistaFeatureId:t}}).filter(t=>t!==void 0),iit=e=>e.map(t=>({id:t.entryId,source:"AlphaFold",method:"Predicted",positions:`${t.uniprotStart}-${t.uniprotEnd}`,protvistaFeatureId:t.entryId,downloadLink:t.pdbUrl})),oit=Vr`
  <strong>Model Confidence:</strong>
  <ul class="no-bullet">
    <li>
      <span class="af-legend" style="background-color: rgb(0, 83, 214)"></span>
      Very high (pLDDT > 90)
    </li>
    <li>
      <span
        class="af-legend"
        style="background-color: rgb(101, 203, 243)"
      ></span>
      Confident (90 > pLDDT > 70)
    </li>
    <li>
      <span class="af-legend" style="background-color:rgb(255, 219, 19)"></span>
      Low (70 > pLDDT > 50)
    </li>
    <li>
      <span class="af-legend" style="background-color:rgb(255, 125, 69)"></span>
      Very low (pLDDT < 50)
    </li>
  </ul>
  <p class="small">
    AlphaFold produces a per-residue confidence score (pLDDT) between 0 and 100.
    Some regions with low pLDDT may be unstructured in isolation.
  </p>
`,r4="protvista-styles";class sit extends ph{constructor(){super(),ws("protvista-structure",Y_),ws("protvista-datatable",eit),this.loading=!0,this.onTableRowClick=this.onTableRowClick.bind(this),this.addStyles()}static get properties(){return{accession:{type:String},structureId:{type:String},data:{type:Object},loading:{type:Boolean}}}async connectedCallback(){if(super.connectedCallback(),!this.accession)return;const t=`https://www.ebi.ac.uk/proteins/api/proteins/${this.accession}`,r=`https://alphafold.ebi.ac.uk/api/prediction/${this.accession}`,n=[];await Promise.all([t,r].map(s=>lX(s).then(u=>n[s]=u.payload,u=>console.warn(u)))),this.loading=!1;const a=ait(n[t]||[]),i=iit(n[r]||[]),o=[...a,...i];!o||!o.length||(this.data=o)}disconnectedCallback(){this.removeStyles()}updated(){var t;const r=this.querySelector("protvista-datatable");!(r!=null&&r.selectedid)&&(!((t=this.data)===null||t===void 0)&&t[0])&&(this.onTableRowClick({id:this.data[0].id}),r.selectedid=this.structureId)}addStyles(){var t;if(!document.getElementById(r4)){const r=document.createElement("style");r.id=r4,r.innerHTML=`
      ${hne.toString()}
      ${this.cssStyle}
      `,(t=document.querySelector("head"))===null||t===void 0||t.append(r)}}removeStyles(){const t=document.getElementById(r4);t&&t.remove()}onTableRowClick({id:t}){this.structureId=t,this.structureId.startsWith("AF-")?this.metaInfo=oit:this.metaInfo=void 0}get cssStyle(){return Qs`
      .protvista-uniprot-structure__structure {
        display: flex;
      }
      .protvista-uniprot-structure__meta {
        flex: 1;
        padding: 1rem;
      }
      .protvista-uniprot-structure__structure protvista-structure {
        z-index: 40000;
        width: 100%;
        flex: 4;
      }
      .protvista-uniprot-structure__meta .small {
        font-size: 0.75rem;
      }
      .protvista-uniprot-structure__meta .no-bullet {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .protvista-uniprot-structure__meta .no-bullet li {
        padding: 0;
        margin: 0.5rem 0;
      }
      .protvista-uniprot-structure__meta .af-legend::before {
        content: '';
        margin: 0;
        display: inline-block;
        width: 20px;
        height: 16px;
      }
      .download-link svg {
        width: 1rem;
      }
    `}createRenderRoot(){return this}render(){var t;return Vr`
      <div class="protvista-uniprot-structure">
        <div class="protvista-uniprot-structure__structure">
          ${this.metaInfo?Vr`<div class="protvista-uniprot-structure__meta">
                ${this.metaInfo}
              </div>`:Vr``}
          ${this.structureId?Vr`<protvista-structure
                structureid=${this.structureId}
                accession=${this.accession}
              ></protvista-structure>`:Vr``}
        </div>
        <div class="class="protvista-uniprot-structure__table">
        ${this.data&&this.data.length?Vr`<protvista-datatable noScrollToRow noDeselect filter-scroll>
              <table>
                <thead>
                  <tr>
                    <th data-filter="source">Source</th>
                    <th>Identifier</th>
                    <th data-filter="method">Method</th>
                    <th>Resolution</th>
                    <th>Chain</th>
                    <th>Positions</th>
                    <th>Links</th>
                    <th><!--Download--></th>
                  </tr>
                </thead>
                <tbody>
                  ${(t=this.data)===null||t===void 0?void 0:t.map(({source:r,id:n,method:a,resolution:i,chain:o,positions:s,downloadLink:u})=>Vr`<tr
                      data-id="${n}"
                      @click="${()=>this.onTableRowClick({id:n})}"
                    >
                      <td data-filter="source" data-filter-value="${r}">
                        <strong>${r}</strong>
                      </td>
                      <td>${n}</td>
                      <td data-filter="method" data-filter-value="${a}">
                        ${a}
                      </td>
                      <td>${i?i.replace("A","Å"):""}</td>
                      <td>${o||""}</td>
                      <td>${s||""}</td>
                      <td>
                        ${r==="PDB"?Vr`
                              ${rit.map(l=>Vr`
                                  <a href="${l.link}${n}"
                                    >${l.name}</a
                                  >
                                `).reduce((l,c)=>Vr` ${l} · ${c} `)}
                            `:Vr`<a href="${nit}${this.accession}"
                              >AlphaFold</a
                            >`}
                      </td>
                      <td>
                        ${u?Vr`<a href="${u}" class="download-link"
                              >${fI`${mI(tit)}`}</a
                            >`:""}
                      </td>
                    </tr>`)}
                </tbody>
              </table>
            </protvista-datatable>`:Vr``}
        ${this.loading?Vr`<div class="protvista-loader">
              ${fI`${mI(fne)}`}
            </div>`:Vr``}
        ${!this.data&&!this.loading?Vr`<div class="protvista-no-results">
              No structure information available for ${this.accession}
            </div>`:Vr``}
      </div>
    `}}var uit={exports:{}};(function(e){(function(t,r,n){e.exports?e.exports=n():r[t]=n()})("urljoin",Kh,function(){function t(r){var n=[];if(r.length===0)return"";if(typeof r[0]!="string")throw new TypeError("Url must be a string. Received "+r[0]);if(r[0].match(/^[^/:]+:\/*$/)&&r.length>1){var a=r.shift();r[0]=a+r[0]}r[0].match(/^file:\/\/\//)?r[0]=r[0].replace(/^([^/:]+):\/*/,"$1:///"):r[0]=r[0].replace(/^([^/:]+):\/*/,"$1://");for(var i=0;i<r.length;i++){var o=r[i];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(i>0&&(o=o.replace(/^[\/]+/,"")),i<r.length-1?o=o.replace(/[\/]+$/,""):o=o.replace(/[\/]+$/,"/"),n.push(o))}var s=n.join("/");s=s.replace(/\/(\?|&|#[^!])/g,"$1");var u=s.split("?");return s=u.shift()+(u.length>0?"?":"")+u.join("&"),s}return function(){var r;return typeof arguments[0]=="object"?r=arguments[0]:r=[].slice.call(arguments),t(r)}})})(uit);var lit={exports:{}};(function(e,t){(function(r,n){n()})(Kh,function(){function r(l,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function n(l,c,d){var f=new XMLHttpRequest;f.open("GET",l),f.responseType="blob",f.onload=function(){u(f.response,c,d)},f.onerror=function(){console.error("could not download file")},f.send()}function a(l){var c=new XMLHttpRequest;c.open("HEAD",l,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function i(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(c)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Kh=="object"&&Kh.global===Kh?Kh:void 0,s=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(l,c,d){var f=o.URL||o.webkitURL,h=document.createElement("a");c=c||l.name||"download",h.download=c,h.rel="noopener",typeof l=="string"?(h.href=l,h.origin===location.origin?i(h):a(h.href)?n(l,c,d):i(h,h.target="_blank")):(h.href=f.createObjectURL(l),setTimeout(function(){f.revokeObjectURL(h.href)},4e4),setTimeout(function(){i(h)},0))}:"msSaveOrOpenBlob"in navigator?function(l,c,d){if(c=c||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(r(l,d),c);else if(a(l))n(l,c,d);else{var f=document.createElement("a");f.href=l,f.target="_blank",setTimeout(function(){i(f)})}}:function(l,c,d,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof l=="string")return n(l,c,d);var h=l.type==="application/octet-stream",v=/constructor/i.test(o.HTMLElement)||o.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||h&&v||s)&&typeof FileReader<"u"){var g=new FileReader;g.onloadend=function(){var b=g.result;b=p?b:b.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=b:location=b,f=null},g.readAsDataURL(l)}else{var m=o.URL||o.webkitURL,y=m.createObjectURL(l);f?f.location=y:location.href=y,f=null,setTimeout(function(){m.revokeObjectURL(y)},4e4)}});o.saveAs=u.saveAs=u,e.exports=u})})(lit);const vc={UPDiseaseColor:"#990000",UPNonDiseaseColor:"#99cc00",predictedColor:"#4c8acd",othersColor:"#009e73"},cit={uncertain:[/uncertain/i,/conflicting/i,/unclassified/i,/risk factor/i]},dit=(e,t)=>e.some(({type:r})=>t.some(n=>n.test(r))),Vh=(e,t)=>e.map(r=>{const n=r.variants.filter(a=>t(a));return{...r,variants:[...n]}}),pne=[{name:"disease",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Likely disease"],colors:[vc.UPDiseaseColor]},filterData:e=>Vh(e,t=>{var r;return(r=t.association)===null||r===void 0?void 0:r.some(n=>n.disease)})},{name:"predicted",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Predicted consequence"],colors:[vc.predictedColor]},filterData:e=>Vh(e,t=>t.hasPredictions)},{name:"nonDisease",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Likely benign"],colors:[vc.UPNonDiseaseColor]},filterData:e=>Vh(e,t=>{var r;return(r=t.association)===null||r===void 0?void 0:r.some(n=>n.disease===!1)})},{name:"uncertain",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Uncertain"],colors:[vc.othersColor]},filterData:e=>Vh(e,t=>typeof t.clinicalSignificances>"u"&&!t.hasPredictions||t.clinicalSignificances&&dit(t.clinicalSignificances,cit.uncertain))},{name:"UniProt",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["UniProt reviewed"],colors:["#9f9f9f"]},filterData:e=>Vh(e,t=>t.xrefNames&&(t.xrefNames.includes("uniprot")||t.xrefNames.includes("UniProt")))},{name:"ClinVar",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["ClinVar reviewed"],colors:["#9f9f9f"]},filterData:e=>Vh(e,t=>t.xrefNames&&(t.xrefNames.includes("ClinVar")||t.xrefNames.includes("clinvar")))},{name:"LSS",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["Large scale studies"],colors:["#9f9f9f"]},filterData:e=>Vh(e,t=>t.sourceType==="large_scale_study"||t.sourceType==="mixed")}],jx=(e,t)=>{const r=[{variants:[t]}],n=pne.find(a=>a.name===e);return n?n.filterData(r)[0].variants.length>0:!1},fit=e=>jx("disease",e)?vc.UPDiseaseColor:jx("nonDisease",e)?vc.UPNonDiseaseColor:jx("uncertain",e)?vc.othersColor:jx("predicted",e)?vc.predictedColor:vc.othersColor,hit=Qs`
  protvista-tooltip a {
    text-decoration: underline;
    color: #fff;
  }
  .track-content {
    width: 80vw;
  }

  .nav-container,
  .category__track {
    display: flex;
    margin-bottom: 0.1rem;
  }

  .category {
    display: none;
    margin-bottom: 0.1rem;
  }

  .category-label,
  .track-label,
  .action-buttons,
  .credits {
    width: 20vw;
    padding: 0.5em;
  }

  .action-buttons {
    display: flex;
    justify-content: flex-end;
    align-items: flex-end;
  }

  .category-label {
    background-color: #b2f5ff;
    cursor: pointer;
  }

  .category-label::before {
    content: ' ';
    display: inline-block;
    width: 0;
    height: 0;
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    border-left: 5px solid #333;
    margin-right: 5px;
    -webkit-transition: all 0.1s;
    /* Safari */
    -o-transition: all 0.1s;
    transition: all 0.1s;
  }

  .category-label.open::before {
    content: ' ';
    display: inline-block;
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid #333;
    margin-right: 5px;
  }

  .track-label {
    background-color: #d9faff;
  }

  protvista-track {
    border-top: 1px solid #d9faff;
  }

  .feature {
    cursor: pointer;
  }
`,pit=Oxe,vit=Lxe,mit=qxe,git=Jxe,yit=eSe,bit=nSe,_V=pne,wV=fit,xit={"protvista-feature-adapter":pit,"protvista-interpro-adapter":yit,"protvista-proteomics-adapter":vit,"protvista-structure-adapter":mit,"protvista-variation-adapter":git,"protvista-proteomics-ptm-adapter":bit};class Sit extends ph{constructor(){super(),this.displayCoordinates={},this.openCategories=[],this.notooltip=!1,this.nostructure=!1,this.hasData=!1,this.loading=!0,this.data={},this.rawData={},this.displayCoordinates={},this.addStyles()}static get properties(){return{suspend:{type:Boolean,reflect:!0},accession:{type:String,reflect:!0},sequence:{type:String},data:{type:Object},openCategories:{type:Array},config:{type:Object},notooltip:{type:Boolean,reflect:!0},nostructure:{type:Boolean,reflect:!0}}}addStyles(){var t;const r=document.createElement("style");r.innerHTML=`${hit.toString()} ${hne.toString()}`,(t=document.querySelector("head"))===null||t===void 0||t.append(r)}registerWebComponents(){ws("protvista-navigation",p0e),ws("protvista-tooltip",v0e),ws("protvista-track",Bp),ws("protvista-interpro-track",Hy),ws("protvista-sequence",gxe),ws("protvista-variation",nk),ws("protvista-variation-graph",Sxe),ws("protvista-filter",Cxe),ws("protvista-manager",IC),ws("protvista-uniprot-structure",sit)}async _loadData(){const t=this.accession;if(t&&this.config){const r=this.config.categories.map(({tracks:a})=>a.map(({data:i})=>i[0].url)).flat(),n=[...new Set(r)];await Promise.all(n.map(a=>lX(a.replace("{accession}",t)).then(i=>{var o,s;this.rawData[a]=i.payload,!this.hasData&&(!((s=(o=i.payload)===null||o===void 0?void 0:o.features)===null||s===void 0)&&s.length)&&(this.hasData=!0)},i=>console.warn(i)).catch(i=>{console.log(i)}))),this.config.categories.map(({name:a,tracks:i,trackType:o})=>{const s=i.map(({data:u,name:l,filter:c})=>{const{url:d,adapter:f}=u[0],h=this.rawData[d]||[];if(!h||f==="protvista-variation-adapter"&&h.length===0)return;const v=f?xit[f](h):h,p=Array.isArray(v)&&c?v.filter(({type:g})=>g===c):v;if(p)return this.data[`${a}-${l}`]=p,p});this.data[a]=o==="protvista-variation-graph"?s[0]:s.flat()})}this.loading=!1,this.requestUpdate()}async _loadDataInComponents(){await khe(),Object.entries(this.data).forEach(([t,r])=>{var n,a;const i=document.getElementById(`track-${t}`);i&&i.data!==r&&(i.data=r);const o=(n=this.config)===null||n===void 0?void 0:n.categories.find(({name:s})=>s===t);if(o&&o.tracks&&r&&(r.length>0||!((a=r.variants)===null||a===void 0)&&a.length)){const s=document.getElementById(`category_${o.name}`);s&&(s.style.display="flex");for(const u of o.tracks){const l=document.getElementById(`track-${t}-${u.name}`);l&&(l.data=this.data[`${t}-${u.name}`])}}})}updated(t){super.updated(t);const r=this.querySelector("protvista-filter");r&&r.filters!==_V&&(r.filters=_V);const n=this.querySelector("protvista-variation");if(n&&n.colorConfig!==wV&&(n.colorConfig=wV),t.has("suspend")){if(this.suspend)return;this._init()}this._loadDataInComponents()}_init(){this.config||(this.config=oSe),this.accession&&(this.loadEntry(this.accession).then(t=>{var r;this.sequence=t.sequence.sequence,this.displayCoordinates={start:1,end:(r=this.sequence)===null||r===void 0?void 0:r.length}}),this._loadData())}connectedCallback(){super.connectedCallback(),this.registerWebComponents(),this.suspend||this._init(),this.addEventListener("change",t=>{var r,n,a;!((r=t.detail)===null||r===void 0)&&r.displaystart&&(this.displayCoordinates.start=t.detail.displaystart),!((n=t.detail)===null||n===void 0)&&n.displayend&&(this.displayCoordinates.end=t.detail.displayend),this.notooltip||(!((a=t.detail)===null||a===void 0)&&a.eventtype?t.detail.eventtype==="click"&&this.updateTooltip(t):this._resetTooltip())}),this.notooltip||(this.addEventListener("click",t=>{const r=t.target;if(!r.closest(".feature")&&!r.closest("protvista-tooltip")){const n=this.querySelector("protvista-tooltip");n&&(n.visible=!1)}}),document.addEventListener("click",this._resetTooltip)),this.addEventListener("load",()=>{this.hasData||(this.dispatchEvent(new CustomEvent("protvista-event",{detail:{hasData:!0},bubbles:!0})),this.hasData=!0)})}disconnectedCallback(){this.notooltip||document.removeEventListener("click",this._resetTooltip)}_resetTooltip(t){var r;if(this&&(!t||!(!((r=t.target)===null||r===void 0)&&r.closest("protvista-uniprot")))){const n=this.querySelector("protvista-tooltip");n&&(n.visible=!1)}}async loadEntry(t){try{return await(await fetch(`https://www.ebi.ac.uk/proteins/api/proteins/${t}`)).json()}catch(r){console.error("Couldn't load UniProt entry",r)}}createRenderRoot(){return this}render(){var t,r;return!this.sequence||!this.config||this.suspend?Vr``:this.loading?Vr`<div class="protvista-loader">
        ${fI`${mI(fne)}`}
      </div>`:this.hasData?Vr`
      <protvista-manager
        attributes="length displaystart displayend highlight activefilters filters"
        additionalsubscribers="protvista-structure"
      >
        <div class="nav-container">
          <div class="action-buttons">
            <download-panel
              accession="${this.accession}"
              config="${JSON.stringify(this.config.download)}"
            />
          </div>
          <div class="track-content">
            <protvista-navigation
              length="${this.sequence.length}"
            ></protvista-navigation>
            <protvista-sequence
              length="${this.sequence.length}"
              sequence="${this.sequence}"
              displaystart=${(t=this.displayCoordinates)===null||t===void 0?void 0:t.start}
              displayend="${(r=this.displayCoordinates)===null||r===void 0?void 0:r.end}"
            ></protvista-sequence>
          </div>
        </div>
        ${this.config.categories.map(n=>this.data[n.name]&&Vr`
              <div class="category" id="category_${n.name}">
                <div
                  class="category-label"
                  data-category-toggle="${n.name}"
                  @click="${this.handleCategoryClick}"
                >
                  ${n.label}
                </div>

                <div
                  data-id="category_${n.name}"
                  class="aggregate-track-content track-content"
                  .style="${this.openCategories.includes(n.name)?"opacity:0":"opacity:1"}"
                >
                  ${this.data[n.name]&&this.getTrack(n.trackType,"non-overlapping",n.color,n.shape,n.name)}
                </div>
              </div>

              <!-- Expanded Categories -->
              ${n.tracks&&n.tracks.map(a=>{if(this.openCategories.includes(n.name)){const i=this.data[`${n.name}-${a.name}`];return i&&(Array.isArray(i)&&i.length||Object.keys(i).length)?Vr`
                        <div class="category__track" id="track_${a.name}">
                          <div class="track-label" title="${a.tooltip}">
                            ${a.filterComponent?this.getFilterComponent(`${n.name}-${a.name}`):a.label}
                          </div>
                          <div
                            class="track-content"
                            data-id="track_${a.name}"
                          >
                            ${this.getTrack(a.trackType,"non-overlapping",a.color||n.color,a.shape||n.shape,`${n.name}-${a.name}`)}
                          </div>
                        </div>
                      `:""}})}
              ${n.tracks?"":this.data[n.name].map(a=>{if(this.openCategories.includes(n.name))return!a||!a.accession?"":Vr`
                          <div
                            class="category__track"
                            id="track_${a.accession}"
                          >
                            <div class="track-label" title="${a.accession}">
                              ${a.accession}
                            </div>
                            <div
                              class="track-content"
                              data-id="track_${a.accession}"
                            >
                              ${this.getTrack(n.trackType,"non-overlapping",n.color,n.shape,`${n.name}-${a.accession}`)}
                            </div>
                          </div>
                        `})}
            `)}
        <div class="nav-container">
          <div class="credits"></div>
          <div class="track-content">
            <protvista-sequence
              length="${this.sequence.length}"
              sequence="${this.sequence}"
              displaystart=${this.displayCoordinates.start}
              displayend="${this.displayCoordinates.end}"
            ></protvista-sequence>
          </div>
        </div>
        ${this.nostructure?"":Vr`
              <protvista-uniprot-structure
                accession="${this.accession||""}"
              ></protvista-uniprot-structure>
            `}
        <protvista-tooltip />
      </protvista-manager>
    `:Vr`<div class="protvista-no-results">
        No feature data available for ${this.accession}
      </div>`}async updateTooltip(t){var r,n;const a=(r=t.detail)===null||r===void 0?void 0:r.feature;if(!a.tooltipContent)return;const i=this.querySelector("protvista-tooltip");if(i&&(i.title=`${a.type} ${a.start}-${a.end}`,i.innerHTML=a.tooltipContent,i.visible=!0,!((n=t.detail)===null||n===void 0)&&n.coords)){const[o,s]=t.detail.coords;i.x=o,i.y=s}}handleCategoryClick(t){const r=t.target,n=r.getAttribute("data-category-toggle");n&&!r.classList.contains("open")?(r.classList.add("open"),this.openCategories=[...this.openCategories,n]):(r.classList.remove("open"),this.openCategories=[...this.openCategories].filter(a=>a!==n))}getCategoryTypesAsString(t){return t.map(r=>r.filter).join(",")}getFilterComponent(t){return Vr`
      <protvista-filter
        style="minWidth: 20%"
        for="track-${t}"
      ></protvista-filter>
    `}getTrack(t,r="",n="",a="",i=""){var o,s,u,l,c,d,f,h,v,p,g,m;switch(t){case"protvista-track":return Vr`
          <protvista-track
            length="${(o=this.sequence)===null||o===void 0?void 0:o.length}"
            layout="${r}"
            color="${n}"
            shape="${a}"
            displaystart="${(s=this.displayCoordinates)===null||s===void 0?void 0:s.start}"
            displayend="${(u=this.displayCoordinates)===null||u===void 0?void 0:u.end}"
            id="track-${i}"
          >
          </protvista-track>
        `;case"protvista-interpro-track":return Vr`
          <protvista-interpro-track
            length="${(l=this.sequence)===null||l===void 0?void 0:l.length}"
            color="${n}"
            shape="${a}"
            displaystart="${(c=this.displayCoordinates)===null||c===void 0?void 0:c.start}"
            displayend="${(d=this.displayCoordinates)===null||d===void 0?void 0:d.end}"
            id="track-${i}"
          >
          </protvista-interpro-track>
        `;case"protvista-variation":return Vr`
          <protvista-variation
            length="${(f=this.sequence)===null||f===void 0?void 0:f.length}"
            displaystart="${(h=this.displayCoordinates)===null||h===void 0?void 0:h.start}"
            displayend="${(v=this.displayCoordinates)===null||v===void 0?void 0:v.end}"
            id="track-${i}"
          >
          </protvista-variation>
        `;case"protvista-variation-graph":return Vr`
          <protvista-variation-graph
            length="${(p=this.sequence)===null||p===void 0?void 0:p.length}"
            displaystart="${(g=this.displayCoordinates)===null||g===void 0?void 0:g.start}"
            displayend="${(m=this.displayCoordinates)===null||m===void 0?void 0:m.end}"
            id="track-${i}"
          >
          </protvista-variation-graph>
        `;default:console.warn("No Matching ProtvistaTrack Found.");break}}}window.customElements.define("protvista-uniprot",Sit);const Cit=()=>{const e=Eo(r=>r.protein),t=M.jsx("protvista-uniprot",{accession:e.primaryAccession});return M.jsx("div",{className:"featureView",children:M.jsx("div",{className:"view__container",children:t||M.jsx("div",{children:"loading"})})})},_it=()=>{const e=Bg(),t=Eo(c=>c.searchStr),r=Eo(c=>c.protein),n={entry:r.primaryAccession?r.primaryAccession:"",entryNames:r.uniProtkbId?r.uniProtkbId:"",genesPrimary:r.genes&&r.genes[0].geneName&&r.genes[0].geneName.value?r.genes[0].geneName.value:"",genesSecondary:r.genes&&r.genes[0].synonyms?r.genes[0].synonyms.map(c=>" "+c.value):[],organismName:r.organism?r.organism.scientificName:"",sublocation:r.comments&&r.comments[0]&&r.comments[0].subcellularLocations?r.comments[0].subcellularLocations.map(c=>{var d;return(d=c.location)==null?void 0:d.value}).join(", "):"",length:r.sequence?r.sequence.length:0};let a="/";location.pathname.match("details")&&(a="details"),location.pathname.match("feature_viewer")&&(a="features"),location.pathname.match("publications")&&(a="publications");const[i,o]=ze.useState(a),s=ze.useCallback(()=>{o("details"),e(Nf(`/protein/${n.entry}/details`))},[]),u=ze.useCallback(()=>{o("features"),e(Nf(`/protein/${n.entry}/feature_viewer`))},[]),l=ze.useCallback(()=>{o("publications"),e(Nf(`/protein/${n.entry}/publications`))},[]);return M.jsxs("div",{className:"proteinPage",children:[M.jsxs("div",{className:"protein__header",children:[n.entry+"/"+n.entryNames,M.jsx(wu,{className:"itemLabel_organism",text:n.organismName})]}),M.jsx("div",{className:"protein__string",children:"protein"}),M.jsx("div",{className:"protein__string",children:"Deleted in lung and esophageal cancer protein 1"}),M.jsx("div",{className:"protein__string",children:"Gene"}),M.jsx("div",{className:"protein__string",children:n.genesPrimary+(n.genesSecondary?", "+r.genesSecondary:"")}),M.jsxs("div",{className:"protein_button_container",children:[M.jsxs("div",{className:"protein_links_container",children:[M.jsx(Qi,{className:i==="details"?"protein__links protein__links--active":"protein__links",text:"Details",onClick:s,to:`/protein/${n.entry}/details`}),M.jsx(Qi,{className:i==="features"?"protein__links protein__links--active":"protein__links",text:"Feature viewer",onClick:u,to:`/protein/${n.entry}/feature_viewer`}),M.jsx(Qi,{className:i==="publications"?"protein__links protein__links--active":"protein__links",text:"Publications",onClick:l,to:`/protein/${n.entry}/publications`})]}),M.jsx(Qi,{className:"protein__links protein__links--home",text:"to Search",to:"/search?query="+t})]}),M.jsx(A1,{})]})},wit=()=>{var t;const e=Eo(r=>r.protein);return M.jsx("div",{className:"publications",children:(t=e.references)==null?void 0:t.map(r=>{var n,a,i,o,s,u,l,c;return M.jsxs("div",{className:"publication__item",children:[M.jsx("span",{className:"publication__title",children:(n=r.citation)!=null&&n.title?(a=r.citation)==null?void 0:a.title:""}),M.jsx("span",{children:(i=r.citation)!=null&&i.authors?(o=r.citation)==null?void 0:o.authors.join(", "):""}),M.jsx("span",{children:"Cited for: "+r.referencePositions?(s=r.referencePositions)==null?void 0:s.join(", "):""}),M.jsx("span",{className:"reference__container",children:(u=r.citation)!=null&&u.citationCrossReferences?(l=r.citation)==null?void 0:l.citationCrossReferences.map(d=>M.jsxs("span",{className:"reference__element",children:[d.database,M.jsx("span",{className:"reference__icon"})]},d.database)):""})]},(c=r.citation)==null?void 0:c.id)})})};var Eit="firebase",Ait="9.22.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zm(Eit,Ait,"app");const Pit={apiKey:"AIzaSyDn1RijVaoxSqZ3gCn6iKVmhWG8TbnxZWg",authDomain:"js-final-task-294b9.firebaseapp.com",projectId:"js-final-task-294b9",storageBucket:"js-final-task-294b9.appspot.com",messagingSenderId:"950374001771",appId:"1:950374001771:web:00465749f68d417b58952e"};Lq(Pit);const Tit=()=>{const e=Eo(r=>r.loading),t=rle(tI(M.jsxs(mo,{path:"/",element:M.jsx(she,{}),children:[M.jsx(mo,{path:"/Login",element:M.jsx(ahe,{})}),M.jsx(mo,{path:"/SignUp",element:M.jsx(ihe,{})}),M.jsx(mo,{path:"/",element:M.jsx(Ele,{})}),M.jsx(mo,{path:"/Home",element:M.jsxs("div",{children:[" ",M.jsx(VF,{})," ",M.jsx(Sle,{})," ",M.jsx(A1,{})," "]}),children:M.jsx(mo,{path:"/Home/filter",element:M.jsx(HF,{})})}),M.jsx(mo,{path:"/search",element:M.jsxs("div",{children:[" ",M.jsx(VF,{})," ",M.jsx(xle,{})," ",M.jsx(A1,{})," "]}),children:M.jsx(mo,{path:"/search/filter",element:M.jsx(HF,{})})}),M.jsxs(mo,{path:"/protein/:id",element:M.jsx(_it,{}),children:[M.jsx(mo,{path:"/protein/:id/details",element:M.jsx(uhe,{})}),M.jsx(mo,{path:"/protein/:id/feature_viewer",element:M.jsx(Cit,{})}),M.jsx(mo,{path:"/protein/:id/publications",element:M.jsx(wit,{})})]}),M.jsx(mo,{path:"*",element:M.jsx(ohe,{})})]})));return e?M.jsx(yW,{}):M.jsx(Xue,{router:t})},Iit=Ise(qse,pse),vne=v5(Iit);Lse(vne);Y4.createRoot(document.querySelector("#root")).render(M.jsx(OV.StrictMode,{children:M.jsx(ese,{store:vne,children:M.jsx(Tit,{})})}))});export default Mit();
